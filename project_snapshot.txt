============================== PROJECT STRUCTURE ==============================
TEST/
    â”œâ”€â”€ .cursor/
    â”œâ”€â”€ .git/ [EXCLUDED_DIR]
    â”œâ”€â”€ .github/
    â”‚       â””â”€â”€ workflows/
    â”‚               â”œâ”€â”€ ci.yml
    â”‚               â””â”€â”€ docker.yml
    â”œâ”€â”€ .pytest_cache/
    â”‚       â”œâ”€â”€ v/
    â”‚       â”‚       â””â”€â”€ cache/
    â”‚       â”‚               â”œâ”€â”€ lastfailed
    â”‚       â”‚               â””â”€â”€ nodeids
    â”‚       â”œâ”€â”€ .gitignore
    â”‚       â”œâ”€â”€ CACHEDIR.TAG
    â”‚       â””â”€â”€ README.md
    â”œâ”€â”€ .venv/ [EXCLUDED_DIR]
    â”œâ”€â”€ config/
    â”‚       â”œâ”€â”€ cloud_password_5526658109.txt
    â”‚       â”œâ”€â”€ cloud_password_7847397229.txt
    â”‚       â””â”€â”€ security_keys.json
    â”œâ”€â”€ Data/
    â”‚       â”œâ”€â”€ Config/
    â”‚       â”‚       â”œâ”€â”€ modules_settings/
    â”‚       â”‚       â”‚       â”œâ”€â”€ ai_chat.yaml
    â”‚       â”‚       â”‚       â”œâ”€â”€ broadcast.yaml
    â”‚       â”‚       â”‚       â””â”€â”€ universal_template.yaml
    â”‚       â”‚       â”œâ”€â”€ core_settings.yaml
    â”‚       â”‚       â””â”€â”€ enabled_modules.json
    â”‚       â”œâ”€â”€ Database_files/
    â”‚       â”‚       â””â”€â”€ swiftdevbot.db [EXCLUDED_FILE]
    â”‚       â”œâ”€â”€ Logs/
    â”‚       â”‚       â””â”€â”€ 2025/
    â”‚       â”‚               â””â”€â”€ 11-November/
    â”‚       â”‚                       â”œâ”€â”€ 21/
    â”‚       â”‚                       â”‚       â”œâ”€â”€ 16_sdb.log [EXCLUDED_FILE]
    â”‚       â”‚                       â”‚       â”œâ”€â”€ 17_sdb.log [EXCLUDED_FILE]
    â”‚       â”‚                       â”‚       â””â”€â”€ 20_sdb.log [EXCLUDED_FILE]
    â”‚       â”‚                       â””â”€â”€ 22/
    â”‚       â”‚                               â”œâ”€â”€ 11_sdb.log [EXCLUDED_FILE]
    â”‚       â”‚                               â”œâ”€â”€ 12_sdb.log [EXCLUDED_FILE]
    â”‚       â”‚                               â”œâ”€â”€ 13_sdb.log [EXCLUDED_FILE]
    â”‚       â”‚                               â”œâ”€â”€ 14_sdb.log [EXCLUDED_FILE]
    â”‚       â”‚                               â”œâ”€â”€ 15_sdb.log [EXCLUDED_FILE]
    â”‚       â”‚                               â”œâ”€â”€ 16_sdb.log [EXCLUDED_FILE]
    â”‚       â”‚                               â”œâ”€â”€ 17_sdb.log [EXCLUDED_FILE]
    â”‚       â”‚                               â”œâ”€â”€ 18_sdb.log [EXCLUDED_FILE]
    â”‚       â”‚                               â”œâ”€â”€ 19_sdb.log [EXCLUDED_FILE]
    â”‚       â”‚                               â””â”€â”€ 20_sdb.log [EXCLUDED_FILE]
    â”‚       â”œâ”€â”€ Security/
    â”‚       â”‚       â”œâ”€â”€ anomaly_detection/
    â”‚       â”‚       â”œâ”€â”€ audit_logs/
    â”‚       â”‚       â”‚       â”œâ”€â”€ audit_2025-11-21.jsonl
    â”‚       â”‚       â”‚       â””â”€â”€ audit_2025-11-22.jsonl
    â”‚       â”‚       â”œâ”€â”€ crypto_keys/
    â”‚       â”‚       â”‚       â””â”€â”€ .master_password
    â”‚       â”‚       â”œâ”€â”€ jwt_keys/
    â”‚       â”‚       â”‚       â”œâ”€â”€ jwt_private_key.pem
    â”‚       â”‚       â”‚       â”œâ”€â”€ jwt_public_key.pem
    â”‚       â”‚       â”‚       â””â”€â”€ jwt_secret.key
    â”‚       â”‚       â”œâ”€â”€ levels/
    â”‚       â”‚       â”œâ”€â”€ reputation/
    â”‚       â”‚       â”œâ”€â”€ sandbox/
    â”‚       â”‚       â”œâ”€â”€ signatures/
    â”‚       â”‚       â””â”€â”€ trusted_keys/
    â”‚       â”‚               â””â”€â”€ trusted_signers.json
    â”‚       â””â”€â”€ sdb_bot.pid
    â”œâ”€â”€ Docs/ [EXCLUDED_DIR]
    â”œâ”€â”€ Modules/ [EXCLUDED_DIR]
    â”œâ”€â”€ Scripts/
    â”‚       â”œâ”€â”€ clean_cache.py
    â”‚       â””â”€â”€ snapshot_generator.py
    â”œâ”€â”€ Systems/
    â”‚       â”œâ”€â”€ cli/
    â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”œâ”€â”€ api.py
    â”‚       â”‚       â”œâ”€â”€ backup.py
    â”‚       â”‚       â”œâ”€â”€ bot.py
    â”‚       â”‚       â”œâ”€â”€ cache.py
    â”‚       â”‚       â”œâ”€â”€ config.py
    â”‚       â”‚       â”œâ”€â”€ db.py
    â”‚       â”‚       â”œâ”€â”€ dev.py
    â”‚       â”‚       â”œâ”€â”€ module.py
    â”‚       â”‚       â”œâ”€â”€ monitor.py
    â”‚       â”‚       â”œâ”€â”€ notifications.py
    â”‚       â”‚       â”œâ”€â”€ process.py
    â”‚       â”‚       â”œâ”€â”€ run.py
    â”‚       â”‚       â”œâ”€â”€ security.py
    â”‚       â”‚       â”œâ”€â”€ system.py
    â”‚       â”‚       â”œâ”€â”€ tasks.py
    â”‚       â”‚       â”œâ”€â”€ user.py
    â”‚       â”‚       â”œâ”€â”€ utils.py
    â”‚       â”‚       â””â”€â”€ web.py
    â”‚       â”œâ”€â”€ core/
    â”‚       â”‚       â”œâ”€â”€ admin/
    â”‚       â”‚       â”‚       â”œâ”€â”€ entry/
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”‚       â””â”€â”€ handlers_entry.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ logs_viewer/
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_logs.py
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ keyboards_logs.py
    â”‚       â”‚       â”‚       â”‚       â””â”€â”€ keyboards_modules.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ modules_mgmt/
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_modules.py
    â”‚       â”‚       â”‚       â”‚       â””â”€â”€ keyboards_modules.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ roles/
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_crud_fsm.py
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_details.py
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_list.py
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_role_perms.py
    â”‚       â”‚       â”‚       â”‚       â””â”€â”€ keyboards_roles.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ sys_info/
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_sys_info.py
    â”‚       â”‚       â”‚       â”‚       â””â”€â”€ keyboards_sys_info.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ users/
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_details.py
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_direct_perms.py
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_list.py
    â”‚       â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_roles_assign.py
    â”‚       â”‚       â”‚       â”‚       â””â”€â”€ keyboards_users.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ filters_admin.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_log_viewer.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_module_management.py
    â”‚       â”‚       â”‚       â””â”€â”€ keyboards_admin_common.py
    â”‚       â”‚       â”œâ”€â”€ cache/
    â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ manager.py
    â”‚       â”‚       â”‚       â””â”€â”€ strategies.py
    â”‚       â”‚       â”œâ”€â”€ database/
    â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ base.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ core_models.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ db_utils.py
    â”‚       â”‚       â”‚       â””â”€â”€ manager.py
    â”‚       â”‚       â”œâ”€â”€ errors/
    â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ exceptions.py
    â”‚       â”‚       â”‚       â””â”€â”€ handler.py
    â”‚       â”‚       â”œâ”€â”€ events/
    â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â””â”€â”€ dispatcher.py
    â”‚       â”‚       â”œâ”€â”€ fsm/
    â”‚       â”‚       â”‚       â””â”€â”€ storage_factory.py
    â”‚       â”‚       â”œâ”€â”€ http_client/
    â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ manager.py
    â”‚       â”‚       â”‚       â””â”€â”€ retry.py
    â”‚       â”‚       â”œâ”€â”€ i18n/
    â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ middleware.py
    â”‚       â”‚       â”‚       â””â”€â”€ translator.py
    â”‚       â”‚       â”œâ”€â”€ logging/
    â”‚       â”‚       â”‚       â””â”€â”€ structured.py
    â”‚       â”‚       â”œâ”€â”€ module_loader/
    â”‚       â”‚       â”‚       â””â”€â”€ migrations.py
    â”‚       â”‚       â”œâ”€â”€ monitoring/
    â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ health.py
    â”‚       â”‚       â”‚       â””â”€â”€ metrics.py
    â”‚       â”‚       â”œâ”€â”€ rbac/
    â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â””â”€â”€ service.py
    â”‚       â”‚       â”œâ”€â”€ schemas/
    â”‚       â”‚       â”‚       â””â”€â”€ module_manifest.py
    â”‚       â”‚       â”œâ”€â”€ security/
    â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ anomaly_detection.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ audit_logger.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ code_scanner.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ command_dedup.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ crypto_manager.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ input_validator.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ rate_limiter.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ reputation_system.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ sandbox_manager.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ security_levels.py
    â”‚       â”‚       â”‚       â””â”€â”€ signature_manager.py
    â”‚       â”‚       â”œâ”€â”€ sys_modules/
    â”‚       â”‚       â”‚       â””â”€â”€ __init__.py
    â”‚       â”‚       â”œâ”€â”€ ui/
    â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ callback_data_factories.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ handlers_core_ui.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ keyboards_core.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ navigation_core.py
    â”‚       â”‚       â”‚       â””â”€â”€ registry_ui.py
    â”‚       â”‚       â”œâ”€â”€ users/
    â”‚       â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”‚       â”œâ”€â”€ middleware.py
    â”‚       â”‚       â”‚       â””â”€â”€ service.py
    â”‚       â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”‚       â”œâ”€â”€ app_settings.py
    â”‚       â”‚       â”œâ”€â”€ bot_entrypoint.py
    â”‚       â”‚       â”œâ”€â”€ logging_manager.py
    â”‚       â”‚       â”œâ”€â”€ module_loader.py
    â”‚       â”‚       â””â”€â”€ services_provider.py
    â”‚       â”œâ”€â”€ locales/
    â”‚       â”‚       â”œâ”€â”€ en.yaml
    â”‚       â”‚       â”œâ”€â”€ ru.yaml
    â”‚       â”‚       â””â”€â”€ ua.yaml
    â”‚       â”œâ”€â”€ migration/
    â”‚       â”‚       â”œâ”€â”€ versions/
    â”‚       â”‚       â”‚       â”œâ”€â”€ .gitkeep
    â”‚       â”‚       â”‚       â””â”€â”€ d10040ec2cb7_initial_migration_for_core_tables.py
    â”‚       â”‚       â”œâ”€â”€ env.py
    â”‚       â”‚       â””â”€â”€ script.py.mako
    â”‚       â””â”€â”€ web/
    â”‚               â”œâ”€â”€ auth/
    â”‚               â”‚       â”œâ”€â”€ __init__.py
    â”‚               â”‚       â””â”€â”€ jwt_handler.py
    â”‚               â”œâ”€â”€ dist/ [EXCLUDED_DIR]
    â”‚               â”œâ”€â”€ node_modules/ [EXCLUDED_DIR]
    â”‚               â”œâ”€â”€ public/
    â”‚               â”‚       â””â”€â”€ locales/
    â”‚               â”‚               â”œâ”€â”€ en.json
    â”‚               â”‚               â”œâ”€â”€ ru.json
    â”‚               â”‚               â””â”€â”€ ua.json
    â”‚               â”œâ”€â”€ src/
    â”‚               â”‚       â”œâ”€â”€ components/
    â”‚               â”‚       â”‚       â”œâ”€â”€ sections/
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ BroadcastStudio.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Config.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ CoreManagement.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ CronJobs.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Data.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ DatabaseData.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Developer.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Docs.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Home.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Logs.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ MissionControl.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Modules.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ ModulesHub.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Monitoring.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Notifications.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Security.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ SecurityOperations.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Services.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Settings.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Statistics.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Support.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ Terminal.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ UserDashboard.tsx
    â”‚               â”‚       â”‚       â”‚       â””â”€â”€ Users.tsx
    â”‚               â”‚       â”‚       â”œâ”€â”€ ui/
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ GlassButton.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ GlassCard.tsx
    â”‚               â”‚       â”‚       â”‚       â””â”€â”€ GlassInput.tsx
    â”‚               â”‚       â”‚       â”œâ”€â”€ widgets/
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ ActivityWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ CalendarWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ GitHubWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ NotesWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ PerformanceWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ QuickActionsWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ RecentErrorsWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ ServicesStatusWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ StatsWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ SystemAnnouncementsWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ SystemHealthWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ TasksWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ TimeWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ ToolsWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ TopModulesWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ UptimeWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ UserStatsWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ WeatherWidget.tsx
    â”‚               â”‚       â”‚       â”‚       â”œâ”€â”€ WidgetContainer.tsx
    â”‚               â”‚       â”‚       â”‚       â””â”€â”€ WidgetSettings.tsx
    â”‚               â”‚       â”‚       â”œâ”€â”€ AnimatedBackground.tsx
    â”‚               â”‚       â”‚       â”œâ”€â”€ CommandPalette.tsx
    â”‚               â”‚       â”‚       â”œâ”€â”€ Header.tsx
    â”‚               â”‚       â”‚       â””â”€â”€ Sidebar.tsx
    â”‚               â”‚       â”œâ”€â”€ contexts/
    â”‚               â”‚       â”‚       â”œâ”€â”€ AuthContext.tsx
    â”‚               â”‚       â”‚       â”œâ”€â”€ I18nContext.tsx
    â”‚               â”‚       â”‚       â”œâ”€â”€ NavigationContext.tsx
    â”‚               â”‚       â”‚       â””â”€â”€ ThemeContext.tsx
    â”‚               â”‚       â”œâ”€â”€ pages/
    â”‚               â”‚       â”‚       â”œâ”€â”€ CloudPasswordPrompt.tsx
    â”‚               â”‚       â”‚       â”œâ”€â”€ CloudPasswordSetup.tsx
    â”‚               â”‚       â”‚       â””â”€â”€ Dashboard.tsx
    â”‚               â”‚       â”œâ”€â”€ utils/
    â”‚               â”‚       â”‚       â””â”€â”€ userDisplay.ts
    â”‚               â”‚       â”œâ”€â”€ api.ts
    â”‚               â”‚       â”œâ”€â”€ App.tsx
    â”‚               â”‚       â”œâ”€â”€ index.css
    â”‚               â”‚       â”œâ”€â”€ main.tsx
    â”‚               â”‚       â”œâ”€â”€ package.json
    â”‚               â”‚       â””â”€â”€ vite-env.d.ts
    â”‚               â”œâ”€â”€ supabasex/
    â”‚               â”‚       â””â”€â”€ migrations/
    â”‚               â”‚               â””â”€â”€ 20251104203347_create_swiftdevbot_schema.sql
    â”‚               â”œâ”€â”€ .gitignore
    â”‚               â”œâ”€â”€ __init__.py
    â”‚               â”œâ”€â”€ app.py
    â”‚               â”œâ”€â”€ eslint.config.js
    â”‚               â”œâ”€â”€ index.html
    â”‚               â”œâ”€â”€ package-lock.json
    â”‚               â”œâ”€â”€ package.json
    â”‚               â”œâ”€â”€ postcss.config.js
    â”‚               â”œâ”€â”€ README.md
    â”‚               â”œâ”€â”€ tailwind.config.js
    â”‚               â”œâ”€â”€ tsconfig.app.json
    â”‚               â”œâ”€â”€ tsconfig.json
    â”‚               â”œâ”€â”€ tsconfig.node.json
    â”‚               â””â”€â”€ vite.config.ts
    â”œâ”€â”€ tests/
    â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”œâ”€â”€ conftest.py
    â”‚       â”œâ”€â”€ test_cli.py
    â”‚       â”œâ”€â”€ test_error_handler.py
    â”‚       â”œâ”€â”€ test_health.py
    â”‚       â”œâ”€â”€ test_input_validator.py
    â”‚       â”œâ”€â”€ test_metrics.py
    â”‚       â”œâ”€â”€ test_rate_limiter.py
    â”‚       â””â”€â”€ test_web_app.py
    â”œâ”€â”€ .dockerignore
    â”œâ”€â”€ .env
    â”œâ”€â”€ .gitignore
    â”œâ”€â”€ alembic.ini
    â”œâ”€â”€ CHANGELOG.md
    â”œâ”€â”€ docker-compose.yml
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ env.example
    â”œâ”€â”€ Makefile
    â”œâ”€â”€ project_snapshot.txt [EXCLUDED_FILE]
    â”œâ”€â”€ prometheus.yml
    â”œâ”€â”€ pytest.ini
    â”œâ”€â”€ README.md
    â”œâ”€â”€ requirements.txt
    â”œâ”€â”€ run_bot.py
    â”œâ”€â”€ sdb
    â”œâ”€â”€ sdb.py
    â””â”€â”€ sdb_setup.py

======================================================================

------------------------------ FILE: alembic.ini ------------------------------
# alembic.ini
# ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» Alembic Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° SwiftDevBot (SDB)

[alembic]
# ĞŸÑƒÑ‚ÑŒ Ğº Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ ÑĞ¾ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ°Ğ¼Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ (env.py, versions/)
# Ğ£ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ .ini Ñ„Ğ°Ğ¹Ğ»Ğ°.
script_location = Systems/migration

# Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ Ğ´Ğ»Ñ Ğ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¹.
# %%(rev)s - ID Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸, %%(slug)s - Ñ‡Ğ°ÑÑ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ (message) Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸.
file_template = %%(rev)s_%%(slug)s

# URL Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….
# Ğ’ĞĞ–ĞĞ: Ğ­Ñ‚Ğ¾Ñ‚ URL Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½ Ğ² alembic_migrations/env.py
# Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ¸Ğ· core.app_settings.settings.
# ĞŸĞ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ·Ğ´ĞµÑÑŒ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞµĞ³Ğ¾ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼ Ğ¸Ğ»Ğ¸ Ğ·Ğ°ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼.
# sqlalchemy.url = driver://user:pass@localhost/dbname
#sqlalchemy.url = sqlite:///./default_sdb_for_alembic_init.db # ĞŸÑ€Ğ¸Ğ¼ĞµÑ€, ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶ĞµĞ½ Ğ´Ğ»Ñ `alembic init`

# --- ĞĞ¿Ñ†Ğ¸Ğ¸, Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ SDB ---

# Ğ“Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ Alembic Ğ²ÑĞµĞ³Ğ´Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑ‚ÑŒ env.py Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸.
# Ğ­Ñ‚Ğ¾ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾, Ñ‚Ğ°Ğº ĞºĞ°Ğº env.py Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¸ URL Ğ‘Ğ”.
revision_environment = true

# Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸ĞµĞ¼ .pyc Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ±ĞµĞ· Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ñ… .py Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹.
# ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾ False. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ² True Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ğ° Ğ² ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… ÑĞ»ÑƒÑ‡Ğ°ÑÑ…,
# Ğ½Ğ¾ Ğ´Ğ»Ñ SDB Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ±Ñ‹Ñ‚ÑŒ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾Ğ¹. ĞÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ°Ğº Ñ‚Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ğ».
sourceless = true 

# ĞšĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ´Ğ»Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹, ĞµÑĞ»Ğ¸ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ¹.
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ UTF-8 Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚.
# file_encoding = utf-8

# --- ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ğ¿Ñ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ ---

# Ğ Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ´Ğ»Ñ version_locations (Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ½Ğ°Ğ¼Ğ¸, Ñ‚Ğ°Ğº ĞºĞ°Ğº script_location Ğ¾Ğ´Ğ¸Ğ½)
# version_path_separator = os # (ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾)

# Ğ•ÑĞ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ±Ğ°Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ½Ğµ Ğ½Ğ°Ñˆ ÑĞ»ÑƒÑ‡Ğ°Ğ¹ Ğ´Ğ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Alembic Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ)
# [alembic:engine_myapp]
# sqlalchemy.url = ...

# ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Alembic.
# ĞœĞ¾Ğ³ÑƒÑ‚ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½ÑÑ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Loguru, ĞµÑĞ»Ğ¸ SDB Ğ¸Ñ… Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚.
# ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ·Ğ´ĞµÑÑŒ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ° Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ñ‚ Alembic.
[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = WARN
handlers = console
qualname =

[logger_sqlalchemy]
# Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ SQLAlchemy (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, WARN, INFO, DEBUG Ğ´Ğ»Ñ SQL-Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²)
level = WARN 
handlers =
qualname = sqlalchemy.engine

[logger_alembic]
# Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ ÑĞ°Ğ¼Ğ¾Ğ³Ğ¾ Alembic
level = INFO 
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S


======================================================================

------------------------------ FILE: env.example ------------------------------
# .env.example
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ SwiftDevBot.
# Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ ÑÑ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ» Ğ² .env Ğ¸ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ ÑĞ²Ğ¾Ğ¸Ğ¼Ğ¸ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸ÑĞ¼Ğ¸.
# Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ¸, Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ÑÑ‰Ğ¸ĞµÑÑ Ñ #, ÑĞ²Ğ»ÑÑÑ‚ÑÑ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ÑĞ¼Ğ¸.

# --- Telegram Bot ---
# ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ: Ğ¢Ğ¾ĞºĞµĞ½ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Telegram Ğ±Ğ¾Ñ‚Ğ°. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñƒ @BotFather.
BOT_TOKEN=8146110559:AAHyOYDtx8s7MAZm5_t7CMIpJjAu6RQRUQ0
SDB_TELEGRAM_POLLING_TIMEOUT=30

# Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Telegram ID ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ.
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: SDB_CORE_SUPER_ADMINS="12345678,98765432"
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº (Ğ¸Ğ· AppSettings)
SDB_CORE_SUPER_ADMINS="7847397229"

# --- Ğ‘Ğ°Ğ·Ğ° Ğ”Ğ°Ğ½Ğ½Ñ‹Ñ… ---
# Ğ¢Ğ¸Ğ¿ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ğ¾Ğ¹ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: "sqlite", "postgresql", "mysql"
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "sqlite" (Ğ¸Ğ· AppSettings)

SDB_DB_TYPE="postgresql"
SDB_DB_PG_DSN="postgresql+psycopg://postgres:Sova3568@192.168.31.3:2345/swiftdevbot"

# Ğ”Ğ»Ñ SQLite:
# SDB_DB_TYPE="sqlite"
# ĞÑ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ SQLite (Ğ¾Ñ‚ ĞºĞ¾Ñ€Ğ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ¸Ğ»Ğ¸ project_data_path).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "Database_files/swiftdevbot.db" (Ğ¸Ğ· AppSettings)
# SDB_DB_SQLITE_PATH="Database_files/sdb_prod.db"

# Ğ”Ğ»Ñ PostgreSQL:
# SDB_DB_TYPE="postgresql"
# DSN (Data Source Name) Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº PostgreSQL.
# Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: postgresql+<Ğ´Ñ€Ğ°Ğ¹Ğ²ĞµÑ€>://<user>:<password>@<host>:<port>/<dbname>
# Ğ”Ñ€Ğ°Ğ¹Ğ²ĞµÑ€Ñ‹: asyncpg, psycopg (Ğ´Ğ»Ñ psycopg SQLAlchemy 2.0 Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ psycopg[binary])
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: SDB_DB_PG_DSN="postgresql+psycopg://sdb_user:sdb_pass@localhost:5432/sdb_pg_database"
# SDB_DB_PG_DSN="postgresql+psycopg://soverx:Sova3568@192.168.31.3:2345/sdb_database"

# Ğ”Ğ»Ñ MySQL:
# SDB_DB_TYPE="mysql"
# DSN Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº MySQL.
# Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: mysql+<Ğ´Ñ€Ğ°Ğ¹Ğ²ĞµÑ€>://<user>:<password>@<host>:<port>/<dbname>
# Ğ”Ñ€Ğ°Ğ¹Ğ²ĞµÑ€Ñ‹: aiomysql, asyncmy
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: SDB_DB_MYSQL_DSN="mysql+aiomysql://sdb_user:sdb_pass@localhost:3306/sdb_mysql_database?charset=utf8mb4"
# SDB_DB_MYSQL_DSN="mysql+aiomysql://root:Sova3568@192.168.31.3:33066/swiftdevbot?charset=utf8mb4"

# Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ SQL-Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ SQLAlchemy (ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ DEBUG). true/false
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: false (Ğ¸Ğ· AppSettings)
# SDB_DB_ECHO_SQL="false"


# --- ĞšÑÑˆ ---
# Ğ¢Ğ¸Ğ¿ ĞºÑÑˆĞ°: "memory", "redis"
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "memory" (Ğ¸Ğ· AppSettings)
SDB_CACHE_TYPE="redis"

# Ğ”Ğ»Ñ Redis:
# SDB_CACHE_TYPE="redis"
# URL Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº Redis.
# Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: redis://[:<password>@]<host>:<port>/<db_number>
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "redis://localhost:6379/0" (Ğ¸Ğ· AppSettings)
SDB_CACHE_REDIS_URL="redis://192.168.31.3:6379/0"


# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¯Ğ´Ñ€Ğ° (Core) ---
# ĞŸÑƒÑ‚ÑŒ Ğº Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (Ğ»Ğ¾Ğ³Ğ¸, Ğ‘Ğ”, ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "./Data" (Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ĞºĞ¾Ñ€Ğ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°, Ğ¸Ğ· AppSettings)
# SDB_CORE_PROJECT_DATA_PATH="./Data"

# ĞŸÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ ÑĞ¾ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "Config/enabled_modules.json" (Ğ¸Ğ· AppSettings)
# SDB_CORE_ENABLED_MODULES_CONFIG_PATH="Config/active_plugins.json"

# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¯Ğ´Ñ€Ğ° ---
# Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: TRACE, DEBUG, INFO, WARNING, ERROR, CRITICAL
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "INFO" (Ğ¸Ğ· AppSettings)
SDB_CORE_LOG_LEVEL="INFO"

# ĞŸĞ¸ÑĞ°Ñ‚ÑŒ Ğ»Ğ¸ Ğ»Ğ¾Ğ³Ğ¸ Ğ² Ñ„Ğ°Ğ¹Ğ». true/false
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: true (Ğ¸Ğ· AppSettings)
# SDB_CORE_LOG_TO_FILE="true"

# Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ Ğ¿ÑƒÑ‚Ğ¸ Ğº Ğ»Ğ¾Ğ³-Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼ (Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°).
# {time} - ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ´Ğ»Ñ Loguru.
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "Logs/sdb_{time:YYYY-MM-DD_HH-mm-ss_SSSSSS}.log" (Ğ¸Ğ· AppSettings)
# SDB_CORE_LOG_FILE_PATH_TEMPLATE="MyLogs/bot_{time}.log"

# Ğ Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ² (Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¸Ğ»Ğ¸ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»). ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹: "500 MB", "1 week", "00:00" (ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾ Ğ² Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‡ÑŒ).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "10 MB" (Ğ¸Ğ· AppSettings)
# SDB_CORE_LOG_ROTATION="100 MB"

# Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ»Ğ¾Ğ³Ğ¾Ğ² (ĞºĞ°Ğº Ğ´Ğ¾Ğ»Ğ³Ğ¾ Ğ¸Ğ»Ğ¸ ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²). ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹: "1 month", "10 files".
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "7 days" (Ğ¸Ğ· AppSettings)
# SDB_CORE_LOG_RETENTION="30 days"

# Ğ’ĞµÑ€ÑĞ¸Ñ ÑĞ´Ñ€Ğ° SDB (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ², Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ½Ğµ Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ğ·Ğ´ĞµÑÑŒ).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "0.1.0" (Ğ¸Ğ· AppSettings)
# SDB_CORE_SDB_VERSION="0.1.1-beta"


# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ "ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğ°" ĞœĞ¾Ğ´ÑƒĞ»ĞµĞ¹ ---
# URL Ğº JSON-Ğ¸Ğ½Ğ´ĞµĞºÑÑƒ Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ SDB.
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "https://raw.githubusercontent.com/soverxos/SwiftDevBot-Modules/main/modules_index.json" (Ğ¸Ğ· AppSettings)
# SDB_MODULE_REPO_INDEX_URL="https://my.private.repo/modules_index.json"


# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ˜Ğ½Ñ‚ĞµÑ€Ğ½Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (i18n) Ğ¯Ğ´Ñ€Ğ° ---
# ĞŸÑƒÑ‚ÑŒ Ğº Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼Ğ¸ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² (Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ĞºĞ¾Ñ€Ğ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "Systems/locales" (Ğ¸Ğ· AppSettings)
# SDB_I18N_LOCALES_DIR="Systems/locales"

# Ğ˜Ğ¼Ñ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ° Ğ´Ğ»Ñ gettext (Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ¸Ğ¼Ñ .po/.mo Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "bot" (Ğ¸Ğ· AppSettings)
# SDB_I18N_DOMAIN="sdb_core"

# Ğ¯Ğ·Ñ‹Ğº Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ.
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "en" (Ğ¸Ğ· AppSettings)
SDB_I18N_DEFAULT_LOCALE="en"

# Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ÑĞ·Ñ‹ĞºĞ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "en,uk,de").
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "en,uk" (Ğ¸Ğ· AppSettings)
SDB_I18N_AVAILABLE_LOCALES="en,ua,ru"

# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ’ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ ---
# Ğ¥Ğ¾ÑÑ‚ Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ (0.0.0.0 Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° ÑĞ¾ Ğ²ÑĞµÑ… Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ¾Ğ², 127.0.0.1 Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾)
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "127.0.0.1"
SDB_WEB_HOST="0.0.0.0"

# ĞŸĞ¾Ñ€Ñ‚ Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 8000
SDB_WEB_PORT=8000

# ĞĞ²Ñ‚Ğ¾Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ÑÑ… (Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸). true/false
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: false
# SDB_WEB_RELOAD="false"

# ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ğ¾Ñ€ĞºĞµÑ€Ğ¾Ğ² Ğ´Ğ»Ñ production (Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ ĞµÑĞ»Ğ¸ SDB_WEB_RELOAD=true)
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 1
# SDB_WEB_WORKERS=1

# Ğ’Ñ€ĞµĞ¼Ñ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ JWT Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ (Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°Ñ…)
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 60 Ğ¼Ğ¸Ğ½ÑƒÑ‚ (1 Ñ‡Ğ°Ñ)
SDB_WEB_TOKEN_LIFETIME_MINUTES=60


======================================================================

------------------------------ FILE: .gitignore ------------------------------
# Byte-compiled / optimized / DLL files
__pycache__/
*.py[cod]
*$py.class

# C extensions
*.so

# Distribution / packaging
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
pip-wheel-metadata/
share/python-wheels/
*.egg-info/
.installed.cfg
*.egg
MANIFEST

# PyInstaller
#  Usually these files are written by a python script from a template
#  before PyInstaller builds the exe, so as to inject date/other infos into it.
*.manifest
*.spec

# Installer logs
pip-log.txt
pip-delete-this-directory.txt

# Unit test / coverage reports
htmlcov/
.tox/
.nox/
.coverage
.coverage.*
.cache
nosetests.xml
coverage.xml
*.cover
*.py,cover
.hypothesis/
.pytest_cache/

# Translations
*.mo
*.pot

# Django stuff:
*.log
local_settings.py
db.sqlite3
db.sqlite3-journal

# Flask stuff:
instance/
.webassets-cache

# Scrapy stuff:
.scrapy

# Sphinx documentation
docs/_build/

# PyBuilder
target/

# Jupyter Notebook
.ipynb_checkpoints

# IPython
profile_default/
ipython_config.py

# pyenv
.python-version

# pipenv
#   According to pypa/pipenv#598, it is recommended to include Pipfile.lock in version control.
#   However, in case of collaboration, if having platform-specific dependencies or dependencies
#   having no cross-platform support, pipenv may install dependencies that don't work, or not
#   install all needed dependencies.
#Pipfile.lock

# PEP 582; used by e.g. github.com/David-OConnor/pyflow
__pypackages__/

# Celery stuff
celerybeat-schedule
celerybeat.pid

# SageMath parsed files
*.sage.py

# Environments
.env
.venv
env/
venv/
ENV/
env.bak/
venv.bak/

# Spyder project settings
.spyderproject
.spyproject

# Rope project settings
.ropeproject

# mkdocs documentation
/site

# mypy
.mypy_cache/
.dmypy.json
dmypy.json

# Pyre type checker
.pyre/

# SwiftDevBot specific
project_data/Database_files/*.db
Data/Database_files/*.sqlite
Data/Database_files/*.sqlite3
Data/Logs/*.log
Data/Security/crypto_keys/*
Data/Security/audit_logs/*
Data/Security/anomaly_detection/*
Data/Security/reputation/*
Data/Security/sandbox/*
Data/Security/signatures/*
Data/sdb_bot.pid
*.pid

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# Temporary files
*.tmp
*.temp
*.bak
*.backup
TOKEN-ID.txt
!Systems/web/src/lib/


======================================================================

------------------------------ FILE: sdb ------------------------------
#!/usr/bin/env python3
"""
SwiftDevBot CLI - Ğ³Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°
"""

import sys
from pathlib import Path

# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ÑƒÑ‚ÑŒ Ğº sdb.py Ğ² Ñ‚Ğ¾Ğ¹ Ğ¶Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸
current_script_path = Path(__file__).resolve()
sdb_py_path = current_script_path.parent / "sdb.py"

# Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ sdb.py Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸
sys.argv[0] = str(sdb_py_path)
exec(open(sdb_py_path).read())



======================================================================

------------------------------ FILE: requirements.txt ------------------------------

aiogram
python-dotenv
setuptools
typer>=0.9.0
pydantic
pydantic-settings
pydantic-extra-types
PyYAML>=6.0
ruamel.yaml
aioredis
redis
cryptography>=41.0.0
pip-audit

SQLAlchemy[asyncio] 
alembic

aiosqlite                
psycopg[binary]   
# asyncpg>=0.27.0           
aiomysql           

loguru
parsedatetime
apscheduler

typer[all] 

aiohttp
requests

packaging

cachetools
rich

psutil
uvicorn[standard]

# Web panel dependencies
fastapi
starlette
itsdangerous
jinja2
PyJWT>=2.8.0
python-multipart
websockets

pytest
pytest-asyncio
pylint
sphinx
coverage
black
isort
mypy


======================================================================

------------------------------ FILE: sdb.py ------------------------------
#!/usr/bin/env python3

import sys
from pathlib import Path

# Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼, Ñ‡Ñ‚Ğ¾ ĞºĞ¾Ñ€ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ² sys.path
current_script_path = Path(__file__).resolve()
project_root = current_script_path.parent
systems_path = project_root / "Systems"
if str(project_root) not in sys.path:
    sys.path.insert(0, str(project_root))
if str(systems_path) not in sys.path:
    sys.path.insert(0, str(systems_path))

try:
    import typer
    from rich.console import Console
except ImportError as e:
    print(f"ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: Typer Ğ¸Ğ»Ğ¸ Rich Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹. {e}", file=sys.stderr)
    print(f"ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸: pip install -r requirements.txt", file=sys.stderr)
    sys.exit(1)

# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ CLI-Ğ¾Ğ±ÑŠĞµĞºÑ‚
# Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼ CLI, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ½Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ»Ğ° BOT_TOKEN
import os as _os
import sys as _sys
_os.environ.setdefault("SDB_CLI_MODE", "true")

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ„Ğ»Ğ°Ğ³ -v/--verbose Ğ”Ğ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
_argv = _sys.argv[1:]
_verbose_flag = "-v" in _argv or "--verbose" in _argv
if _verbose_flag:
    _os.environ["SDB_VERBOSE"] = "true"
else:
    _os.environ["SDB_VERBOSE"] = "false"
    # ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ”Ğ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
    # Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ»Ğ¾Ğ³Ğ¸ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¸ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¼Ğ¸
    try:
        from loguru import logger as _early_logger
        _early_logger.remove()  # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ handler
        # ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚: Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
        _early_logger.add(
            _sys.stderr,
            level="INFO",
            format="<green>{time:HH:mm:ss}</green> <level>{message}</level>",
            colorize=True
        )
    except ImportError:
        pass  # Ğ•ÑĞ»Ğ¸ loguru Ğ½Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼

# Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼, Ñ‡Ñ‚Ğ¾ CLI-Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ½Ğµ Ğ¼ĞµÑˆĞ°ĞµÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ Ğ±Ğ¾Ñ‚Ğ°
_bot_commands = {"start", "run", "bot"}
if _argv and _argv[0] in _bot_commands:
    if _os.environ.get("SDB_CLI_MODE") == "true":
        del _os.environ["SDB_CLI_MODE"]
cli_main_app = typer.Typer(
    name="sdb",
    help="ğŸš€ [bold cyan]SwiftDevBot CLI[/] - Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ° Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²Ğ°ÑˆĞ¸Ğ¼ SDB!",
    rich_markup_mode="rich",
    no_args_is_help=True,
    context_settings={"help_option_names": ["-h", "--help"]}
)

# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²ÑĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹
try:
    # Ğ“Ñ€ÑƒĞ¿Ğ¿Ñ‹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ (Typer-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ)
    from Systems.cli.config import config_app
    from Systems.cli.db import db_app
    from Systems.cli.module import module_app
    from Systems.cli.user import user_app
    from Systems.cli.backup import backup_app
    from Systems.cli.system import system_app
    from Systems.cli.bot import bot_app
    from Systems.cli.monitor import monitor_app
    from Systems.cli.utils import utils_app
    from Systems.cli.security import security_app
    from Systems.cli.notifications import notifications_app
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
    from Systems.cli.dev import dev_app
    from Systems.cli.api import api_app
    from Systems.cli.cache import cache_app
    from Systems.cli.tasks import tasks_app
    
    cli_main_app.add_typer(config_app, name="config", help="ğŸ”§ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸ĞµĞ¹.")
    cli_main_app.add_typer(db_app, name="db", help="ğŸ—„ï¸ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….")
    cli_main_app.add_typer(module_app, name="module", help="ğŸ§© Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸.")
    cli_main_app.add_typer(user_app, name="user", help="ğŸ‘¤ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸.")
    cli_main_app.add_typer(backup_app, name="backup", help="ğŸ’¾ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±ÑĞºĞ°Ğ¿Ğ°Ğ¼Ğ¸.")
    cli_main_app.add_typer(system_app, name="system", help="ğŸ› ï¸ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹.")
    cli_main_app.add_typer(bot_app, name="bot", help="ğŸ¤– Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ñ Bot API.")
    cli_main_app.add_typer(monitor_app, name="monitor", help="ğŸ“Š ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°.")
    cli_main_app.add_typer(utils_app, name="utils", help="ğŸ› ï¸ Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ°Ñ€Ğ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹.")
    cli_main_app.add_typer(security_app, name="security", help="ğŸ”’ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒÑ.")
    cli_main_app.add_typer(notifications_app, name="notifications", help="ğŸ”” Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸.")
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
    cli_main_app.add_typer(dev_app, name="dev", help="ğŸ”§ Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸.")
    cli_main_app.add_typer(api_app, name="api", help="ğŸŒ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ API.")
    cli_main_app.add_typer(cache_app, name="cache", help="ğŸ’¾ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºÑÑˆĞµĞ¼ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.")
    cli_main_app.add_typer(tasks_app, name="tasks", help="ğŸ“‹ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°Ğ¼Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.")
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
    try:
        from Systems.cli.web import web_app
        cli_main_app.add_typer(web_app, name="web", help="ğŸŒ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒÑ.")
    except Exception as web_error:
        # Ğ’ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°, Ğ½Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ
        # Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸
        import os
        import traceback
        if os.environ.get("SDB_DEBUG"):
            console = Console()
            console.print(f"[yellow]ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ: Ğ’ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ½Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°: {web_error}[/]")
            console.print(f"[dim]{traceback.format_exc()}[/]")
        # Ğ’ Ğ»ÑĞ±Ğ¾Ğ¼ ÑĞ»ÑƒÑ‡Ğ°Ğµ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµĞ¼ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ±ĞµĞ· Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
        pass

    # ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
    from Systems.cli.run import run_command
    from Systems.cli.process import stop_command, status_command, restart_command

    # Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ³Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ
    cli_main_app.command("run")(run_command)
    cli_main_app.command("start", help="ğŸš€ ĞŸÑĞµĞ²Ğ´Ğ¾Ğ½Ğ¸Ğ¼ Ğ´Ğ»Ñ 'run'.")(run_command)
    cli_main_app.command("stop", help="ğŸš¦ ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ±Ğ¾Ñ‚Ğ°.")(stop_command)
    cli_main_app.command("status", help="ğŸš¦ ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°.")(status_command)
    cli_main_app.command("restart", help="ğŸš¦ ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ±Ğ¾Ñ‚Ğ°.")(restart_command)

except ImportError as e:
    console = Console()
    console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° CLI ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²:[/]\n {e}")
    console.print("Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ğ°Ğ¿ĞºĞ¸ 'cli/' ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ° Ğ¸ Ğ²ÑĞµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ.")
    sys.exit(1)


if __name__ == "__main__":
    cli_main_app()
# --- ĞšĞĞĞ•Ğ¦ Ğ¤ĞĞ™Ğ›Ğ sdb.py (Ğ¸ sdb) ---


======================================================================

------------------------------ FILE: sdb_setup.py ------------------------------
#!/usr/bin/env python3
"""
SwiftDevBot Setup Wizard
ĞœĞ°ÑÑ‚ĞµÑ€ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ SwiftDevBot
"""

import sys
import os
import venv
import subprocess
import yaml
from pathlib import Path

# ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ ĞºĞ¾Ñ€Ğ½ĞµĞ²ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
PROJECT_ROOT = Path(__file__).resolve().parent
VENV_PATH = PROJECT_ROOT / ".venv"

def create_and_activate_venv():
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ ĞµĞ³Ğ¾"""
    if not VENV_PATH.exists():
        print("\nâš ï¸ Ğ’Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¾")
        print("\nğŸš€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ...")
        venv.create(VENV_PATH, with_pip=True)
        print(f"âœ“ Ğ’Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ Ğ² {VENV_PATH}")
    
    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ°Ñ‚Ğ¾Ñ€Ñƒ Python Ğ² Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğ¸
    if sys.platform == "win32":
        python_path = VENV_PATH / "Scripts" / "python.exe"
        pip_path = VENV_PATH / "Scripts" / "pip.exe"
    else:
        python_path = VENV_PATH / "bin" / "python"
        pip_path = VENV_PATH / "bin" / "pip"
        
    # ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ
    if not hasattr(sys, 'real_prefix') and not (hasattr(sys, 'base_prefix') and sys.base_prefix != sys.prefix):
        print("\nğŸ”„ ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ¸ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ°...")
        os.environ["VIRTUAL_ENV"] = str(VENV_PATH)
        os.environ["PATH"] = str(VENV_PATH / "bin") + os.pathsep + os.environ["PATH"]
        os.execv(str(python_path), [str(python_path), __file__])

def install_dependencies():
    """Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ²ÑĞµ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸"""
    print("\nğŸ“¦ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹...")
    pip_cmd = str(VENV_PATH / "bin" / "pip") if sys.platform != "win32" else str(VENV_PATH / "Scripts" / "pip.exe")
    requirements_file = PROJECT_ROOT / "requirements.txt"
    
    try:
        subprocess.run([pip_cmd, "install", "-r", str(requirements_file)], check=True)
        print("âœ“ Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹")
        return True
    except subprocess.CalledProcessError as e:
        print(f"âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹: {e}")
        return False

def validate_bot_token(token: str) -> bool:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ±Ğ¾Ñ‚Ğ°"""
    import re
    pattern = r'^\d+:[\w-]{35}$'
    return bool(re.match(pattern, token))

def get_admin_id(prompt_text: str) -> int:
    """Ğ—Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ Ğ¸ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ Telegram ID Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°"""
    while True:
        try:
            admin_id = int(input(prompt_text))
            if admin_id > 0:
                return admin_id
            print("âŒ ID Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼")
        except ValueError:
            print("âŒ ID Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ñ†ĞµĞ»Ñ‹Ğ¼ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼")

def setup_database():
    """ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
    print("\nğŸ—„ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…")
    db_types = {
        "1": "sqlite",
        "2": "postgresql",
        "3": "mysql"
    }
    
    print("\nĞ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ Ğ±Ğ°Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:")
    print("1. SQLite (Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ğ°Ñ, Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)")
    print("2. PostgreSQL")
    print("3. MySQL")
    
    while True:
        choice = input("\nĞ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚Ğ¸Ğ¿ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… [1-3] (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 1): ").strip() or "1"
        if choice in db_types:
            db_type = db_types[choice]
            break
        print("âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ 1, 2 Ğ¸Ğ»Ğ¸ 3")
    
    if db_type == "sqlite":
        return {
            "type": "sqlite",
            "url": "sqlite+aiosqlite:///Data/Database_files/sdb.db"
        }
    
    # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ½Ñ‹Ñ… Ğ‘Ğ”
    config = {"type": db_type}
    config["host"] = input("Ğ¥Ğ¾ÑÑ‚ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: localhost): ").strip() or "localhost"
    config["port"] = input(f"ĞŸĞ¾Ñ€Ñ‚ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: {5432 if db_type == 'postgresql' else 3306}): ").strip()
    config["port"] = int(config["port"]) if config["port"].isdigit() else (5432 if db_type == 'postgresql' else 3306)
    config["database"] = input("Ğ˜Ğ¼Ñ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: ").strip()
    config["user"] = input("Ğ˜Ğ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ: ").strip()
    config["password"] = input("ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ: ").strip()
    
    return config

def setup_cache():
    """ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"""
    print("\nğŸ’¾ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ")
    print("\nĞ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:")
    print("1. Memory (Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸, Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)")
    print("2. Redis")
    
    while True:
        choice = input("\nĞ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚Ğ¸Ğ¿ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ [1-2] (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 1): ").strip() or "1"
        if choice == "1":
            return {
                "type": "memory",
                "ttl": 3600  # 1 Ñ‡Ğ°Ñ
            }
        elif choice == "2":
            config = {
                "type": "redis",
                "ttl": 3600  # 1 Ñ‡Ğ°Ñ
            }
            config["host"] = input("Redis Ñ…Ğ¾ÑÑ‚ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: localhost): ").strip() or "localhost"
            config["port"] = int(input("Redis Ğ¿Ğ¾Ñ€Ñ‚ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 6379): ").strip() or "6379")
            config["db"] = int(input("Redis Ğ½Ğ¾Ğ¼ĞµÑ€ Ğ‘Ğ” (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 0): ").strip() or "0")
            return config
        print("âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ 1 Ğ¸Ğ»Ğ¸ 2")

def create_env_file(bot_token: str, admin_id: int, db_config: dict, cache_config: dict):
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ñ„Ğ°Ğ¹Ğ» .env Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸"""
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³
    env_content = [
        "# --- Telegram Bot ---",
        f"BOT_TOKEN={bot_token}",
        f'SDB_CORE_SUPER_ADMINS="{admin_id}"', # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸
        "",
        "# --- Ğ‘Ğ°Ğ·Ğ° Ğ”Ğ°Ğ½Ğ½Ñ‹Ñ… ---"
    ]
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ‘Ğ”
    env_content.append(f'SDB_DB_TYPE="{db_config["type"]}"')
    if db_config["type"] == "sqlite":
        # Ğ”Ğ»Ñ SQLite Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğ¾Ñ‚ Data
        sqlite_relative_path = "Database_files/swiftdevbot.db"
        env_content.append(f'SDB_DB_SQLITE_PATH="{sqlite_relative_path}"')
    else:
        # Ğ”Ğ»Ñ PostgreSQL Ğ¸ MySQL Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ DSN
        driver = "psycopg" if db_config["type"] == "postgresql" else "aiomysql"
        db_url = f"{db_config['type']}+{driver}://{db_config['user']}:{db_config['password']}@"
        db_url += f"{db_config['host']}:{db_config['port']}/{db_config['database']}"
        if db_config["type"] == "mysql":
            db_url += "?charset=utf8mb4"
        
        dsn_var_name = "SDB_DB_PG_DSN" if db_config["type"] == "postgresql" else "SDB_DB_MYSQL_DSN"
        env_content.append(f'{dsn_var_name}="{db_url}"')
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞºÑÑˆĞ°
    env_content.extend([
        "",
        "# --- ĞšÑÑˆ ---",
        f'SDB_CACHE_TYPE="{cache_config["type"]}"'
    ])
    
    # Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞĞ«Ğ™ Ğ‘Ğ›ĞĞš Ğ”Ğ›Ğ¯ REDIS
    if cache_config["type"] == "redis":
        redis_url = f"redis://{cache_config['host']}:{cache_config['port']}/{cache_config['db']}"
        env_content.append(f'SDB_CACHE_REDIS_URL="{redis_url}"')
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ ÑƒĞ´Ğ¾Ğ±ÑÑ‚Ğ²Ğ°
    env_content.extend([
        "",
        "# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¯Ğ´Ñ€Ğ° (Core) ---",
        "# ĞŸÑƒÑ‚ÑŒ Ğº Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ ./Data)",
        "# SDB_CORE_PROJECT_DATA_PATH=\"./Data\"",
        "",
        "# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¯Ğ´Ñ€Ğ° ---",
        'SDB_CORE_LOG_LEVEL="INFO"'
    ])
    
    # Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»
    env_file_path = PROJECT_ROOT / ".env"
    with open(env_file_path, "w", encoding="utf-8") as f:
        f.write("\n".join(env_content))
    print(f"âœ“ Ğ¤Ğ°Ğ¹Ğ» .env ÑĞ¾Ğ·Ğ´Ğ°Ğ½: {env_file_path}")

def _convert_to_serializable(data):
    """Ğ ĞµĞºÑƒÑ€ÑĞ¸Ğ²Ğ½Ğ¾ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹ Ğ² ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·ÑƒĞµĞ¼Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ Ğ´Ğ»Ñ YAML."""
    from pathlib import Path
    
    if isinstance(data, dict):
        return {key: _convert_to_serializable(value) for key, value in data.items()}
    elif isinstance(data, list):
        return [_convert_to_serializable(item) for item in data]
    elif isinstance(data, Path):
        return str(data)
    elif hasattr(data, "__class__") and data.__class__.__name__ in ("HttpUrl", "Url"):
        return str(data)
    else:
        return data

def create_core_settings_file():
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ñ„Ğ°Ğ¹Ğ» core_settings.yaml Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ"""
    print("\nğŸ“ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° core_settings.yaml...")
    
    try:
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Systems Ğ² Ğ¿ÑƒÑ‚ÑŒ Ğ´Ğ»Ñ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ°
        sys.path.insert(0, str(PROJECT_ROOT))
        sys.path.insert(0, str(PROJECT_ROOT / "Systems"))
        
        from Systems.core.app_settings import AppSettings
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
        default_settings = AppSettings(telegram={"token": "dummy"}).model_dump(exclude_defaults=False)
        
        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ĞºĞ»ÑÑ‡Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ² .env
        if "telegram" in default_settings:
            del default_settings["telegram"]
        if "db" in default_settings:
            del default_settings["db"]
        if "core" in default_settings and "super_admins" in default_settings["core"]:
            del default_settings["core"]["super_admins"]
        
        # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹ Ğ² ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·ÑƒĞµĞ¼Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹
        serializable_data = _convert_to_serializable(default_settings)
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¿ÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ
        config_file_path = PROJECT_ROOT / "Data" / "Config" / "core_settings.yaml"
        config_file_path.parent.mkdir(parents=True, exist_ok=True)
        
        # Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ YAML Ñ„Ğ°Ğ¹Ğ»
        with open(config_file_path, "w", encoding="utf-8") as f:
            yaml.dump(serializable_data, f, indent=2, sort_keys=False, allow_unicode=True)
        
        print(f"âœ“ Ğ¤Ğ°Ğ¹Ğ» core_settings.yaml ÑĞ¾Ğ·Ğ´Ğ°Ğ½: {config_file_path}")
        return True
    except Exception as e:
        print(f"âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ core_settings.yaml: {e}")
        print("   Ğ¤Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½ - ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ±ÑƒĞ´ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ñ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ°Ğ¼Ğ¸ Ğ¸ .env")
        return False

def create_project_structure():
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°"""
    print("\nğŸ“ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°...")
    directories = [
        "Data/Config",
        "Data/Database_files",
        "Data/Logs",
        "Modules"
    ]
    
    for directory in directories:
        Path(PROJECT_ROOT / directory).mkdir(parents=True, exist_ok=True)
    print("âœ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°")

def initialize_database():
    """Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
    print("\nğŸ—ƒï¸ Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…...")
    try:
        import alembic.config  # type: ignore[import-untyped]
        alembic_args = [
            '--raiseerr',
            'upgrade', 'head'
        ]
        alembic.config.main(argv=alembic_args)
        print("âœ“ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°")
        return True
    except Exception as e:
        print(f"âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: {e}")
        return False

def main():
    """ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¼Ğ°ÑÑ‚ĞµÑ€Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸"""
    print("ğŸš€ ĞœĞ°ÑÑ‚ĞµÑ€ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ SwiftDevBot\n")
    
    try:
        # Ğ¨Ğ°Ğ³ 1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
        create_and_activate_venv()
        
        # Ğ¨Ğ°Ğ³ 2: Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
        if not install_dependencies():
            sys.exit(1)
        
        # Ğ¨Ğ°Ğ³ 3: Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ±Ğ¾Ñ‚Ğ° Ğ¸ ID Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°
        while True:
            bot_token = input("\nĞ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚Ğ¾ĞºĞµĞ½ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Telegram Ğ±Ğ¾Ñ‚Ğ° (Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñƒ @BotFather): ")
            if validate_bot_token(bot_token):
                break
            print("âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ‚Ğ¾ĞºĞµĞ½Ğ°. ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: 123456789:ABCdefGHIjklMNOpqrsTUVwxyz")
        
        admin_id = get_admin_id("\nĞ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°Ñˆ Telegram ID (Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñƒ @userinfobot): ")
        
        # Ğ¨Ğ°Ğ³ 4: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
        create_project_structure()
        
        # Ğ¨Ğ°Ğ³ 5: ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        db_config = setup_database()
        
        # Ğ¨Ğ°Ğ³ 6: ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
        cache_config = setup_cache()
        
        # Ğ¨Ğ°Ğ³ 7: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°
        create_env_file(bot_token, admin_id, db_config, cache_config)
        
        # Ğ¨Ğ°Ğ³ 8: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ core_settings.yaml
        create_core_settings_file()
        
        # Ğ¨Ğ°Ğ³ 9: Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        if not initialize_database():
            if input("ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºÑƒ Ğ½ĞµÑĞ¼Ğ¾Ñ‚Ñ€Ñ Ğ½Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸? [y/N]: ").lower() != 'y':
                sys.exit(1)
        
        # Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
        print("""
âœ¨ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° SwiftDevBot Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°! âœ¨

Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼:
1. Ğ—Ğ°Ğ¿ÑƒÑĞº:    ./sdb start
2. ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°: ./sdb stop
3. Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:    ./sdb status

Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:
- ./sdb --help   # ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ²ÑĞµÑ… Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
- ./sdb db       # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- ./sdb module   # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸
- ./sdb config   # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸ĞµĞ¹
- ./sdb backup   # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ğ¼Ğ¸ ĞºĞ¾Ğ¿Ğ¸ÑĞ¼Ğ¸

ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ±Ğ¾Ñ‚Ğ° Ğ² Telegram:
/start  - ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼
/help   - ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
/admin  - Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°

Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ: https://github.com/soverxos/SwiftDevBot-Project/blob/main/README.md
""")
        
    except KeyboardInterrupt:
        print("\n\nâŒ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼")
        sys.exit(1)
    except Exception as e:
        print(f"\n\nâŒ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()


======================================================================

------------------------------ FILE: run_bot.py ------------------------------
# run_bot.py
# Ğ­Ñ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ» ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ‚Ğ¾Ñ‡ĞºĞ¾Ğ¹ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Telegram-Ğ±Ğ¾Ñ‚Ğ° SwiftDevBot.

import asyncio
import sys
from pathlib import Path
import os

# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° sys.path Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° 'core' Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° ---
current_script_dir = Path(__file__).resolve().parent
systems_path = current_script_dir / "Systems"
if str(current_script_dir) not in sys.path:
    sys.path.insert(0, str(current_script_dir))
if str(systems_path) not in sys.path:
    sys.path.insert(0, str(systems_path))

# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½ÑƒÑ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ±Ğ¾Ñ‚Ğ° Ğ¸Ğ· ÑĞ´Ñ€Ğ°
try:
    from Systems.core.bot_entrypoint import run_sdb_bot 
except ImportError as e:
    print(f"ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ ĞĞ¨Ğ˜Ğ‘ĞšĞ: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¸Ğ· 'core.bot_entrypoint'.", file=sys.stderr)
    print(f"ĞÑˆĞ¸Ğ±ĞºĞ°: {e}", file=sys.stderr)
    print("Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ²ĞµÑ€Ğ½Ğ° Ğ¸ Ğ²ÑĞµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ ÑĞ´Ñ€Ğ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹.", file=sys.stderr)
    print(f"Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ sys.path: {sys.path}", file=sys.stderr)
    sys.exit(2)

if __name__ == "__main__":
    exit_code: int = 1 

    try:
        exit_code = asyncio.run(run_sdb_bot())
        
        if exit_code == 0:
            if os.environ.get("SDB_SHOULD_WRITE_PID", "false").lower() != "true":
                print("ğŸ¯ SDB Core - Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑˆÑ‚Ğ°Ñ‚Ğ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°!")
        else:
            if os.environ.get("SDB_SHOULD_WRITE_PID", "false").lower() != "true":
                print(f"âŒ SDB Core - Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ° Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹ (ĞºĞ¾Ğ´: {exit_code})", file=sys.stderr)

    except KeyboardInterrupt:
        if os.environ.get("SDB_SHOULD_WRITE_PID", "false").lower() != "true":
            print("\nğŸ”„ SDB Core - Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼ (Ctrl+C). Ğ’Ñ‹Ñ…Ğ¾Ğ´...", file=sys.stderr)
        exit_code = 0 
    except ImportError as e_runtime_import:
        print(f"ĞĞ¨Ğ˜Ğ‘ĞšĞ Ğ˜ĞœĞŸĞĞ Ğ¢Ğ Ğ’Ğ Ğ’Ğ Ğ•ĞœĞ¯ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ¯: {e_runtime_import}", file=sys.stderr)
        print("Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ· Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹.", file=sys.stderr)
        exit_code = 3
    except Exception as e_global:
        print(f"ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ ĞĞ•ĞĞ‘Ğ ĞĞ‘ĞĞ¢ĞĞĞĞĞ¯ ĞĞ¨Ğ˜Ğ‘ĞšĞ ĞĞ Ğ’Ğ•Ğ Ğ¥ĞĞ•Ğœ Ğ£Ğ ĞĞ’ĞĞ•: {type(e_global).__name__}: {e_global}", file=sys.stderr)
        print("Ğ¡Ğ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ñ€ĞµĞ¹ÑĞ±ĞµĞºĞ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸.", file=sys.stderr)
        exit_code = 1
    finally:
        pass

    sys.exit(exit_code)


======================================================================

------------------------------ FILE: pytest.ini ------------------------------
[pytest]
# ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ pytest Ğ´Ğ»Ñ SwiftDevBot

# ĞŸÑƒÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²
testpaths = tests

# ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹
asyncio_mode = auto

# ĞĞ¿Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
addopts = 
    -v
    --strict-markers
    --tb=short
    --disable-warnings

# ĞœĞ°Ñ€ĞºĞµÑ€Ñ‹
markers =
    unit: Unit Ñ‚ĞµÑÑ‚Ñ‹
    integration: Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹
    slow: ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹
    security: Ğ¢ĞµÑÑ‚Ñ‹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
    performance: Ğ¢ĞµÑÑ‚Ñ‹ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

# ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ Python
minversion = 3.12

# Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğ¹
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning




======================================================================

------------------------------ FILE: README.md ------------------------------
# ğŸš€ SwiftDevBot (SDB) - ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ñ‹Ğ¹ Telegram Bot Framework

[![Python Version](https://img.shields.io/badge/python-3.12+-blue.svg)](https://python.org)
[![Aiogram](https://img.shields.io/badge/aiogram-3.22.0-green.svg)](https://aiogram.dev)
[![License](https://img.shields.io/badge/license-MIT-yellow.svg)](LICENSE)
[![GitHub Stars](https://img.shields.io/github/stars/soverxos/SwiftDevBot-Project.svg)](https://github.com/soverxos/SwiftDevBot-Project/stargazers)

**SwiftDevBot** - ÑÑ‚Ğ¾ Ğ¼Ğ¾Ñ‰Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ñ‹Ğ¹ Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Telegram Ğ±Ğ¾Ñ‚Ğ¾Ğ² Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸, RBAC, Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¾Ğ¹ Ğ¸ Ğ±Ğ¾Ğ³Ğ°Ñ‚Ñ‹Ğ¼ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ¼ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸.

## ğŸ“‹ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

- [ğŸŒŸ ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸](#-Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸)
- [âš¡ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚](#-Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹-ÑÑ‚Ğ°Ñ€Ñ‚)
- [ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#ï¸-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
- [ğŸ”§ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°](#-ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°)
- [âš™ï¸ ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ](#ï¸-ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ)
- [ğŸ§© ĞœĞ¾Ğ´ÑƒĞ»Ğ¸](#-Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸)
- [ğŸ›¡ï¸ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ](#ï¸-Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ)
- [ğŸ‘¥ RBAC ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°](#-rbac-ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°)
- [ğŸ“Š CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹](#-cli-ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹)
- [ğŸ—„ï¸ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#ï¸-Ğ±Ğ°Ğ·Ğ°-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
- [ğŸ“ˆ ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³](#-Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³)
- [ğŸ”¨ Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°](#-Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°)
- [ğŸ“š API Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ](#-api-Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ)
- [ğŸ¤ Ğ’ĞºĞ»Ğ°Ğ´ Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚](#-Ğ²ĞºĞ»Ğ°Ğ´-Ğ²-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚)
- [ğŸ“„ Ğ›Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ](#-Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ)

## ğŸŒŸ ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸

### ğŸ¯ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸
- **ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°** - Ğ»ĞµĞ³ĞºĞ¾ Ñ€Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ²
- **RBAC ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°** - Ñ€Ğ¾Ğ»ĞµĞ²Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸
- **ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ğ°Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** - Ñ†Ğ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸, Ğ¿ĞµÑĞ¾Ñ‡Ğ½Ğ¸Ñ†Ğ°, Ğ°ÑƒĞ´Ğ¸Ñ‚
- **ĞœĞ½Ğ¾Ğ³Ğ¾ÑĞ·Ñ‹Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ** - Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° i18n Ğ¸Ğ· ĞºĞ¾Ñ€Ğ¾Ğ±ĞºĞ¸
- **ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ** - Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° async/await
- **CLI ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ** - Ğ±Ğ¾Ğ³Ğ°Ñ‚Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³** - Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- **ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** - Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Redis Ğ¸ Memory ĞºÑÑˆĞ°
- **ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ‘Ğ”** - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Alembic

### ğŸ”’ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ
- **Ğ¦Ğ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹** - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ ĞºĞ¾Ğ´Ğ°
- **ĞŸĞµÑĞ¾Ñ‡Ğ½Ğ¸Ñ†Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ** - Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
- **Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸** - Ğ¾Ñ†ĞµĞ½ĞºĞ° Ğ½Ğ°Ğ´ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
- **ĞÑƒĞ´Ğ¸Ñ‚ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹** - Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
- **Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°** - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ ÑƒĞ³Ñ€Ğ¾Ğ·
- **Ğ”ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹** - Ğ²Ñ‹ÑĞ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸

### ğŸ§© ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
- **Ğ“Ğ¾Ñ€ÑÑ‡Ğ°Ñ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°** - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ±ĞµĞ· Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°
- **Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹** - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
- **Ğ’ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** - Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ÑĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ²ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- **Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹** - Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğµ Ğ·Ğ°Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ¸ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸

## âš¡ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

### ğŸ¤– ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)

**SwiftDevBot** Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ğ² ÑĞµĞ±Ñ ÑƒĞ´Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ¼Ğ°ÑÑ‚ĞµÑ€ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ Ğ²ÑÑ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:

```bash
# 1. ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
git clone https://github.com/soverxos/SwiftDevBot-Project.git
cd SwiftDevBot-Project

# 2. Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¼Ğ°ÑÑ‚ĞµÑ€Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
python3 sdb_setup.py
```

ĞœĞ°ÑÑ‚ĞµÑ€ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸:
- âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°ÑÑ‚ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ
- âœ… Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ Ğ²ÑĞµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
- âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (SQLite/PostgreSQL/MySQL)
- âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Memory/Redis)
- âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°ÑÑ‚ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
- âœ… Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°ÑÑ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» `.env`

**Ğ’Ğ°Ğ¼ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾:**
- Ğ¢Ğ¾ĞºĞµĞ½ Ğ±Ğ¾Ñ‚Ğ° Ğ¾Ñ‚ [@BotFather](https://t.me/BotFather)
- Ğ’Ğ°Ñˆ Telegram ID (Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñƒ [@userinfobot](https://t.me/userinfobot))

### ğŸ”§ Ğ ÑƒÑ‡Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°

Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ğ¿Ñ€ĞµĞ´Ğ¿Ğ¾Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚Ğµ Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºÑƒ Ğ¸Ğ»Ğ¸ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾:

#### 1. ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
```bash
git clone https://github.com/soverxos/SwiftDevBot-Project.git
cd SwiftDevBot-Project
```

#### 2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
```bash
python3 -m venv .venv
source .venv/bin/activate  # Linux/Mac
# Ğ¸Ğ»Ğ¸
.venv\Scripts\activate     # Windows
```

#### 3. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
```bash
pip install -r requirements.txt
```

#### 4. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸
```bash
cp env.example .env
# ĞÑ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ .env Ñ„Ğ°Ğ¹Ğ», Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ² Ğ²Ğ°Ñˆ BOT_TOKEN
```

#### 5. Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
```bash
python3 sdb.py db init
python3 sdb.py db migrate
```

### 6. Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ±Ğ¾Ñ‚Ğ°
```bash
python3 sdb.py run
```

### 7. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
```bash
python3 sdb.py status
```

## ğŸ“ Ğ”Ğ»Ñ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ÑÑ‰Ğ¸Ñ… Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²

Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ñ SwiftDevBot, ÑÑ‚Ğ¾Ñ‚ Ñ€Ğ°Ğ·Ğ´ĞµĞ» Ğ¿Ğ¾Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²Ğ°Ğ¼ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¹ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¸ Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ğ¸.

### ğŸš€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ "Hello World"

Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ´Ğ¸Ğ¼ Ğ¿Ñ€Ğ¾ÑÑ‚ĞµĞ¹ÑˆĞ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ½Ğ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ `/hello`:

#### Ğ¨Ğ°Ğ³ 1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
```bash
python3 sdb.py module create hello_world --enable
```

Ğ­Ñ‚Ğ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ² `Modules/hello_world/`.

#### Ğ¨Ğ°Ğ³ 2: Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ

ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» `Modules/hello_world/__init__.py` Ğ¸ Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ ĞµĞ³Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ğ½Ğ°:

```python
from aiogram import Router, types
from aiogram.filters import Command

router = Router()

@router.message(Command("hello"))
async def hello_handler(message: types.Message):
    """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ /hello"""
    await message.answer("ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, Ğ¼Ğ¸Ñ€! ğŸ‘‹")

async def setup_module(dp, bot, services):
    """Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ - Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ"""
    dp.include_router(router)
    print("âœ… ĞœĞ¾Ğ´ÑƒĞ»ÑŒ hello_world Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½!")
```

#### Ğ¨Ğ°Ğ³ 3: Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ±Ğ¾Ñ‚Ğ°
```bash
python3 sdb.py run
```

#### Ğ¨Ğ°Ğ³ 4: Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ Ğ±Ğ¾Ñ‚Ñƒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ `/hello` Ğ² Telegram. Ğ‘Ğ¾Ñ‚ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚ÑŒ "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, Ğ¼Ğ¸Ñ€! ğŸ‘‹"

### ğŸ“š ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ğ¸ (ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ¾)

#### 1. **DI (Dependency Injection) - Ğ’Ğ½ĞµĞ´Ñ€ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹**
Ğ’Ğ¼ĞµÑÑ‚Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ, Ğ¼Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ñ… "Ğ¸Ğ·Ğ²Ğ½Ğµ". Ğ­Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚ ĞºĞ¾Ğ´ Ğ±Ğ¾Ğ»ĞµĞµ Ğ³Ğ¸Ğ±ĞºĞ¸Ğ¼ Ğ¸ Ñ‚ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¼.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:** Ğ’Ğ¼ĞµÑÑ‚Ğ¾ `db = Database()` Ğ¼Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ `db` Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:
```python
async def my_handler(message: types.Message, db: Database):
    # db ÑƒĞ¶Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    users = await db.get_users()
```

#### 2. **Pydantic - Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…**
Pydantic Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ñ‡Ñ‚Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ğ¾Ğ¼Ñƒ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñƒ.

**ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€:**
```python
from pydantic import BaseModel

class User(BaseModel):
    name: str
    age: int

# ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚, Ñ‡Ñ‚Ğ¾ name - ÑÑ‚Ñ€Ğ¾ĞºĞ°, age - Ñ‡Ğ¸ÑĞ»Ğ¾
user = User(name="Ğ˜Ğ²Ğ°Ğ½", age=25)
```

#### 3. **Alembic - ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…**
Alembic Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ÑÑ‚ÑŒ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾.

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:**
```bash
python3 sdb.py db migrate    # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ
python3 sdb.py db upgrade    # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ…ĞµĞ¼Ñƒ Ğ‘Ğ”
```

**Ğ§Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚:** ĞšĞ¾Ğ³Ğ´Ğ° Ğ²Ñ‹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚Ğµ Ğ½Ğ¾Ğ²ÑƒÑ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ»Ğµ Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸, Alembic ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ Ğ²Ğ°ÑˆÑƒ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….

#### 4. **React (Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸)**
React - ÑÑ‚Ğ¾ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ¾Ğ². Ğ’ SwiftDevBot Ğ¾Ğ½Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ.

**Ğ”Ğ»Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼ React Ğ½Ğµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½** - Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Telegram Ğ±Ğ¾Ñ‚Ğ°.

### ğŸ¯ Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸

1. **Ğ˜Ğ·ÑƒÑ‡Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹:**
   - `Modules/example_module/` - Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ñ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
   - `Modules/sys_status/` - ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ

2. **ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ¹Ñ‚Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ:**
   - [Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ](#-Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸) - Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾
   - [API Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ](#-api-Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ) - ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¿Ğ¾ ĞºĞ»Ğ°ÑÑĞ°Ğ¼

3. **Ğ­ĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ:**
   - Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ² ÑĞ²Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
   - ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ñ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
   - Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¸

### â“ Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹

**Q: ĞÑƒĞ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ·Ğ½Ğ°Ñ‚ÑŒ Ğ²ÑĞµ ÑÑ‚Ğ¸ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸ ÑÑ€Ğ°Ğ·Ñƒ?**  
A: ĞĞµÑ‚! ĞĞ°Ñ‡Ğ½Ğ¸Ñ‚Ğµ Ñ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ±ĞµĞ· Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. Ğ˜Ğ·ÑƒÑ‡Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¾ Ğ¼ĞµÑ€Ğµ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸.

**Q: Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ, ĞµÑĞ»Ğ¸ Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚?**  
A: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸: `python3 sdb.py monitor logs`. Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¸Ğ½ÑÑ‚Ğ²Ğ¾ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ñ‚Ğ°Ğ¼ Ğ²Ğ¸Ğ´Ğ½Ñ‹.

**Q: ĞšĞ°Ğº Ğ¾Ñ‚Ğ»Ğ°Ğ´Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ?**  
A: Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ±Ğ¾Ñ‚Ğ° Ñ Ñ„Ğ»Ğ°Ğ³Ğ¾Ğ¼ `--debug`: `python3 sdb.py run --debug`

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
SwiftDevBot/
â”œâ”€â”€ core/                    # Ğ¯Ğ´Ñ€Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
â”‚   â”œâ”€â”€ app_settings.py      # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸
â”‚   â”œâ”€â”€ bot_entrypoint.py    # Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ±Ğ¾Ñ‚Ğ°
â”‚   â”œâ”€â”€ services_provider.py # ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
â”‚   â”œâ”€â”€ module_loader.py     # Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ñ‡Ğ¸Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
â”‚   â”œâ”€â”€ database/            # Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ‘Ğ”
â”‚   â”œâ”€â”€ security/            # Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
â”‚   â”œâ”€â”€ rbac/                # Ğ Ğ¾Ğ»ĞµĞ²Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ
â”‚   â”œâ”€â”€ users/               # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸
â”‚   â”œâ”€â”€ cache/               # Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
â”‚   â”œâ”€â”€ events/              # Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
â”‚   â””â”€â”€ ui/                  # UI ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”œâ”€â”€ cli/                     # CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
â”‚   â”œâ”€â”€ run.py              # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ¼
â”‚   â”œâ”€â”€ config.py           # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”‚   â”œâ”€â”€ module.py           # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸
â”‚   â”œâ”€â”€ user.py             # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸
â”‚   â”œâ”€â”€ security.py         # Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Modules/                 # ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
â”‚   â”œâ”€â”€ sys_status/         # Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
â”‚   â”œâ”€â”€ example_module/     # ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
â”‚   â””â”€â”€ ...
â”œâ”€â”€ project_data/            # Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
â”‚   â”œâ”€â”€ Database_files/      # Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
â”‚   â”œâ”€â”€ Config/              # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸
â”‚   â”œâ”€â”€ Security/            # ĞšĞ»ÑÑ‡Ğ¸ Ğ¸ Ğ°ÑƒĞ´Ğ¸Ñ‚
â”‚   â””â”€â”€ Logs/                # Ğ›Ğ¾Ğ³Ğ¸
â”œâ”€â”€ Docs/                    # Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
â”œâ”€â”€ locales/                 # ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
â””â”€â”€ alembic/                 # ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ‘Ğ”
```

## ğŸ”§ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°

### Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- Python 3.12+
- SQLite/PostgreSQL/MySQL
- Redis (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

### ğŸš€ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ°ÑÑ‚ĞµÑ€ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸:

```bash
# ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ¼Ğ°ÑÑ‚ĞµÑ€Ğ°
git clone https://github.com/soverxos/SwiftDevBot-Project.git
cd SwiftDevBot-Project
python3 sdb_setup.py
```

ĞœĞ°ÑÑ‚ĞµÑ€ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸:
- Ğ¡Ğ¾Ğ·Ğ´Ğ°ÑÑ‚ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ
- Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ Ğ²ÑĞµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¸Ğ· `requirements.txt`
- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
- Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### ğŸ“¦ Ğ ÑƒÑ‡Ğ½Ğ°Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹

#### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ°ĞºĞµÑ‚Ñ‹
```bash
pip install aiogram python-dotenv typer pydantic pydantic-settings
pip install PyYAML ruamel.yaml loguru aiohttp requests
pip install SQLAlchemy[asyncio] alembic aiosqlite psycopg[binary] aiomysql
pip install cachetools rich psutil uvicorn
```

#### Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ°ĞºĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
```bash
pip install pytest pylint sphinx coverage black isort mypy
pip install cryptography aioredis redis packaging parsedatetime apscheduler
```

### ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ

1. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» `.env`**:
```env
# Telegram Bot
BOT_TOKEN=your_bot_token_here
SDB_CORE_SUPER_ADMINS="your_telegram_id"

# Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
SDB_DB_TYPE="sqlite"
SDB_DB_SQLITE_PATH="Database_files/swiftdevbot.db"

# ĞšÑÑˆ
SDB_CACHE_TYPE="memory"

# Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
SDB_CORE_LOG_LEVEL="INFO"
```

2. **Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…**:
```bash
python3 sdb.py db init
python3 sdb.py db migrate
```

## âš™ï¸ ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

### ğŸ¤– ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ°ÑÑ‚ĞµÑ€ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸** `sdb_setup.py` Ğ´Ğ»Ñ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸:

```bash
python3 sdb_setup.py
```

ĞœĞ°ÑÑ‚ĞµÑ€ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚:
- Ğ¢Ğ¾ĞºĞµĞ½ Ğ±Ğ¾Ñ‚Ğ° Ğ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²
- Ğ¢Ğ¸Ğ¿ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (SQLite/PostgreSQL/MySQL)
- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (Memory/Redis)
- Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
- ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» `.env`

### ğŸ”§ Ğ ÑƒÑ‡Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸

#### Telegram Bot
```env
BOT_TOKEN=your_bot_token_here
SDB_TELEGRAM_POLLING_TIMEOUT=30
```

#### Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
```env
# SQLite (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)
SDB_DB_TYPE="sqlite"
SDB_DB_SQLITE_PATH="Database_files/swiftdevbot.db"

# PostgreSQL
SDB_DB_TYPE="postgresql"
SDB_DB_POSTGRES_HOST="localhost"
SDB_DB_POSTGRES_PORT="5432"
SDB_DB_POSTGRES_DB="swiftdevbot"
SDB_DB_POSTGRES_USER="user"
SDB_DB_POSTGRES_PASSWORD="password"

# MySQL
SDB_DB_TYPE="mysql"
SDB_DB_MYSQL_HOST="localhost"
SDB_DB_MYSQL_PORT="3306"
SDB_DB_MYSQL_DB="swiftdevbot"
SDB_DB_MYSQL_USER="user"
SDB_DB_MYSQL_PASSWORD="password"
```

#### ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
```env
# Memory ĞºÑÑˆ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)
SDB_CACHE_TYPE="memory"

# Redis ĞºÑÑˆ
SDB_CACHE_TYPE="redis"
SDB_CACHE_REDIS_HOST="localhost"
SDB_CACHE_REDIS_PORT="6379"
SDB_CACHE_REDIS_DB="0"
SDB_CACHE_REDIS_PASSWORD=""
```

#### Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ
```env
SDB_SECURITY_LEVEL="moderate"  # strict, moderate, permissive
SDB_SECURITY_SIGNATURE_REQUIRED="true"
SDB_SECURITY_SANDBOX_ENABLED="true"
```

### Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» `project_data/Config/core_settings.yaml` Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸:

```yaml
core:
  sdb_version: "0.1.0"
  project_data_path: "./project_data"
  log_level: "INFO"
  super_admins: [123456789]
  
telegram:
  token: "your_bot_token"
  polling_timeout: 30
  
database:
  type: "sqlite"
  sqlite_path: "Database_files/swiftdevbot.db"
  
cache:
  type: "memory"
  default_ttl: 300
  
security:
  level: "moderate"
  signature_required: true
  sandbox_enabled: true
```

## ğŸ§© ĞœĞ¾Ğ´ÑƒĞ»Ğ¸

### Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ

1. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ**:
```bash
mkdir Modules/my_module
cd Modules/my_module
```

2. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ** (`manifest.yaml`):
```yaml
name: "my_module"
version: "1.0.0"
display_name: "ĞœĞ¾Ğ¹ ĞœĞ¾Ğ´ÑƒĞ»ÑŒ"
description: "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"
author: "Ğ’Ğ°ÑˆĞµ Ğ˜Ğ¼Ñ"
license: "MIT"

permissions:
  - name: "my_module.access"
    description: "Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"
    default_roles: ["User"]

settings:
  - name: "enabled"
    type: "boolean"
    default: true
    description: "Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ"
```

3. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ** (`__init__.py`):
```python
from aiogram import Router, types
from aiogram.filters import Command
from core.schemas.module_manifest import ModuleManifest

router = Router()

@router.message(Command("mymodule"))
async def my_module_handler(message: types.Message):
    await message.answer("ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ Ğ¸Ğ· Ğ¼Ğ¾ĞµĞ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ!")

async def setup_module(dp, bot, manifest: ModuleManifest):
    """ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
    dp.include_router(router)
    print(f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {manifest.name} Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½!")
```

### ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ

```bash
# ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ²ÑĞµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
python3 sdb.py module list

# ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
python3 sdb.py module enable my_module

# Ğ”ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
python3 sdb.py module disable my_module

# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ (Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ€ĞµÑÑ‚Ğ°Ñ€Ñ‚ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ±Ğ¾Ñ‚Ğ°)
python3 sdb.py module reload my_module
```

### Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸

- **sys_status** - Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸
- **example_module** - Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ñ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¼ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ¾Ğ¼
- **universal_module_template** - ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹

## ğŸ›¡ï¸ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Ğ¦Ğ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸

Ğ’ÑĞµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹ Ñ†Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒÑ:

```bash
# Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ°
python3 sdb.py security generate-key

# ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
python3 sdb.py security sign-module my_module

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸
python3 sdb.py security verify-module my_module
```

### ĞŸĞµÑĞ¾Ñ‡Ğ½Ğ¸Ñ†Ğ°

ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ Ğ² Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¹ ÑÑ€ĞµĞ´Ğµ Ñ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸:

- **Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 1**: ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸)
- **Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 2**: ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ
- **Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 3**: Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸
- **Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 4**: ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ

### ĞÑƒĞ´Ğ¸Ñ‚

Ğ’ÑĞµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒÑÑ‚ÑÑ:

```bash
# ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°
python3 sdb.py security audit-logs

# ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ² ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
python3 sdb.py security audit-logs --user 123456789
```

## ğŸ‘¥ RBAC ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°

### Ğ Ğ¾Ğ»Ğ¸ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ

- **Admin** - Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ ĞºĞ¾ Ğ²ÑĞµĞ¼ Ñ„ÑƒĞ½ĞºÑ†Ğ¸ÑĞ¼
- **Moderator** - ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸ Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸
- **User** - Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸

### Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸

```bash
# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸
python3 sdb.py user create-role "CustomRole"

# ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹
python3 sdb.py user assign-permission CustomRole my_module.access

# ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
python3 sdb.py user assign-role 123456789 CustomRole
```

### Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ:

- `core.admin.*` - Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
- `core.modules.*` - ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸
- `core.users.*` - ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸
- `module_name.action` - Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ

## ğŸ“Š CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

### Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼
```bash
python3 sdb.py run              # Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ±Ğ¾Ñ‚Ğ°
python3 sdb.py start            # ĞŸÑĞµĞ²Ğ´Ğ¾Ğ½Ğ¸Ğ¼ Ğ´Ğ»Ñ run
python3 sdb.py stop             # ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ±Ğ¾Ñ‚Ğ°
python3 sdb.py restart          # ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº Ğ±Ğ¾Ñ‚Ğ°
python3 sdb.py status           # Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ¾Ñ‚Ğ°
```

### ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
```bash
python3 sdb.py config init      # Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°
python3 sdb.py config get        # ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
python3 sdb.py config set key value  # Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
```

### Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
```bash
python3 sdb.py db init          # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ”
python3 sdb.py db migrate        # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
python3 sdb.py db upgrade        # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ…ĞµĞ¼Ñƒ
python3 sdb.py db downgrade      # ĞÑ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ
```

### ĞœĞ¾Ğ´ÑƒĞ»Ğ¸
```bash
python3 sdb.py module list       # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
python3 sdb.py module enable name    # ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
python3 sdb.py module disable name   # Ğ”ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
python3 sdb.py module reload name     # ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ (Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ€ĞµÑÑ‚Ğ°Ñ€Ñ‚ Ğ±Ğ¾Ñ‚Ğ°)
python3 sdb.py module install path   # Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
```

### ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸
```bash
python3 sdb.py user list         # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
python3 sdb.py user create       # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
python3 sdb.py user delete id    # Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
python3 sdb.py user assign-role user_id role  # ĞĞ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ
```

### Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ
```bash
python3 sdb.py security status   # Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
python3 sdb.py security scan     # Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
python3 sdb.py security audit-logs  # Ğ›Ğ¾Ğ³Ğ¸ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°
python3 sdb.py security generate-key  # Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ°
```

### ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³
```bash
python3 sdb.py monitor stats     # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
python3 sdb.py monitor logs      # ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ²
python3 sdb.py monitor performance  # ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
```

### Ğ‘ÑĞºĞ°Ğ¿Ñ‹
```bash
python3 sdb.py backup create     # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ±ÑĞºĞ°Ğ¿
python3 sdb.py backup list       # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²
python3 sdb.py backup restore id # Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ±ÑĞºĞ°Ğ¿
```

## ğŸ—„ï¸ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¡Ğ£Ğ‘Ğ”

- **SQLite** (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ) - Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¸ Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ²
- **PostgreSQL** - Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğ°
- **MySQL** - Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ° PostgreSQL

### ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Alembic Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸:

```bash
# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
python3 sdb.py db create-migration "description"

# ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
python3 sdb.py db migrate

# ĞÑ‚ĞºĞ°Ñ‚ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
python3 sdb.py db downgrade
```

### Ğ¡Ñ…ĞµĞ¼Ğ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹:
- `sdb_users` - Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸
- `sdb_roles` - Ñ€Ğ¾Ğ»Ğ¸
- `sdb_permissions` - Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ
- `sdb_user_roles` - ÑĞ²ÑĞ·Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸ Ñ€Ğ¾Ğ»ĞµĞ¹
- `sdb_role_permissions` - ÑĞ²ÑĞ·Ğ¸ Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹
- `alembic_version` - Ğ²ĞµÑ€ÑĞ¸Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹

## ğŸ“ˆ ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³

### Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ

```bash
# ĞĞ±Ñ‰Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
python3 sdb.py monitor stats

# ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
python3 sdb.py monitor performance

# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
python3 sdb.py monitor resources
```

### Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Loguru Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ğ¾Ğ³Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:

- **ĞšĞ¾Ğ½ÑĞ¾Ğ»ÑŒĞ½Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸** - Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
- **Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸** - Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğ°
- **Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸** - Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°
- **Ğ Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ²** - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ°

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸

Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸:
- ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
- ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
- ĞÑˆĞ¸Ğ±ĞºĞ¸ Ğ¸ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ

## ğŸ”¨ Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°

### ğŸš€ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²

1. **ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°**:
```bash
git clone https://github.com/soverxos/SwiftDevBot-Project.git
cd SwiftDevBot-Project
python3 sdb_setup.py  # ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°
```

2. **Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸**:
```bash
python3 sdb.py run --debug
```

### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
core/
â”œâ”€â”€ app_settings.py      # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
â”œâ”€â”€ bot_entrypoint.py    # Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ±Ğ¾Ñ‚Ğ°
â”œâ”€â”€ services_provider.py # ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
â”œâ”€â”€ module_loader.py     # Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ñ‡Ğ¸Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
â”œâ”€â”€ database/            # Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ‘Ğ”
â”‚   â”œâ”€â”€ manager.py       # ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ‘Ğ”
â”‚   â””â”€â”€ models.py        # ĞœĞ¾Ğ´ĞµĞ»Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
â”œâ”€â”€ security/            # Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ
â”‚   â”œâ”€â”€ signature_manager.py  # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑĞ¼Ğ¸
â”‚   â”œâ”€â”€ sandbox_manager.py    # ĞŸĞµÑĞ¾Ñ‡Ğ½Ğ¸Ñ†Ğ°
â”‚   â””â”€â”€ audit_logger.py       # ĞÑƒĞ´Ğ¸Ñ‚
â””â”€â”€ ...
```

### Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

1. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹** Ğ² `cli/`:
```python
import typer
from core.app_settings import load_app_settings

app = typer.Typer(name="mycommand", help="ĞœĞ¾Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°")

@app.command()
def my_action():
    """ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ"""
    settings = load_app_settings()
    print("Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ...")

if __name__ == "__main__":
    app()
```

2. **Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ** Ğ² `sdb.py`:
```python
from cli.mycommand import app as mycommand_app
cli_main_app.add_typer(mycommand_app, name="mycommand")
```

### Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```bash
# Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚ĞµÑÑ‚Ğ¾Ğ²
python3 -m pytest
# Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ Ğ´Ğ»Ñ Ğ²ĞµĞ± API (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `.venv` Ğ¸ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹)
make web-test

# Ğ¢ĞµÑÑ‚Ñ‹ Ñ Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸ĞµĞ¼
python3 -m pytest --cov=core

# ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚
python3 -m pytest tests/test_module_loader.py
```

### Ğ›Ğ¸Ğ½Ñ‚Ğ¸Ğ½Ğ³

```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ´Ğ°
python3 -m pylint core/
python3 -m black core/
python3 -m isort core/
python3 -m mypy core/
```

## ğŸ“š API Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ»Ğ°ÑÑÑ‹

#### BotServicesProvider
Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸:
```python
from core.services_provider import BotServicesProvider
from core.app_settings import load_app_settings

settings = load_app_settings()
services = BotServicesProvider(settings)
await services.setup_services()

# Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼
db_manager = services._db_manager
module_loader = services._module_loader
```

#### ModuleLoader
Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸:
```python
# ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ
module_info = module_loader.get_module_info("module_name")

# ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
all_modules = module_loader.get_all_modules_info()

# Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
loaded_modules = module_loader.get_loaded_modules_info()
```

#### AppSettings
Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸:
```python
from core.app_settings import load_app_settings

settings = load_app_settings()
print(settings.telegram.token)
print(settings.db.type)
print(settings.core.super_admins)
```

### Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹:

```python
from core.events.dispatcher import EventDispatcher

# ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ½Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ
@event_dispatcher.on("user_registered")
async def on_user_registered(user_id: int):
    print(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½")

# ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
await event_dispatcher.emit("user_registered", user_id=123456789)
```

### ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```python
from core.cache.manager import CacheManager

# Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² ĞºÑÑˆ
await cache_manager.set("key", "value", ttl=300)

# ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· ĞºÑÑˆĞ°
value = await cache_manager.get("key")

# Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· ĞºÑÑˆĞ°
await cache_manager.delete("key")
```

### ğŸŒ Web API (Dashboard)

#### Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸

Ğ’ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ² `.env` Ñ„Ğ°Ğ¹Ğ»Ğµ:

```env
# ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
SDB_WEB_HOST="0.0.0.0"        # Ğ¥Ğ¾ÑÑ‚ (0.0.0.0 Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° ÑĞ¾ Ğ²ÑĞµÑ… Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ¾Ğ²)
SDB_WEB_PORT=8000              # ĞŸĞ¾Ñ€Ñ‚
SDB_WEB_RELOAD=false           # ĞĞ²Ñ‚Ğ¾Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° (Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸)
SDB_WEB_WORKERS=1              # ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ğ¾Ñ€ĞºĞµÑ€Ğ¾Ğ²
SDB_WEB_TOKEN_LIFETIME_MINUTES=60  # Ğ’Ñ€ĞµĞ¼Ñ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ JWT Ñ‚Ğ¾ĞºĞµĞ½Ğ°
```

ĞŸĞ¾ÑĞ»Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ `.env` Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ:
```bash
python3 sdb.py web start
```

Ğ’ÑĞµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ²Ğ·ÑÑ‚Ñ‹ Ğ¸Ğ· `.env`. ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ (`--host`, `--port` Ğ¸ Ñ‚.Ğ´.) Ğ¸Ğ¼ĞµÑÑ‚ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ Ğ½Ğ°Ğ´ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ.

#### API Endpoints

- `GET /api/users` â€” Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ñ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸, Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€ĞºĞ°Ğ¼Ğ¸ Ğ¸ Ñ„Ğ»Ğ°Ğ³Ğ¾Ğ¼ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸.
- `POST /api/users/{id}/block` â€” Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ `{ "block": true|false }`, Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ `is_bot_blocked` Ğ² Ğ‘Ğ” Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ.
- `GET /api/modules` â€” Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ… (Ğ¸Ğ¼Ñ, ÑÑ‚Ğ°Ñ‚ÑƒÑ, Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ, Ğ²ĞµÑ€ÑĞ¸Ñ, Ğ¿Ñ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğº ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¼).
- `POST /api/modules/{name}/toggle` â€” Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚/Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½ Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ `enabled_modules.json`, ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°.
- Ğ”Ğ»Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ² Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ `make web-test`: ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ `.venv` Ğ¸ Ğ¿Ñ€Ğ¾Ğ³Ğ¾Ğ½ÑĞµÑ‚ `tests/test_web_app.py`, ÑƒĞ±ĞµĞ¶Ğ´Ğ°ÑÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ñ Ğ·Ğ°Ğ³Ğ»ÑƒÑˆĞºĞ°Ğ¼Ğ¸ `DummyServices`.

## ğŸ“– ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ¿Ğ¾ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğµ

### âš™ï¸ ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ

1. ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹ Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ:
   ```bash
   git clone https://github.com/soverxos/SwiftDevBot-Project.git
   cd SwiftDevBot-Project
   python3 -m venv .venv
   source .venv/bin/activate
   ```
2. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:
   ```bash
   pip install -r requirements.txt
   ```
   Ğ”Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¸ Ñ‚ĞµÑÑ‚Ğ¾Ğ² Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ğ¹Ñ‚Ğµ `make dev`, Ğ¾Ğ½ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ `pytest`, `pytest-asyncio`, `pylint`, `black`, `isort`, `mypy`.
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ `.env` Ğ½Ğ° Ğ±Ğ°Ğ·Ğµ `env.example` Ğ¸ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ ĞºĞ»ÑÑ‡Ğ¸:
   - `BOT_TOKEN` (Ğ¾Ñ‚ @BotFather)
   - `SDB_CORE_SUPER_ADMINS` (ÑĞ¿Ğ¸ÑĞ¾Ğº Telegram ID)
   - `SDB_DB_TYPE` + Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ´Ğ»Ñ SQLite/PostgreSQL/MySQL
   - `SDB_CACHE_TYPE` (`memory` Ğ¸Ğ»Ğ¸ `redis`)
   - `SDB_WEB_HOST` Ğ¸ `SDB_WEB_PORT` (Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸, Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ `127.0.0.1:8000`)
   - ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾: Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ (`SDB_SECURITY_LEVEL`, `SDB_SECURITY_SIGNATURE_REQUIRED`, `SDB_SECURITY_SANDBOX_ENABLED`)

### ğŸ› ï¸ ĞĞ±Ñ‰Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ CLI

- `python3 sdb.py run` / `make run` â€” ÑÑ‚Ğ°Ñ€Ñ‚ Ğ±Ğ¾Ñ‚Ğ° (Ñ Ğ½Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ»Ğ¾Ğ³Ğ°Ğ¼Ğ¸).
- `make run-verbose` / `make run-debug` â€” Ğ·Ğ°Ğ¿ÑƒÑĞº Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¼Ğ¸ Ğ»Ğ¾Ğ³Ğ°Ğ¼Ğ¸.
- `python3 sdb.py status` â€” Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ (PID, uptime).
- `python3 sdb.py stop` / `restart` â€” ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ¼.
- `python3 sdb.py db init/migrate/upgrade` â€” ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸.
- `python3 sdb.py module list|enable|disable|reload <module>` â€” Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸.
- `python3 sdb.py user list|block|unblock|role <id>` â€” ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸.
- `python3 sdb.py security keys|sign` â€” Ñ†Ğ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸.
- `python3 sdb.py config init` â€” Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¼Ğ°ÑÑ‚ĞµÑ€, ĞºĞ°Ğº Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ° Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞµ.
- `python3 sdb.py web start` â€” Ğ·Ğ°Ğ¿ÑƒÑĞº web-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ (Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¸Ğ· `.env`: `SDB_WEB_HOST`, `SDB_WEB_PORT` Ğ¸ Ñ‚.Ğ´.).

Ğ’ÑĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¿Ñ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ `pytest tests/test_cli.py` â€” ÑÑ‚Ğ¾Ñ‚ Ñ‚ĞµÑÑ‚ Ñ€ĞµĞºÑƒÑ€ÑĞ¸Ğ²Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ±Ğ¸Ñ€Ğ°ĞµÑ‚ `cli_main_app.registered_groups` Ğ¸ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ `--help` Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¿ÑƒÑ‚Ğ¸. Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°Ğ¹Ñ‚Ğµ ĞµĞ³Ğ¾ Ğ¿ĞµÑ€ĞµĞ´ Ñ€ĞµĞ»Ğ¸Ğ·Ğ¾Ğ¼, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° CLI Ğ½Ğµ ÑĞ»Ğ¾Ğ¼Ğ°Ğ»Ğ°ÑÑŒ:
```bash
pytest tests/test_cli.py
```

### ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ CI

- `make test` â€” Ğ¿Ñ€Ğ¾Ğ³Ğ¾Ğ½ÑÑÑ‚ÑÑ Ğ²ÑĞµ Ñ‚ĞµÑÑ‚Ñ‹ (`pytest tests/ -v`). Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `pytest-asyncio`, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğµ `TestHealthChecker`.
- `make web-test` â€” Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ `.venv` Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ `tests/test_web_app.py` (FastAPI + DummySession).
- `pytest tests/test_web_app.py` â€” Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ‚ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ´Ğ»Ñ Ñ„Ğ¾ĞºÑƒÑĞ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ API.
- `make test-cov` â€” Ñ‚ĞµÑÑ‚Ñ‹ Ñ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ¾Ğ¼ Ğ¿Ğ¾ Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ.
- CI (GitHub Actions) Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ `make test` + `make web-test`, Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒÑ, Ñ‡Ñ‚Ğ¾ `pytest-asyncio` Ğ¸ `httpx` ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¸ Ñ‡Ñ‚Ğ¾ API ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚.

### ğŸ”„ Web-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ¸ API

1. ĞŸĞµÑ€ĞµĞ¹Ğ´Ğ¸Ñ‚Ğµ Ğ² Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ `Systems/web`.
2. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ `npm install`.
3. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ²ĞµĞ±-ÑĞµÑ€Ğ²ĞµÑ€ `npm run dev` Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·ÑƒĞ¹Ñ‚ĞµÑÑŒ Ğ¿Ğ¾ Ñ‚Ğ¾ĞºĞµĞ½Ñƒ Ğ¸Ğ· `.env`.
4. Ğ’ĞµĞ±-ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ `Users` Ğ¸ `Modules` Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğµ API (Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°/Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹).
5. ĞŸĞ¾ÑĞ»Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹/Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ `ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ`, ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ÑÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‡ĞµÑ€ĞµĞ· `loadUsers/loadModules`.

### ğŸ“¦ Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ Ñ‡ĞµÑ€ĞµĞ· `python3 sdb.py module create my_module`.
2. ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚Ğµ `manifest.yaml` Ñ `permissions`, `dependencies`, `version`.
3. Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ² `setup_module`.
4. ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ `python3 sdb.py module enable my_module`, Ğ·Ğ°Ñ‚ĞµĞ¼ `reload`.
5. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ `CryptoManager` Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸: ĞºĞ»ÑÑ‡Ğ¸ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚Ğµ Ğ² `project_data/Security/crypto_keys`.

### ğŸ§­ Ğ›Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚

1. ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ»ĞµĞ¶Ğ°Ñ‚ Ğ² `Systems/locales/{ru,en,ua}.yaml`.
2. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹Ñ‚Ğµ ĞºĞ»ÑÑ‡Ğ¸ Ğ² `admin_texts`, `roles_texts`, `users_texts` Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞ¹Ñ‚Ğµ `Systems/core/admin/...` Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸.
3. Ğ’ Ğ²ĞµÑ€ÑĞ¸ÑÑ… Ğ±Ğ¾Ñ‚Ğ¾Ğ² Ñ‚ĞµĞºÑÑ‚Ñ‹ Ñ‡Ğ¸Ñ‚Ğ°ÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· `Translator` (i18n middleware); Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ `admin_texts.get("key")` Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ğ¶ĞµÑÑ‚ĞºĞ¾Ğ³Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ°.

### ğŸ§¹ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ°

- `make clean` Ğ¾Ñ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ `.pytest_cache`, `.mypy_cache`, `__pycache__`.
- `make lint` Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ `pylint` Ğ½Ğ° `Systems/core`.
- `make format`/`make format-check` Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ `black` Ğ¸ `isort`.
- `make type-check` â€” ÑÑ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° `mypy`.
- Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¸ API Ğ² README/Docs Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞ¹Ñ‚Ğµ CHANGELOG.md.

### ğŸ§° Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ CI

- `.github/workflows/ci.yml` ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ `.venv`, `pytest-asyncio`, `httpx`, Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ `pytest tests/ -v` Ğ¸ `pytest tests/test_web_app.py -v`.
- `make web-test` Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ² CI, Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚Ğµ `tests/test_web_app.py` Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸.
- Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°Ğ¹Ñ‚Ğµ `make test` Ğ¸ `make web-test` Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ´ Ğ¿ÑƒÑˆĞµĞ¼.

### ğŸ’¬ Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸ Ñ„Ğ¸ĞºÑÑ‚ÑƒÑ€Ñ‹

- `tests/conftest.py` Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ Ñ„Ğ¸ĞºÑÑ‚ÑƒÑ€Ñ‹ FastAPI, database, telegram.
- `tests/test_cli.py` Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `monkeypatch` Ğ´Ğ»Ñ `SDB_CLI_MODE`/`SDB_VERBOSE`.
- `tests/test_web_app.py` ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ `DummySession`, `DummyServices`, `ModuleLoader` Ğ¼Ğ¾Ğº.
- ĞŸĞ¾ÑĞ»Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ„Ğ¸ĞºÑÑ‚ÑƒÑ€ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞ¹Ñ‚Ğµ `CONTRIBUTING` (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ) Ğ¸ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ.


## ğŸ¤ Ğ’ĞºĞ»Ğ°Ğ´ Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚

ĞœÑ‹ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµĞ¼ Ğ²ĞºĞ»Ğ°Ğ´ Ğ² Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°! Ğ’Ğ¾Ñ‚ ĞºĞ°Ğº Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‡ÑŒ:

### ğŸš€ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚ Ğ´Ğ»Ñ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¸Ğ±ÑŒÑÑ‚Ğ¾Ñ€Ğ¾Ğ²

1. **ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸**:
```bash
git clone https://github.com/soverxos/SwiftDevBot-Project.git
cd SwiftDevBot-Project
python3 sdb_setup.py  # ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°
```

2. **Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚ĞµÑÑ‚Ğ¾Ğ²**:
```bash
python3 sdb.py test
```

### Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ…
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ issues
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ issue Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¼ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼
3. Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ²ĞµÑ€ÑĞ¸Ñ Python, ĞĞ¡ Ğ¸ ÑˆĞ°Ğ³Ğ¸ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ

### ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğ¹
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ issue Ñ Ñ‚ĞµĞ³Ğ¾Ğ¼ "enhancement"
2. ĞĞ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ĞµĞ¼Ğ¾Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ
3. ĞĞ±Ğ¾ÑĞ½ÑƒĞ¹Ñ‚Ğµ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ

### Pull Request
1. Ğ¤Ğ¾Ñ€ĞºĞ½Ğ¸Ñ‚Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ²ĞµÑ‚ĞºÑƒ Ğ´Ğ»Ñ Ğ²Ğ°ÑˆĞ¸Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
3. Ğ¡Ğ´ĞµĞ»Ğ°Ğ¹Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ñ‹ Ñ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ñ‹Ğ¼Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ÑĞ¼Ğ¸
4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Pull Request

### Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ñ‹ ĞºĞ¾Ğ´Ğ°
- Ğ¡Ğ»ĞµĞ´ÑƒĞ¹Ñ‚Ğµ PEP 8
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ type hints
- ĞŸĞ¾ĞºÑ€Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ ĞºĞ¾Ğ´ Ñ‚ĞµÑÑ‚Ğ°Ğ¼Ğ¸
- Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ API

### ĞšĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ñ‹
Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¾Ğ²:
```
feat: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ CLI
fix: Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ² Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
docs: Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ API
test: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ ModuleLoader
```

## ğŸ“„ Ğ›Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ

Ğ­Ñ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ñ€Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ´ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸ĞµĞ¹ MIT. Ğ¡Ğ¼. Ñ„Ğ°Ğ¹Ğ» [LICENSE](LICENSE) Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚ĞµĞ¹.

## ğŸ™ Ğ‘Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ğ½Ğ¾ÑÑ‚Ğ¸

- [aiogram](https://aiogram.dev) - Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº Ğ´Ğ»Ñ Telegram Bot API
- [SQLAlchemy](https://sqlalchemy.org) - ORM Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ±Ğ°Ğ·Ğ°Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- [Typer](https://typer.tiangolo.com) - Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ CLI Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹
- [Pydantic](https://pydantic.dev) - Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- [Loguru](https://loguru.readthedocs.io) - Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

## ğŸ“ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°

- **GitHub Issues**: [Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ issue](https://github.com/soverxos/SwiftDevBot-Project/issues)
- **Discussions**: [ĞĞ±ÑÑƒĞ¶Ğ´ĞµĞ½Ğ¸Ñ](https://github.com/soverxos/SwiftDevBot-Project/discussions)
- **Telegram**: [@soverxos](https://t.me/soverxos)

## ğŸš€ Roadmap

### Ğ’ĞµÑ€ÑĞ¸Ñ 0.2.0
- [ ] Web Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- [ ] ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ»Ñ CLI
- [ ] Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼Ğ¸ API

### Ğ’ĞµÑ€ÑĞ¸Ñ 0.3.0
- [ ] ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°
- [ ] Kubernetes Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°
- [ ] GraphQL API
- [ ] ĞœĞ°ÑˆĞ¸Ğ½Ğ½Ğ¾Ğµ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ğ¸ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹

---

**SwiftDevBot** - ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ñ â¤ï¸ Ğ´Ğ»Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²Ğ° Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ² Telegram Ğ±Ğ¾Ñ‚Ğ¾Ğ².

â­ ĞŸĞ¾ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ğ·Ğ²ĞµĞ·Ğ´Ñƒ, ĞµÑĞ»Ğ¸ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ²Ğ°Ğ¼ Ğ¿Ğ¾Ğ½Ñ€Ğ°Ğ²Ğ¸Ğ»ÑÑ!



======================================================================

------------------------------ FILE: Dockerfile ------------------------------
# Dockerfile Ğ´Ğ»Ñ SwiftDevBot
FROM python:3.12-slim

# ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
LABEL maintainer="SwiftDevBot Team"
LABEL description="SwiftDevBot - ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ñ‹Ğ¹ Telegram Bot Framework"

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    make \
    libpq-dev \
    default-libmysqlclient-dev \
    && rm -rf /var/lib/apt/lists/*

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‡ĞµĞ¹ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸
WORKDIR /app

# ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
COPY requirements.txt .

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Python Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt

# ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
COPY . .

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ñ… Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹
RUN mkdir -p Data/Config Data/Database_files Data/Logs Data/Security

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
RUN chmod +x sdb sdb.py run_bot.py sdb_setup.py

# ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
ENV PYTHONUNBUFFERED=1
ENV SDB_CLI_MODE=false
ENV SDB_VERBOSE=false

# ĞĞ±ÑŠĞµĞ¼Ñ‹ Ğ´Ğ»Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
VOLUME ["/app/Data"]

# ĞŸĞ¾Ñ€Ñ‚ Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ (ĞµÑĞ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ)
EXPOSE 8000

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
    CMD python3 -c "import requests; requests.get('http://localhost:8000/api/health', timeout=5)" || exit 1

# Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°
ENTRYPOINT ["python3", "run_bot.py"]




======================================================================

------------------------------ FILE: Makefile ------------------------------
# Makefile Ğ´Ğ»Ñ SwiftDevBot

.PHONY: help install dev test lint format type-check docker-build docker-up docker-down clean

help: ## ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ñ€Ğ°Ğ²ĞºÑƒ
	@echo "SwiftDevBot - Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}'

install: ## Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
	pip install -r requirements.txt

dev: ## Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
	pip install -r requirements.txt
	pip install pytest pytest-cov pytest-asyncio pylint black isort mypy

test: ## Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ñ‹
	pytest tests/ -v

web-test: ## Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ web API Ñ‚ĞµÑÑ‚Ñ‹ Ñ‡ĞµÑ€ĞµĞ· .venv
	. .venv/bin/activate && pytest tests/test_web_app.py

test-cov: ## Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ñ‹ Ñ Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸ĞµĞ¼
	pytest tests/ --cov=Systems/core --cov-report=html --cov-report=term

lint: ## ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ´ Ğ»Ğ¸Ğ½Ñ‚ĞµÑ€Ğ¾Ğ¼
	pylint Systems/core --disable=all --enable=E,F,W

format: ## Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ´
	black Systems/
	isort Systems/

format-check: ## ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°
	black --check Systems/
	isort --check Systems/

type-check: ## ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿Ñ‹
	mypy Systems/core --ignore-missing-imports

docker-build: ## Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Docker Ğ¾Ğ±Ñ€Ğ°Ğ·
	docker build -t swiftdevbot:latest .

docker-up: ## Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Docker Compose
	docker-compose up -d

docker-down: ## ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Docker Compose
	docker-compose down

docker-logs: ## ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ Docker
	docker-compose logs -f

clean: ## ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
	find . -type d -name __pycache__ -exec rm -r {} +
	find . -type f -name "*.pyc" -delete
	find . -type f -name "*.pyo" -delete
	find . -type d -name ".pytest_cache" -exec rm -r {} +
	find . -type d -name ".mypy_cache" -exec rm -r {} +
	rm -rf htmlcov/
	rm -rf .coverage
	rm -rf dist/
	rm -rf build/
	rm -rf *.egg-info

setup: ## ĞŸĞµÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
	python3 sdb_setup.py

run: ## Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ°
	python3 sdb.py run

run-verbose: ## Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¼Ğ¸ Ğ»Ğ¾Ğ³Ğ°Ğ¼Ğ¸
	python3 sdb.py run -v

run-debug: ## Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ° Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸
	python3 sdb.py run -d

status: ## ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ¾Ñ‚Ğ°
	python3 sdb.py status

stop: ## ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ°
	python3 sdb.py stop

restart: ## ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ°
	python3 sdb.py restart

db-init: ## Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
	python3 sdb.py db init

db-migrate: ## ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
	python3 sdb.py db migrate

db-upgrade: ## ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ…ĞµĞ¼Ñƒ Ğ‘Ğ”
	python3 sdb.py db upgrade

all: format lint type-check test ## Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸




======================================================================

------------------------------ FILE: docker-compose.yml ------------------------------
version: '3.8'

services:
  bot:
    build: .
    container_name: swiftdevbot
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - SDB_DB_TYPE=postgresql
      - SDB_DB_PG_DSN=postgresql+psycopg://sdb_user:sdb_password@sdb_db:5432/swiftdevbot
      - SDB_CACHE_TYPE=redis
      - SDB_CACHE_REDIS_URL=redis://sdb_redis:6379/0
    volumes:
      - ./Data:/app/Data
      - ./Modules:/app/Modules
    depends_on:
      - db
      - redis
    networks:
      - sdb_network
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3

  web:
    build: .
    container_name: swiftdevbot-web
    restart: unless-stopped
    command: python3 -m Systems.cli.web start --host 0.0.0.0 --port 8000
    ports:
      - "8000:8000"
    env_file:
      - .env
    environment:
      - SDB_DB_TYPE=postgresql
      - SDB_DB_PG_DSN=postgresql+psycopg://sdb_user:sdb_password@sdb_db:5432/swiftdevbot
      - SDB_CACHE_TYPE=redis
      - SDB_CACHE_REDIS_URL=redis://sdb_redis:6379/0
    volumes:
      - ./Data:/app/Data
    depends_on:
      - bot
      - db
      - redis
    networks:
      - sdb_network

  db:
    image: postgres:16-alpine
    container_name: swiftdevbot-db
    restart: unless-stopped
    environment:
      - POSTGRES_USER=sdb_user
      - POSTGRES_PASSWORD=sdb_password
      - POSTGRES_DB=swiftdevbot
    volumes:
      - sdb_db_data:/var/lib/postgresql/data
    networks:
      - sdb_network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U sdb_user"]
      interval: 10s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    container_name: swiftdevbot-redis
    restart: unless-stopped
    command: redis-server --appendonly yes
    volumes:
      - sdb_redis_data:/data
    networks:
      - sdb_network
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  prometheus:
    image: prom/prometheus:latest
    container_name: swiftdevbot-prometheus
    restart: unless-stopped
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - sdb_prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
    ports:
      - "9090:9090"
    networks:
      - sdb_network

  grafana:
    image: grafana/grafana:latest
    container_name: swiftdevbot-grafana
    restart: unless-stopped
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_INSTALL_PLUGINS=grafana-clock-panel,grafana-simple-json-datasource
    volumes:
      - sdb_grafana_data:/var/lib/grafana
    ports:
      - "3000:3000"
    depends_on:
      - prometheus
    networks:
      - sdb_network

volumes:
  sdb_db_data:
  sdb_redis_data:
  sdb_prometheus_data:
  sdb_grafana_data:

networks:
  sdb_network:
    driver: bridge




======================================================================

------------------------------ FILE: prometheus.yml ------------------------------
# Prometheus ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ SwiftDevBot
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'swiftdevbot'
    static_configs:
      - targets: ['web:8000']
    metrics_path: '/metrics'
    scrape_interval: 10s

  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']




======================================================================

------------------------------ FILE: CHANGELOG.md ------------------------------
# Changelog

## Unreleased
- [ ] ĞŸĞµÑ€ĞµĞ½ĞµÑÑ‚Ğ¸ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ TODO Ğ¸Ğ· Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ° (ĞµÑĞ»Ğ¸ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ) Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‡ÑƒÑ Ğ²ĞµÑ‚ĞºÑƒ Ğ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ½ĞµÑ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ñ‹Ğµ.

## Done
- [x] Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ `CryptoManager`: Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ÑŒ Ğ²ĞµÑ€ÑĞ¸Ñ Ğ¸Ğ· Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°, Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ğ¾ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğµ ĞºĞ»ÑÑ‡Ğ¸ (AES-GCM) Ğ¸ ÑƒĞ±Ñ€Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ `TODO`.
- [x] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ API ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğµ Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ´Ğ»Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (web-Ğ´ÑÑˆĞ±Ğ¾Ñ€Ğ´ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ¸ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¾Ğ¼).
- [x] ĞŸĞµÑ€ĞµĞ²ĞµÑÑ‚Ğ¸ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºĞ¸ (`Users`, `Roles`, `SysInfo`) Ğ² `get_*_texts`/Ğ»Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸.
- [x] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ñ‹ FastAPI Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… API `/api/users/{id}/block` Ğ¸ `/api/modules/{name}/toggle`.
- [x] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `make web-test` (Ñ‡ĞµÑ€ĞµĞ· `.venv`) Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ³Ğ¾Ğ½ĞºĞ¸ FastAPI-Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹.




======================================================================

------------------------------ FILE: .dockerignore ------------------------------
# Git
.git
.gitignore
.gitattributes

# Python
__pycache__
*.py[cod]
*$py.class
*.so
.Python
*.egg-info
dist
build
.venv
venv
env

# IDE
.vscode
.idea
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Project specific
Data/Database_files/*.db
Data/Logs/*.log
Data/Security/*
*.pid

# Tests
.pytest_cache
.coverage
htmlcov

# Documentation
docs/_build

# Docker
Dockerfile
docker-compose.yml
.dockerignore

# CI/CD
.github




======================================================================

------------------------------ FILE: .env ------------------------------
# .env.example
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ SwiftDevBot.
# Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ ÑÑ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ» Ğ² .env Ğ¸ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ ÑĞ²Ğ¾Ğ¸Ğ¼Ğ¸ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸ÑĞ¼Ğ¸.
# Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ¸, Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ÑÑ‰Ğ¸ĞµÑÑ Ñ #, ÑĞ²Ğ»ÑÑÑ‚ÑÑ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ÑĞ¼Ğ¸.

# --- Telegram Bot ---
# ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ: Ğ¢Ğ¾ĞºĞµĞ½ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Telegram Ğ±Ğ¾Ñ‚Ğ°. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñƒ @BotFather.
BOT_TOKEN=8146110559:AAHyOYDtx8s7MAZm5_t7CMIpJjAu6RQRUQ0
SDB_TELEGRAM_POLLING_TIMEOUT=30

# Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Telegram ID ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ.
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: SDB_CORE_SUPER_ADMINS="12345678,98765432"
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº (Ğ¸Ğ· AppSettings)
SDB_CORE_SUPER_ADMINS="7847397229"

# --- Ğ‘Ğ°Ğ·Ğ° Ğ”Ğ°Ğ½Ğ½Ñ‹Ñ… ---
# Ğ¢Ğ¸Ğ¿ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ğ¾Ğ¹ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: "sqlite", "postgresql", "mysql"
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "sqlite" (Ğ¸Ğ· AppSettings)

SDB_DB_TYPE="postgresql"
SDB_DB_PG_DSN="postgresql+psycopg://postgres:Sova3568@192.168.31.3:2345/swiftdevbot"

# Ğ”Ğ»Ñ SQLite:
# SDB_DB_TYPE="sqlite"
# ĞÑ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ SQLite (Ğ¾Ñ‚ ĞºĞ¾Ñ€Ğ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ¸Ğ»Ğ¸ project_data_path).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "Database_files/swiftdevbot.db" (Ğ¸Ğ· AppSettings)
# SDB_DB_SQLITE_PATH="Database_files/sdb_prod.db"

# Ğ”Ğ»Ñ PostgreSQL:
# SDB_DB_TYPE="postgresql"
# DSN (Data Source Name) Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº PostgreSQL.
# Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: postgresql+<Ğ´Ñ€Ğ°Ğ¹Ğ²ĞµÑ€>://<user>:<password>@<host>:<port>/<dbname>
# Ğ”Ñ€Ğ°Ğ¹Ğ²ĞµÑ€Ñ‹: asyncpg, psycopg (Ğ´Ğ»Ñ psycopg SQLAlchemy 2.0 Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ psycopg[binary])
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: SDB_DB_PG_DSN="postgresql+psycopg://sdb_user:sdb_pass@localhost:5432/sdb_pg_database"
# SDB_DB_PG_DSN="postgresql+psycopg://soverx:Sova3568@192.168.31.3:2345/sdb_database"

# Ğ”Ğ»Ñ MySQL:
# SDB_DB_TYPE="mysql"
# DSN Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº MySQL.
# Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: mysql+<Ğ´Ñ€Ğ°Ğ¹Ğ²ĞµÑ€>://<user>:<password>@<host>:<port>/<dbname>
# Ğ”Ñ€Ğ°Ğ¹Ğ²ĞµÑ€Ñ‹: aiomysql, asyncmy
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: SDB_DB_MYSQL_DSN="mysql+aiomysql://sdb_user:sdb_pass@localhost:3306/sdb_mysql_database?charset=utf8mb4"
# SDB_DB_MYSQL_DSN="mysql+aiomysql://root:Sova3568@192.168.31.3:33066/swiftdevbot?charset=utf8mb4"

# Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ SQL-Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ SQLAlchemy (ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ DEBUG). true/false
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: false (Ğ¸Ğ· AppSettings)
# SDB_DB_ECHO_SQL="false"


# --- ĞšÑÑˆ ---
# Ğ¢Ğ¸Ğ¿ ĞºÑÑˆĞ°: "memory", "redis"
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "memory" (Ğ¸Ğ· AppSettings)
SDB_CACHE_TYPE="redis"

# Ğ”Ğ»Ñ Redis:
# SDB_CACHE_TYPE="redis"
# URL Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº Redis.
# Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: redis://[:<password>@]<host>:<port>/<db_number>
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "redis://localhost:6379/0" (Ğ¸Ğ· AppSettings)
SDB_CACHE_REDIS_URL="redis://192.168.31.3:6379/0"


# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¯Ğ´Ñ€Ğ° (Core) ---
# ĞŸÑƒÑ‚ÑŒ Ğº Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (Ğ»Ğ¾Ğ³Ğ¸, Ğ‘Ğ”, ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "./Data" (Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ĞºĞ¾Ñ€Ğ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°, Ğ¸Ğ· AppSettings)
# SDB_CORE_PROJECT_DATA_PATH="./Data"

# ĞŸÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ ÑĞ¾ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "Config/enabled_modules.json" (Ğ¸Ğ· AppSettings)
# SDB_CORE_ENABLED_MODULES_CONFIG_PATH="Config/active_plugins.json"

# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¯Ğ´Ñ€Ğ° ---
# Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: TRACE, DEBUG, INFO, WARNING, ERROR, CRITICAL
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "INFO" (Ğ¸Ğ· AppSettings)
SDB_CORE_LOG_LEVEL="INFO"

# ĞŸĞ¸ÑĞ°Ñ‚ÑŒ Ğ»Ğ¸ Ğ»Ğ¾Ğ³Ğ¸ Ğ² Ñ„Ğ°Ğ¹Ğ». true/false
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: true (Ğ¸Ğ· AppSettings)
# SDB_CORE_LOG_TO_FILE="true"

# Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ Ğ¿ÑƒÑ‚Ğ¸ Ğº Ğ»Ğ¾Ğ³-Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼ (Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°).
# {time} - ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ´Ğ»Ñ Loguru.
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "Logs/sdb_{time:YYYY-MM-DD_HH-mm-ss_SSSSSS}.log" (Ğ¸Ğ· AppSettings)
# SDB_CORE_LOG_FILE_PATH_TEMPLATE="MyLogs/bot_{time}.log"

# Ğ Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ² (Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¸Ğ»Ğ¸ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»). ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹: "500 MB", "1 week", "00:00" (ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾ Ğ² Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‡ÑŒ).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "10 MB" (Ğ¸Ğ· AppSettings)
# SDB_CORE_LOG_ROTATION="100 MB"

# Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ»Ğ¾Ğ³Ğ¾Ğ² (ĞºĞ°Ğº Ğ´Ğ¾Ğ»Ğ³Ğ¾ Ğ¸Ğ»Ğ¸ ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²). ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹: "1 month", "10 files".
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "7 days" (Ğ¸Ğ· AppSettings)
# SDB_CORE_LOG_RETENTION="30 days"

# Ğ’ĞµÑ€ÑĞ¸Ñ ÑĞ´Ñ€Ğ° SDB (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ², Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ½Ğµ Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ğ·Ğ´ĞµÑÑŒ).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "0.1.0" (Ğ¸Ğ· AppSettings)
# SDB_CORE_SDB_VERSION="0.1.1-beta"


# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ "ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğ°" ĞœĞ¾Ğ´ÑƒĞ»ĞµĞ¹ ---
# URL Ğº JSON-Ğ¸Ğ½Ğ´ĞµĞºÑÑƒ Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ SDB.
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "https://raw.githubusercontent.com/soverxos/SwiftDevBot-Modules/main/modules_index.json" (Ğ¸Ğ· AppSettings)
# SDB_MODULE_REPO_INDEX_URL="https://my.private.repo/modules_index.json"


# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ˜Ğ½Ñ‚ĞµÑ€Ğ½Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (i18n) Ğ¯Ğ´Ñ€Ğ° ---
# ĞŸÑƒÑ‚ÑŒ Ğº Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼Ğ¸ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² (Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ĞºĞ¾Ñ€Ğ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "Systems/locales" (Ğ¸Ğ· AppSettings)
# SDB_I18N_LOCALES_DIR="Systems/locales"

# Ğ˜Ğ¼Ñ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ° Ğ´Ğ»Ñ gettext (Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ¸Ğ¼Ñ .po/.mo Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²).
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "bot" (Ğ¸Ğ· AppSettings)
# SDB_I18N_DOMAIN="sdb_core"

# Ğ¯Ğ·Ñ‹Ğº Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ.
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "en" (Ğ¸Ğ· AppSettings)
SDB_I18N_DEFAULT_LOCALE="en"

# Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ÑĞ·Ñ‹ĞºĞ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "en,uk,de").
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "en,uk" (Ğ¸Ğ· AppSettings)
SDB_I18N_AVAILABLE_LOCALES="en,ua,ru"

# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ’ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ ---
# Ğ¥Ğ¾ÑÑ‚ Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ (0.0.0.0 Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° ÑĞ¾ Ğ²ÑĞµÑ… Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ¾Ğ², 127.0.0.1 Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾)
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: "127.0.0.1"
SDB_WEB_HOST="0.0.0.0"

# ĞŸĞ¾Ñ€Ñ‚ Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 8000
SDB_WEB_PORT=80

# ĞĞ²Ñ‚Ğ¾Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ÑÑ… (Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸). true/false
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: false
# SDB_WEB_RELOAD="false"

# ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ğ¾Ñ€ĞºĞµÑ€Ğ¾Ğ² Ğ´Ğ»Ñ production (Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ ĞµÑĞ»Ğ¸ SDB_WEB_RELOAD=true)
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 1
# SDB_WEB_WORKERS=1

# Ğ’Ñ€ĞµĞ¼Ñ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ JWT Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ (Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°Ñ…)
# ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 60 Ğ¼Ğ¸Ğ½ÑƒÑ‚ (1 Ñ‡Ğ°Ñ)
SDB_WEB_TOKEN_LIFETIME_MINUTES=60
# ĞĞ²Ñ‚Ğ¾Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ÑÑ… (Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸). true/false
SDB_WEB_RELOAD=false
# ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ğ¾Ñ€ĞºĞµÑ€Ğ¾Ğ² Ğ´Ğ»Ñ production
SDB_WEB_WORKERS=1



======================================================================

------------------------------ FILE: tests/conftest.py ------------------------------
"""
ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ pytest Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ² SwiftDevBot
"""

import pytest
import asyncio
from pathlib import Path
import sys
import os

# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ¾Ñ€ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ² sys.path
project_root = Path(__file__).resolve().parent.parent
sys.path.insert(0, str(project_root))
sys.path.insert(0, str(project_root / "Systems"))

# Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ²
os.environ.setdefault("SDB_CLI_MODE", "true")
os.environ.setdefault("SDB_VERBOSE", "false")
os.environ.setdefault("SDB_ALLOW_MISSING_BOT_TOKEN", "true")


@pytest.fixture(scope="session")
def event_loop():
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ event loop Ğ´Ğ»Ñ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ñ… Ñ‚ĞµÑÑ‚Ğ¾Ğ²"""
    loop = asyncio.get_event_loop_policy().new_event_loop()
    yield loop
    loop.close()


@pytest.fixture
def test_data_dir(tmp_path):
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
    test_dir = tmp_path / "test_data"
    test_dir.mkdir()
    (test_dir / "Config").mkdir()
    (test_dir / "Database_files").mkdir()
    (test_dir / "Logs").mkdir()
    return test_dir




======================================================================

------------------------------ FILE: tests/test_metrics.py ------------------------------
"""
Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Metrics Collector
"""

import pytest
from Systems.core.monitoring.metrics import MetricsCollector


class TestMetricsCollector:
    """Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ MetricsCollector"""
    
    def test_initialization(self):
        """Ğ¢ĞµÑÑ‚ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ MetricsCollector"""
        collector = MetricsCollector()
        assert collector._counters == {}
        assert collector._gauges == {}
        assert collector._histograms == {}
    
    def test_increment_counter(self):
        """Ğ¢ĞµÑÑ‚ ÑƒĞ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸ĞºĞ°"""
        collector = MetricsCollector()
        collector.increment_counter("test_counter")
        assert collector._counters["test_counter"] == 1
        
        collector.increment_counter("test_counter", value=5)
        assert collector._counters["test_counter"] == 6
    
    def test_increment_counter_with_labels(self):
        """Ğ¢ĞµÑÑ‚ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸ĞºĞ° Ñ Ğ¼ĞµÑ‚ĞºĞ°Ğ¼Ğ¸"""
        collector = MetricsCollector()
        collector.increment_counter("test_counter", labels={"type": "test"})
        key = collector._format_key("test_counter", {"type": "test"})
        assert collector._counters[key] == 1
    
    def test_set_gauge(self):
        """Ğ¢ĞµÑÑ‚ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ gauge"""
        collector = MetricsCollector()
        collector.set_gauge("test_gauge", 42.5)
        assert collector._gauges["test_gauge"] == 42.5
        
        collector.set_gauge("test_gauge", 100.0)
        assert collector._gauges["test_gauge"] == 100.0
    
    def test_record_histogram(self):
        """Ğ¢ĞµÑÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ² Ğ³Ğ¸ÑÑ‚Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ"""
        collector = MetricsCollector()
        collector.record_histogram("test_histogram", 1.5)
        collector.record_histogram("test_histogram", 2.5)
        collector.record_histogram("test_histogram", 3.5)
        
        assert len(collector._histograms["test_histogram"]) == 3
        assert collector._histograms["test_histogram"] == [1.5, 2.5, 3.5]
    
    def test_get_prometheus_format(self):
        """Ğ¢ĞµÑÑ‚ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ° Prometheus"""
        collector = MetricsCollector()
        collector.increment_counter("test_counter")
        collector.set_gauge("test_gauge", 42.0)
        collector.record_histogram("test_histogram", 1.0)
        
        prometheus_output = collector.get_prometheus_format()
        assert "test_counter" in prometheus_output
        assert "test_gauge" in prometheus_output
        assert "test_histogram" in prometheus_output
        assert "# TYPE" in prometheus_output
    
    def test_get_metrics_dict(self):
        """Ğ¢ĞµÑÑ‚ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ² Ğ²Ğ¸Ğ´Ğµ ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ñ"""
        collector = MetricsCollector()
        collector.increment_counter("test_counter")
        collector.set_gauge("test_gauge", 42.0)
        collector.record_histogram("test_histogram", 1.0)
        
        metrics_dict = collector.get_metrics_dict()
        assert "counters" in metrics_dict
        assert "gauges" in metrics_dict
        assert "histograms" in metrics_dict
        assert "test_counter" in metrics_dict["counters"]
        assert "test_gauge" in metrics_dict["gauges"]




======================================================================

------------------------------ FILE: tests/test_cli.py ------------------------------
import pytest
from typer.testing import CliRunner

from sdb import cli_main_app


@pytest.fixture(autouse=True)
def set_cli_mode_env(monkeypatch):
    """Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ CLI Ğ² Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ±ĞµĞ· Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ³Ğ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ°."""
    monkeypatch.setenv("SDB_CLI_MODE", "true")
    monkeypatch.setenv("SDB_VERBOSE", "false")


def _collect_cli_command_paths():
    """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ²ÑĞµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¿ÑƒÑ‚Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ CLI (Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ğ¸ Ğ¿Ğ¾Ğ´Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹)."""
    command_paths = []

    for cmd in cli_main_app.registered_commands:
        command_paths.append((cmd.name,))

    def _traverse(prefix, typer_app):
        for cmd in typer_app.registered_commands:
            command_paths.append(tuple(prefix + [cmd.name]))
        for group in typer_app.registered_groups:
            _traverse(prefix + [group.name], group.typer_instance)

    for group in cli_main_app.registered_groups:
        _traverse([group.name], group.typer_instance)

    return command_paths


ALL_CLI_COMMAND_PATHS = _collect_cli_command_paths()


@pytest.mark.parametrize("command_path", ALL_CLI_COMMAND_PATHS)
def test_cli_command_help(command_path):
    command_args = list(command_path) + ["--help"]
    runner = CliRunner()
    result = runner.invoke(cli_main_app, command_args)
    assert result.exit_code == 0, f"'{' '.join(command_args)}' failed: {result.output}"
    assert "Usage:" in result.output




======================================================================

------------------------------ FILE: tests/test_rate_limiter.py ------------------------------
"""
Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Rate Limiter
"""

import pytest
import time
from Systems.core.security.rate_limiter import RateLimiter, RateLimitMiddleware


class TestRateLimiter:
    """Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ ĞºĞ»Ğ°ÑÑĞ° RateLimiter"""
    
    def test_initialization(self):
        """Ğ¢ĞµÑÑ‚ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ RateLimiter"""
        limiter = RateLimiter(default_limit=10, default_window=60)
        assert limiter.default_limit == 10
        assert limiter.default_window == 60
    
    def test_check_rate_limit_allowed(self):
        """Ğ¢ĞµÑÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°"""
        limiter = RateLimiter(default_limit=5, default_window=60)
        user_id = 123456
        
        # ĞŸĞµÑ€Ğ²Ñ‹Ğµ 5 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ñ‹
        for i in range(5):
            is_allowed, retry_after = limiter.check_rate_limit(user_id, "message")
            assert is_allowed is True
            assert retry_after == 0
    
    def test_check_rate_limit_exceeded(self):
        """Ğ¢ĞµÑÑ‚ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½Ğ¸Ñ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ°"""
        limiter = RateLimiter(default_limit=2, default_window=60)
        user_id = 123456
        
        # ĞŸĞµÑ€Ğ²Ñ‹Ğµ 2 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ñ‹
        assert limiter.check_rate_limit(user_id, "message")[0] is True
        assert limiter.check_rate_limit(user_id, "message")[0] is True
        
        # Ğ¢Ñ€ĞµÑ‚Ğ¸Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
        is_allowed, retry_after = limiter.check_rate_limit(user_id, "message")
        assert is_allowed is False
        assert retry_after > 0
    
    def test_different_action_types(self):
        """Ğ¢ĞµÑÑ‚ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹"""
        limiter = RateLimiter(default_limit=10, default_window=60)
        limiter.set_limit("command", limit=3, window=60)
        user_id = 123456
        
        # ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¸Ğ¼ĞµÑÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
        assert limiter.check_rate_limit(user_id, "command")[0] is True
        assert limiter.check_rate_limit(user_id, "command")[0] is True
        assert limiter.check_rate_limit(user_id, "command")[0] is True
        assert limiter.check_rate_limit(user_id, "command")[0] is False
        
        # Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¸Ğ¼ĞµÑÑ‚ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
        assert limiter.check_rate_limit(user_id, "message")[0] is True
    
    def test_reset_user(self):
        """Ğ¢ĞµÑÑ‚ ÑĞ±Ñ€Ğ¾ÑĞ° ÑÑ‡ĞµÑ‚Ñ‡Ğ¸ĞºĞ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"""
        limiter = RateLimiter(default_limit=2, default_window=60)
        user_id = 123456
        
        # ĞŸÑ€ĞµĞ²Ñ‹ÑˆĞ°ĞµĞ¼ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
        limiter.check_rate_limit(user_id, "message")
        limiter.check_rate_limit(user_id, "message")
        assert limiter.check_rate_limit(user_id, "message")[0] is False
        
        # Ğ¡Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼
        limiter.reset_user(user_id)
        
        # Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ ÑĞ½Ğ¾Ğ²Ğ° Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ñ‹
        assert limiter.check_rate_limit(user_id, "message")[0] is True
    
    def test_get_user_stats(self):
        """Ğ¢ĞµÑÑ‚ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"""
        limiter = RateLimiter(default_limit=10, default_window=60)
        user_id = 123456
        
        limiter.check_rate_limit(user_id, "message")
        limiter.check_rate_limit(user_id, "command")
        
        stats = limiter.get_user_stats(user_id)
        assert "message" in stats
        assert "command" in stats
        assert stats["message"]["count"] >= 1




======================================================================

------------------------------ FILE: tests/test_web_app.py ------------------------------
import json
from pathlib import Path
from types import SimpleNamespace

import pytest
from fastapi.testclient import TestClient

from Systems.web.app import BlockUserRequest, ModuleToggleRequest, create_app


class DummyUser:
    def __init__(self, id_: int, telegram_id: int, username: str):
        self.id = id_
        self.telegram_id = telegram_id
        self.username = username
        self.is_bot_blocked = False


class DummySession:
    def __init__(self, user: DummyUser):
        self._user = user

    async def commit(self):
        pass

    async def rollback(self):
        pass

    async def __aenter__(self):
        return self

    async def __aexit__(self, exc_type, exc_val, exc_tb):
        pass

    async def get(self, model, id_):
        return self._user if self._user.id == id_ else None


class DummyDB:
    def __init__(self, user: DummyUser):
        self._user = user

    def get_session(self):
        return DummySession(self._user)


class DummyUserService:
    def __init__(self):
        self.last_change = None

    async def set_user_bot_blocked_status(self, user: DummyUser, block: bool, session):
        self.last_change = (user.id, block)
        user.is_bot_blocked = block
        return True


class DummyManifest:
    def __init__(self, description: str, display_name: str, version: str):
        self.description = description
        self.display_name = display_name
        self.version = version


class DummyModuleInfo:
    def __init__(self, name: str, is_enabled: bool, manifest: DummyManifest, is_system_module: bool = False):
        self.name = name
        self.is_enabled = is_enabled
        self.manifest = manifest
        self.is_system_module = is_system_module


class DummyModules:
    def __init__(self, modules_info, enabled_module_names):
        self._modules_info = modules_info
        self.enabled_plugin_names = enabled_module_names[:]  # keep own copy

    def get_all_modules_info(self):
        return list(self._modules_info)

    def get_module_info(self, module_name):
        for info in self._modules_info:
            if info.name == module_name:
                return info
        return None


class DummyServices:
    def __init__(self, tmp_path: Path, user: DummyUser):
        core_config = SimpleNamespace(
            super_admins=[999],
            enabled_modules_config_path=tmp_path / "enabled_modules.json",
            project_data_path=tmp_path,
        )
        self.config = SimpleNamespace(core=core_config)
        self.db = DummyDB(user)
        self.user_service = DummyUserService()
        manifest = DummyManifest(
            description="Demo plugin",
            display_name="Demo Plugin",
            version="2.0.0",
        )
        self.modules = DummyModules([DummyModuleInfo("demo", True, manifest)], enabled_module_names=["demo"])


@pytest.fixture
def dummy_services(tmp_path):
    return DummyServices(tmp_path, DummyUser(id_=1, telegram_id=123, username="tester"))


def test_get_modules_fallback_and_custom(dummy_services):
    client = TestClient(create_app(dummy_services))

    # When services are provided, expect actual modules info
    resp = client.get("/api/modules")
    assert resp.status_code == 200
    data = resp.json()
    assert isinstance(data, list)
    assert any(item["name"] == "demo" for item in data)

    # Without services fall back to mock data
    client = TestClient(create_app())
    resp = client.get("/api/modules")
    assert resp.status_code == 200
    assert resp.json()[0]["name"] == "sys_status"


def test_block_user_and_module_toggle(dummy_services):
    client = TestClient(create_app(dummy_services))

    block_resp = client.post("/api/users/1/block", json=BlockUserRequest(block=True).dict())
    assert block_resp.status_code == 200
    assert block_resp.json()["is_blocked"] is True
    assert dummy_services.user_service.last_change == (1, True)

    toggle_resp = client.post(
        "/api/modules/demo/toggle",
        json=ModuleToggleRequest(enable=False).dict(),
    )
    assert toggle_resp.status_code == 200
    module_data = toggle_resp.json()["module"]
    assert module_data["status"] == "inactive"
    assert dummy_services.modules.enabled_plugin_names == []

    # Ensure enabled modules file was persisted
    with open(dummy_services.config.core.enabled_modules_config_path, "r", encoding="utf-8") as f:
        saved = json.load(f)
    assert "demo" not in saved["active_modules"]

    # Re-enable module
    resp = client.post(
        "/api/modules/demo/toggle",
        json=ModuleToggleRequest(enable=True).dict(),
    )
    assert resp.status_code == 200
    assert resp.json()["module"]["status"] == "active"
    assert dummy_services.modules.enabled_plugin_names == ["demo"]




======================================================================

------------------------------ FILE: tests/test_health.py ------------------------------
"""
Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Health Checker
"""

import pytest
from unittest.mock import AsyncMock, MagicMock, patch
from Systems.core.monitoring.health import HealthChecker, HealthStatus


class TestHealthStatus:
    """Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ HealthStatus"""
    
    def test_health_status_creation(self):
        """Ğ¢ĞµÑÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ HealthStatus"""
        status = HealthStatus(
            name="test",
            status="healthy",
            message="Test message",
            details={"key": "value"}
        )
        assert status.name == "test"
        assert status.status == "healthy"
        assert status.message == "Test message"
        assert status.details == {"key": "value"}
    
    def test_health_status_to_dict(self):
        """Ğ¢ĞµÑÑ‚ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ² ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ"""
        status = HealthStatus(
            name="test",
            status="healthy",
            message="Test message"
        )
        status_dict = status.to_dict()
        assert status_dict["name"] == "test"
        assert status_dict["status"] == "healthy"
        assert status_dict["message"] == "Test message"
        assert "timestamp" in status_dict


class TestHealthChecker:
    """Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ HealthChecker"""
    
    @pytest.fixture
    def mock_services(self):
        """ĞœĞ¾Ğº Ğ´Ğ»Ñ BotServicesProvider"""
        services = MagicMock()
        services.db = MagicMock()
        services.cache = MagicMock()
        services.bot = MagicMock()
        services.modules = MagicMock()
        return services
    
    @pytest.mark.asyncio
    async def test_check_database_healthy(self, mock_services):
        """Ğ¢ĞµÑÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ‘Ğ” (Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ)"""
        checker = HealthChecker(mock_services)
        
        # ĞœĞ¾ĞºĞ°ĞµĞ¼ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ‘Ğ”
        mock_session = AsyncMock()
        mock_services.db.get_session.return_value.__aenter__.return_value = mock_session
        mock_result = MagicMock()
        mock_result.scalar.return_value = 1
        mock_session.execute = AsyncMock(return_value=mock_result)
        
        status = await checker.check_database()
        assert status.status == "healthy"
        assert "Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°" in status.message
    
    @pytest.mark.asyncio
    async def test_check_database_unhealthy(self, mock_services):
        """Ğ¢ĞµÑÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ‘Ğ” (Ğ½ĞµĞ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ)"""
        checker = HealthChecker(mock_services)
        
        # ĞœĞ¾ĞºĞ°ĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
        mock_services.db.get_session.side_effect = Exception("Connection failed")
        
        status = await checker.check_database()
        assert status.status == "unhealthy"
        assert "ĞÑˆĞ¸Ğ±ĞºĞ°" in status.message
    
    @pytest.mark.asyncio
    async def test_check_cache_healthy(self, mock_services):
        """Ğ¢ĞµÑÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ ĞºÑÑˆĞ° (Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ)"""
        checker = HealthChecker(mock_services)
        
        mock_services.cache.is_available.return_value = True
        mock_services.cache.set = AsyncMock()
        mock_services.cache.get = AsyncMock(return_value="test")
        mock_services.cache.delete = AsyncMock()
        
        status = await checker.check_cache()
        assert status.status == "healthy"
        assert "ĞšÑÑˆ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚" in status.message
    
    @pytest.mark.asyncio
    async def test_check_cache_unavailable(self, mock_services):
        """Ğ¢ĞµÑÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ ĞºÑÑˆĞ° (Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½)"""
        checker = HealthChecker(mock_services)
        
        mock_services.cache.is_available.return_value = False
        
        status = await checker.check_cache()
        assert status.status == "unhealthy"
        assert "Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½" in status.message.lower()
    
    @pytest.mark.asyncio
    async def test_check_all(self, mock_services):
        """Ğ¢ĞµÑÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ²ÑĞµÑ… ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²"""
        checker = HealthChecker(mock_services)
        
        # ĞœĞ¾ĞºĞ°ĞµĞ¼ Ğ²ÑĞµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ ĞºĞ°Ğº ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ğµ
        with patch.object(checker, 'check_database', return_value=HealthStatus("database", "healthy", "")), \
             patch.object(checker, 'check_cache', return_value=HealthStatus("cache", "healthy", "")), \
             patch.object(checker, 'check_telegram_api', return_value=HealthStatus("telegram_api", "healthy", "")), \
             patch.object(checker, 'check_modules', return_value=HealthStatus("modules", "healthy", "")):
            
            result = await checker.check_all()
            assert result["status"] == "healthy"
            assert "checks" in result
            assert len(result["checks"]) == 4




======================================================================

------------------------------ FILE: tests/__init__.py ------------------------------
# Tests package




======================================================================

------------------------------ FILE: tests/test_input_validator.py ------------------------------
"""
Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Input Validator
"""

import pytest
from Systems.core.security.input_validator import InputValidator, InputValidationMiddleware


class TestInputValidator:
    """Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ ĞºĞ»Ğ°ÑÑĞ° InputValidator"""
    
    def test_initialization(self):
        """Ğ¢ĞµÑÑ‚ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ InputValidator"""
        validator = InputValidator()
        assert validator.MAX_MESSAGE_LENGTH == 4096
        assert validator.MAX_COMMAND_LENGTH == 100
    
    def test_validate_message_valid(self):
        """Ğ¢ĞµÑÑ‚ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ"""
        validator = InputValidator()
        is_valid, error = validator.validate_message("ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, ÑÑ‚Ğ¾ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ!")
        assert is_valid is True
        assert error is None
    
    def test_validate_message_too_long(self):
        """Ğ¢ĞµÑÑ‚ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ"""
        validator = InputValidator()
        long_message = "a" * 5000
        is_valid, error = validator.validate_message(long_message)
        assert is_valid is False
        assert "ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğµ" in error.lower()
    
    def test_validate_message_xss_pattern(self):
        """Ğ¢ĞµÑÑ‚ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ XSS Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ°"""
        validator = InputValidator()
        xss_message = "<script>alert('XSS')</script>"
        is_valid, error = validator.validate_message(xss_message)
        assert is_valid is False
        assert "Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹" in error.lower() or "xss" in error.lower()
    
    def test_validate_message_flood_pattern(self):
        """Ğ¢ĞµÑÑ‚ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ñ„Ğ»ÑƒĞ´-Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ°"""
        validator = InputValidator()
        flood_message = "aaaaaa"  # ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑÑ‰Ğ¸ĞµÑÑ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹
        is_valid, error = validator.validate_message(flood_message)
        # ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¼, ĞµÑĞ»Ğ¸ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½
        # Ğ­Ñ‚Ğ¾ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ _check_flood_pattern
    
    def test_validate_command_valid(self):
        """Ğ¢ĞµÑÑ‚ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹"""
        validator = InputValidator()
        is_valid, error = validator.validate_command("/start")
        assert is_valid is True
        assert error is None
    
    def test_validate_command_invalid_format(self):
        """Ğ¢ĞµÑÑ‚ Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹"""
        validator = InputValidator()
        is_valid, error = validator.validate_command("start")  # Ğ‘ĞµĞ· /
        assert is_valid is False
        assert error is not None
    
    def test_validate_command_too_long(self):
        """Ğ¢ĞµÑÑ‚ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹"""
        validator = InputValidator()
        long_command = "/" + "a" * 200
        is_valid, error = validator.validate_command(long_command)
        assert is_valid is False
        assert "ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ°Ñ" in error.lower()
    
    def test_validate_callback_data_valid(self):
        """Ğ¢ĞµÑÑ‚ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ñ… callback data"""
        validator = InputValidator()
        is_valid, error = validator.validate_callback_data("action:123")
        assert is_valid is True
        assert error is None
    
    def test_validate_callback_data_too_long(self):
        """Ğ¢ĞµÑÑ‚ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ñ… callback data"""
        validator = InputValidator()
        long_data = "a" * 100
        is_valid, error = validator.validate_callback_data(long_data)
        assert is_valid is False
        assert "ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğµ" in error.lower()
    
    def test_validate_callback_data_dangerous_chars(self):
        """Ğ¢ĞµÑÑ‚ Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ñ… ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² Ğ² callback data"""
        validator = InputValidator()
        dangerous_data = "action<script>"
        is_valid, error = validator.validate_callback_data(dangerous_data)
        assert is_valid is False
        assert "Ğ½ĞµĞ´Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ñ‹Ğµ" in error.lower()
    
    def test_sanitize_text(self):
        """Ğ¢ĞµÑÑ‚ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ Ñ‚ĞµĞºÑÑ‚Ğ°"""
        validator = InputValidator()
        dirty_text = "<script>alert('XSS')</script>Hello"
        clean_text = validator.sanitize_text(dirty_text)
        assert "<script>" not in clean_text
        assert "Hello" in clean_text




======================================================================

------------------------------ FILE: tests/test_error_handler.py ------------------------------
"""
Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ Error Handler
"""

import pytest
from unittest.mock import AsyncMock, MagicMock
from Systems.core.errors.exceptions import (
    RateLimitError,
    PermissionError,
    ValidationError,
    DatabaseError,
    ModuleError
)
from Systems.core.errors.handler import ErrorHandlerMiddleware


class TestCustomExceptions:
    """Ğ¢ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ñ… Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¹"""
    
    def test_rate_limit_error(self):
        """Ğ¢ĞµÑÑ‚ RateLimitError"""
        error = RateLimitError("Too many requests", retry_after=60)
        assert error.message == "Too many requests"
        assert error.error_code == "RATE_LIMIT_ERROR"
        assert error.retry_after == 60
    
    def test_permission_error(self):
        """Ğ¢ĞµÑÑ‚ PermissionError"""
        error = PermissionError("Access denied", permission="module.action")
        assert error.message == "Access denied"
        assert error.error_code == "PERMISSION_ERROR"
        assert error.permission == "module.action"
    
    def test_validation_error(self):
        """Ğ¢ĞµÑÑ‚ ValidationError"""
        error = ValidationError("Invalid input", field="username")
        assert error.message == "Invalid input"
        assert error.error_code == "VALIDATION_ERROR"
        assert error.field == "username"
    
    def test_database_error(self):
        """Ğ¢ĞµÑÑ‚ DatabaseError"""
        error = DatabaseError("Connection failed")
        assert error.message == "Connection failed"
        assert error.error_code == "DATABASE_ERROR"
    
    def test_module_error(self):
        """Ğ¢ĞµÑÑ‚ ModuleError"""
        error = ModuleError("Module failed", module_name="test_module")
        assert error.message == "Module failed"
        assert error.error_code == "MODULE_ERROR"
        assert error.module_name == "test_module"




======================================================================

------------------------------ FILE: Systems/core/services_provider.py ------------------------------
# core/services_provider.py

from typing import Optional, TYPE_CHECKING

from loguru import logger as global_logger 

if TYPE_CHECKING:
    from Systems.core.app_settings import AppSettings
    from Systems.core.database.manager import DBManager
    from Systems.core.cache.manager import CacheManager
    from Systems.core.http_client.manager import HTTPClientManager
    from Systems.core.module_loader import ModuleLoader
    from Systems.core.events.dispatcher import EventDispatcher
    from Systems.core.ui.registry_ui import UIRegistry
    from Systems.core.rbac.service import RBACService
    from Systems.core.users.service import UserService
    from Systems.core.security.signature_manager import ModuleSignatureManager
    from Systems.core.security.sandbox_manager import ModuleSandboxManager
    from Systems.core.security.audit_logger import SecurityAuditLogger
    from Systems.core.security.reputation_system import ModuleReputationSystem
    from Systems.core.security.code_scanner import ModuleCodeScanner
    from Systems.core.security.security_levels import SecurityLevelManager
    from Systems.core.security.anomaly_detection import AnomalyDetector


class BotServicesProvider:
    def __init__(self, settings: 'AppSettings'):
        self._settings: 'AppSettings' = settings
        self._logger = global_logger.bind(service="BotServicesProvider")

        self._db_manager: Optional['DBManager'] = None
        self._cache_manager: Optional['CacheManager'] = None
        self._http_client_manager: Optional['HTTPClientManager'] = None
        self._module_loader: Optional['ModuleLoader'] = None
        self._event_dispatcher: Optional['EventDispatcher'] = None
        self._ui_registry: Optional['UIRegistry'] = None
        self._rbac_service: Optional['RBACService'] = None
        self._user_service: Optional['UserService'] = None
        
        # Security services
        self._signature_manager: Optional['ModuleSignatureManager'] = None
        self._sandbox_manager: Optional['ModuleSandboxManager'] = None
        self._audit_logger: Optional['SecurityAuditLogger'] = None
        self._reputation_system: Optional['ModuleReputationSystem'] = None
        self._code_scanner: Optional['ModuleCodeScanner'] = None
        self._security_level_manager: Optional['SecurityLevelManager'] = None
        self._anomaly_detector: Optional['AnomalyDetector'] = None

        self._logger.info(f"BotServicesProvider ÑĞ¾Ğ·Ğ´Ğ°Ğ½ (Ğ²ĞµÑ€ÑĞ¸Ñ SDB: {settings.core.sdb_version}). ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ².")

    async def setup_services(self) -> None:
        self._logger.info("ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² SDB...")
        
        from Systems.core.database.manager import DBManager 
        try:
            self._db_manager = DBManager(db_settings=self._settings.db, app_settings=self._settings)
            await self._db_manager.initialize() 
            self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ DBManager ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½.")
        except Exception as e:
            self._logger.critical(f"ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ ĞĞ¨Ğ˜Ğ‘ĞšĞ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ DBManager: {e}", exc_info=True)
            raise

        # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ ModuleLoader, Ñ‚Ğ°Ğº ĞºĞ°Ğº RBACService Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ñ‚ Ğ½ĞµĞ³Ğ¾ Ğ·Ğ°Ğ²Ğ¸ÑĞµÑ‚ÑŒ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
        from Systems.core.module_loader import ModuleLoader 
        try:
            self._module_loader = ModuleLoader(settings=self._settings, services_provider=self)
            self._module_loader.scan_all_available_modules() 
            self._module_loader._load_enabled_plugin_names() 
            self._logger.success(f"Ğ¡ĞµÑ€Ğ²Ğ¸Ñ ModuleLoader Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ (Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ {len(self._module_loader.available_modules)} Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹, "
                                 f"Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ² {len(self._module_loader.enabled_plugin_names)}).")
        except Exception as e_mod_load:
            self._logger.critical(f"ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ ĞĞ¨Ğ˜Ğ‘ĞšĞ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ModuleLoader: {e_mod_load}", exc_info=True)
            raise 

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† ÑĞ´Ñ€Ğ°, ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
        try:
            from sqlalchemy import inspect, text
            from Systems.core.database import core_models
            
            existing_tables = []
            
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ°
            if self._settings.db.type == "sqlite":
                # Ğ”Ğ»Ñ SQLite Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ ÑĞ¿Ğ¾ÑĞ¾Ğ± Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· sqlite_master
                async with self._db_manager._engine.begin() as conn:
                    result = await conn.execute(text("SELECT name FROM sqlite_master WHERE type='table' AND name LIKE 'sdb_%'"))
                    rows = await result.fetchall()
                    existing_tables = [row[0] for row in rows]
            else:
                # Ğ”Ğ»Ñ PostgreSQL/MySQL Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ inspect Ñ‡ĞµÑ€ĞµĞ· sync_engine
                inspector = inspect(self._db_manager._engine.sync_engine)
                existing_tables = inspector.get_table_names()
            
            core_table_names = [
                f"{core_models.SDB_CORE_TABLE_PREFIX}users",
                f"{core_models.SDB_CORE_TABLE_PREFIX}roles",
                f"{core_models.SDB_CORE_TABLE_PREFIX}permissions",
            ]
            
            tables_exist = any(table in existing_tables for table in core_table_names)
            
            if not tables_exist:
                self._logger.warning("Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹. ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†...")
                await self._db_manager.create_all_core_tables()
                self._logger.success("Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸.")
            else:
                self._logger.debug("Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‚.")
        except Exception as e_tables_check:
            self._logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† ÑĞ´Ñ€Ğ°: {e_tables_check}. ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†...")
            try:
                await self._db_manager.create_all_core_tables()
                self._logger.success("Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ (Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸).")
            except Exception as e_create_tables:
                self._logger.error(f"ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† ÑĞ´Ñ€Ğ°: {e_create_tables}", exc_info=True)
                raise

        from Systems.core.rbac.service import RBACService 
        try:
            # ĞŸĞµÑ€ĞµĞ´Ğ°ĞµĞ¼ self (BotServicesProvider) Ğ² RBACService
            self._rbac_service = RBACService(services=self) # <--- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ• Ğ—Ğ”Ğ•Ğ¡Ğ¬
            if self._db_manager and self._rbac_service:
                try:
                    async with self._db_manager.get_session() as db_session:
                        # Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ensure_default_entities_exist
                        roles_c, core_perms_c, mod_perms_c = await self._rbac_service.ensure_default_entities_exist(db_session) # <--- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ• Ğ—Ğ”Ğ•Ğ¡Ğ¬
                        await db_session.commit()
                        self._logger.info(f"RBACService.ensure_default_entities_exist Ğ¾Ñ‚Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ». "
                                          f"Ğ Ğ¾Ğ»ĞµĞ¹ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾: {roles_c}, Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ ÑĞ´Ñ€Ğ°: {core_perms_c}, Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹: {mod_perms_c}")
                except Exception as e_roles:
                    self._logger.error(f"ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸/Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… RBAC ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ĞµĞ¹: {e_roles}", exc_info=True)
            self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ RBACService ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½.")
        except ValueError as e_rbac_val: # ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, ĞµÑĞ»Ğ¸ DBManager Ğ½Ğµ Ğ±Ñ‹Ğ» Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ½
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ RBACService (Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ñ DBManager Ğ¸Ğ»Ğ¸ ModuleLoader): {e_rbac_val}")
            self._rbac_service = None
        except Exception as e_rbac:
            self._logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ RBACService: {e_rbac}", exc_info=True)
            self._rbac_service = None 

        from Systems.core.users.service import UserService
        try:
            self._user_service = UserService(services_provider=self) 
            self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ UserService ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½.")
        except Exception as e_user_svc:
            self._logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ UserService: {e_user_svc}", exc_info=True)
            self._user_service = None
        
        from Systems.core.cache.manager import CacheManager 
        try:
            self._cache_manager = CacheManager(cache_settings=self._settings.cache)
            await self._cache_manager.initialize()
            if self._cache_manager.is_available():
                 self._logger.success(f"Ğ¡ĞµÑ€Ğ²Ğ¸Ñ CacheManager ({self._settings.cache.type}) ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½.")
            else:
                 self._logger.warning(f"CacheManager ({self._settings.cache.type}) Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½, Ğ½Ğ¾ ĞºÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.")
        except ImportError as e_cache_imp: 
             self._logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ CacheManager: {e_cache_imp}")
        except Exception as e_cache:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ CacheManager: {e_cache}", exc_info=True)
            self._cache_manager = None

        from Systems.core.http_client.manager import HTTPClientManager 
        try:
            self._http_client_manager = HTTPClientManager(app_settings=self._settings) 
            await self._http_client_manager.initialize()
            if self._http_client_manager.is_available():
                self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ HTTPClientManager ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½.")
            else:
                self._logger.warning("HTTPClientManager Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½, Ğ½Ğ¾ HTTP-ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.")
        except ImportError as e_http_imp: 
            self._logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ HTTPClientManager: {e_http_imp}")
        except Exception as e_http:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ HTTPClientManager: {e_http}", exc_info=True)
            self._http_client_manager = None

        from Systems.core.events.dispatcher import EventDispatcher 
        try:
            self._event_dispatcher = EventDispatcher()
            self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ EventDispatcher ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
        except Exception as e_event:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ EventDispatcher: {e_event}", exc_info=True)
            self._event_dispatcher = None

        from Systems.core.ui.registry_ui import UIRegistry 
        try:
            self._ui_registry = UIRegistry()
            self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ UIRegistry ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
        except Exception as e_ui_reg:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ UIRegistry: {e_ui_reg}", exc_info=True)
            self._ui_registry = None
        
        # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
        from Systems.core.security.signature_manager import ModuleSignatureManager
        try:
            self._signature_manager = ModuleSignatureManager(self._settings)
            self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ ModuleSignatureManager ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
        except Exception as e_sig:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ModuleSignatureManager: {e_sig}", exc_info=True)
            self._signature_manager = None
        
        from Systems.core.security.sandbox_manager import ModuleSandboxManager
        try:
            self._sandbox_manager = ModuleSandboxManager(self._settings)
            self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ ModuleSandboxManager ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
        except Exception as e_sandbox:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ModuleSandboxManager: {e_sandbox}", exc_info=True)
            self._sandbox_manager = None
        
        from Systems.core.security.audit_logger import SecurityAuditLogger
        try:
            self._audit_logger = SecurityAuditLogger(self._settings)
            self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ SecurityAuditLogger ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
        except Exception as e_audit:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ SecurityAuditLogger: {e_audit}", exc_info=True)
            self._audit_logger = None
        
        from Systems.core.security.reputation_system import ModuleReputationSystem
        try:
            self._reputation_system = ModuleReputationSystem(self._settings)
            self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ ModuleReputationSystem ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
        except Exception as e_reputation:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ModuleReputationSystem: {e_reputation}", exc_info=True)
            self._reputation_system = None
        
        from Systems.core.security.code_scanner import ModuleCodeScanner
        try:
            self._code_scanner = ModuleCodeScanner(self._settings)
            self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ ModuleCodeScanner ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
        except Exception as e_scanner:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ModuleCodeScanner: {e_scanner}", exc_info=True)
            self._code_scanner = None
        
        from Systems.core.security.security_levels import SecurityLevelManager
        try:
            self._security_level_manager = SecurityLevelManager(self._settings)
            self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ SecurityLevelManager ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
        except Exception as e_security:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ SecurityLevelManager: {e_security}", exc_info=True)
            self._security_level_manager = None
        
        from Systems.core.security.anomaly_detection import AnomalyDetector
        try:
            self._anomaly_detector = AnomalyDetector(self._settings)
            self._logger.success("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ AnomalyDetector ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
        except Exception as e_anomaly:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ AnomalyDetector: {e_anomaly}", exc_info=True)
            self._anomaly_detector = None
        
        # ModuleLoader ÑƒĞ¶Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ²Ñ‹ÑˆĞµ

        self._logger.info("âœ… ĞŸĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ²ÑĞµÑ… Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² SDB Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°.")


    async def close_services(self) -> None:
        self._logger.info("ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ´ÑƒÑ€Ñ‹ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Ğ¸ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² SDB...")
        
        if self._module_loader: self._logger.debug("ModuleLoader Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ dispose().")
        if self._ui_registry:
            try: await self._ui_registry.dispose(); self._logger.info("UIRegistry Ñ€ĞµÑÑƒÑ€ÑÑ‹ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ñ‹.")
            except Exception as e: self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸ UIRegistry: {e}", exc_info=True)
        if self._event_dispatcher:
            try: await self._event_dispatcher.dispose(); self._logger.info("EventDispatcher Ñ€ĞµÑÑƒÑ€ÑÑ‹ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ñ‹.")
            except Exception as e: self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸ EventDispatcher: {e}", exc_info=True)
        if self._http_client_manager:
            try: await self._http_client_manager.dispose(); self._logger.info("HTTPClientManager Ñ€ĞµÑÑƒÑ€ÑÑ‹ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ñ‹.")
            except Exception as e: self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸ HTTPClientManager: {e}", exc_info=True)
        if self._cache_manager:
            try: await self._cache_manager.dispose(); self._logger.info("CacheManager Ñ€ĞµÑÑƒÑ€ÑÑ‹ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ñ‹.")
            except Exception as e: self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸ CacheManager: {e}", exc_info=True)
        
        if self._user_service: self._logger.debug("UserService Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ dispose().")
        if self._rbac_service: self._logger.debug("RBACService Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ dispose().")
        
        # Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
        if self._audit_logger:
            try: self._audit_logger.force_flush(); self._logger.info("SecurityAuditLogger Ğ±ÑƒÑ„ĞµÑ€ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½.")
            except Exception as e: self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ±ÑƒÑ„ĞµÑ€Ğ° SecurityAuditLogger: {e}", exc_info=True)
        
        if self._signature_manager: self._logger.debug("ModuleSignatureManager Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ dispose().")
        if self._sandbox_manager: self._logger.debug("ModuleSandboxManager Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ dispose().")
        if self._reputation_system: self._logger.debug("ModuleReputationSystem Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ dispose().")
        if self._code_scanner: self._logger.debug("ModuleCodeScanner Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ dispose().")
        if self._security_level_manager: self._logger.debug("SecurityLevelManager Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ dispose().")
        if self._anomaly_detector: self._logger.debug("AnomalyDetector Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ dispose().")
        
        if self._db_manager:
            try: await self._db_manager.dispose(); self._logger.info("DBManager Ñ€ĞµÑÑƒÑ€ÑÑ‹ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ñ‹.")
            except Exception as e: self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸ DBManager: {e}", exc_info=True)
        
        self._logger.info("ğŸ ĞŸÑ€Ğ¾Ñ†ĞµĞ´ÑƒÑ€Ğ° Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Ğ²ÑĞµÑ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² SDB Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°.")
    
    @property
    def config(self) -> 'AppSettings':
        return self._settings

    @property
    def logger(self):
        return global_logger 

    @property
    def db(self) -> 'DBManager':
        if self._db_manager is None:
            msg = "DBManager Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½! ĞĞ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğº Ğ‘Ğ” Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾."
            self._logger.critical(msg)
            raise RuntimeError(msg)
        return self._db_manager

    @property
    def rbac(self) -> 'RBACService':
        if self._rbac_service is None:
            msg = "RBACService Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½! Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ RBAC Ğ±ÑƒĞ´ÑƒÑ‚ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹."
            self._logger.error(msg) 
            raise AttributeError(msg) 
        return self._rbac_service
    
    @property
    def user_service(self) -> 'UserService':
        if self._user_service is None:
            msg = "UserService Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½! Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹."
            self._logger.error(msg)
            raise AttributeError(msg)
        return self._user_service

    @property
    def cache(self) -> 'CacheManager':
        if self._cache_manager is None or not self._cache_manager.is_available():
            # msg = "CacheManager Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ¸Ğ»Ğ¸ ĞºÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½!" # Ğ—Ğ°ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ ÑĞ¿Ğ°Ğ¼Ğ¸Ñ‚ÑŒ, ĞµÑĞ»Ğ¸ ĞºÑÑˆ Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ĞµĞ½
            # self._logger.warning(msg)
            raise AttributeError("CacheManager Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ¸Ğ»Ğ¸ ĞºÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½! ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğ¹ ĞºÑÑˆ.")
        return self._cache_manager

    @property
    def http(self) -> 'HTTPClientManager': 
        if self._http_client_manager is None or not self._http_client_manager.is_available():
            raise AttributeError("HTTPClientManager Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ¸Ğ»Ğ¸ HTTP-ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½! ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğ¹ HTTP-ĞºĞ»Ğ¸ĞµĞ½Ñ‚.")
        return self._http_client_manager

    @property
    def modules(self) -> 'ModuleLoader': 
        if self._module_loader is None:
            msg = "ModuleLoader Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!" 
            self._logger.critical(msg)
            raise RuntimeError(msg)
        return self._module_loader

    # Security services properties
    @property
    def signature_manager(self) -> 'ModuleSignatureManager':
        if self._signature_manager is None:
            msg = "ModuleSignatureManager Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!"
            self._logger.error(msg)
            raise AttributeError(msg)
        return self._signature_manager
    
    @property
    def sandbox_manager(self) -> 'ModuleSandboxManager':
        if self._sandbox_manager is None:
            msg = "ModuleSandboxManager Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!"
            self._logger.error(msg)
            raise AttributeError(msg)
        return self._sandbox_manager
    
    @property
    def audit_logger(self) -> 'SecurityAuditLogger':
        if self._audit_logger is None:
            msg = "SecurityAuditLogger Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!"
            self._logger.error(msg)
            raise AttributeError(msg)
        return self._audit_logger
    
    @property
    def reputation_system(self) -> 'ModuleReputationSystem':
        if self._reputation_system is None:
            msg = "ModuleReputationSystem Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!"
            self._logger.error(msg)
            raise AttributeError(msg)
        return self._reputation_system
    
    @property
    def code_scanner(self) -> 'ModuleCodeScanner':
        if self._code_scanner is None:
            msg = "ModuleCodeScanner Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!"
            self._logger.error(msg)
            raise AttributeError(msg)
        return self._code_scanner
    
    @property
    def security_level_manager(self) -> 'SecurityLevelManager':
        if self._security_level_manager is None:
            msg = "SecurityLevelManager Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!"
            self._logger.error(msg)
            raise AttributeError(msg)
        return self._security_level_manager
    
    @property
    def anomaly_detector(self) -> 'AnomalyDetector':
        if self._anomaly_detector is None:
            msg = "AnomalyDetector Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!"
            self._logger.error(msg)
            raise AttributeError(msg)
        return self._anomaly_detector

    @property
    def events(self) -> 'EventDispatcher':
        if self._event_dispatcher is None:
            msg = "EventDispatcher Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!"
            self._logger.error(msg) 
            raise AttributeError(msg)
        return self._event_dispatcher
    
    @property
    def ui_registry(self) -> 'UIRegistry':
        if self._ui_registry is None:
            msg = "UIRegistry Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!"
            self._logger.error(msg)
            raise AttributeError(msg)
        return self._ui_registry


======================================================================

------------------------------ FILE: Systems/core/module_loader.py ------------------------------
# core/module_loader.py

import asyncio
import importlib
import importlib.util
import json
import re
import shutil
import sys
from pathlib import Path
from typing import (TYPE_CHECKING, Any, Callable, Dict, List, Optional, Tuple,
                    Type)

import yaml  # type: ignore
from aiogram import Bot, Dispatcher
from loguru import logger
from pydantic import BaseModel as PydanticBaseModel
from pydantic import ValidationError

# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ PermissionManifest Ğ² Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹
from .schemas.module_manifest import (ModuleManifest, PermissionManifest,
                                      SettingManifest)

if TYPE_CHECKING:
    from .app_settings import AppSettings, CoreAppSettings
    from .services_provider import BotServicesProvider

MANIFEST_YAML_NAME = "manifest.yaml"
MANIFEST_JSON_NAME = "manifest.json"
MODULE_ENTRY_POINT_FILENAME = "__init__.py"
SETUP_FUNCTION_NAME = "setup_module"
USER_MODULES_SETTINGS_DIR_NAME = "modules_settings"
MODULE_DEFAULT_SETTINGS_FILENAME = "module_settings.yaml"


def get_module_required_permission(module_name: str, manifest: Optional[ModuleManifest]) -> Optional[str]:
    """
    ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ, Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾Ğµ Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ.
    
    Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:
    1. Ğ•ÑĞ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¿Ğ¾Ğ¼ĞµÑ‡ĞµĞ½ assign_default_access_to_user_role=True, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ None (Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ²ÑĞµĞ¼)
    2. Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ declared_permissions, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ
    3. Ğ˜Ğ½Ğ°Ñ‡Ğµ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ None (Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ²ÑĞµĞ¼)
    
    Args:
        module_name: Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        manifest: ĞœĞ°Ğ½Ğ¸Ñ„ĞµÑÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        
    Returns:
        Ğ˜Ğ¼Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¸Ğ»Ğ¸ None, ĞµÑĞ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ²ÑĞµĞ¼
    """
    if not manifest:
        return None
    
    # Ğ•ÑĞ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¿Ğ¾Ğ¼ĞµÑ‡ĞµĞ½ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾-Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ, Ğ´ĞµĞ»Ğ°ĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğ¼ Ğ²ÑĞµĞ¼
    if manifest.metadata and manifest.metadata.assign_default_access_to_user_role:
        return None
    
    # Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ
    if manifest.declared_permissions:
        return manifest.declared_permissions[0].name
    
    # Ğ˜Ğ½Ğ°Ñ‡Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ²ÑĞµĞ¼
    return None


def get_module_permission_to_check(module_name: str, manifest: Optional[ModuleManifest]) -> Optional[str]:
    """
    ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ.
    
    Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:
    1. Ğ•ÑĞ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¿Ğ¾Ğ¼ĞµÑ‡ĞµĞ½ assign_default_access_to_user_role=True, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ {module_name}.access_user_features
    2. Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ declared_permissions, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ
    3. Ğ˜Ğ½Ğ°Ñ‡Ğµ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ None (Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸)
    
    Args:
        module_name: Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        manifest: ĞœĞ°Ğ½Ğ¸Ñ„ĞµÑÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        
    Returns:
        Ğ˜Ğ¼Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¸Ğ»Ğ¸ None, ĞµÑĞ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ
    """
    if not manifest:
        return None
    
    # Ğ•ÑĞ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¿Ğ¾Ğ¼ĞµÑ‡ĞµĞ½ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾-Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ
    if manifest.metadata and manifest.metadata.assign_default_access_to_user_role:
        return f"{module_name}.access_user_features"
    
    # Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ
    if manifest.declared_permissions:
        return manifest.declared_permissions[0].name
    
    # Ğ˜Ğ½Ğ°Ñ‡Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ
    return None


class ModuleInfo:
    def __init__(
        self,
        name: str,
        path: Path,
        manifest: Optional[ModuleManifest] = None,
        is_enabled: bool = False,
        error: Optional[str] = None,
        is_system_module: bool = False,
    ):
        self.name: str = name
        self.path: Path = path
        self.manifest: Optional[ModuleManifest] = manifest
        self.is_enabled: bool = is_enabled
        self.is_loaded_successfully: bool = False
        self.error: Optional[str] = error
        self.imported_py_module: Optional[Any] = None
        self.is_system_module: bool = is_system_module
        self.current_settings: Dict[str, Any] = {}

    def __repr__(self) -> str:
        status_parts = []
        if self.is_system_module:
            status_parts.append("system")
        if self.is_enabled or self.is_system_module:
            status_parts.append("active_target")
        if self.is_loaded_successfully:
            status_parts.append("loaded")
        if self.current_settings:
            status_parts.append("settings_loaded")
        if self.error:
            status_parts.append(f"error='{self.error[:30]}...'")
        status_str = ", ".join(status_parts) if status_parts else "discovered"
        return f"<ModuleInfo name='{self.name}' ({status_str})>"


class ModuleLoader:
    def __init__(self, settings: "AppSettings", services_provider: "BotServicesProvider"):
        self._settings: "AppSettings" = settings
        self._services: "BotServicesProvider" = services_provider
        self._core_settings: "CoreAppSettings" = self._settings.core

        self.plugins_root_dir: Path = settings.core.project_data_path.parent / "Modules"
        self.core_sys_modules_root_dir: Path = settings.core.project_data_path.parent / "Systems" / "core" / "sys_modules"

        self.user_module_settings_base_path: Path = (
            self._core_settings.project_data_path / "Config" / USER_MODULES_SETTINGS_DIR_NAME
        )
        self.user_module_settings_base_path.mkdir(parents=True, exist_ok=True)

        self.available_modules: Dict[str, ModuleInfo] = {}
        self.enabled_plugin_names: List[str] = []

        self._logger = logger.bind(service="ModuleLoader")
        self._logger.info(
            f"ModuleLoader Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½. "
            f"ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½Ñ‹: {self.plugins_root_dir.resolve()}, "
            f"Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸: {self.core_sys_modules_root_dir.resolve()}, "
            f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹: {self.user_module_settings_base_path.resolve()}"
        )

    def _parse_manifest_file(
        self, module_path: Path, module_name_override: Optional[str] = None
    ) -> Optional[ModuleManifest]:
        yaml_manifest_path = module_path / MANIFEST_YAML_NAME
        json_manifest_path = module_path / MANIFEST_JSON_NAME
        manifest_file_to_parse: Optional[Path] = None
        parser_type: Optional[str] = None

        if yaml_manifest_path.is_file():
            manifest_file_to_parse = yaml_manifest_path
            parser_type = "yaml"
            if json_manifest_path.is_file():
                self._logger.warning(
                    f"Ğ’ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ '{module_path.name}' Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ Ğ¸ YAML, Ğ¸ JSON Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ñ‹. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ YAML."
                )
        elif json_manifest_path.is_file():
            manifest_file_to_parse = json_manifest_path
            parser_type = "json"

        if not manifest_file_to_parse:
            is_plugin = not (module_path.parent.name == "sys_modules" and module_path.parent.parent.name == "core")
            log_func = self._logger.warning if is_plugin else self._logger.debug
            log_func(f"ĞœĞ°Ğ½Ğ¸Ñ„ĞµÑÑ‚ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_path.name}'.")
            return None
        try:
            with open(manifest_file_to_parse, "r", encoding="utf-8") as f:
                data = yaml.safe_load(f) if parser_type == "yaml" else json.load(f)
            if not data:
                self._logger.error(f"ĞœĞ°Ğ½Ğ¸Ñ„ĞµÑÑ‚ {manifest_file_to_parse.name} Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ {module_path.name} Ğ¿ÑƒÑÑ‚.")
                return None

            if module_name_override and "name" not in data:
                data["name"] = module_name_override
            elif "name" in data and module_name_override and data["name"] != module_name_override:
                self._logger.warning(
                    f"Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ ('{data['name']}') Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ Ğ¸Ğ¼ĞµĞ½Ğ¸ Ğ¿Ğ°Ğ¿ĞºĞ¸ ('{module_name_override}') "
                    f"Ğ´Ğ»Ñ {manifest_file_to_parse.name}. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¸Ğ¼Ñ Ğ¸Ğ· Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°: '{data['name']}'."
                )

            manifest = ModuleManifest(**data)
            return manifest
        except Exception as e:
            self._logger.error(
                f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ°/Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ° {manifest_file_to_parse.name} Ğ² {module_path.name}: {e}",
                exc_info=True,
            )
        return None

    def _scan_directory_for_modules(self, directory: Path, is_system_dir: bool) -> None:
        if not directory.is_dir():
            self._logger.warning(
                f"Ğ”Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ {'ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹' if is_system_dir else 'Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ²'} {directory} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°."
            )
            return

        for module_dir_path in directory.iterdir():
            if module_dir_path.is_dir() and not module_dir_path.name.startswith((".", "_")):
                module_name_from_path = module_dir_path.name
                manifest = self._parse_manifest_file(
                    module_dir_path, module_name_override=module_name_from_path if is_system_dir else None
                )

                actual_module_name = manifest.name if manifest and manifest.name else module_name_from_path

                if actual_module_name in self.available_modules:
                    self._logger.warning(
                        f"Ğ”ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‰ĞµĞµÑÑ Ğ¸Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{actual_module_name}' (Ğ¸Ğ· Ğ¿Ğ°Ğ¿ĞºĞ¸ '{module_dir_path.name}', "
                        f"Ñ‚Ğ¸Ğ¿: {'ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹' if is_system_dir else 'Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½'}). "
                        f"ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ñ Ñ‚Ğ°ĞºĞ¸Ğ¼ Ğ¸Ğ¼ĞµĞ½ĞµĞ¼ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½ Ğ² ÑĞ¿Ğ¸ÑĞºĞµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ…."
                    )

                module_info = ModuleInfo(
                    name=actual_module_name,
                    path=module_dir_path,
                    manifest=manifest,
                    is_system_module=is_system_dir,
                    is_enabled=is_system_dir,
                )

                if manifest and manifest.settings:
                    self._load_and_validate_module_settings(module_info)

                self.available_modules[actual_module_name] = module_info
                log_msg_type = "ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ" if is_system_dir else "Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½"
                log_msg_details = f"v{manifest.version}" if manifest and manifest.version else "Ğ±ĞµĞ· Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°/Ğ²ĞµÑ€ÑĞ¸Ğ¸"
                self._logger.info(
                    f"ĞĞ°Ğ¹Ğ´ĞµĞ½ {log_msg_type} '{actual_module_name}' ({log_msg_details}) Ğ² '{module_dir_path.name}'."
                )

    def _load_and_validate_module_settings(self, module_info: ModuleInfo) -> None:
        module_name = module_info.name
        manifest = module_info.manifest
        module_info.current_settings = {}

        if not manifest or not manifest.settings:
            return

        module_default_config_file = module_info.path / MODULE_DEFAULT_SETTINGS_FILENAME
        user_module_config_file = self.user_module_settings_base_path / f"{module_name}.yaml"

        final_settings: Dict[str, Any] = {}
        for key, setting_mft_def in manifest.settings.items():
            final_settings[key] = setting_mft_def.default

        module_defaults_from_file: Dict[str, Any] = {}
        if module_default_config_file.is_file():
            try:
                with open(module_default_config_file, "r", encoding="utf-8") as f:
                    module_defaults_from_file = yaml.safe_load(f) or {}
                final_settings.update(module_defaults_from_file)
                self._logger.trace(
                    f"Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}': {module_default_config_file}"
                )
            except Exception as e:
                self._logger.warning(
                    f"ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° '{module_default_config_file}' Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}': {e}."
                )

        if not user_module_config_file.exists():
            self._logger.info(
                f"Ğ¤Ğ°Ğ¹Ğ» Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ ({user_module_config_file})."
            )
            source_for_user_config = final_settings.copy()

            if source_for_user_config:
                try:
                    user_module_config_file.parent.mkdir(parents=True, exist_ok=True)
                    with open(user_module_config_file, "w", encoding="utf-8") as f:
                        yaml.dump(source_for_user_config, f, indent=2, sort_keys=False, allow_unicode=True)
                    self._logger.info(
                        f"Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ñ„Ğ°Ğ¹Ğ» Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ´Ğ»Ñ '{module_name}' Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ¾Ğ²: {user_module_config_file}"
                    )
                except Exception as e_create_user_cfg:
                    self._logger.error(
                        f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ» Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ´Ğ»Ñ '{module_name}': {e_create_user_cfg}."
                    )
            else:
                self._logger.info(
                    f"Ğ”Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}' Ğ½ĞµÑ‚ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ñ‹Ñ… Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°. Ğ¤Ğ°Ğ¹Ğ» Ğ½Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½."
                )
        else:
            try:
                with open(user_module_config_file, "r", encoding="utf-8") as f:
                    user_settings_from_file = yaml.safe_load(f) or {}
                self._logger.info(
                    f"Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}' Ğ¸Ğ·: {user_module_config_file}"
                )
                final_settings.update(user_settings_from_file)
            except Exception as e_load_user:
                self._logger.error(
                    f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº '{user_module_config_file}' Ğ´Ğ»Ñ '{module_name}': {e_load_user}."
                )

        validated_settings: Dict[str, Any] = {}
        validation_errors: List[str] = []

        for key, setting_mft_def in manifest.settings.items():
            value_to_validate = final_settings.get(key)

            if value_to_validate is None:
                if setting_mft_def.required:
                    validation_errors.append(
                        f"ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ '{setting_mft_def.label}' ({key}) Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}'."
                    )
                    continue
                else:
                    validated_settings[key] = None
                    continue

            try:
                validated_value = value_to_validate
                if setting_mft_def.type == "bool":
                    if isinstance(value_to_validate, str):
                        validated_value = value_to_validate.lower() in ["true", "1", "yes", "on", "t"]
                    else:
                        validated_value = bool(value_to_validate)
                elif setting_mft_def.type == "int":
                    validated_value = int(value_to_validate)
                elif setting_mft_def.type == "float":
                    validated_value = float(value_to_validate)
                elif setting_mft_def.type in ["string", "text"]:
                    validated_value = str(value_to_validate)

                key_specific_errors = False
                if setting_mft_def.type == "string" and setting_mft_def.regex_validator:
                    if not re.fullmatch(setting_mft_def.regex_validator, str(validated_value)):
                        validation_errors.append(
                            f"Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ '{validated_value}' Ğ´Ğ»Ñ '{key}' Ğ½Ğµ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ regex: {setting_mft_def.regex_validator}"
                        )
                        key_specific_errors = True
                if setting_mft_def.type in ["int", "float"]:
                    if setting_mft_def.min_value is not None and validated_value < setting_mft_def.min_value:  # type: ignore
                        validation_errors.append(
                            f"Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ {validated_value} Ğ´Ğ»Ñ '{key}' < min ({setting_mft_def.min_value})"
                        )
                        key_specific_errors = True
                    if setting_mft_def.max_value is not None and validated_value > setting_mft_def.max_value:  # type: ignore
                        validation_errors.append(
                            f"Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ {validated_value} Ğ´Ğ»Ñ '{key}' > max ({setting_mft_def.max_value})"
                        )
                        key_specific_errors = True
                if setting_mft_def.type == "choice" and setting_mft_def.options:
                    option_values = [
                        opt.value if isinstance(opt, PydanticBaseModel) else opt for opt in setting_mft_def.options
                    ]
                    if validated_value not in option_values:
                        validation_errors.append(
                            f"Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ '{validated_value}' Ğ´Ğ»Ñ '{key}' Ğ½Ğµ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ´Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ñ‹Ğ¼ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ¾Ğ¼ ({option_values})."
                        )
                        key_specific_errors = True

                if not key_specific_errors:
                    validated_settings[key] = validated_value

            except (ValueError, TypeError) as e_val:
                validation_errors.append(
                    f"ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‚Ğ¸Ğ¿Ğ°/Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ '{key}' ('{value_to_validate}'): Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ»ÑÑ {setting_mft_def.type}. {e_val}"
                )
            except Exception as e_unknown_val:
                validation_errors.append(f"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ '{key}': {e_unknown_val}")

        if validation_errors:
            error_message = f"ĞÑˆĞ¸Ğ±ĞºĞ¸ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}': {'; '.join(validation_errors)}"
            if module_info.error:
                module_info.error += f"; {error_message}"
            else:
                module_info.error = error_message
            self._logger.error(error_message)

        module_info.current_settings = validated_settings
        if validated_settings or not manifest.settings:
            self._logger.info(f"ĞĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}' Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹.")
            if validated_settings:
                self._logger.debug(f"Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}': {validated_settings}")
        else:
            self._logger.warning(
                f"Ğ”Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}' Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ/Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸, Ñ…Ğ¾Ñ‚Ñ Ğ¾Ğ½Ğ¸ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹ Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ."
            )

    def scan_all_available_modules(self) -> None:
        self.available_modules.clear()
        self._logger.info("ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ²ÑĞµÑ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹...")
        self._scan_directory_for_modules(self.plugins_root_dir, is_system_dir=False)
        self._scan_directory_for_modules(self.core_sys_modules_root_dir, is_system_dir=True)
        self._logger.info(f"Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾. Ğ’ÑĞµĞ³Ğ¾ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾: {len(self.available_modules)}")

    def _load_enabled_plugin_names(self) -> None:
        config_file = self._core_settings.enabled_modules_config_path
        self.enabled_plugin_names.clear()
        if config_file.is_file():
            try:
                with open(config_file, "r", encoding="utf-8") as f:
                    data = json.load(f)
                if isinstance(data, list):
                    self.enabled_plugin_names = [m_name for m_name in data if isinstance(m_name, str)]
                elif isinstance(data, dict) and "active_modules" in data and isinstance(data["active_modules"], list):
                    self.enabled_plugin_names = [m_name for m_name in data["active_modules"] if isinstance(m_name, str)]
                else:
                    self._logger.error(
                        f"ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ„Ğ°Ğ¹Ğ»Ğ° {config_file}. ĞĞ¶Ğ¸Ğ´Ğ°Ğ»ÑÑ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¸Ğ»Ğ¸ {{'active_modules': [...]}}."
                    )

                for name, module_info in self.available_modules.items():
                    if not module_info.is_system_module:
                        module_info.is_enabled = name in self.enabled_plugin_names
                self._logger.info(f"Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ² Ğ¸Ğ· {config_file}: {self.enabled_plugin_names}")
            except Exception as e:
                self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ÑĞ¿Ğ¸ÑĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ² Ğ¸Ğ· {config_file}: {e}", exc_info=True)
        else:
            self._logger.warning(f"Ğ¤Ğ°Ğ¹Ğ» ÑĞ¾ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ² {config_file} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.")

    def _check_module_dependencies(self, module_info: ModuleInfo) -> bool:
        if not module_info.manifest:
            return True
        if module_info.manifest.metadata and module_info.manifest.metadata.min_sdb_core_version:
            from packaging.version import parse as parse_version

            current_sdb_version_str = self._settings.core.sdb_version
            try:
                if parse_version(current_sdb_version_str) < parse_version(
                    module_info.manifest.metadata.min_sdb_core_version
                ):
                    module_info.error = (
                        f"Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ ÑĞ´Ñ€Ğ¾ SDB v >= {module_info.manifest.metadata.min_sdb_core_version}, "
                        f"Ñ‚ĞµĞºÑƒÑ‰Ğ°Ñ: {current_sdb_version_str}."
                    )
                    self._logger.error(f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_info.name}': {module_info.error}")
                    return False
            except Exception as e_ver:
                self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ Ğ²ĞµÑ€ÑĞ¸Ğ¹ ÑĞ´Ñ€Ğ° Ğ´Ğ»Ñ '{module_info.name}': {e_ver}")
                module_info.error = "ĞÑˆĞ¸Ğ±ĞºĞ° Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ° Ğ²ĞµÑ€ÑĞ¸Ğ¸ ÑĞ´Ñ€Ğ°."
                return False

        if module_info.manifest.sdb_module_dependencies:
            for dep_name in module_info.manifest.sdb_module_dependencies:
                dep_info = self.available_modules.get(dep_name)
                if (
                    not dep_info
                    or not (dep_info.is_enabled or dep_info.is_system_module)
                    or not dep_info.is_loaded_successfully
                ):
                    new_error_msg = f"Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¸ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ-Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ '{dep_name}'."
                    module_info.error = (module_info.error + "; " if module_info.error else "") + new_error_msg
                    self._logger.error(f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_info.name}': {new_error_msg}")
                    return False
        return True

    async def _setup_single_module(
        self, module_info: ModuleInfo, dp: Dispatcher, bot: Bot, import_base_path: str
    ) -> None:
        if not module_info.manifest and not module_info.is_system_module:
            module_info.error = "ĞœĞ°Ğ½Ğ¸Ñ„ĞµÑÑ‚ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚."
            self._logger.error(f"ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ '{module_info.name}': {module_info.error}")
            return

        if module_info.error:
            self._logger.error(
                f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_info.name}' Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ Ğ¸Ğ·-Ğ·Ğ° Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸: {module_info.error}"
            )
            return

        if not self._check_module_dependencies(module_info):
            return

        entry_point_py_file = module_info.path / MODULE_ENTRY_POINT_FILENAME
        if not entry_point_py_file.is_file():
            module_info.error = f"Ğ¤Ğ°Ğ¹Ğ» Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ²Ñ…Ğ¾Ğ´Ğ° '{MODULE_ENTRY_POINT_FILENAME}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½."
            self._logger.error(f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_info.name}': {module_info.error}")
            return
        try:
            import_path_str = f"{import_base_path}.{module_info.path.name}"
            self._logger.debug(f"Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_info.name}' Ñ‡ĞµÑ€ĞµĞ· '{import_path_str}'...")
            loaded_py_module = importlib.import_module(import_path_str)
            module_info.imported_py_module = loaded_py_module
            if not hasattr(loaded_py_module, SETUP_FUNCTION_NAME):
                module_info.error = f"Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ '{SETUP_FUNCTION_NAME}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°."
                self._logger.error(f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_info.name}': {module_info.error}")
                return

            setup_function: Callable = getattr(loaded_py_module, SETUP_FUNCTION_NAME)
            self._logger.info(f"Ğ’Ñ‹Ğ·Ğ¾Ğ² {SETUP_FUNCTION_NAME}() Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_info.name}'...")
            if asyncio.iscoroutinefunction(setup_function):
                await setup_function(dp=dp, bot=bot, services=self._services)
            else:
                setup_function(dp=dp, bot=bot, services=self._services)
            module_info.is_loaded_successfully = True
            
            # ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ UI Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ²Ñ…Ğ¾Ğ´Ğ° ÑĞ´Ñ€Ğ¾Ğ¼ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°
            if module_info.manifest:
                await self._auto_register_module_ui_entry(module_info)
            
            self._logger.success(f"âœ… ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_info.name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½.")
        except Exception as e:
            module_info.error = f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸/Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸: {e}"
            self._logger.error(f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_info.name}': {module_info.error}", exc_info=True)

    async def _auto_register_module_ui_entry(self, module_info: ModuleInfo) -> None:
        """
        ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ UI Ñ‚Ğ¾Ñ‡ĞºÑƒ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ ĞµĞ³Ğ¾ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°.
        Ğ¯Ğ´Ñ€Ğ¾ ÑĞ°Ğ¼Ğ¾ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚, ĞºĞ°Ğº Ğ¸ Ğ³Ğ´Ğµ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ² Ğ¼ĞµĞ½Ñ.
        """
        if not module_info.manifest:
            return
        
        manifest = module_info.manifest
        module_name = module_info.name
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ½Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ»Ğ¸ ÑƒĞ¶Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ
        if self._services.ui_registry.get_module_entry(module_name):
            self._logger.debug(f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' ÑƒĞ¶Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ² UI registry. ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ°Ğ²Ñ‚Ğ¾-Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ.")
            return
        
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°
        display_name = manifest.display_name
        description = manifest.description or ""
        
        # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ¸ĞºĞ¾Ğ½ĞºÑƒ: Ğ±ĞµÑ€ĞµĞ¼ Ğ¸Ğ· Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ñ Ğ¸ĞºĞ¾Ğ½ĞºĞ¾Ğ¹, Ğ¸Ğ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½ÑƒÑ
        icon = None
        if manifest.commands:
            for cmd in manifest.commands:
                if cmd.icon:
                    icon = cmd.icon
                    break
        
        # Ğ•ÑĞ»Ğ¸ Ğ¸ĞºĞ¾Ğ½ĞºĞ¸ Ğ½ĞµÑ‚ Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ñ…, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½ÑƒÑ
        if not icon:
            icon = "ğŸ§©"  # Ğ”ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ğ°Ñ Ğ¸ĞºĞ¾Ğ½ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        
        # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ² Ğ¼ĞµĞ½Ñ
        required_permission = get_module_required_permission(module_name, manifest)
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ callback data Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
        from Systems.core.ui.callback_data_factories import ModuleMenuEntry
        entry_callback_data = ModuleMenuEntry(module_name=module_name).pack()
        
        # Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ² UI registry
        success = self._services.ui_registry.register_module_entry(
            module_name=module_name,
            display_name=display_name,
            entry_callback_data=entry_callback_data,
            icon=icon,
            description=description,
            required_permission_to_view=required_permission
        )
        
        if success:
            self._logger.info(
                f"Ğ¯Ğ´Ñ€Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¾ UI-Ñ‚Ğ¾Ñ‡ĞºÑƒ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}' "
                f"('{display_name}'). Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°: '{required_permission or 'Ğ½ĞµÑ‚'}'."
            )
        else:
            self._logger.warning(f"Ğ¯Ğ´Ñ€Ñƒ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ UI-Ñ‚Ğ¾Ñ‡ĞºÑƒ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}'.")

    async def initialize_and_setup_modules(self, dp: Dispatcher, bot: Bot) -> None:
        self.scan_all_available_modules()
        self._load_enabled_plugin_names()

        # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµĞ¼ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ ÑĞ´Ñ€Ğ°
        self._logger.info("ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ ÑĞ´Ñ€Ğ°...")
        for module_name, module_info in self.available_modules.items():
            if module_info.is_system_module:
                if module_info.error:
                    self._logger.error(
                        f"Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ¸Ğ·-Ğ·Ğ° Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸: {module_info.error}"
                    )
                    continue
                await self._setup_single_module(
                    module_info,
                    dp,
                    bot,
                    import_base_path="Systems." + self.core_sys_modules_root_dir.parent.name
                    + "."
                    + self.core_sys_modules_root_dir.name,
                )
        self._logger.info("ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ ÑĞ´Ñ€Ğ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°.")

        if not self.enabled_plugin_names:
            self._logger.info("ĞĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ² Ğ´Ğ»Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸.")
        else:
            self._logger.info(f"ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° {len(self.enabled_plugin_names)} Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ²...")
            for plugin_name in self.enabled_plugin_names:
                module_info = self.available_modules.get(plugin_name)
                if not module_info:
                    self._logger.error(f"ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½ '{plugin_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞº.")
                    continue
                if module_info.is_system_module:
                    self._logger.warning(f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{plugin_name}' ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹, Ğ½Ğ¾ Ğ² ÑĞ¿Ğ¸ÑĞºĞµ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ². ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞº.")
                    continue
                if module_info.error:
                    self._logger.error(
                        f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{plugin_name}' Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ¸Ğ·-Ğ·Ğ° Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸: {module_info.error}"
                    )
                    continue
                await self._setup_single_module(module_info, dp, bot, import_base_path="Modules")
            self._logger.info("ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ² Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°.")

    def get_module_info(self, module_name: str) -> Optional[ModuleInfo]:
        return self.available_modules.get(module_name)

    def get_all_modules_info(self) -> List[ModuleInfo]:
        return list(self.available_modules.values())

    def get_loaded_modules_info(self, include_system: bool = True, include_plugins: bool = True) -> List[ModuleInfo]:
        loaded = []
        for info in self.available_modules.values():
            if info.is_loaded_successfully:
                if (info.is_system_module and include_system) or (not info.is_system_module and include_plugins):
                    loaded.append(info)
        return loaded

    def get_module_settings(self, module_name: str) -> Optional[Dict[str, Any]]:
        module_info = self.get_module_info(module_name)
        if module_info:
            if module_info.current_settings:
                return module_info.current_settings
            elif module_info.manifest and module_info.manifest.settings:
                manifest_defaults = {
                    k: v.default for k, v in module_info.manifest.settings.items() if v.default is not None
                }
                if manifest_defaults:
                    self._logger.debug(
                        f"current_settings Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}' Ğ¿ÑƒÑÑ‚Ñ‹, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ñ‹ Ğ¸Ğ· Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°."
                    )
                    return manifest_defaults
                else:
                    self._logger.debug(
                        f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¸Ğ»Ğ¸ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ñ‹Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ."
                    )
                    return {}  # Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ, ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚ Ğ½Ğ¸ current_settings, Ğ½Ğ¸ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ¾Ğ² Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ
            else:
                self._logger.debug(f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ.")
                return {}  # Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ
        self._logger.warning(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}'.")
        return None

    def get_all_declared_permissions_from_active_modules(self) -> List[PermissionManifest]:
        """
        Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ²ÑĞµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ, Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°Ñ… Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ…
        (enabled) Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ², Ğ° Ñ‚Ğ°ĞºĞ¶Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹.
        Ğ£Ñ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ±ĞµĞ· Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°.
        """
        all_perms: Dict[str, PermissionManifest] = {}

        modules_to_check: List[ModuleInfo] = []
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ñ‹
        for module_name in self.enabled_plugin_names:
            module_info = self.available_modules.get(module_name)
            if module_info and not module_info.is_system_module and not module_info.error:
                modules_to_check.append(module_info)

        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
        for module_info in self.available_modules.values():
            if module_info.is_system_module and not module_info.error:
                if (
                    module_info not in modules_to_check
                ):  # Ğ˜Ğ·Ğ±ĞµĞ³Ğ°ĞµĞ¼ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ, ĞµÑĞ»Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ ĞºĞ°Ğº-Ñ‚Ğ¾ Ğ¿Ğ¾Ğ¿Ğ°Ğ» Ğ² enabled_plugin_names
                    modules_to_check.append(module_info)

        for module_info in modules_to_check:
            if module_info.manifest and module_info.manifest.declared_permissions:
                for perm_mft in module_info.manifest.declared_permissions:
                    if perm_mft.name not in all_perms:
                        all_perms[perm_mft.name] = perm_mft
                    else:
                        self._logger.warning(
                            f"Ğ”ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‰ĞµĞµÑÑ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ '{perm_mft.name}' "
                            f"Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ (Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ: '{module_info.name}'). Ğ‘ÑƒĞ´ĞµÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ¿ĞµÑ€Ğ²Ğ¾Ğµ Ğ²ÑÑ‚Ñ€ĞµÑ‡ĞµĞ½Ğ½Ğ¾Ğµ."
                        )

        num_perms = len(all_perms)
        if num_perms > 0:
            self._logger.info(f"Ğ¡Ğ¾Ğ±Ñ€Ğ°Ğ½Ğ¾ {num_perms} ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹, Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¼Ğ¸/ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¼Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸.")
        else:
            self._logger.info("ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹, Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ² Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ…/ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ….")
        return list(all_perms.values())



======================================================================

------------------------------ FILE: Systems/core/bot_entrypoint.py ------------------------------
# core/bot_entrypoint.py

import asyncio
import sys
import os
from pathlib import Path
from typing import Optional, List, Dict, Any, TYPE_CHECKING
from datetime import datetime, timezone

from loguru import logger as global_logger

if not (hasattr(global_logger, '_core') and hasattr(global_logger._core, 'handlers') and global_logger._core.handlers):
    try:
        global_logger.remove()
        global_logger.add(sys.stderr, level="DEBUG")
        print("!!! [SDB bot_entrypoint WARNING] Loguru handlers Ğ±Ñ‹Ğ» Ğ¿ÑƒÑÑ‚ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ stderr Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ. !!!", file=sys.stderr)
    except Exception as e_loguru_init_fallback_entry:
        print(f"!!! [SDB bot_entrypoint CRITICAL] Loguru handlers Ğ¿ÑƒÑÑ‚ Ğ¸ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ stderr: {e_loguru_init_fallback_entry} !!!", file=sys.stderr)


from aiogram import Bot, Dispatcher, __version__ as aiogram_version
from aiogram.types import BotCommand
from aiogram.client.default import DefaultBotProperties
from aiogram.enums import ParseMode
from aiogram.fsm.storage.memory import MemoryStorage
# <--- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•: Ğ£Ğ”ĞĞ›Ğ•Ğ Ğ˜ĞœĞŸĞĞ Ğ¢ RedisStorage ĞĞ¢Ğ¡Ğ®Ğ”Ğ ---
# from aiogram.fsm.storage.redis import RedisStorage
from aiogram.exceptions import TelegramRetryAfter

from Systems.core.app_settings import settings
from Systems.core.services_provider import BotServicesProvider
from Systems.core.module_loader import ModuleLoader
from Systems.core.ui.handlers_core_ui import core_ui_router
from Systems.core.i18n.middleware import I18nMiddleware
from Systems.core.i18n.translator import Translator
from Systems.core.security.command_dedup import CommandDedupMiddleware
from Systems.core.users.middleware import UserStatusMiddleware
from Systems.core.logging_manager import LoggingManager
from Systems.core.fsm.storage_factory import build_fsm_storage

if TYPE_CHECKING:
    from aiogram.fsm.storage.redis import RedisStorage # <--- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•: Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ´Ğ»Ñ type hinting

PID_FILENAME = "sdb_bot.pid"
CORE_COMMANDS_DESCRIPTIONS = {
    "start": "ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ° / ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ",
    "help": "â“ ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ Ğ¸ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ±Ğ¾Ñ‚Ğ°",
    "login": "ğŸŒ Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ",
    "reset_password": "ğŸ” Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ",
}

try:
    from Systems.core.admin import admin_router
    ADMIN_ROUTER_AVAILABLE = True
    global_logger.info("Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ (Systems.core.admin.admin_router) ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
except ImportError:
    admin_router = None
    ADMIN_ROUTER_AVAILABLE = False
    global_logger.info("Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½. ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°.")


async def _setup_bot_commands(bot: Bot, services: 'BotServicesProvider', admin_router_available: bool):
    module_name_for_log = "CoreBotSetup"
    global_logger.debug(f"[{module_name_for_log}] ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ±Ğ¾Ñ‚Ğ° Ğ² Telegram...")

    final_commands_dict: Dict[str, str] = {}

    for cmd_name, cmd_desc in CORE_COMMANDS_DESCRIPTIONS.items():
        if cmd_name not in final_commands_dict:
            final_commands_dict[cmd_name] = cmd_desc
    global_logger.trace(f"[{module_name_for_log}] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ ÑĞ´Ñ€Ğ°: {list(CORE_COMMANDS_DESCRIPTIONS.keys())}")

    all_loaded_plugin_modules_info = services.modules.get_loaded_modules_info(include_system=False, include_plugins=True)
    for module_info in all_loaded_plugin_modules_info:
        if module_info.manifest and module_info.manifest.commands:
            global_logger.trace(f"[{module_name_for_log}] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ´Ğ»Ñ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ°: {module_info.name}")
            for cmd_manifest in module_info.manifest.commands:
                if not cmd_manifest.admin_only:
                    if cmd_manifest.command not in final_commands_dict:
                        final_commands_dict[cmd_manifest.command] = cmd_manifest.description

    # ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /admin ÑƒĞ±Ñ€Ğ°Ğ½Ğ° Ğ¸Ğ· Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞ¿Ğ¸ÑĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ¿Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑĞ¼ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
    # Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ğ¾ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ»ÑĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ² Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¼ Ğ¼ĞµĞ½Ñ
    # Ğ¸ ÑĞºÑ€Ñ‹Ñ‚ÑƒÑ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /admin_cp Ğ´Ğ»Ñ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²
    if admin_router_available:
        global_logger.trace(f"[{module_name_for_log}] ĞĞ´Ğ¼Ğ¸Ğ½-Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½, Ğ½Ğ¾ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /admin Ğ½Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ² Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ (Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ)")

    final_bot_commands = [
        BotCommand(command=name, description=desc) for name, desc in final_commands_dict.items()
    ]

    if final_bot_commands:
        try:
            await bot.set_my_commands(final_bot_commands)
            global_logger.success(f"[{module_name_for_log}] Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ {len(final_bot_commands)} ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ±Ğ¾Ñ‚Ğ° Ğ² Telegram: "
                                  f"{[cmd.command for cmd in final_bot_commands]}")
        except Exception as e:
            global_logger.error(f"[{module_name_for_log}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ±Ğ¾Ñ‚Ğ°: {e}", exc_info=True)
    else:
        global_logger.warning(f"[{module_name_for_log}] ĞĞµÑ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ´Ğ»Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ğ² Telegram.")


async def run_sdb_bot() -> int:
    # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ .env Ñ„Ğ°Ğ¹Ğ» Ğ² Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
    from dotenv import load_dotenv
    load_dotenv('.env')
    
    from Systems.core.app_settings import load_app_settings
    settings = load_app_settings()
    
    current_process_start_time = datetime.now(timezone.utc)
    sdb_version = settings.core.sdb_version

    logging_manager = LoggingManager(app_settings=settings)
    await logging_manager.initialize_logging()

    global_logger.info(f"Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°. "
                       f"Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ»Ğ¾Ğ³Ğ°: {settings.core.log_level.upper()} (Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½ SDB_CLI_DEBUG_MODE_FOR_LOGGING). "
                       f"Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ»Ğ¾Ğ³Ğ° Ğ²ÑĞµĞ³Ğ´Ğ° DEBUG (Ğ¸Ğ»Ğ¸ TRACE, ĞµÑĞ»Ğ¸ Ñ‚Ğ°Ğº Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¾ Ğ² LoggingManager).")

    global_logger.info(f"ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº SwiftDevBot (SDB) v{sdb_version} Ğ² {current_process_start_time.strftime('%Y-%m-%d %H:%M:%S %Z')}...")
    global_logger.info(f"ğŸ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Python v{sys.version_info.major}.{sys.version_info.minor}.{sys.version_info.micro}")
    global_logger.info(f"ğŸ¤– Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Aiogram v{aiogram_version}")
    global_logger.debug(f"ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° (CWD): {Path.cwd()}")
    global_logger.debug(f"ĞšĞ¾Ñ€ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°: {settings.core.project_data_path.parent}")
    global_logger.debug(f"Ğ”Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°: {settings.core.project_data_path}")

    pid_file_actual_path = settings.core.project_data_path / PID_FILENAME
    bot: Optional[Bot] = None
    services: Optional[BotServicesProvider] = None
    exit_code_internal = 1

    if pid_file_actual_path.exists():
        try:
            old_pid = int(pid_file_actual_path.read_text().strip())
            if sys.platform != "win32":
                os.kill(old_pid, 0)
                global_logger.error(f"ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ PID-Ñ„Ğ°Ğ¹Ğ» ({pid_file_actual_path}) Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‰ĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° PID {old_pid}. "
                                   f"ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº SDB (PID: {os.getpid()}) Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½. ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€.")
                if logging_manager: await logging_manager.shutdown_logging()
                return 1
        except (OSError, ValueError):
            global_logger.info(f"Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞµĞ³Ğ¾ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ³Ğ¾ PID-Ñ„Ğ°Ğ¹Ğ»Ğ°: {pid_file_actual_path}")
            pid_file_actual_path.unlink(missing_ok=True)
        except Exception as e_pid_precheck:
             global_logger.warning(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ²Ğ°Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ PID-Ñ„Ğ°Ğ¹Ğ»Ğ°: {e_pid_precheck}")

    try:
        pid_file_actual_path.parent.mkdir(parents=True, exist_ok=True)
        with open(pid_file_actual_path, "w") as f:
            f.write(str(os.getpid()))
        global_logger.info(f"PID {os.getpid()} Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½ Ğ² {pid_file_actual_path}")
    except Exception as e_pid_write:
        global_logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ/Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ PID-Ñ„Ğ°Ğ¹Ğ» {pid_file_actual_path}: {e_pid_write}. "
                           "Ğ‘Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ, Ğ½Ğ¾ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· PID-Ñ„Ğ°Ğ¹Ğ» Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¾.")
    try:
        services = BotServicesProvider(settings=settings)
        await services.setup_services()
        global_logger.success("âœ… BotServicesProvider Ğ¸ Ğ²ÑĞµ ĞµĞ³Ğ¾ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹.")

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ½ĞµĞ¿Ğ¾ÑÑ€ĞµĞ´ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ±Ğ¾Ñ‚Ğ°
        if not services.config.telegram.token:
            global_logger.critical("BOT_TOKEN Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚. Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ñ‚Ğ¾ĞºĞµĞ½ Ğ² .env Ğ¸Ğ»Ğ¸ YAML Ğ¿ĞµÑ€ĞµĞ´ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ¼ Ğ±Ğ¾Ñ‚Ğ°.")
            if logging_manager:
                await logging_manager.shutdown_logging()
            return 1

        bot = Bot(
            token=services.config.telegram.token,
            default=DefaultBotProperties(parse_mode=ParseMode.HTML)
        )
        me = await bot.get_me()
        global_logger.info(f"ğŸ¤– Ğ­ĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€ Telegram Bot ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½: @{me.username} (ID: {me.id})")

        try:
            storage = await build_fsm_storage(services.cache, services.config.cache)
        except AttributeError as e_cache_err:
            global_logger.warning(
                "CacheManager Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ´Ğ»Ñ FSM; Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ MemoryStorage. "
                f"ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚Ğ¸: {e_cache_err}"
            )
            storage = MemoryStorage()

        dp = Dispatcher(storage=storage, services_provider=services)
        global_logger.info("ğŸš¦ Dispatcher Ğ¸ FSM Storage Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹.")

        translator = Translator(
            locales_dir=settings.core.i18n.locales_dir,
            domain=settings.core.i18n.domain,
            default_locale=settings.core.i18n.default_locale,
            available_locales=settings.core.i18n.available_locales
        )
        dp.update.outer_middleware(I18nMiddleware(translator))
        global_logger.info("I18nMiddleware Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Update.")

        command_dedup_middleware = CommandDedupMiddleware()
        dp.update.outer_middleware(command_dedup_middleware)
        global_logger.info("CommandDedupMiddleware Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Update.")

        # Rate Limiting Middleware
        from Systems.core.security.rate_limiter import RateLimitMiddleware, RateLimiter
        rate_limiter = RateLimiter(default_limit=10, default_window=60)
        rate_limiter_middleware = RateLimitMiddleware(rate_limiter)
        # Ğ˜ÑĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ² Ğ¸Ğ· rate limiting
        for admin_id in services.config.core.super_admins:
            rate_limiter_middleware.exempt_user(admin_id)
        dp.update.outer_middleware(rate_limiter_middleware)
        global_logger.info("RateLimitMiddleware Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Update.")

        # Input Validation Middleware
        from Systems.core.security.input_validator import InputValidationMiddleware
        input_validator_middleware = InputValidationMiddleware()
        # Ğ˜ÑĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ² Ğ¸Ğ· Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸
        for admin_id in services.config.core.super_admins:
            input_validator_middleware.exempt_user(admin_id)
        dp.update.outer_middleware(input_validator_middleware)
        global_logger.info("InputValidationMiddleware Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Update.")

        # Error Handler Middleware
        from Systems.core.errors.handler import ErrorHandlerMiddleware
        dp.update.outer_middleware(ErrorHandlerMiddleware())
        global_logger.info("ErrorHandlerMiddleware Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Update.")

        # Metrics Middleware
        from Systems.core.monitoring.metrics import MetricsMiddleware, get_metrics_collector
        metrics_collector = get_metrics_collector()
        dp.update.outer_middleware(MetricsMiddleware(metrics_collector))
        global_logger.info("MetricsMiddleware Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Update.")

        dp.update.outer_middleware(UserStatusMiddleware())
        global_logger.info("UserStatusMiddleware Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Update.")

        dp.include_router(core_ui_router)
        global_logger.info(f"Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ UI-Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ ÑĞ´Ñ€Ğ° '{core_ui_router.name}' Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")

        if ADMIN_ROUTER_AVAILABLE and admin_router:
            try:
                dp.include_router(admin_router)
                global_logger.critical(f"âœ… Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ '{admin_router.name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½")
            except Exception as e:
                global_logger.critical(f"âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ğ°: {e}", exc_info=True)
        else:
            global_logger.critical(f"âŒ ĞĞ´Ğ¼Ğ¸Ğ½-Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ½Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½: ADMIN_ROUTER_AVAILABLE={ADMIN_ROUTER_AVAILABLE}, admin_router={'ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚' if admin_router else 'Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚'}")

        module_loader: ModuleLoader = services.modules
        await module_loader.initialize_and_setup_modules(dp=dp, bot=bot)

        num_enabled_plugins = len(module_loader.enabled_plugin_names)
        num_loaded_plugins = sum(1 for mi in module_loader.get_loaded_modules_info(include_system=False, include_plugins=True) if mi.is_enabled)

        global_logger.info(
            f"ğŸ§© Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ² Ğ¸Ğ· 'Modules/': {num_loaded_plugins} Ğ¸Ğ· {num_enabled_plugins} Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¾."
        )
        if num_loaded_plugins < num_enabled_plugins:
            global_logger.warning("âš ï¸ ĞĞµ Ğ²ÑĞµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ñ‹ Ğ±Ñ‹Ğ»Ğ¸ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹. Ğ¡Ğ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸ Ğ²Ñ‹ÑˆĞµ.")

        global_logger.debug("Ğ’ÑĞµ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ñ‹ (ÑĞ´Ñ€Ğ°, ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ, Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ñ‹) Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ² Dispatcher.")

        if settings.core.setup_bot_commands_on_startup:
            await _setup_bot_commands(bot, services, admin_router_available=ADMIN_ROUTER_AVAILABLE)
        else:
            global_logger.info("ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ±Ğ¾Ñ‚Ğ° Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ° Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ….")

        @dp.startup()
        async def on_bot_startup():
            nonlocal sdb_version
            bot_info = await bot.get_me()
            services.logger.info(f"ğŸš€ Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ SDB Core - Dispatcher startup Ğ´Ğ»Ñ @{bot_info.username}...")
            try:
                await bot.delete_webhook(drop_pending_updates=True)
                services.logger.info("Webhook ÑƒĞ´Ğ°Ğ»ĞµĞ½, Ğ¾Ğ¶Ğ¸Ğ´Ğ°ÑÑ‰Ğ¸Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½Ñ‹.")
            except Exception as e_startup_hook:
                services.logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ½Ğ° ÑÑ‚Ğ°Ğ¿Ğµ startup Ğ´Ğ¸ÑĞ¿ĞµÑ‚Ñ‡ĞµÑ€Ğ°: {e_startup_hook}", exc_info=True)

            services.logger.success(f"âš¡ SDB Core v{sdb_version} - Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°! @{bot_info.username} Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ!")
            if services.config.core.super_admins and services.config.core.enable_startup_shutdown_notifications:
                for admin_id in services.config.core.super_admins:
                    try:
                        await bot.send_message(admin_id, f"ğŸš€ **SDB Core v{sdb_version}**\n\nâš¡ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°\nğŸ”§ ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹\nğŸŒ API Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½\n\n@{bot_info.username} Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ! ğŸ¯")
                    except Exception as e_send:
                        services.logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ñƒ {admin_id}: {e_send}")
            elif not services.config.core.enable_startup_shutdown_notifications:
                services.logger.info("ğŸ”• Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ/Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ….")

        @dp.shutdown()
        async def on_bot_shutdown():
            nonlocal logging_manager
            bot_info = await bot.get_me()
            services.logger.info(f"ğŸ”„ SDB Core shutdown - ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ @{bot_info.username}...")

            if services and services.config.core.super_admins and services.config.core.enable_startup_shutdown_notifications:
                for admin_id in services.config.core.super_admins:
                    try:
                        await bot.send_message(admin_id, f"ğŸ”„ **SDB Core v{sdb_version}**\n\nâ³ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ\nğŸ›¡ï¸ Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ²\nğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…\n\n@{bot_info.username} Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ...")
                    except Exception as e_send:
                         services.logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ñƒ {admin_id}: {e_send}")
            elif services and not services.config.core.enable_startup_shutdown_notifications:
                services.logger.info("ğŸ”• Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ/Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ….")

            if logging_manager:
                await logging_manager.shutdown_logging()

            if pid_file_actual_path.exists():
                try:
                    pid_in_file = int(pid_file_actual_path.read_text().strip())
                    if pid_in_file == os.getpid():
                        pid_file_actual_path.unlink(missing_ok=True)
                        global_logger.info(f"PID-Ñ„Ğ°Ğ¹Ğ» {pid_file_actual_path} ÑƒĞ´Ğ°Ğ»ĞµĞ½ Ğ¿Ñ€Ğ¸ ÑˆÑ‚Ğ°Ñ‚Ğ½Ğ¾Ğ¹ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ (on_bot_shutdown).")
                    else:
                         global_logger.info(f"PID-Ñ„Ğ°Ğ¹Ğ» {pid_file_actual_path} (PID: {pid_in_file}) Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ¸Ñ‚ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¼Ñƒ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑÑƒ (PID: {os.getpid()}). Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾ Ğ² on_bot_shutdown.")
                except Exception as e_unlink_pid_shutdown:
                    global_logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ PID-Ñ„Ğ°Ğ¹Ğ» {pid_file_actual_path} Ğ² on_bot_shutdown: {e_unlink_pid_shutdown}")

            global_logger.info(f"âœ… SDB Core shutdown Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½ Ğ´Ğ»Ñ @{bot_info.username} (ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹ Ğ² finally).")

        bot_username_for_log = (await bot.get_me()).username
        global_logger.info(f"ğŸŒ SDB Core - Ğ—Ğ°Ğ¿ÑƒÑĞº Telegram Bot Polling Ğ´Ğ»Ñ @{bot_username_for_log}...")

        await dp.start_polling(bot)
        exit_code_internal = 0

    except (KeyboardInterrupt, SystemExit) as e_exit:
        global_logger.info(f"ğŸš¨ ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½ ÑĞ¸Ğ³Ğ½Ğ°Ğ» Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ ({type(e_exit).__name__}). ĞŸĞ¾Ğ»Ğ»Ğ¸Ğ½Ğ³ Ğ¿Ñ€ĞµÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ...")
        exit_code_internal = 0
    except Exception as e_main_run:
        global_logger.critical(f"âŒ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ ĞĞ¨Ğ˜Ğ‘ĞšĞ Ğ² Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ run_sdb_bot: {e_main_run}", exc_info=True)
        exit_code_internal = 1
    finally:
        global_logger.info("Ğ‘Ğ»Ğ¾Ğº finally Ğ² run_sdb_bot.")

        if bot:
            try:
                global_logger.info("Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¸ Ğ±Ğ¾Ñ‚Ğ° Ğ±ÑƒĞ´ĞµÑ‚ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ¾ Aiogram Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğ¸ Dispatcher.start_polling.")
            except TelegramRetryAfter as e_retry:
                global_logger.warning(f"TelegramRetryAfter Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞµ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ ÑĞµÑÑĞ¸Ñ Ğ±Ğ¾Ñ‚Ğ° (Ğ¸Ğ»Ğ¸ ÑƒĞ¶Ğµ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ ĞµĞµ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Aiogram): {e_retry}")
            except Exception as e_bot_close:
                global_logger.warning(f"ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸ÑÑ… Ñ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ¼ Ğ±Ğ¾Ñ‚Ğ° Ğ² finally: {type(e_bot_close).__name__} - {e_bot_close}", exc_info=True)

        if services:
            try:
                await services.close_services()
                global_logger.info("Ğ’ÑĞµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ BotServicesProvider ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ² Ğ±Ğ»Ğ¾ĞºĞµ finally.")
            except Exception as e_services_close:
                global_logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² Ğ² Ğ±Ğ»Ğ¾ĞºĞµ finally: {e_services_close}", exc_info=True)

        if logging_manager and logging_manager._is_initialized:
            await logging_manager.shutdown_logging()

        if pid_file_actual_path.exists():
            try:
                pid_in_file = int(pid_file_actual_path.read_text().strip())
                if pid_in_file == os.getpid():
                    pid_file_actual_path.unlink(missing_ok=True)
                    global_logger.info(f"PID-Ñ„Ğ°Ğ¹Ğ» {pid_file_actual_path} ÑƒĞ´Ğ°Ğ»ĞµĞ½/Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½ Ğ² Ğ±Ğ»Ğ¾ĞºĞµ finally.")
            except Exception as e_final_pid_unlink:
                global_logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ/Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ PID-Ñ„Ğ°Ğ¹Ğ» {pid_file_actual_path}: {e_final_pid_unlink}")

        bot_name_display = getattr(bot, 'id', 'N/A') if bot else 'N/A'
        if bot and hasattr(bot, 'username') and bot.username:
            bot_name_display = f"@{bot.username} (ID: {bot.id})"

        global_logger.info(f"ğŸ¯ SDB Core Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½ ({bot_name_display}) - ĞšĞ¾Ğ´ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ°: {exit_code_internal}")
        return exit_code_internal


======================================================================

------------------------------ FILE: Systems/core/logging_manager.py ------------------------------
# core/logging_manager.py
import asyncio
import shutil
from pathlib import Path
from datetime import datetime, timedelta, timezone
from typing import Optional, Any, TYPE_CHECKING

from loguru import logger as global_logger 
import parsedatetime as pdt 
from apscheduler.schedulers.asyncio import AsyncIOScheduler 
from apscheduler.triggers.cron import CronTrigger

if TYPE_CHECKING:
    from Systems.core.app_settings import AppSettings

class LoggingManager:
    def __init__(self, app_settings: 'AppSettings'):
        self._settings = app_settings.core
        self._app_settings_ref = app_settings 
        self._current_log_handler_id: Optional[int] = None
        self._current_log_file_path: Optional[Path] = None
        self._scheduler: Optional[AsyncIOScheduler] = None
        self._is_initialized = False

        self._logger = global_logger.bind(service="LoggingManager")
        self._logger.info("LoggingManager Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")

    def _get_log_file_path_for_current_hour(self) -> Path:
        """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ»Ğ¾Ğ³-Ñ„Ğ°Ğ¹Ğ»Ñƒ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸."""
        now = datetime.now(timezone.utc)
        year_str = now.strftime("%Y")
        month_num_str = now.strftime("%m")
        month_name_str = now.strftime("%B") # Ğ˜Ğ¼Ñ Ğ¼ĞµÑÑÑ†Ğ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ğ»Ğ¾ĞºĞ°Ğ»Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
        day_str = now.strftime("%d")
        hour_str = now.strftime("%H")

        base_logs_dir = self._app_settings_ref.core.project_data_path / self._settings.log_structured_dir
        
        target_dir = base_logs_dir / year_str / f"{month_num_str}-{month_name_str}" / day_str
        target_dir.mkdir(parents=True, exist_ok=True)
        
        return target_dir / f"{hour_str}_sdb.log"

    def _setup_loguru_file_sink(self) -> None: 
        """ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ (Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚) Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ğ¹ sink Ğ´Ğ»Ñ Loguru."""
        if self._current_log_handler_id is not None:
            try:
                global_logger.remove(self._current_log_handler_id)
                self._logger.trace(f"ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ğ¹ Ñ…ĞµĞ½Ğ´Ğ»ĞµÑ€ (ID: {self._current_log_handler_id}) ÑƒĞ´Ğ°Ğ»ĞµĞ½.")
            except ValueError:
                self._logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ğ¹ Ñ…ĞµĞ½Ğ´Ğ»ĞµÑ€ ID: {self._current_log_handler_id} (Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, ÑƒĞ¶Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½).")
            self._current_log_handler_id = None
            self._current_log_file_path = None

        if not self._settings.log_to_file:
            self._logger.info("Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ² Ñ„Ğ°Ğ¹Ğ» Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ° Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ….")
            return

        new_log_file_path = self._get_log_file_path_for_current_hour()
        
        # --- Ğ–Ğ•Ğ¡Ğ¢ĞšĞ Ğ£Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ˜Ğ’ĞĞ•Ğœ Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ Ğ”Ğ›Ğ¯ Ğ¤ĞĞ™Ğ›ĞĞ’ĞĞ“Ğ Ğ›ĞĞ“Ğ ---
        log_level_for_file = "DEBUG"  # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ DEBUG Ğ´Ğ»Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
        # Ğ•ÑĞ»Ğ¸ Ğ½ÑƒĞ¶ĞµĞ½ TRACE, Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸ Ğ·Ğ´ĞµÑÑŒ:
        # log_level_for_file = "TRACE" 
        # ---------------------------------------------------------
        
        try:
            handler_id = global_logger.add(
                sink=str(new_log_file_path),
                level=log_level_for_file, 
                rotation=self._settings.log_rotation_size, 
                compression="zip",
                format="{time:YYYY-MM-DD HH:mm:ss.SSS} | {level: <8} | {name}:{function}:{line} - {message}",
                encoding="utf-8",
                enqueue=True,
                backtrace=True,
                diagnose=True 
            )
            self._current_log_handler_id = handler_id
            self._current_log_file_path = new_log_file_path
            self._logger.success(f"Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ğ¹ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½. Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: {log_level_for_file}. Ğ¤Ğ°Ğ¹Ğ»: {new_log_file_path}")
        except Exception as e:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€Ğ° Ğ´Ğ»Ñ '{new_log_file_path}': {e}", exc_info=True)
            self._current_log_handler_id = None
            self._current_log_file_path = None

    async def _hourly_log_rotation_check(self) -> None:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ»Ğ¸ Ñ€Ğ¾Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ³-Ñ„Ğ°Ğ¹Ğ» (Ğ½Ğ°Ñ‡Ğ°Ğ»ÑÑ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ‡Ğ°Ñ)."""
        self._logger.trace("Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ ĞµĞ¶ĞµÑ‡Ğ°ÑĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ»Ğ¾Ğ³Ğ¾Ğ²...")
        if not self._is_initialized or not self._settings.log_to_file:
            self._logger.trace("ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ°: Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ¸Ğ»Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Ñ„Ğ°Ğ¹Ğ» Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾.")
            return

        expected_log_file = self._get_log_file_path_for_current_hour()
        if self._current_log_file_path != expected_log_file:
            self._logger.info(f"ĞĞ°Ñ‡Ğ°Ğ»ÑÑ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ‡Ğ°Ñ. ĞŸĞµÑ€ĞµĞ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€Ğ° Ğ½Ğ°: {expected_log_file}")
            self._setup_loguru_file_sink() 
        else:
            self._logger.trace(f"Ğ Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ»Ğ¾Ğ³-Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ, Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ„Ğ°Ğ¹Ğ»: {self._current_log_file_path}")

    async def _cleanup_old_logs(self) -> None:
        """Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ log_retention_period_structured."""
        self._logger.info("Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ²...")
        if not self._settings.log_to_file:
            self._logger.info("ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ°: Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Ñ„Ğ°Ğ¹Ğ» Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾.")
            return

        retention_str = self._settings.log_retention_period_structured
        cal = pdt.Calendar()
        
        now_dt = datetime.now(timezone.utc)
        past_target_dt, parse_status = cal.parseDT(f"{retention_str} ago", sourceTime=now_dt) # type: ignore
        
        if parse_status == 0 or not past_target_dt:
            self._logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ñ€Ğ°ÑĞ¿Ğ°Ñ€ÑĞ¸Ñ‚ÑŒ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ²: '{retention_str}'. ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°.")
            return
        
        cutoff_date = past_target_dt 
        self._logger.info(f"ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ»Ğ¾Ğ³Ğ¾Ğ² ÑÑ‚Ğ°Ñ€ÑˆĞµ {cutoff_date.strftime('%Y-%m-%d %H:%M:%S %Z')} (Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´: '{retention_str}').")

        structured_logs_root = self._app_settings_ref.core.project_data_path / self._settings.log_structured_dir
        if not structured_logs_root.is_dir():
            return

        deleted_dirs_count = 0
        for year_dir in structured_logs_root.iterdir():
            if year_dir.is_dir() and year_dir.name.isdigit():
                if int(year_dir.name) < cutoff_date.year:
                    try:
                        shutil.rmtree(year_dir)
                        self._logger.info(f"Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ° Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ² (Ğ³Ğ¾Ğ´): {year_dir}")
                        deleted_dirs_count += 1
                    except Exception as e_rm_year:
                        self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ»Ğ¾Ğ³Ğ¾Ğ² '{year_dir}': {e_rm_year}")
                    continue 

                if int(year_dir.name) == cutoff_date.year:
                    for month_dir in year_dir.iterdir():
                        if month_dir.is_dir() and "-" in month_dir.name:
                            try:
                                month_num_str = month_dir.name.split("-")[0]
                                if month_num_str.isdigit() and int(month_num_str) < cutoff_date.month:
                                    shutil.rmtree(month_dir)
                                    self._logger.info(f"Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ° Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ² (Ğ¼ĞµÑÑÑ†): {month_dir}")
                                    deleted_dirs_count +=1
                                    continue
                                
                                if int(month_num_str) == cutoff_date.month:
                                    for day_dir in month_dir.iterdir():
                                        if day_dir.is_dir() and day_dir.name.isdigit():
                                            if int(day_dir.name) < cutoff_date.day:
                                                shutil.rmtree(day_dir)
                                                self._logger.info(f"Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ° Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ² (Ğ´ĞµĞ½ÑŒ): {day_dir}")
                                                deleted_dirs_count += 1
                            except Exception as e_rm_month_day:
                                self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ»Ğ¾Ğ³Ğ¾Ğ² '{month_dir}' Ğ¸Ğ»Ğ¸ ĞµĞµ Ğ¿Ğ¾Ğ´Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸: {e_rm_month_day}")
        if deleted_dirs_count > 0:
            self._logger.success(f"ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°. Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹: {deleted_dirs_count}.")
        else:
            self._logger.info("ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°. ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ.")


    async def initialize_logging(self) -> None: 
        """Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ, Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ğ¹ sink Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ."""
        if self._is_initialized:
            self._logger.info("LoggingManager ÑƒĞ¶Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
            return

        self._logger.info("ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ LoggingManager...")
        
        self._setup_loguru_file_sink() 
        
        self._scheduler = AsyncIOScheduler(timezone=str(timezone.utc))
        self._scheduler.add_job(self._hourly_log_rotation_check, CronTrigger(minute=0)) 
        self._logger.info("Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° _hourly_log_rotation_check Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ² Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº (ĞµĞ¶ĞµÑ‡Ğ°ÑĞ½Ğ¾).")
        self._scheduler.add_job(self._cleanup_old_logs, CronTrigger(hour=3, minute=30)) 
        self._logger.info("Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° _cleanup_old_logs Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ² Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº (ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾ Ğ² 03:30 UTC).")
        
        try:
            self._scheduler.start()
            self._logger.success("ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ·Ğ°Ğ´Ğ°Ñ‡ LoggingManager ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½.")
        except Exception as e_scheduler_start:
            self._logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ·Ğ°Ğ´Ğ°Ñ‡ LoggingManager: {e_scheduler_start}", exc_info=True)
            self._scheduler = None 

        self._is_initialized = True
        self._logger.info("LoggingManager ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")

    async def shutdown_logging(self) -> None:
        """ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ¸ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ°ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ."""
        self._logger.info("ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ´ÑƒÑ€Ñ‹ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ LoggingManager...")
        if self._scheduler and self._scheduler.running:
            try:
                self._scheduler.shutdown(wait=False) 
                self._logger.info("ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ·Ğ°Ğ´Ğ°Ñ‡ LoggingManager Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½.")
            except Exception as e_scheduler_shutdown:
                self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸ĞºĞ° LoggingManager: {e_scheduler_shutdown}", exc_info=True)
        
        if self._current_log_handler_id is not None:
            try:
                global_logger.remove(self._current_log_handler_id)
                self._logger.info(f"Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ğ¹ Ñ…ĞµĞ½Ğ´Ğ»ĞµÑ€ (ID: {self._current_log_handler_id}) ÑƒĞ´Ğ°Ğ»ĞµĞ½ Ğ¿Ñ€Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ.")
            except ValueError:
                pass 
        
        self._is_initialized = False
        self._logger.info("LoggingManager Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½.")


======================================================================

------------------------------ FILE: Systems/core/app_settings.py ------------------------------
# core/app_settings.py

import os
import sys
import warnings
import yaml
from pathlib import Path
from typing import List, Optional, Literal, Any, Dict 
from pydantic import BaseModel, Field, field_validator, HttpUrl, ValidationInfo, AliasChoices

# ĞŸĞ¾Ğ´Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ urllib3 Ğ¾ LibreSSL/OpenSSL (Ğ½Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸)
warnings.filterwarnings("ignore", message="urllib3 v2 only supports OpenSSL 1.1.1+")

try:
    from loguru import logger as global_logger 
except ImportError:
    import logging
    global_logger = logging.getLogger("sdb_app_settings_fallback")
    global_logger.warning("Loguru Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ logging. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Loguru.")

from dotenv import load_dotenv, find_dotenv
from pydantic.networks import PostgresDsn, MySQLDsn, AnyUrl 
from pydantic_settings import BaseSettings, SettingsConfigDict

PROJECT_ROOT_DIR = Path(__file__).resolve().parent.parent.parent
print(f"DEBUG: PROJECT_ROOT_DIR = {PROJECT_ROOT_DIR}")
ENV_FILENAME = ".env"
DEFAULT_PROJECT_DATA_DIR_NAME = "Data" 
USER_CONFIG_DIR_NAME = "Config" 
USER_CONFIG_FILENAME = "core_settings.yaml"
ENABLED_MODULES_FILENAME = "enabled_modules.json" 
ROOT_CONFIG_TEMPLATE_FILENAME = "config.yaml" 
STRUCTURED_LOGS_ROOT_DIR_NAME = "Logs" 

CLI_MODE = os.environ.get("SDB_CLI_MODE", "false").lower() == "true"
VERBOSE_MODE = os.environ.get("SDB_VERBOSE", "false").lower() == "true"
env_file_path_for_dotenv = None
BOT_TOKEN_FROM_DOTENV: Optional[str] = None
if not CLI_MODE:
    env_file_path_for_dotenv = find_dotenv(filename=ENV_FILENAME, usecwd=True, raise_error_if_not_found=False)
    if env_file_path_for_dotenv and Path(env_file_path_for_dotenv).exists():
        global_logger.info(f"ĞĞ°Ğ¹Ğ´ĞµĞ½ .env Ñ„Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ python-dotenv: {env_file_path_for_dotenv}")
        load_dotenv(dotenv_path=env_file_path_for_dotenv, override=True)
        BOT_TOKEN_FROM_DOTENV = os.getenv("BOT_TOKEN")
        if BOT_TOKEN_FROM_DOTENV:
            global_logger.info(f"BOT_TOKEN ('****{BOT_TOKEN_FROM_DOTENV[-4:]}') Ğ¿Ñ€ĞµĞ´Ğ²Ğ°Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ Ğ¸Ğ· .env Ñ„Ğ°Ğ¹Ğ»Ğ°.")
        else:
            global_logger.warning(f"BOT_TOKEN Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² {env_file_path_for_dotenv} Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ñ‡ĞµÑ€ĞµĞ· python-dotenv/os.getenv.")
    else:
        env_file_at_root = PROJECT_ROOT_DIR / ENV_FILENAME
        if env_file_at_root.exists() and env_file_at_root.is_file():
            global_logger.info(f"ĞĞ°Ğ¹Ğ´ĞµĞ½ .env Ñ„Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ python-dotenv (Ğ²Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ² ĞºĞ¾Ñ€Ğ½Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°): {env_file_at_root}")
            load_dotenv(dotenv_path=env_file_at_root, override=True)
            BOT_TOKEN_FROM_DOTENV = os.getenv("BOT_TOKEN")
            if BOT_TOKEN_FROM_DOTENV:
                global_logger.info(f"BOT_TOKEN ('****{BOT_TOKEN_FROM_DOTENV[-4:]}') ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ (Ğ²Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ°).")
            else:
                global_logger.warning(f"BOT_TOKEN Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² {env_file_at_root} (Ğ²Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ°).")
        else:
            global_logger.warning(f".env Ñ„Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ python-dotenv. BOT_TOKEN Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸ÑĞºĞ°Ñ‚ÑŒÑÑ Ğ² YAML Ğ¸Ğ»Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ….")

class DBSettings(BaseModel):
    type: Literal["sqlite", "postgresql", "mysql"] = Field(default="sqlite", description="Ğ¢Ğ¸Ğ¿ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ğ¾Ğ¹ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….")
    sqlite_path: str = Field(
        default=f"Database_files/swiftdevbot.db", 
        description="ĞÑ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ SQLite (Ğ¾Ñ‚ ĞºĞ¾Ñ€Ğ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ¸Ğ»Ğ¸ project_data_path)."
    )
    pg_dsn: Optional[PostgresDsn] = Field(default=None, description="DSN Ğ´Ğ»Ñ PostgreSQL.")
    mysql_dsn: Optional[MySQLDsn] = Field(default=None, description="DSN Ğ´Ğ»Ñ MySQL.")
    echo_sql: bool = Field(default=False, description="Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ SQL-Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ SQLAlchemy (ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ DEBUG).")

    @field_validator('pg_dsn', mode='before')
    @classmethod
    def check_pg_dsn(cls, v: Optional[PostgresDsn], info: ValidationInfo) -> Optional[PostgresDsn]:
        if info.data.get('type') == "postgresql" and not v:
            raise ValueError("pg_dsn Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ ÑƒĞºĞ°Ğ·Ğ°Ğ½ Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ° Ğ‘Ğ” 'postgresql'.")
        return v

    @field_validator('mysql_dsn', mode='before')
    @classmethod
    def check_mysql_dsn(cls, v: Optional[MySQLDsn], info: ValidationInfo) -> Optional[MySQLDsn]:
        if info.data.get('type') == "mysql" and not v:
            raise ValueError("mysql_dsn Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ ÑƒĞºĞ°Ğ·Ğ°Ğ½ Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ° Ğ‘Ğ” 'mysql'.")
        return v

class CacheSettings(BaseModel):
    type: Literal["memory", "redis"] = Field(default="memory", description="Ğ¢Ğ¸Ğ¿ ĞºÑÑˆĞ°.")
    redis_url: Optional[str] = Field(default="redis://localhost:6379/0", description="URL Ğ´Ğ»Ñ Redis.")

    @field_validator('redis_url', mode='before')
    @classmethod
    def check_redis_url(cls, v: Optional[str], info: ValidationInfo) -> Optional[str]:
        cache_type = info.data.get('type') if info.data else None
        if cache_type == "redis" and not v:
            raise ValueError("redis_url Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ ÑƒĞºĞ°Ğ·Ğ°Ğ½ Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ° ĞºÑÑˆĞ° 'redis'.")
        return v

class TelegramSettings(BaseModel):
    token: str = Field(description="Ğ¢Ğ¾ĞºĞµĞ½ Telegram Ğ±Ğ¾Ñ‚Ğ° (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ² .env).")
    polling_timeout: int = Field(default=30, ge=1, description="Ğ¢Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ long polling (ÑĞµĞºÑƒĞ½Ğ´Ñ‹).")

class ModuleRepoSettings(BaseModel):
    index_url: Optional[HttpUrl] = Field(
        default=HttpUrl("https://raw.githubusercontent.com/soverxos/SwiftDevBot-Modules/main/modules_index.json"),
        description="URL Ğº JSON-Ğ¸Ğ½Ğ´ĞµĞºÑÑƒ Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ SDB."
    )

class I18nSettings(BaseModel):
    locales_dir: Path = Field(default=PROJECT_ROOT_DIR / "Systems" / "locales", description="ĞŸÑƒÑ‚ÑŒ Ğº Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼Ğ¸ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ².")
    domain: str = Field(default="bot", description="Ğ˜Ğ¼Ñ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ° Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ².")
    default_locale: str = Field(default="ru", description="Ğ¯Ğ·Ñ‹Ğº Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ.")
    available_locales: List[str] = Field(default_factory=lambda: ["ru", "en", "uk"], description="Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ÑĞ·Ñ‹ĞºĞ¾Ğ².")

class CoreAppSettings(BaseModel):
    project_data_path: Path = Field(
        default=PROJECT_ROOT_DIR / DEFAULT_PROJECT_DATA_DIR_NAME,
        description="ĞŸÑƒÑ‚ÑŒ Ğº Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°."
    )
    super_admins: List[int] = Field(default_factory=list, description="Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Telegram ID ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ².")
    enabled_modules_config_path: Path = Field(
        default=Path(f"{USER_CONFIG_DIR_NAME}/{ENABLED_MODULES_FILENAME}"), 
        description="ĞŸÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ ÑĞ¾ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)."
    )
    
    log_level: Literal["TRACE", "DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"] = Field(default="INFO")
    log_to_file: bool = Field(default=True)
    log_structured_dir: str = Field(
        default=STRUCTURED_LOGS_ROOT_DIR_NAME, 
        description="Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ»Ğ¾Ğ³-Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ project_data_path)."
    )
    log_rotation_size: str = Field(
        default="100 MB", 
        description="ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ‡Ğ°ÑĞ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ»Ğ¾Ğ³-Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ¿ĞµÑ€ĞµĞ´ Ñ€Ğ¾Ñ‚Ğ°Ñ†Ğ¸ĞµĞ¹ (e.g., '100 MB')."
    ) 
    log_retention_period_structured: str = Field(
        default="3 months", 
        description="ĞšĞ°Ğº Ğ´Ğ¾Ğ»Ğ³Ğ¾ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, '30 days', '3 months', '1 year'). "
                    "Ğ ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚ÑÑ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡ĞµĞ¹ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸."
    )
    
    sdb_version: str = Field(default="0.1.0", pattern=r"^\d+\.\d+\.\d+([\w.-]*[\w])?(\+[\w.-]+)?$",
                             description="Ğ’ĞµÑ€ÑĞ¸Ñ ÑĞ´Ñ€Ğ° SwiftDevBot (SemVer-ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ°Ñ).")
    
    setup_bot_commands_on_startup: bool = Field(default=True, description="Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ±Ğ¾Ñ‚Ğ° Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ.")
    enable_startup_shutdown_notifications: bool = Field(default=True, description="ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°Ğ¼ Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ/Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ±Ğ¾Ñ‚Ğ°.")
    i18n: I18nSettings = Field(default_factory=I18nSettings)

class EnvironmentSettings(BaseSettings):
    CORE_PROJECT_DATA_PATH: Optional[Path] = Field(default=None, validation_alias=AliasChoices('SDB_CORE_PROJECT_DATA_PATH', 'CORE_PROJECT_DATA_PATH'))
    CORE_SUPER_ADMINS: Optional[str] = Field(default=None, validation_alias=AliasChoices('SDB_CORE_SUPER_ADMINS', 'CORE_SUPER_ADMINS'))
    CORE_ENABLED_MODULES_CONFIG_PATH: Optional[Path] = Field(default=None, validation_alias=AliasChoices('SDB_CORE_ENABLED_MODULES_CONFIG_PATH', 'CORE_ENABLED_MODULES_CONFIG_PATH'))
    CORE_LOG_LEVEL: Optional[str] = Field(default=None, validation_alias=AliasChoices('SDB_CORE_LOG_LEVEL', 'CORE_LOG_LEVEL'))
    CORE_LOG_TO_FILE: Optional[bool] = Field(default=None, validation_alias=AliasChoices('SDB_CORE_LOG_TO_FILE', 'CORE_LOG_TO_FILE'))
    
    SDB_CORE_LOG_STRUCTURED_DIR: Optional[str] = Field(default=None)
    SDB_CORE_LOG_ROTATION_SIZE: Optional[str] = Field(default=None)
    SDB_CORE_LOG_RETENTION_PERIOD_STRUCTURED: Optional[str] = Field(default=None)

    CORE_SDB_VERSION: Optional[str] = Field(default=None, validation_alias=AliasChoices('SDB_CORE_SDB_VERSION', 'CORE_SDB_VERSION'))
    CORE_ENABLE_STARTUP_SHUTDOWN_NOTIFICATIONS: Optional[bool] = Field(default=None, validation_alias=AliasChoices('SDB_CORE_ENABLE_STARTUP_SHUTDOWN_NOTIFICATIONS', 'CORE_ENABLE_STARTUP_SHUTDOWN_NOTIFICATIONS'))
    
    DB_TYPE: Optional[Literal["sqlite", "postgresql", "mysql"]] = Field(default=None, validation_alias=AliasChoices('SDB_DB_TYPE', 'DB_TYPE'))
    DB_SQLITE_PATH: Optional[str] = Field(default=None, validation_alias=AliasChoices('SDB_DB_SQLITE_PATH', 'DB_SQLITE_PATH'))
    DB_PG_DSN: Optional[str] = Field(default=None, validation_alias=AliasChoices('SDB_DB_PG_DSN', 'DB_PG_DSN')) 
    DB_MYSQL_DSN: Optional[str] = Field(default=None, validation_alias=AliasChoices('SDB_DB_MYSQL_DSN', 'DB_MYSQL_DSN')) 
    DB_ECHO_SQL: Optional[bool] = Field(default=None, validation_alias=AliasChoices('SDB_DB_ECHO_SQL', 'DB_ECHO_SQL'))

    CACHE_TYPE: Optional[Literal["memory", "redis"]] = Field(default=None, validation_alias=AliasChoices('SDB_CACHE_TYPE', 'CACHE_TYPE'))
    CACHE_REDIS_URL: Optional[str] = Field(default=None, validation_alias=AliasChoices('SDB_CACHE_REDIS_URL', 'CACHE_REDIS_URL'))
    
    TELEGRAM_POLLING_TIMEOUT: Optional[int] = Field(default=None, validation_alias=AliasChoices('SDB_TELEGRAM_POLLING_TIMEOUT', 'TELEGRAM_POLLING_TIMEOUT'))
    MODULE_REPO_INDEX_URL: Optional[HttpUrl] = Field(default=None, validation_alias=AliasChoices('SDB_MODULE_REPO_INDEX_URL', 'MODULE_REPO_INDEX_URL'))

    SDB_I18N_LOCALES_DIR: Optional[Path] = Field(default=None, validation_alias=AliasChoices('SDB_I18N_LOCALES_DIR', 'I18N_LOCALES_DIR'))
    SDB_I18N_DOMAIN: Optional[str] = Field(default=None, validation_alias=AliasChoices('SDB_I18N_DOMAIN', 'I18N_DOMAIN'))
    SDB_I18N_DEFAULT_LOCALE: Optional[str] = Field(default=None, validation_alias=AliasChoices('SDB_I18N_DEFAULT_LOCALE', 'I18N_DEFAULT_LOCALE'))
    SDB_I18N_AVAILABLE_LOCALES: Optional[str] = Field(default=None, validation_alias=AliasChoices('SDB_I18N_AVAILABLE_LOCALES', 'I18N_AVAILABLE_LOCALES'))

    model_config = SettingsConfigDict(
        env_file=None, 
        extra='ignore',
    )

class AppSettings(BaseModel):
    db: DBSettings = Field(default_factory=DBSettings)
    cache: CacheSettings = Field(default_factory=CacheSettings)
    telegram: TelegramSettings
    module_repo: ModuleRepoSettings = Field(default_factory=ModuleRepoSettings)
    core: CoreAppSettings = Field(default_factory=CoreAppSettings)
    project_root: Path = Field(default_factory=lambda: PROJECT_ROOT_DIR)
    model_config = {"validate_assignment": True}

_loaded_settings_cache: Optional[AppSettings] = None
_loguru_console_configured_flag = False

def load_app_settings() -> AppSettings:
    global _loaded_settings_cache, _loguru_console_configured_flag
    if _loaded_settings_cache is not None:
        return _loaded_settings_cache

    # DEBUG Ğ»Ğ¾Ğ³Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² verbose Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ
    if VERBOSE_MODE:
        global_logger.debug(f"Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ SDB. ĞšĞ¾Ñ€ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°: {PROJECT_ROOT_DIR}")
    
    env_s = EnvironmentSettings()
    
    if not CLI_MODE:
        if BOT_TOKEN_FROM_DOTENV:
            global_logger.info(f"BOT_TOKEN ('****{BOT_TOKEN_FROM_DOTENV[-4:]}') Ğ±Ñ‹Ğ» Ğ¿Ñ€ĞµĞ´Ğ²Ğ°Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½.")
        else:
            global_logger.warning("BOT_TOKEN Ğ½Ğµ Ğ±Ñ‹Ğ» Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¿Ñ€Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ²Ğ°Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ¸Ğ· .env. Ğ‘ÑƒĞ´ĞµÑ‚ Ğ¸ÑĞºĞ°Ñ‚ÑŒÑÑ Ğ² YAML.")
    
    pdp_val_from_env = env_s.CORE_PROJECT_DATA_PATH
    core_app_defaults = CoreAppSettings.model_fields
    
    if pdp_val_from_env:
        effective_project_data_path = Path(pdp_val_from_env)
        if not effective_project_data_path.is_absolute():
            effective_project_data_path = (PROJECT_ROOT_DIR / effective_project_data_path).resolve()
    else: 
        default_pdp_model = core_app_defaults["project_data_path"].default
        effective_project_data_path = Path(default_pdp_model) if default_pdp_model else (PROJECT_ROOT_DIR / DEFAULT_PROJECT_DATA_DIR_NAME)
        if not effective_project_data_path.is_absolute():
             effective_project_data_path = (PROJECT_ROOT_DIR / effective_project_data_path).resolve()

    user_config_file_path = effective_project_data_path / USER_CONFIG_DIR_NAME / USER_CONFIG_FILENAME
    yaml_data: Dict[str, Any] = {}
    if user_config_file_path.is_file():
        try:
            with open(user_config_file_path, 'r', encoding='utf-8') as f: yaml_data = yaml.safe_load(f) or {}
            # INFO Ğ»Ğ¾Ğ³Ğ¸ Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² verbose Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ
            if VERBOSE_MODE:
                global_logger.info(f"Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ· Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ YAML: {user_config_file_path}")
        except Exception as e_yaml: global_logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ YAML Ğ¸Ğ· {user_config_file_path}: {e_yaml}.")
    else:
        # INFO Ğ»Ğ¾Ğ³Ğ¸ Ğ¾ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² verbose Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ
        if VERBOSE_MODE:
            global_logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹ YAML ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ {user_config_file_path} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ÑÑ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ñ‹ Ğ¸ .env.")

    tg_token_from_yaml = yaml_data.get("telegram", {}).get("token")
    final_tg_token = BOT_TOKEN_FROM_DOTENV or tg_token_from_yaml
    allow_missing_token_env = os.environ.get("SDB_ALLOW_MISSING_BOT_TOKEN", "false").lower() == "true"
    if not final_tg_token and not (allow_missing_token_env or CLI_MODE):
        raise ValueError(f"ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ: BOT_TOKEN Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½! ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ .env Ğ¸ YAML ({user_config_file_path}).")
    if not final_tg_token and (allow_missing_token_env or CLI_MODE):
        if not CLI_MODE:
            global_logger.warning("BOT_TOKEN Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚, Ğ½Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ğ¸Ğ·-Ğ·Ğ° SDB_ALLOW_MISSING_BOT_TOKEN=true. ĞĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹ Ğ´Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ°.")
        final_tg_token = ""
    
    telegram_s = TelegramSettings(
        token=final_tg_token,
        polling_timeout=env_s.TELEGRAM_POLLING_TIMEOUT or \
                        yaml_data.get("telegram", {}).get("polling_timeout", TelegramSettings.model_fields["polling_timeout"].default)
    )

    db_yaml = yaml_data.get("db", {})
    db_s = DBSettings(
        type=env_s.DB_TYPE or db_yaml.get("type", DBSettings.model_fields["type"].default),
        sqlite_path=env_s.DB_SQLITE_PATH or db_yaml.get("sqlite_path", DBSettings.model_fields["sqlite_path"].default),
        pg_dsn=env_s.DB_PG_DSN or db_yaml.get("pg_dsn"),
        mysql_dsn=env_s.DB_MYSQL_DSN or db_yaml.get("mysql_dsn"),
        echo_sql=env_s.DB_ECHO_SQL if env_s.DB_ECHO_SQL is not None else \
                 db_yaml.get("echo_sql", DBSettings.model_fields["echo_sql"].default)
    )

    cache_yaml = yaml_data.get("cache", {})
    cache_s = CacheSettings(
        type=env_s.CACHE_TYPE or cache_yaml.get("type", CacheSettings.model_fields["type"].default),
        redis_url=env_s.CACHE_REDIS_URL or cache_yaml.get("redis_url", CacheSettings.model_fields["redis_url"].default)
    )

    module_repo_yaml = yaml_data.get("module_repo", {})
    module_repo_s = ModuleRepoSettings(
        index_url=env_s.MODULE_REPO_INDEX_URL or \
                  HttpUrl(str(module_repo_yaml.get("index_url") or ModuleRepoSettings.model_fields["index_url"].default))
    )
    
    core_yaml = yaml_data.get("core", {})
    
    s_admins_str_env = env_s.CORE_SUPER_ADMINS
    s_admins_list_yaml = core_yaml.get("super_admins")
    s_admins_final_list: List[int] = []
    if s_admins_str_env:
        try:
            # Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ¸ ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ (python-dotenv Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¸Ñ…)
            s_admins_str_clean = s_admins_str_env.strip().strip('"').strip("'")
            # ĞŸĞ°Ñ€ÑĞ¸Ğ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº ID, Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿ÑÑ‚Ğ¾Ğ¹
            s_admins_final_list = []
            for x in s_admins_str_clean.split(','):
                x_clean = x.strip().strip('"').strip("'")
                if x_clean.isdigit():
                    s_admins_final_list.append(int(x_clean))
            global_logger.info(f"Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñ‹ Ğ¸Ğ· SDB_CORE_SUPER_ADMINS: {s_admins_final_list}")
        except ValueError as e: 
            global_logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° CORE_SUPER_ADMINS Ğ¸Ğ· env: '{s_admins_str_env}': {e}")
    elif isinstance(s_admins_list_yaml, list):
        s_admins_final_list = [int(x) for x in s_admins_list_yaml if isinstance(x, (int, str)) and str(x).isdigit()]

    emcp_from_env_val = env_s.CORE_ENABLED_MODULES_CONFIG_PATH
    emcp_from_yaml_val = core_yaml.get("enabled_modules_config_path")
    emcp_default_relative = CoreAppSettings.model_fields["enabled_modules_config_path"].default 
    
    emcp_to_resolve = emcp_from_env_val or (Path(emcp_from_yaml_val) if emcp_from_yaml_val else emcp_default_relative)
    emcp_path_resolved = (effective_project_data_path / emcp_to_resolve).resolve() if not Path(emcp_to_resolve).is_absolute() else Path(emcp_to_resolve).resolve()

    log_structured_dir_final = env_s.SDB_CORE_LOG_STRUCTURED_DIR or core_yaml.get("log_structured_dir", CoreAppSettings.model_fields["log_structured_dir"].default)
    log_rotation_size_final = env_s.SDB_CORE_LOG_ROTATION_SIZE or core_yaml.get("log_rotation_size", CoreAppSettings.model_fields["log_rotation_size"].default)
    log_retention_period_structured_final = env_s.SDB_CORE_LOG_RETENTION_PERIOD_STRUCTURED or core_yaml.get("log_retention_period_structured", CoreAppSettings.model_fields["log_retention_period_structured"].default)

    i18n_yaml = core_yaml.get("i18n", {})
    i18n_model_defaults = I18nSettings.model_fields
    
    available_locales_env_str = env_s.SDB_I18N_AVAILABLE_LOCALES
    available_locales_yaml = i18n_yaml.get("available_locales")
    final_available_locales: List[str]
    if available_locales_env_str:
        final_available_locales = [loc.strip() for loc in available_locales_env_str.split(',')]
    elif isinstance(available_locales_yaml, list):
        final_available_locales = available_locales_yaml
    else:
        final_available_locales = i18n_model_defaults["available_locales"].default_factory() # type: ignore

    locales_dir_env = env_s.SDB_I18N_LOCALES_DIR
    locales_dir_yaml = i18n_yaml.get("locales_dir")
    locales_dir_default = i18n_model_defaults["locales_dir"].default
    
    locales_dir_to_resolve = locales_dir_env or (Path(locales_dir_yaml) if locales_dir_yaml else locales_dir_default)
    resolved_locales_dir = Path(locales_dir_to_resolve)
    if not resolved_locales_dir.is_absolute():
        resolved_locales_dir = (PROJECT_ROOT_DIR / resolved_locales_dir).resolve()

    i18n_s = I18nSettings(
        locales_dir=resolved_locales_dir,
        domain=env_s.SDB_I18N_DOMAIN or i18n_yaml.get("domain", i18n_model_defaults["domain"].default),
        default_locale=env_s.SDB_I18N_DEFAULT_LOCALE or i18n_yaml.get("default_locale", i18n_model_defaults["default_locale"].default),
        available_locales=final_available_locales
    )

    core_s = CoreAppSettings(
        project_data_path=effective_project_data_path,
        super_admins=s_admins_final_list,
        enabled_modules_config_path=emcp_path_resolved,
        log_level=(env_s.CORE_LOG_LEVEL or core_yaml.get("log_level", CoreAppSettings.model_fields["log_level"].default)).upper(), # type: ignore
        log_to_file=env_s.CORE_LOG_TO_FILE if env_s.CORE_LOG_TO_FILE is not None \
                    else core_yaml.get("log_to_file", CoreAppSettings.model_fields["log_to_file"].default),
        log_structured_dir=log_structured_dir_final,
        log_rotation_size=log_rotation_size_final,
        log_retention_period_structured=log_retention_period_structured_final,
        sdb_version=env_s.CORE_SDB_VERSION or core_yaml.get("sdb_version", CoreAppSettings.model_fields["sdb_version"].default),
        setup_bot_commands_on_startup=core_yaml.get("setup_bot_commands_on_startup", CoreAppSettings.model_fields["setup_bot_commands_on_startup"].default), # type: ignore
        enable_startup_shutdown_notifications=env_s.CORE_ENABLE_STARTUP_SHUTDOWN_NOTIFICATIONS if env_s.CORE_ENABLE_STARTUP_SHUTDOWN_NOTIFICATIONS is not None \
                    else core_yaml.get("enable_startup_shutdown_notifications", CoreAppSettings.model_fields["enable_startup_shutdown_notifications"].default),
        i18n=i18n_s
    )
    
    final_settings = AppSettings(db=db_s, cache=cache_s, telegram=telegram_s, module_repo=module_repo_s, core=core_s)

    final_settings.core.project_data_path.mkdir(parents=True, exist_ok=True)
    final_settings.core.enabled_modules_config_path.parent.mkdir(parents=True, exist_ok=True)
    
    structured_logs_root_abs_path = final_settings.core.project_data_path / final_settings.core.log_structured_dir
    structured_logs_root_abs_path.mkdir(parents=True, exist_ok=True)
    
    final_settings.core.i18n.locales_dir.mkdir(parents=True, exist_ok=True)
    
    if final_settings.db.type == "sqlite":
        sqlite_file_abs = Path(final_settings.db.sqlite_path)
        if not sqlite_file_abs.is_absolute():
            if DEFAULT_PROJECT_DATA_DIR_NAME in sqlite_file_abs.parts:
                 sqlite_file_abs = (PROJECT_ROOT_DIR / sqlite_file_abs).resolve()
            else:
                 sqlite_file_abs = (final_settings.core.project_data_path / sqlite_file_abs).resolve()
        final_settings.db.sqlite_path = str(sqlite_file_abs)
        sqlite_file_abs.parent.mkdir(parents=True, exist_ok=True)

    if not _loguru_console_configured_flag:
        try:
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ handler (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ¸Ğ· sdb.py)
            has_existing_handler = (
                hasattr(global_logger, '_core') and 
                global_logger._core.handlers and 
                len(global_logger._core.handlers) > 0
            )
            
            # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ VERBOSE_MODE
            if VERBOSE_MODE:
                # ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¼, Ñ„ÑƒĞ½ĞºÑ†Ğ¸ĞµĞ¹ Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞ¾Ğ¹
                log_format_console = ("<green>{time:YYYY-MM-DD HH:mm:ss.SSS}</green> | <level>{level: <8}</level> | "
                                      "<cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>")
                # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ²ÑĞµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ handlers Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² verbose Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ
                if has_existing_handler:
                    for handler_id_to_remove in list(global_logger._core.handlers.keys()):
                        try: global_logger.remove(handler_id_to_remove)
                        except ValueError: pass
            else:
                # ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚: Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
                log_format_console = "<green>{time:HH:mm:ss}</green> <level>{message}</level>"
                # Ğ’ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ handlers, ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¸ ÑƒĞ¶Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ¸Ğ· sdb.py)
                # Ğ•ÑĞ»Ğ¸ handler ÑƒĞ¶Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ĞµĞ³Ğ¾
            
            # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ handler Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ ĞµĞ³Ğ¾ ĞµÑ‰Ğµ Ğ½ĞµÑ‚ (Ğ² Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ) Ğ¸Ğ»Ğ¸ Ğ²ÑĞµĞ³Ğ´Ğ° (Ğ² verbose Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ)
            if VERBOSE_MODE or not has_existing_handler:
                console_log_level_str = final_settings.core.log_level.upper()
                
                cli_debug_env_var = os.environ.get("SDB_CLI_DEBUG_MODE_FOR_LOGGING", "false").lower()
                if cli_debug_env_var == "true":
                    console_log_level_str = "DEBUG"
                    if not VERBOSE_MODE:
                        global_logger.info("Loguru (app_settings): Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ»Ğ¾Ğ³Ğ° Ğ¿Ñ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ DEBUG Ğ¸Ğ·-Ğ·Ğ° SDB_CLI_DEBUG_MODE_FOR_LOGGING.")

                global_logger.add(sys.stderr, level=console_log_level_str, format=log_format_console, colorize=True)
                if VERBOSE_MODE:
                    global_logger.info(f"Loguru (app_settings): ĞšĞ¾Ğ½ÑĞ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ (verbose mode). Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: {console_log_level_str}")
            _loguru_console_configured_flag = True
        except Exception as e_log_setup_console:
            print(f"CRITICAL ERROR in app_settings during Loguru console setup: {e_log_setup_console}", file=sys.stderr)

    # Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²ÑĞµĞ³Ğ´Ğ°, Ğ½Ğ¾ Ğ² Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¼ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ (ĞµÑĞ»Ğ¸ Ğ½Ğµ verbose)
    if VERBOSE_MODE:
        global_logger.success("ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ SDB ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹!")
    else:
        # Ğ’ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ info Ğ²Ğ¼ĞµÑÑ‚Ğ¾ success, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ»Ğ¸ÑˆĞ½Ğ¸Ñ… ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
        global_logger.info("ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ SDB ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹!")
    _loaded_settings_cache = final_settings
    return final_settings

try:
    settings: AppSettings = load_app_settings()
except (ImportError, ValueError) as e: 
    print(f"CRITICAL ERROR during SDB settings load/validation: {e}", file=sys.stderr)
    if hasattr(global_logger, 'opt') and callable(global_logger.opt): 
        global_logger.opt(exception=True).critical(f"ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ ĞĞ¨Ğ˜Ğ‘ĞšĞ Pydantic/SDB Ğ¿Ñ€Ğ¸ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº: {e}")
    sys.exit(1)
except Exception as e:
    print(f"UNEXPECTED CRITICAL ERROR during initial settings load: {e}", file=sys.stderr)
    if hasattr(global_logger, 'opt') and callable(global_logger.opt):
        global_logger.opt(exception=True).critical(f"ĞĞ•ĞŸĞ Ğ•Ğ”Ğ’Ğ˜Ğ”Ğ•ĞĞĞĞ¯ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ ĞĞ¨Ğ˜Ğ‘ĞšĞ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº: {e}")
    sys.exit(1)


======================================================================

------------------------------ FILE: Systems/core/__init__.py ------------------------------



======================================================================

------------------------------ FILE: Systems/core/ui/callback_data_factories.py ------------------------------
# SwiftDevBot/core/ui/callback_data_factories.py
from typing import Optional, Literal, Union 
from aiogram.filters.callback_data import CallbackData

CORE_CALLBACK_PREFIX = "sdb_core"
ADMIN_CALLBACK_PREFIX = "sdb_admin" 

# --- Ğ¤Ğ°Ğ±Ñ€Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸ ÑĞ´Ñ€Ğ° ---
class CoreMenuNavigate(CallbackData, prefix=f"{CORE_CALLBACK_PREFIX}_nav"):
    target_menu: str 
    page: Optional[int] = None
    action: Optional[str] = None 
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ¼ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, ĞºĞ¾Ğ´Ğ° ÑĞ·Ñ‹ĞºĞ°
    payload: Optional[str] = None 

class ModuleMenuEntry(CallbackData, prefix=f"{CORE_CALLBACK_PREFIX}_module_entry"):
    module_name: str

class ModuleAction(CallbackData, prefix=f"{CORE_CALLBACK_PREFIX}_module_action"):
    """Callback data Ğ´Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´)"""
    module_name: str
    command: str  # Ğ˜Ğ¼Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¸Ğ· Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°
    action: Optional[str] = None  # Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "execute", "show_help")

class CoreServiceAction(CallbackData, prefix=f"{CORE_CALLBACK_PREFIX}_service"):
    action: Literal[
        "delete_this_message", 
        "close_menu_silently",
        "confirm_registration", 
        "cancel_registration",
        "confirm_reset_password",
        "cancel_reset_password",
    ]

# --- Ğ¤Ğ°Ğ±Ñ€Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ ---
# ... (Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹) ...
ADMIN_MAIN_MENU_PREFIX = "sdb_admin_main"
class AdminMainMenuNavigate(CallbackData, prefix=ADMIN_MAIN_MENU_PREFIX):
    target_section: str 

ADMIN_USERS_PREFIX = "sdb_admin_users"
class AdminUsersPanelNavigate(CallbackData, prefix=ADMIN_USERS_PREFIX):
    action: str 
    item_id: Optional[int] = None       
    page: Optional[int] = None          
    role_id: Optional[int] = None       
    permission_id: Optional[int] = None 
    
    category_key: Optional[str] = None 
    entity_name: Optional[str] = None  


ADMIN_ROLES_PREFIX = "sdb_admin_roles"
class AdminRolesPanelNavigate(CallbackData, prefix=ADMIN_ROLES_PREFIX):
    action: str 
    item_id: Optional[int] = None       
    permission_id: Optional[int] = None 
    category_key: Optional[str] = None  
    entity_name: Optional[str] = None   
    page: Optional[int] = None          

ADMIN_SYSINFO_PREFIX = "sdb_admin_sysinfo"
class AdminSysInfoPanelNavigate(CallbackData, prefix=ADMIN_SYSINFO_PREFIX):
    action: str 

ADMIN_MODULES_PREFIX = "sdb_admin_modules"
class AdminModulesPanelNavigate(CallbackData, prefix=ADMIN_MODULES_PREFIX):
    action: str 
    item_id: Optional[str] = None 
    page: Optional[int] = None

ADMIN_LOGS_PREFIX = "sdb_admin_logs"
class AdminLogsPanelNavigate(CallbackData, prefix=ADMIN_LOGS_PREFIX):
    action: str 
    item_id: Optional[str] = None 
    page: Optional[int] = None

# ĞĞ¾Ğ²Ñ‹Ğ¹ callback data Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ²
ADMIN_LOGS_VIEWER_PREFIX = "sdb_admin_logs_viewer"
class AdminLogsViewerNavigate(CallbackData, prefix=ADMIN_LOGS_VIEWER_PREFIX):
    action: str 
    payload: Optional[str] = None  # Ğ”Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ Ğ¸Ğ¼ĞµĞ½Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ğ°

class AdminPanelNavigate(CallbackData, prefix=ADMIN_CALLBACK_PREFIX): 
    section: str 
    action: Optional[str] = None
    item_id: Optional[Union[int, str]] = None 
    page: Optional[int] = None
    role_id: Optional[int] = None 
    permission_name: Optional[str] = None


======================================================================

------------------------------ FILE: Systems/core/ui/handlers_core_ui.py ------------------------------
# SwiftDevBot/core/ui/handlers_core_ui.py
from aiogram import Router, F, types, Bot
from aiogram.filters import CommandStart, Command, StateFilter 
from aiogram.fsm.context import FSMContext 
from aiogram.fsm.state import State, StatesGroup 
from aiogram.utils.markdown import hbold, hitalic, hcode 
import html # <--- Ğ˜ĞœĞŸĞĞ Ğ¢Ğ˜Ğ Ğ£Ğ•Ğœ Ğ¡Ğ¢ĞĞĞ”ĞĞ Ğ¢ĞĞ«Ğ™ ĞœĞĞ”Ğ£Ğ›Ğ¬ html
from loguru import logger
from aiogram.exceptions import TelegramBadRequest 
from aiogram.types import ReplyKeyboardRemove 

from .callback_data_factories import CoreMenuNavigate, ModuleMenuEntry, ModuleAction, CoreServiceAction 
from .keyboards_core import (
    get_main_menu_reply_keyboard,
    get_modules_list_keyboard, 
    get_welcome_confirmation_keyboard, 
    get_profile_menu_keyboard,         
    get_language_selection_keyboard, 
    TEXTS_CORE_KEYBOARDS_EN 
)
from Systems.core.database.core_models import User as DBUser 
from Systems.core.ui.registry_ui import ModuleUIEntry 
from sqlalchemy import select 
from Systems.core.i18n.translator import Translator
from Systems.core.module_loader import get_module_permission_to_check 

from typing import TYPE_CHECKING, Optional, List, Union, Dict
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from sqlalchemy.ext.asyncio import AsyncSession 

core_ui_router = Router(name="sdb_core_ui_handlers")
MODULE_NAME_FOR_LOG = "CoreUI"

# Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºÑÑˆ Ğ´Ğ»Ñ translator
_translator_cache: Optional['Translator'] = None

def _get_translator_for_handler(services_provider: 'BotServicesProvider') -> 'Translator':
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ translator Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ² handlers"""
    global _translator_cache
    if _translator_cache is None:
        from Systems.core.i18n.translator import Translator
        _translator_cache = Translator(
            locales_dir=services_provider.config.core.i18n.locales_dir,
            domain=services_provider.config.core.i18n.domain,
            default_locale=services_provider.config.core.i18n.default_locale,
            available_locales=services_provider.config.core.i18n.available_locales
        )
    return _translator_cache

class FSMFeedback(StatesGroup):
    waiting_for_feedback_message = State()

async def show_main_menu_reply(
    message_or_query: Union[types.Message, types.CallbackQuery], 
    bot: Bot, 
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser,
    text_override: Optional[str] = None,
    state: Optional[FSMContext] = None 
):
    if state: 
        current_fsm_state = await state.get_state()
        if current_fsm_state is not None:
            logger.info(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ±Ñ€Ğ¾Ñ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ FSM ({current_fsm_state}) Ğ¿ĞµÑ€ĞµĞ´ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ¾Ğ¼ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ reply-Ğ¼ĞµĞ½Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {sdb_user.telegram_id}.")
            await state.clear()

    user_id = sdb_user.telegram_id
    
    # ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· Ğ‘Ğ” Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞ·Ñ‹ĞºĞ°
    async with services_provider.db.get_session() as session:
        updated_user = await session.get(DBUser, sdb_user.id)
        if updated_user:
            sdb_user.preferred_language_code = updated_user.preferred_language_code
            user_display_name = updated_user.full_name
        else:
            user_display_name = sdb_user.full_name
    
    logger.debug(f"[{MODULE_NAME_FOR_LOG}] User {user_id} ({user_display_name}) showing main reply menu.")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    translator = _get_translator_for_handler(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, user_locale, **kwargs)
    
    if text_override:
        text_to_send = text_override
    else:
        default_text = f"ğŸ  {hbold(t('main_menu_title'))}\n{t('main_menu_greeting', user_name=user_display_name)}"
        text_to_send = default_text
    
    keyboard = await get_main_menu_reply_keyboard(services_provider=services_provider, user_telegram_id=user_id, locale=user_locale)
    
    target_chat_id = message_or_query.chat.id if isinstance(message_or_query, types.Message) else message_or_query.message.chat.id # type: ignore

    if isinstance(message_or_query, types.CallbackQuery) and message_or_query.message:
        try:
            if message_or_query.message.reply_markup: 
                 await message_or_query.message.edit_reply_markup(reply_markup=None)
        except Exception as e_del_edit:
            logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ/ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞ´ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ¾Ğ¼ reply menu: {e_del_edit}")
    
    await bot.send_message(target_chat_id, text_to_send, reply_markup=keyboard)
    
    if isinstance(message_or_query, types.CallbackQuery):
        await message_or_query.answer()


@core_ui_router.message(CommandStart())
async def handle_start_command(
    message: types.Message,
    bot: Bot, 
    services_provider: 'BotServicesProvider',
    sdb_user: Optional[DBUser], 
    state: FSMContext, 
    user_was_just_created: Optional[bool] = False 
):
    user_tg = message.from_user 
    if not user_tg: return

    sdb_user_id = sdb_user.id if sdb_user else "N/A"
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_tg.id} (@{user_tg.username or 'N/A'}) Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ» /start. "
                f"SDB_User DB ID: {sdb_user_id}. Ğ‘Ñ‹Ğ» Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ñ‚Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½ (Ğ² middleware): {user_was_just_created}.")

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = (
        (sdb_user.preferred_language_code if sdb_user else None)
        or message.from_user.language_code
        or services_provider.config.core.i18n.default_locale
    )
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    translator = _get_translator_for_handler(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, user_locale, **kwargs)
    
    if not sdb_user:
        user_display_name = f"{user_tg.first_name} {user_tg.last_name or ''}".strip() or user_tg.username or str(user_tg.id)
        logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_tg.id}. ĞŸĞ¾ĞºĞ°Ğ· Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ.")
        welcome_title = t("welcome_message_title")
        welcome_body = t("welcome_message_body")
        full_welcome_text = f"{hbold(welcome_title)}\n\n{welcome_body}"
        welcome_keyboard = get_welcome_confirmation_keyboard(locale=user_locale, services_provider=services_provider)
        await message.answer(full_welcome_text, reply_markup=welcome_keyboard)
        return

    is_owner_from_config = sdb_user.telegram_id in services_provider.config.core.super_admins
    user_display_name = sdb_user.full_name 

    if is_owner_from_config or not user_was_just_created: 
        logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} ({'Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†' if is_owner_from_config else 'ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹'}). ĞŸĞ¾ĞºĞ°Ğ· Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ reply-Ğ¼ĞµĞ½Ñ.")
        await show_main_menu_reply(message, bot, services_provider, sdb_user, state=state) 
    else: 
        logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} Ğ½Ğ¾Ğ²Ñ‹Ğ¹. ĞŸĞ¾ĞºĞ°Ğ· Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ.")
        welcome_title = t("welcome_message_title")
        welcome_body = t("welcome_message_body")
        full_welcome_text = f"{hbold(welcome_title)}\n\n{welcome_body}"
        welcome_keyboard = get_welcome_confirmation_keyboard(locale=user_locale, services_provider=services_provider)
        await message.answer(full_welcome_text, reply_markup=welcome_keyboard)


@core_ui_router.message(Command("help"))
async def handle_help_command(
    message: types.Message,
    bot: Bot,
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser,
):
    """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ /help - Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´."""
    user_tg = message.from_user
    if not user_tg:
        return
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_tg.id} (@{user_tg.username or 'N/A'}) Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ» /help.")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
    translator = _get_translator_for_handler(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, user_locale, **kwargs)
    
    try:
        from Systems.core.bot_entrypoint import CORE_COMMANDS_DESCRIPTIONS
        
        # Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
        help_text_parts = [
            f"{hbold(t('help_title'))}\n",
            f"{hbold(t('help_main_commands'))}\n"
        ]
        
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
        for cmd_name, cmd_desc in CORE_COMMANDS_DESCRIPTIONS.items():
            if cmd_name != "help":  # ĞĞµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ°Ğ¼Ñƒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ help Ğ² ÑĞ¿Ğ¸ÑĞºĞµ
                help_text_parts.append(f"/{cmd_name} - {cmd_desc}")
        
        # Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¸Ğ· Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
        module_commands = []
        all_loaded_modules_info = services_provider.modules.get_loaded_modules_info(include_system=False, include_plugins=True)
        
        async with services_provider.db.get_session() as session:
            for module_info in all_loaded_modules_info:
                if module_info.manifest and module_info.manifest.commands:
                    for cmd_manifest in module_info.manifest.commands:
                        # ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ°Ğ´Ğ¼Ğ¸Ğ½ÑĞºĞ¸Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹, ĞµÑĞ»Ğ¸ Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ²
                        if cmd_manifest.admin_only:
                            is_super_admin = sdb_user.telegram_id in services_provider.config.core.super_admins
                            if not is_super_admin:
                                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ° Ñ‡ĞµÑ€ĞµĞ· RBAC
                                has_admin_permission = await services_provider.rbac.user_has_permission(
                                    session, 
                                    sdb_user.telegram_id, 
                                    "core.view_admin_panel"
                                )
                                if not has_admin_permission:
                                    continue
                        
                        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)
                        permission_to_check = get_module_permission_to_check(module_info.name, module_info.manifest)
                        if permission_to_check:
                            has_permission = await services_provider.rbac.user_has_permission(
                                session, sdb_user.telegram_id, permission_to_check
                            )
                            if not has_permission:
                                continue
                        
                        cmd_name = cmd_manifest.command.lstrip("/")
                        cmd_desc = cmd_manifest.description or "Ğ‘ĞµĞ· Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ"
                        
                        # Ğ˜Ğ·Ğ±ĞµĞ³Ğ°ĞµĞ¼ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ²
                        if not any(cmd["name"] == cmd_name for cmd in module_commands):
                            module_commands.append({
                                "name": cmd_name,
                                "description": cmd_desc,
                                "module": module_info.name
                            })
        
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹, ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¸ ĞµÑÑ‚ÑŒ
        if module_commands:
            help_text_parts.append(f"\n{hbold(t('help_module_commands'))}\n")
            for cmd in module_commands:
                help_text_parts.append(f"/{cmd['name']} - {cmd['description']}")
        
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¼ Ğ¼ĞµĞ½Ñ
        help_text_parts.append(f"\n{hitalic(t('help_tip_menu'))}")
        help_text_parts.append(f"{hitalic(t('help_tip_start'))}")
        
        help_text = "\n".join(help_text_parts)
        
        await message.answer(help_text)
        logger.debug(f"[{MODULE_NAME_FOR_LOG}] ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /help ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_tg.id}.")
        
    except Exception as e:
        logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ /help Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_tg.id}: {e}", exc_info=True)
        await message.answer(
            f"{hbold('âŒ ĞÑˆĞ¸Ğ±ĞºĞ°')}\n\n"
            f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ Ğ¸Ğ»Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ĞµÑÑŒ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ."
        )


@core_ui_router.message(Command("login"))
async def handle_login_command(
    message: types.Message,
    bot: Bot,
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser,
):
    """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ /login - Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½ Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ."""
    user_tg = message.from_user
    if not user_tg:
        return
    
    try:
        # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ JWT handler
        from Systems.web.auth.jwt_handler import get_jwt_handler
        from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
        from datetime import timedelta
        import os
        
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ€Ğ¾Ğ»ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ¼ Ğ¸Ğ· .env
        is_super_admin = sdb_user.telegram_id in services_provider.config.core.super_admins
        
        primary_role = None
        if is_super_admin:
            # Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ² ÑĞ¿Ğ¸ÑĞºĞµ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ², Ğ¾Ğ½ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½
            primary_role = "admin"
            logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½ ĞºĞ°Ğº ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½ Ğ¸Ğ· ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸.")
        elif sdb_user.roles:
            # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½, Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€Ğ¾Ğ»Ğ¸ Ğ¸Ğ· Ğ‘Ğ”
            role_names = [role.name for role in sdb_user.roles]
            if "Admin" in role_names:
                primary_role = "admin"  # lowercase Ğ´Ğ»Ñ ĞµĞ´Ğ¸Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ
            elif "Moderator" in role_names:
                primary_role = "moderator"
            elif role_names:
                primary_role = role_names[0].lower()
        
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ¸Ğ· Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ 60 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
        token_lifetime_minutes = int(os.environ.get("SDB_WEB_TOKEN_LIFETIME_MINUTES", "60"))
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ JWT Ñ‚Ğ¾ĞºĞµĞ½
        jwt_handler = get_jwt_handler()
        login_token = await jwt_handler.create_access_token(
            user_id=sdb_user.telegram_id,
            username=sdb_user.username or sdb_user.full_name,
            role=primary_role or "user",  # lowercase Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
            expires_in=timedelta(minutes=token_lifetime_minutes)
        )
        
        logger.info(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ JWT Ñ‚Ğ¾ĞºĞµĞ½ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {sdb_user.telegram_id} Ñ Ñ€Ğ¾Ğ»ÑŒÑ: {primary_role or 'user'}")
        
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ URL Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
        # Telegram Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ localhost Ğ² ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ñ…, Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ´Ğ¾Ğ¼ĞµĞ½/IP
        web_url = os.environ.get("SDB_WEB_URL")  # ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ´Ğ°Ñ‚ÑŒ ÑĞ²Ğ½Ğ¾ Ğ² .env
        
        if not web_url:
            # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½ ÑĞ²Ğ½Ğ¾, Ğ¿Ñ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ· Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº
            web_host = os.environ.get("SDB_WEB_HOST", "0.0.0.0")
            web_port = os.environ.get("SDB_WEB_PORT", "80")
            
            # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ IP ÑĞµÑ€Ğ²ĞµÑ€Ğ° (Ğ½Ğµ localhost)
            import socket
            try:
                # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ IP
                hostname = socket.gethostname()
                local_ip = socket.gethostbyname(hostname)
                
                # Ğ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾ localhost, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ IP Ğ¸Ğ· Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ¸Ğ»Ğ¸ Ğ¿Ñ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ
                if local_ip in ["127.0.0.1", "127.0.1.1"] or web_host in ["0.0.0.0", "127.0.0.1"]:
                    # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ IP Ğ¸Ğ· ÑĞµÑ‚ĞµĞ²Ğ¾Ğ³Ğ¾ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°
                    import subprocess
                    try:
                        result = subprocess.run(['hostname', '-I'], capture_output=True, text=True, timeout=2)
                        if result.returncode == 0 and result.stdout.strip():
                            ips = result.stdout.strip().split()
                            if ips:
                                local_ip = ips[0]
                    except:
                        pass
                    
                    # Ğ•ÑĞ»Ğ¸ Ğ²ÑÑ‘ Ñ€Ğ°Ğ²Ğ½Ğ¾ localhost, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ IP Ğ¸Ğ· .env Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‚Ğ¾ĞºĞµĞ½ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼
                    if local_ip in ["127.0.0.1", "127.0.1.1"]:
                        # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‚Ğ¾ĞºĞµĞ½ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
                        # Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
                        if token_lifetime_minutes >= 60:
                            time_str = f"{token_lifetime_minutes // 60} Ñ‡Ğ°Ñ" + ("Ğ°" if token_lifetime_minutes // 60 > 1 else "")
                        else:
                            time_str = f"{token_lifetime_minutes} Ğ¼Ğ¸Ğ½ÑƒÑ‚"
                        
                        login_text = (
                            f"{hbold('ğŸŒ Ğ’Ñ…Ğ¾Ğ´ Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ')}\n\n"
                            f"Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ ÑÑÑ‹Ğ»ĞºÑƒ Ğ½Ğ¸Ğ¶Ğµ Ğ¸ Ğ¾Ñ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ:\n\n"
                            f"{hcode(f'http://localhost:{web_port}/?token={login_token}')}\n\n"
                            f"{hitalic(f'Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ° {time_str}.')}"
                        )
                        await message.answer(login_text)
                        logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ²Ñ…Ğ¾Ğ´ Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ. Ğ¢Ğ¾ĞºĞµĞ½ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼ (localhost).")
                        return
                    
                web_url = f"http://{local_ip}:{web_port}" if web_port != "80" else f"http://{local_ip}"
            except Exception as e:
                logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ IP Ğ´Ğ»Ñ URL: {e}. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚.")
                # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‚Ğ¾ĞºĞµĞ½ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼
                # Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
                if token_lifetime_minutes >= 60:
                    time_str = f"{token_lifetime_minutes // 60} Ñ‡Ğ°Ñ" + ("Ğ°" if token_lifetime_minutes // 60 > 1 else "")
                else:
                    time_str = f"{token_lifetime_minutes} Ğ¼Ğ¸Ğ½ÑƒÑ‚"
                
                login_text = (
                    f"{hbold('ğŸŒ Ğ’Ñ…Ğ¾Ğ´ Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ')}\n\n"
                    f"Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ ÑÑÑ‹Ğ»ĞºÑƒ Ğ½Ğ¸Ğ¶Ğµ Ğ¸ Ğ¾Ñ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ:\n\n"
                    f"{hcode(f'http://localhost:{web_port}/login?token={login_token}')}\n\n"
                    f"{hitalic(f'Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ° {time_str}.')}"
                )
                await message.answer(login_text)
                logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ²Ñ…Ğ¾Ğ´ Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ. Ğ¢Ğ¾ĞºĞµĞ½ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼ (Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ IP).")
                return
        
        # Use root path for better compatibility
        login_url = f"{web_url}/?token={login_token}"
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ñ ÑÑÑ‹Ğ»ĞºĞ¾Ğ¹
        keyboard = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="ğŸŒ ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ", url=login_url)]
        ])
        
        # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
        # Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
        if token_lifetime_minutes >= 60:
            time_str = f"{token_lifetime_minutes // 60} Ñ‡Ğ°Ñ" + ("Ğ°" if token_lifetime_minutes // 60 > 1 else "")
        else:
            time_str = f"{token_lifetime_minutes} Ğ¼Ğ¸Ğ½ÑƒÑ‚"
        
        login_text = (
            f"{hbold('ğŸŒ Ğ’Ñ…Ğ¾Ğ´ Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ')}\n\n"
            f"ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ½Ğ¸Ğ¶Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²Ğ¾Ğ¹Ñ‚Ğ¸ Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ.\n"
            f"{hitalic(f'Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ° {time_str}.')}"
        )
        
        await message.answer(login_text, reply_markup=keyboard)
        logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ²Ñ…Ğ¾Ğ´ Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ. Ğ¢Ğ¾ĞºĞµĞ½ ÑĞ¾Ğ·Ğ´Ğ°Ğ½.")
        
    except Exception as e:
        logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {sdb_user.telegram_id}: {e}", exc_info=True)
        await message.answer(
            f"{hbold('âŒ ĞÑˆĞ¸Ğ±ĞºĞ°')}\n\n"
            f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑÑÑ‹Ğ»ĞºÑƒ Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´Ğ°. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ."
        )


@core_ui_router.message(F.text.startswith("/"))
async def handle_module_command_fallback(
    message: types.Message,
    bot: Bot,
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser
):
    """
    Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹.
    ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ UI Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ, ĞµÑĞ»Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ.
    Ğ­Ñ‚Ğ¾Ñ‚ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ¸Ğ¼ĞµĞµÑ‚ Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚, Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ ĞµĞ³Ğ¾.
    """
    command_text = message.text
    if not command_text:
        return  # ĞĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°
    
    # Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµĞ¼ Ğ¸Ğ¼Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ (Ğ±ĞµĞ· /)
    command_name = command_text.split()[0].lstrip("/").split("@")[0]
    
    # ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ ÑĞ´Ñ€Ğ°
    core_commands = ["start", "help", "login", "reset_password", "cancel_feedback"]
    if command_name in core_commands:
        return  # Ğ­Ñ‚Ğ¾ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° ÑĞ´Ñ€Ğ°, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼
    
    # Ğ˜Ñ‰ĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
    all_loaded_modules_info = services_provider.modules.get_loaded_modules_info(include_system=False, include_plugins=True)
    
    for module_info in all_loaded_modules_info:
        if not module_info.manifest or not module_info.manifest.commands:
            continue
        
        for cmd_manifest in module_info.manifest.commands:
            if cmd_manifest.command == command_name:
                # ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ - Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ UI Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
                logger.debug(f"[{MODULE_NAME_FOR_LOG}] User {sdb_user.telegram_id} called module command /{command_name}, showing module UI")
                
                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
                async with services_provider.db.get_session() as session:
                    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° admin_only
                    if cmd_manifest.admin_only:
                        is_super_admin = sdb_user.telegram_id in services_provider.config.core.super_admins
                        if not is_super_admin:
                            has_admin_permission = await services_provider.rbac.user_has_permission(
                                session, sdb_user.telegram_id, "core.view_admin_panel"
                            )
                            if not has_admin_permission:
                                await message.answer("âŒ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ° Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹")
                                return
                    
                    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
                    permission_to_check = get_module_permission_to_check(module_info.name, module_info.manifest)
                    if permission_to_check:
                        has_permission = await services_provider.rbac.user_has_permission(
                            session, sdb_user.telegram_id, permission_to_check
                        )
                        if not has_permission:
                            await message.answer("âŒ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹")
                            return
                
                # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ UI Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ñ‡ĞµÑ€ĞµĞ· callback (ÑĞ¸Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞµĞ¼ Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ¸Ğµ Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ)
                from .callback_data_factories import ModuleMenuEntry
                from aiogram.types import CallbackQuery
                
                # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ„Ğ¸ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ callback query Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° UI Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
                # ĞĞ¾ Ğ»ÑƒÑ‡ÑˆĞµ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ²Ñ‹Ğ·Ğ²Ğ°Ñ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° UI Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ
                module_entry = services_provider.ui_registry.get_module_entry(module_info.name)
                if module_entry:
                    # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ UI Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
                    from aiogram.types import InlineKeyboardButton
                    from aiogram.utils.keyboard import InlineKeyboardBuilder
                    
                    icon = module_entry.icon or "ğŸ§©"
                    display_name = module_entry.display_name or module_info.name
                    description = module_entry.description or (module_info.manifest.description if module_info.manifest else "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½")
                    version = module_info.manifest.version if module_info.manifest else "N/A"
                    
                    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
                    commands = []
                    async with services_provider.db.get_session() as session:
                        is_super_admin = sdb_user.telegram_id in services_provider.config.core.super_admins
                        for cmd in module_info.manifest.commands:
                            if cmd.admin_only:
                                if not is_super_admin:
                                    has_admin_permission = await services_provider.rbac.user_has_permission(
                                        session, sdb_user.telegram_id, "core.view_admin_panel"
                                    )
                                    if not has_admin_permission:
                                        continue
                            
                            if module_info.manifest.declared_permissions:
                                first_permission = module_info.manifest.declared_permissions[0]
                                has_permission = await services_provider.rbac.user_has_permission(
                                    session, sdb_user.telegram_id, first_permission.name
                                )
                                if not has_permission:
                                    continue
                            
                            commands.append(cmd)
                    
                    if commands:
                        text = (
                            f"{icon} **{display_name}**\n\n"
                            f"{description}\n\n"
                            f"ğŸ“Š **Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ:**\n"
                            f"â€¢ Ğ’ĞµÑ€ÑĞ¸Ñ: {version}\n"
                            f"â€¢ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: {'âœ… ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½' if module_info.is_loaded_successfully else 'âŒ ĞĞµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½'}\n\n"
                            f"ğŸ¯ **Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ:**\n"
                            f"Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ¸Ğ· ÑĞ¿Ğ¸ÑĞºĞ° Ğ½Ğ¸Ğ¶Ğµ:"
                        )
                    else:
                        text = (
                            f"{icon} **{display_name}**\n\n"
                            f"{description}\n\n"
                            f"ğŸ“Š **Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ:**\n"
                            f"â€¢ Ğ’ĞµÑ€ÑĞ¸Ñ: {version}\n"
                            f"â€¢ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: {'âœ… ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½' if module_info.is_loaded_successfully else 'âŒ ĞĞµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½'}\n\n"
                            f"ğŸ’¡ ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ¸Ğ»Ğ¸ Ñƒ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ğ¸Ñ… Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ."
                        )
                    
                    builder = InlineKeyboardBuilder()
                    
                    if commands:
                        for cmd in commands:
                            cmd_icon = cmd.icon or "âš™ï¸"
                            cmd_text = f"{cmd_icon} {cmd.description or cmd.command}"
                            builder.row(
                                InlineKeyboardButton(
                                    text=cmd_text,
                                    callback_data=ModuleAction(
                                        module_name=module_info.name,
                                        command=cmd.command,
                                        action="execute"
                                    ).pack()
                                )
                            )
                    
                    builder.row(
                        InlineKeyboardButton(
                            text="ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼",
                            callback_data=CoreMenuNavigate(target_menu="modules_list").pack()
                        )
                    )
                    keyboard = builder.as_markup()
                    
                    await message.answer(text, reply_markup=keyboard, parse_mode="Markdown")
                    return
    
    # ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ… - Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ´ĞµĞ»Ğ°ĞµĞ¼ (Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ ĞµÑ‘ ÑĞ°Ğ¼)


@core_ui_router.message(Command("reset_password"))
async def handle_reset_password_command(
    message: types.Message,
    bot: Bot,
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser,
):
    """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ /reset_password - ÑĞ±Ñ€Ğ¾Ñ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ."""
    user_tg = message.from_user
    if not user_tg:
        return
    
    try:
        from pathlib import Path
        from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ»Ğ¸ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
        config_dir = Path(__file__).parent.parent.parent.parent / "config"
        cloud_password_file = config_dir / f"cloud_password_{sdb_user.telegram_id}.txt"
        
        if not cloud_password_file.exists():
            await message.answer(
                f"{hbold('â„¹ï¸ ĞĞ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½')}\\n\\n"
                f"Ğ£ Ğ²Ğ°Ñ ĞµÑ‰Ñ‘ Ğ½ĞµÑ‚ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ. Ğ’Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ñ‡ĞµÑ€ĞµĞ· /login, "
                f"Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ Ğ²Ğ°Ğ¼ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ."
            )
            logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ°Ğ»ÑÑ ÑĞ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ½ĞµÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ.")
            return
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
        keyboard = InlineKeyboardMarkup(inline_keyboard=[
            [
                InlineKeyboardButton(
                    text="âœ… Ğ”Ğ°, ÑĞ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ",
                    callback_data=CoreServiceAction(action="confirm_reset_password").pack()
                ),
                InlineKeyboardButton(
                    text="âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°",
                    callback_data=CoreServiceAction(action="cancel_reset_password").pack()
                )
            ]
        ])
        
        # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸ĞµĞ¼
        reset_text = (
            f"{hbold('ğŸ” Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ')}\\n\\n"
            f"Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑĞ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ?\\n\\n"
            f"{hitalic('ĞŸĞ¾ÑĞ»Ğµ ÑĞ±Ñ€Ğ¾ÑĞ° Ğ²Ğ°Ğ¼ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ¿Ñ€Ğ¸ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼ Ğ²Ñ…Ğ¾Ğ´Ğµ Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ.')}"
        )
        
        await message.answer(reset_text, reply_markup=keyboard)
        logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» ÑĞ±Ñ€Ğ¾Ñ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ.")
        
    except Exception as e:
        logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ /reset_password Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {sdb_user.telegram_id}: {e}", exc_info=True)
        await message.answer(
            f"{hbold('âŒ ĞÑˆĞ¸Ğ±ĞºĞ°')}\\n\\n"
            f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° ÑĞ±Ñ€Ğ¾Ñ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ."
        )


@core_ui_router.callback_query(CoreServiceAction.filter(F.action == "confirm_reset_password"))
async def cq_confirm_reset_password(
    query: types.CallbackQuery,
    bot: Bot,
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser,
):
    """ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ ÑĞ±Ñ€Ğ¾ÑĞ° Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ."""
    user_id = sdb_user.telegram_id
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ğ» ÑĞ±Ñ€Ğ¾Ñ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ.")
    
    try:
        from pathlib import Path
        import os
        
        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ñ„Ğ°Ğ¹Ğ» Ñ Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¼
        config_dir = Path(__file__).parent.parent.parent.parent / "config"
        cloud_password_file = config_dir / f"cloud_password_{user_id}.txt"
        
        if cloud_password_file.exists():
            os.remove(cloud_password_file)
            logger.success(f"[{MODULE_NAME_FOR_LOG}] ĞĞ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id} ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½.")
            
            success_text = (
                f"{hbold('âœ… ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½')}\\n\\n"
                f"ĞĞ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½.\\n\\n"
                f"ĞŸÑ€Ğ¸ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼ Ğ²Ñ…Ğ¾Ğ´Ğµ Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ñ‡ĞµÑ€ĞµĞ· /login "
                f"Ğ²Ğ°Ğ¼ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ."
            )
            
            if query.message:
                try:
                    await query.message.edit_text(success_text)
                except Exception:
                    await bot.send_message(user_id, success_text)
            else:
                await bot.send_message(user_id, success_text)
                
            await query.answer("ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½", show_alert=False)
        else:
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] Ğ¤Ğ°Ğ¹Ğ» Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ.")
            await query.answer("ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ» ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½", show_alert=True)
            
            if query.message:
                try:
                    await query.message.delete()
                except Exception:
                    pass
                    
    except Exception as e:
        logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id}: {e}", exc_info=True)
        await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ±Ñ€Ğ¾ÑĞµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ", show_alert=True)


@core_ui_router.callback_query(CoreServiceAction.filter(F.action == "cancel_reset_password"))
async def cq_cancel_reset_password(
    query: types.CallbackQuery,
    bot: Bot,
):
    """ĞÑ‚Ğ¼ĞµĞ½Ğ° ÑĞ±Ñ€Ğ¾ÑĞ° Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ."""
    user_id = query.from_user.id if query.from_user else 0
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ» ÑĞ±Ñ€Ğ¾Ñ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ.")
    
    cancel_text = (
        f"{hbold('âŒ ĞÑ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾')}\\n\\n"
        f"Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½. Ğ’Ğ°Ñˆ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ¾ÑÑ‚Ğ°Ğ»ÑÑ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹."
    )
    
    if query.message:
        try:
            await query.message.edit_text(cancel_text)
        except Exception:
            await bot.send_message(user_id, cancel_text)
    else:
        await bot.send_message(user_id, cancel_text)
        
    await query.answer()



@core_ui_router.callback_query(CoreServiceAction.filter(F.action == "confirm_registration"))
async def cq_confirm_registration_and_show_main_menu(
    query: types.CallbackQuery, 
    bot: Bot, 
    services_provider: 'BotServicesProvider',
    sdb_user: Optional[DBUser],
    state: FSMContext 
):
    user_id = query.from_user.id
    user_full_name = query.from_user.full_name
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ğ» Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ, Ğ¿Ğ¾ĞºĞ°Ğ· Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ reply-Ğ¼ĞµĞ½Ñ.")

    if not sdb_user:
        try:
            sdb_user, created_flag = await services_provider.user_service.process_user_on_start(query.from_user)
            if not sdb_user:
                await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°.", show_alert=True)
                return
        except Exception as e_create:
            logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸: {e_create}", exc_info=True)
            await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ. ĞĞ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ĞµÑÑŒ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ.", show_alert=True)
            return
    
    if query.message:
        try:
            await query.message.delete()
        except Exception as e:
            logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸ĞµĞ¼: {e}")
            
    await show_main_menu_reply(query, bot, services_provider, sdb_user, 
                               text_override=f"ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾, {hbold(user_full_name)}! Ğ’Ğ¾Ñ‚ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ:",
                               state=state) 


@core_ui_router.callback_query(CoreServiceAction.filter(F.action == "cancel_registration"))
async def cq_cancel_registration(
    query: types.CallbackQuery, 
    bot: Bot, 
    services_provider: 'BotServicesProvider', 
    state: FSMContext 
):
    user_id = query.from_user.id 
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ» Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ/Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ğµ.")
    await state.clear() 
    
    texts = TEXTS_CORE_KEYBOARDS_EN
    cancel_text = texts.get("registration_cancelled_message", "Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°.")

    if query.message:
        try:
            await query.message.delete()
        except Exception as e_delete:
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ (user: {user_id}): {e_delete}")
    
    await bot.send_message(user_id, cancel_text, reply_markup=ReplyKeyboardRemove())
    await query.answer()


# ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ reply-ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ F.text Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¾Ğ¹ Ğ²ÑĞµÑ… Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ñ… Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ²
@core_ui_router.message(F.text.in_([
    "ğŸ—‚ ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸",  # ru
    "ğŸ—‚ Modules and Features",  # en
    "ğŸ—‚ ĞœĞ¾Ğ´ÑƒĞ»Ñ– Ñ‚Ğ° Ñ„ÑƒĞ½ĞºÑ†Ñ–Ñ—",  # ua
]))
async def handle_text_modules_list(message: types.Message, services_provider: 'BotServicesProvider', sdb_user: DBUser):
    logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} Ğ½Ğ°Ğ¶Ğ°Ğ» reply-ĞºĞ½Ğ¾Ğ¿ĞºÑƒ 'ĞœĞ¾Ğ´ÑƒĞ»Ğ¸'")
    await send_modules_list_message(message.chat.id, message.bot, services_provider, sdb_user, page=1)

@core_ui_router.message(F.text.in_([
    "ğŸ‘¤ ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ",  # ru
    "ğŸ‘¤ My Profile",  # en
    "ğŸ‘¤ ĞœÑ–Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ñ–Ğ»ÑŒ",  # ua
]))
async def handle_text_profile(message: types.Message, services_provider: 'BotServicesProvider', sdb_user: DBUser):
    logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} Ğ½Ğ°Ğ¶Ğ°Ğ» reply-ĞºĞ½Ğ¾Ğ¿ĞºÑƒ 'ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ'")
    # ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· Ğ‘Ğ” Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞ·Ñ‹ĞºĞ°
    async with services_provider.db.get_session() as session:
        updated_user = await session.get(DBUser, sdb_user.id)
        if updated_user:
            sdb_user.preferred_language_code = updated_user.preferred_language_code
    await send_profile_message(message.chat.id, message.bot, services_provider, sdb_user)

@core_ui_router.message(F.text.in_([
    "âœï¸ Ğ¡Ğ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ Ñ Ğ½Ğ°Ğ¼Ğ¸",  # ru
    "âœï¸ Contact Us",  # en
    "âœï¸ Ğ—Ğ²'ÑĞ·Ğ°Ñ‚Ğ¸ÑÑ Ğ· Ğ½Ğ°Ğ¼Ğ¸",  # ua
]), StateFilter(None))
async def handle_text_feedback_start_fsm(
    message: types.Message, 
    services_provider: 'BotServicesProvider', 
    sdb_user: DBUser, 
    state: FSMContext
):
    logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} Ğ½Ğ°Ğ¶Ğ°Ğ» reply-ĞºĞ½Ğ¾Ğ¿ĞºÑƒ 'ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ', Ğ²Ñ…Ğ¾Ğ´ Ğ² FSM.")
    
    user_locale = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
    translator = _get_translator_for_handler(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, user_locale, **kwargs)
    
    text = t("feedback_request")
    await state.set_state(FSMFeedback.waiting_for_feedback_message)
    await message.answer(text) 

@core_ui_router.message(StateFilter(FSMFeedback.waiting_for_feedback_message), F.text)
async def process_feedback_message(
    message: types.Message, 
    services_provider: 'BotServicesProvider', 
    sdb_user: DBUser, 
    state: FSMContext
):
    feedback_text = message.text
    user_id = sdb_user.telegram_id
    
    user_locale = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
    translator = _get_translator_for_handler(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, user_locale, **kwargs)
    
    # Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—Ğ£Ğ•Ğœ html.escape
    user_full_name_escaped = html.escape(sdb_user.full_name) 
    username_escaped = f"@{html.escape(sdb_user.username)}" if sdb_user.username else "(Ğ½ĞµÑ‚ username)"
    
    logger.info(f"ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑĞ²ÑĞ·Ğ¸ Ğ¾Ñ‚ {user_id} ({username_escaped}): '{feedback_text[:100]}...'")

    admin_message_header = (
        f"ğŸ“¬ {hbold('ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¾Ñ‚Ğ·Ñ‹Ğ² Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ!')}\n\n"
        f"ğŸ‘¤ ĞÑ‚: {user_full_name_escaped}\n"
        f"ğŸ†” Telegram ID: {hcode(str(user_id))}\n"
        f"ğŸ”— Username: {username_escaped}\n"
        f"ğŸ•’ Ğ’Ñ€ĞµĞ¼Ñ: {message.date.strftime('%Y-%m-%d %H:%M:%S %Z') if message.date else 'N/A'}\n"
    )
    admin_message_body = f"\nğŸ“ {hbold('Ğ¢ĞµĞºÑÑ‚ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ°:')}\n{html.escape(feedback_text)}" # Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—Ğ£Ğ•Ğœ html.escape
    full_admin_message = admin_message_header + admin_message_body
    
    sent_to_admins_count = 0
    if services_provider.config.core.super_admins:
        for admin_tg_id in services_provider.config.core.super_admins:
            try:
                await message.bot.send_message(admin_tg_id, full_admin_message)
                sent_to_admins_count += 1
            except Exception as e:
                logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½ÑƒÑ ÑĞ²ÑĞ·ÑŒ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ñƒ {admin_tg_id}: {e}")
        if sent_to_admins_count > 0:
            logger.info(f"ĞÑ‚Ğ·Ñ‹Ğ² ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½ {sent_to_admins_count} ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°Ğ¼.")
        else:
            logger.warning("ĞÑ‚Ğ·Ñ‹Ğ² Ğ½Ğµ Ğ±Ñ‹Ğ» Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½ Ğ½Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ (Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿ÑƒÑÑ‚ Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸).")
    else:
        logger.warning("Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ² Ğ¿ÑƒÑÑ‚. ĞÑ‚Ğ·Ñ‹Ğ² Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½.")
    
    await message.reply(t("feedback_thanks"))
    await show_main_menu_reply(message, message.bot, services_provider, sdb_user, text_override=t("main_menu_text"), state=state)

@core_ui_router.message(Command("cancel_feedback"), StateFilter(FSMFeedback.waiting_for_feedback_message))
async def cancel_feedback_fsm(
    message: types.Message, 
    bot: Bot,
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser,
    state: FSMContext
):
    logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ» Ğ²Ğ²Ğ¾Ğ´ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑĞ²ÑĞ·Ğ¸.")
    
    user_locale = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
    translator = _get_translator_for_handler(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, user_locale, **kwargs)
    
    await message.reply(t("feedback_cancelled"))
    await show_main_menu_reply(message, bot, services_provider, sdb_user, text_override=t("main_menu_text"), state=state)


@core_ui_router.message(F.text.in_([
    "ğŸ›  ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ",  # ru
    "ğŸ›  Administration",  # en
    "ğŸ›  ĞĞ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ",  # ua
]))
async def handle_text_admin_panel(message: types.Message, services_provider: 'BotServicesProvider', sdb_user: DBUser, state: FSMContext): 
    logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {sdb_user.telegram_id} Ğ½Ğ°Ğ¶Ğ°Ğ» reply-ĞºĞ½Ğ¾Ğ¿ĞºÑƒ 'ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ'")
    await state.clear() 
    from Systems.core.admin.entry.handlers_entry import send_admin_main_menu 
    await send_admin_main_menu(message, services_provider) 


@core_ui_router.callback_query(CoreMenuNavigate.filter(F.target_menu == "main_reply"))
async def cq_nav_to_main_menu_reply(
    query: types.CallbackQuery, 
    bot: Bot, 
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser,
    state: FSMContext 
):
    await show_main_menu_reply(query, bot, services_provider, sdb_user, state=state) 


async def send_modules_list_message(
    chat_id: int, 
    bot: Bot, 
    services_provider: 'BotServicesProvider', 
    sdb_user: DBUser, 
    page: int = 1,
    message_to_edit: Optional[types.Message] = None 
):
    user_id = sdb_user.telegram_id
    user_locale = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
    translator = _get_translator_for_handler(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, user_locale, **kwargs)
    
    items_per_page = 5
    keyboard = await get_modules_list_keyboard(services_provider, user_id, page, items_per_page, locale=user_locale)
    
    num_module_buttons = 0; total_accessible_items = 0
    if keyboard.inline_keyboard: 
        for row in keyboard.inline_keyboard:
            for button in row:
                if button.callback_data and button.callback_data.startswith(ModuleMenuEntry.__prefix__):
                    num_module_buttons +=1

    all_module_ui_entries_temp = services_provider.ui_registry.get_all_module_entries()
    if all_module_ui_entries_temp:
        async with services_provider.db.get_session() as session:
            for entry_temp in all_module_ui_entries_temp:
                if entry_temp.required_permission_to_view:
                    if await services_provider.rbac.user_has_permission(session, user_id, entry_temp.required_permission_to_view):
                        total_accessible_items +=1
                else: total_accessible_items +=1
    
    total_pages = (total_accessible_items + items_per_page - 1) // items_per_page
    total_pages = max(1, total_pages)

    if num_module_buttons == 0 and page == 1: 
        text = t("modules_list_no_modules")
    else: 
        text = t("modules_list_title_template", current_page=page, total_pages=total_pages)
    
    if message_to_edit: 
        try:
            if message_to_edit.text != text or message_to_edit.reply_markup != keyboard:
                await message_to_edit.edit_text(text, reply_markup=keyboard)
            return 
        except TelegramBadRequest as e:
            if "message is not modified" not in str(e).lower():
                logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ edit modules list (inline pagination): {e}")
            return
        except Exception as e:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² send_modules_list_message (edit): {e}", exc_info=True)
            return
    
    await bot.send_message(chat_id, text, reply_markup=keyboard)


async def send_profile_message(
    chat_id: int, 
    bot: Bot, 
    services_provider: 'BotServicesProvider', 
    sdb_user: DBUser,
    message_to_edit: Optional[types.Message] = None
):
    # ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· Ğ‘Ğ” Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞ·Ñ‹ĞºĞ°
    async with services_provider.db.get_session() as session:
        updated_user = await session.get(DBUser, sdb_user.id)
        if updated_user:
            sdb_user.preferred_language_code = updated_user.preferred_language_code
            # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ñ‚Ğ°ĞºĞ¶Ğµ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ¿Ğ¾Ğ»Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
            if not sdb_user.created_at and updated_user.created_at:
                sdb_user.created_at = updated_user.created_at
            if not sdb_user.username and updated_user.username:
                sdb_user.username = updated_user.username
            if not sdb_user.full_name and updated_user.full_name:
                sdb_user.full_name = updated_user.full_name
    
    user_locale = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
    translator = _get_translator_for_handler(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, user_locale, **kwargs)
    
    reg_date_str = sdb_user.created_at.strftime('%d.%m.%Y %H:%M') if sdb_user.created_at else t("profile_no_reg_date")
    username_str = f"@{sdb_user.username}" if sdb_user.username else t("profile_no_username")
    current_lang = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ·Ñ‹ĞºĞ° Ğ¸Ğ· Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ²
    lang_key = f"language_{current_lang}"
    lang_display_name = t(lang_key)

    profile_text = t("profile_info_template",
        user_id=str(sdb_user.telegram_id),
        full_name=sdb_user.full_name,
        username=username_str.replace("@", ""),
        registration_date=reg_date_str,
        current_language=lang_display_name
    )
    final_text = f"{hbold(t('profile_title'))}\n\n{profile_text}"
    keyboard = await get_profile_menu_keyboard(sdb_user, services_provider, locale=user_locale)
    
    if message_to_edit:
        try:
            if message_to_edit.text != final_text or message_to_edit.reply_markup != keyboard:
                await message_to_edit.edit_text(final_text, reply_markup=keyboard)
            return
        except TelegramBadRequest as e:
            if "message is not modified" not in str(e).lower():
                logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ edit profile (inline nav): {e}")
            return
        except Exception as e:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² send_profile_message (edit): {e}", exc_info=True)
            return
            
    await bot.send_message(chat_id, final_text, reply_markup=keyboard)


@core_ui_router.callback_query(CoreMenuNavigate.filter(F.target_menu == "modules_list"))
async def cq_nav_to_modules_list(
    query: types.CallbackQuery, 
    callback_data: CoreMenuNavigate, 
    bot: Bot, 
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser
):
    user_id = sdb_user.telegram_id
    page = callback_data.page if callback_data.page is not None else 1
    logger.debug(f"[{MODULE_NAME_FOR_LOG}] User {user_id} requested modules list (inline nav), page: {page}")
    
    if query.message:
        await send_modules_list_message(query.message.chat.id, bot, services_provider, sdb_user, page, message_to_edit=query.message)
    await query.answer()


@core_ui_router.callback_query(CoreMenuNavigate.filter(F.target_menu == "profile"))
async def cq_nav_to_profile( 
    query: types.CallbackQuery, 
    bot: Bot, 
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser 
):
    if query.message:
        await send_profile_message(query.message.chat.id, bot, services_provider, sdb_user, message_to_edit=query.message)
    await query.answer()


@core_ui_router.callback_query(CoreMenuNavigate.filter(F.target_menu == "profile_change_lang_list"))
async def cq_profile_show_language_list(
    query: types.CallbackQuery,
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser
):
    user_id = sdb_user.telegram_id
    logger.debug(f"[{MODULE_NAME_FOR_LOG}] User {user_id} requested language selection list.")
    
    user_locale = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
    translator = _get_translator_for_handler(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, user_locale, **kwargs)
    
    i18n_settings = services_provider.config.core.i18n
    
    current_lang = sdb_user.preferred_language_code or i18n_settings.default_locale
    available_langs = i18n_settings.available_locales
    
    text = t("profile_select_language_title")
    keyboard = await get_language_selection_keyboard(current_lang, available_langs, services_provider=services_provider, locale=user_locale)
    
    if query.message:
        try:
            if query.message.text != text or query.message.reply_markup != keyboard: 
                await query.message.edit_text(text, reply_markup=keyboard)
            await query.answer()
        except TelegramBadRequest as e:
            if "message is not modified" not in str(e).lower():
                 logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° edit_text Ğ² cq_profile_show_language_list: {e}")
            await query.answer() 
        except Exception as e:
            logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² cq_profile_show_language_list: {e}", exc_info=True)
            await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ.")

@core_ui_router.callback_query(CoreMenuNavigate.filter(F.target_menu == "profile_set_lang"))
async def cq_profile_set_language(
    query: types.CallbackQuery,
    callback_data: CoreMenuNavigate,
    bot: Bot, 
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser,
    translator: Translator 
):
    new_lang_code = callback_data.payload
    user_id = sdb_user.telegram_id
    
    if not new_lang_code or new_lang_code not in services_provider.config.core.i18n.available_locales:
        logger.warning(f"[{MODULE_NAME_FOR_LOG}] User {user_id} Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ°Ğ»ÑÑ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº: {new_lang_code}")
        await query.answer("Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº.", show_alert=True)
        if query.message: 
            await send_profile_message(query.message.chat.id, bot, services_provider, sdb_user, message_to_edit=query.message)
        return

    logger.info(f"[{MODULE_NAME_FOR_LOG}] User {user_id} ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ ÑĞ·Ñ‹Ğº: {new_lang_code}")
    
    user_service = services_provider.user_service 
    language_updated = False
    async with services_provider.db.get_session() as session: 
        user_in_session = await session.get(DBUser, sdb_user.id) 
        if user_in_session:
            old_lang = user_in_session.preferred_language_code
            logger.debug(f"[{MODULE_NAME_FOR_LOG}] Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id} Ğ² Ğ‘Ğ”: {old_lang}, Ğ½Ğ¾Ğ²Ñ‹Ğ¹: {new_lang_code}")
            
            if await user_service.update_user_language(user_in_session, new_lang_code, session):
                try:
                    await session.commit()
                    # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ¸Ğ· Ğ‘Ğ” Ğ¿Ğ¾ÑĞ»Ğµ commit
                    await session.refresh(user_in_session)
                    saved_lang = user_in_session.preferred_language_code
                    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾ÑĞ»Ğµ commit ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id} Ğ² Ğ‘Ğ”: {saved_lang}")
                    
                    # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚ sdb_user
                    sdb_user.preferred_language_code = saved_lang
                    language_updated = True
                    
                    logger.success(f"[{MODULE_NAME_FOR_LOG}] Ğ¯Ğ·Ñ‹Ğº Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id} ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½ Ğ½Ğ° {new_lang_code} Ğ² Ğ‘Ğ” (Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¾: {saved_lang}).")
                    
                    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¾Ğ± ÑƒÑĞ¿ĞµÑ…Ğµ
                    user_locale = new_lang_code
                    translator = _get_translator_for_handler(services_provider)
                    def t(key: str, **kwargs) -> str:
                        return translator.gettext(key, user_locale, **kwargs)
                    
                    await query.answer(t("profile_language_changed").format(lang=new_lang_code.upper()), show_alert=False)
                except Exception as e_commit:
                    await session.rollback()
                    logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° commit Ğ¿Ñ€Ğ¸ ÑĞ¼ĞµĞ½Ğµ ÑĞ·Ñ‹ĞºĞ° Ğ´Ğ»Ñ {user_id}: {e_commit}", exc_info=True)
                    
                    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
                    user_locale = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
                    translator = _get_translator_for_handler(services_provider)
                    def t(key: str, **kwargs) -> str:
                        return translator.gettext(key, user_locale, **kwargs)
                    
                    await query.answer(t("profile_language_change_error"), show_alert=True)
            else:
                # Ğ¯Ğ·Ñ‹Ğº ÑƒĞ¶Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½
                logger.debug(f"[{MODULE_NAME_FOR_LOG}] Ğ¯Ğ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id} ÑƒĞ¶Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ½Ğ° {new_lang_code}")
                user_locale = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
                translator = _get_translator_for_handler(services_provider)
                def t(key: str, **kwargs) -> str:
                    return translator.gettext(key, user_locale, **kwargs)
                
                await query.answer(t("profile_language_already_set").format(lang=new_lang_code.upper()), show_alert=False)
        else: 
            logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} (DB ID: {sdb_user.id}) Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ‘Ğ” Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ·Ñ‹ĞºĞ°")
            user_locale = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
            translator = _get_translator_for_handler(services_provider)
            def t(key: str, **kwargs) -> str:
                return translator.gettext(key, user_locale, **kwargs)
            
            await query.answer(t("profile_language_user_not_found"), show_alert=True)
    
    # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ñ Ğ½Ğ¾Ğ²Ñ‹Ğ¼ ÑĞ·Ñ‹ĞºĞ¾Ğ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ ÑĞ·Ñ‹Ğº Ğ±Ñ‹Ğ» ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½
    if query.message and language_updated:
        # ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· Ğ‘Ğ” Ğ´Ğ»Ñ Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ğ¸ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        async with services_provider.db.get_session() as session:
            updated_user = await session.get(DBUser, sdb_user.id)
            if updated_user:
                final_lang = updated_user.preferred_language_code
                logger.debug(f"[{MODULE_NAME_FOR_LOG}] Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id} Ğ² Ğ‘Ğ” Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸: {final_lang}")
                sdb_user.preferred_language_code = final_lang
        await send_profile_message(query.message.chat.id, bot, services_provider, sdb_user, message_to_edit=query.message)
    elif query.message:
        # Ğ•ÑĞ»Ğ¸ ÑĞ·Ñ‹Ğº Ğ½Ğµ Ğ±Ñ‹Ğ» Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ñ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
        await send_profile_message(query.message.chat.id, bot, services_provider, sdb_user, message_to_edit=query.message)
    

@core_ui_router.callback_query(CoreMenuNavigate.filter(F.target_menu == "feedback_fsm_start"))
async def cq_nav_to_feedback_fsm_start( 
    query: types.CallbackQuery, 
    bot: Bot, 
    services_provider: 'BotServicesProvider', 
    sdb_user: DBUser, 
    state: FSMContext
):
    user_id = query.from_user.id
    logger.debug(f"[{MODULE_NAME_FOR_LOG}] User {user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½ÑƒÑ ÑĞ²ÑĞ·ÑŒ (FSM Ñ‡ĞµÑ€ĞµĞ· callback).")
    text = (
        "âœï¸ ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ²Ğ°ÑˆĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑĞ²ÑĞ·Ğ¸.\n"
        f"{hitalic('Ğ”Ğ»Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹ Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ /cancel_feedback')}"
    )
    await state.set_state(FSMFeedback.waiting_for_feedback_message)
    
    if query.message:
        try: 
            await query.message.edit_text(text, reply_markup=None) 
        except TelegramBadRequest as e:
             if "message is not modified" not in str(e).lower():
                logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ğ²Ğ¾Ğ´Ğ¾Ğ¼ feedback (callback): {e}")
                await bot.send_message(user_id, text) 
        except Exception as e_edit_fb:
            logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ğ²Ğ¾Ğ´Ğ¾Ğ¼ feedback (callback): {e_edit_fb}")
            await bot.send_message(user_id, text)
    else: 
        await bot.send_message(user_id, text)
    await query.answer()


@core_ui_router.callback_query(CoreServiceAction.filter(F.action == "delete_this_message"))
async def cq_service_action_delete_message(query: types.CallbackQuery):
    user_id = query.from_user.id
    message_id = query.message.message_id if query.message else "N/A"
    logger.debug(f"[{MODULE_NAME_FOR_LOG}] User {user_id} requested to delete message_id: {message_id}")
    
    try:
        if query.message:
            await query.bot.delete_message(chat_id=query.message.chat.id, message_id=query.message.message_id)
            await query.answer("Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¾.") 
        else:
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑƒ Ğ¾Ñ‚ user {user_id}.")
            await query.answer("ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ.")
    except TelegramBadRequest as e: 
        logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ {message_id} Ğ´Ğ»Ñ user {user_id}: {e} (Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, ÑƒĞ¶Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¾ Ğ¸Ğ»Ğ¸ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ²).")
        await query.answer() 
    except Exception as e:
        logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ {message_id} Ğ´Ğ»Ñ user {user_id}: {e}", exc_info=True)
        await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ.", show_alert=True)


@core_ui_router.callback_query(ModuleMenuEntry.filter())
async def cq_module_entry_default(
    query: types.CallbackQuery,
    callback_data: ModuleMenuEntry,
    bot: Bot,
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser
):
    """
    Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ñ‡ĞµÑ€ĞµĞ· UI.
    Ğ­Ñ‚Ğ¾Ñ‚ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ°Ğº fallback, ĞµÑĞ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ» ÑĞ²Ğ¾Ğ¹ ÑĞ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº.
    ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº, Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ² ÑĞ²Ğ¾Ğ¹ Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¼ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ¾Ğ¼.
    """
    user_id = sdb_user.telegram_id
    module_name = callback_data.module_name
    
    logger.debug(f"[{MODULE_NAME_FOR_LOG}] User {user_id} requested entry to module '{module_name}'")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ Ğ¸Ğ· UIRegistry
    module_entry = services_provider.ui_registry.get_module_entry(module_name)
    if not module_entry:
        logger.warning(f"[{MODULE_NAME_FOR_LOG}] Module entry '{module_name}' not found in UIRegistry")
        await query.answer("âŒ ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½", show_alert=True)
        return
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ, ĞµÑĞ»Ğ¸ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ
    if module_entry.required_permission_to_view:
        async with services_provider.db.get_session() as session:
            has_permission = await services_provider.rbac.user_has_permission(
                session, user_id, module_entry.required_permission_to_view
            )
            if not has_permission:
                await query.answer("âŒ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ", show_alert=True)
                return
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ Ğ¸Ğ· ModuleLoader
    module_info = services_provider.modules.get_module_info(module_name)
    if not module_info:
        logger.warning(f"[{MODULE_NAME_FOR_LOG}] Module info for '{module_name}' not found")
        await query.answer("âŒ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°", show_alert=True)
        return
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = sdb_user.preferred_language_code or services_provider.config.core.i18n.default_locale
    translator = _get_translator_for_handler(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, user_locale, **kwargs)
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ
    icon = module_entry.icon or "ğŸ§©"
    display_name = module_entry.display_name or module_name
    description = module_entry.description or (module_info.manifest.description if module_info.manifest else "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½")
    version = module_info.manifest.version if module_info.manifest else "N/A"
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¸Ğ· Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°
    commands = []
    if module_info.manifest and module_info.manifest.commands:
        async with services_provider.db.get_session() as session:
            is_super_admin = user_id in services_provider.config.core.super_admins
            for cmd_manifest in module_info.manifest.commands:
                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ
                if cmd_manifest.admin_only:
                    if not is_super_admin:
                        has_admin_permission = await services_provider.rbac.user_has_permission(
                            session, user_id, "core.view_admin_panel"
                        )
                        if not has_admin_permission:
                            continue
                
                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)
                permission_to_check = get_module_permission_to_check(module_info.name, module_info.manifest)
                if permission_to_check:
                    has_permission = await services_provider.rbac.user_has_permission(
                        session, user_id, permission_to_check
                    )
                    if not has_permission:
                        continue
                
                commands.append(cmd_manifest)
    
    # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ñ‚ĞµĞºÑÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
    if commands:
        text = (
            f"{icon} **{display_name}**\n\n"
            f"{description}\n\n"
            f"ğŸ“Š **Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ:**\n"
            f"â€¢ Ğ’ĞµÑ€ÑĞ¸Ñ: {version}\n"
            f"â€¢ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: {'âœ… ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½' if module_info.is_loaded_successfully else 'âŒ ĞĞµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½'}\n\n"
            f"ğŸ¯ **Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ:**\n"
            f"Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ¸Ğ· ÑĞ¿Ğ¸ÑĞºĞ° Ğ½Ğ¸Ğ¶Ğµ:"
        )
    else:
        text = (
            f"{icon} **{display_name}**\n\n"
            f"{description}\n\n"
            f"ğŸ“Š **Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ:**\n"
            f"â€¢ Ğ’ĞµÑ€ÑĞ¸Ñ: {version}\n"
            f"â€¢ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: {'âœ… ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½' if module_info.is_loaded_successfully else 'âŒ ĞĞµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½'}\n\n"
            f"ğŸ’¡ ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ¸Ğ»Ğ¸ Ñƒ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ğ¸Ñ… Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ."
        )
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
    from aiogram.types import InlineKeyboardButton
    from aiogram.utils.keyboard import InlineKeyboardBuilder
    
    builder = InlineKeyboardBuilder()
    
    if commands:
        # Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼
        commands_by_category: Dict[str, List] = {}
        commands_without_category = []
        
        for cmd in commands:
            category = cmd.category or "ĞĞ±Ñ‰Ğ¸Ğµ"
            if category not in commands_by_category:
                commands_by_category[category] = []
            commands_by_category[category].append(cmd)
        
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼
        for category, category_commands in sorted(commands_by_category.items()):
            for cmd in category_commands:
                cmd_icon = cmd.icon or "âš™ï¸"
                cmd_text = f"{cmd_icon} {cmd.description or cmd.command}"
                builder.row(
                    InlineKeyboardButton(
                        text=cmd_text,
                        callback_data=ModuleAction(
                            module_name=module_name,
                            command=cmd.command,
                            action="execute"
                        ).pack()
                    )
                )
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° "ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼"
    builder.row(
        InlineKeyboardButton(
            text="ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼",
            callback_data=CoreMenuNavigate(target_menu="modules_list").pack()
        )
    )
    keyboard = builder.as_markup()
    
    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¸Ğ»Ğ¸ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
    try:
        if query.message:
            await query.message.edit_text(
                text=text,
                reply_markup=keyboard,
                parse_mode="Markdown"
            )
        else:
            await bot.send_message(
                chat_id=user_id,
                text=text,
                reply_markup=keyboard,
                parse_mode="Markdown"
            )
    except TelegramBadRequest as e:
        if "message is not modified" not in str(e).lower():
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}': {e}")
    except Exception as e:
        logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ '{module_name}': {e}", exc_info=True)
        await query.answer("âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ", show_alert=True)
        return
    
    await query.answer()


@core_ui_router.callback_query(ModuleAction.filter())
async def cq_module_action(
    query: types.CallbackQuery,
    callback_data: ModuleAction,
    bot: Bot,
    services_provider: 'BotServicesProvider',
    sdb_user: DBUser
):
    """
    Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ´Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´).
    Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ĞµÑ‘ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ.
    """
    user_id = sdb_user.telegram_id
    module_name = callback_data.module_name
    command = callback_data.command
    action = callback_data.action or "execute"
    
    logger.debug(f"[{MODULE_NAME_FOR_LOG}] User {user_id} requested action '{action}' for command '{command}' in module '{module_name}'")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ
    module_info = services_provider.modules.get_module_info(module_name)
    if not module_info or not module_info.manifest:
        logger.warning(f"[{MODULE_NAME_FOR_LOG}] Module info or manifest for '{module_name}' not found")
        await query.answer("âŒ ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½", show_alert=True)
        return
    
    # ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ğ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ
    cmd_manifest = None
    for cmd in module_info.manifest.commands:
        if cmd.command == command:
            cmd_manifest = cmd
            break
    
    if not cmd_manifest:
        logger.warning(f"[{MODULE_NAME_FOR_LOG}] Command '{command}' not found in module '{module_name}' manifest")
        await query.answer("âŒ ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°", show_alert=True)
        return
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
    async with services_provider.db.get_session() as session:
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° admin_only
        if cmd_manifest.admin_only:
            is_super_admin = user_id in services_provider.config.core.super_admins
            if not is_super_admin:
                has_admin_permission = await services_provider.rbac.user_has_permission(
                    session, user_id, "core.view_admin_panel"
                )
                if not has_admin_permission:
                    await query.answer("âŒ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ° Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹", show_alert=True)
                    return
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        permission_to_check = get_module_permission_to_check(module_info.name, module_info.manifest)
        if permission_to_check:
            has_permission = await services_provider.rbac.user_has_permission(
                session, user_id, permission_to_check
            )
            if not has_permission:
                await query.answer("âŒ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹", show_alert=True)
                return
    
    # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ
    if action == "execute":
        # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ
        # Ğ•ÑĞ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ ÑĞ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°, Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
        cmd_icon = cmd_manifest.icon or "âš™ï¸"
        cmd_description = cmd_manifest.description or command
        
        text = (
            f"{cmd_icon} **{cmd_description}**\n\n"
            f"ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° `/{command}` Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°.\n\n"
            f"ğŸ’¡ Ğ­Ñ‚Ğ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ ÑĞ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ° Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ.\n"
            f"Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ `/{command}` Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ°."
        )
        
        from aiogram.types import InlineKeyboardButton
        from aiogram.utils.keyboard import InlineKeyboardBuilder
        
        builder = InlineKeyboardBuilder()
        builder.row(
            InlineKeyboardButton(
                text="ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ",
                callback_data=ModuleMenuEntry(module_name=module_name).pack()
            )
        )
        keyboard = builder.as_markup()
        
        try:
            if query.message:
                await query.message.edit_text(
                    text=text,
                    reply_markup=keyboard,
                    parse_mode="Markdown"
                )
            else:
                await bot.send_message(
                    chat_id=user_id,
                    text=text,
                    reply_markup=keyboard,
                    parse_mode="Markdown"
                )
        except TelegramBadRequest as e:
            if "message is not modified" not in str(e).lower():
                logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ '{command}': {e}")
        except Exception as e:
            logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ '{command}': {e}", exc_info=True)
            await query.answer("âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹", show_alert=True)
            return
    
    await query.answer()


======================================================================

------------------------------ FILE: Systems/core/ui/navigation_core.py ------------------------------
# core/ui/navigation_core.py

from aiogram import Router, F, types, Bot
from aiogram.exceptions import TelegramBadRequest
from aiogram.utils.markdown import hbold, hitalic
from loguru import logger

from Systems.core.ui.callback_data_factories import CoreMenuNavigate, CoreServiceAction
from Systems.core.ui.keyboards_core import (
    get_main_menu_reply_keyboard, 
    get_modules_list_keyboard,
    # get_close_button_keyboard, # Ğ•ÑĞ»Ğ¸ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ ÑĞ²Ğ½Ğ¾
    TEXTS_CORE_KEYBOARDS_EN 
)

from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider

core_navigation_router = Router(name="sdb_core_navigation_handlers")
MODULE_NAME_FOR_LOG = "CoreNavigation"

@core_navigation_router.callback_query(CoreMenuNavigate.filter(F.target_menu == "main"))
async def cq_nav_to_main_menu(
    query: types.CallbackQuery, 
    services_provider: 'BotServicesProvider' 
):
    user_id = query.from_user.id
    logger.debug(f"User {user_id} requested main menu.")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· Ğ‘Ğ”
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    from Systems.core.i18n.translator import Translator
    translator = Translator(
        locales_dir=services_provider.config.core.i18n.locales_dir,
        domain=services_provider.config.core.i18n.domain,
        default_locale=services_provider.config.core.i18n.default_locale,
        available_locales=services_provider.config.core.i18n.available_locales
    )
    
    text = translator.gettext("main_menu_title", user_locale)
    keyboard = await get_main_menu_reply_keyboard(services_provider=services_provider, user_telegram_id=user_id, locale=user_locale)
    
    try:
        if query.message:
            if query.message.text != text or query.message.reply_markup != keyboard:
                await query.message.edit_text(text, reply_markup=keyboard)
            else:
                logger.trace("Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾.")
        await query.answer()
    except TelegramBadRequest as e:
        if "message is not modified" in str(e).lower():
            logger.trace("Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾ (Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ğ½Ğ¾ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ).")
            await query.answer()
        else:
            logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ (user: {user_id}): {e}")
            await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¼ĞµĞ½Ñ.", show_alert=True)
    except Exception as e:
        logger.error(f"ĞĞµĞ¿Ñ€ĞµĞ´Ğ²Ğ¸Ğ´ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğµ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ (user: {user_id}): {e}", exc_info=True)
        await query.answer("ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° ÑĞµÑ€ÑŒĞµĞ·Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°.", show_alert=True)

@core_navigation_router.callback_query(CoreMenuNavigate.filter(F.target_menu == "modules_list"))
async def cq_nav_to_modules_list(
    query: types.CallbackQuery, 
    callback_data: CoreMenuNavigate, 
    services_provider: 'BotServicesProvider' 
):
    user_id = query.from_user.id
    page = callback_data.page if callback_data.page is not None else 1
    logger.debug(f"User {user_id} requested modules list, page: {page}")

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· Ğ‘Ğ”
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    from Systems.core.i18n.translator import Translator
    translator = Translator(
        locales_dir=services_provider.config.core.i18n.locales_dir,
        domain=services_provider.config.core.i18n.domain,
        default_locale=services_provider.config.core.i18n.default_locale,
        available_locales=services_provider.config.core.i18n.available_locales
    )
    
    module_ui_entries = services_provider.ui_registry.get_all_module_entries()
    items_per_page = 5 
    total_pages = (len(module_ui_entries) + items_per_page - 1) // items_per_page
    total_pages = max(1, total_pages) 

    text = translator.gettext("modules_list_title_template", user_locale, current_page=page, total_pages=total_pages)
    
    keyboard = await get_modules_list_keyboard(
        services_provider=services_provider, 
        user_telegram_id=user_id, 
        current_page=page,
        items_per_page=items_per_page,
        locale=user_locale
    )
    
    try:
        if query.message:
            if query.message.text != text or query.message.reply_markup != keyboard:
                await query.message.edit_text(text, reply_markup=keyboard)
            else:
                logger.trace("Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾.")
        await query.answer()
    except TelegramBadRequest as e:
        if "message is not modified" in str(e).lower():
            logger.trace("Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾ (Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ğ½Ğ¾ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ).")
            await query.answer()
        else:
            logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (user: {user_id}): {e}")
            await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ°.", show_alert=True)
    except Exception as e:
        logger.error(f"ĞĞµĞ¿Ñ€ĞµĞ´Ğ²Ğ¸Ğ´ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (user: {user_id}): {e}", exc_info=True)
        await query.answer("ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° ÑĞµÑ€ÑŒĞµĞ·Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°.", show_alert=True)

# Ğ£Ğ´Ğ°Ğ»ĞµĞ½ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº cq_nav_to_admin_panel, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ¾Ğ½ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ²Ğ°Ğ»
# Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¼ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ¼ Ğ² core/admin/handlers_admin_entry.py

@core_navigation_router.callback_query(CoreServiceAction.filter(F.action == "delete_this_message"))
async def cq_service_action_delete_message(query: types.CallbackQuery):
    user_id = query.from_user.id
    message_id = query.message.message_id if query.message else "N/A"
    logger.debug(f"User {user_id} requested to delete message_id: {message_id}")
    
    try:
        if query.message:
            await query.bot.delete_message(chat_id=query.message.chat.id, message_id=query.message.message_id)
            await query.answer("Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¾.") 
        else:
            logger.warning(f"ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑƒ Ğ¾Ñ‚ user {user_id}.")
            await query.answer("ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ.")
    except TelegramBadRequest as e:
        logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ {message_id} Ğ´Ğ»Ñ user {user_id}: {e}")
        await query.answer()
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ {message_id} Ğ´Ğ»Ñ user {user_id}: {e}", exc_info=True)
        await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ.", show_alert=True)


======================================================================

------------------------------ FILE: Systems/core/ui/registry_ui.py ------------------------------
# core/ui/registry_ui.py

from typing import List, Dict, Optional, Callable, Any
from pydantic import BaseModel, Field, field_validator, ValidationError
from loguru import logger


class ModuleUIEntry(BaseModel):
    module_name: str = Field(description="Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ (Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°Ñ‚ÑŒ Ñ manifest.name)")
    display_name: str = Field(description="ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼Ğ¾Ğµ Ğ¸Ğ¼Ñ Ğ´Ğ»Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ² Ğ¼ĞµĞ½Ñ")
    entry_callback_data: str = Field(description="Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° callback_data Ğ´Ğ»Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ")
    
    icon: Optional[str] = Field(default=None, description="Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸-Ğ¸ĞºĞ¾Ğ½ĞºĞ° Ğ´Ğ»Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)")
    description: Optional[str] = Field(
        default=None, 
        description="ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ, Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ² UI (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ² ÑĞ¿Ğ¸ÑĞºĞµ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹)"
    )
    order: int = Field(
        default=100, 
        description="ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ² Ğ¼ĞµĞ½Ñ (Ğ¼ĞµĞ½ÑŒÑˆĞµĞµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚ Ğ±Ğ¾Ğ»ĞµĞµ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚/Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ)"
    )
    # ĞĞ¾Ğ²Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ Ğ´Ğ»Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ, Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ² Ğ¾Ğ±Ñ‰ĞµĞ¼ Ğ¼ĞµĞ½Ñ
    required_permission_to_view: Optional[str] = Field(
        default=None,
        description="Ğ˜Ğ¼Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ, Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾Ğµ Ğ´Ğ»Ñ Ñ‚Ğ¾Ğ³Ğ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑÑ‚Ğ° Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ±Ñ‹Ğ»Ğ° Ğ²Ğ¸Ğ´Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ."
    )

    @field_validator('module_name', 'display_name', 'entry_callback_data')
    @classmethod 
    def names_must_not_be_empty(cls, v: str) -> str: 
        if not v or not v.strip():
            raise ValueError("Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ, Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼Ğ¾Ğµ Ğ¸Ğ¼Ñ Ğ¸ entry_callback_data Ğ½Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞ°Ğ¼Ğ¸")
        return v

    class Config:
        validate_assignment = True 
        extra = 'forbid' 


class UIRegistry:
    def __init__(self):
        self._module_entries: Dict[str, ModuleUIEntry] = {}
        self._logger = logger.bind(service="UIRegistry")
        self._logger.info("UIRegistry Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")

    def register_module_entry(
        self,
        module_name: str,
        display_name: str,
        entry_callback_data: str,
        icon: Optional[str] = None,
        description: Optional[str] = None,
        order: int = 100,
        required_permission_to_view: Optional[str] = None # <--- ĞĞ¾Ğ²Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ
    ) -> bool:
        if module_name in self._module_entries:
            self._logger.warning(
                f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' ÑƒĞ¶Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ» ÑĞ²Ğ¾Ñ UI-Ñ‚Ğ¾Ñ‡ĞºÑƒ Ğ²Ñ…Ğ¾Ğ´Ğ°. "
                f"ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ°Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ÑƒÑ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ."
            )
        
        try:
            entry = ModuleUIEntry(
                module_name=module_name,
                display_name=display_name,
                entry_callback_data=entry_callback_data,
                icon=icon,
                description=description,
                order=order,
                required_permission_to_view=required_permission_to_view # <--- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ
            )
            self._module_entries[module_name] = entry
            self._logger.info(f"UI-Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}' ('{display_name}') ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°. "
                              f"Ğ¢Ñ€ĞµĞ±ÑƒĞµĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°: '{required_permission_to_view or 'Ğ½ĞµÑ‚'}'.")
            return True
        except ValidationError as e:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ UI-Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}': {e}")
            return False
        except Exception as e:
            self._logger.error(f"ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ UI-Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}': {e}", exc_info=True)
            return False

    def unregister_module_entry(self, module_name: str) -> bool:
        if module_name in self._module_entries:
            del self._module_entries[module_name]
            self._logger.info(f"UI-Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}' Ğ±Ñ‹Ğ»Ğ° Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ° (ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ° Ğ¸Ğ· Ñ€ĞµĞµÑÑ‚Ñ€Ğ°).")
            return True
        else:
            self._logger.warning(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ½ĞµĞ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¹ UI-Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}'.")
            return False

    def get_all_module_entries(self) -> List[ModuleUIEntry]: # Ğ£Ğ±Ñ€Ğ°Ğ» for_admin_status, Ğ±ÑƒĞ´ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ required_permission_to_view
        entries = list(self._module_entries.values())
        entries.sort(key=lambda x: (x.order, x.display_name.lower()))
        self._logger.trace(f"Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ’Ğ¡Ğ•Ğ¥ UI-Ñ‚Ğ¾Ñ‡ĞµĞº Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹. ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾: {len(entries)}")
        return entries

    def get_module_entry(self, module_name: str) -> Optional[ModuleUIEntry]:
        return self._module_entries.get(module_name)

    async def dispose(self) -> None: 
        self._module_entries.clear()
        self._logger.info("UIRegistry Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½ (Ğ²ÑĞµ UI-Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹).")


======================================================================

------------------------------ FILE: Systems/core/ui/keyboards_core.py ------------------------------
# SwiftDevBot/core/ui/keyboards_core.py

from typing import List, Dict, Optional, TYPE_CHECKING, Callable
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ Ğ´Ğ»Ñ Reply ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardMarkup, InlineKeyboardButton 
from aiogram.utils.keyboard import ReplyKeyboardBuilder, InlineKeyboardBuilder # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ReplyKeyboardBuilder
from loguru import logger 

from .callback_data_factories import CoreMenuNavigate, ModuleMenuEntry, CoreServiceAction
from Systems.core.rbac.service import PERMISSION_CORE_VIEW_ADMIN_PANEL 
from Systems.core.database.core_models import User as DBUser

if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from Systems.core.ui.registry_ui import ModuleUIEntry
    from sqlalchemy.ext.asyncio import AsyncSession

# Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºÑÑˆ Ğ´Ğ»Ñ translator (ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·)
_translator_cache: Optional['Translator'] = None

def _get_translator(services_provider: 'BotServicesProvider') -> 'Translator':
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ translator Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ² ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ°Ñ…"""
    global _translator_cache
    if _translator_cache is None:
        from Systems.core.i18n.translator import Translator
        _translator_cache = Translator(
            locales_dir=services_provider.config.core.i18n.locales_dir,
            domain=services_provider.config.core.i18n.domain,
            default_locale=services_provider.config.core.i18n.default_locale,
            available_locales=services_provider.config.core.i18n.available_locales
        )
    return _translator_cache 

# ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ñ‚ĞµĞºÑÑ‚Ñ‹ Ğ´Ğ»Ñ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ğ½Ğ¸ Ğ±Ñ‹Ğ»Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ¼Ğ¸ Ğ¸Ğ»Ğ¸ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ñ„Ñ€Ğ°Ğ·Ğ°Ğ¼Ğ¸
TEXTS_CORE_KEYBOARDS_EN = {
    # Ğ”Ğ»Ñ Reply Keyboard (Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ) - Ğ±Ğ¾Ğ»ĞµĞµ Ğ¸Ğ½Ñ‚ÑƒĞ¸Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ‚ĞµĞºÑÑ‚Ñ‹
    "main_menu_reply_modules": "ğŸ—‚ ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸", # Ğ‘Ğ¾Ğ»ĞµĞµ Ğ¾Ğ¿Ğ¸ÑĞ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ
    "main_menu_reply_profile": "ğŸ‘¤ ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ",
    "main_menu_reply_feedback": "âœï¸ Ğ¡Ğ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ Ñ Ğ½Ğ°Ğ¼Ğ¸", # Ğ‘Ğ¾Ğ»ĞµĞµ Ğ´Ñ€ÑƒĞ¶ĞµĞ»ÑĞ±Ğ½Ğ¾Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ
    "main_menu_reply_admin_panel": "ğŸ›  ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ",

    # Ğ”Ğ»Ñ Inline Keyboard (Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼ĞµĞ½Ñ)
    "main_menu_inline_modules": "ğŸ—‚ Modules", # ĞÑÑ‚Ğ°Ğ²Ğ¸Ğ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¸Ğ½Ğ»Ğ°Ğ¹Ğ½, ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ½Ğ°Ğ´Ğ¾Ğ±ÑÑ‚ÑÑ
    "main_menu_inline_profile": "ğŸ‘¤ Profile",
    "main_menu_inline_feedback": "âœï¸ Feedback",
    "main_menu_inline_admin_panel": "ğŸ›  Admin Panel",

    "modules_list_no_modules": "ğŸ¤· No modules available",
    "modules_list_title_template": "Available Modules (Page {current_page}/{total_pages}):",
    "pagination_prev": "â¬…ï¸ Prev",
    "pagination_next": "Next â¡ï¸",
    "navigation_back_to_main": "ğŸ  Main Menu", # ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¸ Ğ´Ğ»Ñ Ğ¸Ğ½Ğ»Ğ°Ğ¹Ğ½, Ğ¸ Ğ´Ğ»Ñ reply (ĞºĞ°Ğº /start)
    "service_delete_message": "âŒ Close this menu",
    "confirm_yes": "âœ… Yes",
    "confirm_no": "âŒ No",
    "welcome_message_title": "ğŸ‰ Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² SwiftDevBot!",
    "welcome_message_body": (
        "Ğ¯ â€” Ğ²Ğ°Ñˆ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ñ‹Ğ¹ Telegram-Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº, ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ´Ğ»Ñ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡.\n\n"
        "ğŸ” **Ğ§Ñ‚Ğ¾ Ñ Ğ¼Ğ¾Ğ³Ñƒ?**\n"
        "ĞœĞ¾Ğ¸ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ·Ğ°Ğ²Ğ¸ÑÑÑ‚ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹. Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸, ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹, Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¸ Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ğµ Ğ´Ñ€ÑƒĞ³Ğ¾Ğµ.\n\n"
        "ğŸ”’ **ĞšĞ¾Ğ½Ñ„Ğ¸Ğ´ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ:**\n"
        "Ğ¯ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¾ĞµĞ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹. "
        "ĞœÑ‹ Ñ†ĞµĞ½Ğ¸Ğ¼ Ğ²Ğ°ÑˆÑƒ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ. Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ‹ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒÑÑ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ Ğ±Ğ¾Ñ‚Ğ°.\n\n"
        "ĞĞ°Ğ¶Ğ¸Ğ¼Ğ°Ñ Â«ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒÂ», Ğ²Ñ‹ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞ°ĞµÑ‚ĞµÑÑŒ Ñ Ñ‚ĞµĞ¼, Ñ‡Ñ‚Ğ¾ Ğ±Ğ¾Ñ‚ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ°ÑˆĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ²Ğ¾Ğ¸Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹."
    ),
    "welcome_button_continue": "âœ… ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ",
    "welcome_button_cancel": "âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°",
    "registration_cancelled_message": "ĞÑ‡ĞµĞ½ÑŒ Ğ¶Ğ°Ğ»ÑŒ, Ñ‡Ñ‚Ğ¾ Ğ²Ñ‹ Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ»Ğ¸. Ğ•ÑĞ»Ğ¸ Ğ½Ğ°Ğ´ÑƒĞ¼Ğ°ĞµÑ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ /start.",
    "user_middleware_please_register": (
        "ğŸ‘‹ ĞŸĞ¾Ñ…Ğ¾Ğ¶Ğµ, Ğ²Ñ‹ ĞµÑ‰Ğµ Ğ½Ğµ Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ñ‹ ÑĞ¾ Ğ¼Ğ½Ğ¾Ğ¹! "
        "Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ /start Ğ¸Ğ»Ğ¸ Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /start."
    ),
    "profile_title": "ğŸ‘¤ Ğ’Ğ°Ñˆ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ",
    "profile_info_template": (
        "ğŸ†” Ğ’Ğ°Ñˆ Telegram ID: {user_id}\n"
        "ğŸ“ Ğ˜Ğ¼Ñ: {full_name}\n"
        "ğŸ‘¤ Username: @{username}\n"
        "ğŸ“… Ğ”Ğ°Ñ‚Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸: {registration_date}\n"
        "ğŸ—£ Ğ¯Ğ·Ñ‹Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°: {current_language}"
    ),
    "profile_no_username": "Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½",
    "profile_no_reg_date": "Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾",
    "profile_button_change_language": "ğŸŒ Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº", # Ğ­Ñ‚Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸Ğ½Ğ»Ğ°Ğ¹Ğ½ ĞºĞ½Ğ¾Ğ¿ĞºĞ° Ğ² Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğµ
    "profile_select_language_title": "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ·Ñ‹Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°:",
}

# --- ĞĞĞ’ĞĞ¯ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ¯ Ğ”Ğ›Ğ¯ REPLY KEYBOARD Ğ“Ğ›ĞĞ’ĞĞĞ“Ğ ĞœĞ•ĞĞ® ---
async def get_main_menu_reply_keyboard( 
    services_provider: 'BotServicesProvider', 
    user_telegram_id: int,
    locale: Optional[str] = None
) -> ReplyKeyboardMarkup:
    builder = ReplyKeyboardBuilder() # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ReplyKeyboardBuilder
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    if not locale:
        # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº Ğ¸Ğ· Ğ‘Ğ”
        try:
            async with services_provider.db.get_session() as session:
                from Systems.core.database.core_models import User as DBUser
                from sqlalchemy import select
                result = await session.execute(select(DBUser).where(DBUser.telegram_id == user_telegram_id))
                db_user = result.scalar_one_or_none()
                if db_user and db_user.preferred_language_code:
                    locale = db_user.preferred_language_code
        except Exception:
            pass
        
        # Ğ•ÑĞ»Ğ¸ ÑĞ·Ñ‹Ğº Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ñ‹Ğ¹
        if not locale:
            locale = services_provider.config.core.i18n.default_locale
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ Ñ‡ĞµÑ€ĞµĞ· translator
    translator = _get_translator(services_provider)
    
    # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ TEXTS_CORE_KEYBOARDS_EN
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, locale, **kwargs)
    
    texts = {
        "main_menu_reply_modules": t("main_menu_reply_modules"),
        "main_menu_reply_profile": t("main_menu_reply_profile"),
        "main_menu_reply_feedback": t("main_menu_reply_feedback"),
        "main_menu_reply_admin_panel": t("main_menu_reply_admin_panel"),
    } 
    
    # ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ - Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€ÑĞ´
    builder.button(text=texts["main_menu_reply_modules"])
    builder.button(text=texts["main_menu_reply_profile"])
    
    show_admin_button = False
    is_super_admin = user_telegram_id in services_provider.config.core.super_admins
    
    if is_super_admin:
        show_admin_button = True
    else:
        try:
            async with services_provider.db.get_session() as session: 
                if await services_provider.rbac.user_has_permission(session, user_telegram_id, PERMISSION_CORE_VIEW_ADMIN_PANEL):
                    show_admin_button = True
        except Exception as e: 
            logger.error(f"[MainMenuReplyKeyboard] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ '{PERMISSION_CORE_VIEW_ADMIN_PANEL}' Ğ´Ğ»Ñ {user_telegram_id}: {e}")
    
    # Ğ›Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸:
    # Ğ ÑĞ´ 1: ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ (ĞœĞ¾Ğ´ÑƒĞ»Ğ¸, ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ) 
    # Ğ ÑĞ´ 2: ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ (ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ) Ğ¸Ğ»Ğ¸ ÑĞ»ÑƒĞ¶ĞµĞ±Ğ½Ñ‹Ğµ (ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ)
    if show_admin_button:
        # Ğ”Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ²: ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¼ Ñ€ÑĞ´Ñƒ ĞºĞ°Ğº Ğ²Ğ°Ğ¶Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ
        builder.button(text=texts["main_menu_reply_admin_panel"])
        
        # ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ Ğ´Ğ»Ñ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ² Ğ¼ĞµĞ½ĞµĞµ Ğ²Ğ°Ğ¶Ğ½Ğ° (Ğ¾Ğ½Ğ¸ ÑĞ°Ğ¼Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ÑÑ‚ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ñ‹)
        # ĞĞ¾ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ñ… Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ² Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾Ğ¹
        if not is_super_admin:
            builder.button(text=texts["main_menu_reply_feedback"])
            # Ğ Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ñ… Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ²: [ĞœĞ¾Ğ´ÑƒĞ»Ğ¸][ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ] / [ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ][ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ]
            builder.adjust(2, 2)
        else:
            # Ğ Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ²: [ĞœĞ¾Ğ´ÑƒĞ»Ğ¸][ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ] / [ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ]
            builder.adjust(2, 1)
    else:
        # Ğ”Ğ»Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹: ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¼ Ñ€ÑĞ´Ñƒ
        builder.button(text=texts["main_menu_reply_feedback"])
        # Ğ Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ: [ĞœĞ¾Ğ´ÑƒĞ»Ğ¸][ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ] / [ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ]
        builder.adjust(2, 1)
    
    return builder.as_markup(
        resize_keyboard=True, 
        input_field_placeholder="Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ¸Ğ· Ğ¼ĞµĞ½Ñ..." # ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ° Ğ² Ğ¿Ğ¾Ğ»Ğµ Ğ²Ğ²Ğ¾Ğ´Ğ°
    )# Ğ¡Ñ‚Ğ°Ñ€Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¸Ğ½Ğ»Ğ°Ğ¹Ğ½-ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ (Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ³Ğ¾Ğ´Ğ¸Ñ‚ÑŒÑÑ Ğ´Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑĞ»ÑƒÑ‡Ğ°ĞµĞ² Ğ¸Ğ»Ğ¸ ĞµÑĞ»Ğ¸ Ğ·Ğ°Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ)
async def get_main_menu_inline_keyboard( # ĞŸĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ» Ğ´Ğ»Ñ ÑÑĞ½Ğ¾ÑÑ‚Ğ¸
    services_provider: 'BotServicesProvider', 
    user_telegram_id: int
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    texts = TEXTS_CORE_KEYBOARDS_EN 
    
    builder.button(
        text=texts["main_menu_inline_modules"], # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ‚ĞµĞºÑÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ½Ğ»Ğ°Ğ¹Ğ½
        callback_data=CoreMenuNavigate(target_menu="modules_list", page=1).pack()
    )
    builder.button(
        text=texts["main_menu_inline_profile"],
        callback_data=CoreMenuNavigate(target_menu="profile").pack()
    )
    # ... (Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºĞ¸ ĞºĞ°Ğº Ğ±Ñ‹Ğ»Ğ°) ...
    show_admin_button = False
    if user_telegram_id in services_provider.config.core.super_admins:
        show_admin_button = True
    else:
        try:
            async with services_provider.db.get_session() as session: 
                if await services_provider.rbac.user_has_permission(session, user_telegram_id, PERMISSION_CORE_VIEW_ADMIN_PANEL):
                    show_admin_button = True
        except Exception as e:
            logger.debug(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_telegram_id}: {e}")
            
    if show_admin_button:
        builder.button(
            text=texts["main_menu_inline_admin_panel"],
            callback_data=CoreMenuNavigate(target_menu="admin_panel_main").pack()
        )
    builder.button(
        text=texts["main_menu_inline_feedback"],
        callback_data=CoreMenuNavigate(target_menu="feedback").pack()
    )
    builder.adjust(2) 
    return builder.as_markup()


async def get_modules_list_keyboard( # ĞÑÑ‚Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ½Ğ»Ğ°Ğ¹Ğ½
    services_provider: 'BotServicesProvider',
    user_telegram_id: int, 
    current_page: int = 1,
    items_per_page: int = 5,
    locale: Optional[str] = None
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    if not locale:
        try:
            async with services_provider.db.get_session() as session:
                from sqlalchemy import select
                result = await session.execute(select(DBUser).where(DBUser.telegram_id == user_telegram_id))
                db_user = result.scalar_one_or_none()
                if db_user and db_user.preferred_language_code:
                    locale = db_user.preferred_language_code
        except Exception:
            pass
        
        if not locale:
            locale = services_provider.config.core.i18n.default_locale
    
    translator = _get_translator(services_provider)
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, locale, **kwargs)
    
    texts = {
        "modules_list_no_modules": t("modules_list_no_modules"),
        "pagination_prev": t("pagination_prev"),
        "pagination_next": t("pagination_next"),
        "navigation_back_to_main": t("navigation_back_to_main"),
    }
    
    all_module_ui_entries: List['ModuleUIEntry'] = services_provider.ui_registry.get_all_module_entries()
    
    accessible_module_entries: List['ModuleUIEntry'] = []
    if all_module_ui_entries:
        async with services_provider.db.get_session() as session: 
            for entry in all_module_ui_entries:
                if entry.required_permission_to_view:
                    if await services_provider.rbac.user_has_permission(session, user_telegram_id, entry.required_permission_to_view):
                        accessible_module_entries.append(entry)
                else:
                    accessible_module_entries.append(entry)

    if not accessible_module_entries:
        builder.button(
            text=texts["modules_list_no_modules"],
            callback_data="core:dummy_no_modules"
        )
    else:
        # ... (Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹) ...
        total_items = len(accessible_module_entries)
        total_pages = (total_items + items_per_page - 1) // items_per_page
        current_page = max(1, min(current_page, total_pages if total_pages > 0 else 1))

        start_index = (current_page - 1) * items_per_page
        end_index = start_index + items_per_page
        paginated_entries = accessible_module_entries[start_index:end_index]

        for entry in paginated_entries:
            button_text = f"{entry.icon} {entry.display_name}" if entry.icon else entry.display_name
            builder.button(
                text=button_text,
                callback_data=entry.entry_callback_data
            )
        builder.adjust(1)

        if total_pages > 1:
            pagination_buttons_row: List[InlineKeyboardButton] = []
            if current_page > 1:
                pagination_buttons_row.append(InlineKeyboardButton(text=texts["pagination_prev"], callback_data=CoreMenuNavigate(target_menu="modules_list", page=current_page - 1).pack()))
            pagination_buttons_row.append(InlineKeyboardButton(text=f"{current_page}/{total_pages}", callback_data="core:dummy_page_indicator"))
            if current_page < total_pages:
                pagination_buttons_row.append(InlineKeyboardButton(text=texts["pagination_next"], callback_data=CoreMenuNavigate(target_menu="modules_list", page=current_page + 1).pack()))
            if pagination_buttons_row:
                 builder.row(*pagination_buttons_row)
    builder.row(
        InlineKeyboardButton(
            text=texts["navigation_back_to_main"], 
            callback_data=CoreMenuNavigate(target_menu="main_reply").pack() # <--- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ: Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğº reply-Ğ¼ĞµĞ½Ñ
        )
    )
    return builder.as_markup()


def get_welcome_confirmation_keyboard(locale: Optional[str] = None, services_provider: Optional['BotServicesProvider'] = None) -> InlineKeyboardMarkup:
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°Ğ¼Ğ¸"""
    builder = InlineKeyboardBuilder()
    
    # Ğ•ÑĞ»Ğ¸ services_provider Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ½, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if services_provider:
        if not locale:
            locale = services_provider.config.core.i18n.default_locale
        translator = _get_translator(services_provider)
        def t(key: str, **kwargs) -> str:
            return translator.gettext(key, locale, **kwargs)
        texts = {
            "welcome_button_continue": t("welcome_button_continue"),
            "welcome_button_cancel": t("welcome_button_cancel"),
        }
    else:
        # Fallback Ğ½Ğ° ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ñ‚ĞµĞºÑÑ‚Ñ‹, ĞµÑĞ»Ğ¸ services_provider Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ½
        texts = TEXTS_CORE_KEYBOARDS_EN
    
    builder.button(
        text=texts["welcome_button_continue"],
        callback_data=CoreServiceAction(action="confirm_registration").pack()
    )
    builder.button(
        text=texts["welcome_button_cancel"],
        callback_data=CoreServiceAction(action="cancel_registration").pack()
    )
    builder.adjust(2)
    return builder.as_markup()

async def get_profile_menu_keyboard( # ĞÑÑ‚Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ½Ğ»Ğ°Ğ¹Ğ½
    db_user: DBUser, 
    services_provider: 'BotServicesProvider',
    locale: Optional[str] = None
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    if not locale:
        locale = db_user.preferred_language_code or services_provider.config.core.i18n.default_locale
    
    translator = _get_translator(services_provider)
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, locale, **kwargs)
    
    texts = {
        "profile_button_change_language": t("profile_button_change_language"),
        "navigation_back_to_main": t("navigation_back_to_main"),
    }
    
    available_langs = services_provider.config.core.i18n.available_locales
    if len(available_langs) > 1:
        builder.button(
            text=texts["profile_button_change_language"],
            callback_data=CoreMenuNavigate(target_menu="profile_change_lang_list").pack()
        )
    if not builder.export():
        builder.button(text="ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ğ² Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğµ", callback_data="core_profile:dummy_no_actions")
    builder.row(
        InlineKeyboardButton(
            text=texts["navigation_back_to_main"],
            callback_data=CoreMenuNavigate(target_menu="main_reply").pack() # <--- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ: Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğº reply-Ğ¼ĞµĞ½Ñ
        )
    )
    builder.adjust(1)
    return builder.as_markup()

async def get_language_selection_keyboard( # ĞÑÑ‚Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ½Ğ»Ğ°Ğ¹Ğ½
    current_lang_code: Optional[str],
    available_locales: List[str],
    services_provider: Optional['BotServicesProvider'] = None,
    locale: Optional[str] = None
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğ¹ ÑĞ·Ñ‹ĞºĞ¾Ğ²
    if services_provider:
        if not locale:
            locale = current_lang_code or services_provider.config.core.i18n.default_locale
        translator = _get_translator(services_provider)
        
        for lang_code in available_locales:
            prefix = "âœ… " if lang_code == current_lang_code else "â–«ï¸ "
            lang_key = f"language_{lang_code}"
            display_name = translator.gettext(lang_key, locale) if lang_key in translator._translations.get(locale, {}) else lang_code.upper()
            builder.button(
                text=f"{prefix}{display_name}",
                callback_data=CoreMenuNavigate(target_menu="profile_set_lang", payload=lang_code).pack()
            )
    else:
        # Fallback Ğ±ĞµĞ· Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ²
        for lang_code in available_locales:
            prefix = "âœ… " if lang_code == current_lang_code else "â–«ï¸ "
            display_name = lang_code.upper() 
            builder.button(
                text=f"{prefix}{display_name}",
                callback_data=CoreMenuNavigate(target_menu="profile_set_lang", payload=lang_code).pack()
            )
    builder.adjust(1) 
    builder.row(
        InlineKeyboardButton(
            text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğ² Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ", 
            callback_data=CoreMenuNavigate(target_menu="profile").pack()
        )
    )
    return builder.as_markup()

# ... (get_confirm_action_keyboard, get_close_button_keyboard Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹, Ñ‚.Ğº. Ğ¾Ğ½Ğ¸ Ğ¸Ğ½Ğ»Ğ°Ğ¹Ğ½)
def get_confirm_action_keyboard(
    confirm_callback_data: str,
    cancel_callback_data: str,
    confirm_text_key: str = "confirm_yes",
    cancel_text_key: str = "confirm_no"
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    texts = TEXTS_CORE_KEYBOARDS_EN
    
    builder.button(text=texts[confirm_text_key], callback_data=confirm_callback_data)
    builder.button(text=texts[cancel_text_key], callback_data=cancel_callback_data)
    builder.adjust(2)
    return builder.as_markup()

def get_close_button_keyboard(
    close_text_key: str = "service_delete_message"
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    texts = TEXTS_CORE_KEYBOARDS_EN
    builder.button(
        text=texts[close_text_key],
        callback_data=CoreServiceAction(action="delete_this_message").pack()
    )
    return builder.as_markup()


======================================================================

------------------------------ FILE: Systems/core/ui/__init__.py ------------------------------



======================================================================

------------------------------ FILE: Systems/core/security/reputation_system.py ------------------------------
# core/security/reputation_system.py
"""
Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ¸ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²
ĞÑ†ĞµĞ½Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ½Ğ°Ğ´ĞµĞ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
"""

import json
import time
from typing import Dict, List, Optional, Tuple
from pathlib import Path
from dataclasses import dataclass
from enum import Enum
from loguru import logger
from datetime import datetime, timedelta

class ReputationLevel(Enum):
    """Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸"""
    UNTRUSTED = "untrusted"    # 0-20
    SUSPICIOUS = "suspicious"  # 21-40
    NEUTRAL = "neutral"        # 41-60
    TRUSTED = "trusted"        # 61-80
    VERIFIED = "verified"      # 81-100

class ReputationFactor(Enum):
    """Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸"""
    SIGNATURE_VALID = "signature_valid"
    CODE_QUALITY = "code_quality"
    SECURITY_SCAN = "security_scan"
    USER_FEEDBACK = "user_feedback"
    TIME_ACTIVE = "time_active"
    VIOLATIONS = "violations"
    UPDATES_FREQUENCY = "updates_frequency"

@dataclass
class ReputationScore:
    """ĞÑ†ĞµĞ½ĞºĞ° Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸"""
    module_name: str
    developer_id: str
    total_score: float
    level: ReputationLevel
    factors: Dict[ReputationFactor, float]
    last_updated: float
    confidence: float  # Ğ£Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ² Ğ¾Ñ†ĞµĞ½ĞºĞµ (0-1)

@dataclass
class DeveloperProfile:
    """ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°"""
    developer_id: str
    name: str
    email: Optional[str]
    reputation_score: float
    reputation_level: ReputationLevel
    modules_count: int
    total_downloads: int
    verified: bool
    join_date: float
    last_activity: float

class ModuleReputationSystem:
    """Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    
    def __init__(self, config):
        self.config = config
        self.reputation_dir = config.core.project_data_path / "Security" / "reputation"
        self.reputation_dir.mkdir(parents=True, exist_ok=True)
        
        # Ğ’ĞµÑĞ° Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¾Ğ² Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸
        self.factor_weights = {
            ReputationFactor.SIGNATURE_VALID: 0.25,
            ReputationFactor.CODE_QUALITY: 0.20,
            ReputationFactor.SECURITY_SCAN: 0.20,
            ReputationFactor.USER_FEEDBACK: 0.15,
            ReputationFactor.TIME_ACTIVE: 0.10,
            ReputationFactor.VIOLATIONS: -0.20,  # ĞÑ‚Ñ€Ğ¸Ñ†Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµÑ
            ReputationFactor.UPDATES_FREQUENCY: 0.10
        }
        
        # ĞšÑÑˆ Ğ¾Ñ†ĞµĞ½Ğ¾Ğº Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸
        self.reputation_cache: Dict[str, ReputationScore] = {}
        
        # ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²
        self.developer_profiles: Dict[str, DeveloperProfile] = {}
        
        # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
        self._load_reputation_data()
        
        logger.info(f"[Security] ModuleReputationSystem Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½. Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ {len(self.reputation_cache)} Ğ¾Ñ†ĞµĞ½Ğ¾Ğº Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸")
    
    def _load_reputation_data(self):
        """Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²"""
        try:
            # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¾Ñ†ĞµĞ½ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
            modules_file = self.reputation_dir / "module_reputations.json"
            if modules_file.exists():
                with open(modules_file, 'r', encoding='utf-8') as f:
                    data = json.load(f)
                    for module_name, score_data in data.items():
                        self.reputation_cache[module_name] = ReputationScore(**score_data)
            
            # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²
            developers_file = self.reputation_dir / "developer_profiles.json"
            if developers_file.exists():
                with open(developers_file, 'r', encoding='utf-8') as f:
                    data = json.load(f)
                    for dev_id, profile_data in data.items():
                        self.developer_profiles[dev_id] = DeveloperProfile(**profile_data)
        
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸: {e}")
    
    def _save_reputation_data(self):
        """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ² Ñ„Ğ°Ğ¹Ğ»Ñ‹"""
        try:
            # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¾Ñ†ĞµĞ½ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
            modules_file = self.reputation_dir / "module_reputations.json"
            modules_data = {}
            for module_name, score in self.reputation_cache.items():
                modules_data[module_name] = {
                    "module_name": score.module_name,
                    "developer_id": score.developer_id,
                    "total_score": score.total_score,
                    "level": score.level.value,
                    "factors": {factor.value: value for factor, value in score.factors.items()},
                    "last_updated": score.last_updated,
                    "confidence": score.confidence
                }
            
            with open(modules_file, 'w', encoding='utf-8') as f:
                json.dump(modules_data, f, indent=2, ensure_ascii=False)
            
            # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²
            developers_file = self.reputation_dir / "developer_profiles.json"
            developers_data = {}
            for dev_id, profile in self.developer_profiles.items():
                developers_data[dev_id] = {
                    "developer_id": profile.developer_id,
                    "name": profile.name,
                    "email": profile.email,
                    "reputation_score": profile.reputation_score,
                    "reputation_level": profile.reputation_level.value,
                    "modules_count": profile.modules_count,
                    "total_downloads": profile.total_downloads,
                    "verified": profile.verified,
                    "join_date": profile.join_date,
                    "last_activity": profile.last_activity
                }
            
            with open(developers_file, 'w', encoding='utf-8') as f:
                json.dump(developers_data, f, indent=2, ensure_ascii=False)
        
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸: {e}")
    
    def calculate_reputation_score(self, module_name: str, developer_id: str, 
                                 signature_valid: bool = False,
                                 code_quality_score: float = 0.5,
                                 security_scan_score: float = 0.5,
                                 user_feedback_score: float = 0.5,
                                 time_active_days: int = 0,
                                 violations_count: int = 0,
                                 updates_count: int = 0) -> ReputationScore:
        """Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Ğ¾Ñ†ĞµĞ½ĞºÑƒ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        
        factors = {}
        
        # ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        factors[ReputationFactor.SIGNATURE_VALID] = 1.0 if signature_valid else 0.0
        
        # ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ĞºĞ¾Ğ´Ğ°
        factors[ReputationFactor.CODE_QUALITY] = max(0.0, min(1.0, code_quality_score))
        
        # Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
        factors[ReputationFactor.SECURITY_SCAN] = max(0.0, min(1.0, security_scan_score))
        
        # ĞÑ‚Ğ·Ñ‹Ğ²Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
        factors[ReputationFactor.USER_FEEDBACK] = max(0.0, min(1.0, user_feedback_score))
        
        # Ğ’Ñ€ĞµĞ¼Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ (Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ)
        factors[ReputationFactor.TIME_ACTIVE] = min(1.0, time_active_days / 365.0)  # ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ·Ğ° Ğ³Ğ¾Ğ´
        
        # ĞĞ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ (Ğ¾Ñ‚Ñ€Ğ¸Ñ†Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€)
        factors[ReputationFactor.VIOLATIONS] = max(0.0, 1.0 - (violations_count * 0.1))
        
        # Ğ§Ğ°ÑÑ‚Ğ¾Ñ‚Ğ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹
        factors[ReputationFactor.UPDATES_FREQUENCY] = min(1.0, updates_count / 12.0)  # ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 12 Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ² Ğ³Ğ¾Ğ´
        
        # Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ»
        total_score = 0.0
        total_weight = 0.0
        
        for factor, weight in self.factor_weights.items():
            if factor in factors:
                total_score += factors[factor] * abs(weight)
                total_weight += abs(weight)
        
        if total_weight > 0:
            total_score = (total_score / total_weight) * 100  # ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·ÑƒĞµĞ¼ Ğ´Ğ¾ 0-100
        
        # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸
        if total_score >= 81:
            level = ReputationLevel.VERIFIED
        elif total_score >= 61:
            level = ReputationLevel.TRUSTED
        elif total_score >= 41:
            level = ReputationLevel.NEUTRAL
        elif total_score >= 21:
            level = ReputationLevel.SUSPICIOUS
        else:
            level = ReputationLevel.UNTRUSTED
        
        # Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ² Ğ¾Ñ†ĞµĞ½ĞºĞµ
        confidence = min(1.0, (time_active_days / 30.0) + 0.1)  # Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ = Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸
        
        score = ReputationScore(
            module_name=module_name,
            developer_id=developer_id,
            total_score=total_score,
            level=level,
            factors=factors,
            last_updated=time.time(),
            confidence=confidence
        )
        
        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² ĞºÑÑˆ
        self.reputation_cache[module_name] = score
        
        logger.debug(f"[Security] Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ° Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {total_score:.1f} ({level.value})")
        return score
    
    def get_module_reputation(self, module_name: str) -> Optional[ReputationScore]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        return self.reputation_cache.get(module_name)
    
    def update_module_reputation(self, module_name: str, **kwargs) -> ReputationScore:
        """ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        current_score = self.reputation_cache.get(module_name)
        
        if current_score:
            # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ÑƒÑ Ğ¾Ñ†ĞµĞ½ĞºÑƒ
            developer_id = current_score.developer_id
        else:
            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¾Ñ†ĞµĞ½ĞºÑƒ
            developer_id = kwargs.get("developer_id", "unknown")
        
        new_score = self.calculate_reputation_score(module_name, developer_id, **kwargs)
        
        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
        self._save_reputation_data()
        
        return new_score
    
    def register_developer(self, developer_id: str, name: str, email: Optional[str] = None) -> DeveloperProfile:
        """Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°"""
        profile = DeveloperProfile(
            developer_id=developer_id,
            name=name,
            email=email,
            reputation_score=50.0,  # ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ñ
            reputation_level=ReputationLevel.NEUTRAL,
            modules_count=0,
            total_downloads=0,
            verified=False,
            join_date=time.time(),
            last_activity=time.time()
        )
        
        self.developer_profiles[developer_id] = profile
        self._save_reputation_data()
        
        logger.info(f"[Security] Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº: {developer_id}")
        return profile
    
    def get_developer_profile(self, developer_id: str) -> Optional[DeveloperProfile]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°"""
        return self.developer_profiles.get(developer_id)
    
    def update_developer_activity(self, developer_id: str):
        """ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°"""
        if developer_id in self.developer_profiles:
            self.developer_profiles[developer_id].last_activity = time.time()
            self._save_reputation_data()
    
    def get_reputation_statistics(self) -> Dict[str, any]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸"""
        stats = {
            "total_modules": len(self.reputation_cache),
            "total_developers": len(self.developer_profiles),
            "reputation_distribution": {},
            "average_reputation": 0.0,
            "verified_modules": 0,
            "untrusted_modules": 0
        }
        
        if self.reputation_cache:
            total_score = 0.0
            
            for score in self.reputation_cache.values():
                level = score.level.value
                stats["reputation_distribution"][level] = stats["reputation_distribution"].get(level, 0) + 1
                
                total_score += score.total_score
                
                if score.level == ReputationLevel.VERIFIED:
                    stats["verified_modules"] += 1
                elif score.level == ReputationLevel.UNTRUSTED:
                    stats["untrusted_modules"] += 1
            
            stats["average_reputation"] = total_score / len(self.reputation_cache)
        
        return stats
    
    def get_top_modules(self, limit: int = 10) -> List[Tuple[str, ReputationScore]]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ¿ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ¿Ğ¾ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸"""
        sorted_modules = sorted(
            self.reputation_cache.items(),
            key=lambda x: x[1].total_score,
            reverse=True
        )
        
        return sorted_modules[:limit]
    
    def get_suspicious_modules(self) -> List[Tuple[str, ReputationScore]]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸"""
        suspicious = []
        
        for module_name, score in self.reputation_cache.items():
            if score.level in [ReputationLevel.SUSPICIOUS, ReputationLevel.UNTRUSTED]:
                suspicious.append((module_name, score))
        
        return sorted(suspicious, key=lambda x: x[1].total_score)



======================================================================

------------------------------ FILE: Systems/core/security/rate_limiter.py ------------------------------
# core/security/rate_limiter.py
"""
Rate Limiting Middleware Ğ´Ğ»Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ¾Ñ‚ Ñ„Ğ»ÑƒĞ´Ğ° Ğ¸ DDoS Ğ°Ñ‚Ğ°Ğº
"""

import time
from collections import defaultdict
from typing import Dict, Optional, Tuple
from datetime import datetime, timedelta
from loguru import logger

from aiogram import BaseMiddleware
from aiogram.types import TelegramObject, Update, Message, CallbackQuery
from aiogram.exceptions import TelegramRetryAfter

from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider


class RateLimiter:
    """
    ĞšĞ»Ğ°ÑÑ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ rate limiting Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ sliding window Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ°
    """
    
    def __init__(self, default_limit: int = 10, default_window: int = 60):
        """
        Args:
            default_limit: ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
            default_window: ĞĞºĞ½Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…
        """
        self.default_limit = default_limit
        self.default_window = default_window
        # Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°: {user_id: [(timestamp, action_type), ...]}
        self._requests: Dict[int, list] = defaultdict(list)
        # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹
        self._limits: Dict[str, Tuple[int, int]] = {
            "message": (self.default_limit, self.default_window),
            "callback": (20, 60),
            "command": (5, 60),
            "inline_query": (30, 60),
        }
        self._logger = logger.bind(service="RateLimiter")
    
    def set_limit(self, action_type: str, limit: int, window: int):
        """Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ° Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ"""
        self._limits[action_type] = (limit, window)
        self._logger.info(f"Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ´Ğ»Ñ {action_type}: {limit} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ·Ğ° {window} ÑĞµĞºÑƒĞ½Ğ´")
    
    def check_rate_limit(
        self, 
        user_id: int, 
        action_type: str = "message",
        custom_limit: Optional[int] = None,
        custom_window: Optional[int] = None
    ) -> Tuple[bool, int]:
        """
        ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ rate limit Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        
        Returns:
            Tuple[bool, int]: (is_allowed, retry_after)
                - is_allowed: Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½ Ğ»Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
                - retry_after: Ñ‡ĞµÑ€ĞµĞ· ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑĞµĞºÑƒĞ½Ğ´ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ (ĞµÑĞ»Ğ¸ Ğ½Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½)
        """
        current_time = time.time()
        limit, window = self._limits.get(action_type, (self.default_limit, self.default_window))
        
        if custom_limit is not None:
            limit = custom_limit
        if custom_window is not None:
            window = custom_window
        
        # ĞÑ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ (ÑÑ‚Ğ°Ñ€ÑˆĞµ Ğ¾ĞºĞ½Ğ°)
        user_requests = self._requests[user_id]
        cutoff_time = current_time - window
        self._requests[user_id] = [
            req_time for req_time in user_requests 
            if req_time[0] > cutoff_time
        ]
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
        request_count = len(self._requests[user_id])
        
        if request_count >= limit:
            # Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ´Ğ¾ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
            oldest_request_time = min(req[0] for req in self._requests[user_id]) if self._requests[user_id] else current_time
            retry_after = int(window - (current_time - oldest_request_time)) + 1
            return False, retry_after
        
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
        self._requests[user_id].append((current_time, action_type))
        return True, 0
    
    def reset_user(self, user_id: int):
        """Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸Ğº Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"""
        if user_id in self._requests:
            del self._requests[user_id]
            self._logger.debug(f"Ğ¡Ñ‡ĞµÑ‚Ñ‡Ğ¸Ğº rate limit ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id}")
    
    def get_user_stats(self, user_id: int) -> Dict[str, int]:
        """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"""
        current_time = time.time()
        user_requests = self._requests.get(user_id, [])
        
        stats = {}
        for action_type, (limit, window) in self._limits.items():
            cutoff_time = current_time - window
            action_requests = [
                req_time for req_time in user_requests 
                if req_time[0] > cutoff_time and req_time[1] == action_type
            ]
            stats[action_type] = {
                "count": len(action_requests),
                "limit": limit,
                "remaining": max(0, limit - len(action_requests))
            }
        
        return stats


class RateLimitMiddleware(BaseMiddleware):
    """
    Middleware Ğ´Ğ»Ñ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
    """
    
    def __init__(self, rate_limiter: Optional[RateLimiter] = None):
        super().__init__()
        self.rate_limiter = rate_limiter or RateLimiter()
        self._logger = logger.bind(service="RateLimitMiddleware")
        # Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ - Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°Ñ‚ÑŒÑÑ
        self._exempt_users: set = set()
    
    def exempt_user(self, user_id: int):
        """Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ"""
        self._exempt_users.add(user_id)
        self._logger.debug(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ rate limit")
    
    def remove_exemption(self, user_id: int):
        """Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¹"""
        self._exempt_users.discard(user_id)
    
    def _get_action_type(self, event: Update) -> str:
        """ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ñ‚Ğ¸Ğ¿ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ¸Ğ· ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ"""
        if event.message:
            if event.message.text and event.message.text.startswith("/"):
                return "command"
            return "message"
        elif event.callback_query:
            return "callback"
        elif event.inline_query:
            return "inline_query"
        return "message"
    
    async def __call__(
        self,
        handler,
        event: Update,
        data: Dict
    ):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¾Ğ¹ rate limit"""
        
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
        user = data.get("event_from_user")
        if not user:
            # Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ
            return await handler(event, data)
        
        user_id = user.id
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ (ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ñ‹ Ğ¸ Ñ‚.Ğ´.)
        services_provider = data.get("services_provider")
        if services_provider:
            if user_id in services_provider.config.core.super_admins:
                return await handler(event, data)
        
        if user_id in self._exempt_users:
            return await handler(event, data)
        
        # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ‚Ğ¸Ğ¿ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ
        action_type = self._get_action_type(event)
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ rate limit
        is_allowed, retry_after = self.rate_limiter.check_rate_limit(
            user_id=user_id,
            action_type=action_type
        )
        
        if not is_allowed:
            self._logger.warning(
                f"Rate limit Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id} "
                f"(Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: {action_type}, Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· {retry_after} ÑĞµĞº)"
            )
            
            # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
            error_message = (
                f"â³ Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ². "
                f"ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ {retry_after} ÑĞµĞºÑƒĞ½Ğ´ Ğ¿ĞµÑ€ĞµĞ´ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼."
            )
            
            try:
                if event.message:
                    await event.message.answer(error_message)
                elif event.callback_query:
                    await event.callback_query.answer(
                        f"ĞŸĞ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ {retry_after} ÑĞµĞº",
                        show_alert=True
                    )
            except Exception as e:
                self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¾ rate limit: {e}")
            
            return None  # ĞŸÑ€ĞµÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ
        
        # Ğ•ÑĞ»Ğ¸ Ğ²ÑĞµ Ğ² Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞµ, Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµĞ¼ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ
        return await handler(event, data)




======================================================================

------------------------------ FILE: Systems/core/security/input_validator.py ------------------------------
# core/security/input_validator.py
"""
Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ middleware
"""

import re
from typing import Optional, Dict, Any, List, Callable, Tuple
from loguru import logger

from aiogram import BaseMiddleware
from aiogram.types import TelegramObject, Update, Message
from aiogram.filters import Command

from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider


class InputValidator:
    """
    ĞšĞ»Ğ°ÑÑ Ğ´Ğ»Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    """
    
    # ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°
    DANGEROUS_PATTERNS = [
        (r'<script[^>]*>.*?</script>', 'XSS ÑĞºÑ€Ğ¸Ğ¿Ñ‚'),
        (r'javascript:', 'JavaScript Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»'),
        (r'on\w+\s*=', 'HTML ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ'),
        (r'data:text/html', 'HTML data URI'),
        (r'eval\s*\(', 'eval Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ'),
        (r'exec\s*\(', 'exec Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ'),
        (r'__import__', 'Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚'),
    ]
    
    # ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ»Ğ¸Ğ½Ñ‹
    MAX_MESSAGE_LENGTH = 4096  # Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Telegram
    MAX_COMMAND_LENGTH = 100
    MAX_CALLBACK_DATA_LENGTH = 64
    
    def __init__(self):
        self._logger = logger.bind(service="InputValidator")
        self._compiled_patterns = [
            (re.compile(pattern, re.IGNORECASE | re.DOTALL), description)
            for pattern, description in self.DANGEROUS_PATTERNS
        ]
    
    def validate_message(self, text: Optional[str]) -> Tuple[bool, Optional[str]]:
        """
        Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚ĞµĞºÑÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
        
        Returns:
            Tuple[bool, Optional[str]]: (is_valid, error_message)
        """
        if not text:
            return True, None
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ»Ğ¸Ğ½Ñ‹
        if len(text) > self.MAX_MESSAGE_LENGTH:
            return False, f"Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğµ (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ {self.MAX_MESSAGE_LENGTH} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)"
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹
        for pattern, description in self._compiled_patterns:
            if pattern.search(text):
                self._logger.warning(f"ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½ Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ² ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸: {description}")
                return False, f"ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚: {description}"
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹ (ÑĞ¿Ğ°Ğ¼)
        mention_count = text.count('@')
        if mention_count > 10:
            return False, "Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹ Ğ² ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸"
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑÑ‰Ğ¸ĞµÑÑ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ (Ñ„Ğ»ÑƒĞ´)
        if self._check_flood_pattern(text):
            return False, "ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ñ„Ğ»ÑƒĞ´Ğ° Ğ² ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸"
        
        return True, None
    
    def validate_command(self, command: str) -> Tuple[bool, Optional[str]]:
        """Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ"""
        if not command:
            return False, "ĞŸÑƒÑÑ‚Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°"
        
        if len(command) > self.MAX_COMMAND_LENGTH:
            return False, f"ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ°Ñ (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ {self.MAX_COMMAND_LENGTH} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)"
        
        # ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ‚ÑŒÑÑ Ñ /
        if not command.startswith('/'):
            return False, "ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ‚ÑŒÑÑ Ñ /"
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹
        if not re.match(r'^/[a-zA-Z0-9_]+(\s+.*)?$', command):
            return False, "ĞĞµĞ´Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ"
        
        return True, None
    
    def validate_callback_data(self, callback_data: str) -> Tuple[bool, Optional[str]]:
        """Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ callback data"""
        if not callback_data:
            return False, "ĞŸÑƒÑÑ‚Ñ‹Ğµ callback Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ"
        
        if len(callback_data) > self.MAX_CALLBACK_DATA_LENGTH:
            return False, f"Callback data ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğµ (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ {self.MAX_CALLBACK_DATA_LENGTH} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)"
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹
        if re.search(r'[<>"\']', callback_data):
            return False, "ĞĞµĞ´Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ğ² callback data"
        
        return True, None
    
    def _check_flood_pattern(self, text: str, threshold: int = 5) -> bool:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ½Ğ° Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ñ„Ğ»ÑƒĞ´Ğ° (Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑÑ‰Ğ¸ĞµÑÑ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹)"""
        if len(text) < threshold * 2:
            return False
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑÑ‰Ğ¸ĞµÑÑ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹
        for i in range(len(text) - threshold):
            char = text[i]
            if text[i:i+threshold] == char * threshold:
                return True
        
        return False
    
    def sanitize_text(self, text: str) -> str:
        """ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑÑ‚ Ğ¾Ñ‚ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ñ… ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²"""
        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ HTML Ñ‚ĞµĞ³Ğ¸
        text = re.sub(r'<[^>]+>', '', text)
        # Ğ­ĞºÑ€Ğ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹
        text = text.replace('<', '&lt;').replace('>', '&gt;')
        return text


class InputValidationMiddleware(BaseMiddleware):
    """
    Middleware Ğ´Ğ»Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    """
    
    def __init__(self, validator: Optional[InputValidator] = None):
        super().__init__()
        self.validator = validator or InputValidator()
        self._logger = logger.bind(service="InputValidationMiddleware")
        # ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ
        self._exempt_users: set = set()
    
    def exempt_user(self, user_id: int):
        """Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ"""
        self._exempt_users.add(user_id)
    
    async def __call__(
        self,
        handler,
        event: Update,
        data: Dict
    ):
        """Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
        
        user = data.get("event_from_user")
        if user and user.id in self._exempt_users:
            return await handler(event, data)
        
        # Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
        if event.message and event.message.text:
            is_valid, error_msg = self.validator.validate_message(event.message.text)
            if not is_valid:
                self._logger.warning(
                    f"Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.id if user else 'unknown'}: {error_msg}"
                )
                try:
                    await event.message.answer(
                        f"âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸: {error_msg}\n"
                        f"ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ²Ğ°ÑˆĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°."
                    )
                except Exception as e:
                    self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸: {e}")
                return None
        
        # Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
        if event.message and event.message.text and event.message.text.startswith('/'):
            is_valid, error_msg = self.validator.validate_command(event.message.text)
            if not is_valid:
                self._logger.warning(f"ĞĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ¾Ñ‚ {user.id if user else 'unknown'}: {error_msg}")
                try:
                    await event.message.answer(f"âŒ ĞĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°: {error_msg}")
                except Exception:
                    pass
                return None
        
        # Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ callback query
        if event.callback_query and event.callback_query.data:
            is_valid, error_msg = self.validator.validate_callback_data(event.callback_query.data)
            if not is_valid:
                self._logger.warning(f"ĞĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğµ callback data Ğ¾Ñ‚ {user.id if user else 'unknown'}: {error_msg}")
                try:
                    await event.callback_query.answer("âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…", show_alert=True)
                except Exception:
                    pass
                return None
        
        return await handler(event, data)




======================================================================

------------------------------ FILE: Systems/core/security/crypto_manager.py ------------------------------
# core/security/crypto_manager.py
"""
ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ†Ğ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞµĞ¹
Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ÑƒÑ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ Ğ´Ğ»Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»ĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞµĞ¹
"""

import os
import json
import hashlib
import secrets
import time
import zipfile
import yaml
from typing import Any, Dict, List, Optional, Tuple
from pathlib import Path
from dataclasses import dataclass
from cryptography.hazmat.primitives import hashes, serialization
from cryptography.hazmat.primitives.asymmetric import rsa, padding
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
from cryptography.hazmat.backends import default_backend
from loguru import logger

@dataclass
class KeyPair:
    """ĞŸĞ°Ñ€Ğ° ĞºĞ»ÑÑ‡ĞµĞ¹ (Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ğ¸ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹)"""
    private_key: rsa.RSAPrivateKey
    public_key: rsa.RSAPublicKey
    key_id: str
    created_at: float
    expires_at: Optional[float] = None

@dataclass
class DigitalSignature:
    """Ğ¦Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
    module_name: str
    version: str
    file_hash: str
    signature: bytes
    signer_key_id: str
    timestamp: float
    algorithm: str = "RSA-SHA256"

class CryptoManager:
    """ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ†Ğ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞµĞ¹"""

    _AES_SALT_SIZE = 16
    _AES_NONCE_SIZE = 12
    _AES_TAG_SIZE = 16
    _PBKDF2_ITERATIONS = 100_000
    _LEGACY_SALT_SIZE = 16
    
    def __init__(self, config):
        self.config = config
        self.keys_dir = config.core.project_data_path / "Security" / "crypto_keys"
        self.keys_dir.mkdir(parents=True, exist_ok=True)
        
        # ĞœĞ°ÑÑ‚ĞµÑ€-Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ñ… ĞºĞ»ÑÑ‡ĞµĞ¹
        self.master_password = self._get_or_create_master_password()
        
        # ĞšÑÑˆ ĞºĞ»ÑÑ‡ĞµĞ¹
        self.key_cache: Dict[str, KeyPair] = {}
        
        logger.info(f"[Security] CryptoManager Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½. Ğ”Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ ĞºĞ»ÑÑ‡ĞµĞ¹: {self.keys_dir}")
    
    def _get_or_create_master_password(self) -> bytes:
        """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ¼Ğ°ÑÑ‚ĞµÑ€-Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ"""
        password_file = self.keys_dir / ".master_password"
        
        if password_file.exists():
            try:
                with open(password_file, 'rb') as f:
                    return f.read()
            except Exception as e:
                logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ğ¼Ğ°ÑÑ‚ĞµÑ€-Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ: {e}")
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼Ğ°ÑÑ‚ĞµÑ€-Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
        master_password = secrets.token_bytes(32)
        
        try:
            with open(password_file, 'wb') as f:
                f.write(master_password)
            # Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°
            os.chmod(password_file, 0o600)
            logger.info("[Security] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼Ğ°ÑÑ‚ĞµÑ€-Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ")
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¼Ğ°ÑÑ‚ĞµÑ€-Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ: {e}")
            # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
            master_password = b"temporary_password_change_me"
        
        return master_password

    def _derive_encryption_key(self, salt: bytes) -> bytes:
        """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ»ÑÑ‡ AES Ğ¸Ğ· Ğ¼Ğ°ÑÑ‚ĞµÑ€-Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ Ğ¸ ÑĞ¾Ğ»Ğ¸"""
        kdf = PBKDF2HMAC(
            algorithm=hashes.SHA256(),
            length=32,
            salt=salt,
            iterations=self._PBKDF2_ITERATIONS,
            backend=default_backend()
        )
        return kdf.derive(self.master_password)
    
    def generate_key_pair(self, key_id: str, key_size: int = 2048) -> KeyPair:
        """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¿Ğ°Ñ€Ñƒ ĞºĞ»ÑÑ‡ĞµĞ¹"""
        try:
            # Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
            private_key = rsa.generate_private_key(
                public_exponent=65537,
                key_size=key_size,
                backend=default_backend()
            )
            
            # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
            public_key = private_key.public_key()
            
            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ¿Ğ°Ñ€Ñ‹ ĞºĞ»ÑÑ‡ĞµĞ¹
            key_pair = KeyPair(
                private_key=private_key,
                public_key=public_key,
                key_id=key_id,
                created_at=time.time()
            )
            
            # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ĞºĞ»ÑÑ‡Ğ¸
            self._save_key_pair(key_pair)
            
            # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² ĞºÑÑˆ
            self.key_cache[key_id] = key_pair
            
            logger.info(f"[Security] Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ½Ğ¾Ğ²Ğ°Ñ Ğ¿Ğ°Ñ€Ğ° ĞºĞ»ÑÑ‡ĞµĞ¹: {key_id}")
            return key_pair
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ°Ñ€Ñ‹ ĞºĞ»ÑÑ‡ĞµĞ¹ {key_id}: {e}")
            raise
    
    def _save_key_pair(self, key_pair: KeyPair):
        """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ¿Ğ°Ñ€Ñƒ ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ² Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ"""
        try:
            # Ğ¨Ğ¸Ñ„Ñ€ÑƒĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
            encrypted_private_key = self._encrypt_private_key(key_pair.private_key)
            
            # Ğ¡ĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·ÑƒĞµĞ¼ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
            public_key_pem = key_pair.public_key.public_bytes(
                encoding=serialization.Encoding.PEM,
                format=serialization.PublicFormat.SubjectPublicKeyInfo
            )
            
            # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
            private_key_file = self.keys_dir / f"{key_pair.key_id}.private"
            with open(private_key_file, 'wb') as f:
                f.write(encrypted_private_key)
            os.chmod(private_key_file, 0o600)
            
            # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
            public_key_file = self.keys_dir / f"{key_pair.key_id}.public"
            with open(public_key_file, 'wb') as f:
                f.write(public_key_pem)
            os.chmod(public_key_file, 0o644)
            
            # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
            metadata = {
                "key_id": key_pair.key_id,
                "created_at": key_pair.created_at,
                "expires_at": key_pair.expires_at,
                "key_size": key_pair.public_key.key_size
            }
            
            metadata_file = self.keys_dir / f"{key_pair.key_id}.meta"
            with open(metadata_file, 'w') as f:
                json.dump(metadata, f, indent=2)
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¿Ğ°Ñ€Ñ‹ ĞºĞ»ÑÑ‡ĞµĞ¹ {key_pair.key_id}: {e}")
            raise
    
    def _encrypt_private_key(self, private_key: rsa.RSAPrivateKey) -> bytes:
        """Ğ¨Ğ¸Ñ„Ñ€ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡"""
        try:
            # Ğ¡ĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·ÑƒĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
            private_key_pem = private_key.private_bytes(
                encoding=serialization.Encoding.PEM,
                format=serialization.PrivateFormat.PKCS8,
                encryption_algorithm=serialization.NoEncryption()
            )
            
            salt = secrets.token_bytes(self._AES_SALT_SIZE)
            encryption_key = self._derive_encryption_key(salt)
            nonce = secrets.token_bytes(self._AES_NONCE_SIZE)

            cipher = Cipher(
                algorithms.AES(encryption_key),
                modes.GCM(nonce),
                backend=default_backend()
            )
            encryptor = cipher.encryptor()
            ciphertext = encryptor.update(private_key_pem) + encryptor.finalize()
            tag = encryptor.tag

            return salt + nonce + tag + ciphertext
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ°: {e}")
            raise
    
    def load_key_pair(self, key_id: str) -> Optional[KeyPair]:
        """Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ¿Ğ°Ñ€Ñƒ ĞºĞ»ÑÑ‡ĞµĞ¹"""
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºÑÑˆ
        if key_id in self.key_cache:
            return self.key_cache[key_id]
        
        try:
            # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
            metadata_file = self.keys_dir / f"{key_id}.meta"
            if not metadata_file.exists():
                return None
            
            with open(metadata_file, 'r') as f:
                metadata = json.load(f)
            
            # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
            public_key_file = self.keys_dir / f"{key_id}.public"
            if not public_key_file.exists():
                return None
            
            with open(public_key_file, 'rb') as f:
                public_key_pem = f.read()
            
            public_key = serialization.load_pem_public_key(
                public_key_pem,
                backend=default_backend()
            )
            
            # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
            private_key_file = self.keys_dir / f"{key_id}.private"
            if not private_key_file.exists():
                return None
            
            with open(private_key_file, 'rb') as f:
                encrypted_private_key = f.read()
            
            private_key = self._decrypt_private_key(encrypted_private_key)
            
            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ¿Ğ°Ñ€Ñ‹ ĞºĞ»ÑÑ‡ĞµĞ¹
            key_pair = KeyPair(
                private_key=private_key,
                public_key=public_key,
                key_id=key_id,
                created_at=metadata["created_at"],
                expires_at=metadata.get("expires_at")
            )
            
            # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² ĞºÑÑˆ
            self.key_cache[key_id] = key_pair
            
            return key_pair
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¿Ğ°Ñ€Ñ‹ ĞºĞ»ÑÑ‡ĞµĞ¹ {key_id}: {e}")
            return None
    
    def _decrypt_private_key(self, encrypted_data: bytes) -> rsa.RSAPrivateKey:
        """Ğ Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡"""
        try:
            return self._decrypt_private_key_gcm(encrypted_data)
        except Exception as e_new:
            logger.warning(f"[Security] ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ñ€Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ»ÑÑ‡ AES-GCM ({e_new}); Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚.")
            return self._decrypt_private_key_legacy(encrypted_data)

    def _decrypt_private_key_gcm(self, encrypted_data: bytes) -> rsa.RSAPrivateKey:
        """Ğ Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğ²Ğ°ĞµÑ‚ ĞºĞ»ÑÑ‡, Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ AES-GCM"""
        header_size = self._AES_SALT_SIZE + self._AES_NONCE_SIZE + self._AES_TAG_SIZE
        if len(encrypted_data) <= header_size:
            raise ValueError("ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ±Ğ°Ğ¹Ñ‚ Ğ´Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ° AES-GCM.")

        salt = encrypted_data[:self._AES_SALT_SIZE]
        nonce_start = self._AES_SALT_SIZE
        nonce_end = nonce_start + self._AES_NONCE_SIZE
        tag_end = nonce_end + self._AES_TAG_SIZE

        nonce = encrypted_data[nonce_start:nonce_end]
        tag = encrypted_data[nonce_end:tag_end]
        ciphertext = encrypted_data[tag_end:]

        encryption_key = self._derive_encryption_key(salt)
        cipher = Cipher(
            algorithms.AES(encryption_key),
            modes.GCM(nonce, tag),
            backend=default_backend()
        )
        decryptor = cipher.decryptor()
        private_key_pem = decryptor.update(ciphertext) + decryptor.finalize()

        return serialization.load_pem_private_key(
            private_key_pem,
            password=None,
            backend=default_backend()
        )

    def _decrypt_private_key_legacy(self, encrypted_data: bytes) -> rsa.RSAPrivateKey:
        """Ğ Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ ÑÑ‚Ğ°Ñ€Ğ¾Ğ³Ğ¾ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ°"""
        if len(encrypted_data) <= self._LEGACY_SALT_SIZE:
            raise ValueError("ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ±Ğ°Ğ¹Ñ‚ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ€Ğ¾Ğ³Ğ¾ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ° ĞºĞ»ÑÑ‡Ğ°.")

        private_key_pem = encrypted_data[:-self._LEGACY_SALT_SIZE]
        return serialization.load_pem_private_key(
            private_key_pem,
            password=None,
            backend=default_backend()
        )
    
    def sign_data(self, data: bytes, key_id: str) -> bytes:
        """ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ"""
        try:
            key_pair = self.load_key_pair(key_id)
            if not key_pair:
                raise ValueError(f"ĞšĞ»ÑÑ‡ {key_id} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½")
            
            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ
            signature = key_pair.private_key.sign(
                data,
                padding.PSS(
                    mgf=padding.MGF1(hashes.SHA256()),
                    salt_length=padding.PSS.MAX_LENGTH
                ),
                hashes.SHA256()
            )
            
            logger.debug(f"[Security] Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹ ĞºĞ»ÑÑ‡Ğ¾Ğ¼ {key_id}")
            return signature
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ĞºĞ»ÑÑ‡Ğ¾Ğ¼ {key_id}: {e}")
            raise
    
    def verify_signature(self, data: bytes, signature: bytes, key_id: str) -> bool:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ"""
        try:
            key_pair = self.load_key_pair(key_id)
            if not key_pair:
                logger.warning(f"[Security] ĞšĞ»ÑÑ‡ {key_id} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸")
                return False
            
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ
            key_pair.public_key.verify(
                signature,
                data,
                padding.PSS(
                    mgf=padding.MGF1(hashes.SHA256()),
                    salt_length=padding.PSS.MAX_LENGTH
                ),
                hashes.SHA256()
            )
            
            logger.debug(f"[Security] ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑŒ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ° ĞºĞ»ÑÑ‡Ğ¾Ğ¼ {key_id}")
            return True
            
        except Exception as e:
            logger.warning(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸ ĞºĞ»ÑÑ‡Ğ¾Ğ¼ {key_id}: {e}")
            return False

    def _load_manifest_data(self, module_path: Path) -> Dict[str, Any]:
        """ĞŸÑ‹Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ manifest.yaml Ğ¸Ğ· Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        manifest_candidates = []

        if module_path.is_dir():
            manifest_candidates.extend([
                module_path / "manifest.yaml",
                module_path / "manifest.yml"
            ])
        elif module_path.is_file():
            lowered_name = module_path.name.lower()
            if lowered_name in {"manifest.yaml", "manifest.yml"}:
                manifest_candidates.append(module_path)
            else:
                manifest_candidates.extend([
                    module_path.parent / "manifest.yaml",
                    module_path.parent / "manifest.yml"
                ])

        for candidate in manifest_candidates:
            if candidate.exists():
                try:
                    return self._parse_manifest_content(candidate.read_text(encoding="utf-8"))
                except Exception as e:
                    logger.warning(f"[Security] ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ {candidate}: {e}")
                    return {}

        if module_path.is_file() and module_path.suffix.lower() == ".zip":
            try:
                with zipfile.ZipFile(module_path, "r") as archive:
                    for entry in archive.namelist():
                        if Path(entry).name.lower() in {"manifest.yaml", "manifest.yml"}:
                            raw = archive.read(entry).decode("utf-8")
                            return self._parse_manifest_content(raw)
            except Exception as e:
                logger.warning(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ manifest.yaml Ğ¸Ğ· ZIP {module_path}: {e}")

        return {}

    def _parse_manifest_content(self, content: str) -> Dict[str, Any]:
        try:
            loaded = yaml.safe_load(content)
            return loaded if isinstance(loaded, dict) else {}
        except Exception as e:
            logger.warning(f"[Security] ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ñ€Ğ°ÑĞ¿Ğ°Ñ€ÑĞ¸Ñ‚ÑŒ manifest.yaml: {e}")
            return {}
    
    def sign_module(self, module_path: Path, key_id: str) -> DigitalSignature:
        """ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ"""
        try:
            # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ» Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
            with open(module_path, 'rb') as f:
                module_data = f.read()
            
            # Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ñ…ÑÑˆ Ñ„Ğ°Ğ¹Ğ»Ğ°
            file_hash = hashlib.sha256(module_data).hexdigest()
            
            manifest_info = self._load_manifest_data(module_path)
            module_name_from_manifest = manifest_info.get("name", module_path.stem)
            module_version = manifest_info.get("version")
            if not module_version:
                module_version = "0.0.0"
                logger.warning(
                    f"[Security] ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²ĞµÑ€ÑĞ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ¸Ğ· manifest.yaml ({module_name_from_manifest}); "
                    "Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ° 0.0.0"
                )
            
            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸
            signature_data = {
                "module_name": module_name_from_manifest,
                "version": module_version,
                "file_hash": file_hash,
                "timestamp": time.time(),
                "algorithm": "RSA-SHA256"
            }
            
            # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ² bytes Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸
            data_to_sign = json.dumps(signature_data, sort_keys=True).encode('utf-8')
            
            # ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
            signature = self.sign_data(data_to_sign, key_id)
            
            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸
            digital_signature = DigitalSignature(
                module_name=module_name_from_manifest,
                version=signature_data["version"],
                file_hash=file_hash,
                signature=signature,
                signer_key_id=key_id,
                timestamp=signature_data["timestamp"]
            )
            
            logger.info(f"[Security] ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {module_name_from_manifest} Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½ ĞºĞ»ÑÑ‡Ğ¾Ğ¼ {key_id}")
            return digital_signature
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_path}: {e}")
            raise
    
    def verify_module_signature(self, module_path: Path, signature: DigitalSignature) -> bool:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        try:
            # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ» Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
            with open(module_path, 'rb') as f:
                module_data = f.read()
            
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ…ÑÑˆ Ñ„Ğ°Ğ¹Ğ»Ğ°
            current_hash = hashlib.sha256(module_data).hexdigest()
            if current_hash != signature.file_hash:
                logger.warning(f"[Security] Ğ¥ÑÑˆ Ñ„Ğ°Ğ¹Ğ»Ğ° {module_path} Ğ½Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒÑ")
                return False
            
            # Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸
            signature_data = {
                "module_name": signature.module_name,
                "version": signature.version,
                "file_hash": signature.file_hash,
                "timestamp": signature.timestamp,
                "algorithm": signature.algorithm
            }
            
            data_to_verify = json.dumps(signature_data, sort_keys=True).encode('utf-8')
            
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ
            is_valid = self.verify_signature(data_to_verify, signature.signature, signature.signer_key_id)
            
            if is_valid:
                logger.info(f"[Security] ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_path.stem} Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾")
            else:
                logger.warning(f"[Security] ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_path.stem} Ğ½ĞµĞ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°")
            
            return is_valid
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_path}: {e}")
            return False
    
    def list_available_keys(self) -> List[str]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ»ÑÑ‡ĞµĞ¹"""
        try:
            key_files = list(self.keys_dir.glob("*.meta"))
            return [f.stem for f in key_files]
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ° ĞºĞ»ÑÑ‡ĞµĞ¹: {e}")
            return []
    
    def export_public_key(self, key_id: str) -> Optional[bytes]:
        """Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡"""
        try:
            key_pair = self.load_key_pair(key_id)
            if not key_pair:
                return None
            
            return key_pair.public_key.public_bytes(
                encoding=serialization.Encoding.PEM,
                format=serialization.PublicFormat.SubjectPublicKeyInfo
            )
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ° {key_id}: {e}")
            return None



======================================================================

------------------------------ FILE: Systems/core/security/sandbox_manager.py ------------------------------
# core/security/sandbox_manager.py
"""
Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° sandbox Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
ĞĞ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ¸ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
"""

import os
import sys
import tempfile
import shutil
from typing import Dict, List, Optional, Any, Callable
from pathlib import Path
from dataclasses import dataclass
from enum import Enum
from loguru import logger
import importlib.util

class SecurityLevel(Enum):
    """Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    PARANOID = "paranoid"      # ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ
    STRICT = "strict"         # Ğ¡Ñ‚Ñ€Ğ¾Ğ³Ğ¸Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ
    MODERATE = "moderate"     # Ğ£Ğ¼ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ
    PERMISSIVE = "permissive" # ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸)

@dataclass
class ModulePermissions:
    """Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
    can_access_database: bool = False
    can_access_cache: bool = False
    can_access_filesystem: bool = False
    can_make_network_requests: bool = False
    can_execute_system_commands: bool = False
    can_modify_user_data: bool = False
    can_access_admin_functions: bool = False
    max_memory_mb: int = 50
    max_execution_time_seconds: int = 30

@dataclass
class SandboxViolation:
    """ĞĞ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ sandbox"""
    module_name: str
    violation_type: str
    details: str
    timestamp: float
    severity: str  # "low", "medium", "high", "critical"

class ModuleSandboxManager:
    """ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ sandbox Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    
    def __init__(self, config):
        self.config = config
        self.sandbox_dir = config.core.project_data_path / "Security" / "sandbox"
        self.sandbox_dir.mkdir(parents=True, exist_ok=True)
        
        # Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ
        self.security_levels = {
            SecurityLevel.PARANOID: ModulePermissions(
                can_access_database=False,
                can_access_cache=False,
                can_access_filesystem=False,
                can_make_network_requests=False,
                can_execute_system_commands=False,
                can_modify_user_data=False,
                can_access_admin_functions=False,
                max_memory_mb=10,
                max_execution_time_seconds=10
            ),
            SecurityLevel.STRICT: ModulePermissions(
                can_access_database=True,
                can_access_cache=True,
                can_access_filesystem=False,
                can_make_network_requests=False,
                can_execute_system_commands=False,
                can_modify_user_data=True,
                can_access_admin_functions=False,
                max_memory_mb=25,
                max_execution_time_seconds=20
            ),
            SecurityLevel.MODERATE: ModulePermissions(
                can_access_database=True,
                can_access_cache=True,
                can_access_filesystem=True,
                can_make_network_requests=True,
                can_execute_system_commands=False,
                can_modify_user_data=True,
                can_access_admin_functions=False,
                max_memory_mb=50,
                max_execution_time_seconds=30
            ),
            SecurityLevel.PERMISSIVE: ModulePermissions(
                can_access_database=True,
                can_access_cache=True,
                can_access_filesystem=True,
                can_make_network_requests=True,
                can_execute_system_commands=True,
                can_modify_user_data=True,
                can_access_admin_functions=True,
                max_memory_mb=100,
                max_execution_time_seconds=60
            )
        }
        
        # ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ sandbox'Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
        self.active_sandboxes: Dict[str, Dict] = {}
        
        # Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğ¹
        self.violations: List[SandboxViolation] = []
        
        logger.info(f"[Security] ModuleSandboxManager Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ñ {len(self.security_levels)} ÑƒÑ€Ğ¾Ğ²Ğ½ÑĞ¼Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸")
    
    def create_sandbox(self, module_name: str, security_level: SecurityLevel) -> bool:
        """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ sandbox Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        try:
            if module_name in self.active_sandboxes:
                logger.warning(f"[Security] Sandbox Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name} ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚")
                return True
            
            permissions = self.security_levels[security_level]
            
            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
            module_sandbox_dir = self.sandbox_dir / module_name
            module_sandbox_dir.mkdir(exist_ok=True)
            
            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½ÑƒÑ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ
            self._create_virtual_filesystem(module_sandbox_dir, permissions)
            
            # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ sandbox
            sandbox_info = {
                "module_name": module_name,
                "security_level": security_level.value,
                "permissions": permissions.__dict__,
                "sandbox_dir": str(module_sandbox_dir),
                "created_at": os.time.time(),
                "violations": []
            }
            
            self.active_sandboxes[module_name] = sandbox_info
            
            logger.info(f"[Security] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ sandbox Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name} Ñ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¼ {security_level.value}")
            return True
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ sandbox Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {e}")
            return False
    
    def _create_virtual_filesystem(self, sandbox_dir: Path, permissions: ModulePermissions):
        """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½ÑƒÑ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
        if permissions.can_access_filesystem:
            # ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ
            (sandbox_dir / "files").mkdir(exist_ok=True)
            (sandbox_dir / "temp").mkdir(exist_ok=True)
        
        if permissions.can_access_database:
            # Ğ’Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ‘Ğ” (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ğ² ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ)
            (sandbox_dir / "db").mkdir(exist_ok=True)
        
        if permissions.can_access_cache:
            # Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºÑÑˆ
            (sandbox_dir / "cache").mkdir(exist_ok=True)
    
    def check_permission(self, module_name: str, permission_type: str, **kwargs) -> bool:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ"""
        try:
            if module_name not in self.active_sandboxes:
                logger.warning(f"[Security] Sandbox Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½")
                return False
            
            sandbox_info = self.active_sandboxes[module_name]
            permissions = ModulePermissions(**sandbox_info["permissions"])
            
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ
            permission_map = {
                "database": permissions.can_access_database,
                "cache": permissions.can_access_cache,
                "filesystem": permissions.can_access_filesystem,
                "network": permissions.can_make_network_requests,
                "system_commands": permissions.can_execute_system_commands,
                "user_data": permissions.can_modify_user_data,
                "admin_functions": permissions.can_access_admin_functions
            }
            
            has_permission = permission_map.get(permission_type, False)
            
            if not has_permission:
                # Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ
                violation = SandboxViolation(
                    module_name=module_name,
                    violation_type=f"permission_denied_{permission_type}",
                    details=f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº {permission_type} Ğ±ĞµĞ· Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ",
                    timestamp=os.time.time(),
                    severity="medium"
                )
                self._record_violation(violation)
            
            return has_permission
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {e}")
            return False
    
    def _record_violation(self, violation: SandboxViolation):
        """Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ sandbox"""
        self.violations.append(violation)
        
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ sandbox
        if violation.module_name in self.active_sandboxes:
            self.active_sandboxes[violation.module_name]["violations"].append(violation.__dict__)
        
        logger.warning(f"[Security] ĞĞ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ sandbox: {violation.module_name} - {violation.violation_type} ({violation.severity})")
    
    def get_module_permissions(self, module_name: str) -> Optional[ModulePermissions]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        if module_name not in self.active_sandboxes:
            return None
        
        sandbox_info = self.active_sandboxes[module_name]
        return ModulePermissions(**sandbox_info["permissions"])
    
    def update_security_level(self, module_name: str, new_level: SecurityLevel) -> bool:
        """ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        try:
            if module_name not in self.active_sandboxes:
                logger.error(f"[Security] Sandbox Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½")
                return False
            
            # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ
            new_permissions = self.security_levels[new_level]
            self.active_sandboxes[module_name]["security_level"] = new_level.value
            self.active_sandboxes[module_name]["permissions"] = new_permissions.__dict__
            
            logger.info(f"[Security] ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name} Ğ½Ğ° {new_level.value}")
            return True
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {e}")
            return False
    
    def destroy_sandbox(self, module_name: str) -> bool:
        """Ğ£Ğ½Ğ¸Ñ‡Ñ‚Ğ¾Ğ¶Ğ°ĞµÑ‚ sandbox Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        try:
            if module_name not in self.active_sandboxes:
                return True
            
            # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ sandbox
            sandbox_info = self.active_sandboxes[module_name]
            sandbox_dir = Path(sandbox_info["sandbox_dir"])
            
            if sandbox_dir.exists():
                shutil.rmtree(sandbox_dir)
            
            # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ¸Ğ· Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… sandbox'Ğ¾Ğ²
            del self.active_sandboxes[module_name]
            
            logger.info(f"[Security] Ğ£Ğ½Ğ¸Ñ‡Ñ‚Ğ¾Ğ¶ĞµĞ½ sandbox Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}")
            return True
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒĞ½Ğ¸Ñ‡Ñ‚Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ sandbox Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {e}")
            return False
    
    def get_violations(self, module_name: Optional[str] = None) -> List[SandboxViolation]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğ¹"""
        if module_name:
            return [v for v in self.violations if v.module_name == module_name]
        return self.violations.copy()
    
    def get_sandbox_status(self, module_name: str) -> Optional[Dict]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ sandbox Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        return self.active_sandboxes.get(module_name)
    
    def list_active_sandboxes(self) -> Dict[str, Dict]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… sandbox'Ğ¾Ğ²"""
        return self.active_sandboxes.copy()



======================================================================

------------------------------ FILE: Systems/core/security/audit_logger.py ------------------------------
# core/security/audit_logger.py
"""
Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°ÑƒĞ´Ğ¸Ñ‚-Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ²ÑĞµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°
"""

import json
import time
from typing import Dict, List, Optional, Any
from pathlib import Path
from dataclasses import dataclass, asdict
from enum import Enum
from loguru import logger
from datetime import datetime

class AuditEventType(Enum):
    """Ğ¢Ğ¸Ğ¿Ñ‹ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°"""
    MODULE_LOAD = "module_load"
    MODULE_UNLOAD = "module_unload"
    COMMAND_EXECUTION = "command_execution"
    DATABASE_ACCESS = "database_access"
    FILE_ACCESS = "file_access"
    NETWORK_REQUEST = "network_request"
    SYSTEM_COMMAND = "system_command"
    USER_DATA_MODIFICATION = "user_data_modification"
    ADMIN_FUNCTION_ACCESS = "admin_function_access"
    SECURITY_VIOLATION = "security_violation"
    PERMISSION_CHECK = "permission_check"

class AuditSeverity(Enum):
    """Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ ÑĞµÑ€ÑŒĞµĞ·Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹"""
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    CRITICAL = "critical"

@dataclass
class AuditEvent:
    """Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°"""
    event_id: str
    event_type: AuditEventType
    module_name: str
    user_id: Optional[int]
    timestamp: float
    severity: AuditSeverity
    details: Dict[str, Any]
    ip_address: Optional[str] = None
    user_agent: Optional[str] = None
    success: bool = True
    error_message: Optional[str] = None

class SecurityAuditLogger:
    """Ğ›Ğ¾Ğ³Ğ³ĞµÑ€ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    
    def __init__(self, config):
        self.config = config
        self.audit_dir = config.core.project_data_path / "Security" / "audit_logs"
        self.audit_dir.mkdir(parents=True, exist_ok=True)
        
        # Ğ‘ÑƒÑ„ĞµÑ€ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ±Ğ°Ñ‚Ñ‡ĞµĞ²Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
        self.event_buffer: List[AuditEvent] = []
        self.buffer_size = 100
        self.buffer_timeout = 30  # ÑĞµĞºÑƒĞ½Ğ´
        
        # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
        self.event_stats = {
            "total_events": 0,
            "events_by_type": {},
            "events_by_severity": {},
            "events_by_module": {},
            "violations_count": 0
        }
        
        logger.info(f"[Security] SecurityAuditLogger Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½. Ğ”Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°: {self.audit_dir}")
    
    def log_event(self, 
                  event_type: AuditEventType,
                  module_name: str,
                  details: Dict[str, Any],
                  user_id: Optional[int] = None,
                  severity: AuditSeverity = AuditSeverity.MEDIUM,
                  success: bool = True,
                  error_message: Optional[str] = None,
                  ip_address: Optional[str] = None,
                  user_agent: Optional[str] = None) -> str:
        """Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°"""
        
        event_id = self._generate_event_id()
        timestamp = time.time()
        
        event = AuditEvent(
            event_id=event_id,
            event_type=event_type,
            module_name=module_name,
            user_id=user_id,
            timestamp=timestamp,
            severity=severity,
            details=details,
            ip_address=ip_address,
            user_agent=user_agent,
            success=success,
            error_message=error_message
        )
        
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² Ğ±ÑƒÑ„ĞµÑ€
        self.event_buffer.append(event)
        
        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ
        self._update_stats(event)
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ±ÑƒÑ„ĞµÑ€
        if len(self.event_buffer) >= self.buffer_size:
            self._flush_buffer()
        
        logger.debug(f"[Security] Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°: {event_type.value} Ğ¾Ñ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}")
        return event_id
    
    def _generate_event_id(self) -> str:
        """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ID ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ"""
        timestamp = int(time.time() * 1000)
        return f"AUDIT_{timestamp}_{len(self.event_buffer)}"
    
    def _update_stats(self, event: AuditEvent):
        """ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹"""
        self.event_stats["total_events"] += 1
        
        # ĞŸĞ¾ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
        event_type = event.event_type.value
        self.event_stats["events_by_type"][event_type] = self.event_stats["events_by_type"].get(event_type, 0) + 1
        
        # ĞŸĞ¾ ÑƒÑ€Ğ¾Ğ²Ğ½ÑĞ¼ ÑĞµÑ€ÑŒĞµĞ·Ğ½Ğ¾ÑÑ‚Ğ¸
        severity = event.severity.value
        self.event_stats["events_by_severity"][severity] = self.event_stats["events_by_severity"].get(severity, 0) + 1
        
        # ĞŸĞ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼
        module_name = event.module_name
        self.event_stats["events_by_module"][module_name] = self.event_stats["events_by_module"].get(module_name, 0) + 1
        
        # ĞĞ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ
        if event.event_type == AuditEventType.SECURITY_VIOLATION:
            self.event_stats["violations_count"] += 1
    
    def _flush_buffer(self):
        """Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ±ÑƒÑ„ĞµÑ€ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ² Ñ„Ğ°Ğ¹Ğ»"""
        if not self.event_buffer:
            return
        
        try:
            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ´Ğ½Ñ
            today = datetime.now().strftime("%Y-%m-%d")
            audit_file = self.audit_dir / f"audit_{today}.jsonl"
            
            # Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ JSONL
            with open(audit_file, 'a', encoding='utf-8') as f:
                for event in self.event_buffer:
                    event_dict = asdict(event)
                    # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ enum Ğ² ÑÑ‚Ñ€Ğ¾ĞºĞ¸
                    event_dict["event_type"] = event.event_type.value
                    event_dict["severity"] = event.severity.value
                    f.write(json.dumps(event_dict, ensure_ascii=False) + '\n')
            
            logger.debug(f"[Security] Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾ {len(self.event_buffer)} ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ° Ğ² {audit_file}")
            
            # ĞÑ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ Ğ±ÑƒÑ„ĞµÑ€
            self.event_buffer.clear()
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ±ÑƒÑ„ĞµÑ€Ğ° Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°: {e}")
    
    def log_module_load(self, module_name: str, module_path: str, signature_valid: bool, signer_id: Optional[str] = None):
        """Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        details = {
            "module_path": module_path,
            "signature_valid": signature_valid,
            "signer_id": signer_id
        }
        
        severity = AuditSeverity.HIGH if not signature_valid else AuditSeverity.MEDIUM
        
        return self.log_event(
            event_type=AuditEventType.MODULE_LOAD,
            module_name=module_name,
            details=details,
            severity=severity,
            success=signature_valid
        )
    
    def log_command_execution(self, module_name: str, command: str, user_id: int, success: bool = True, error_message: Optional[str] = None):
        """Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹"""
        details = {
            "command": command,
            "user_id": user_id
        }
        
        return self.log_event(
            event_type=AuditEventType.COMMAND_EXECUTION,
            module_name=module_name,
            details=details,
            user_id=user_id,
            severity=AuditSeverity.MEDIUM,
            success=success,
            error_message=error_message
        )
    
    def log_database_access(self, module_name: str, operation: str, table: str, user_id: Optional[int] = None, success: bool = True):
        """Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
        details = {
            "operation": operation,
            "table": table
        }
        
        return self.log_event(
            event_type=AuditEventType.DATABASE_ACCESS,
            module_name=module_name,
            details=details,
            user_id=user_id,
            severity=AuditSeverity.MEDIUM,
            success=success
        )
    
    def log_security_violation(self, module_name: str, violation_type: str, details: Dict[str, Any], user_id: Optional[int] = None):
        """Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
        return self.log_event(
            event_type=AuditEventType.SECURITY_VIOLATION,
            module_name=module_name,
            details={
                "violation_type": violation_type,
                **details
            },
            user_id=user_id,
            severity=AuditSeverity.HIGH,
            success=False
        )
    
    def get_events(self, 
                   module_name: Optional[str] = None,
                   event_type: Optional[AuditEventType] = None,
                   severity: Optional[AuditSeverity] = None,
                   start_time: Optional[float] = None,
                   end_time: Optional[float] = None,
                   limit: int = 1000) -> List[AuditEvent]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ° Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹"""
        
        # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ±ÑƒÑ„ĞµÑ€
        self._flush_buffer()
        
        events = []
        
        try:
            # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°
            audit_files = sorted(self.audit_dir.glob("audit_*.jsonl"), reverse=True)
            
            for audit_file in audit_files:
                if len(events) >= limit:
                    break
                
                with open(audit_file, 'r', encoding='utf-8') as f:
                    for line in f:
                        if len(events) >= limit:
                            break
                        
                        try:
                            event_data = json.loads(line.strip())
                            
                            # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹
                            if module_name and event_data.get("module_name") != module_name:
                                continue
                            
                            if event_type and event_data.get("event_type") != event_type.value:
                                continue
                            
                            if severity and event_data.get("severity") != severity.value:
                                continue
                            
                            if start_time and event_data.get("timestamp", 0) < start_time:
                                continue
                            
                            if end_time and event_data.get("timestamp", 0) > end_time:
                                continue
                            
                            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
                            event = AuditEvent(
                                event_id=event_data["event_id"],
                                event_type=AuditEventType(event_data["event_type"]),
                                module_name=event_data["module_name"],
                                user_id=event_data.get("user_id"),
                                timestamp=event_data["timestamp"],
                                severity=AuditSeverity(event_data["severity"]),
                                details=event_data["details"],
                                ip_address=event_data.get("ip_address"),
                                user_agent=event_data.get("user_agent"),
                                success=event_data.get("success", True),
                                error_message=event_data.get("error_message")
                            )
                            
                            events.append(event)
                            
                        except Exception as e:
                            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°: {e}")
                            continue
        
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°: {e}")
        
        return events
    
    def get_statistics(self) -> Dict[str, Any]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°"""
        # Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ±ÑƒÑ„ĞµÑ€ Ğ¿ĞµÑ€ĞµĞ´ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸ĞµĞ¼ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
        self._flush_buffer()
        
        return self.event_stats.copy()
    
    def cleanup_old_logs(self, days_to_keep: int = 30):
        """ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°"""
        try:
            cutoff_time = time.time() - (days_to_keep * 24 * 60 * 60)
            
            for audit_file in self.audit_dir.glob("audit_*.jsonl"):
                if audit_file.stat().st_mtime < cutoff_time:
                    audit_file.unlink()
                    logger.info(f"[Security] Ğ£Ğ´Ğ°Ğ»ĞµĞ½ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°: {audit_file}")
        
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°: {e}")
    
    def force_flush(self):
        """ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ±ÑƒÑ„ĞµÑ€"""
        self._flush_buffer()



======================================================================

------------------------------ FILE: Systems/core/security/signature_manager.py ------------------------------
# core/security/signature_manager.py
"""
Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ†Ğ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞµĞ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
ĞĞ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ¿Ğ¾Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ¹ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¸
"""

import os
import json
import time
from typing import Dict, List, Optional, Tuple
from pathlib import Path
from dataclasses import dataclass
from loguru import logger

from .crypto_manager import CryptoManager, DigitalSignature

@dataclass
class SignatureVerificationResult:
    """Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸"""
    is_valid: bool
    is_trusted: bool
    error_message: Optional[str] = None
    signer_reputation: Optional[str] = None
    key_id: Optional[str] = None

class ModuleSignatureManager:
    """ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ñ†Ğ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞµĞ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ñ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ¹ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸ĞµĞ¹"""
    
    def __init__(self, config):
        self.config = config
        self.signatures_dir = config.core.project_data_path / "Security" / "signatures"
        self.trusted_keys_dir = config.core.project_data_path / "Security" / "trusted_keys"
        self.signatures_dir.mkdir(parents=True, exist_ok=True)
        self.trusted_keys_dir.mkdir(parents=True, exist_ok=True)
        
        # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¸
        self.crypto_manager = CryptoManager(config)
        
        # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ¾Ğ²
        self.trusted_signers = self._load_trusted_signers()
        
        logger.info(f"[Security] ModuleSignatureManager Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ñ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸ĞµĞ¹. Ğ”Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ¾Ğ²: {len(self.trusted_signers)}")
    
    def _load_trusted_signers(self) -> Dict[str, Dict]:
        """Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ¾Ğ²"""
        trusted_file = self.trusted_keys_dir / "trusted_signers.json"
        
        if trusted_file.exists():
            try:
                with open(trusted_file, 'r', encoding='utf-8') as f:
                    return json.load(f)
            except Exception as e:
                logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ¾Ğ²: {e}")
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ¾Ğ²
        default_trusted = {
            "sdb_core_team": {
                "name": "SDB Core Team",
                "email": "core@sdb.dev",
                "key_id": "SDB-CORE-2024",
                "reputation": "trusted",
                "description": "ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ SDB"
            }
        }
        
        self._save_trusted_signers(default_trusted)
        return default_trusted
    
    def _save_trusted_signers(self, signers: Dict[str, Dict]):
        """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ¾Ğ²"""
        trusted_file = self.trusted_keys_dir / "trusted_signers.json"
        
        try:
            with open(trusted_file, 'w', encoding='utf-8') as f:
                json.dump(signers, f, indent=2, ensure_ascii=False)
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ¾Ğ²: {e}")
    
    def calculate_file_hash(self, file_path: Path) -> str:
        """Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Ñ…ÑÑˆ Ñ„Ğ°Ğ¹Ğ»Ğ°"""
        try:
            with open(file_path, 'rb') as f:
                file_content = f.read()
                return hashlib.sha256(file_content).hexdigest()
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ñ Ñ…ÑÑˆĞ° Ñ„Ğ°Ğ¹Ğ»Ğ° {file_path}: {e}")
            return ""
    
    def sign_module(self, module_path: Path, key_id: str) -> bool:
        """ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ¹ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¸"""
        try:
            if not module_path.exists():
                logger.error(f"[Security] Ğ¤Ğ°Ğ¹Ğ» Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: {module_path}")
                return False
            
            # ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
            digital_signature = self.crypto_manager.sign_module(module_path, key_id)
            
            # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ
            signature_file = self.signatures_dir / f"{module_path.stem}.sig"
            signature_data = {
                "module_name": digital_signature.module_name,
                "version": digital_signature.version,
                "file_hash": digital_signature.file_hash,
                "signature": digital_signature.signature.hex(),  # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ² hex Ğ´Ğ»Ñ JSON
                "signer_key_id": digital_signature.signer_key_id,
                "timestamp": digital_signature.timestamp,
                "algorithm": digital_signature.algorithm
            }
            
            with open(signature_file, 'w', encoding='utf-8') as f:
                json.dump(signature_data, f, indent=2, ensure_ascii=False)
            
            logger.info(f"[Security] ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {module_path.stem} ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½ ĞºĞ»ÑÑ‡Ğ¾Ğ¼ {key_id}")
            return True
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_path}: {e}")
            return False
    
    def _generate_signature(self, data: Dict, private_key_path: Optional[Path] = None) -> str:
        """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ñ†Ğ¸Ñ„Ñ€Ğ¾Ğ²ÑƒÑ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ (ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ)"""
        # Ğ’ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ·Ğ´ĞµÑÑŒ Ğ±ÑƒĞ´ĞµÑ‚ GPG Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ
        # ĞŸĞ¾ĞºĞ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ…ÑÑˆ Ğ¾Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        data_str = json.dumps(data, sort_keys=True)
        return hashlib.sha256(data_str.encode()).hexdigest()
    
    def verify_signature(self, module_path: Path) -> SignatureVerificationResult:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ¹ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¸"""
        try:
            signature_file = self.signatures_dir / f"{module_path.stem}.sig"
            
            if not signature_file.exists():
                return SignatureVerificationResult(
                    is_valid=False,
                    is_trusted=False,
                    error_message="ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°"
                )
            
            # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ
            with open(signature_file, 'r', encoding='utf-8') as f:
                signature_data = json.load(f)
            
            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ñ†Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸
            digital_signature = DigitalSignature(
                module_name=signature_data["module_name"],
                version=signature_data["version"],
                file_hash=signature_data["file_hash"],
                signature=bytes.fromhex(signature_data["signature"]),  # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸Ğ· hex
                signer_key_id=signature_data["signer_key_id"],
                timestamp=signature_data["timestamp"],
                algorithm=signature_data["algorithm"]
            )
            
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ğ¸
            is_valid = self.crypto_manager.verify_module_signature(module_path, digital_signature)
            
            if not is_valid:
                return SignatureVerificationResult(
                    is_valid=False,
                    is_trusted=False,
                    error_message="ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ½ĞµĞ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°",
                    key_id=digital_signature.signer_key_id
                )
            
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¼
            key_id = digital_signature.signer_key_id
            is_trusted = key_id in self.trusted_signers
            
            return SignatureVerificationResult(
                is_valid=True,
                is_trusted=is_trusted,
                signer_reputation=self.trusted_signers.get(key_id, {}).get("reputation") if is_trusted else None,
                key_id=key_id
            )
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_path}: {e}")
            return SignatureVerificationResult(
                is_valid=False,
                is_trusted=False,
                error_message=f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸: {e}"
            )
    
    def add_trusted_signer(self, signer_id: str, signer_info: Dict) -> bool:
        """Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ°"""
        try:
            self.trusted_signers[signer_id] = signer_info
            self._save_trusted_signers(self.trusted_signers)
            logger.info(f"[Security] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚: {signer_id}")
            return True
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ° {signer_id}: {e}")
            return False
    
    def remove_trusted_signer(self, signer_id: str) -> bool:
        """Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ°"""
        try:
            if signer_id in self.trusted_signers:
                del self.trusted_signers[signer_id]
                self._save_trusted_signers(self.trusted_signers)
                logger.info(f"[Security] Ğ£Ğ´Ğ°Ğ»ĞµĞ½ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚: {signer_id}")
                return True
            return False
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ° {signer_id}: {e}")
            return False
    
    def list_trusted_signers(self) -> Dict[str, Dict]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ¾Ğ²"""
        return self.trusted_signers.copy()
    
    def get_module_signature_info(self, module_name: str) -> Optional[Dict]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        signature_file = self.signatures_dir / f"{module_name}.sig"
        
        if not signature_file.exists():
            return None
        
        try:
            with open(signature_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {e}")
            return None
    
    def generate_signing_key(self, key_id: str, key_size: int = 2048) -> bool:
        """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¿Ğ°Ñ€Ñƒ ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ"""
        try:
            self.crypto_manager.generate_key_pair(key_id, key_size)
            logger.info(f"[Security] Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ½Ğ¾Ğ²Ğ°Ñ Ğ¿Ğ°Ñ€Ğ° ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ: {key_id}")
            return True
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ»ÑÑ‡ĞµĞ¹ {key_id}: {e}")
            return False
    
    def export_public_key(self, key_id: str) -> Optional[bytes]:
        """Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ Ñ€Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ"""
        try:
            return self.crypto_manager.export_public_key(key_id)
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ° {key_id}: {e}")
            return None
    
    def import_trusted_public_key(self, key_id: str, public_key_pem: bytes) -> bool:
        """Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡"""
        try:
            # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
            public_key_file = self.trusted_keys_dir / f"{key_id}.public"
            with open(public_key_file, 'wb') as f:
                f.write(public_key_pem)
            os.chmod(public_key_file, 0o644)
            
            # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ…
            self.trusted_signers[key_id] = {
                "name": f"Imported Key {key_id}",
                "email": "unknown@example.com",
                "key_id": key_id,
                "reputation": "trusted",
                "description": "Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡",
                "imported_at": time.time()
            }
            
            self._save_trusted_signers(self.trusted_signers)
            
            logger.info(f"[Security] Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡: {key_id}")
            return True
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ° {key_id}: {e}")
            return False
    
    def list_available_keys(self) -> List[str]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ»ÑÑ‡ĞµĞ¹"""
        return self.crypto_manager.list_available_keys()



======================================================================

------------------------------ FILE: Systems/core/security/security_levels.py ------------------------------
# core/security/security_levels.py
"""
Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹
"""

import json
from typing import Dict, List, Optional, Tuple, Set
from pathlib import Path
from dataclasses import dataclass
from enum import Enum
from loguru import logger

class SecurityLevel(Enum):
    """Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    PARANOID = "paranoid"      # ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°
    STRICT = "strict"         # Ğ¡Ñ‚Ñ€Ğ¾Ğ³Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°
    MODERATE = "moderate"     # Ğ£Ğ¼ĞµÑ€ĞµĞ½Ğ½Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°
    PERMISSIVE = "permissive" # ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸)

class SecurityPolicy(Enum):
    """ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    ALLOW_SIGNED_ONLY = "allow_signed_only"           # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
    REQUIRE_REPUTATION = "require_reputation"          # Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½ÑƒÑ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ñ
    SANDBOX_ALL_MODULES = "sandbox_all_modules"        # Ğ’ÑĞµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ² sandbox
    AUDIT_ALL_ACTIONS = "audit_all_actions"           # ĞÑƒĞ´Ğ¸Ñ‚ Ğ²ÑĞµÑ… Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹
    BLOCK_SUSPICIOUS = "block_suspicious"             # Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
    REQUIRE_APPROVAL = "require_approval"             # Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¸Ğµ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°

@dataclass
class SecurityConfiguration:
    """ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    level: SecurityLevel
    policies: Set[SecurityPolicy]
    min_reputation_score: float
    allowed_developers: Set[str]
    blocked_modules: Set[str]
    trusted_signers: Set[str]
    max_risk_score: float
    auto_approve_verified: bool

class SecurityLevelManager:
    """ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    
    def __init__(self, config):
        self.config = config
        self.security_dir = config.core.project_data_path / "Security" / "levels"
        self.security_dir.mkdir(parents=True, exist_ok=True)
        
        # ĞŸÑ€ĞµĞ´ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
        self.default_configurations = {
            SecurityLevel.PARANOID: SecurityConfiguration(
                level=SecurityLevel.PARANOID,
                policies={
                    SecurityPolicy.ALLOW_SIGNED_ONLY,
                    SecurityPolicy.REQUIRE_REPUTATION,
                    SecurityPolicy.SANDBOX_ALL_MODULES,
                    SecurityPolicy.AUDIT_ALL_ACTIONS,
                    SecurityPolicy.BLOCK_SUSPICIOUS,
                    SecurityPolicy.REQUIRE_APPROVAL
                },
                min_reputation_score=80.0,
                allowed_developers=set(),
                blocked_modules=set(),
                trusted_signers={"sdb_core_team"},
                max_risk_score=10.0,
                auto_approve_verified=False
            ),
            
            SecurityLevel.STRICT: SecurityConfiguration(
                level=SecurityLevel.STRICT,
                policies={
                    SecurityPolicy.ALLOW_SIGNED_ONLY,
                    SecurityPolicy.REQUIRE_REPUTATION,
                    SecurityPolicy.SANDBOX_ALL_MODULES,
                    SecurityPolicy.AUDIT_ALL_ACTIONS,
                    SecurityPolicy.BLOCK_SUSPICIOUS
                },
                min_reputation_score=60.0,
                allowed_developers=set(),
                blocked_modules=set(),
                trusted_signers={"sdb_core_team"},
                max_risk_score=30.0,
                auto_approve_verified=True
            ),
            
            SecurityLevel.MODERATE: SecurityConfiguration(
                level=SecurityLevel.MODERATE,
                policies={
                    SecurityPolicy.REQUIRE_REPUTATION,
                    SecurityPolicy.SANDBOX_ALL_MODULES,
                    SecurityPolicy.AUDIT_ALL_ACTIONS
                },
                min_reputation_score=40.0,
                allowed_developers=set(),
                blocked_modules=set(),
                trusted_signers={"sdb_core_team"},
                max_risk_score=50.0,
                auto_approve_verified=True
            ),
            
            SecurityLevel.PERMISSIVE: SecurityConfiguration(
                level=SecurityLevel.PERMISSIVE,
                policies={
                    SecurityPolicy.AUDIT_ALL_ACTIONS
                },
                min_reputation_score=0.0,
                allowed_developers=set(),
                blocked_modules=set(),
                trusted_signers=set(),
                max_risk_score=100.0,
                auto_approve_verified=True
            )
        }
        
        # Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
        self.current_config = self._load_security_configuration()
        
        logger.info(f"[Security] SecurityLevelManager Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ñ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¼ {self.current_config.level.value}")
    
    def _load_security_configuration(self) -> SecurityConfiguration:
        """Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
        config_file = self.security_dir / "security_config.json"
        
        if config_file.exists():
            try:
                with open(config_file, 'r', encoding='utf-8') as f:
                    data = json.load(f)
                
                return SecurityConfiguration(
                    level=SecurityLevel(data["level"]),
                    policies={SecurityPolicy(policy) for policy in data["policies"]},
                    min_reputation_score=data["min_reputation_score"],
                    allowed_developers=set(data["allowed_developers"]),
                    blocked_modules=set(data["blocked_modules"]),
                    trusted_signers=set(data["trusted_signers"]),
                    max_risk_score=data["max_risk_score"],
                    auto_approve_verified=data["auto_approve_verified"]
                )
            except Exception as e:
                logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸: {e}")
        
        # Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
        return self.default_configurations[SecurityLevel.MODERATE]
    
    def _save_security_configuration(self):
        """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
        config_file = self.security_dir / "security_config.json"
        
        try:
            data = {
                "level": self.current_config.level.value,
                "policies": [policy.value for policy in self.current_config.policies],
                "min_reputation_score": self.current_config.min_reputation_score,
                "allowed_developers": list(self.current_config.allowed_developers),
                "blocked_modules": list(self.current_config.blocked_modules),
                "trusted_signers": list(self.current_config.trusted_signers),
                "max_risk_score": self.current_config.max_risk_score,
                "auto_approve_verified": self.current_config.auto_approve_verified
            }
            
            with open(config_file, 'w', encoding='utf-8') as f:
                json.dump(data, f, indent=2, ensure_ascii=False)
        
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸: {e}")
    
    def set_security_level(self, level: SecurityLevel) -> bool:
        """Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
        try:
            self.current_config = self.default_configurations[level].__class__(
                level=level,
                policies=self.default_configurations[level].policies.copy(),
                min_reputation_score=self.default_configurations[level].min_reputation_score,
                allowed_developers=self.default_configurations[level].allowed_developers.copy(),
                blocked_modules=self.default_configurations[level].blocked_modules.copy(),
                trusted_signers=self.default_configurations[level].trusted_signers.copy(),
                max_risk_score=self.default_configurations[level].max_risk_score,
                auto_approve_verified=self.default_configurations[level].auto_approve_verified
            )
            
            self._save_security_configuration()
            logger.info(f"[Security] Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸: {level.value}")
            return True
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ {level.value}: {e}")
            return False
    
    def get_current_configuration(self) -> SecurityConfiguration:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
        return self.current_config
    
    def add_policy(self, policy: SecurityPolicy) -> bool:
        """Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
        try:
            self.current_config.policies.add(policy)
            self._save_security_configuration()
            logger.info(f"[Security] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸: {policy.value}")
            return True
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ {policy.value}: {e}")
            return False
    
    def remove_policy(self, policy: SecurityPolicy) -> bool:
        """Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
        try:
            self.current_config.policies.discard(policy)
            self._save_security_configuration()
            logger.info(f"[Security] Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸: {policy.value}")
            return True
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ {policy.value}: {e}")
            return False
    
    def add_trusted_signer(self, signer_id: str) -> bool:
        """Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ°"""
        try:
            self.current_config.trusted_signers.add(signer_id)
            self._save_security_configuration()
            logger.info(f"[Security] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚: {signer_id}")
            return True
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ° {signer_id}: {e}")
            return False
    
    def remove_trusted_signer(self, signer_id: str) -> bool:
        """Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ°"""
        try:
            self.current_config.trusted_signers.discard(signer_id)
            self._save_security_configuration()
            logger.info(f"[Security] Ğ£Ğ´Ğ°Ğ»ĞµĞ½ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚: {signer_id}")
            return True
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ° {signer_id}: {e}")
            return False
    
    def block_module(self, module_name: str) -> bool:
        """Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ"""
        try:
            self.current_config.blocked_modules.add(module_name)
            self._save_security_configuration()
            logger.info(f"[Security] Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ: {module_name}")
            return True
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {e}")
            return False
    
    def unblock_module(self, module_name: str) -> bool:
        """Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ"""
        try:
            self.current_config.blocked_modules.discard(module_name)
            self._save_security_configuration()
            logger.info(f"[Security] Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ: {module_name}")
            return True
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {e}")
            return False
    
    def is_module_allowed(self, module_name: str, 
                         signature_valid: bool = False,
                         reputation_score: float = 0.0,
                         risk_score: float = 0.0,
                         developer_id: str = "unknown") -> Tuple[bool, str]:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½ Ğ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸"""
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºÑƒ
        if module_name in self.current_config.blocked_modules:
            return False, f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {module_name} Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼"
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
        if SecurityPolicy.ALLOW_SIGNED_ONLY in self.current_config.policies:
            if not signature_valid:
                return False, f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {module_name} Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½, Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ"
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸
        if SecurityPolicy.REQUIRE_REPUTATION in self.current_config.policies:
            if reputation_score < self.current_config.min_reputation_score:
                return False, f"Ğ ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name} ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ½Ğ¸Ğ·ĞºĞ°Ñ ({reputation_score:.1f} < {self.current_config.min_reputation_score})"
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ…
        if SecurityPolicy.BLOCK_SUSPICIOUS in self.current_config.policies:
            if risk_score > self.current_config.max_risk_score:
                return False, f"Ğ Ğ¸ÑĞº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name} ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ ({risk_score:.1f} > {self.current_config.max_risk_score})"
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²
        if self.current_config.allowed_developers and developer_id not in self.current_config.allowed_developers:
            return False, f"Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº {developer_id} Ğ½Ğµ Ğ² ÑĞ¿Ğ¸ÑĞºĞµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ½Ñ‹Ñ…"
        
        return True, "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½ Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸"
    
    def get_security_summary(self) -> Dict[str, any]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ²Ğ¾Ğ´ĞºÑƒ Ğ¿Ğ¾ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
        return {
            "current_level": self.current_config.level.value,
            "active_policies": [policy.value for policy in self.current_config.policies],
            "min_reputation_score": self.current_config.min_reputation_score,
            "max_risk_score": self.current_config.max_risk_score,
            "trusted_signers_count": len(self.current_config.trusted_signers),
            "blocked_modules_count": len(self.current_config.blocked_modules),
            "allowed_developers_count": len(self.current_config.allowed_developers),
            "auto_approve_verified": self.current_config.auto_approve_verified
        }



======================================================================

------------------------------ FILE: Systems/core/security/anomaly_detection.py ------------------------------
# core/security/anomaly_detection.py
"""
Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ğ¸ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ²Ñ‹ÑĞ²Ğ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹
"""

import time
import json
from typing import Dict, List, Optional, Tuple, Set
from pathlib import Path
from dataclasses import dataclass
from enum import Enum
from collections import defaultdict, deque
from loguru import logger
from datetime import datetime, timedelta

class AnomalyType(Enum):
    """Ğ¢Ğ¸Ğ¿Ñ‹ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹"""
    FREQUENT_COMMANDS = "frequent_commands"           # Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
    UNUSUAL_PATTERNS = "unusual_patterns"            # ĞĞµĞ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    SUSPICIOUS_TIMING = "suspicious_timing"          # ĞŸĞ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
    RESOURCE_ABUSE = "resource_abuse"                # Ğ—Ğ»Ğ¾ÑƒĞ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµÑÑƒÑ€ÑĞ°Ğ¼Ğ¸
    DATA_EXFILTRATION = "data_exfiltration"          # ĞŸĞ¾Ğ´Ğ¾Ğ·Ñ€ĞµĞ½Ğ¸Ğµ Ğ½Ğ° ÑƒÑ‚ĞµÑ‡ĞºÑƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    PRIVILEGE_ESCALATION = "privilege_escalation"    # ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ²Ğ¸Ğ»ĞµĞ³Ğ¸Ğ¹
    NETWORK_ANOMALY = "network_anomaly"              # ĞĞ½Ğ¾Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞµÑ‚ĞµĞ²Ğ°Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ
    FILE_ACCESS_ANOMALY = "file_access_anomaly"      # ĞĞ½Ğ¾Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼

class AnomalySeverity(Enum):
    """Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ ÑĞµÑ€ÑŒĞµĞ·Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹"""
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    CRITICAL = "critical"

@dataclass
class AnomalyDetection:
    """ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ğ°Ñ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ñ"""
    anomaly_id: str
    anomaly_type: AnomalyType
    severity: AnomalySeverity
    module_name: str
    user_id: Optional[int]
    timestamp: float
    description: str
    evidence: Dict[str, any]
    confidence: float  # Ğ£Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ² Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğ¸ (0-1)
    auto_blocked: bool = False

@dataclass
class BehaviorPattern:
    """ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ"""
    module_name: str
    user_id: Optional[int]
    pattern_type: str
    frequency: int
    time_window: int  # ÑĞµĞºÑƒĞ½Ğ´Ñ‹
    last_seen: float

class AnomalyDetector:
    """Ğ”ĞµÑ‚ĞµĞºÑ‚Ğ¾Ñ€ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ"""
    
    def __init__(self, config):
        self.config = config
        self.anomaly_dir = config.core.project_data_path / "Security" / "anomaly_detection"
        self.anomaly_dir.mkdir(parents=True, exist_ok=True)
        
        # ĞŸĞ¾Ñ€Ğ¾Ğ³Ğ¸ Ğ´Ğ»Ñ Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ğ¸ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹
        self.thresholds = {
            "max_commands_per_minute": 30,
            "max_commands_per_hour": 500,
            "max_file_access_per_minute": 20,
            "max_network_requests_per_minute": 10,
            "max_database_queries_per_minute": 100,
            "suspicious_hours": [0, 1, 2, 3, 4, 5],  # ĞĞ¾Ñ‡Ğ½Ñ‹Ğµ Ñ‡Ğ°ÑÑ‹
            "unusual_pattern_threshold": 0.7
        }
        
        # Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
        self.activity_history: Dict[str, deque] = defaultdict(lambda: deque(maxlen=1000))
        
        # ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ
        self.behavior_patterns: Dict[str, List[BehaviorPattern]] = defaultdict(list)
        
        # ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğµ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¸
        self.detected_anomalies: List[AnomalyDetection] = []
        
        # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
        self.stats = {
            "total_anomalies": 0,
            "anomalies_by_type": defaultdict(int),
            "anomalies_by_severity": defaultdict(int),
            "auto_blocked_modules": set()
        }
        
        logger.info(f"[Security] AnomalyDetector Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ñ {len(self.thresholds)} Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ°Ğ¼Ğ¸")
    
    def analyze_activity(self, 
                        module_name: str,
                        activity_type: str,
                        user_id: Optional[int] = None,
                        details: Optional[Dict] = None) -> List[AnomalyDetection]:
        """ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹"""
        
        timestamp = time.time()
        activity_key = f"{module_name}:{user_id or 'system'}"
        
        # Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ
        activity_record = {
            "timestamp": timestamp,
            "activity_type": activity_type,
            "module_name": module_name,
            "user_id": user_id,
            "details": details or {}
        }
        
        self.activity_history[activity_key].append(activity_record)
        
        # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ½Ğ° Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¸
        anomalies = []
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ñƒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
        command_anomalies = self._detect_frequent_commands(activity_key, timestamp)
        anomalies.extend(command_anomalies)
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ
        timing_anomalies = self._detect_suspicious_timing(activity_key, timestamp)
        anomalies.extend(timing_anomalies)
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½ĞµĞ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹
        pattern_anomalies = self._detect_unusual_patterns(activity_key, activity_record)
        anomalies.extend(pattern_anomalies)
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ·Ğ»Ğ¾ÑƒĞ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµÑÑƒÑ€ÑĞ°Ğ¼Ğ¸
        resource_anomalies = self._detect_resource_abuse(activity_key, activity_record)
        anomalies.extend(resource_anomalies)
        
        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ
        for anomaly in anomalies:
            self._update_stats(anomaly)
        
        return anomalies
    
    def _detect_frequent_commands(self, activity_key: str, timestamp: float) -> List[AnomalyDetection]:
        """Ğ”ĞµÑ‚ĞµĞºÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹"""
        anomalies = []
        
        # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
        recent_activities = [
            activity for activity in self.activity_history[activity_key]
            if timestamp - activity["timestamp"] <= 60  # ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°
        ]
        
        command_count = len([a for a in recent_activities if a["activity_type"] == "command"])
        
        if command_count > self.thresholds["max_commands_per_minute"]:
            anomaly = AnomalyDetection(
                anomaly_id=f"freq_cmd_{int(timestamp)}",
                anomaly_type=AnomalyType.FREQUENT_COMMANDS,
                severity=AnomalySeverity.HIGH,
                module_name=activity_key.split(":")[0],
                user_id=int(activity_key.split(":")[1]) if activity_key.split(":")[1] != "system" else None,
                timestamp=timestamp,
                description=f"Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹: {command_count} Ğ·Ğ° Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ",
                evidence={
                    "command_count": command_count,
                    "threshold": self.thresholds["max_commands_per_minute"],
                    "time_window": "1 minute"
                },
                confidence=min(1.0, command_count / self.thresholds["max_commands_per_minute"])
            )
            anomalies.append(anomaly)
        
        return anomalies
    
    def _detect_suspicious_timing(self, activity_key: str, timestamp: float) -> List[AnomalyDetection]:
        """Ğ”ĞµÑ‚ĞµĞºÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸"""
        anomalies = []
        
        current_hour = datetime.fromtimestamp(timestamp).hour
        
        if current_hour in self.thresholds["suspicious_hours"]:
            anomaly = AnomalyDetection(
                anomaly_id=f"susp_timing_{int(timestamp)}",
                anomaly_type=AnomalyType.SUSPICIOUS_TIMING,
                severity=AnomalySeverity.MEDIUM,
                module_name=activity_key.split(":")[0],
                user_id=int(activity_key.split(":")[1]) if activity_key.split(":")[1] != "system" else None,
                timestamp=timestamp,
                description=f"ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ² Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ: {current_hour}:00",
                evidence={
                    "hour": current_hour,
                    "suspicious_hours": self.thresholds["suspicious_hours"]
                },
                confidence=0.6
            )
            anomalies.append(anomaly)
        
        return anomalies
    
    def _detect_unusual_patterns(self, activity_key: str, activity_record: Dict) -> List[AnomalyDetection]:
        """Ğ”ĞµÑ‚ĞµĞºÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½ĞµĞ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ"""
        anomalies = []
        
        module_name = activity_record["module_name"]
        activity_type = activity_record["activity_type"]
        
        # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        module_activities = [
            activity for activity in self.activity_history[activity_key]
            if activity["module_name"] == module_name
        ]
        
        # ĞŸĞ¾Ğ´ÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ñƒ Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
        activity_counts = defaultdict(int)
        for activity in module_activities[-100:]:  # ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 100 Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹
            activity_counts[activity["activity_type"]] += 1
        
        total_activities = sum(activity_counts.values())
        if total_activities > 0:
            current_activity_ratio = activity_counts[activity_type] / total_activities
            
            # Ğ•ÑĞ»Ğ¸ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ°ĞµÑ‚ÑÑ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ€ĞµĞ´ĞºĞ¾
            if current_activity_ratio < 0.1 and total_activities > 10:
                anomaly = AnomalyDetection(
                    anomaly_id=f"unusual_pattern_{int(time.time())}",
                    anomaly_type=AnomalyType.UNUSUAL_PATTERNS,
                    severity=AnomalySeverity.MEDIUM,
                    module_name=module_name,
                    user_id=activity_record["user_id"],
                    timestamp=activity_record["timestamp"],
                    description=f"ĞĞµĞ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸: {activity_type}",
                    evidence={
                        "activity_type": activity_type,
                        "ratio": current_activity_ratio,
                        "total_activities": total_activities,
                        "activity_counts": dict(activity_counts)
                    },
                    confidence=0.7
                )
                anomalies.append(anomaly)
        
        return anomalies
    
    def _detect_resource_abuse(self, activity_key: str, activity_record: Dict) -> List[AnomalyDetection]:
        """Ğ”ĞµÑ‚ĞµĞºÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ·Ğ»Ğ¾ÑƒĞ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµÑÑƒÑ€ÑĞ°Ğ¼Ğ¸"""
        anomalies = []
        
        timestamp = activity_record["timestamp"]
        activity_type = activity_record["activity_type"]
        
        # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ÑÑ‡ĞµÑ‚Ğ° Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
        recent_activities = [
            activity for activity in self.activity_history[activity_key]
            if timestamp - activity["timestamp"] <= 60  # ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°
        ]
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
        resource_checks = {
            "file_access": ("file_access", self.thresholds["max_file_access_per_minute"]),
            "network_request": ("network_request", self.thresholds["max_network_requests_per_minute"]),
            "database_query": ("database_query", self.thresholds["max_database_queries_per_minute"])
        }
        
        for resource_type, (check_type, threshold) in resource_checks.items():
            count = len([a for a in recent_activities if a["activity_type"] == check_type])
            
            if count > threshold:
                anomaly = AnomalyDetection(
                    anomaly_id=f"resource_abuse_{resource_type}_{int(timestamp)}",
                    anomaly_type=AnomalyType.RESOURCE_ABUSE,
                    severity=AnomalySeverity.HIGH,
                    module_name=activity_key.split(":")[0],
                    user_id=int(activity_key.split(":")[1]) if activity_key.split(":")[1] != "system" else None,
                    timestamp=timestamp,
                    description=f"Ğ—Ğ»Ğ¾ÑƒĞ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµÑÑƒÑ€ÑĞ°Ğ¼Ğ¸ {resource_type}: {count} Ğ·Ğ° Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ",
                    evidence={
                        "resource_type": resource_type,
                        "count": count,
                        "threshold": threshold,
                        "time_window": "1 minute"
                    },
                    confidence=min(1.0, count / threshold)
                )
                anomalies.append(anomaly)
        
        return anomalies
    
    def _update_stats(self, anomaly: AnomalyDetection):
        """ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹"""
        self.stats["total_anomalies"] += 1
        self.stats["anomalies_by_type"][anomaly.anomaly_type.value] += 1
        self.stats["anomalies_by_severity"][anomaly.severity.value] += 1
        
        if anomaly.auto_blocked:
            self.stats["auto_blocked_modules"].add(anomaly.module_name)
        
        self.detected_anomalies.append(anomaly)
    
    def should_block_module(self, module_name: str, user_id: Optional[int] = None) -> Tuple[bool, str]:
        """ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚, Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ"""
        activity_key = f"{module_name}:{user_id or 'system'}"
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        recent_anomalies = [
            anomaly for anomaly in self.detected_anomalies
            if anomaly.module_name == module_name and 
               time.time() - anomaly.timestamp <= 3600  # ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ‡Ğ°Ñ
        ]
        
        # Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµĞ¼ ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¸
        critical_anomalies = [a for a in recent_anomalies if a.severity == AnomalySeverity.CRITICAL]
        if critical_anomalies:
            return True, f"ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¸ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ñ‹: {len(critical_anomalies)}"
        
        # Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµĞ¼ ĞµÑĞ»Ğ¸ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ñ… Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹
        high_anomalies = [a for a in recent_anomalies if a.severity == AnomalySeverity.HIGH]
        if len(high_anomalies) >= 3:
            return True, f"Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ñ… Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹: {len(high_anomalies)}"
        
        # Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµĞ¼ ĞµÑĞ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ» Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
        if module_name in self.stats["auto_blocked_modules"]:
            return True, "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ±Ñ‹Ğ» Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ñ€Ğ°Ğ½ĞµĞµ"
        
        return False, "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½"
    
    def get_anomaly_statistics(self) -> Dict[str, any]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹"""
        return {
            "total_anomalies": self.stats["total_anomalies"],
            "anomalies_by_type": dict(self.stats["anomalies_by_type"]),
            "anomalies_by_severity": dict(self.stats["anomalies_by_severity"]),
            "auto_blocked_modules": list(self.stats["auto_blocked_modules"]),
            "active_modules": len(self.activity_history),
            "thresholds": self.thresholds
        }
    
    def get_recent_anomalies(self, hours: int = 24) -> List[AnomalyDetection]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğµ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¸"""
        cutoff_time = time.time() - (hours * 3600)
        return [
            anomaly for anomaly in self.detected_anomalies
            if anomaly.timestamp >= cutoff_time
        ]
    
    def clear_old_data(self, days_to_keep: int = 30):
        """ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ"""
        cutoff_time = time.time() - (days_to_keep * 24 * 3600)
        
        # ĞÑ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
        for activity_key in list(self.activity_history.keys()):
            activities = self.activity_history[activity_key]
            # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
            while activities and activities[0]["timestamp"] < cutoff_time:
                activities.popleft()
            
            # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ¿ÑƒÑÑ‚Ñ‹Ğµ ĞºĞ»ÑÑ‡Ğ¸
            if not activities:
                del self.activity_history[activity_key]
        
        # ĞÑ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¸
        self.detected_anomalies = [
            anomaly for anomaly in self.detected_anomalies
            if anomaly.timestamp >= cutoff_time
        ]
        
        logger.info(f"[Security] ĞÑ‡Ğ¸Ñ‰ĞµĞ½Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ€ÑˆĞµ {days_to_keep} Ğ´Ğ½ĞµĞ¹")



======================================================================

------------------------------ FILE: Systems/core/security/code_scanner.py ------------------------------
# core/security/code_scanner.py
"""
ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞºĞ°Ğ½ĞµÑ€ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ´Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ¾Ğ´ Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑƒĞ³Ñ€Ğ¾Ğ· Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
"""

import ast
import re
import json
from typing import Dict, List, Optional, Tuple, Set
from pathlib import Path
from dataclasses import dataclass
from enum import Enum
from loguru import logger

class ThreatLevel(Enum):
    """Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ ÑƒĞ³Ñ€Ğ¾Ğ·"""
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    CRITICAL = "critical"

class ThreatType(Enum):
    """Ğ¢Ğ¸Ğ¿Ñ‹ ÑƒĞ³Ñ€Ğ¾Ğ·"""
    MALICIOUS_IMPORT = "malicious_import"
    SYSTEM_COMMAND = "system_command"
    FILE_ACCESS = "file_access"
    NETWORK_REQUEST = "network_request"
    CODE_INJECTION = "code_injection"
    PRIVILEGE_ESCALATION = "privilege_escalation"
    DATA_EXFILTRATION = "data_exfiltration"
    BACKDOOR = "backdoor"
    CRYPTO_MINING = "crypto_mining"

@dataclass
class SecurityThreat:
    """Ğ£Ğ³Ñ€Ğ¾Ğ·Ğ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    threat_type: ThreatType
    threat_level: ThreatLevel
    file_path: str
    line_number: int
    code_snippet: str
    description: str
    recommendation: str

@dataclass
class ScanResult:
    """Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"""
    module_name: str
    scan_timestamp: float
    threats_found: List[SecurityThreat]
    risk_score: float  # 0-100
    is_safe: bool
    suspicious_patterns: List[str]
    code_metrics: Dict[str, any]

class ModuleCodeScanner:
    """Ğ¡ĞºĞ°Ğ½ĞµÑ€ ĞºĞ¾Ğ´Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    
    def __init__(self, config):
        self.config = config
        
        # ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ´Ğ°
        self.suspicious_patterns = {
            # Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
            ThreatType.SYSTEM_COMMAND: [
                r'os\.system\(',
                r'subprocess\.',
                r'exec\(',
                r'eval\(',
                r'__import__\(',
                r'compile\(',
                r'execfile\(',
            ],
            
            # Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼
            ThreatType.FILE_ACCESS: [
                r'open\(',
                r'file\(',
                r'os\.remove\(',
                r'os\.unlink\(',
                r'shutil\.',
                r'os\.path\.',
            ],
            
            # Ğ¡ĞµÑ‚ĞµĞ²Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
            ThreatType.NETWORK_REQUEST: [
                r'requests\.',
                r'urllib\.',
                r'socket\.',
                r'http\.',
                r'ftplib\.',
                r'smtplib\.',
            ],
            
            # Ğ˜Ğ½ÑŠĞµĞºÑ†Ğ¸Ñ ĞºĞ¾Ğ´Ğ°
            ThreatType.CODE_INJECTION: [
                r'eval\(',
                r'exec\(',
                r'__import__\(',
                r'getattr\(',
                r'setattr\(',
                r'globals\(',
                r'locals\(',
            ],
            
            # ĞŸĞ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹
            ThreatType.MALICIOUS_IMPORT: [
                r'import\s+os',
                r'import\s+subprocess',
                r'import\s+socket',
                r'import\s+urllib',
                r'import\s+requests',
                r'from\s+os\s+import',
                r'from\s+subprocess\s+import',
            ],
            
            # Backdoor Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹
            ThreatType.BACKDOOR: [
                r'backdoor',
                r'hidden',
                r'secret',
                r'admin',
                r'root',
                r'password',
                r'token',
                r'key',
            ],
            
            # ĞšÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ¼Ğ°Ğ¹Ğ½Ğ¸Ğ½Ğ³
            ThreatType.CRYPTO_MINING: [
                r'mining',
                r'hash',
                r'crypto',
                r'bitcoin',
                r'ethereum',
                r'miner',
            ]
        }
        
        # Ğ’ĞµÑĞ° ÑƒĞ³Ñ€Ğ¾Ğ· Ğ´Ğ»Ñ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ° Ğ¾Ğ±Ñ‰ĞµĞ³Ğ¾ Ñ€Ğ¸ÑĞºĞ°
        self.threat_weights = {
            ThreatLevel.CRITICAL: 1.0,
            ThreatLevel.HIGH: 0.7,
            ThreatLevel.MEDIUM: 0.4,
            ThreatLevel.LOW: 0.1
        }
        
        logger.info(f"[Security] ModuleCodeScanner Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ñ {len(self.suspicious_patterns)} Ñ‚Ğ¸Ğ¿Ğ°Ğ¼Ğ¸ ÑƒĞ³Ñ€Ğ¾Ğ·")
    
    def scan_module(self, module_path: Path) -> ScanResult:
        """Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚ ÑƒĞ³Ñ€Ğ¾Ğ· Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
        try:
            threats = []
            suspicious_patterns = []
            code_metrics = {}
            
            # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
            python_files = list(module_path.rglob("*.py"))
            
            for file_path in python_files:
                file_threats, file_patterns, file_metrics = self._scan_file(file_path)
                threats.extend(file_threats)
                suspicious_patterns.extend(file_patterns)
                
                # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
                for key, value in file_metrics.items():
                    code_metrics[key] = code_metrics.get(key, 0) + value
            
            # Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ Ñ€Ğ¸ÑĞº
            risk_score = self._calculate_risk_score(threats)
            is_safe = risk_score < 30.0  # ĞŸĞ¾Ñ€Ğ¾Ğ³ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
            
            result = ScanResult(
                module_name=module_path.name,
                scan_timestamp=Path(module_path).stat().st_mtime,
                threats_found=threats,
                risk_score=risk_score,
                is_safe=is_safe,
                suspicious_patterns=list(set(suspicious_patterns)),
                code_metrics=code_metrics
            )
            
            logger.info(f"[Security] Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_path.name}: Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ {len(threats)} ÑƒĞ³Ñ€Ğ¾Ğ·, Ñ€Ğ¸ÑĞº {risk_score:.1f}")
            return result
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_path}: {e}")
            return ScanResult(
                module_name=module_path.name,
                scan_timestamp=0,
                threats_found=[],
                risk_score=100.0,  # ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ¸ÑĞº Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
                is_safe=False,
                suspicious_patterns=[],
                code_metrics={}
            )
    
    def _scan_file(self, file_path: Path) -> Tuple[List[SecurityThreat], List[str], Dict[str, any]]:
        """Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»"""
        threats = []
        suspicious_patterns = []
        metrics = {
            "lines_of_code": 0,
            "functions_count": 0,
            "classes_count": 0,
            "imports_count": 0
        }
        
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()
                lines = content.split('\n')
                metrics["lines_of_code"] = len(lines)
            
            # ĞĞ½Ğ°Ğ»Ğ¸Ğ· AST
            try:
                tree = ast.parse(content)
                metrics.update(self._analyze_ast(tree))
            except SyntaxError:
                logger.warning(f"[Security] Ğ¡Ğ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² Ñ„Ğ°Ğ¹Ğ»Ğµ {file_path}")
            
            # ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ²
            for line_num, line in enumerate(lines, 1):
                line_threats, line_patterns = self._analyze_line(line, line_num, file_path)
                threats.extend(line_threats)
                suspicious_patterns.extend(line_patterns)
            
        except Exception as e:
            logger.error(f"[Security] ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° {file_path}: {e}")
        
        return threats, suspicious_patterns, metrics
    
    def _analyze_ast(self, tree: ast.AST) -> Dict[str, int]:
        """ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ AST Ğ´ĞµÑ€ĞµĞ²Ğ¾"""
        metrics = {
            "functions_count": 0,
            "classes_count": 0,
            "imports_count": 0
        }
        
        for node in ast.walk(tree):
            if isinstance(node, ast.FunctionDef):
                metrics["functions_count"] += 1
            elif isinstance(node, ast.ClassDef):
                metrics["classes_count"] += 1
            elif isinstance(node, (ast.Import, ast.ImportFrom)):
                metrics["imports_count"] += 1
        
        return metrics
    
    def _analyze_line(self, line: str, line_num: int, file_path: Path) -> Tuple[List[SecurityThreat], List[str]]:
        """ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½ÑƒÑ ÑÑ‚Ñ€Ğ¾ĞºÑƒ ĞºĞ¾Ğ´Ğ°"""
        threats = []
        patterns = []
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ ÑƒĞ³Ñ€Ğ¾Ğ·
        for threat_type, pattern_list in self.suspicious_patterns.items():
            for pattern in pattern_list:
                if re.search(pattern, line, re.IGNORECASE):
                    threat_level = self._determine_threat_level(threat_type, pattern, line)
                    
                    threat = SecurityThreat(
                        threat_type=threat_type,
                        threat_level=threat_level,
                        file_path=str(file_path),
                        line_number=line_num,
                        code_snippet=line.strip(),
                        description=self._get_threat_description(threat_type),
                        recommendation=self._get_threat_recommendation(threat_type)
                    )
                    
                    threats.append(threat)
                    patterns.append(f"{threat_type.value}: {pattern}")
        
        return threats, patterns
    
    def _determine_threat_level(self, threat_type: ThreatType, pattern: str, line: str) -> ThreatLevel:
        """ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ ÑƒĞ³Ñ€Ğ¾Ğ·Ñ‹"""
        # ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑƒĞ³Ñ€Ğ¾Ğ·Ñ‹
        if threat_type in [ThreatType.CODE_INJECTION, ThreatType.PRIVILEGE_ESCALATION]:
            return ThreatLevel.CRITICAL
        
        # Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğµ ÑƒĞ³Ñ€Ğ¾Ğ·Ñ‹
        if threat_type in [ThreatType.SYSTEM_COMMAND, ThreatType.BACKDOOR]:
            return ThreatLevel.HIGH
        
        # Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğµ ÑƒĞ³Ñ€Ğ¾Ğ·Ñ‹
        if threat_type in [ThreatType.FILE_ACCESS, ThreatType.NETWORK_REQUEST]:
            return ThreatLevel.MEDIUM
        
        # ĞĞ¸Ğ·ĞºĞ¸Ğµ ÑƒĞ³Ñ€Ğ¾Ğ·Ñ‹
        return ThreatLevel.LOW
    
    def _get_threat_description(self, threat_type: ThreatType) -> str:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑƒĞ³Ñ€Ğ¾Ğ·Ñ‹"""
        descriptions = {
            ThreatType.MALICIOUS_IMPORT: "ĞŸĞ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹",
            ThreatType.SYSTEM_COMMAND: "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´",
            ThreatType.FILE_ACCESS: "Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ",
            ThreatType.NETWORK_REQUEST: "Ğ¡ĞµÑ‚ĞµĞ²Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹",
            ThreatType.CODE_INJECTION: "Ğ˜Ğ½ÑŠĞµĞºÑ†Ğ¸Ñ ĞºĞ¾Ğ´Ğ°",
            ThreatType.PRIVILEGE_ESCALATION: "ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ²Ğ¸Ğ»ĞµĞ³Ğ¸Ğ¹",
            ThreatType.DATA_EXFILTRATION: "Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ°Ñ ÑƒÑ‚ĞµÑ‡ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…",
            ThreatType.BACKDOOR: "ĞŸĞ¾Ğ´Ğ¾Ğ·Ñ€ĞµĞ½Ğ¸Ğµ Ğ½Ğ° backdoor",
            ThreatType.CRYPTO_MINING: "ĞŸĞ¾Ğ´Ğ¾Ğ·Ñ€ĞµĞ½Ğ¸Ğµ Ğ½Ğ° ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ¼Ğ°Ğ¹Ğ½Ğ¸Ğ½Ğ³"
        }
        return descriptions.get(threat_type, "ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ ÑƒĞ³Ñ€Ğ¾Ğ·Ğ°")
    
    def _get_threat_recommendation(self, threat_type: ThreatType) -> str:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ÑƒÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ ÑƒĞ³Ñ€Ğ¾Ğ·Ñ‹"""
        recommendations = {
            ThreatType.MALICIOUS_IMPORT: "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹",
            ThreatType.SYSTEM_COMMAND: "Ğ˜Ğ·Ğ±ĞµĞ³Ğ°Ğ¹Ñ‚Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´",
            ThreatType.FILE_ACCESS: "ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ÑŒÑ‚Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ",
            ThreatType.NETWORK_REQUEST: "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ ÑĞµÑ‚ĞµĞ²Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²",
            ThreatType.CODE_INJECTION: "ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ eval() Ğ¸Ğ»Ğ¸ exec()",
            ThreatType.PRIVILEGE_ESCALATION: "ĞĞµ Ğ¿Ñ‹Ñ‚Ğ°Ğ¹Ñ‚ĞµÑÑŒ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ²Ğ¸Ğ»ĞµĞ³Ğ¸Ğ¸",
            ThreatType.DATA_EXFILTRATION: "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…",
            ThreatType.BACKDOOR: "Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ´",
            ThreatType.CRYPTO_MINING: "Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ´, ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ Ğ¼Ğ°Ğ¹Ğ½Ğ¸Ğ½Ğ³Ğ¾Ğ¼"
        }
        return recommendations.get(threat_type, "ĞĞ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ĞµÑÑŒ Ğº Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸")
    
    def _calculate_risk_score(self, threats: List[SecurityThreat]) -> float:
        """Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ Ñ€Ğ¸ÑĞº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        if not threats:
            return 0.0
        
        total_score = 0.0
        total_weight = 0.0
        
        for threat in threats:
            weight = self.threat_weights.get(threat.threat_level, 0.1)
            total_score += weight * 100  # ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ» Ğ·Ğ° ÑƒĞ³Ñ€Ğ¾Ğ·Ñƒ
            total_weight += weight
        
        if total_weight > 0:
            return min(100.0, total_score / total_weight)
        
        return 0.0
    
    def get_scan_summary(self, scan_result: ScanResult) -> Dict[str, any]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞºÑ€Ğ°Ñ‚ĞºĞ¾Ğµ Ñ€ĞµĞ·ÑĞ¼Ğµ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"""
        threat_counts = {}
        for threat in scan_result.threats_found:
            level = threat.threat_level.value
            threat_counts[level] = threat_counts.get(level, 0) + 1
        
        return {
            "module_name": scan_result.module_name,
            "is_safe": scan_result.is_safe,
            "risk_score": scan_result.risk_score,
            "total_threats": len(scan_result.threats_found),
            "threat_counts": threat_counts,
            "suspicious_patterns_count": len(scan_result.suspicious_patterns),
            "code_metrics": scan_result.code_metrics
        }



======================================================================

------------------------------ FILE: Systems/core/security/command_dedup.py ------------------------------
from __future__ import annotations

import time
from typing import Dict, Tuple

from aiogram import BaseMiddleware
from aiogram.types import Update
from loguru import logger


class CommandDedupMiddleware(BaseMiddleware):
    """Middleware, Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒÑÑ‰Ğ°Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¾Ñ‚ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ‡Ğ°Ñ‚Ğ°."""

    def __init__(self, window_seconds: float = 1.5):
        super().__init__()
        self.window_seconds = window_seconds
        self._last_seen: Dict[Tuple[int, str], float] = {}
        self._logger = logger.bind(service="CommandDedupMiddleware")

    def _cleanup(self, now: float) -> None:
        expiration = now - self.window_seconds * 5
        keys_to_remove = [key for key, ts in self._last_seen.items() if ts < expiration]
        for key in keys_to_remove:
            self._last_seen.pop(key, None)

    async def __call__(self, handler, event: Update, data):
        message = getattr(event, "message", None)
        if message and message.text and message.text.strip().startswith("/"):
            chat_id = message.chat.id
            command = message.text.split()[0].split("@")[0].lower()
            now = time.monotonic()
            last_timestamp = self._last_seen.get((chat_id, command))

            if last_timestamp and now - last_timestamp < self.window_seconds:
                self._logger.warning(
                    f"Ğ˜Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒÑ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ '{command}' Ğ¾Ñ‚ Ñ‡Ğ°Ñ‚Ğ° {chat_id} (Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾ {now - last_timestamp:.3f}s)."
                )
                return None

            self._last_seen[(chat_id, command)] = now
            self._cleanup(now)

        return await handler(event, data)




======================================================================

------------------------------ FILE: Systems/core/security/__init__.py ------------------------------
# core/security/__init__.py
"""
SDB Security Module
Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² SDB
"""

from .signature_manager import ModuleSignatureManager
from .sandbox_manager import ModuleSandboxManager
from .audit_logger import SecurityAuditLogger
from .reputation_system import ModuleReputationSystem
from .code_scanner import ModuleCodeScanner
from .security_levels import SecurityLevelManager
from .anomaly_detection import AnomalyDetector

__all__ = [
    "ModuleSignatureManager",
    "ModuleSandboxManager", 
    "SecurityAuditLogger",
    "ModuleReputationSystem",
    "ModuleCodeScanner",
    "SecurityLevelManager",
    "AnomalyDetector"
]



======================================================================

------------------------------ FILE: Systems/core/fsm/storage_factory.py ------------------------------
from __future__ import annotations

from typing import Union, TYPE_CHECKING

from aiogram.fsm.storage.memory import MemoryStorage
from loguru import logger

if TYPE_CHECKING:
    from aiogram.fsm.storage.redis import RedisStorage
    from Systems.core.cache.manager import CacheManager
    from Systems.core.app_settings import CacheSettings


async def build_fsm_storage(
    cache_manager: 'CacheManager',
    cache_settings: 'CacheSettings'
) -> Union[MemoryStorage, 'RedisStorage']:
    """
    Ğ¤Ğ°Ğ±Ñ€Ğ¸ĞºĞ° for FSM storage. ĞŸÑ‹Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ RedisStorage, ĞµÑĞ»Ğ¸ ĞºĞµÑˆ
    Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ ĞºĞ°Ğº redis Ğ¸ Redis ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½; Ğ¸Ğ½Ğ°Ñ‡Ğµ â€” MemoryStorage.
    """
    _logger = logger.bind(service="FSMStorageFactory")

    storage: Union[MemoryStorage, 'RedisStorage']
    if cache_settings.type == "redis":
        _logger.debug("ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ RedisStorage Ğ´Ğ»Ñ FSM.")
        try:
            from aiogram.fsm.storage.redis import RedisStorage

            if not cache_manager.is_available():
                _logger.warning(
                    "CacheManager Ğ¿Ğ¾Ğ¼ĞµÑ‡ĞµĞ½ ĞºĞ°Ğº Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğ¹ â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ MemoryStorage."
                )
            else:
                redis_client = await cache_manager.get_redis_client_instance()
                if redis_client:
                    storage = RedisStorage(redis=redis_client)
                    _logger.info("FSM Storage: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ RedisStorage.")
                    return storage
                _logger.warning(
                    "Redis ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½, Ğ½ĞµÑĞ¼Ğ¾Ñ‚Ñ€Ñ Ğ½Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºÑƒ redis CacheManager."
                )
        except ImportError:
            _logger.warning(
                "RedisStorage Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½, Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¿Ğ°ĞºĞµÑ‚ redis â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ MemoryStorage."
            )
        except Exception as exc:
            _logger.warning(
                f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ RedisStorage (redis_cache): {exc}. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ MemoryStorage."
            )

    storage = MemoryStorage()
    _logger.info("FSM Storage: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ MemoryStorage.")
    return storage




======================================================================

------------------------------ FILE: Systems/core/monitoring/metrics.py ------------------------------
# core/monitoring/metrics.py
"""
Prometheus Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
"""

import time
from typing import Dict, Optional, Any
from collections import defaultdict
from datetime import datetime
from loguru import logger

from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider


class MetricsCollector:
    """
    Ğ¡Ğ±Ğ¾Ñ€Ñ‰Ğ¸Ğº Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ´Ğ»Ñ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ° Ğ² Prometheus
    """
    
    def __init__(self):
        self._logger = logger.bind(service="MetricsCollector")
        
        # Ğ¡Ñ‡ĞµÑ‚Ñ‡Ğ¸ĞºĞ¸
        self._counters: Dict[str, int] = defaultdict(int)
        
        # ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
        self._histograms: Dict[str, list] = defaultdict(list)
        
        # Gauge Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ (Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ)
        self._gauges: Dict[str, float] = defaultdict(float)
        
        # ĞœĞµÑ‚ĞºĞ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
        self._last_update: Dict[str, datetime] = {}
    
    def increment_counter(self, name: str, labels: Optional[Dict[str, str]] = None, value: int = 1):
        """Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸Ğº"""
        key = self._format_key(name, labels)
        self._counters[key] += value
        self._last_update[key] = datetime.now()
    
    def record_histogram(self, name: str, value: float, labels: Optional[Dict[str, str]] = None):
        """Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ² Ğ³Ğ¸ÑÑ‚Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ"""
        key = self._format_key(name, labels)
        self._histograms[key].append(value)
        # Ğ¥Ñ€Ğ°Ğ½Ğ¸Ğ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 1000 Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹
        if len(self._histograms[key]) > 1000:
            self._histograms[key] = self._histograms[key][-1000:]
        self._last_update[key] = datetime.now()
    
    def set_gauge(self, name: str, value: float, labels: Optional[Dict[str, str]] = None):
        """Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ gauge"""
        key = self._format_key(name, labels)
        self._gauges[key] = value
        self._last_update[key] = datetime.now()
    
    def _format_key(self, name: str, labels: Optional[Dict[str, str]]) -> str:
        """Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ»ÑÑ‡ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ñ Ğ»ĞµĞ¹Ğ±Ğ»Ğ°Ğ¼Ğ¸"""
        if not labels:
            return name
        label_str = ",".join(f"{k}={v}" for k, v in sorted(labels.items()))
        return f"{name}{{{label_str}}}"
    
    def get_prometheus_format(self) -> str:
        """
        Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Prometheus
        """
        lines = []
        
        # Counters
        for key, value in self._counters.items():
            lines.append(f"# TYPE {key.split('{')[0]} counter")
            lines.append(f"{key} {value}")
        
        # Gauges
        for key, value in self._gauges.items():
            lines.append(f"# TYPE {key.split('{')[0]} gauge")
            lines.append(f"{key} {value}")
        
        # Histograms (ĞºĞ°Ğº summary)
        for key, values in self._histograms.items():
            if values:
                lines.append(f"# TYPE {key.split('{')[0]} summary")
                lines.append(f"{key}_count {len(values)}")
                lines.append(f"{key}_sum {sum(values)}")
                lines.append(f"{key}_avg {sum(values) / len(values)}")
                if values:
                    sorted_values = sorted(values)
                    lines.append(f"{key}_min {sorted_values[0]}")
                    lines.append(f"{key}_max {sorted_values[-1]}")
        
        return "\n".join(lines) + "\n"
    
    def get_metrics_dict(self) -> Dict:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ² Ğ²Ğ¸Ğ´Ğµ ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ñ"""
        return {
            "counters": dict(self._counters),
            "gauges": dict(self._gauges),
            "histograms": {
                k: {
                    "count": len(v),
                    "sum": sum(v),
                    "avg": sum(v) / len(v) if v else 0,
                    "min": min(v) if v else 0,
                    "max": max(v) if v else 0
                }
                for k, v in self._histograms.items()
            }
        }


class MetricsMiddleware:
    """
    Middleware Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ÑĞ±Ğ¾Ñ€Ğ° Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº
    """
    
    def __init__(self, metrics_collector: MetricsCollector):
        self.metrics = metrics_collector
        self._logger = logger.bind(service="MetricsMiddleware")
    
    async def __call__(self, handler, event, data: Dict):
        """Ğ¡Ğ±Ğ¾Ñ€ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ"""
        start_time = time.time()
        
        # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ‚Ğ¸Ğ¿ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
        event_type = "unknown"
        if hasattr(event, 'message') and event.message:
            event_type = "message"
        elif hasattr(event, 'callback_query') and event.callback_query:
            event_type = "callback"
        elif hasattr(event, 'inline_query') and event.inline_query:
            event_type = "inline_query"
        
        # Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ÑÑ‡ĞµÑ‚Ñ‡Ğ¸Ğº ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
        self.metrics.increment_counter(
            "sdb_events_total",
            labels={"type": event_type}
        )
        
        try:
            result = await handler(event, data)
            
            # Ğ£ÑĞ¿ĞµÑˆĞ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°
            self.metrics.increment_counter(
                "sdb_events_success_total",
                labels={"type": event_type}
            )
            
            return result
        
        except Exception as e:
            # ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
            self.metrics.increment_counter(
                "sdb_events_error_total",
                labels={"type": event_type, "error": type(e).__name__}
            )
            raise
        
        finally:
            # Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
            duration = time.time() - start_time
            self.metrics.record_histogram(
                "sdb_event_duration_seconds",
                duration,
                labels={"type": event_type}
            )


# Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€ ÑĞ±Ğ¾Ñ€Ñ‰Ğ¸ĞºĞ° Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº
_global_metrics_collector: Optional[MetricsCollector] = None


def get_metrics_collector() -> MetricsCollector:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€ ÑĞ±Ğ¾Ñ€Ñ‰Ğ¸ĞºĞ° Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº"""
    global _global_metrics_collector
    if _global_metrics_collector is None:
        _global_metrics_collector = MetricsCollector()
    return _global_metrics_collector




======================================================================

------------------------------ FILE: Systems/core/monitoring/health.py ------------------------------
# core/monitoring/health.py
"""
Health check endpoints Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
"""

import asyncio
from typing import Dict, Optional, List
from datetime import datetime
from loguru import logger

from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider


class HealthStatus:
    """Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°"""
    
    def __init__(self, name: str, status: str, message: str = "", details: Dict = None):
        self.name = name
        self.status = status  # "healthy", "degraded", "unhealthy"
        self.message = message
        self.details = details or {}
        self.timestamp = datetime.now()
    
    def to_dict(self) -> Dict:
        return {
            "name": self.name,
            "status": self.status,
            "message": self.message,
            "details": self.details,
            "timestamp": self.timestamp.isoformat()
        }


class HealthChecker:
    """
    ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²
    """
    
    def __init__(self, services_provider: Optional['BotServicesProvider'] = None):
        self.services = services_provider
        self._logger = logger.bind(service="HealthChecker")
    
    async def check_database(self) -> HealthStatus:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
        try:
            if not self.services or not hasattr(self.services, 'db'):
                return HealthStatus(
                    "database",
                    "unhealthy",
                    "DBManager Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½"
                )
            
            start_time = datetime.now()
            async with self.services.db.get_session() as session:
                # ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ
                from sqlalchemy import text
                result = await session.execute(text("SELECT 1"))
                result.scalar()
            
            duration = (datetime.now() - start_time).total_seconds()
            
            if duration > 1.0:
                return HealthStatus(
                    "database",
                    "degraded",
                    f"ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ‘Ğ”: {duration:.2f}s",
                    {"response_time": duration}
                )
            
            return HealthStatus(
                "database",
                "healthy",
                "Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°",
                {"response_time": duration}
            )
        
        except Exception as e:
            self._logger.error(f"Database health check failed: {e}")
            return HealthStatus(
                "database",
                "unhealthy",
                f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ: {str(e)}"
            )
    
    async def check_cache(self) -> HealthStatus:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ ĞºÑÑˆĞ°"""
        try:
            if not self.services or not hasattr(self.services, 'cache'):
                return HealthStatus(
                    "cache",
                    "unhealthy",
                    "CacheManager Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½"
                )
            
            if not self.services.cache.is_available():
                return HealthStatus(
                    "cache",
                    "unhealthy",
                    "ĞšÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½"
                )
            
            # Ğ¢ĞµÑÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸/Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ
            test_key = "__health_check__"
            test_value = "test"
            
            start_time = datetime.now()
            await self.services.cache.set(test_key, test_value, ttl=10)
            cached_value = await self.services.cache.get(test_key)
            await self.services.cache.delete(test_key)
            duration = (datetime.now() - start_time).total_seconds()
            
            if cached_value != test_value:
                return HealthStatus(
                    "cache",
                    "degraded",
                    "ĞšÑÑˆ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ"
                )
            
            return HealthStatus(
                "cache",
                "healthy",
                "ĞšÑÑˆ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾",
                {"response_time": duration}
            )
        
        except Exception as e:
            self._logger.error(f"Cache health check failed: {e}")
            return HealthStatus(
                "cache",
                "unhealthy",
                f"ĞÑˆĞ¸Ğ±ĞºĞ° ĞºÑÑˆĞ°: {str(e)}"
            )
    
    async def check_telegram_api(self) -> HealthStatus:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚Ğ¸ Telegram API"""
        try:
            if not self.services or not hasattr(self.services, 'bot'):
                return HealthStatus(
                    "telegram_api",
                    "unhealthy",
                    "Bot Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½"
                )
            
            start_time = datetime.now()
            bot_info = await self.services.bot.get_me()
            duration = (datetime.now() - start_time).total_seconds()
            
            return HealthStatus(
                "telegram_api",
                "healthy",
                f"Telegram API Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ (@{bot_info.username})",
                {
                    "bot_id": bot_info.id,
                    "bot_username": bot_info.username,
                    "response_time": duration
                }
            )
        
        except Exception as e:
            self._logger.error(f"Telegram API health check failed: {e}")
            return HealthStatus(
                "telegram_api",
                "unhealthy",
                f"ĞÑˆĞ¸Ğ±ĞºĞ° Telegram API: {str(e)}"
            )
    
    async def check_modules(self) -> HealthStatus:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
        try:
            if not self.services or not hasattr(self.services, 'modules'):
                return HealthStatus(
                    "modules",
                    "unhealthy",
                    "ModuleLoader Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½"
                )
            
            module_loader = self.services.modules
            all_modules = module_loader.get_all_modules_info()
            loaded_modules = [
                m for m in all_modules 
                if m.is_enabled and m.is_loaded_successfully
            ]
            failed_modules = [
                m for m in all_modules 
                if m.is_enabled and not m.is_loaded_successfully and m.error
            ]
            
            total = len(all_modules)
            loaded = len(loaded_modules)
            failed = len(failed_modules)
            
            if failed > 0:
                status = "degraded" if loaded > 0 else "unhealthy"
                message = f"{failed} Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ½Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹"
            else:
                status = "healthy"
                message = f"Ğ’ÑĞµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ ({loaded}/{total})"
            
            return HealthStatus(
                "modules",
                status,
                message,
                {
                    "total": total,
                    "loaded": loaded,
                    "failed": failed,
                    "failed_modules": [m.name for m in failed_modules]
                }
            )
        
        except Exception as e:
            self._logger.error(f"Modules health check failed: {e}")
            return HealthStatus(
                "modules",
                "unhealthy",
                f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹: {str(e)}"
            )
    
    async def check_all(self) -> Dict:
        """
        Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ğ²ÑĞµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ
        
        Returns:
            Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°Ğ¼Ğ¸ Ğ²ÑĞµÑ… Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¾Ğº
        """
        checks = await asyncio.gather(
            self.check_database(),
            self.check_cache(),
            self.check_telegram_api(),
            self.check_modules(),
            return_exceptions=True
        )
        
        results = {}
        overall_status = "healthy"
        
        for check in checks:
            if isinstance(check, Exception):
                self._logger.error(f"Health check exception: {check}")
                continue
            
            if isinstance(check, HealthStatus):
                results[check.name] = check.to_dict()
                
                # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ
                if check.status == "unhealthy":
                    overall_status = "unhealthy"
                elif check.status == "degraded" and overall_status == "healthy":
                    overall_status = "degraded"
        
        return {
            "status": overall_status,
            "timestamp": datetime.now().isoformat(),
            "checks": results
        }
    
    async def get_health_summary(self) -> Dict:
        """ĞšÑ€Ğ°Ñ‚ĞºĞ°Ñ ÑĞ²Ğ¾Ğ´ĞºĞ° Ğ¾ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹"""
        health_data = await self.check_all()
        
        return {
            "status": health_data["status"],
            "timestamp": health_data["timestamp"],
            "checks_count": len(health_data["checks"]),
            "healthy_count": sum(
                1 for c in health_data["checks"].values() 
                if c["status"] == "healthy"
            ),
            "degraded_count": sum(
                1 for c in health_data["checks"].values() 
                if c["status"] == "degraded"
            ),
            "unhealthy_count": sum(
                1 for c in health_data["checks"].values() 
                if c["status"] == "unhealthy"
            )
        }




======================================================================

------------------------------ FILE: Systems/core/monitoring/__init__.py ------------------------------
# core/monitoring/__init__.py
"""
ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº
"""

from .metrics import MetricsCollector, MetricsMiddleware, get_metrics_collector
from .health import HealthChecker, HealthStatus

__all__ = [
    "MetricsCollector",
    "MetricsMiddleware",
    "get_metrics_collector",
    "HealthChecker",
    "HealthStatus"
]




======================================================================

------------------------------ FILE: Systems/core/http_client/manager.py ------------------------------
# core/http_client/manager.py

import asyncio
from typing import Optional, Dict, Any, Union, TYPE_CHECKING

try:
    import aiohttp
    from aiohttp import ClientSession, ClientTimeout, ClientResponse, ClientResponseError, ClientError
    from aiohttp import ServerTimeoutError as AiohttpTimeoutError
except ImportError:
    aiohttp = None # type: ignore
    ClientSession = Any # type: ignore
    ClientTimeout = Any # type: ignore
    ClientResponse = Any # type: ignore
    ClientResponseError = Any # type: ignore
    ClientError = Any # type: ignore
    AiohttpTimeoutError = Any # type: ignore

from loguru import logger

if TYPE_CHECKING:
    from Systems.core.app_settings import AppSettings


class HTTPClientManager:
    def __init__(self, default_timeout_seconds: int = 10, app_settings: Optional['AppSettings'] = None):
        if not aiohttp:
            msg = ("Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° aiohttp Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ ĞµĞµ (`pip install aiohttp`). "
                   "HTTPClientManager Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ.")
            logger.critical(msg)
            raise ImportError(msg)
            
        self._session: Optional[ClientSession] = None
        self._default_timeout_config = ClientTimeout(total=default_timeout_seconds) 
        self._app_settings: Optional['AppSettings'] = app_settings 
        self._is_initialized_successfully = False
        logger.info(f"HTTPClientManager Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ (Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: {default_timeout_seconds} ÑĞµĞº).")

    async def initialize(self) -> None:
        if self._session is None or self._session.closed:
            try:
                self._session = ClientSession(timeout=self._default_timeout_config)
                self._is_initialized_successfully = True
                logger.success("aiohttp.ClientSession ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ğ¸ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
            except Exception as e:
                logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ aiohttp.ClientSession: {e}", exc_info=True)
                self._session = None
                self._is_initialized_successfully = False
                raise 
        else:
            logger.debug("aiohttp.ClientSession ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ» Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")

    async def dispose(self) -> None:
        if self._session and not self._session.closed:
            try:
                await self._session.close()
                logger.info("aiohttp.ClientSession ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚.")
            except Exception as e:
                logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ aiohttp.ClientSession: {e}", exc_info=True)
        self._session = None
        self._is_initialized_successfully = False

    def is_available(self) -> bool:
        return self._session is not None and not self._session.closed and self._is_initialized_successfully

    def _get_session(self) -> ClientSession:
        if not self.is_available():
            msg = "HTTPClientManager (aiohttp.ClientSession) Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ¸Ğ»Ğ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚! Ğ’Ñ‹Ğ·Ğ¾Ğ²Ğ¸Ñ‚Ğµ initialize()."
            logger.critical(msg)
            raise RuntimeError(msg)
        return self._session # type: ignore 

    async def request(
        self,
        method: str,
        url: str,
        params: Optional[Dict[str, Any]] = None,
        data: Optional[Any] = None,
        json_data: Optional[Any] = None,
        headers: Optional[Dict[str, str]] = None,
        timeout_seconds: Optional[int] = None,
        raise_for_status: bool = False 
    ) -> Optional[ClientResponse]:
        session = self._get_session()
        current_timeout_config = ClientTimeout(total=timeout_seconds) if timeout_seconds is not None else self._default_timeout_config
        
        request_kwargs = {
            "params": params, "data": data, "json": json_data,
            "headers": headers, "timeout": current_timeout_config,
        }
        active_request_kwargs = {k: v for k, v in request_kwargs.items() if v is not None}

        log_context = {"method": method.upper(), "url": url, "params": params, "json_body": json_data is not None}
        logger.debug(f"HTTP Request: {method.upper()} {url}", **log_context)
        
        try:
            async with session.request(method, url, **active_request_kwargs) as response:
                logger.debug(f"HTTP Response: Status {response.status} for {url}", 
                             **log_context, status_code=response.status)
                if raise_for_status:
                    response.raise_for_status() 
                return response
        except ClientResponseError as e: 
            logger.warning(f"HTTP ClientResponseError: {e.status} {e.message} for {url}", **log_context)
            raise 
        except (asyncio.TimeoutError, AiohttpTimeoutError) as e:
            logger.warning(f"HTTP TimeoutError for {url} (timeout: {current_timeout_config.total}s): {type(e).__name__}", **log_context)
            raise 
        except ClientError as e: 
            logger.error(f"HTTP ClientError for {url}: {e}", **log_context, exc_info=True)
            raise 
        except Exception as e: 
            logger.error(f"Unexpected HTTP Error during request to {url}: {e}", **log_context, exc_info=True)
            raise


    async def get_json(
        self, url: str, params: Optional[Dict[str, Any]] = None, 
        headers: Optional[Dict[str, str]] = None, timeout_seconds: Optional[int] = None,
        default_on_error: Optional[Any] = None 
    ) -> Optional[Any]:
        response: Optional[ClientResponse] = None
        try:
            response = await self.request("GET", url, params=params, headers=headers, 
                                          timeout_seconds=timeout_seconds, raise_for_status=True)
            if response: 
                return await response.json()
            return default_on_error 
        except (ClientResponseError, asyncio.TimeoutError, AiohttpTimeoutError, ClientError) as e:
            logger.warning(f"HTTP(S) error during get_json for {url}: {type(e).__name__} - {e}")
            if default_on_error is not None: return default_on_error
            raise
        except aiohttp.ContentTypeError as e_json: 
            logger.warning(f"Failed to decode JSON response from {url}: {e_json}")
            if response: logger.trace(f"Response text (JSON error): {(await response.text())[:200]}")
            if default_on_error is not None: return default_on_error
            raise
        except Exception as e_unexp: 
            logger.error(f"Unexpected error in get_json for {url}: {e_unexp}", exc_info=True)
            if default_on_error is not None: return default_on_error
            raise


    async def post_json_response(
        self, url: str, json_data: Optional[Any] = None, params: Optional[Dict[str, Any]] = None,
        headers: Optional[Dict[str, str]] = None, timeout_seconds: Optional[int] = None,
        default_on_error: Optional[Any] = None 
    ) -> Optional[Any]:
        response: Optional[ClientResponse] = None
        try:
            response = await self.request("POST", url, params=params, json_data=json_data, headers=headers,
                                          timeout_seconds=timeout_seconds, raise_for_status=True)
            if response:
                return await response.json()
            return default_on_error
        except (ClientResponseError, asyncio.TimeoutError, AiohttpTimeoutError, ClientError) as e:
            logger.warning(f"HTTP(S) error during post_json for {url}: {type(e).__name__} - {e}")
            if default_on_error is not None: return default_on_error
            raise
        except aiohttp.ContentTypeError as e_json:
            logger.warning(f"Failed to decode JSON response from {url} after POST: {e_json}")
            if response: logger.trace(f"Response text (JSON error): {(await response.text())[:200]}")
            if default_on_error is not None: return default_on_error
            raise
        except Exception as e_unexp:
            logger.error(f"Unexpected error in post_json for {url}: {e_unexp}", exc_info=True)
            if default_on_error is not None: return default_on_error
            raise


======================================================================

------------------------------ FILE: Systems/core/http_client/retry.py ------------------------------
# core/http_client/retry.py
"""
Retry Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ğ¸ Circuit Breaker Ğ´Ğ»Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… API
"""

import asyncio
import time
from enum import Enum
from typing import Optional, Callable, Any, Dict
from datetime import datetime, timedelta
from loguru import logger

import aiohttp
from aiohttp import ClientError, ClientResponseError


class CircuitState(Enum):
    """Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Circuit Breaker"""
    CLOSED = "closed"      # ĞĞ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°
    OPEN = "open"          # Ğ¦ĞµĞ¿ÑŒ Ñ€Ğ°Ğ·Ğ¾Ğ¼ĞºĞ½ÑƒÑ‚Ğ°, Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒÑÑ‚ÑÑ
    HALF_OPEN = "half_open"  # Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼


class CircuitBreaker:
    """
    Circuit Breaker Ğ´Ğ»Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ¾Ñ‚ Ğ½ĞµÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
    """
    
    def __init__(
        self,
        failure_threshold: int = 5,
        recovery_timeout: int = 60,
        expected_exception: type = Exception
    ):
        """
        Args:
            failure_threshold: ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ´Ğ¾ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Ñ†ĞµĞ¿Ğ¸
            recovery_timeout: Ğ’Ñ€ĞµĞ¼Ñ Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ… Ğ´Ğ¾ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
            expected_exception: Ğ¢Ğ¸Ğ¿ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğµ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹
        """
        self.failure_threshold = failure_threshold
        self.recovery_timeout = recovery_timeout
        self.expected_exception = expected_exception
        
        self.state = CircuitState.CLOSED
        self.failure_count = 0
        self.last_failure_time: Optional[datetime] = None
        self.success_count = 0
        self._logger = logger.bind(service="CircuitBreaker")
    
    def call(self, func: Callable, *args, **kwargs) -> Any:
        """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· circuit breaker"""
        if self.state == CircuitState.OPEN:
            if self._should_attempt_reset():
                self.state = CircuitState.HALF_OPEN
                self._logger.info("Circuit breaker Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² HALF_OPEN ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ")
            else:
                raise Exception(f"Circuit breaker OPEN. ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· {self.recovery_timeout} ÑĞµĞºÑƒĞ½Ğ´")
        
        try:
            result = func(*args, **kwargs)
            self._on_success()
            return result
        except self.expected_exception as e:
            self._on_failure()
            raise
    
    async def call_async(self, func: Callable, *args, **kwargs) -> Any:
        """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ call"""
        if self.state == CircuitState.OPEN:
            if self._should_attempt_reset():
                self.state = CircuitState.HALF_OPEN
                self._logger.info("Circuit breaker Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² HALF_OPEN ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ")
            else:
                raise Exception(f"Circuit breaker OPEN. ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· {self.recovery_timeout} ÑĞµĞºÑƒĞ½Ğ´")
        
        try:
            result = await func(*args, **kwargs)
            self._on_success()
            return result
        except self.expected_exception as e:
            self._on_failure()
            raise
    
    def _on_success(self):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°"""
        self.failure_count = 0
        if self.state == CircuitState.HALF_OPEN:
            self.success_count += 1
            if self.success_count >= 2:  # ĞÑƒĞ¶Ğ½Ğ¾ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
                self.state = CircuitState.CLOSED
                self.success_count = 0
                self._logger.info("Circuit breaker Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ (CLOSED)")
    
    def _on_failure(self):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸"""
        self.failure_count += 1
        self.last_failure_time = datetime.now()
        
        if self.state == CircuitState.HALF_OPEN:
            self.state = CircuitState.OPEN
            self._logger.warning("Circuit breaker ÑĞ½Ğ¾Ğ²Ğ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ Ğ¿Ğ¾ÑĞ»Ğµ Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ")
        elif self.failure_count >= self.failure_threshold:
            self.state = CircuitState.OPEN
            self._logger.error(
                f"Circuit breaker Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ Ğ¿Ğ¾ÑĞ»Ğµ {self.failure_count} Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº. "
                f"Ğ‘ÑƒĞ´ÑƒÑ‚ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ½Ğ° {self.recovery_timeout} ÑĞµĞºÑƒĞ½Ğ´"
            )
    
    def _should_attempt_reset(self) -> bool:
        """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ°Ñ‚ÑŒÑÑ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ"""
        if not self.last_failure_time:
            return True
        return (datetime.now() - self.last_failure_time).total_seconds() >= self.recovery_timeout
    
    def reset(self):
        """ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ±Ñ€Ğ¾Ñ circuit breaker"""
        self.state = CircuitState.CLOSED
        self.failure_count = 0
        self.success_count = 0
        self.last_failure_time = None
        self._logger.info("Circuit breaker Ğ¿Ñ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½")


class RetryConfig:
    """ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ retry Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼Ğ°"""
    
    def __init__(
        self,
        max_attempts: int = 3,
        initial_delay: float = 1.0,
        max_delay: float = 60.0,
        exponential_base: float = 2.0,
        jitter: bool = True,
        retry_on: tuple = (ClientError, ClientResponseError)
    ):
        self.max_attempts = max_attempts
        self.initial_delay = initial_delay
        self.max_delay = max_delay
        self.exponential_base = exponential_base
        self.jitter = jitter
        self.retry_on = retry_on


async def retry_with_backoff(
    func: Callable,
    *args,
    config: Optional[RetryConfig] = None,
    circuit_breaker: Optional[CircuitBreaker] = None,
    **kwargs
) -> Any:
    """
    Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ°Ğ¼Ğ¸ Ğ¸ ÑĞºÑĞ¿Ğ¾Ğ½ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹
    
    Args:
        func: ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
        config: ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ retry
        circuit_breaker: ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ circuit breaker
        *args, **kwargs: ĞÑ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
    
    Returns:
        Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
    """
    if config is None:
        config = RetryConfig()
    
    last_exception = None
    
    for attempt in range(config.max_attempts):
        try:
            if circuit_breaker:
                result = await circuit_breaker.call_async(func, *args, **kwargs)
            else:
                result = await func(*args, **kwargs)
            return result
        
        except config.retry_on as e:
            last_exception = e
            
            if attempt == config.max_attempts - 1:
                # ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ°, Ğ²Ñ‹Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ
                logger.error(f"Ğ’ÑĞµ {config.max_attempts} Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Ğ¸ÑÑ‡ĞµÑ€Ğ¿Ğ°Ğ½Ñ‹. ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: {e}")
                raise
            
            # Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºÑƒ
            delay = min(
                config.initial_delay * (config.exponential_base ** attempt),
                config.max_delay
            )
            
            if config.jitter:
                import random
                delay = delay * (0.5 + random.random() * 0.5)
            
            logger.warning(
                f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° {attempt + 1}/{config.max_attempts} Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ°ÑÑŒ: {e}. "
                f"ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ Ñ‡ĞµÑ€ĞµĞ· {delay:.2f} ÑĞµĞºÑƒĞ½Ğ´"
            )
            
            await asyncio.sleep(delay)
        
        except Exception as e:
            # ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ, Ğ½Ğµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞµĞ¼
            logger.error(f"ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ² retry: {e}")
            raise
    
    # ĞĞµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ´Ğ¾ÑÑ‚Ğ¸Ñ‡ÑŒ ÑÑĞ´Ğ°, Ğ½Ğ¾ Ğ½Ğ° Ğ²ÑÑĞºĞ¸Ğ¹ ÑĞ»ÑƒÑ‡Ğ°Ğ¹
    if last_exception:
        raise last_exception
    raise Exception("Retry Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»ÑÑ Ğ½ĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ¾")




======================================================================

------------------------------ FILE: Systems/core/http_client/__init__.py ------------------------------



======================================================================

------------------------------ FILE: Systems/core/schemas/module_manifest.py ------------------------------
# core/schemas/module_manifest.py

from typing import List, Optional, Dict, Any, Union, Literal
from pydantic import BaseModel, Field, field_validator, HttpUrl, ValidationInfo
import re
from loguru import logger 


class CommandManifest(BaseModel):
    command: str = Field(..., description="Ğ¡Ğ°Ğ¼Ğ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° (Ğ±ĞµĞ· '/'). ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 'weather'.")
    description: str = Field(..., description="ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ´Ğ»Ñ /help).")
    icon: Optional[str] = Field(default=None, description="Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸-Ğ¸ĞºĞ¾Ğ½ĞºĞ° Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾).")
    category: Optional[str] = Field(default=None, description="ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾).")
    admin_only: bool = Field(default=False, alias="admin", description="Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ»Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ¿Ñ€Ğ°Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°.")

class SettingChoiceOption(BaseModel):
    value: Any
    display_name: str

class SettingManifest(BaseModel):
    type: Literal["string", "int", "float", "bool", "choice", "multichoice", "text"] = Field(
        description="Ğ¢Ğ¸Ğ¿ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸."
    )
    label: str = Field(..., description="Ğ§ĞµĞ»Ğ¾Ğ²ĞµĞºĞ¾Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ğ¾Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ (Ğ´Ğ»Ñ UI).")
    description: Optional[str] = Field(default=None, description="ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ (Ğ´Ğ»Ñ UI).")
    default: Optional[Any] = Field(default=None, description="Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ. ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾, ĞµÑĞ»Ğ¸ required=True Ğ¸ Ğ½ĞµÑ‚ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğµ.")
    required: bool = Field(default=False, description="Ğ¯Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹.")
    options: Optional[List[Union[str, int, float, SettingChoiceOption]]] = Field(
        default=None,
        description="Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ¾Ğ²."
    )
    min_value: Optional[Union[int, float]] = Field(default=None, alias="min", description="ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ´Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ.")
    max_value: Optional[Union[int, float]] = Field(default=None, alias="max", description="ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ´Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ.")
    regex_validator: Optional[str] = Field(default=None, description="Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾Ğµ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞ¸.")

    @field_validator('options', mode='before')
    @classmethod
    def _check_options_for_choice_type(cls, v: Optional[List[Any]], info: ValidationInfo) -> Optional[List[Any]]:
        setting_type = info.data.get('type') if info.data else None
        if setting_type in ["choice", "multichoice"] and (v is None or not v):
            raise ValueError(f"ĞŸĞ¾Ğ»Ğµ 'options' Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ '{setting_type}'")
        if setting_type not in ["choice", "multichoice"] and v is not None:
            logger.warning(f"ĞŸĞ¾Ğ»Ğµ 'options' Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ğ¼Ğ¾ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ 'choice'/'multichoice', Ğ½Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾ Ğ´Ğ»Ñ '{setting_type}'.")
        return v

    @field_validator('min_value', 'max_value', mode='before')
    @classmethod
    def _check_min_max_for_numeric_type(cls, v: Optional[Union[int, float]], info: ValidationInfo) -> Optional[Union[int, float]]:
        setting_type = info.data.get('type') if info.data else None
        field_name = info.field_name 
        if setting_type not in ["int", "float"] and v is not None:
            logger.warning(f"ĞŸĞ¾Ğ»Ğµ '{field_name}' Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ğ¼Ğ¾ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ 'int'/'float', Ğ½Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾ Ğ´Ğ»Ñ '{setting_type}'.")
        return v

    @field_validator('regex_validator', mode='before')
    @classmethod
    def _check_regex_for_string_type(cls, v: Optional[str], info: ValidationInfo) -> Optional[str]:
        setting_type = info.data.get('type') if info.data else None
        if setting_type != "string" and v is not None:
            logger.warning(f"ĞŸĞ¾Ğ»Ğµ 'regex_validator' Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ğ¼Ğ¾ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ 'string', Ğ½Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾ Ğ´Ğ»Ñ '{setting_type}'.")
        if v is not None:
            try: re.compile(v)
            except re.error as e: raise ValueError(f"ĞĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ regex Ğ² 'regex_validator': {e}")
        return v

    @field_validator('default', mode='after') 
    @classmethod
    def _check_default_for_required(cls, v: Optional[Any], info: ValidationInfo) -> Optional[Any]:
        if info.data.get('required') and v is None:
             field_label = info.data.get('label', 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°') 
             raise ValueError(f"Ğ”Ğ»Ñ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ '{field_label}' (required=True) Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ 'default' Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ.")
        return v

class PermissionManifest(BaseModel): 
    name: str = Field(..., description="Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ¼Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 'my_module.can_edit_items'). Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ 'module_name.permission_key'.")
    description: str = Field(..., description="Ğ§ĞµĞ»Ğ¾Ğ²ĞµĞºĞ¾Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ.")

    @field_validator('name')
    @classmethod
    def _validate_permission_name_format(cls, v: str, info: ValidationInfo) -> str:
        if not re.fullmatch(r"^[a-z0-9_]+(\.[a-z0-9_]+)+$", v.lower()):
            raise ValueError(f"Ğ˜Ğ¼Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ '{v}' Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ 'module_name.permission_key' "
                             f"(Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 'example_module.view_data') Ğ¸ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ñ€Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ±ÑƒĞºĞ²Ñ‹, Ñ†Ğ¸Ñ„Ñ€Ñ‹, '_' Ğ¸ '.'")
        return v.lower() 


class BackgroundTaskManifest(BaseModel):
    entry_point: str = Field(...)
    schedule: Optional[str] = Field(default=None)
    description: Optional[str] = Field(default=None)

class ModuleMetadata(BaseModel):
    homepage: Optional[HttpUrl] = Field(default=None)
    license: Optional[str] = Field(default=None)
    tags: List[str] = Field(default_factory=list)
    min_sdb_core_version: Optional[str] = Field(default=None)
    assign_default_access_to_user_role: bool = Field( # <--- ĞĞĞ’ĞĞ• ĞŸĞĞ›Ğ•
        default=False,
        alias="public_access",  # ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ Ğ°Ğ»Ğ¸Ğ°Ñ Ğ´Ğ»Ñ ÑƒĞ´Ğ¾Ğ±ÑÑ‚Ğ²Ğ°
        description="Ğ•ÑĞ»Ğ¸ true, Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{module_name}.access_user_features' Ğ±ÑƒĞ´ĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¾ Ñ€Ğ¾Ğ»Ğ¸ 'User'. ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾Ğµ Ğ¸Ğ¼Ñ 'public_access'."
    )
    
    model_config = {"populate_by_name": True}  # ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ¼Ñ, Ğ¸ Ğ°Ğ»Ğ¸Ğ°Ñ

    @field_validator('min_sdb_core_version', mode='before')
    @classmethod
    def _validate_semver_format(cls, v: Optional[str]) -> Optional[str]:
        if v is not None:
            semver_regex = r"^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$"
            if not re.fullmatch(semver_regex, v):
                raise ValueError(f"min_sdb_core_version ('{v}') Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ SemVer")
        return v

class ModuleManifest(BaseModel):
    model_config = {"protected_namespaces": ()}
    
    name: str = Field(..., min_length=3, pattern=r'^[a-z][a-z0-9_]*[a-z0-9]$')
    display_name: str = Field(..., min_length=3)
    version: str = Field(...)
    description: Optional[str] = Field(default=None)
    author: Optional[str] = Field(default=None)
    
    python_requirements: List[str] = Field(default_factory=list)
    sdb_module_dependencies: List[str] = Field(default_factory=list)
    model_definitions: List[str] = Field(default_factory=list)
    commands: List[CommandManifest] = Field(default_factory=list)
    settings: Dict[str, SettingManifest] = Field(default_factory=dict) 
    declared_permissions: List[PermissionManifest] = Field(default_factory=list, alias="permissions")
    background_tasks: Dict[str, BackgroundTaskManifest] = Field(default_factory=dict)
    metadata: ModuleMetadata = Field(default_factory=ModuleMetadata) # <--- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ: metadata Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ½Ğµ Optional, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ±Ñ‹Ğ»Ğ¾ Ğ¿Ğ¾Ğ»Ğµ assign_default_access_to_user_role

    @field_validator('version', mode='before')
    @classmethod
    def _validate_module_version_format(cls, v: str) -> str:
        semver_regex = r"^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$"
        if not re.fullmatch(semver_regex, v):
            raise ValueError(f"Ğ’ĞµÑ€ÑĞ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ ('{v}') Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñƒ SemVer 2.0.0")
        return v

    @field_validator('name', mode='before')
    @classmethod
    def _validate_module_name(cls, v: str) -> str:
        if not v.islower() and "_" not in v: 
            if v.lower() != v: 
                 logger.warning(f"Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{v}' ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ·Ğ°Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğµ Ğ±ÑƒĞºĞ²Ñ‹. Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ snake_case.")
        return v
        
    @field_validator('declared_permissions') 
    @classmethod
    def _validate_permission_names_match_module(cls, v: List[PermissionManifest], info: ValidationInfo) -> List[PermissionManifest]:
        module_name = info.data.get('name') 
        if module_name:
            for perm_manifest in v:
                if not perm_manifest.name.startswith(f"{module_name}."):
                    raise ValueError(
                        f"Ğ˜Ğ¼Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ '{perm_manifest.name}' Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ '{module_name}' "
                        f"Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ‚ÑŒÑÑ Ñ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ° '{module_name}.'"
                    )
        return v

    model_config = {
        "extra": "forbid",
        "protected_namespaces": (),
        "validate_assignment": True,
        "populate_by_name": True
    }


======================================================================

------------------------------ FILE: Systems/core/i18n/translator.py ------------------------------
# core/i18n/translator.py

import yaml
from pathlib import Path
from typing import Dict, List, Optional, Any
from loguru import logger

class Translator:
    """
    Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°Ğ¼Ğ¸ (Ğ»Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹) ÑÑ‚Ñ€Ğ¾Ğº.
    Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ YAML Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ².
    Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: key = value Ğ² YAML Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ….
    """
    def __init__(
        self,
        locales_dir: Path,
        domain: str = "bot",  # Ğ˜Ğ¼Ñ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² (Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ YAML, Ğ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ´Ğ»Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸)
        default_locale: str = "ru",
        available_locales: Optional[List[str]] = None,
    ):
        """
        Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚Ñ€Ğ°Ğ½ÑĞ»ÑÑ‚Ğ¾Ñ€.

        Args:
            locales_dir: ĞŸÑƒÑ‚ÑŒ Ğº Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ 'locales' (Ğ³Ğ´Ğµ Ğ»ĞµĞ¶Ğ°Ñ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹ en.yaml, uk.yaml, ru.yaml).
            domain: Ğ˜Ğ¼Ñ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² (Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ YAML, Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ´Ğ»Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸).
            default_locale: Ğ¯Ğ·Ñ‹Ğº Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ, ĞµÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´ Ğ´Ğ»Ñ ÑĞ·Ñ‹ĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.
            available_locales: Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ñ… ÑĞ·Ñ‹ĞºĞ¾Ğ² (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, ['en', 'uk', 'ru']).
                               Ğ•ÑĞ»Ğ¸ None, Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ· YAML Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ² locales_dir.
        """
        self.locales_dir = locales_dir
        self.domain = domain
        self.default_locale = default_locale
        self._translations: Dict[str, Dict[str, str]] = {} # ĞšÑÑˆ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ²: {locale: {key: value}}

        if available_locales:
            self.available_locales = available_locales
        else:
            # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ ÑĞ·Ñ‹ĞºĞ¸ Ğ¿Ğ¾ YAML Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼ Ğ² locales_dir
            self.available_locales = []
            if self.locales_dir.is_dir():
                for item in self.locales_dir.iterdir():
                    if item.is_file() and item.suffix == ".yaml":
                        locale_name = item.stem  # Ğ˜Ğ¼Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ±ĞµĞ· Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ (en, uk, ru)
                        self.available_locales.append(locale_name)
            if not self.available_locales:
                 logger.warning(f"ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ YAML Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² Ğ² {self.locales_dir}. "
                                f"Ğ›Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ.")
            elif default_locale not in self.available_locales and self.available_locales:
                logger.warning(f"Ğ¯Ğ·Ñ‹Ğº Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ '{default_locale}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ ÑÑ€ĞµĞ´Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ…: {self.available_locales}. "
                               f"Ğ‘ÑƒĞ´ĞµÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº.")
        
        logger.info(f"Translator Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½. Locales dir: '{self.locales_dir}', Domain: '{self.domain}', "
                    f"Default: '{self.default_locale}', Available: {self.available_locales}")
        
        # ĞŸÑ€ĞµĞ´Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ²
        self.load_all_translations()


    def load_translation(self, locale: str) -> Optional[Dict[str, str]]:
        """Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ¸Ğ»Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¸Ğ· ĞºÑÑˆĞ° ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² Ğ´Ğ»Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ ÑĞ·Ñ‹ĞºĞ°."""
        if locale in self._translations:
            return self._translations[locale]
        
        if locale not in self.available_locales:
            logger.trace(f"Ğ¯Ğ·Ñ‹Ğº '{locale}' Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ Ğ½ĞµĞ³Ğ¾ Ğ½ĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°.")
            return None

        try:
            # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ YAML Ñ„Ğ°Ğ¹Ğ» Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°Ğ¼Ğ¸
            yaml_file = self.locales_dir / f"{locale}.yaml"
            if not yaml_file.exists():
                logger.warning(f"Ğ¤Ğ°Ğ¹Ğ» Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° '{yaml_file}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.")
                # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº
                if locale != self.default_locale:
                    return self.load_translation(self.default_locale)
                return None
            
            with open(yaml_file, 'r', encoding='utf-8') as f:
                translations = yaml.safe_load(f) or {}
            
            # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ "key = value" Ğ² ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ, ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
            # Ğ•ÑĞ»Ğ¸ YAML ÑƒĞ¶Ğµ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ñ, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ĞµĞ³Ğ¾ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ
            if isinstance(translations, dict):
                self._translations[locale] = translations
                logger.debug(f"ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ ÑĞ·Ñ‹ĞºĞ° '{locale}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ ({len(translations)} ĞºĞ»ÑÑ‡ĞµĞ¹).")
                return translations
            else:
                logger.warning(f"ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° '{yaml_file}'. ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ÑÑ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ.")
                return None
                
        except Exception as e:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ ÑĞ·Ñ‹ĞºĞ° '{locale}': {e}", exc_info=True)
            # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
            if locale != self.default_locale:
                return self.load_translation(self.default_locale)
            return None

    def load_all_translations(self) -> None:
        """ĞŸÑ€ĞµĞ´Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ²ÑĞµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹."""
        logger.info(f"ĞŸÑ€ĞµĞ´Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ²ÑĞµÑ… Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² ({self.available_locales})...")
        for lang in self.available_locales:
            self.load_translation(lang)
        logger.info(f"Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² Ğ´Ğ»Ñ {len(self._translations)} ÑĞ·Ñ‹ĞºĞ¾Ğ².")

    def gettext(self, message_key: str, locale: str, **kwargs: Any) -> str:
        """
        ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´ĞµĞ½Ğ½ÑƒÑ ÑÑ‚Ñ€Ğ¾ĞºÑƒ Ğ¿Ğ¾ ĞºĞ»ÑÑ‡Ñƒ Ğ´Ğ»Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ ÑĞ·Ñ‹ĞºĞ°.
        ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ kwargs.

        Args:
            message_key: ĞšĞ»ÑÑ‡ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "main_menu_title")
            locale: ĞšĞ¾Ğ´ ÑĞ·Ñ‹ĞºĞ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "en", "uk", "ru")
            **kwargs: ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ´Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ¸

        Returns:
            ĞŸĞµÑ€ĞµĞ²ĞµĞ´ĞµĞ½Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ¸Ğ»Ğ¸ ÑĞ°Ğ¼ ĞºĞ»ÑÑ‡, ĞµÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½
        """
        # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ ÑĞ·Ñ‹ĞºĞ°
        translations = self._translations.get(locale)
        if not translations:
            translations = self.load_translation(locale)
        
        # Ğ•ÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½, Ğ¿Ñ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº
        if not translations or message_key not in translations:
            if locale != self.default_locale:
                default_translations = self._translations.get(self.default_locale)
                if not default_translations:
                    default_translations = self.load_translation(self.default_locale)
                if default_translations and message_key in default_translations:
                    translations = default_translations
                    logger.trace(f"Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´ Ğ¸Ğ· Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ·Ñ‹ĞºĞ° '{self.default_locale}' Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{message_key}'")
        
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚
        if translations and message_key in translations:
            translated_text = translations[message_key]
        else:
            # Ğ•ÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ ĞºĞ»ÑÑ‡
            logger.warning(f"ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{message_key}' (locale: {locale}). Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ÑÑ ĞºĞ»ÑÑ‡.")
            translated_text = message_key

        try:
            # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ kwargs
            return translated_text.format(**kwargs) if kwargs else translated_text
        except (KeyError, IndexError) as e_format:
            logger.warning(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{message_key}' (locale: {locale}): {e_format}. "
                           f"ĞŸĞµÑ€ĞµĞ²ĞµĞ´ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚: '{translated_text}', kwargs: {kwargs}")
            return translated_text # Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ½ĞµÑ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚ Ğ² ÑĞ»ÑƒÑ‡Ğ°Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸

    def ngettext(self, singular_key: str, plural_key: str, count: int, locale: str, **kwargs: Any) -> str:
        """
        ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´ĞµĞ½Ğ½ÑƒÑ ÑÑ‚Ñ€Ğ¾ĞºÑƒ Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°.
        
        Args:
            singular_key: ĞšĞ»ÑÑ‡ Ğ´Ğ»Ñ ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°
            plural_key: ĞšĞ»ÑÑ‡ Ğ´Ğ»Ñ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°
            count: ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ñ„Ğ¾Ñ€Ğ¼Ñ‹
            locale: ĞšĞ¾Ğ´ ÑĞ·Ñ‹ĞºĞ°
            **kwargs: ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ´Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ¸
            
        Returns:
            ĞŸĞµÑ€ĞµĞ²ĞµĞ´ĞµĞ½Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ñ‡Ğ¸ÑĞ»Ğ°
        """
        # Ğ”Ğ»Ñ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ singular_key ĞµÑĞ»Ğ¸ count == 1, Ğ¸Ğ½Ğ°Ñ‡Ğµ plural_key
        # Ğ’ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¼ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ» Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ° Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ÑĞ·Ñ‹ĞºĞ¾Ğ²
        key_to_use = singular_key if count == 1 else plural_key
        
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ count Ğ² kwargs Ğ´Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
        format_kwargs = {**kwargs, 'count': count}
        
        return self.gettext(key_to_use, locale, **format_kwargs)

    # ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² Ğ´Ğ»Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ,
    # ĞµÑĞ»Ğ¸ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ·Ğ²ĞµÑÑ‚ĞµĞ½ ÑĞµÑ€Ğ²Ğ¸ÑÑƒ.
    # async def gettext_for_user(self, user_id: int, message_key: str, **kwargs) -> str:
    #     user_locale = await self._get_user_locale(user_id) # ĞÑƒĞ¶ĞµĞ½ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ‘Ğ” Ğ¸Ğ»Ğ¸ ĞºÑÑˆÑƒ Ñ ÑĞ·Ñ‹ĞºĞ¾Ğ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    #     return self.gettext(message_key, user_locale, **kwargs)


======================================================================

------------------------------ FILE: Systems/core/i18n/middleware.py ------------------------------
# core/i18n/middleware.py

from typing import Callable, Dict, Any, Awaitable, Optional
from aiogram import BaseMiddleware
from aiogram.types import TelegramObject, User as AiogramUser # User Ğ¸Ğ· aiogram.types

# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ½Ğ°Ñˆ Translator Ğ¸ AppSettings (Ğ´Ğ»Ñ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞ·Ñ‹ĞºĞ° Ğ¸ ÑĞ¿Ğ¸ÑĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ…)
from .translator import Translator
from Systems.core.app_settings import settings as sdb_settings # Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
from Systems.core.database.core_models import User as DBUser # ĞĞ°ÑˆĞ° Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ User Ğ¸Ğ· Ğ‘Ğ”
from sqlalchemy.ext.asyncio import AsyncSession # Ğ”Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ‘Ğ”

# Ğ”Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº BotServicesProvider Ğ¸Ğ· workflow_data Ğ´Ğ¸ÑĞ¿ĞµÑ‚Ñ‡ĞµÑ€Ğ° (ĞµÑĞ»Ğ¸ Ğ¾Ğ½ Ñ‚Ğ°Ğ¼ ĞµÑÑ‚ÑŒ)
# from Systems.core.services_provider import BotServicesProvider


class I18nMiddleware(BaseMiddleware):
    """
    Middleware Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ ÑĞ·Ñ‹ĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ
    Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ»Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (gettext) Ğ² Ñ…ÑĞ½Ğ´Ğ»ĞµÑ€Ñ‹.
    """
    def __init__(self, translator: Translator):
        super().__init__()
        self.translator = translator
        self.default_locale = translator.default_locale
        self.available_locales = translator.available_locales
        # logger Ğ·Ğ´ĞµÑÑŒ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ· data, ĞµÑĞ»Ğ¸ BotServicesProvider ĞµĞ³Ğ¾ Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµÑ‚, Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¹

    async def __call__(
        self,
        handler: Callable[[TelegramObject, Dict[str, Any]], Awaitable[Any]],
        event: TelegramObject, # Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Message, CallbackQuery, etc.
        data: Dict[str, Any]   # Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ Ğ² Ñ…ÑĞ½Ğ´Ğ»ĞµÑ€
    ) -> Any:
        
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Telegram, ĞµÑĞ»Ğ¸ Ğ¾Ğ½ ĞµÑÑ‚ÑŒ Ğ² ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¸
        aiogram_event_user: Optional[AiogramUser] = data.get("event_from_user")
        
        user_locale: str = self.default_locale # ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ ÑĞ·Ñ‹Ğº ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

        if aiogram_event_user:
            # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· Ğ½Ğ°ÑˆĞµĞ¹ Ğ‘Ğ”
            # Ğ”Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ½ÑƒĞ¶ĞµĞ½ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº DBManager Ğ¸Ğ»Ğ¸ ÑĞµÑÑĞ¸Ğ¸
            # ĞŸÑ€ĞµĞ´Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ğ¼, Ñ‡Ñ‚Ğ¾ BotServicesProvider (services) Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ² data
            services = data.get("services_provider") # Ğ˜Ğ¼Ñ ĞºĞ»ÑÑ‡Ğ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ñ‚Ğ¾Ğ³Ğ¾, ĞºĞ°Ğº Ğ¼Ñ‹ ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ğ»Ğ¸ Ğ² Dispatcher
            
            db_user: Optional[DBUser] = None
            if services and hasattr(services, 'db'):
                try:
                    async with services.db.get_session() as session: # type: AsyncSession
                        # Ğ˜Ñ‰ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ğ¾ telegram_id
                        from sqlalchemy import select # Ğ›ĞµĞ½Ğ¸Ğ²Ñ‹Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚
                        stmt = select(DBUser).where(DBUser.telegram_id == aiogram_event_user.id)
                        result = await session.execute(stmt)
                        db_user = result.scalars().first()
                        
                        if db_user and db_user.preferred_language_code and db_user.preferred_language_code in self.available_locales:
                            user_locale = db_user.preferred_language_code
                        elif db_user and not db_user.preferred_language_code:
                            # Ğ•ÑĞ»Ğ¸ Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² Ğ‘Ğ” Ğ½ĞµÑ‚ ÑĞ·Ñ‹ĞºĞ°, Ğ½Ğ¾ ĞµÑÑ‚ÑŒ ÑĞ·Ñ‹Ğº Ğ² Telegram Ğ¸ Ğ¾Ğ½ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ
                            if aiogram_event_user.language_code and aiogram_event_user.language_code in self.available_locales:
                                user_locale = aiogram_event_user.language_code
                                # ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº Ğ² Ğ‘Ğ” Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
                                # db_user.preferred_language_code = user_locale
                                # await session.commit() # ĞĞ¡Ğ¢ĞĞ ĞĞ–ĞĞ: commit Ğ² middleware
                        elif not db_user: # Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½ĞµÑ‚ Ğ² Ğ‘Ğ”
                            if aiogram_event_user.language_code and aiogram_event_user.language_code in self.available_locales:
                                user_locale = aiogram_event_user.language_code
                except Exception as e:
                    # logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ·Ñ‹ĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· Ğ‘Ğ” Ğ´Ğ»Ñ TG ID {aiogram_event_user.id}: {e}")
                    # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€ Ğ¸Ğ· data, ĞµÑĞ»Ğ¸ Ğ¾Ğ½ Ñ‚Ğ°Ğ¼ ĞµÑÑ‚ÑŒ
                    data.get("logger", logger).error(f"I18nMiddleware: ĞÑˆĞ¸Ğ±ĞºĞ° Ğ‘Ğ” Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ ÑĞ·Ñ‹ĞºĞ° Ğ´Ğ»Ñ TG ID {aiogram_event_user.id}: {e}")
                    # ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµĞ¼ Ñ default_locale Ğ¸Ğ»Ğ¸ ÑĞ·Ñ‹ĞºĞ¾Ğ¼ Ğ¸Ğ· Telegram, ĞµÑĞ»Ğ¸ Ğ¾Ğ½ Ğ±Ñ‹Ğ» Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½ Ñ€Ğ°Ğ½ĞµĞµ
            else: # Ğ•ÑĞ»Ğ¸ services Ğ¸Ğ»Ğ¸ services.db Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹
                 data.get("logger", logger).warning("I18nMiddleware: BotServicesProvider Ğ¸Ğ»Ğ¸ DBManager Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ Ğ² data. Ğ¯Ğ·Ñ‹Ğº Ğ¸Ğ· Ğ‘Ğ” Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½.")
                 # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ·Ñ‹Ğº Ğ¸Ğ· Telegram API, ĞµÑĞ»Ğ¸ Ğ¾Ğ½ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ
                 if aiogram_event_user.language_code and aiogram_event_user.language_code in self.available_locales:
                     user_locale = aiogram_event_user.language_code
        
        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº Ğ² data Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ² Ñ…ÑĞ½Ğ´Ğ»ĞµÑ€Ğ°Ñ…
        data["user_locale"] = user_locale
        
        # ĞŸÑ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ…ÑĞ½Ğ´Ğ»ĞµÑ€Ğ°Ğ¼ ÑƒĞ´Ğ¾Ğ±Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°
        # ĞĞ½Ğ¸ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ user_locale, ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ² data
        # Ğ­Ñ‚Ğ¾ Ğ¾Ğ±ĞµÑ€Ñ‚ĞºĞ¸, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ²Ğ°Ñ‚ÑŒ locale ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ€Ğ°Ğ·
        data["gettext"] = lambda message_key, **kwargs: self.translator.gettext(message_key, user_locale, **kwargs)
        data["ngettext"] = lambda singular_key, plural_key, count, **kwargs: self.translator.ngettext(singular_key, plural_key, count, user_locale, **kwargs)
        
        # Ğ¢Ğ°ĞºĞ¶Ğµ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‚ÑŒ ÑĞ°Ğ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚ translator, ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ ÑƒĞ´Ğ¾Ğ±Ğ½ĞµĞµ
        data["translator"] = self.translator 
        
        # data.get("logger", logger).debug(f"I18nMiddleware: Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ ÑĞ·Ñ‹Ğº '{user_locale}' Ğ´Ğ»Ñ TG ID {aiogram_event_user.id if aiogram_event_user else 'N/A'}.")
        
        return await handler(event, data)


======================================================================

------------------------------ FILE: Systems/core/i18n/__init__.py ------------------------------



======================================================================

------------------------------ FILE: Systems/core/logging/structured.py ------------------------------
# core/logging/structured.py
"""
Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² JSON Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ
"""

import json
import sys
from typing import Any, Dict, Optional
from datetime import datetime
from loguru import logger


class StructuredLogger:
    """
    Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€ Ñ JSON Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ¾Ğ¼
    """
    
    def __init__(self, json_output: bool = False, indent: Optional[int] = None):
        self.json_output = json_output
        self.indent = indent
        self._setup_logger()
    
    def _setup_logger(self):
        """ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ»Ğ¾Ğ³Ğ³ĞµÑ€Ğ°"""
        if self.json_output:
            # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ handler
            logger.remove()
            
            # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ JSON handler
            logger.add(
                sys.stdout,
                format=self._json_formatter,
                serialize=True,
                level="DEBUG"
            )
    
    def _json_formatter(self, record: Dict[str, Any]) -> str:
        """Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ»Ğ¾Ğ³Ğ° Ğ² JSON"""
        log_data = {
            "timestamp": datetime.fromtimestamp(record["time"].timestamp()).isoformat(),
            "level": record["level"].name,
            "message": record["message"],
            "module": record.get("name", ""),
            "function": record.get("function", ""),
            "line": record.get("line", 0),
        }
        
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ
        if "extra" in record:
            log_data.update(record["extra"])
        
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ exception info ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ
        if "exception" in record:
            log_data["exception"] = {
                "type": record["exception"].type.__name__ if record["exception"] else None,
                "value": str(record["exception"].value) if record["exception"] else None,
                "traceback": record["exception"].traceback if record["exception"] else None
            }
        
        return json.dumps(log_data, indent=self.indent, ensure_ascii=False)
    
    def bind(self, **kwargs):
        """ĞŸÑ€Ğ¸Ğ²ÑĞ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ Ğº Ğ»Ğ¾Ğ³Ğ³ĞµÑ€Ñƒ"""
        return logger.bind(**kwargs)


def setup_structured_logging(
    json_output: bool = False,
    log_file: Optional[str] = None,
    rotation: str = "10 MB",
    retention: str = "7 days",
    level: str = "INFO"
):
    """
    ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
    
    Args:
        json_output: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ JSON Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚
        log_file: ĞŸÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ Ğ»Ğ¾Ğ³Ğ¾Ğ² (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
        rotation: Ğ Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ²
        retention: Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ»Ğ¾Ğ³Ğ¾Ğ²
        level: Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    """
    logger.remove()
    
    if json_output:
        # JSON Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ»Ñ ĞºĞ¾Ğ½ÑĞ¾Ğ»Ğ¸
        logger.add(
            sys.stdout,
            format=lambda record: json.dumps({
                "timestamp": datetime.fromtimestamp(record["time"].timestamp()).isoformat(),
                "level": record["level"].name,
                "message": record["message"],
                "module": record.get("name", ""),
                "function": record.get("function", ""),
                "line": record.get("line", 0),
                **record.get("extra", {})
            }, ensure_ascii=False),
            serialize=True,
            level=level
        )
    else:
        # Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚
        logger.add(
            sys.stdout,
            format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>",
            level=level
        )
    
    # Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ğ¹ Ğ»Ğ¾Ğ³ (Ğ²ÑĞµĞ³Ğ´Ğ° JSON Ğ´Ğ»Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾ÑÑ‚Ğ¸)
    if log_file:
        logger.add(
            log_file,
            format=lambda record: json.dumps({
                "timestamp": datetime.fromtimestamp(record["time"].timestamp()).isoformat(),
                "level": record["level"].name,
                "message": record["message"],
                "module": record.get("name", ""),
                "function": record.get("function", ""),
                "line": record.get("line", 0),
                **record.get("extra", {})
            }, ensure_ascii=False),
            serialize=True,
            rotation=rotation,
            retention=retention,
            level="DEBUG"  # Ğ’ Ñ„Ğ°Ğ¹Ğ» Ğ¿Ğ¸ÑˆĞµĞ¼ Ğ²ÑĞµ
        )




======================================================================

------------------------------ FILE: Systems/core/users/service.py ------------------------------
# SwiftDevBot/core/users/service.py
from typing import TYPE_CHECKING, Optional, Tuple, List 
from aiogram import types as aiogram_types
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, orm 
from sqlalchemy.orm import attributes as orm_attributes 
from loguru import logger
from sqlalchemy.exc import IntegrityError 
from datetime import datetime, timezone 

from Systems.core.database.core_models import User as DBUser, Role as DBRole 
from Systems.core.rbac.service import DEFAULT_ROLE_USER 

if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from Systems.core.app_settings import I18nSettings 
    from Systems.core.rbac.service import RBACService 


class UserService:
    def __init__(self, services_provider: 'BotServicesProvider'):
        self._services = services_provider
        self._logger = logger.bind(service="UserService")
        self._logger.info("UserService Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")

    async def _get_user_by_telegram_id(self, telegram_id: int, session: AsyncSession, load_roles: bool = False, load_direct_perms: bool = False) -> Optional[DBUser]:
        self._logger.trace(f"Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· Ğ‘Ğ”. TG ID: {telegram_id}, Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ€Ğ¾Ğ»ĞµĞ¹: {load_roles}, Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ğ¿Ñ€Ğ°Ğ²: {load_direct_perms}")
        stmt = select(DBUser).where(DBUser.telegram_id == telegram_id)
        options_to_load = []
        if load_roles:
            options_to_load.append(orm.selectinload(DBUser.roles).selectinload(DBRole.permissions))
        if load_direct_perms:
            options_to_load.append(orm.selectinload(DBUser.direct_permissions))
        
        if options_to_load:
            stmt = stmt.options(*options_to_load)
            
        result = await session.execute(stmt)
        user = result.scalars().first()
        if user:
            roles_loaded_str = "Ğ½Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½Ğ¾"
            if load_roles:
                is_roles_relationship_loaded = orm_attributes.instance_state(user).has_identity and \
                                            'roles' in orm_attributes.instance_state(user).committed_state
                
                roles_loaded_str = "Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹" if is_roles_relationship_loaded and user.roles is not None else "ĞĞ• Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹"
                if is_roles_relationship_loaded and user.roles is not None:
                     self._logger.trace(f"User roles data (count): {len(user.roles)}")
                elif not is_roles_relationship_loaded:
                    self._logger.trace(f"ĞÑ‚Ñ€Ğ¸Ğ±ÑƒÑ‚ 'roles' Ğ½Ğµ Ğ±Ñ‹Ğ» Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {telegram_id}, Ñ…Ğ¾Ñ‚Ñ load_roles=True.")

            self._logger.trace(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {telegram_id} Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ‘Ğ” (DB ID: {user.id}). Ğ Ğ¾Ğ»Ğ¸: {roles_loaded_str}")
        else:
            self._logger.trace(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {telegram_id} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ‘Ğ”.")
        return user

    async def _update_existing_user_data(
        self,
        db_user: DBUser,
        tg_user: aiogram_types.User,
        current_lang_code: str
        ) -> bool: # Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ True, ĞµÑĞ»Ğ¸ Ğ±Ñ‹Ğ»Ğ¸ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ğ¼Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (ĞºÑ€Ğ¾Ğ¼Ğµ last_activity_at)
        updated_fields_log: dict = {}
        data_changed_meaningfully = False # Ğ¤Ğ»Ğ°Ğ³ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹, ĞºÑ€Ğ¾Ğ¼Ğµ last_activity

        if db_user.username != tg_user.username:
            updated_fields_log['username'] = (db_user.username, tg_user.username)
            db_user.username = tg_user.username
            db_user.username_lower = tg_user.username.lower() if tg_user.username else None 
            data_changed_meaningfully = True
        if db_user.first_name != tg_user.first_name:
            updated_fields_log['first_name'] = (db_user.first_name, tg_user.first_name)
            db_user.first_name = tg_user.first_name
            data_changed_meaningfully = True
        if db_user.last_name != tg_user.last_name:
            updated_fields_log['last_name'] = (db_user.last_name, tg_user.last_name)
            db_user.last_name = tg_user.last_name
            data_changed_meaningfully = True
        # ĞĞ• Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ preferred_language_code, ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒĞ¶Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ğ» ĞµĞ³Ğ¾ ÑĞ²Ğ½Ğ¾
        # Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº, Ğ´Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ ÑĞ·Ñ‹Ğº Telegram Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°ĞµÑ‚ÑÑ
        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ ÑĞ·Ñ‹Ğº Ğ½Ğµ Ğ±Ñ‹Ğ» ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ (None)
        if db_user.preferred_language_code is None and current_lang_code:
            updated_fields_log['preferred_language_code'] = (db_user.preferred_language_code, current_lang_code)
            db_user.preferred_language_code = current_lang_code
            data_changed_meaningfully = True
            self._logger.debug(f"Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ ÑĞ·Ñ‹Ğº Ğ¸Ğ· Telegram Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {tg_user.id}: {current_lang_code} (ÑĞ·Ñ‹Ğº Ğ½Ğµ Ğ±Ñ‹Ğ» ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ñ€Ğ°Ğ½ĞµĞµ)")
        
        is_owner_check = tg_user.id in self._services.config.core.super_admins

        if is_owner_check:
            if not db_user.is_active:
                db_user.is_active = True; data_changed_meaningfully = True
                updated_fields_log['is_active (owner override)'] = (False, True)
            # Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºÑƒ Ğ´Ğ»Ñ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†ĞµĞ²
            # if db_user.is_bot_blocked:
            #     db_user.is_bot_blocked = False; data_changed_meaningfully = True
            #     updated_fields_log['is_bot_blocked (owner override)'] = (True, False)
        else:
            # Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºÑƒ Ğ¿Ñ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
            # if db_user.is_bot_blocked:
            #     updated_fields_log['is_bot_blocked (user active)'] = (db_user.is_bot_blocked, False)
            #     db_user.is_bot_blocked = False
            #     data_changed_meaningfully = True
            if not db_user.is_active:
                updated_fields_log['is_active (user active)'] = (db_user.is_active, True)
                db_user.is_active = True
                data_changed_meaningfully = True

        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ last_activity_at Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¸ Ğ½ĞµĞ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
        if db_user.is_active and not db_user.is_bot_blocked:
            db_user.last_activity_at = datetime.now(timezone.utc)
        elif not db_user.is_active:
            self._logger.debug(f"ĞĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ last_activity_at Ğ´Ğ»Ñ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ TG ID: {tg_user.id}")
        elif db_user.is_bot_blocked:
            self._logger.debug(f"ĞĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ last_activity_at Ğ´Ğ»Ñ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ TG ID: {tg_user.id}")
        
        if data_changed_meaningfully:
            self._logger.info(f"Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ TG ID: {tg_user.id} (DB ID: {db_user.id}) Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹: {updated_fields_log}")
        
        return data_changed_meaningfully

    async def process_user_on_start(self, tg_user: aiogram_types.User) -> Tuple[Optional[DBUser], bool]:
        """
        ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ»ÑĞ±Ğ¾Ğ¼ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¸.
        Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ»Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾.
        Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ‚ĞµĞ¶ (DBUser, user_was_created_bool).
        """
        self._logger.info(f"UserService.process_user_on_start Ğ´Ğ»Ñ TG ID: {tg_user.id} (@{tg_user.username or 'N/A'})")
        
        is_owner = tg_user.id in self._services.config.core.super_admins
        if is_owner:
            self._logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {tg_user.id} Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ ĞºĞ°Ğº Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ† ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.")

        user_was_created = False # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ñ„Ğ»Ğ°Ğ³

        async with self._services.db.get_session() as session:
            try:
                db_user = await self._get_user_by_telegram_id(tg_user.id, session, load_roles=True) # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ñ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸
                
                data_actually_changed_in_db = False # Ğ¤Ğ»Ğ°Ğ³ Ğ´Ğ»Ñ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹, Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‰Ğ¸Ñ… ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ°

                i18n_settings: Optional["I18nSettings"] = getattr(self._services.config.core, 'i18n', None)
                available_locales = getattr(i18n_settings, 'available_locales', ['en', 'ua']) if i18n_settings else ['en', 'ua']
                default_locale = getattr(i18n_settings, 'default_locale', 'en') if i18n_settings else 'en'
                current_lang_code = tg_user.language_code if tg_user.language_code and tg_user.language_code in available_locales else default_locale
                self._logger.trace(f"ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½ ÑĞ·Ñ‹Ğº '{current_lang_code}' Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {tg_user.id}.")

                if not db_user:
                    self._logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID: {tg_user.id} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.")
                    db_user = DBUser(
                        telegram_id=tg_user.id, username=tg_user.username,
                        username_lower=tg_user.username.lower() if tg_user.username else None,
                        first_name=tg_user.first_name, last_name=tg_user.last_name,
                        preferred_language_code=current_lang_code,
                        is_active=True, is_bot_blocked=False,
                        last_activity_at=datetime.now(timezone.utc) 
                    )
                    session.add(db_user) 
                    user_was_created = True # Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ„Ğ»Ğ°Ğ³
                    data_actually_changed_in_db = True
                    self._logger.info(f"ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID: {tg_user.id} Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½ Ğº ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ.")
                else:
                    self._logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID: {tg_user.id} (DB ID: {db_user.id}) Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…...")
                    if await self._update_existing_user_data(db_user, tg_user, current_lang_code):
                        data_actually_changed_in_db = True
                    # last_activity_at Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ² _update_existing_user_data, Ğ¸ ĞµÑĞ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¾ÑÑŒ,
                    # Ñ‚Ğ¾ data_actually_changed_in_db Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ False, Ğ½Ğ¾ ÑĞµÑÑĞ¸Ñ Ğ²ÑĞµ Ñ€Ğ°Ğ²Ğ½Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ dirty.
                    if db_user not in session.dirty and db_user not in session.new :
                        session.add(db_user) # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² ÑĞµÑÑĞ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ, ĞµÑĞ»Ğ¸ Ğ½Ğµ Ñ‚Ğ°Ğ¼
                    self._logger.info(f"Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ TG ID: {tg_user.id} Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ ÑĞµÑÑĞ¸ĞµĞ¹ (Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ: {data_actually_changed_in_db}).")
                
                # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸
                rbac_service: Optional["RBACService"] = getattr(self._services, 'rbac', None)
                if rbac_service:
                    if user_was_created: 
                        await session.flush([db_user]) # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ID
                        self._logger.info(f"ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID: {tg_user.id} Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» DB ID: {db_user.id} Ğ¿Ğ¾ÑĞ»Ğµ flush.")
                        if is_owner:
                            # Ğ¡ÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ñ‹ Ğ¸Ğ· .env Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ÑÑ‚ Ñ€Ğ¾Ğ»ÑŒ SuperAdmin
                            if await rbac_service.assign_role_to_user(session, db_user, "SuperAdmin"):
                                self._logger.info(f"Ğ¡ÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ {tg_user.id} Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ° Ñ€Ğ¾Ğ»ÑŒ 'SuperAdmin'.")
                                data_actually_changed_in_db = True
                        else:
                            if await rbac_service.assign_role_to_user(session, db_user, DEFAULT_ROLE_USER):
                                data_actually_changed_in_db = True
                    elif db_user: # Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹
                        if is_owner:
                            # Ğ¡ÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ñ‹ Ğ¸Ğ· .env Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¸Ğ¼ĞµÑ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ SuperAdmin
                            user_role_names = {r.name for r in db_user.roles} if db_user.roles else set()
                            if "SuperAdmin" not in user_role_names:
                                # ĞĞ°Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµĞ¼ Ñ€Ğ¾Ğ»ÑŒ SuperAdmin ĞµÑĞ»Ğ¸ ĞµÑ‘ Ğ½ĞµÑ‚
                                if await rbac_service.assign_role_to_user(session, db_user, "SuperAdmin"):
                                    self._logger.info(f"Ğ¡ÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ {tg_user.id} Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ° Ñ€Ğ¾Ğ»ÑŒ 'SuperAdmin'.")
                                    data_actually_changed_in_db = True
                            # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¸ ĞµÑÑ‚ÑŒ (SuperAdmin Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ°)
                            roles_to_remove = user_role_names - {"SuperAdmin"}
                            for role_name in roles_to_remove:
                                if await rbac_service.remove_role_from_user(session, db_user, role_name):
                                    self._logger.info(f"Ğ Ğ¾Ğ»ÑŒ '{role_name}' ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ° Ñƒ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ° {tg_user.id} (Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ñ€Ğ¾Ğ»ÑŒ 'SuperAdmin').")
                                    data_actually_changed_in_db = True
                        elif not db_user.roles: # ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ ÑĞ·ĞµÑ€ Ğ±ĞµĞ· Ñ€Ğ¾Ğ»ĞµĞ¹ - Ğ´Ğ°ĞµĞ¼ User
                            if await rbac_service.assign_role_to_user(session, db_user, DEFAULT_ROLE_USER):
                                data_actually_changed_in_db = True
                
                # ĞšĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ±Ñ‹Ğ»Ğ¸ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¸Ğ»Ğ¸ ÑĞµÑÑĞ¸Ñ "Ğ³Ñ€ÑĞ·Ğ½Ğ°Ñ"
                # (Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ last_activity_at Ğ´ĞµĞ»Ğ°ĞµÑ‚ ÑĞµÑÑĞ¸Ñ Ğ³Ñ€ÑĞ·Ğ½Ğ¾Ğ¹)
                if data_actually_changed_in_db or (session.new or session.dirty or session.deleted): 
                    self._logger.info(f"UserService: ĞŸĞ•Ğ Ğ•Ğ” session.commit() Ğ´Ğ»Ñ TG ID {tg_user.id}. "
                                     f"Data changed: {data_actually_changed_in_db}, Dirty: {session.dirty}, New: {session.new}")
                    await session.commit()
                    self._logger.success(f"UserService: ĞŸĞĞ¡Ğ›Ğ• session.commit() Ğ´Ğ»Ñ TG ID {tg_user.id}.")
                    if db_user: # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ¸Ğ· Ğ‘Ğ”
                        await session.refresh(db_user, attribute_names=['id', 'roles', 'direct_permissions', 'last_activity_at', 'is_active', 'is_bot_blocked'])
                        logger.debug(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {db_user.id} Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸Ğ· Ğ‘Ğ” Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ° Ğ² UserService.")
                else:
                    self._logger.trace(f"ĞĞµÑ‚ Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ² ÑĞµÑÑĞ¸Ğ¸ Ğ´Ğ»Ñ TG ID {tg_user.id} Ğ² UserService. ĞšĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ.")
                
                return db_user, user_was_created

            except IntegrityError as ie: # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ³Ğ¾Ğ½ĞºĞ¸ (Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ğ¼ĞµĞ¶Ğ´Ñƒ SELECT Ğ¸ INSERT)
                await session.rollback()
                self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° IntegrityError Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ TG ID {tg_user.id}. {ie.orig if hasattr(ie, 'orig') else ie}", exc_info=True)
                self._logger.info(f"ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ TG ID {tg_user.id} Ğ¿Ğ¾ÑĞ»Ğµ IntegrityError.")
                db_user_retry = await self._get_user_by_telegram_id(tg_user.id, session, load_roles=True)
                if db_user_retry:
                    self._logger.info(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID {tg_user.id} Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞµ. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ.")
                    meaningful_data_updated_on_retry = await self._update_existing_user_data(db_user_retry, tg_user, current_lang_code)
                    
                    # Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ¿Ñ€Ğ¸ Ñ€ĞµÑ‚Ñ€Ğ°Ğµ (ÑƒĞ±ĞµĞ´Ğ¸Ğ¼ÑÑ, Ñ‡Ñ‚Ğ¾ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ† Ğ¸Ğ¼ĞµĞµÑ‚ Ñ€Ğ¾Ğ»ÑŒ Admin, Ğ° ÑĞ·ĞµÑ€ Ñ Ñ€Ğ¾Ğ»ÑŒÑ User)
                    if rbac_service:
                        if is_owner:
                            # Ğ¡ÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ñ‹ Ğ¸Ğ· .env Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¸Ğ¼ĞµÑ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ SuperAdmin
                            user_role_names_retry = {r.name for r in db_user_retry.roles} if db_user_retry.roles else set()
                            if "SuperAdmin" not in user_role_names_retry:
                                if await rbac_service.assign_role_to_user(session, db_user_retry, "SuperAdmin"):
                                    self._logger.info(f"Ğ¡ÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ {tg_user.id} Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ° Ñ€Ğ¾Ğ»ÑŒ 'SuperAdmin' (retry).")
                            # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¸ ĞµÑÑ‚ÑŒ (SuperAdmin Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ°)
                            roles_to_remove_retry = user_role_names_retry - {"SuperAdmin"}
                            for role_name in roles_to_remove_retry:
                                if await rbac_service.remove_role_from_user(session, db_user_retry, role_name):
                                    self._logger.info(f"Ğ Ğ¾Ğ»ÑŒ '{role_name}' ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ° Ñƒ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ° {tg_user.id} (retry).")
                        elif not db_user_retry.roles: # Ğ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ½Ğµ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ† Ğ¸ Ñƒ Ğ½ĞµĞ³Ğ¾ Ğ½ĞµÑ‚ Ñ€Ğ¾Ğ»ĞµĞ¹
                             await rbac_service.assign_role_to_user(session, db_user_retry, DEFAULT_ROLE_USER)
                    
                    if meaningful_data_updated_on_retry or (session.new or session.dirty or session.deleted):
                        self._logger.info(f"UserService (retry): ĞŸĞ•Ğ Ğ•Ğ” session.commit() Ğ´Ğ»Ñ TG ID {tg_user.id}.")
                        await session.commit()
                        self._logger.success(f"UserService (retry): ĞŸĞĞ¡Ğ›Ğ• session.commit() Ğ´Ğ»Ñ TG ID {tg_user.id}.")
                        await session.refresh(db_user_retry, attribute_names=['id', 'roles', 'direct_permissions', 'last_activity_at', 'is_active', 'is_bot_blocked'])
                    return db_user_retry, False # False, Ñ‚.Ğº. Ğ¾Ğ½ ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ» Ğ½Ğ° Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ Ñ€ĞµÑ‚Ñ€Ğ°Ñ
                self._logger.error(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID {tg_user.id} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ´Ğ°Ğ¶Ğµ Ğ¿Ğ¾ÑĞ»Ğµ IntegrityError Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸.")
                return None, False
            except Exception as e: 
                self._logger.error(f"ĞĞµĞ¿Ñ€ĞµĞ´Ğ²Ğ¸Ğ´ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° ({type(e).__name__}) Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ TG ID {tg_user.id} Ğ² UserService: {e}", exc_info=True)
                if hasattr(session, 'is_active') and session.is_active: 
                    await session.rollback()
                return None, False
        
        self._logger.error(f"Ğ’Ñ‹Ñ…Ğ¾Ğ´ Ğ¸Ğ· process_user_on_start Ğ´Ğ»Ñ TG ID {tg_user.id} Ğ±ĞµĞ· ÑĞ²Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ°.")
        return None, False
    
    async def update_user_language(self, user: DBUser, language_code: str, session: AsyncSession) -> bool:
        if user.preferred_language_code != language_code:
            user.preferred_language_code = language_code
            if user not in session.dirty and user not in session.new : session.add(user) 
            self._logger.info(f"Ğ¯Ğ·Ñ‹Ğº Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.telegram_id} (DB ID: {user.id}) Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½ Ğ½Ğ° '{language_code}' (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² ÑĞµÑÑĞ¸Ñ).")
            return True
        return False

    async def set_user_active_status(self, user: DBUser, is_active: bool, session: AsyncSession) -> bool:
        if user.telegram_id in self._services.config.core.super_admins:
            self._logger.warning(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° ({user.telegram_id}). Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½Ğ¾.")
            return False 

        if user.is_active != is_active:
            user.is_active = is_active
            if user not in session.dirty and user not in session.new : session.add(user)
            self._logger.info(f"Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.telegram_id} (DB ID: {user.id}) Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½ Ğ½Ğ° {is_active} (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² ÑĞµÑÑĞ¸Ñ).")
            return True
        return False

    async def set_user_bot_blocked_status(self, user: DBUser, is_bot_blocked: bool, session: AsyncSession) -> bool:
        if user.telegram_id in self._services.config.core.super_admins:
            self._logger.warning(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° ({user.telegram_id}). Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½Ğ¾.")
            return False 

        if user.is_bot_blocked != is_bot_blocked:
            user.is_bot_blocked = is_bot_blocked
            if user not in session.dirty and user not in session.new : session.add(user)
            self._logger.info(f"Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ±Ğ¾Ñ‚Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.telegram_id} (DB ID: {user.id}) Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½ Ğ½Ğ° {is_bot_blocked} (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² ÑĞµÑÑĞ¸Ñ).")
            return True
        return False

    async def get_user_by_telegram_id(
        self, 
        session: AsyncSession, 
        telegram_id: int, 
        load_roles: bool = True,
        load_direct_perms: bool = False
    ) -> Optional[DBUser]:
        """
        ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ğ¾ Telegram ID.
        
        Args:
            session: Database session
            telegram_id: Telegram user ID
            load_roles: Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ñ‚ÑŒ Ğ»Ğ¸ Ñ€Ğ¾Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
            load_direct_perms: Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ñ‚ÑŒ Ğ»Ğ¸ Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ
            
        Returns:
            User object or None if not found
        """
        return await self._get_user_by_telegram_id(
            telegram_id=telegram_id,
            session=session,
            load_roles=load_roles,
            load_direct_perms=load_direct_perms
        )


======================================================================

------------------------------ FILE: Systems/core/users/middleware.py ------------------------------
# SwiftDevBot/core/users/middleware.py
from typing import Callable, Dict, Any, Awaitable, Optional
from aiogram import BaseMiddleware
from aiogram.types import TelegramObject, User as AiogramUser, Update 
from loguru import logger
from datetime import datetime, timezone 

from Systems.core.database.core_models import User as DBUser
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select

from Systems.core.ui.keyboards_core import TEXTS_CORE_KEYBOARDS_EN
from Systems.core.ui.callback_data_factories import CoreServiceAction


from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from Systems.core.users.service import UserService 

MODULE_NAME_FOR_LOG = "UserStatusMiddleware"

class UserStatusMiddleware(BaseMiddleware):
    async def __call__(
        self,
        handler: Callable[[TelegramObject, Dict[str, Any]], Awaitable[Any]],
        event: Update, 
        data: Dict[str, Any]
    ) -> Any:
        
        aiogram_event_user: Optional[AiogramUser] = data.get("event_from_user")
        if not aiogram_event_user:
            return await handler(event, data)

        user_tg_id = aiogram_event_user.id
        user_mention = f"@{aiogram_event_user.username}" if aiogram_event_user.username else f"ID:{user_tg_id}"
        
        services_provider: Optional['BotServicesProvider'] = data.get("services_provider")
        if not (services_provider and hasattr(services_provider, 'db') and hasattr(services_provider, 'user_service')):
            logger.critical(f"[{MODULE_NAME_FOR_LOG}] ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ (DBManager, UserService) Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ "
                           f"Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ² data. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°/ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_mention} Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾. ĞŸÑ€ĞµÑ€Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ.")
            if event.message: await event.message.reply("ĞÑˆĞ¸Ğ±ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² Ğ±Ğ¾Ñ‚Ğ°. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑĞ¾Ğ¾Ğ±Ñ‰Ğ¸Ñ‚Ğµ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ.")
            elif event.callback_query: await event.callback_query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ².", show_alert=True)
            return None

        db_user: Optional[DBUser] = None
        user_service: 'UserService' = services_provider.user_service
        user_was_created_in_this_middleware_call = False # Ğ¤Ğ»Ğ°Ğ³ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ° middleware

        try:
            async with services_provider.db.get_session() as session:
                stmt = select(DBUser).where(DBUser.telegram_id == user_tg_id)
                result = await session.execute(stmt)
                db_user = result.scalars().first()
        except Exception as e_get_user:
            logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ‘Ğ” Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_mention}: {e_get_user}", exc_info=True)
            if event.message: await event.message.reply("Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ.")
            elif event.callback_query: await event.callback_query.answer("Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°.", show_alert=True)
            return None

        is_owner_from_config = user_tg_id in services_provider.config.core.super_admins
        is_start_command = event.message and event.message.text and event.message.text.startswith("/start")
        callback_data = None
        if event.callback_query and event.callback_query.data:
            try:
                callback_data = CoreServiceAction.unpack(event.callback_query.data)
            except (ValueError, TypeError):
                callback_data = None
        is_confirm_registration_callback = callback_data is not None and callback_data.action == "confirm_registration"
        is_cancel_registration_callback = callback_data is not None and callback_data.action == "cancel_registration"

        if not db_user: 
            if is_start_command:
                logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_mention} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ‘Ğ”. ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ğ¸ Ğ¾Ñ‚ĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ.")
                data['sdb_user'] = None
                data['user_was_just_created'] = False
                data['pending_registration_user'] = aiogram_event_user
                data['pending_registration_action'] = 'start'
                return await handler(event, data)
            if is_owner_from_config:
                logger.info(f"[{MODULE_NAME_FOR_LOG}] Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ† {user_mention} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ‘Ğ”. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ±ĞµĞ· Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ¸).")
                try:
                    processed_user, created_flag = await user_service.process_user_on_start(aiogram_event_user)
                    db_user = processed_user
                    if created_flag:
                        user_was_created_in_this_middleware_call = True
                    if not db_user:
                        logger.error(f"[{MODULE_NAME_FOR_LOG}] UserService.process_user_on_start Ğ½Ğµ ÑĞ¼Ğ¾Ğ³ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° {user_mention}.")
                        if event.message: await event.message.reply("ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°. ĞĞ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ĞµÑÑŒ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ.")
                        elif event.callback_query: await event.callback_query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°.", show_alert=True)
                        return None
                except Exception as e_create_mw:
                    logger.error(f"[{MODULE_NAME_FOR_LOG}] Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° {user_mention}: {e_create_mw}", exc_info=True)
                    if event.message: await event.message.reply("ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ.")
                    elif event.callback_query: await event.callback_query.answer("ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ.", show_alert=True)
                    return None
            elif is_confirm_registration_callback:
                logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ñ‚ {user_mention}, Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ĞµÑ‰Ñ‘ Ğ½Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½.")
                data['sdb_user'] = None
                data['pending_registration_user'] = aiogram_event_user
                data['pending_registration_action'] = 'confirm_registration'
                return await handler(event, data)
            elif is_cancel_registration_callback:
                logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_mention} Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ» Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ (middleware Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµÑ‚).")
                data['sdb_user'] = None
                return await handler(event, data)
            else: 
                logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_mention} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ‘Ğ” Ğ¸ ÑÑ‚Ğ¾ Ğ½Ğµ /start/Ğ²Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ¿Ñ€Ğ¸Ğ·Ñ‹Ğ²Ğ° Ğº Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸.")
                please_register_text = TEXTS_CORE_KEYBOARDS_EN.get("user_middleware_please_register", "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ /start Ğ´Ğ»Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼.")
                # ... (Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¸ return None)
                if event.message:
                    try: await event.message.reply(please_register_text)
                    except Exception as e_reply: logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€. {user_mention}: {e_reply}")
                elif event.callback_query:
                    try: await event.callback_query.answer(please_register_text, show_alert=True)
                    except Exception as e_answer: logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ½Ğ° callback Ğ¾ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€. {user_mention}: {e_answer}")
                return None 
        elif not is_start_command: 
            logger.trace(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_mention} Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. Ğ’Ñ‹Ğ·Ğ¾Ğ² process_user_on_start Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ...")
            try:
                processed_user, _ = await user_service.process_user_on_start(aiogram_event_user) # Ğ¤Ğ»Ğ°Ğ³ created Ğ·Ğ´ĞµÑÑŒ Ğ½Ğµ Ñ‚Ğ°Ğº Ğ²Ğ°Ğ¶ĞµĞ½
                if processed_user:
                    db_user = processed_user 
                else: 
                    logger.warning(f"[{MODULE_NAME_FOR_LOG}] process_user_on_start Ğ²ĞµÑ€Ğ½ÑƒĞ» None Ğ´Ğ»Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_mention} Ğ² middleware.")
            except Exception as e_update_mw:
                 logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_mention} Ğ² middleware: {e_update_mw}", exc_info=True)
        
        if not db_user:
            logger.critical(f"[{MODULE_NAME_FOR_LOG}] db_user Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¿Ğ¾ÑĞ»Ğµ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ/ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ {user_mention}. ĞŸÑ€ĞµÑ€Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ.")
            return None

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ is_active Ğ¸ is_bot_blocked (Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹)
        if not db_user.is_active:
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_mention} (DB ID: {db_user.id}) Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½. Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½.")
            if event.message:
                await event.message.reply("âŒ Ğ’Ğ°Ñˆ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½. ĞĞ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ĞµÑÑŒ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ Ğ´Ğ»Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸.")
            elif event.callback_query:
                await event.callback_query.answer("âŒ Ğ’Ğ°Ñˆ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½.", show_alert=True)
            return None

        if db_user.is_bot_blocked:
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_mention} (DB ID: {db_user.id}) Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ. Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½.")
            if event.message:
                await event.message.reply("ğŸš« Ğ’Ñ‹ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ. ĞĞ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ĞµÑÑŒ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ.")
            elif event.callback_query:
                await event.callback_query.answer("ğŸš« Ğ’Ñ‹ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ.", show_alert=True)
            return None 
            
        logger.trace(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_mention} (DB ID: {db_user.id}) Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ¾ÑˆĞµĞ». Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½.")
        data['sdb_user'] = db_user
        # --- ĞŸĞ•Ğ Ğ•Ğ”ĞĞ•Ğœ Ğ¤Ğ›ĞĞ“ Ğ Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ˜ Ğ’ Ğ¥Ğ­ĞĞ”Ğ›Ğ•Ğ  /start ---
        if is_start_command: # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ /start Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµĞ¼ ÑÑ‚Ğ¾Ñ‚ Ñ„Ğ»Ğ°Ğ³
            data['user_was_just_created'] = user_was_created_in_this_middleware_call
            logger.debug(f"[{MODULE_NAME_FOR_LOG}] Ğ”Ğ»Ñ /start Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_mention} ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ñ„Ğ»Ğ°Ğ³ user_was_just_created = {user_was_created_in_this_middleware_call}")

        return await handler(event, data)


======================================================================

------------------------------ FILE: Systems/core/users/__init__.py ------------------------------
# core/users/__init__.py
from .service import UserService

__all__ = ["UserService"]


======================================================================

------------------------------ FILE: Systems/core/database/base.py ------------------------------
# core/database/base.py
from typing import Any, Dict
from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column
from sqlalchemy import func, MetaData
from datetime import datetime, timezone 

convention = {
    "ix": "ix_%(column_0_label)s",
    "uq": "uq_%(table_name)s_%(column_0_name)s",
    "ck": "ck_%(table_name)s_%(constraint_name)s",
    "fk": "fk_%(table_name)s_%(column_0_name)s_%(referred_table_name)s",
    "pk": "pk_%(table_name)s"
}
metadata_obj = MetaData(naming_convention=convention)

class Base(DeclarativeBase):
    metadata = metadata_obj

class SDBBaseModel(Base):
    __abstract__ = True
    id: Mapped[int] = mapped_column(primary_key=True, index=True, autoincrement=True)
    created_at: Mapped[datetime] = mapped_column(
        default=lambda: datetime.now(timezone.utc),
        server_default=func.now()
    )
    updated_at: Mapped[datetime] = mapped_column(
        default=lambda: datetime.now(timezone.utc),
        onupdate=lambda: datetime.now(timezone.utc),
        server_default=func.now(),
        server_onupdate=func.now() 
    )
    def to_dict(self, exclude: set = None) -> Dict[str, Any]:
        if exclude is None: exclude = set()
        data = {}
        for prop in self.__mapper__.iterate_properties:
            if hasattr(prop, 'columns') and prop.key not in exclude:
                try: data[prop.key] = getattr(self, prop.key)
                except AttributeError: pass
        return data
    def __repr__(self) -> str:
        pk_column_names = [pk_col.name for pk_col in self.__table__.primary_key.columns]
        pk_values_str = ", ".join(f"{name}={getattr(self, name)!r}" for name in pk_column_names)
        return f"<{self.__class__.__name__}({pk_values_str})>"


======================================================================

------------------------------ FILE: Systems/core/database/manager.py ------------------------------
# core/database/manager.py

from pathlib import Path
from contextlib import asynccontextmanager
from typing import AsyncGenerator, List, Type, Optional, TYPE_CHECKING

from sqlalchemy.ext.asyncio import (
    AsyncSession,
    async_sessionmaker,
    create_async_engine,
    AsyncEngine
)
from sqlalchemy.pool import NullPool
from loguru import logger

from .base import Base
from Systems.core.app_settings import DEFAULT_PROJECT_DATA_DIR_NAME

if TYPE_CHECKING:
    from Systems.core.app_settings import DBSettings, AppSettings

class DBManager:
    def __init__(self, db_settings: 'DBSettings', app_settings: 'AppSettings'): # app_settings Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½
        self._db_settings: 'DBSettings' = db_settings
        self._app_settings: 'AppSettings' = app_settings
        self._engine: Optional[AsyncEngine] = None
        self._session_factory: Optional[async_sessionmaker[AsyncSession]] = None
        self._db_url: Optional[str] = None

        self._logger = logger.bind(service="DBManager")
        self._logger.info(f"DBManager Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ° Ğ‘Ğ”: {self._db_settings.type}")

    def _build_db_url(self) -> str:
        if self._db_url:
            return self._db_url

        db_type = self._db_settings.type
        url: str

        if db_type == "sqlite":
            sqlite_path_str = self._db_settings.sqlite_path
            path_obj = Path(sqlite_path_str)
            abs_path: Path

            if path_obj.is_absolute():
                abs_path = path_obj.resolve()
            else:
                # self._app_settings Ğ·Ğ´ĞµÑÑŒ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½, Ñ‚.Ğº. Ğ¾Ğ½ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¾Ñ€Ğ°
                if DEFAULT_PROJECT_DATA_DIR_NAME in path_obj.parts:
                    project_root_dir = self._app_settings.core.project_data_path.parent
                    abs_path = (project_root_dir / path_obj).resolve()
                else: 
                    abs_path = (self._app_settings.core.project_data_path / path_obj).resolve()
            
            abs_path.parent.mkdir(parents=True, exist_ok=True)
            self._logger.debug(f"ĞĞºĞ¾Ğ½Ñ‡Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ±ÑĞ¾Ğ»ÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğ´Ğ»Ñ SQLite: {abs_path}")
            url = f"sqlite+aiosqlite:///{abs_path}"
            
        elif db_type == "postgresql":
            if not self._db_settings.pg_dsn:
                msg = "DSN Ğ´Ğ»Ñ PostgreSQL (pg_dsn) Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ° Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ…."
                self._logger.error(msg)
                raise ValueError(msg)
            url = str(self._db_settings.pg_dsn)
            
        elif db_type == "mysql":
            if not self._db_settings.mysql_dsn:
                msg = "DSN Ğ´Ğ»Ñ MySQL (mysql_dsn) Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ° Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ…."
                self._logger.error(msg)
                raise ValueError(msg)
            url = str(self._db_settings.mysql_dsn)
            
        else:
            msg = f"ĞĞµĞ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ…: '{db_type}'"
            self._logger.error(msg)
            raise ValueError(msg)
        
        self._db_url = url
        return url

    async def initialize(self) -> None:
        if self._engine is not None:
            self._logger.debug("DBManager (engine) ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ» Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
            return

        db_url = self._build_db_url()
        self._logger.info(f"Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ²Ğ¸Ğ¶ĞºĞ° SQLAlchemy Ğ´Ğ»Ñ URL: '{db_url[:db_url.find('://')+3]}...' (Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ URL ÑĞºÑ€Ñ‹Ñ‚Ñ‹)")
        
        echo_sql = self._db_settings.echo_sql

        try:
            self._engine = create_async_engine(
                db_url,
                echo=echo_sql, 
                poolclass=NullPool,
            )
            
            self._session_factory = async_sessionmaker(
                bind=self._engine,
                class_=AsyncSession,
                expire_on_commit=False,
                autoflush=False,
                autocommit=False,
            )
            self._logger.success("SQLAlchemy AsyncEngine Ğ¸ SessionFactory ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹.")
        except Exception as e:
            self._logger.critical(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ SQLAlchemy Engine Ğ¸Ğ»Ğ¸ SessionFactory Ğ´Ğ»Ñ URL '{db_url}': {e}", exc_info=True)
            self._engine = None
            self._session_factory = None
            raise

    async def dispose(self) -> None:
        if self._engine:
            self._logger.info("Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ SQLAlchemy AsyncEngine...")
            try:
                await self._engine.dispose()
                self._logger.success("SQLAlchemy AsyncEngine ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚.")
            except Exception as e:
                self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ SQLAlchemy AsyncEngine: {e}", exc_info=True)
            finally:
                self._engine = None
                self._session_factory = None
        else:
            self._logger.debug("DBManager (engine) Ğ½Ğµ Ğ±Ñ‹Ğ» Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ¸Ğ»Ğ¸ ÑƒĞ¶Ğµ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚.")

    @asynccontextmanager
    async def get_session(self) -> AsyncGenerator[AsyncSession, None]:
        if not self._session_factory:
            msg = "DBManager SessionFactory Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°! Ğ’Ñ‹Ğ·Ğ¾Ğ²Ğ¸Ñ‚Ğµ initialize() Ğ¿ĞµÑ€ĞµĞ´ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼ ÑĞµÑÑĞ¸Ğ¸."
            self._logger.critical(msg)
            raise RuntimeError(msg)

        session: AsyncSession = self._session_factory()
        self._logger.trace(f"Ğ¡ĞµÑÑĞ¸Ñ Ğ‘Ğ” {id(session)} Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ°.")
        try:
            yield session
        except Exception as e:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² ÑĞµÑÑĞ¸Ğ¸ Ğ‘Ğ” {id(session)}: {e}. Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ¾Ñ‚ĞºĞ°Ñ‚ (rollback).", exc_info=True)
            await session.rollback()
            raise
        finally:
            await session.close()
            self._logger.trace(f"Ğ¡ĞµÑÑĞ¸Ñ Ğ‘Ğ” {id(session)} Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ°.")

    async def create_all_core_tables(self) -> None:
        if not self._engine:
            err_msg = "DBManager Engine Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½. ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹."
            self._logger.error(err_msg)
            raise RuntimeError(err_msg)

        self._logger.info("Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† ÑĞ´Ñ€Ğ° Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Base.metadata...")
        async with self._engine.begin() as conn:
            from Systems.core.database import core_models # noqa: F401
            await conn.run_sync(Base.metadata.create_all)
        self._logger.success("Ğ’ÑĞµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° (Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Base.metadata) ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ (Ğ¸Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ»Ğ¸).")

    async def create_specific_module_tables(self, module_model_classes: List[Type[Base]]) -> None:
        if not self._engine:
            err_msg = "DBManager Engine Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½. ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ."
            self._logger.error(err_msg)
            raise RuntimeError(err_msg)
        if not module_model_classes:
            self._logger.debug("ĞĞµÑ‚ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ (ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿ÑƒÑÑ‚).")
            return

        # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ ÑĞ´Ñ€Ğ° ĞŸĞ•Ğ Ğ•Ğ” Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
        # Ğ­Ñ‚Ğ¾ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ğ´Ğ»Ñ Ñ‚Ğ¾Ğ³Ğ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ SQLAlchemy Ğ·Ğ½Ğ°Ğ» Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ… ÑĞ´Ñ€Ğ° (sdb_users, sdb_roles Ğ¸ Ñ‚.Ğ´.)
        # Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ foreign key Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
        from Systems.core.database import core_models # noqa: F401
        
        # Ğ£Ğ±ĞµĞ¶Ğ´Ğ°ĞµĞ¼ÑÑ, Ñ‡Ñ‚Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ñ„Ğ¸Ğ·Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ² Ğ‘Ğ” Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ°
        from sqlalchemy import inspect, text
        from Systems.core.database.core_models import SDB_CORE_TABLE_PREFIX
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† ÑĞ´Ñ€Ğ° Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸
        async with self._engine.begin() as check_conn:
            if self._db_settings.type == "sqlite":
                result = await check_conn.execute(text("SELECT name FROM sqlite_master WHERE type='table' AND name LIKE 'sdb_%'"))
                existing_core_tables = [row[0] for row in result.fetchall()]
            else:
                inspector = inspect(self._engine.sync_engine)
                existing_core_tables = [t for t in inspector.get_table_names() if t.startswith("sdb_")]
        
        # Ğ•ÑĞ»Ğ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† ÑĞ´Ñ€Ğ° Ğ½ĞµÑ‚, ÑĞ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¸Ñ… (Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸)
        if not existing_core_tables:
            self._logger.warning("Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ Ğ² Ğ‘Ğ”. Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¸Ñ… Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ...")
            await self.create_all_core_tables()
            self._logger.success("Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹. ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµĞ¼ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ...")
        else:
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ sdb_users, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ¾Ğ½Ğ° Ğ½ÑƒĞ¶Ğ½Ğ° Ğ´Ğ»Ñ foreign keys
            users_table_name = f"{SDB_CORE_TABLE_PREFIX}users"
            if users_table_name not in existing_core_tables:
                self._logger.warning(f"Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° '{users_table_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ² Ğ‘Ğ”. Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ°...")
                await self.create_all_core_tables()
                self._logger.success("Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹. ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµĞ¼ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ...")
            else:
                self._logger.debug(f"Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ Ğ² Ğ‘Ğ”, Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ '{users_table_name}': {existing_core_tables[:3]}...")

        tables_to_create = [model_cls.__table__ for model_cls in module_model_classes]
        table_names_str = ", ".join([table.name for table in tables_to_create])
        self._logger.info(f"Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: [{table_names_str}]")

        async with self._engine.begin() as conn:
            # Ğ’Ğ°Ğ¶Ğ½Ğ¾: Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ ÑĞ´Ñ€Ğ° ÑƒĞ¶Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ²Ñ‹ÑˆĞµ, Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ¾Ğ½Ğ¸ Ğ² Base.metadata
            # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° ÑƒĞ¶Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ñ‹ Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ²Ñ‹ÑˆĞµ, ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾
            # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ create_all Ğ‘Ğ•Ğ— ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ñ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ SQLAlchemy
            # Ğ¼Ğ¾Ğ³ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ²ÑĞµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (foreign keys) Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ğ¼Ğ¸
            # checkfirst=True Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚, Ñ‡Ñ‚Ğ¾ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ½Ğµ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¿ĞµÑ€ĞµÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹
            # Ğ­Ñ‚Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… ĞµÑ‰Ğµ Ğ½ĞµÑ‚ Ğ² Ğ‘Ğ”
            await conn.run_sync(
                lambda sync_conn: Base.metadata.create_all(
                    bind=sync_conn, 
                    checkfirst=True
                )
            )
        self._logger.success(f"Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ [{table_names_str}] ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ (Ğ¸Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ»Ğ¸).")

    async def drop_specific_module_tables(self, module_model_classes: List[Type[Base]]) -> None:
        if not self._engine:
            err_msg = "DBManager Engine Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½. ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ."
            self._logger.error(err_msg)
            raise RuntimeError(err_msg)
        if not module_model_classes:
            self._logger.debug("ĞĞµÑ‚ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ (ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿ÑƒÑÑ‚).")
            return

        tables_to_drop = [model_cls.__table__ for model_cls in module_model_classes]
        tables_to_drop_ordered = tables_to_drop[::-1] 
        table_names_str = ", ".join([table.name for table in tables_to_drop_ordered])
        
        self._logger.warning(f"Ğ—ĞĞŸĞ ĞĞ¡ ĞĞ Ğ£Ğ”ĞĞ›Ğ•ĞĞ˜Ğ• Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦ ĞœĞĞ”Ğ£Ğ›Ğ¯ (ĞĞŸĞĞ¡ĞĞ!): [{table_names_str}]")
        
        async with self._engine.begin() as conn:
            await conn.run_sync(Base.metadata.drop_all, tables=tables_to_drop_ordered)
        self._logger.success(f"Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ [{table_names_str}] ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ£Ğ”ĞĞ›Ğ•ĞĞ«.")


======================================================================

------------------------------ FILE: Systems/core/database/db_utils.py ------------------------------
"""
Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¼Ğ¸ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼Ğ¸ Ğ±Ğ°Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….
"""
from typing import Optional, Dict, Any
from sqlalchemy import create_engine, text
from sqlalchemy.engine import Engine


class DatabaseDialectHandler:
    """ĞšĞ»Ğ°ÑÑ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ¸ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ´Ğ¸Ğ°Ğ»ĞµĞºÑ‚Ğ¾Ğ² Ğ‘Ğ”"""
    
    @staticmethod
    def get_dialect_features(engine: Engine) -> Dict[str, bool]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ´Ğ¸Ğ°Ğ»ĞµĞºÑ‚Ğ° Ğ‘Ğ”"""
        dialect_name = engine.dialect.name.lower()
        
        features = {
            'supports_comments': True,
            'supports_check_constraints': True,
            'supports_deferrable_fks': True,
            'supports_sequences': True,
            'supports_returning': True,
            'case_sensitive': True,
        }
        
        if dialect_name == 'sqlite':
            features.update({
                'supports_comments': False,
                'supports_deferrable_fks': False,
                'supports_sequences': False,
                'supports_returning': False,  # Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğµ Ğ²ĞµÑ€ÑĞ¸Ğ¸ SQLite
                'case_sensitive': False,
            })
        elif dialect_name in ['mysql', 'mariadb']:
            features.update({
                'supports_comments': True,
                'supports_check_constraints': True,  # MySQL 8.0+
                'supports_deferrable_fks': False,
                'supports_sequences': False,  # Ğ”Ğ¾ MySQL 8.0
                'supports_returning': False,
                'case_sensitive': False,  # Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº
            })
        elif dialect_name == 'postgresql':
            features.update({
                'supports_comments': True,
                'supports_check_constraints': True,
                'supports_deferrable_fks': True,
                'supports_sequences': True,
                'supports_returning': True,
                'case_sensitive': True,
            })
        
        return features
    
    @staticmethod
    def get_recommended_types(engine: Engine) -> Dict[str, str]:
        """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ´Ğ¸Ğ°Ğ»ĞµĞºÑ‚Ğ°"""
        dialect_name = engine.dialect.name.lower()
        
        if dialect_name == 'sqlite':
            return {
                'id': 'INTEGER',
                'bigint': 'INTEGER',
                'string_short': 'TEXT',
                'string_long': 'TEXT',
                'text': 'TEXT',
                'boolean': 'INTEGER',
                'datetime': 'DATETIME',
                'json': 'TEXT',
            }
        elif dialect_name in ['mysql', 'mariadb']:
            return {
                'id': 'INT AUTO_INCREMENT',
                'bigint': 'BIGINT',
                'string_short': 'VARCHAR(255)',
                'string_long': 'TEXT',
                'text': 'TEXT',
                'boolean': 'TINYINT(1)',
                'datetime': 'DATETIME',
                'json': 'JSON',  # MySQL 5.7+
            }
        elif dialect_name == 'postgresql':
            return {
                'id': 'SERIAL',
                'bigint': 'BIGINT',
                'string_short': 'VARCHAR(255)',
                'string_long': 'TEXT',
                'text': 'TEXT',
                'boolean': 'BOOLEAN',
                'datetime': 'TIMESTAMP WITH TIME ZONE',
                'json': 'JSONB',
            }
        
        return {}
    
    @staticmethod
    def create_db_if_not_exists(connection_url: str, db_name: str) -> bool:
        """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ° Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ (Ğ´Ğ»Ñ MySQL/PostgreSQL)"""
        try:
            if 'mysql' in connection_url or 'mariadb' in connection_url:
                # Ğ”Ğ»Ñ MySQL
                base_url = connection_url.rsplit('/', 1)[0]
                engine = create_engine(base_url + '/mysql')
                with engine.connect() as conn:
                    conn.execute(text(f"CREATE DATABASE IF NOT EXISTS `{db_name}` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci"))
                    conn.commit()
                return True
                
            elif 'postgresql' in connection_url:
                # Ğ”Ğ»Ñ PostgreSQL
                base_url = connection_url.rsplit('/', 1)[0]
                engine = create_engine(base_url + '/postgres')
                with engine.connect() as conn:
                    # PostgreSQL Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ Ğ´Ğ»Ñ CREATE DATABASE
                    conn.execute(text("COMMIT"))
                    result = conn.execute(text("SELECT 1 FROM pg_database WHERE datname = :db_name"), {"db_name": db_name})
                    if not result.fetchone():
                        # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ identifier()
                        from sqlalchemy import sql
                        conn.execute(text('CREATE DATABASE :db_name WITH ENCODING "UTF8"').bindparam(
                            sql.bindparam("db_name", db_name, literal_execute=True)))
                return True
                
        except Exception as e:
            print(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ğ‘Ğ” {db_name}: {e}")
            return False
        
        return True  # SQLite ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸


def get_db_info_query(dialect_name: str) -> Optional[str]:
    """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ SQL-Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ‘Ğ”"""
    if dialect_name == 'sqlite':
        return "SELECT sqlite_version() as version"
    elif dialect_name in ['mysql', 'mariadb']:
        return "SELECT VERSION() as version"
    elif dialect_name == 'postgresql':
        return "SELECT version() as version"
    return None


def optimize_for_dialect(engine: Engine) -> Dict[str, Any]:
    """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ Ğ´Ğ¸Ğ°Ğ»ĞµĞºÑ‚Ğ° Ğ‘Ğ”"""
    dialect_name = engine.dialect.name.lower()
    
    settings = {}
    
    if dialect_name == 'sqlite':
        settings = {
            'pool_pre_ping': False,
            'pool_recycle': -1,
            'echo': False,
            'connect_args': {
                'check_same_thread': False,
                'timeout': 30,
            }
        }
    elif dialect_name in ['mysql', 'mariadb']:
        settings = {
            'pool_pre_ping': True,
            'pool_recycle': 3600,
            'pool_size': 10,
            'max_overflow': 20,
            'connect_args': {
                'charset': 'utf8mb4',
                'connect_timeout': 60,
            }
        }
    elif dialect_name == 'postgresql':
        settings = {
            'pool_pre_ping': True,
            'pool_recycle': 3600,
            'pool_size': 10,
            'max_overflow': 20,
            'connect_args': {
                'connect_timeout': 60,
                'application_name': 'SwiftDevBot',
            }
        }
    
    return settings


======================================================================

------------------------------ FILE: Systems/core/database/core_models.py ------------------------------
# core/database/core_models.py
from datetime import datetime
from typing import List, Optional, TYPE_CHECKING
from sqlalchemy import String, ForeignKey, UniqueConstraint, Text, BigInteger
from sqlalchemy.orm import Mapped, mapped_column, relationship

from .base import SDBBaseModel 

SDB_CORE_TABLE_PREFIX = "sdb_"

if TYPE_CHECKING:
    pass 

def get_column_comment(text: str) -> Optional[str]:
    return text

class Permission(SDBBaseModel):
    __tablename__ = f"{SDB_CORE_TABLE_PREFIX}permissions"
    
    name: Mapped[str] = mapped_column(
        String(100), 
        unique=True, 
        index=True, 
        nullable=False, 
        comment=get_column_comment("Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ¼Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 'view_users', 'manage_modules')")
    )
    description: Mapped[Optional[str]] = mapped_column(
        Text, 
        nullable=True, 
        comment=get_column_comment("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ")
    )
    
    roles: Mapped[List["Role"]] = relationship(
        "Role",
        secondary=f"{SDB_CORE_TABLE_PREFIX}role_permissions",
        back_populates="permissions",
        lazy="selectin" 
    )
    
    # ĞĞ¾Ğ²Ğ¾Ğµ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    users_with_direct_access: Mapped[List["User"]] = relationship(
        "User",
        secondary=f"{SDB_CORE_TABLE_PREFIX}user_permissions", # Ğ˜Ğ¼Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ²ÑĞ·ÑƒÑÑ‰ĞµĞ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
        back_populates="direct_permissions",
        lazy="selectin" # Ğ¸Ğ»Ğ¸ "noload", ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ
    )

    def __repr__(self) -> str:
        return f"<Permission(id={self.id}, name='{self.name}')>"

class RolePermission(SDBBaseModel):
    __tablename__ = f"{SDB_CORE_TABLE_PREFIX}role_permissions"
    __table_args__ = (
        UniqueConstraint('role_id', 'permission_id', name=f'uq_{SDB_CORE_TABLE_PREFIX}role_permissions_role_id_permission_id'),
    )
    
    role_id: Mapped[int] = mapped_column(
        ForeignKey(f"{SDB_CORE_TABLE_PREFIX}roles.id", ondelete="CASCADE"), 
        nullable=False, 
        index=True,
        comment=get_column_comment("ID Ñ€Ğ¾Ğ»Ğ¸")
    )
    permission_id: Mapped[int] = mapped_column(
        ForeignKey(f"{SDB_CORE_TABLE_PREFIX}permissions.id", ondelete="CASCADE"), 
        nullable=False, 
        index=True,
        comment=get_column_comment("ID Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ")
    )

    def __repr__(self) -> str:
        return f"<RolePermission(id={self.id}, role_id={self.role_id}, permission_id={self.permission_id})>"
        
class Role(SDBBaseModel):
    __tablename__ = f"{SDB_CORE_TABLE_PREFIX}roles"
    
    name: Mapped[str] = mapped_column(
        String(50), 
        unique=True, 
        index=True, 
        nullable=False, 
        comment=get_column_comment("Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ¼Ñ Ñ€Ğ¾Ğ»Ğ¸")
    )
    description: Mapped[Optional[str]] = mapped_column(
        Text, 
        nullable=True, 
        comment=get_column_comment("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸")
    )
    
    users: Mapped[List["User"]] = relationship(
        "User", 
        secondary=f"{SDB_CORE_TABLE_PREFIX}user_roles",
        back_populates="roles",
        lazy="selectin",
        cascade="save-update, merge" 
    )

    permissions: Mapped[List["Permission"]] = relationship(
        "Permission",
        secondary=f"{SDB_CORE_TABLE_PREFIX}role_permissions",
        back_populates="roles",
        lazy="selectin", 
        cascade="save-update, merge"
    )

    def __repr__(self) -> str:
        return f"<Role(id={self.id}, name='{self.name}')>"


class UserRole(SDBBaseModel):
    __tablename__ = f"{SDB_CORE_TABLE_PREFIX}user_roles"
    __table_args__ = (
        UniqueConstraint('user_id', 'role_id', name=f'uq_{SDB_CORE_TABLE_PREFIX}user_roles_user_id_role_id'),
    )
    
    user_id: Mapped[int] = mapped_column(
        ForeignKey(f"{SDB_CORE_TABLE_PREFIX}users.id", ondelete="CASCADE"), 
        nullable=False, 
        index=True,
        comment=get_column_comment("ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ")
    )
    role_id: Mapped[int] = mapped_column(
        ForeignKey(f"{SDB_CORE_TABLE_PREFIX}roles.id", ondelete="CASCADE"), 
        nullable=False, 
        index=True,
        comment=get_column_comment("ID Ñ€Ğ¾Ğ»Ğ¸")
    )

    def __repr__(self) -> str:
        return f"<UserRole(id={self.id}, user_id={self.user_id}, role_id={self.role_id})>"

# --- ĞĞ¾Ğ²Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ»Ñ ÑĞ²ÑĞ·Ğ¸ User <-> Permission ---
class UserPermission(SDBBaseModel):
    __tablename__ = f"{SDB_CORE_TABLE_PREFIX}user_permissions"
    __table_args__ = (
        UniqueConstraint('user_id', 'permission_id', name=f'uq_{SDB_CORE_TABLE_PREFIX}user_permissions_user_id_permission_id'),
    )

    user_id: Mapped[int] = mapped_column(
        ForeignKey(f"{SDB_CORE_TABLE_PREFIX}users.id", ondelete="CASCADE"),
        nullable=False,
        index=True,
        comment=get_column_comment("ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ")
    )
    permission_id: Mapped[int] = mapped_column(
        ForeignKey(f"{SDB_CORE_TABLE_PREFIX}permissions.id", ondelete="CASCADE"),
        nullable=False,
        index=True,
        comment=get_column_comment("ID Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ")
    )

    def __repr__(self) -> str:
        return f"<UserPermission(id={self.id}, user_id={self.user_id}, permission_id={self.permission_id})>"


class User(SDBBaseModel):
    __tablename__ = f"{SDB_CORE_TABLE_PREFIX}users"

    username_lower: Mapped[Optional[str]] = mapped_column(
        String(32), 
        nullable=True, 
        index=True, 
        comment=get_column_comment("Telegram username Ğ² Ğ½Ğ¸Ğ¶Ğ½ĞµĞ¼ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğµ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ°")
    )
    
    telegram_id: Mapped[int] = mapped_column(
        BigInteger, 
        unique=True, 
        index=True, 
        nullable=False, 
        comment=get_column_comment("Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Telegram ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ")
    )
    username: Mapped[Optional[str]] = mapped_column( 
        String(32), 
        nullable=True, 
        index=True, 
        comment=get_column_comment("Telegram username (Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€)")
    )
    first_name: Mapped[Optional[str]] = mapped_column(
        String(255), 
        nullable=True, 
        comment=get_column_comment("Ğ˜Ğ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ")
    )
    last_name: Mapped[Optional[str]] = mapped_column(
        String(255), 
        nullable=True, 
        comment=get_column_comment("Ğ¤Ğ°Ğ¼Ğ¸Ğ»Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ")
    )
    preferred_language_code: Mapped[Optional[str]] = mapped_column(
        String(10), 
        nullable=True, 
        comment=get_column_comment("ĞšĞ¾Ğ´ ÑĞ·Ñ‹ĞºĞ° Ğ±Ğ¾Ñ‚Ğ°")
    )
    is_active: Mapped[bool] = mapped_column(
        default=True, 
        nullable=False, 
        comment=get_column_comment("ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½ Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ")
    )
    is_bot_blocked: Mapped[bool] = mapped_column(
        default=False, 
        nullable=False, 
        comment=get_column_comment("Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ» Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ±Ğ¾Ñ‚Ğ°")
    )
    last_activity_at: Mapped[Optional[datetime]] = mapped_column(
        nullable=True, 
        comment=get_column_comment("Ğ’Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸")
    )

    roles: Mapped[List["Role"]] = relationship(
        "Role", 
        secondary=f"{SDB_CORE_TABLE_PREFIX}user_roles",
        back_populates="users",
        lazy="selectin",
        cascade="save-update, merge"
    )
    
    # ĞĞ¾Ğ²Ğ¾Ğµ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹
    direct_permissions: Mapped[List["Permission"]] = relationship(
        "Permission",
        secondary=f"{SDB_CORE_TABLE_PREFIX}user_permissions", # Ğ˜Ğ¼Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ²ÑĞ·ÑƒÑÑ‰ĞµĞ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
        back_populates="users_with_direct_access",
        lazy="selectin", # Ğ¸Ğ»Ğ¸ "noload", ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ÑĞ·ĞµÑ€Ğ°
        cascade="save-update, merge" # ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸Ñ‚ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· user.direct_permissions.append()
    )
    
    @property
    def full_name(self) -> str:
        parts = []
        if self.first_name: parts.append(self.first_name)
        if self.last_name: parts.append(self.last_name)
        if parts: return " ".join(parts)
        elif self.username: return f"@{self.username}"
        return f"User_{self.telegram_id}"

    def __repr__(self) -> str:
        return f"<User(id={self.id}, tg_id={self.telegram_id}, name='{self.full_name}')>"


======================================================================

------------------------------ FILE: Systems/core/database/__init__.py ------------------------------



======================================================================

------------------------------ FILE: Systems/core/errors/exceptions.py ------------------------------
# core/errors/exceptions.py
"""
ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğµ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ SwiftDevBot
"""


class SDBException(Exception):
    """Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ SwiftDevBot"""
    def __init__(self, message: str, error_code: str = "UNKNOWN_ERROR", details: dict = None):
        self.message = message
        self.error_code = error_code
        self.details = details or {}
        super().__init__(self.message)


class DatabaseError(SDBException):
    """ĞÑˆĞ¸Ğ±ĞºĞ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
    def __init__(self, message: str, details: dict = None):
        super().__init__(message, "DATABASE_ERROR", details)


class ModuleError(SDBException):
    """ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
    def __init__(self, message: str, module_name: str = None, details: dict = None):
        super().__init__(message, "MODULE_ERROR", details)
        self.module_name = module_name


class PermissionError(SDBException):
    """ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°"""
    def __init__(self, message: str, permission: str = None, details: dict = None):
        super().__init__(message, "PERMISSION_ERROR", details)
        self.permission = permission


class ValidationError(SDBException):
    """ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸"""
    def __init__(self, message: str, field: str = None, details: dict = None):
        super().__init__(message, "VALIDATION_ERROR", details)
        self.field = field


class RateLimitError(SDBException):
    """ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½Ğ¸Ñ rate limit"""
    def __init__(self, message: str, retry_after: int = 0, details: dict = None):
        super().__init__(message, "RATE_LIMIT_ERROR", details)
        self.retry_after = retry_after


class ConfigurationError(SDBException):
    """ĞÑˆĞ¸Ğ±ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸"""
    def __init__(self, message: str, config_key: str = None, details: dict = None):
        super().__init__(message, "CONFIGURATION_ERROR", details)
        self.config_key = config_key


class ExternalAPIError(SDBException):
    """ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ½ĞµÑˆĞ½ĞµĞ³Ğ¾ API"""
    def __init__(self, message: str, api_name: str = None, status_code: int = None, details: dict = None):
        super().__init__(message, "EXTERNAL_API_ERROR", details)
        self.api_name = api_name
        self.status_code = status_code


class CacheError(SDBException):
    """ĞÑˆĞ¸Ğ±ĞºĞ° ĞºÑÑˆĞ°"""
    def __init__(self, message: str, details: dict = None):
        super().__init__(message, "CACHE_ERROR", details)


class SecurityError(SDBException):
    """ĞÑˆĞ¸Ğ±ĞºĞ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    def __init__(self, message: str, threat_type: str = None, details: dict = None):
        super().__init__(message, "SECURITY_ERROR", details)
        self.threat_type = threat_type




======================================================================

------------------------------ FILE: Systems/core/errors/handler.py ------------------------------
# core/errors/handler.py
"""
Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
"""

import traceback
from typing import Optional, Dict, Any
from loguru import logger

from aiogram import BaseMiddleware
from aiogram.types import TelegramObject, Update, Message, CallbackQuery, ErrorEvent
from aiogram.exceptions import TelegramAPIError, TelegramRetryAfter, TelegramBadRequest

from .exceptions import (
    SDBException, DatabaseError, ModuleError, PermissionError,
    ValidationError, RateLimitError, ConfigurationError,
    ExternalAPIError, CacheError, SecurityError
)


class ErrorHandlerMiddleware(BaseMiddleware):
    """
    Middleware Ğ´Ğ»Ñ Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
    """
    
    def __init__(self):
        super().__init__()
        self._logger = logger.bind(service="ErrorHandlerMiddleware")
    
    async def __call__(
        self,
        handler,
        event: Update,
        data: Dict
    ):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ Ğ¿ĞµÑ€ĞµÑ…Ğ²Ğ°Ñ‚Ğ¾Ğ¼ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¹"""
        try:
            return await handler(event, data)
        except RateLimitError as e:
            return await self._handle_rate_limit_error(e, event)
        except PermissionError as e:
            return await self._handle_permission_error(e, event)
        except ValidationError as e:
            return await self._handle_validation_error(e, event)
        except DatabaseError as e:
            return await self._handle_database_error(e, event)
        except ModuleError as e:
            return await self._handle_module_error(e, event)
        except TelegramRetryAfter as e:
            return await self._handle_telegram_retry_after(e, event)
        except TelegramAPIError as e:
            return await self._handle_telegram_api_error(e, event)
        except SDBException as e:
            return await self._handle_sdb_exception(e, event)
        except Exception as e:
            return await self._handle_unexpected_error(e, event)
    
    async def _handle_rate_limit_error(self, error: RateLimitError, event: Update):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ rate limit"""
        self._logger.warning(f"Rate limit error: {error.message}")
        message = f"â³ Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ². ĞŸĞ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ {error.retry_after} ÑĞµĞºÑƒĞ½Ğ´."
        return await self._send_error_message(event, message)
    
    async def _handle_permission_error(self, error: PermissionError, event: Update):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°"""
        self._logger.warning(f"Permission error: {error.message} (permission: {error.permission})")
        message = f"âŒ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ.\n{error.message}"
        return await self._send_error_message(event, message, show_alert=True)
    
    async def _handle_validation_error(self, error: ValidationError, event: Update):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸"""
        self._logger.warning(f"Validation error: {error.message} (field: {error.field})")
        message = f"âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸: {error.message}"
        return await self._send_error_message(event, message)
    
    async def _handle_database_error(self, error: DatabaseError, event: Update):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ‘Ğ”"""
        self._logger.error(f"Database error: {error.message}", exc_info=True)
        message = "âŒ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ Ñ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ."
        return await self._send_error_message(event, message)
    
    async def _handle_module_error(self, error: ModuleError, event: Update):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        self._logger.error(f"Module error in {error.module_name}: {error.message}", exc_info=True)
        message = f"âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {error.module_name}: {error.message}"
        return await self._send_error_message(event, message)
    
    async def _handle_telegram_retry_after(self, error: TelegramRetryAfter, event: Update):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Telegram RetryAfter"""
        self._logger.warning(f"Telegram RetryAfter: {error.retry_after} seconds")
        # ĞĞµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼
        return None
    
    async def _handle_telegram_api_error(self, error: TelegramAPIError, event: Update):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Telegram API"""
        self._logger.error(f"Telegram API error: {error.message}", exc_info=True)
        
        # Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ´Ğ»Ñ Ğ½ĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
        if isinstance(error, TelegramBadRequest):
            if "message is too long" in str(error).lower():
                message = "âŒ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğµ."
            elif "can't parse" in str(error).lower():
                message = "âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ."
            else:
                message = "âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ."
        else:
            message = "âŒ Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Telegram API. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ."
        
        return await self._send_error_message(event, message)
    
    async def _handle_sdb_exception(self, error: SDBException, event: Update):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ SDB"""
        self._logger.error(f"SDB Exception [{error.error_code}]: {error.message}", exc_info=True)
        message = f"âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: {error.message}"
        return await self._send_error_message(event, message)
    
    async def _handle_unexpected_error(self, error: Exception, event: Update):
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ½ĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº"""
        error_traceback = traceback.format_exc()
        self._logger.critical(
            f"Unexpected error: {type(error).__name__}: {error}",
            exc_info=True
        )
        
        # Ğ’ Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğµ Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        message = "âŒ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ½ĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°. ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½."
        return await self._send_error_message(event, message)
    
    async def _send_error_message(
        self, 
        event: Update, 
        message: str, 
        show_alert: bool = False
    ) -> Optional[Any]:
        """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"""
        try:
            if event.message:
                await event.message.answer(message)
            elif event.callback_query:
                await event.callback_query.answer(message, show_alert=show_alert)
        except Exception as e:
            self._logger.error(f"Failed to send error message: {e}")
        return None


async def handle_error(event: ErrorEvent, exception: Exception):
    """
    Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ´Ğ»Ñ aiogram
    """
    logger.error(
        f"Unhandled error in aiogram: {type(exception).__name__}: {exception}",
        exc_info=exception
    )




======================================================================

------------------------------ FILE: Systems/core/errors/__init__.py ------------------------------
# core/errors/__init__.py
"""
ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
"""

from .exceptions import (
    SDBException,
    DatabaseError,
    ModuleError,
    PermissionError,
    ValidationError,
    RateLimitError,
    ConfigurationError,
    ExternalAPIError,
    CacheError,
    SecurityError
)

from .handler import ErrorHandlerMiddleware, handle_error

__all__ = [
    "SDBException",
    "DatabaseError",
    "ModuleError",
    "PermissionError",
    "ValidationError",
    "RateLimitError",
    "ConfigurationError",
    "ExternalAPIError",
    "CacheError",
    "SecurityError",
    "ErrorHandlerMiddleware",
    "handle_error"
]




======================================================================

------------------------------ FILE: Systems/core/admin/keyboards_admin_common.py ------------------------------
# core/admin/keyboards_admin_common.py
from aiogram import types 
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.utils.keyboard import InlineKeyboardBuilder 
from Systems.core.ui.callback_data_factories import CoreMenuNavigate, AdminMainMenuNavigate

from typing import TYPE_CHECKING, Optional
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from Systems.core.i18n.translator import Translator
    from sqlalchemy.ext.asyncio import AsyncSession
    from Systems.core.rbac.service import (
        PERMISSION_CORE_USERS_VIEW_LIST,
        PERMISSION_CORE_MODULES_VIEW_LIST,
        PERMISSION_CORE_SYSTEM_VIEW_INFO_BASIC,
        PERMISSION_CORE_SYSTEM_VIEW_INFO_FULL,
        PERMISSION_CORE_ROLES_VIEW
    )

# Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºÑÑˆ Ğ´Ğ»Ñ translator Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
_admin_translator_cache: Optional['Translator'] = None

def _get_admin_translator(services_provider: 'BotServicesProvider') -> 'Translator':
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ translator Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸"""
    global _admin_translator_cache
    if _admin_translator_cache is None:
        from Systems.core.i18n.translator import Translator
        _admin_translator_cache = Translator(
            locales_dir=services_provider.config.core.i18n.locales_dir,
            domain=services_provider.config.core.i18n.domain,
            default_locale=services_provider.config.core.i18n.default_locale,
            available_locales=services_provider.config.core.i18n.available_locales
        )
    return _admin_translator_cache

def get_admin_texts(services_provider: 'BotServicesProvider', locale: Optional[str] = None) -> dict:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸"""
    if not locale:
        locale = services_provider.config.core.i18n.default_locale
    
    translator = _get_admin_translator(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, locale, **kwargs)
    
    return {
        "admin_panel_title": t("admin_panel_title"),
        "admin_panel_select_section": t("admin_panel_select_section"),
        "admin_no_access": t("admin_no_access"),
        "admin_modules_in_development": t("admin_modules_in_development"),
        "back_to_main_menu_sdb": t("admin_back_to_main_menu_sdb"),
        "back_to_admin_menu_main": t("admin_back_to_admin_menu_main"),
        "pagination_prev": t("admin_pagination_prev"),
        "pagination_next": t("admin_pagination_next"),
        "confirm_yes": t("admin_confirm_yes"),
        "confirm_no": t("admin_confirm_no"),
        "close_message": t("admin_close_message"),
        "error_general": t("admin_error_general"),
        "access_denied": t("admin_access_denied"),
        "not_found_generic": t("admin_not_found_generic"),
        "system_info": t("admin_system_info"),
        "manage_modules": t("admin_manage_modules"),
        "manage_users": t("admin_manage_users"),
        "manage_roles": t("admin_manage_roles"),
        "perm_category_core": t("admin_perm_category_core"),
        "perm_category_modules": t("admin_perm_category_modules"),
        "perm_core_group_users": t("admin_perm_core_group_users"),
        "perm_core_group_roles": t("admin_perm_core_group_roles"),
        "perm_core_group_modules_core": t("admin_perm_core_group_modules_core"),
        "perm_core_group_system": t("admin_perm_core_group_system"),
        "perm_core_group_settings_core": t("admin_perm_core_group_settings_core"),
        "perm_core_group_other": t("admin_perm_core_group_other"),
        "back_to_perm_categories": t("admin_back_to_perm_categories"),
        "back_to_core_perm_groups": t("admin_back_to_core_perm_groups"),
        "back_to_module_list_for_perms": t("admin_back_to_module_list_for_perms"),
        "no_modules_with_perms": t("admin_no_modules_with_perms"),
        "no_permissions_in_group": t("admin_no_permissions_in_group"),
        "fsm_enter_role_name": t("admin_fsm_enter_role_name"),
        "fsm_role_name_empty": t("admin_fsm_role_name_empty"),
        "fsm_role_name_taken": t("admin_fsm_role_name_taken"),
        "fsm_enter_role_description": t("admin_fsm_enter_role_description"),
        "fsm_command_skip_description": t("admin_fsm_command_skip_description"),
        "fsm_command_cancel_role_creation": t("admin_fsm_command_cancel_role_creation"),
        "fsm_role_created_successfully": t("admin_fsm_role_created_successfully"),
        "fsm_role_creation_cancelled": t("admin_fsm_role_creation_cancelled"),
        "fsm_edit_role_title": t("admin_fsm_edit_role_title"),
        "fsm_edit_role_name_not_allowed": t("admin_fsm_edit_role_name_not_allowed"),
        "fsm_enter_new_role_description": t("admin_fsm_enter_new_role_description"),
        "fsm_enter_new_role_name": t("admin_fsm_enter_new_role_name"),
        "fsm_command_skip_name": t("admin_fsm_command_skip_name"),
        "fsm_command_cancel_role_edit": t("admin_fsm_command_cancel_role_edit"),
        "fsm_role_updated_successfully": t("admin_fsm_role_updated_successfully"),
        "fsm_role_update_cancelled": t("admin_fsm_role_update_cancelled"),
        "delete_role_confirm_text": t("admin_delete_role_confirm_text"),
        "role_is_standard_cant_delete": t("admin_role_is_standard_cant_delete"),
        "role_delete_failed": t("admin_role_delete_failed"),
        "role_deleted_successfully": t("admin_role_deleted_successfully"),
        "admin_role_permissions_heading": t("admin_role_permissions_heading"),
        "admin_cache_section": t("admin_cache_section"),
        "admin_role_no_permissions": t("admin_role_no_permissions"),
        "admin_role_description_label": t("admin_role_description_label"),
        "admin_role_permissions_label": t("admin_role_permissions_label"),
        "admin_back_to_role_details": t("admin_back_to_role_details"),
        "admin_error_saving_role": t("admin_error_saving_role"),
        "admin_no_registered_users_notice": t("admin_no_registered_users_notice"),
    }

# Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğ¹ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (deprecated, Ğ±ÑƒĞ´ĞµÑ‚ ÑƒĞ´Ğ°Ğ»ĞµĞ½)
ADMIN_COMMON_TEXTS = {
    "back_to_main_menu_sdb": "ğŸ  Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ SDB",
    "back_to_admin_menu_main": "â¬…ï¸ ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ (Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ)",
    "pagination_prev": "â¬…ï¸ ĞŸÑ€ĞµĞ´.",
    "pagination_next": "Ğ¡Ğ»ĞµĞ´. â¡ï¸",
    "confirm_yes": "âœ… Ğ”Ğ°",
    "confirm_no": "âŒ ĞĞµÑ‚",
    "close_message": "âŒ Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ ÑÑ‚Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ",
    "error_general": "ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ.",
    "access_denied": "Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ.",
    "not_found_generic": "Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.",
    
    # Ğ¢ĞµĞºÑÑ‚Ñ‹ Ğ´Ğ»Ñ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½ĞºĞ¸ - Ğ±Ğ¾Ğ»ĞµĞµ Ñ‡ĞµÑ‚ĞºĞ¸Ğµ Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾ ÑĞ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ
    "system_info": "â„¹ï¸ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ",
    "manage_modules": "ğŸ§© Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸", 
    "manage_users": "ğŸ‘¥ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸",
    "manage_roles": "ğŸ›¡ï¸ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸",

    # Ğ¢ĞµĞºÑÑ‚Ñ‹ Ğ´Ğ»Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹ Ğ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹)
    "perm_category_core": "Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¯Ğ´Ñ€Ğ°",
    "perm_category_modules": "Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ ĞœĞ¾Ğ´ÑƒĞ»ĞµĞ¹",
    "perm_core_group_users": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ (Ğ¯Ğ´Ñ€Ğ¾)",
    "perm_core_group_roles": "Ğ Ğ¾Ğ»Ğ¸ (Ğ¯Ğ´Ñ€Ğ¾)",
    "perm_core_group_modules_core": "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸ (Ğ¯Ğ´Ñ€Ğ¾)", # Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾ Ğ´Ğ»Ñ ÑÑĞ½Ğ¾ÑÑ‚Ğ¸
    "perm_core_group_system": "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° (Ğ¯Ğ´Ñ€Ğ¾)",
    "perm_core_group_settings_core": "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¯Ğ´Ñ€Ğ°",
    "perm_core_group_other": "ĞŸÑ€Ğ¾Ñ‡Ğ¸Ğµ (Ğ¯Ğ´Ñ€Ğ¾)",
    "back_to_perm_categories": "â¬…ï¸ Ğš ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹",
    "back_to_core_perm_groups": "â¬…ï¸ Ğš Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ğ¼ Ğ¯Ğ´Ñ€Ğ°",
    "back_to_module_list_for_perms": "â¬…ï¸ Ğš ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (Ğ´Ğ»Ñ Ğ¿Ñ€Ğ°Ğ²)",
    "no_modules_with_perms": "ĞĞµÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ñ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ¿Ñ€Ğ°Ğ²",
    "no_permissions_in_group": "Ğ’ ÑÑ‚Ğ¾Ğ¹ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğµ Ğ½ĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹",
    "admin_role_permissions_heading": "ĞÑ‚Ğ¼ĞµÑ‚ÑŒÑ‚Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ/ÑĞ½ÑÑ‚Ğ¸Ñ:",
    "admin_cache_section": "ğŸ’¾ ĞšÑÑˆ",
    "admin_role_no_permissions": "  (Ğ½ĞµÑ‚ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹)",
    "admin_role_description_label": "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:",
    "admin_role_permissions_label": "Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸:",
    "admin_back_to_role_details": "â¬…ï¸ Ğš Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼ Ñ€Ğ¾Ğ»Ğ¸",
    "admin_error_saving_role": "ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ»Ğ¸.",
    "admin_no_registered_users_notice": "ğŸ‘¥ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸\n\nĞ’ Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½ĞµÑ‚ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.",

    # Ğ¢ĞµĞºÑÑ‚Ñ‹ Ğ´Ğ»Ñ FSM (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹)
    "fsm_enter_role_name": "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ¼Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸:",
    "fsm_role_name_empty": "Ğ˜Ğ¼Ñ Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼.",
    "fsm_role_name_taken": "Ğ Ğ¾Ğ»ÑŒ Ñ Ğ¸Ğ¼ĞµĞ½ĞµĞ¼ \"{role_name}\" ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚.",
    "fsm_enter_role_description": "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ {role_name}:",
    "fsm_command_skip_description": "/skip_description - ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ",
    "fsm_command_cancel_role_creation": "/cancel_role_creation - ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ",
    "fsm_role_created_successfully": "Ğ Ğ¾Ğ»ÑŒ \"{role_name}\" ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°!",
    "fsm_role_creation_cancelled": "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾.",
    
    "fsm_edit_role_title": "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸: {role_name}",
    "fsm_edit_role_name_not_allowed": "Ğ˜Ğ¼Ñ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸ {role_name} Ğ¸Ğ·Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ½ĞµĞ»ÑŒĞ·Ñ.",
    "fsm_enter_new_role_description": "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ {role_name} (Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ: {current_description}):",
    "fsm_enter_new_role_name": "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¸Ğ¼Ñ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ (Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ: {current_name}):",
    "fsm_command_skip_name": "/skip_name - ĞÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ",
    "fsm_command_cancel_role_edit": "/cancel_role_edit - ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ",
    "fsm_role_updated_successfully": "Ğ Ğ¾Ğ»ÑŒ \"{role_name}\" ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°!",
    "fsm_role_update_cancelled": "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾.",

    "delete_role_confirm_text": "Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ {role_name}?\n{warning_if_users}\nĞ­Ñ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ½ĞµĞ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ğ¼Ğ¾!",
    "role_is_standard_cant_delete": "Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½ÑƒÑ Ñ€Ğ¾Ğ»ÑŒ \"{role_name}\" ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Ğ½ĞµĞ»ÑŒĞ·Ñ.",
    "role_delete_failed": "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ \"{role_name}\".",
    "role_deleted_successfully": "Ğ Ğ¾Ğ»ÑŒ \"{role_name}\" ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ°.",
}

def get_back_to_admin_main_menu_button(services_provider: Optional['BotServicesProvider'] = None, locale: Optional[str] = None) -> InlineKeyboardButton:
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğ² Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°Ğ¼Ğ¸"""
    if services_provider:
        texts = get_admin_texts(services_provider, locale)
        text = texts["back_to_admin_menu_main"]
    else:
        text = ADMIN_COMMON_TEXTS["back_to_admin_menu_main"]
    return InlineKeyboardButton(
        text=text,
        callback_data=AdminMainMenuNavigate(target_section="main_admin").pack()
    )

def get_back_to_sdb_main_menu_button(services_provider: Optional['BotServicesProvider'] = None, locale: Optional[str] = None) -> InlineKeyboardButton:
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğ² Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ SDB Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°Ğ¼Ğ¸"""
    if services_provider:
        texts = get_admin_texts(services_provider, locale)
        text = texts["back_to_main_menu_sdb"]
    else:
        text = ADMIN_COMMON_TEXTS["back_to_main_menu_sdb"]
    return InlineKeyboardButton(
        text=text,
        callback_data=CoreMenuNavigate(target_menu="main").pack()
    )

async def get_admin_main_menu_keyboard( 
    services: 'BotServicesProvider',
    user_tg_id: int,
    session: 'AsyncSession',
    locale: Optional[str] = None
) -> types.InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸Ğ· Ğ‘Ğ”, ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ½
    if not locale:
        try:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == user_tg_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                locale = db_user.preferred_language_code
        except Exception:
            pass
        
        if not locale:
            locale = services.config.core.i18n.default_locale
    
    texts = get_admin_texts(services, locale) 

    rbac = services.rbac
    user_is_owner_from_config = user_tg_id in services.config.core.super_admins

    from Systems.core.rbac.service import (
        PERMISSION_CORE_USERS_VIEW_LIST,
        PERMISSION_CORE_MODULES_VIEW_LIST,
        PERMISSION_CORE_SYSTEM_VIEW_INFO_BASIC,
        PERMISSION_CORE_SYSTEM_VIEW_INFO_FULL,
        PERMISSION_CORE_ROLES_VIEW
    )
    
    # Ğ‘Ğ›ĞĞš 1: Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞĞ™ (Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸)
    system_buttons = []
    
    # Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ
    if user_is_owner_from_config or \
       await rbac.user_has_permission(session, user_tg_id, PERMISSION_CORE_SYSTEM_VIEW_INFO_BASIC) or \
       await rbac.user_has_permission(session, user_tg_id, PERMISSION_CORE_SYSTEM_VIEW_INFO_FULL):
        system_buttons.append((texts["system_info"], AdminMainMenuNavigate(target_section="sys_info")))

    # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸ (Ğ²Ğ°Ğ¶Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ)
    if user_is_owner_from_config or \
       await rbac.user_has_permission(session, user_tg_id, PERMISSION_CORE_MODULES_VIEW_LIST):
        system_buttons.append((texts["manage_modules"], AdminMainMenuNavigate(target_section="modules")))
    
    # Ğ‘Ğ›ĞĞš 2: Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¯ĞœĞ˜
    user_management_buttons = []
    
    # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸
    if user_is_owner_from_config or \
       await rbac.user_has_permission(session, user_tg_id, PERMISSION_CORE_USERS_VIEW_LIST):
        user_management_buttons.append((texts["manage_users"], AdminMainMenuNavigate(target_section="users")))
    
    # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸
    if user_is_owner_from_config or \
       await rbac.user_has_permission(session, user_tg_id, PERMISSION_CORE_ROLES_VIEW): 
        user_management_buttons.append((texts["manage_roles"], AdminMainMenuNavigate(target_section="roles")))

    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ğ¼Ğ¸ Ğ´Ğ»Ñ Ğ»ÑƒÑ‡ÑˆĞµĞ¹ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
    for text, callback_data in system_buttons:
        builder.button(text=text, callback_data=callback_data.pack())
    
    for text, callback_data in user_management_buttons:
        builder.button(text=text, callback_data=callback_data.pack())
    
    # Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°: ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ ÑĞ²ĞµÑ€Ñ…Ñƒ, Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ ÑĞ½Ğ¸Ğ·Ñƒ, Ğ¿Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ² Ñ€ÑĞ´ Ğ´Ğ»Ñ Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ğ¾ÑÑ‚Ğ¸
    if builder.export(): 
        builder.adjust(1)

    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğ² Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ²Ğ½Ğ¸Ğ·Ñƒ
    builder.row(get_back_to_sdb_main_menu_button(services, locale)) 
    return builder.as_markup()


======================================================================

------------------------------ FILE: Systems/core/admin/handlers_module_management.py ------------------------------
# core/admin/handlers_module_management.py
import logging
from aiogram import Router, types
from aiogram.filters import Command

router = Router()

@router.message(Command("some_command")) 
async def some_handler(message: types.Message):
    await message.answer("You triggered some_command!")


======================================================================

------------------------------ FILE: Systems/core/admin/filters_admin.py ------------------------------
# core/admin/filters_admin.py

from aiogram import types
from loguru import logger

# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
from Systems.core.rbac.service import PERMISSION_CORE_VIEW_ADMIN_PANEL 

from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider

MODULE_NAME_FOR_LOG = "AdminFilters"

async def can_view_admin_panel_filter(event: types.TelegramObject, services_provider: 'BotServicesProvider') -> bool:
    """
    ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ¸Ğ¼ĞµĞµÑ‚ Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğ¼ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°Ğ¼ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸.
    Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½, ĞµÑĞ»Ğ¸:
    1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ğ² ÑĞ¿Ğ¸ÑĞºĞµ super_admins Ğ¸Ğ· ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸.
    2. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¸Ğ¼ĞµĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ PERMISSION_CORE_VIEW_ADMIN_PANEL.
    """
    user = getattr(event, 'from_user', None) 
    if not user: 
        logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ±ĞµĞ· 'from_user', Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ğ½Ğµ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½.")
        return False

    user_id = user.id
    user_mention = f"@{user.username}" if user.username else f"ID:{user.id}"

    if user_id in services_provider.config.core.super_admins:
        logger.trace(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_mention} Ğ¸Ğ¼ĞµĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ (super_admin Ğ¸Ğ· config).")
        return True
    try:
        async with services_provider.db.get_session() as session:
            has_permission = await services_provider.rbac.user_has_permission(
                session, user_id, PERMISSION_CORE_VIEW_ADMIN_PANEL
            )
            if has_permission:
                logger.trace(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_mention} Ğ¸Ğ¼ĞµĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{PERMISSION_CORE_VIEW_ADMIN_PANEL}' (Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½).")
                return True
    except Exception as e:
        logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ '{PERMISSION_CORE_VIEW_ADMIN_PANEL}' Ğ´Ğ»Ñ {user_mention} Ğ² Ğ‘Ğ”: {e}", exc_info=True)
        return False 
    
    logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_mention} "
                   f"Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ°Ğ»ÑÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ğ±ĞµĞ· Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ '{PERMISSION_CORE_VIEW_ADMIN_PANEL}'.")
    return False



======================================================================

------------------------------ FILE: Systems/core/admin/handlers_log_viewer.py ------------------------------
# core/admin/handlers_log_viewer.py
import logging
from aiogram import Router, types
from aiogram.filters import Command

router = Router()

@router.message(Command("some_command")) 
async def some_handler(message: types.Message):
    await message.answer("You triggered some_command!")


======================================================================

------------------------------ FILE: Systems/core/admin/__init__.py ------------------------------
# core/admin/__init__.py
from aiogram import Router
from loguru import logger

# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ "ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‰Ğ¸Ğµ" Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ñ‹ Ğ¸Ğ· ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°
try:
    from .entry import section_entry_router # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‰Ğ¸Ğ¹ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°
    logger.info("Admin submodule 'entry' (section router) loaded.")
except ImportError as e:
    section_entry_router = Router(name="sdb_admin_entry_stub_main") 
    logger.error(f"Failed to load admin submodule 'entry' (section router): {e}")

try:
    from .users import section_users_router # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‰Ğ¸Ğ¹ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°
    logger.info("Admin submodule 'users' (section router) loaded.")
except ImportError as e:
    section_users_router = Router(name="sdb_admin_users_stub_main")
    logger.error(f"Failed to load admin submodule 'users' (section router): {e}")

try:
    from .roles import section_roles_router # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‰Ğ¸Ğ¹ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°
    logger.info("Admin submodule 'roles' (section router) loaded.")
except ImportError as e:
    section_roles_router = Router(name="sdb_admin_roles_stub_main")
    logger.error(f"Failed to load admin submodule 'roles' (section router): {e}")

try:
    from .sys_info import section_sys_info_router # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‰Ğ¸Ğ¹ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°
    logger.info("Admin submodule 'sys_info' (section router) loaded.")
except ImportError as e:
    section_sys_info_router = Router(name="sdb_admin_sys_info_stub_main")
    logger.error(f"Failed to load admin submodule 'sys_info' (section router): {e}")

try:
    from .modules_mgmt import section_modules_mgmt_router # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‰Ğ¸Ğ¹ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°
    logger.info("Admin submodule 'modules_mgmt' (section router) loaded.")
except ImportError as e:
    section_modules_mgmt_router = Router(name="sdb_admin_modules_mgmt_stub_main")
    logger.error(f"Failed to load admin submodule 'modules_mgmt' (section router): {e}")

try:
    from .logs_viewer import section_logs_viewer_router # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‰Ğ¸Ğ¹ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°
    logger.info("Admin submodule 'logs_viewer' (section router) loaded.")
except ImportError as e:
    section_logs_viewer_router = Router(name="sdb_admin_logs_viewer_stub_main")
    logger.error(f"Failed to load admin submodule 'logs_viewer' (section router): {e}")


# Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
admin_router = Router(name="sdb_admin_top_level_router") # Ğ”Ğ°ĞµĞ¼ ĞµĞ¼Ñƒ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ¼Ñ

admin_router.include_router(section_entry_router)
admin_router.include_router(section_users_router)
admin_router.include_router(section_roles_router)
admin_router.include_router(section_sys_info_router)
admin_router.include_router(section_modules_mgmt_router)
admin_router.include_router(section_logs_viewer_router)

logger.success("Main admin_router composed from section routers.")

__all__ = ["admin_router"]


======================================================================

------------------------------ FILE: Systems/core/admin/modules_mgmt/keyboards_modules.py ------------------------------
# core/admin/modules_mgmt/keyboards_modules.py
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.utils.keyboard import InlineKeyboardBuilder
from loguru import logger
from typing import List, Dict, Any

from Systems.core.ui.callback_data_factories import AdminModulesPanelNavigate, AdminMainMenuNavigate
from Systems.core.admin.keyboards_admin_common import get_admin_texts, get_back_to_admin_main_menu_button
from typing import TYPE_CHECKING, Optional
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider

async def get_modules_list_keyboard(modules_info: List[Dict[str, Any]], services_provider: Optional['BotServicesProvider'] = None, locale: Optional[str] = None) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° ÑĞ¿Ğ¸ÑĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    builder = InlineKeyboardBuilder()
    
    if modules_info:
        for module in modules_info:
            # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
            status_icon = "âœ…" if module['is_enabled'] else "âŒ"
            error_icon = "âš ï¸" if module.get('error') else ""
            system_icon = "ğŸ”§" if module.get('is_system_module') else ""
            
            display_text = f"{status_icon} {system_icon} {module['name']} {error_icon}"
            callback_data = AdminModulesPanelNavigate(action="view", item_id=module['name']).pack()
            builder.button(text=display_text, callback_data=callback_data)
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
    if services_provider:
        builder.row(get_back_to_admin_main_menu_button(services_provider, locale))
    else:
        builder.row(
            InlineKeyboardButton(
                text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ",
                callback_data=AdminMainMenuNavigate(target_section="main_admin").pack()
            )
        )
    
    builder.adjust(1)  # ĞŸĞ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞµ Ğ² Ñ€ÑĞ´Ñƒ
    return builder.as_markup()

async def get_module_details_keyboard(module_name: str, is_enabled: bool, services_provider: Optional['BotServicesProvider'] = None, locale: Optional[str] = None) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ"""
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if services_provider:
        admin_texts = get_admin_texts(services_provider, locale)
    else:
        admin_texts = {}
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
    toggle_text = admin_texts.get("modules_mgmt_toggle_disable", "âŒ ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ") if is_enabled else admin_texts.get("modules_mgmt_toggle_enable", "âœ… Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ")
    toggle_action = "disable" if is_enabled else "enable"
    builder.button(
        text=toggle_text,
        callback_data=AdminModulesPanelNavigate(action="toggle", item_id=module_name).pack()
    )
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹
    builder.button(
        text=admin_texts.get("modules_mgmt_actions", "ğŸ”§ Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ"),
        callback_data=AdminModulesPanelNavigate(action="actions", item_id=module_name).pack()
    )
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğº ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
    builder.row(
        InlineKeyboardButton(
            text=admin_texts.get("modules_mgmt_back_to_module_list", "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"),
            callback_data=AdminModulesPanelNavigate(action="list").pack()
        )
    )
    
    builder.adjust(1)  # ĞŸĞ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞµ Ğ² Ñ€ÑĞ´Ñƒ
    return builder.as_markup()

async def get_module_actions_keyboard(module_name: str, is_enabled: bool, services_provider: Optional['BotServicesProvider'] = None, locale: Optional[str] = None) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¼"""
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if services_provider:
        admin_texts = get_admin_texts(services_provider, locale)
    else:
        admin_texts = {}
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
    toggle_text = admin_texts.get("modules_mgmt_toggle_disable", "âŒ ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ") if is_enabled else admin_texts.get("modules_mgmt_toggle_enable", "âœ… Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ")
    toggle_action = "disable" if is_enabled else "enable"
    builder.button(
        text=toggle_text,
        callback_data=AdminModulesPanelNavigate(action="toggle", item_id=module_name).pack()
    )
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† (Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ)
    builder.button(
        text=admin_texts.get("modules_mgmt_clean_tables", "ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹"),
        callback_data=AdminModulesPanelNavigate(action="clean_tables", item_id=module_name).pack()
    )
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğº Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ
    builder.button(
        text=admin_texts.get("modules_mgmt_back_to_module_info", "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸"),
        callback_data=AdminModulesPanelNavigate(action="view", item_id=module_name).pack()
    )
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğº ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
    builder.row(
        InlineKeyboardButton(
            text=admin_texts.get("modules_mgmt_back_to_module_list", "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"),
            callback_data=AdminModulesPanelNavigate(action="list").pack()
        )
    )
    
    builder.adjust(1)  # ĞŸĞ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞµ Ğ² Ñ€ÑĞ´Ñƒ
    return builder.as_markup()


======================================================================

------------------------------ FILE: Systems/core/admin/modules_mgmt/handlers_modules.py ------------------------------
# core/admin/modules_mgmt/handlers_modules.py
from aiogram import Router, types, F
from loguru import logger
from typing import List, Dict, Any, Optional

from Systems.core.ui.callback_data_factories import AdminModulesPanelNavigate, AdminMainMenuNavigate
from Systems.core.admin.filters_admin import can_view_admin_panel_filter
from Systems.core.admin.keyboards_admin_common import get_admin_texts
from .keyboards_modules import get_modules_list_keyboard, get_module_details_keyboard, get_module_actions_keyboard

from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider

modules_mgmt_router = Router(name="sdb_admin_modules_mgmt_handlers")
MODULE_NAME_FOR_LOG = "AdminModulesMgmt"

modules_mgmt_router.callback_query.filter(can_view_admin_panel_filter)

@modules_mgmt_router.callback_query(AdminMainMenuNavigate.filter(F.target_section == "modules"))
async def cq_admin_modules_start(
    query: types.CallbackQuery,
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸.")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
    modules_info = await _get_modules_info(services_provider)
    
    text = f"ğŸ§© **{admin_texts.get('admin_modules_mgmt_title', 'Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸')}**\n\n"
    if modules_info:
        enabled_count = sum(1 for m in modules_info if m['is_enabled'])
        total_count = len(modules_info)
        text += f"ğŸ“Š {admin_texts.get('admin_sys_info_total_modules', 'Ğ’ÑĞµĞ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹')}: {total_count}\n"
        text += f"âœ… {admin_texts.get('admin_sys_info_enabled_modules', 'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾')}: {enabled_count}\n"
        text += f"âŒ {admin_texts.get('admin_modules_disabled', 'ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾')}: {total_count - enabled_count}\n\n"
        text += admin_texts.get('admin_modules_select_module', 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:')
    else:
        text += admin_texts.get('admin_modules_not_found', 'âŒ ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹')
    
    keyboard = await get_modules_list_keyboard(modules_info, services_provider, user_locale)
    
    if query.message:
        try:
            await query.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
        except Exception as e:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹: {e}")
            await query.answer(admin_texts["admin_error_display"], show_alert=True)
    
    await query.answer()

@modules_mgmt_router.callback_query(AdminModulesPanelNavigate.filter(F.action == "list"))
async def cq_admin_modules_list(
    query: types.CallbackQuery,
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹.")
    
    # ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞµĞ¼ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ¸Ğ· cq_admin_modules_start
    modules_info = await _get_modules_info(services_provider)
    
    text = f"ğŸ§© **{admin_texts.get('admin_modules_mgmt_title', 'Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸')}**\n\n"
    if modules_info:
        enabled_count = sum(1 for m in modules_info if m['is_enabled'])
        total_count = len(modules_info)
        text += f"ğŸ“Š {admin_texts.get('admin_sys_info_total_modules', 'Ğ’ÑĞµĞ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹')}: {total_count}\n"
        text += f"âœ… {admin_texts.get('admin_sys_info_enabled_modules', 'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾')}: {enabled_count}\n"
        text += f"âŒ {admin_texts.get('admin_modules_disabled', 'ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾')}: {total_count - enabled_count}\n\n"
        text += admin_texts.get('admin_modules_select_module', 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:')
    else:
        text += admin_texts.get('admin_modules_not_found', 'âŒ ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹')
    
    keyboard = await get_modules_list_keyboard(modules_info, services_provider, user_locale)
    
    if query.message:
        try:
            await query.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
        except Exception as e:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹: {e}")
            await query.answer(admin_texts["admin_error_display"], show_alert=True)
    
    await query.answer()

@modules_mgmt_router.callback_query(AdminModulesPanelNavigate.filter(F.action == "view"))
async def cq_admin_module_view(
    query: types.CallbackQuery,
    callback_data: AdminModulesPanelNavigate,
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    module_name = callback_data.item_id
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ
    module_info = await _get_module_info(services_provider, module_name)
    
    if not module_info:
        await query.answer(admin_texts.get("modules_mgmt_module_not_found", "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"), show_alert=True)
        return
    
    text = f"ğŸ§© **{admin_texts.get('modules_mgmt_module_details_title', 'ĞœĞ¾Ğ´ÑƒĞ»ÑŒ')}: {module_name}**\n\n"
    text += f"ğŸ“‹ {admin_texts.get('modules_mgmt_module_description', 'ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ')}: {module_info.get('description', admin_texts.get('modules_mgmt_module_no_description', 'ĞĞµÑ‚ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ'))}\n"
    text += f"ğŸ“… {admin_texts.get('modules_mgmt_module_version', 'Ğ’ĞµÑ€ÑĞ¸Ñ')}: {module_info.get('version', admin_texts.get('admin_sys_info_na', 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ°'))}\n"
    text += f"ğŸ‘¨â€ğŸ’» {admin_texts.get('modules_mgmt_module_author', 'ĞĞ²Ñ‚Ğ¾Ñ€')}: {module_info.get('author', admin_texts.get('admin_sys_info_na', 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½'))}\n"
    text += f"ğŸ”— {admin_texts.get('modules_mgmt_module_website', 'Ğ¡Ğ°Ğ¹Ñ‚')}: {module_info.get('website', admin_texts.get('admin_sys_info_na', 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½'))}\n"
    text += f"ğŸ“§ {admin_texts.get('modules_mgmt_module_email', 'Email')}: {module_info.get('email', admin_texts.get('admin_sys_info_na', 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½'))}\n"
    text += f"ğŸ“„ {admin_texts.get('modules_mgmt_module_license', 'Ğ›Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ')}: {module_info.get('license', admin_texts.get('admin_sys_info_na', 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ°'))}\n\n"
    status_text = admin_texts.get('modules_mgmt_module_is_enabled', 'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½') if module_info['is_enabled'] else admin_texts.get('modules_mgmt_module_is_disabled', 'ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½')
    text += f"âœ… {admin_texts.get('modules_mgmt_module_status', 'Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ')}: {status_text}\n"
    
    if module_info.get('error'):
        text += f"âŒ {admin_texts.get('modules_mgmt_module_error', 'ĞÑˆĞ¸Ğ±ĞºĞ°')}: {module_info['error']}\n"
    
    keyboard = await get_module_details_keyboard(module_name, module_info['is_enabled'], services_provider, user_locale)
    
    if query.message:
        try:
            await query.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
        except Exception as e:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ: {e}")
            await query.answer(admin_texts["admin_error_display"], show_alert=True)
    
    await query.answer()

@modules_mgmt_router.callback_query(AdminModulesPanelNavigate.filter(F.action == "toggle"))
async def cq_admin_module_toggle(
    query: types.CallbackQuery,
    callback_data: AdminModulesPanelNavigate,
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    module_name = callback_data.item_id
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
    module_info = await _get_module_info(services_provider, module_name)
    
    if not module_info:
        await query.answer(admin_texts.get("modules_mgmt_module_not_found", "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"), show_alert=True)
        return
    
    current_status = module_info['is_enabled']
    new_status = not current_status
    
    # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ
    success = await _toggle_module(services_provider, module_name, new_status)
    
    if success:
        action_text = admin_texts.get("modules_mgmt_module_is_enabled", "Ğ²ĞºĞ»ÑÑ‡ĞµĞ½") if new_status else admin_texts.get("modules_mgmt_module_is_disabled", "Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½")
        await query.answer(admin_texts.get("modules_mgmt_module_toggle_success", "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ {action}").format(module_name=module_name, action=action_text))
        
        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ
        await cq_admin_module_view(query, callback_data, services_provider)
    else:
        await query.answer(admin_texts.get("modules_mgmt_module_toggle_failed", "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"), show_alert=True)

@modules_mgmt_router.callback_query(AdminModulesPanelNavigate.filter(F.action == "actions"))
async def cq_admin_module_actions(
    query: types.CallbackQuery,
    callback_data: AdminModulesPanelNavigate,
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    module_name = callback_data.item_id
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¼ {module_name}")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ
    module_info = await _get_module_info(services_provider, module_name)
    
    if not module_info:
        await query.answer(admin_texts.get("modules_mgmt_module_not_found", "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"), show_alert=True)
        return
    
    text = f"ğŸ”§ **{admin_texts.get('modules_mgmt_actions', 'Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ')} Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¼: {module_name}**\n\n"
    text += admin_texts.get('admin_modules_select_action', 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ:')
    
    keyboard = await get_module_actions_keyboard(module_name, module_info['is_enabled'], services_provider, user_locale)
    
    if query.message:
        try:
            await query.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
        except Exception as e:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: {e}")
            await query.answer(admin_texts["admin_error_display"], show_alert=True)
    
    await query.answer()

@modules_mgmt_router.callback_query(AdminModulesPanelNavigate.filter(F.action == "clean_tables"))
async def cq_admin_module_clean_tables(
    query: types.CallbackQuery,
    callback_data: AdminModulesPanelNavigate,
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    module_name = callback_data.item_id
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºÑƒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}")
    
    # Ğ—Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ
    text = f"âš ï¸ **{admin_texts.get('admin_warning', 'Ğ’Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ!')}**\n\n"
    text += admin_texts.get("modules_mgmt_module_clean_tables_confirm", "Ğ’Ñ‹ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ĞµÑÑŒ Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}'.\nĞ­Ñ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ½ĞµĞ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ğ¼Ğ¾ Ğ¸ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ.").format(module_name=module_name)
    text += f"\n\n{admin_texts.get('admin_confirm_continue', 'ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ?')}"
    
    keyboard = await get_module_clean_tables_confirm_keyboard(module_name, services_provider, user_locale)
    
    if query.message:
        try:
            await query.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
        except Exception as e:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸: {e}")
            await query.answer(admin_texts["admin_error_display"], show_alert=True)
    
    await query.answer()

@modules_mgmt_router.callback_query(AdminModulesPanelNavigate.filter(F.action == "clean_tables_confirm"))
async def cq_admin_module_clean_tables_confirm(
    query: types.CallbackQuery,
    callback_data: AdminModulesPanelNavigate,
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    module_name = callback_data.item_id
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ğ» Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºÑƒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}")
    
    # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºÑƒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
    success = await _clean_module_tables(services_provider, module_name)
    
    if success:
        await query.answer(admin_texts.get("modules_mgmt_module_clean_tables_success", "Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½Ñ‹").format(module_name=module_name))
        # Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ÑÑ Ğº ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
        await cq_admin_modules_list(query, services_provider)
    else:
        await query.answer(admin_texts.get("modules_mgmt_module_clean_tables_failed", "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†"), show_alert=True)

# Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
async def _get_modules_info(services_provider: 'BotServicesProvider') -> List[Dict[str, Any]]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ²ÑĞµÑ… Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ…"""
    try:
        module_loader = services_provider.module_loader
        all_modules = module_loader.get_all_modules_info()
        
        modules_info = []
        for module_info in all_modules:
            modules_info.append({
                'name': module_info.name,
                'description': module_info.manifest.description if module_info.manifest else 'ĞĞµÑ‚ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ',
                'version': module_info.manifest.version if module_info.manifest else 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ°',
                'author': module_info.manifest.author if module_info.manifest else 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½',
                'website': module_info.manifest.website if module_info.manifest else 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½',
                'email': module_info.manifest.email if module_info.manifest else 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½',
                'license': module_info.manifest.license if module_info.manifest else 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ°',
                'is_enabled': module_info.is_enabled,
                'error': module_info.error,
                'is_system_module': module_info.is_system_module
            })
        
        return modules_info
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ…: {e}")
        return []

async def _get_module_info(services_provider: 'BotServicesProvider', module_name: str) -> Optional[Dict[str, Any]]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ"""
    try:
        module_loader = services_provider.module_loader
        module_info = module_loader.get_module_info(module_name)
        
        if not module_info:
            return None
        
        return {
            'name': module_info.name,
            'description': module_info.manifest.description if module_info.manifest else 'ĞĞµÑ‚ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ',
            'version': module_info.manifest.version if module_info.manifest else 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ°',
            'author': module_info.manifest.author if module_info.manifest else 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½',
            'website': module_info.manifest.website if module_info.manifest else 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½',
            'email': module_info.manifest.email if module_info.manifest else 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½',
            'license': module_info.manifest.license if module_info.manifest else 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ°',
            'is_enabled': module_info.is_enabled,
            'error': module_info.error,
            'is_system_module': module_info.is_system_module
        }
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ {module_name}: {e}")
        return None

async def _toggle_module(services_provider: 'BotServicesProvider', module_name: str, enable: bool) -> bool:
    """Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ"""
    try:
        # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸ - Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ
        import subprocess
        import sys
        import shlex
        
        action = "enable" if enable else "disable"
        # Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸Ğ¼ĞµĞ½Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        if not module_name.replace('_', '').replace('-', '').isalnum():
            logger.error(f"ĞĞµĞ´Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ğ² Ğ¸Ğ¼ĞµĞ½Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: {module_name}")
            return False
            
        cmd = [sys.executable, "sdb", "module", action, module_name]
        
        # Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ñ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸ĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
        result = subprocess.run(cmd, capture_output=True, text=True, timeout=30, check=False)
        
        if result.returncode == 0:
            logger.info(f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {module_name} ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ {action}d")
            return True
        else:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ {action} Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {result.stderr}")
            return False
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {e}")
        return False

async def _clean_module_tables(services_provider: 'BotServicesProvider', module_name: str) -> bool:
    """ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
    try:
        import subprocess
        import sys
        
        # Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸Ğ¼ĞµĞ½Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        if not module_name.replace('_', '').replace('-', '').isalnum():
            logger.error(f"ĞĞµĞ´Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ğ² Ğ¸Ğ¼ĞµĞ½Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: {module_name}")
            return False
            
        cmd = [sys.executable, "sdb", "module", "clean-tables", module_name]
        
        # Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ñ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸ĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
        result = subprocess.run(cmd, capture_output=True, text=True, timeout=30, check=False)
        
        if result.returncode == 0:
            logger.info(f"Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name} ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½Ñ‹")
            return True
        else:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {result.stderr}")
            return False
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {e}")
        return False

async def get_module_clean_tables_confirm_keyboard(module_name: str, services_provider: Optional['BotServicesProvider'] = None, locale: Optional[str] = None):
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†"""
    from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
    from aiogram.utils.keyboard import InlineKeyboardBuilder
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if services_provider:
        admin_texts = get_admin_texts(services_provider, locale)
    else:
        admin_texts = {}
    
    builder = InlineKeyboardBuilder()
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
    builder.button(
        text=admin_texts.get("modules_mgmt_confirm_clean_tables", "âœ… Ğ”Ğ°, Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ"),
        callback_data=AdminModulesPanelNavigate(action="clean_tables_confirm", item_id=module_name).pack()
    )
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹
    builder.button(
        text=admin_texts.get("admin_cancel", "âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°"),
        callback_data=AdminModulesPanelNavigate(action="view", item_id=module_name).pack()
    )
    
    builder.adjust(2)
    return builder.as_markup()


======================================================================

------------------------------ FILE: Systems/core/admin/modules_mgmt/__init__.py ------------------------------
# core/admin/modules_mgmt/__init__.py
from aiogram import Router

from .handlers_modules import modules_mgmt_router # Ğ Ğ¾ÑƒÑ‚ĞµÑ€ Ğ¸Ğ· handlers_modules.py

section_modules_mgmt_router = Router(name="sdb_admin_section_modules_mgmt_router")
section_modules_mgmt_router.include_router(modules_mgmt_router)

__all__ = ["section_modules_mgmt_router"]


======================================================================

------------------------------ FILE: Systems/core/admin/sys_info/keyboards_sys_info.py ------------------------------
# core/admin/sys_info/keyboards_sys_info.py
from aiogram import types # <--- Ğ”ĞĞ‘ĞĞ’Ğ›Ğ•Ğ Ğ­Ğ¢ĞĞ¢ Ğ˜ĞœĞŸĞĞ Ğ¢
from aiogram.utils.keyboard import InlineKeyboardBuilder
from Systems.core.admin.keyboards_admin_common import ADMIN_COMMON_TEXTS, get_back_to_admin_main_menu_button

def get_sys_info_keyboard() -> types.InlineKeyboardMarkup: # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ types.InlineKeyboardMarkup
    builder = InlineKeyboardBuilder()
    builder.row(get_back_to_admin_main_menu_button())
    return builder.as_markup()

# Ğ•ÑĞ»Ğ¸ Ğ´Ğ»Ñ sys_info Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ÑÑ ÑĞ²Ğ¾Ğ¸ Ñ‚ĞµĞºÑÑ‚Ñ‹, Ğ¸Ñ… Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑÑĞ´Ğ°:
SYS_INFO_TEXTS = {
    "system_info_title": "ğŸ–¥ï¸ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ SwiftDevBot",
    # ... Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ñ‹ ...
}


======================================================================

------------------------------ FILE: Systems/core/admin/sys_info/handlers_sys_info.py ------------------------------
# SwiftDevBot/core/admin/sys_info/handlers_sys_info.py
import sys
import platform
from datetime import datetime, timezone 
import psutil 
import aiogram 
import asyncio 
import os 
from pathlib import Path

from aiogram import Router, types, F, Bot
from aiogram.utils.markdown import hbold, hcode 
from loguru import logger
from sqlalchemy import select, func as sql_func 
from aiogram.exceptions import TelegramBadRequest

from Systems.core.admin.keyboards_admin_common import ADMIN_COMMON_TEXTS, get_admin_texts
from .keyboards_sys_info import get_sys_info_keyboard
from Systems.core.ui.callback_data_factories import AdminSysInfoPanelNavigate
from Systems.core.admin.filters_admin import can_view_admin_panel_filter 
from Systems.core.rbac.service import PERMISSION_CORE_SYSTEM_VIEW_INFO_FULL, PERMISSION_CORE_SYSTEM_VIEW_INFO_BASIC
from Systems.core.database.core_models import User as DBUserModel 
from Systems.core.bot_entrypoint import PID_FILENAME

from typing import TYPE_CHECKING, List, Optional
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider

sys_info_router = Router(name="sdb_admin_sys_info_handlers")
MODULE_NAME_FOR_LOG = "AdminSysInfo"

async def _get_local_total_users_count(services_provider: 'BotServicesProvider') -> Optional[int]:
    try:
        async with services_provider.db.get_session() as session:
            count_stmt = select(sql_func.count(DBUserModel.id))
            total_users_result = await session.execute(count_stmt)
            return total_users_result.scalar_one_or_none() or 0
    except Exception as e: 
        logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ´ÑÑ‡ĞµÑ‚Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ SysInfo: {e}")
        return None

def format_uptime(start_time: Optional[datetime]) -> str:
    if not start_time:
        return "Ğ/Ğ”"
    if start_time.tzinfo is None:
        start_time = start_time.replace(tzinfo=timezone.utc)
    uptime_delta = datetime.now(timezone.utc) - start_time
    days = uptime_delta.days
    hours, remainder = divmod(uptime_delta.seconds, 3600)
    minutes, seconds = divmod(remainder, 60)
    parts = []
    if days > 0: parts.append(f"{int(days)}Ğ´")
    if hours > 0: parts.append(f"{int(hours)}Ñ‡")
    if minutes > 0: parts.append(f"{int(minutes)}Ğ¼")
    parts.append(f"{int(seconds)}Ñ")
    return " ".join(parts) or "~0Ñ"

@sys_info_router.callback_query(AdminSysInfoPanelNavigate.filter(F.action == "show"))
async def cq_admin_show_system_info_entry( 
    query: types.CallbackQuery, 
    callback_data: AdminSysInfoPanelNavigate, 
    services_provider: 'BotServicesProvider',
    bot: Bot 
):
    user_id = query.from_user.id 
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ.")

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)

    can_view_full = False
    can_view_basic = False
    is_owner_from_config = user_id in services_provider.config.core.super_admins
    async with services_provider.db.get_session() as session:
        if not is_owner_from_config: 
            can_view_full = await services_provider.rbac.user_has_permission(session, user_id, PERMISSION_CORE_SYSTEM_VIEW_INFO_FULL)
            if not can_view_full: 
                can_view_basic = await services_provider.rbac.user_has_permission(session, user_id, PERMISSION_CORE_SYSTEM_VIEW_INFO_BASIC)
        
    if not (is_owner_from_config or can_view_full or can_view_basic):
        await query.answer(admin_texts["access_denied"], show_alert=True)
        return

    s = services_provider.config 
    
    text_parts: List[str] = [f"ğŸ–¥ï¸ {hbold(admin_texts.get('admin_sys_info_title', 'Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ SwiftDevBot'))}\n"]

    # ĞĞ±Ñ‰Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
    text_parts.append(f"â„¹ï¸ {hbold(admin_texts.get('admin_sys_info_general', 'ĞĞ±Ñ‰Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ'))} â”€â”€â”€")
    text_parts.append(f"  â–¸ {hbold(admin_texts.get('admin_sys_info_sdb_core', 'SDB Core'))}: {hcode(f'v{s.core.sdb_version}')}")
    text_parts.append(f"  â–¸ {hbold(admin_texts.get('admin_sys_info_python', 'Python'))}: {hcode(f'v{sys.version_info.major}.{sys.version_info.minor}.{sys.version_info.micro}')}")
    text_parts.append(f"  â–¸ {hbold(admin_texts.get('admin_sys_info_aiogram', 'Aiogram'))}: {hcode(f'v{aiogram.__version__}')}")
    text_parts.append(f"  â–¸ {hbold(admin_texts.get('admin_sys_info_os', 'ĞĞ¡'))}: {platform.system()} {platform.release()} ({platform.machine()})")
    
    # ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ±Ğ¾Ñ‚Ğ°
    text_parts.append(f"\nğŸ¤– {hbold(admin_texts.get('admin_sys_info_bot_process', 'ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ±Ğ¾Ñ‚Ğ°'))} â”€â”€â”€")
    current_pid_handler = os.getpid() 
    pid_file_path = s.core.project_data_path / PID_FILENAME
    
    pid_for_psutil_stats = current_pid_handler
    pid_display_str = hcode(str(current_pid_handler))

    if pid_file_path.is_file():
        try:
            pid_from_file = int(pid_file_path.read_text().strip())
            pid_display_str = hcode(str(pid_from_file))
            if psutil and psutil.pid_exists(pid_from_file):
                process = psutil.Process(pid_from_file)
                create_time = datetime.fromtimestamp(process.create_time(), tz=timezone.utc)
                uptime_val = format_uptime(create_time)
                start_time_str = create_time.strftime('%d.%m.%Y %H:%M')
                text_parts.append(f"  â–¸ {hbold(admin_texts.get('admin_sys_info_pid', 'PID'))}: {pid_display_str}")
                text_parts.append(f"  â–¸ {hbold(admin_texts.get('admin_sys_info_uptime', 'Ğ’Ñ€ĞµĞ¼Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹'))}: {hbold(uptime_val)}")
                pid_for_psutil_stats = pid_from_file 
            else:
                status_msg = admin_texts.get('admin_sys_info_process_not_found', 'ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½')
                if not psutil: status_msg += " (psutil Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½)"
                text_parts.append(f"  â–¸ {hbold('Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ (PID Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ°)')}: {hcode(status_msg)} (PID: {pid_display_str})")
                text_parts.append(f"  â–¸ {hbold('PID (Ñ…ÑĞ½Ğ´Ğ»ĞµÑ€Ğ°)')}: {hcode(str(current_pid_handler))}")
        except Exception as e_pid:
            logger.warning(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ PID-Ñ„Ğ°Ğ¹Ğ»Ğ°: {e_pid}")
            text_parts.append(f"  â–¸ {hbold('PID (Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ°)')}: {hcode('ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ')}")
            text_parts.append(f"  â–¸ {hbold('PID (Ñ…ÑĞ½Ğ´Ğ»ĞµÑ€Ğ°)')}: {hcode(str(current_pid_handler))}")
    elif psutil:
        try:
            process = psutil.Process(current_pid_handler)
            create_time = datetime.fromtimestamp(process.create_time(), tz=timezone.utc)
            uptime_val = format_uptime(create_time)
            start_time_str = create_time.strftime('%d.%m.%Y %H:%M')
            text_parts.append(f"  â–¸ {hbold('Ğ—Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ (Ñ‚ĞµĞº. Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ)')}: {start_time_str} (PID: {pid_display_str})")
            text_parts.append(f"  â–¸ {hbold('Ğ’Ñ€ĞµĞ¼Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ (Ñ‚ĞµĞº.)')}: {hbold(uptime_val)}")
        except Exception: 
             text_parts.append(f"  â–¸ {hbold('Ğ’Ñ€ĞµĞ¼Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹')}: {admin_texts.get('admin_sys_info_na', 'Ğ/Ğ”')} (Ğ¾ÑˆĞ¸Ğ±ĞºĞ° psutil Ğ´Ğ»Ñ PID: {pid_display_str})")
    else:
        text_parts.append(f"  â–¸ {hbold(admin_texts.get('admin_sys_info_pid', 'PID'))}: {pid_display_str}")
        text_parts.append(f"  â–¸ {hbold(admin_texts.get('admin_sys_info_uptime', 'Ğ’Ñ€ĞµĞ¼Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹'))}: {admin_texts.get('admin_sys_info_na', 'Ğ/Ğ”')} (PID-Ñ„Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ / psutil Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½)")

    if psutil:
        try:
            target_ps_proc = psutil.Process(pid_for_psutil_stats)
            mem_rss_mb = target_ps_proc.memory_info().rss / (1024 * 1024)
            cpu_perc = target_ps_proc.cpu_percent(interval=0.05)
            text_parts.append(f"  â–¸ {hbold(admin_texts.get('admin_sys_info_memory', 'ĞŸĞ°Ğ¼ÑÑ‚ÑŒ'))}: {hbold(f'{mem_rss_mb:.2f} MB')}")
            text_parts.append(f"  â–¸ {hbold(admin_texts.get('admin_sys_info_cpu_percent', 'CPU'))}: {hbold(f'{cpu_perc:.1f}%')}")
        except (psutil.NoSuchProcess, psutil.AccessDenied, psutil.ZombieProcess):
             na_text = admin_texts.get('admin_sys_info_na', 'Ğ/Ğ”')
             text_parts.append(f"  â–¸ {hbold('ĞŸĞ°Ğ¼ÑÑ‚ÑŒ/CPU')}: {hcode(f'{na_text} (Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ {pid_for_psutil_stats} Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½)')}")
        except Exception as e_ps_stats:
             logger.warning(f"ĞÑˆĞ¸Ğ±ĞºĞ° psutil Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ PID {pid_for_psutil_stats}: {e_ps_stats}")
             na_text = admin_texts.get('admin_sys_info_na', 'Ğ/Ğ”')
             text_parts.append(f"  â–¸ {hbold('ĞŸĞ°Ğ¼ÑÑ‚ÑŒ/CPU')}: {hcode(f'{na_text} (Ğ¾ÑˆĞ¸Ğ±ĞºĞ° psutil)')}")
    else:
        text_parts.append(f"  â–¸ {hbold('ĞŸĞ°Ğ¼ÑÑ‚ÑŒ/CPU')}: {hcode('psutil Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½')}")

    # Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    text_parts.append(f"\nğŸ—„ï¸ {hbold(admin_texts.get('admin_sys_info_database', 'Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…'))} â”€â”€â”€")
    text_parts.append(f"  â–¸ {admin_texts.get('admin_sys_info_db_type', 'Ğ¢Ğ¸Ğ¿')}: {hbold(s.db.type.upper())}")
    if s.db.type == "sqlite":
        text_parts.append(f"  â–¸ ĞŸÑƒÑ‚ÑŒ: {hcode(s.db.sqlite_path)}")
    
    # ĞšÑÑˆ
    cache_label = admin_texts.get("admin_cache_section", "ğŸ’¾ ĞšÑÑˆ")
    text_parts.append(f"\n{hbold(cache_label)} â”€â”€â”€")
    text_parts.append(f"  â–¸ Ğ¢Ğ¸Ğ¿: {hbold(s.cache.type.capitalize())}")
    if s.cache.type == "redis" and s.cache.redis_url:
        text_parts.append(f"  â–¸ URL: {hcode(str(s.cache.redis_url))}") 
    text_parts.append(f"  â–¸ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½: {'âœ… Ğ”Ğ°' if services_provider.cache.is_available() else 'âŒ ĞĞµÑ‚'}")

    # ĞœĞ¾Ğ´ÑƒĞ»Ğ¸
    try:
        total_modules = len(services_provider.modules.get_all_modules_info())
        loaded_modules = len(services_provider.modules.get_loaded_modules_info(True, True))
        enabled_plugins = len(services_provider.modules.enabled_plugin_names)

        modules_label = admin_texts.get("admin_sys_info_modules", "ğŸ§© ĞœĞ¾Ğ´ÑƒĞ»Ğ¸")
        text_parts.append(f"\n{hbold(modules_label)} â”€â”€â”€")
        text_parts.append(
            f"  â–¸ {admin_texts.get('admin_sys_info_total_modules', 'Ğ’ÑĞµĞ³Ğ¾ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾')}: {hbold(str(total_modules))}"
        )
        text_parts.append(
            f"  â–¸ {admin_texts.get('admin_sys_info_enabled_modules', 'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ²')}: {hbold(str(enabled_plugins))}"
        )
        text_parts.append(
            f"  â–¸ {admin_texts.get('admin_sys_info_loaded_modules', 'Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¾')}: {hbold(str(loaded_modules))}"
        )
    except Exception as e_mod_info:
        logger.warning(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ…: {e_mod_info}")
        text_parts.append(f"\nğŸ§© {hbold('ĞœĞ¾Ğ´ÑƒĞ»Ğ¸')} â”€â”€â”€")
        text_parts.append(f"  â–¸ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸")

    # ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸
    total_users_count = await _get_local_total_users_count(services_provider)
    total_users_str = hbold(str(total_users_count)) if total_users_count is not None else f"{hcode('[ĞÑˆĞ¸Ğ±ĞºĞ°]')}"
    users_label = admin_texts.get("admin_sys_info_users", "ğŸ‘¥ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸")
    text_parts.append(f"\n{hbold(users_label)} â”€â”€â”€")
    text_parts.append(f"  â–¸ {admin_texts.get('admin_sys_info_total_users', 'Ğ’ÑĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹')}: {total_users_str}")

    text_response = "\n".join(text_parts)
    keyboard_sysinfo = get_sys_info_keyboard()

    if query.message:
        try:
            if query.message.text != text_response or query.message.reply_markup != keyboard_sysinfo:
                await query.message.edit_text(text_response, reply_markup=keyboard_sysinfo)
            else:
                logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾.")
            await query.answer()
        except TelegramBadRequest as e_tbr: 
            if "message is not modified" in str(e_tbr).lower():
                 logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾ (Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ğ½Ğ¾ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ).")
                 await query.answer()
            else:
                logger.error(f"[{MODULE_NAME_FOR_LOG}] TelegramBadRequest Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸: {e_tbr}", exc_info=True)
                await query.answer(admin_texts["error_general"], show_alert=True)
        except Exception as e_edit:
            logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞĞµĞ¿Ñ€ĞµĞ´Ğ²Ğ¸Ğ´ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸: {e_edit}", exc_info=True)
            await query.answer(admin_texts["error_general"], show_alert=True)
    else:
        await query.answer()


======================================================================

------------------------------ FILE: Systems/core/admin/sys_info/__init__.py ------------------------------
# core/admin/sys_info/__init__.py
from aiogram import Router

# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ "ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğ¹" Ñ€Ğ¾ÑƒÑ‚ĞµÑ€
from .handlers_sys_info import sys_info_router

# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ "ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‰Ğ¸Ğ¹" Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ° (Ñ…Ğ¾Ñ‚Ñ Ğ·Ğ´ĞµÑÑŒ Ğ¾Ğ½ Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½)
section_sys_info_router = Router(name="sdb_admin_section_sys_info_router")
section_sys_info_router.include_router(sys_info_router)

__all__ = ["section_sys_info_router"]


======================================================================

------------------------------ FILE: Systems/core/admin/roles/keyboards_roles.py ------------------------------
# core/admin/roles/keyboards_roles.py
from typing import TYPE_CHECKING, List, Optional, Set, Dict
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton # Ğ£Ğ±ĞµĞ´Ğ¸Ğ¼ÑÑ Ñ‡Ñ‚Ğ¾ types Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
from aiogram.utils.keyboard import InlineKeyboardBuilder
from loguru import logger 

from Systems.core.ui.callback_data_factories import AdminRolesPanelNavigate
from Systems.core.admin.keyboards_admin_common import ADMIN_COMMON_TEXTS, get_back_to_admin_main_menu_button, get_admin_texts
from Systems.core.rbac.service import (
    PERMISSION_CORE_ROLES_CREATE, 
    PERMISSION_CORE_ROLES_EDIT, 
    PERMISSION_CORE_ROLES_DELETE, 
    PERMISSION_CORE_ROLES_ASSIGN_PERMISSIONS,
    DEFAULT_ROLES_DEFINITIONS 
)

if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from sqlalchemy.ext.asyncio import AsyncSession
    from Systems.core.database.core_models import Role as DBRole, Permission as DBPermission
    from aiogram import types as AiogramTypes # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¿ÑĞµĞ²Ğ´Ğ¾Ğ½Ğ¸Ğ¼, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ¿ÑƒÑ‚Ğ°Ñ‚ÑŒ Ñ types Ğ² Ğ°Ğ½Ğ½Ğ¾Ñ‚Ğ°Ñ†Ğ¸ÑÑ…

def get_roles_mgmt_texts(services_provider: 'BotServicesProvider', locale: Optional[str] = None) -> dict:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸"""
    if not locale:
        locale = services_provider.config.core.i18n.default_locale
    
    from Systems.core.admin.keyboards_admin_common import _get_admin_translator
    translator = _get_admin_translator(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, locale, **kwargs)
    
    return {
        "role_list_title": t("admin_role_list_title"),
        "role_list_select_action": t("admin_role_list_select_action"),
        "role_list_no_roles": t("admin_role_list_no_roles"),
        "role_details_title": t("admin_role_details_title"),
        "role_action_edit_permissions": t("admin_role_action_edit_permissions"),
        "role_action_edit_role": t("admin_role_action_edit_role"),
        "role_action_delete_role": t("admin_role_action_delete_role"),
        "back_to_roles_list": t("admin_back_to_roles_list"),
        "edit_permissions_for_role": t("admin_edit_permissions_for_role"),
        "role_permissions_instruction": t("admin_role_permissions_heading"),
        "role_no_permissions": t("admin_role_no_permissions"),
        "role_description_label": t("admin_role_description_label"),
        "role_permissions_label": t("admin_role_permissions_label"),
        "role_action_create_role": t("admin_role_action_create_role"),
    }

# Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğ¹ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (deprecated)
ROLES_MGMT_TEXTS = {
    "role_list_title": "ğŸ›¡ï¸ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸",
    "role_list_select_action": "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ¸Ğ»Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:",
    "role_list_no_roles": "ĞĞµÑ‚ Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",
    "role_details_title": "ğŸ›¡ï¸ Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ñ€Ğ¾Ğ»Ğ¸",
    "role_action_edit_permissions": "Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ",
    "role_action_edit_role": "âœï¸ Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ", 
    "role_action_delete_role": "ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ",    
    "back_to_roles_list": "â¬…ï¸ Ğš ÑĞ¿Ğ¸ÑĞºÑƒ Ñ€Ğ¾Ğ»ĞµĞ¹",
    "edit_permissions_for_role": "Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸: {role_name}", 
    "role_permissions_instruction": "ĞÑ‚Ğ¼ĞµÑ‚ÑŒÑ‚Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ/ÑĞ½ÑÑ‚Ğ¸Ñ:",
    "role_no_permissions": "  (Ğ½ĞµÑ‚ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹)",
    "role_description_label": "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:",
    "role_permissions_label": "Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸:",
    "back_to_role_details": "â¬…ï¸ Ğš Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼ Ñ€Ğ¾Ğ»Ğ¸",
    "role_action_create_role": "â• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ",
}


async def get_admin_roles_list_keyboard_local( 
    all_roles: List['DBRole'],
    services: Optional['BotServicesProvider'] = None, 
    user_tg_id: Optional[int] = None,          
    session: Optional['AsyncSession'] = None,
    locale: Optional[str] = None
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if services:
        roles_texts = get_roles_mgmt_texts(services, locale)
        admin_texts = get_admin_texts(services, locale)
    else:
        roles_texts = ROLES_MGMT_TEXTS
        admin_texts = ADMIN_COMMON_TEXTS
    
    texts = roles_texts

    logger.debug(f"[AdminRolesKeyboards] Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ° Ñ€Ğ¾Ğ»ĞµĞ¹. Ğ’ÑĞµĞ³Ğ¾ Ñ€Ğ¾Ğ»ĞµĞ¹: {len(all_roles)}")
    if not all_roles:
        cb_dummy_data = AdminRolesPanelNavigate(action="dummy_no_roles").pack()
        builder.button(
            text=texts["role_list_no_roles"],
            callback_data=cb_dummy_data
        )
        logger.debug(f"[AdminRolesKeyboards] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ° 'Ğ½ĞµÑ‚ Ñ€Ğ¾Ğ»ĞµĞ¹', callback: {cb_dummy_data}")
    else:
        for role in sorted(all_roles, key=lambda r: r.name):
            cb_data = AdminRolesPanelNavigate(action="view", item_id=role.id).pack()
            builder.button(
                text=f"ğŸ›¡ï¸ {role.name}",
                callback_data=cb_data
            )
            logger.debug(f"[AdminRolesKeyboards] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ° Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}' (ID: {role.id}), callback: {cb_data}")
        builder.adjust(1)
    
    if services and user_tg_id and session:
        is_owner_from_config = user_tg_id in services.config.core.super_admins
        can_create_roles = False
        try: 
            can_create_roles = is_owner_from_config or await services.rbac.user_has_permission(session, user_tg_id, PERMISSION_CORE_ROLES_CREATE)
        except Exception as e_perm_check:
            logger.error(f"[AdminRolesKeyboards] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ°Ğ²Ğ° PERMISSION_CORE_ROLES_CREATE Ğ´Ğ»Ñ user {user_tg_id}: {e_perm_check}")

        if can_create_roles:
            cb_create_data = AdminRolesPanelNavigate(action="create_start").pack()
            builder.row( 
                InlineKeyboardButton(
                    text=texts["role_action_create_role"],
                    callback_data=cb_create_data
                )
            )
            logger.debug(f"[AdminRolesKeyboards] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ° 'ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ', callback: {cb_create_data}")

    builder.row(get_back_to_admin_main_menu_button(services, locale))
    return builder.as_markup()


async def get_admin_role_details_keyboard_local( 
    target_role: 'DBRole',
    services: 'BotServicesProvider',
    current_admin_tg_id: int,
    session: 'AsyncSession',
    locale: Optional[str] = None
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if not locale:
        try:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == current_admin_tg_id))
            admin_user = result.scalar_one_or_none()
            if admin_user and admin_user.preferred_language_code:
                locale = admin_user.preferred_language_code
        except Exception:
            pass
        
        if not locale:
            locale = services.config.core.i18n.default_locale
    
    roles_texts = get_roles_mgmt_texts(services, locale)
    admin_texts = get_admin_texts(services, locale)
    texts = roles_texts
    
    rbac = services.rbac
    current_admin_is_owner = current_admin_tg_id in services.config.core.super_admins
    logger.debug(f"[AdminRolesKeyboards] Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ '{target_role.name}' (ID: {target_role.id}). ĞĞ´Ğ¼Ğ¸Ğ½: {current_admin_tg_id}, Ğ²Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†: {current_admin_is_owner}")

    can_edit_role = False
    can_assign_perms = False
    can_delete_role = False

    try: 
        can_edit_role = current_admin_is_owner or await rbac.user_has_permission(session, current_admin_tg_id, PERMISSION_CORE_ROLES_EDIT)
        can_assign_perms = current_admin_is_owner or await rbac.user_has_permission(session, current_admin_tg_id, PERMISSION_CORE_ROLES_ASSIGN_PERMISSIONS)
        can_delete_role = current_admin_is_owner or await rbac.user_has_permission(session, current_admin_tg_id, PERMISSION_CORE_ROLES_DELETE)
    except Exception as e_perm_check_details:
        logger.error(f"[AdminRolesKeyboards] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ€Ğ¾Ğ»Ğ¸ {target_role.id} Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ¼ {current_admin_tg_id}: {e_perm_check_details}")


    if can_edit_role:
        cb_edit_data = AdminRolesPanelNavigate(action="edit_start", item_id=target_role.id).pack()
        builder.button(
            text=texts["role_action_edit_role"],
            callback_data=cb_edit_data
        )
        logger.debug(f"[AdminRolesKeyboards] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ° 'Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ', callback: {cb_edit_data}")
        
    if can_assign_perms:
        cb_edit_perms_data = AdminRolesPanelNavigate(action="edit_perms_start", item_id=target_role.id, page=1).pack()
        builder.button(
            text=texts["role_action_edit_permissions"],
            callback_data=cb_edit_perms_data
        )
        logger.debug(f"[AdminRolesKeyboards] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ° 'Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ', callback: {cb_edit_perms_data}")
    
    if target_role.name not in DEFAULT_ROLES_DEFINITIONS: 
        if can_delete_role:
            cb_delete_data = AdminRolesPanelNavigate(action="delete_confirm", item_id=target_role.id).pack()
            builder.button(
                text=texts["role_action_delete_role"],
                callback_data=cb_delete_data
            )
            logger.debug(f"[AdminRolesKeyboards] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ° 'ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ', callback: {cb_delete_data}")

    if builder.export(): 
        builder.adjust(1)
    
    builder.row(InlineKeyboardButton(
        text=texts["back_to_roles_list"],
        callback_data=AdminRolesPanelNavigate(action="list").pack()
    ))
    builder.row(get_back_to_admin_main_menu_button(services, locale))
    return builder.as_markup()

async def get_admin_role_edit_permissions_keyboard_local( 
    target_role: 'DBRole',
    services: 'BotServicesProvider',
    current_admin_tg_id: int,
    session: 'AsyncSession',
    all_system_permissions: Optional[List['DBPermission']] = None,
    category_key: Optional[str] = None,
    entity_name: Optional[str] = None,
    page: int = 1,
    perms_per_page: int = 7,
    locale: Optional[str] = None
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if not locale:
        try:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == current_admin_tg_id))
            admin_user = result.scalar_one_or_none()
            if admin_user and admin_user.preferred_language_code:
                locale = admin_user.preferred_language_code
        except Exception:
            pass
        
        if not locale:
            locale = services.config.core.i18n.default_locale
    
    roles_texts = get_roles_mgmt_texts(services, locale)
    admin_texts = get_admin_texts(services, locale)
    texts = admin_texts
    
    rbac = services.rbac
    
    role_permission_ids: Set[int] = {perm.id for perm in target_role.permissions if perm.id is not None}

    builder.row(InlineKeyboardButton(
        text=roles_texts.get("back_to_roles_list", "â¬…ï¸ Ğš Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼ Ñ€Ğ¾Ğ»Ğ¸"),  # TODO: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ back_to_role_details Ğ² Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
        callback_data=AdminRolesPanelNavigate(action="view", item_id=target_role.id).pack()
    ))

    if not category_key:
        builder.button(
            text=admin_texts["perm_category_core"], 
            callback_data=AdminRolesPanelNavigate(action="edit_perms_nav", item_id=target_role.id, category_key="core", page=1).pack()
        )
        module_perms_exist = False
        if services.modules:
            declared_module_perms = services.modules.get_all_declared_permissions_from_active_modules()
            if declared_module_perms: module_perms_exist = True
        if module_perms_exist:
            builder.button(
                text=admin_texts["perm_category_modules"],
                callback_data=AdminRolesPanelNavigate(action="edit_perms_nav", item_id=target_role.id, category_key="module", page=1).pack()
            )
        builder.adjust(1)
        # ĞĞµ Ğ·Ğ°Ğ±Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ "ĞĞ°Ğ·Ğ°Ğ´ Ğ² ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ" Ğ¸ Ğ·Ğ´ĞµÑÑŒ, ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ²ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹
        builder.row(get_back_to_admin_main_menu_button(services, locale))
        return builder.as_markup()

    permissions_to_display_final: List['DBPermission'] = []
    if all_system_permissions is None: 
        all_system_permissions = await rbac.get_all_permissions(session)

    back_to_category_selection_button = InlineKeyboardButton(
        text=admin_texts["back_to_perm_categories"], 
        callback_data=AdminRolesPanelNavigate(action="edit_perms_nav", item_id=target_role.id, category_key=None, entity_name=None, page=1).pack()
    )

    if category_key == "core":
        CORE_PERM_GROUPS_MAP_ROLES: Dict[str, str] = { 
            k: texts[f"perm_core_group_{k}"] for k in ["users", "roles", "modules_core", "system", "settings_core", "other"]
        }
        CORE_PERM_PREFIXES_MAP_ROLES: Dict[str, str] = {
            "users": "core.users.", "roles": "core.roles.", "modules_core": "core.modules.",
            "system": "core.system.", "settings_core": "core.settings."
        }
        if not entity_name: 
            for group_key, group_display_name in CORE_PERM_GROUPS_MAP_ROLES.items():
                prefix_to_check = CORE_PERM_PREFIXES_MAP_ROLES.get(group_key)
                has_perms_in_group = False
                if prefix_to_check:
                    if any(p.name.startswith(prefix_to_check) for p in all_system_permissions): has_perms_in_group = True
                elif group_key == "other": 
                    known_prefixes = list(CORE_PERM_PREFIXES_MAP_ROLES.values())
                    if any(p.name.startswith("core.") and not any(p.name.startswith(kp) for kp in known_prefixes) for p in all_system_permissions): has_perms_in_group = True
                if has_perms_in_group:
                    builder.button(text=group_display_name, callback_data=AdminRolesPanelNavigate(action="edit_perms_nav", item_id=target_role.id, category_key="core", entity_name=group_key, page=1).pack())
            builder.adjust(1)
            builder.row(back_to_category_selection_button)
        else: 
            if entity_name == "other":
                known_prefixes = list(CORE_PERM_PREFIXES_MAP_ROLES.values())
                permissions_to_display_final = [p for p in all_system_permissions if p.name.startswith("core.") and not any(p.name.startswith(kp) for kp in known_prefixes)]
            elif entity_name in CORE_PERM_PREFIXES_MAP_ROLES:
                prefix = CORE_PERM_PREFIXES_MAP_ROLES[entity_name]
                permissions_to_display_final = [p for p in all_system_permissions if p.name.startswith(prefix)]
            builder.row(InlineKeyboardButton(text=admin_texts["back_to_core_perm_groups"], callback_data=AdminRolesPanelNavigate(action="edit_perms_nav", item_id=target_role.id, category_key="core", entity_name=None, page=1).pack()))
    elif category_key == "module":
        if not services.modules: 
            builder.button(text=admin_texts.get("admin_modules_error_no_module_loader", "ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ñ‡Ğ¸Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½."), callback_data="dummy_error_no_module_loader_perms"); return builder.as_markup() # Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ° dummy_data
        module_permissions_map: Dict[str, List['DBPermission']] = {}
        module_display_names: Dict[str, str] = {}
        for p in all_system_permissions:
            if not p.name.startswith("core."):
                module_name_candidate = p.name.split('.')[0]
                if module_name_candidate not in module_permissions_map:
                    module_permissions_map[module_name_candidate] = []
                    mod_info = services.modules.get_module_info(module_name_candidate)
                    module_display_names[module_name_candidate] = mod_info.manifest.display_name if mod_info and mod_info.manifest else module_name_candidate
                module_permissions_map[module_name_candidate].append(p)
        if not entity_name: 
            sorted_module_names = sorted(module_permissions_map.keys())
            if not sorted_module_names: builder.button(text=admin_texts["no_modules_with_perms"], callback_data="dummy_no_mod_perms_for_role") # Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ° dummy_data
            else:
                for mod_name in sorted_module_names:
                    builder.button(text=f"ğŸ§© {module_display_names.get(mod_name, mod_name)}", callback_data=AdminRolesPanelNavigate(action="edit_perms_nav", item_id=target_role.id, category_key="module", entity_name=mod_name, page=1).pack())
            builder.adjust(1)
            builder.row(back_to_category_selection_button)
        else: 
            permissions_to_display_final = module_permissions_map.get(entity_name, [])
            builder.row(InlineKeyboardButton(text=texts["back_to_module_list_for_perms"], callback_data=AdminRolesPanelNavigate(action="edit_perms_nav", item_id=target_role.id, category_key="module", entity_name=None, page=1).pack()))
    
    if permissions_to_display_final:
        permissions_to_display_final.sort(key=lambda p: p.name)
        total_perms_in_list = len(permissions_to_display_final)
        total_perm_pages = (total_perms_in_list + perms_per_page - 1) // perms_per_page
        total_perm_pages = max(1, total_perm_pages)
        current_perm_page = max(1, min(page, total_perm_pages))
        start_idx = (current_perm_page - 1) * perms_per_page
        end_idx = start_idx + perms_per_page
        paginated_perms = permissions_to_display_final[start_idx:end_idx]
        if not paginated_perms and current_perm_page == 1: builder.button(text=texts["no_permissions_in_group"], callback_data="dummy_no_perms_in_group_for_role") # Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ° dummy_data
        else:
            for perm in paginated_perms:
                is_assigned = perm.id in role_permission_ids
                prefix = "âœ… " if is_assigned else "â¬œ "
                button_text = f"{prefix}{perm.name}"
                if perm.id is None: continue 
                builder.button(text=button_text, callback_data=AdminRolesPanelNavigate(action="toggle_perm", item_id=target_role.id, permission_id=perm.id, category_key=category_key, entity_name=entity_name, page=current_perm_page).pack())
            builder.adjust(1)
            if total_perm_pages > 1:
                pagination_row_perms = []
                nav_cb_data_base = AdminRolesPanelNavigate(action="edit_perms_nav", item_id=target_role.id, category_key=category_key, entity_name=entity_name) 
                if current_perm_page > 1: pagination_row_perms.append(InlineKeyboardButton(text=texts["pagination_prev"], callback_data=nav_cb_data_base.model_copy(update={"page": current_perm_page - 1}).pack()))
                pagination_row_perms.append(InlineKeyboardButton(text=f"{current_perm_page}/{total_perm_pages}", callback_data="dummy_role_perm_page")) # Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ° dummy_data
                if current_perm_page < total_perm_pages: pagination_row_perms.append(InlineKeyboardButton(text=texts["pagination_next"], callback_data=nav_cb_data_base.model_copy(update={"page": current_perm_page + 1}).pack()))
                if pagination_row_perms: builder.row(*pagination_row_perms)
    elif entity_name: 
        builder.button(text=texts["no_permissions_in_group"], callback_data="dummy_no_perms_in_group_for_role_entity") # Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ° dummy_data

    builder.row(get_back_to_admin_main_menu_button(services, locale))
    return builder.as_markup()


======================================================================

------------------------------ FILE: Systems/core/admin/roles/handlers_crud_fsm.py ------------------------------
# core/admin/roles/handlers_crud_fsm.py
from typing import List
from aiogram import Router, types, F, Bot
from aiogram.filters import Command, StateFilter 
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup 
from aiogram.utils.markdown import hbold, hcode, hitalic
from aiogram.utils.keyboard import InlineKeyboardBuilder 
from loguru import logger
from sqlalchemy import select, func as sql_func
from aiogram.exceptions import TelegramBadRequest # <--- Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•Ğ Ğ˜ĞœĞŸĞĞ Ğ¢

from Systems.core.ui.callback_data_factories import AdminRolesPanelNavigate
from .keyboards_roles import get_admin_roles_list_keyboard_local, ROLES_MGMT_TEXTS, get_roles_mgmt_texts
from Systems.core.admin.keyboards_admin_common import ADMIN_COMMON_TEXTS, get_admin_texts 
from Systems.core.admin.filters_admin import can_view_admin_panel_filter
from Systems.core.rbac.service import PERMISSION_CORE_ROLES_CREATE, PERMISSION_CORE_ROLES_EDIT, PERMISSION_CORE_ROLES_DELETE, DEFAULT_ROLES_DEFINITIONS
from Systems.core.database.core_models import Role as DBRole, UserRole


from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from sqlalchemy.ext.asyncio import AsyncSession


role_crud_fsm_router = Router(name="sdb_admin_role_crud_fsm_handlers")
MODULE_NAME_FOR_LOG = "AdminRoleCRUD"

#role_crud_fsm_router.callback_query.filter(can_view_admin_panel_filter)
#role_crud_fsm_router.message.filter(can_view_admin_panel_filter)

class FSMAdminCreateRole(StatesGroup):
    waiting_for_name = State()
    waiting_for_description = State()

class FSMAdminEditRole(StatesGroup): 
    waiting_for_new_name = State()
    waiting_for_new_description = State()

@role_crud_fsm_router.callback_query(AdminRolesPanelNavigate.filter(F.action == "create_start"))
async def cq_admin_role_create_start_fsm( 
    query: types.CallbackQuery,
    state: FSMContext,
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ» ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸ (FSM).")

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)

    async with services_provider.db.get_session() as session:
        if not services_provider.config.core.super_admins or admin_user_id not in services_provider.config.core.super_admins:
            if not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_ROLES_CREATE):
                await query.answer(admin_texts["access_denied"], show_alert=True)
                return
    
    await state.set_state(FSMAdminCreateRole.waiting_for_name)
    
    text = (f"{admin_texts.get('fsm_enter_role_name', 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ¼Ñ Ñ€Ğ¾Ğ»Ğ¸:')}\n\n"
            f"{hitalic(admin_texts.get('fsm_command_cancel_role_creation', '/cancel_role_creation - ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ'))}")
    
    if query.message:
        try:
            await query.message.edit_text(text, reply_markup=None) 
        except TelegramBadRequest as e: # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ TelegramBadRequest
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ FSM (create_start): {e}. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾.")
            await query.bot.send_message(query.from_user.id, text) 
        except Exception as e_fatal:
            logger.error(f"ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² cq_admin_role_create_start_fsm Ğ¿Ñ€Ğ¸ edit/send: {e_fatal}")
            await query.answer(admin_texts["error_general"], show_alert=True)
    else: 
        await query.bot.send_message(query.from_user.id, text) 
    await query.answer()


@role_crud_fsm_router.message(StateFilter(FSMAdminCreateRole.waiting_for_name), F.text)
async def process_fsm_role_name_crud( 
    message: types.Message, 
    state: FSMContext, 
    services_provider: 'BotServicesProvider'
):
    admin_user_id = message.from_user.id
    role_name = message.text.strip() if message.text else ""

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)

    if not role_name:
        await message.reply(admin_texts.get('fsm_role_name_empty', 'Ğ˜Ğ¼Ñ Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼.'))
        return

    async with services_provider.db.get_session() as session:
        existing_role = await services_provider.rbac._get_role_by_name(session, role_name) 
        if existing_role:
            await message.reply(admin_texts.get('fsm_role_name_taken','Ğ Ğ¾Ğ»ÑŒ Ñ Ğ¸Ğ¼ĞµĞ½ĞµĞ¼ "{role_name}" ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚.').format(role_name=hcode(role_name)))
            return
            
    await state.update_data(new_role_name=role_name)
    await state.set_state(FSMAdminCreateRole.waiting_for_description)
    
    text = (f"{admin_texts.get('fsm_enter_role_description','Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ {role_name}:').format(role_name=hcode(role_name))}\n\n"
            f"{hitalic(admin_texts.get('fsm_command_skip_description','/skip_description - ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ'))} Ğ¸Ğ»Ğ¸ {hitalic(admin_texts.get('fsm_command_cancel_role_creation','/cancel_role_creation - ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ'))}")
    await message.answer(text)


@role_crud_fsm_router.message(StateFilter(FSMAdminCreateRole.waiting_for_description), F.text)
async def process_fsm_role_description_crud( 
    message: types.Message, 
    state: FSMContext, 
    services_provider: 'BotServicesProvider',
    bot: Bot 
):
    admin_user_id = message.from_user.id
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    roles_texts = get_roles_mgmt_texts(services_provider, user_locale)
    
    if message.text and message.text.lower() == "/skip_description": 
        role_description = None
    else:
        role_description = message.text.strip() if message.text else None

    user_data = await state.get_data()
    role_name = user_data.get("new_role_name")

    if not role_name: 
        logger.error(f"[{MODULE_NAME_FOR_LOG}] FSM: ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ¸Ğ¼Ñ Ñ€Ğ¾Ğ»Ğ¸ Ğ² ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ.")
        await message.answer(admin_texts["error_general"])
        await state.clear()
        from .handlers_list import cq_admin_roles_list_entry 
        chat_id_for_reply = message.chat.id
        dummy_message_for_cb = types.Message(message_id=0, chat=types.Chat(id=chat_id_for_reply, type="private"), date=0) 
        await cq_admin_roles_list_entry(
            types.CallbackQuery(id="dummy_fsm_error_cb", from_user=message.from_user, chat_instance=str(chat_id_for_reply), data="dummy", message=dummy_message_for_cb), 
            AdminRolesPanelNavigate(action="list"), services_provider
        )
        return

    async with services_provider.db.get_session() as session:
        created_role = await services_provider.rbac.get_or_create_role(session, role_name, role_description)
        if created_role:
            try:
                await session.commit()
                logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ» Ñ€Ğ¾Ğ»ÑŒ: '{role_name}'.")
                await message.answer(admin_texts.get('fsm_role_created_successfully','Ğ Ğ¾Ğ»ÑŒ "{role_name}" ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°!').format(role_name=hcode(role_name)))
            except Exception as e_commit:
                await session.rollback()
                logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° commit Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ñ€Ğ¾Ğ»Ğ¸ '{role_name}': {e_commit}", exc_info=True)
                await message.answer(admin_texts.get("admin_error_saving_role", admin_texts["admin_error_saving"]))
        else:
            await message.answer(admin_texts.get("admin_error_saving_role", admin_texts["admin_error_saving"]))
        
        await state.clear()
        
        # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ€Ğ¾Ğ»ĞµĞ¹
        from Systems.core.database.core_models import Role as DBRole
        
        async with services_provider.db.get_session() as session:
            all_roles: List[DBRole] = await services_provider.rbac.get_all_roles(session)
            text = f"{roles_texts['role_list_title']}\n{roles_texts['role_list_select_action']}"
            keyboard = await get_admin_roles_list_keyboard_local(all_roles, services_provider, message.from_user.id, session, locale=user_locale)
            
            await message.bot.send_message(message.chat.id, text, reply_markup=keyboard)

@role_crud_fsm_router.message(Command("cancel_role_creation"), StateFilter(FSMAdminCreateRole))
async def cancel_create_role_fsm_command(
    message: types.Message, 
    state: FSMContext, 
    services_provider: 'BotServicesProvider', 
    bot: Bot
):
    admin_user_id = message.from_user.id
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    current_fsm_state = await state.get_state()
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ» ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ¸Ğ· ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ {current_fsm_state} ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹.")
    await state.clear()
    await message.answer(admin_texts.get('fsm_role_creation_cancelled', "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾."))
    
    from .handlers_list import cq_admin_roles_list_entry
    chat_id_for_reply = message.chat.id
    dummy_message_for_cb = types.Message(message_id=0, chat=types.Chat(id=chat_id_for_reply, type="private"), date=0)
    await cq_admin_roles_list_entry(
        types.CallbackQuery(id="dummy_fsm_cancel_cb", from_user=message.from_user, chat_instance=str(chat_id_for_reply), data="dummy", message=dummy_message_for_cb), 
        AdminRolesPanelNavigate(action="list"), services_provider
    )

@role_crud_fsm_router.callback_query(AdminRolesPanelNavigate.filter(F.action == "edit_start"))
async def cq_admin_role_edit_start_fsm( 
    query: types.CallbackQuery,
    callback_data: AdminRolesPanelNavigate,
    state: FSMContext,
    services_provider: 'BotServicesProvider'
):
    from Systems.core.database.core_models import Role as DBRole
    admin_user_id = query.from_user.id
    role_id_to_edit = callback_data.item_id

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)

    if role_id_to_edit is None or not str(role_id_to_edit).isdigit(): 
        await query.answer(admin_texts["admin_error_role_id_invalid"], show_alert=True); return
    
    role_id_to_edit = int(str(role_id_to_edit)) 

    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ» Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ ID: {role_id_to_edit} (FSM).")

    async with services_provider.db.get_session() as session:
        if not services_provider.config.core.super_admins or admin_user_id not in services_provider.config.core.super_admins:
            if not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_ROLES_EDIT):
                await query.answer(admin_texts["access_denied"], show_alert=True); return
        
        role_to_edit = await session.get(DBRole, role_id_to_edit)
        if not role_to_edit:
            await query.answer(admin_texts["not_found_generic"], show_alert=True); return

        await state.update_data(
            editing_role_id=role_to_edit.id,
            current_role_name=role_to_edit.name,
            current_role_description=role_to_edit.description or "" 
        )

        title_text = admin_texts.get('fsm_edit_role_title','Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸: {role_name}').format(role_name=hcode(role_to_edit.name))
        
        if role_to_edit.name in DEFAULT_ROLES_DEFINITIONS:
            await state.set_state(FSMAdminEditRole.waiting_for_new_description)
            prompt_text = (f"{title_text}\n"
                           f"{admin_texts.get('fsm_edit_role_name_not_allowed','Ğ˜Ğ¼Ñ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸ {role_name} Ğ¸Ğ·Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ½ĞµĞ»ÑŒĞ·Ñ.').format(role_name=hcode(role_to_edit.name))}\n\n"
                           f"{admin_texts.get('fsm_enter_new_role_description','Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ {role_name} (Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ: {current_description}):').format(role_name=hcode(role_to_edit.name), current_description=hitalic(role_to_edit.description or 'Ğ¿ÑƒÑÑ‚Ğ¾'))}\n\n"
                           f"{hitalic(admin_texts.get('fsm_command_skip_description','/skip_description - ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ'))} Ğ¸Ğ»Ğ¸ {hitalic(admin_texts.get('fsm_command_cancel_role_edit','/cancel_role_edit - ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ'))}")
        else:
            await state.set_state(FSMAdminEditRole.waiting_for_new_name)
            prompt_text = (f"{title_text}\n"
                           f"{admin_texts.get('fsm_enter_new_role_name','Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¸Ğ¼Ñ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ (Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ: {current_name}):').format(current_name=hcode(role_to_edit.name))}\n\n"
                           f"{hitalic(ADMIN_COMMON_TEXTS.get('fsm_command_skip_name','/skip_name - ĞÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ'))} Ğ¸Ğ»Ğ¸ {hitalic(ADMIN_COMMON_TEXTS.get('fsm_command_cancel_role_edit','/cancel_role_edit - ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ'))}")
    
    if query.message:
        try:
            await query.message.edit_text(prompt_text, reply_markup=None) 
        except TelegramBadRequest as e: # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ TelegramBadRequest
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ FSM (edit_start): {e}. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾.")
            await query.bot.send_message(query.from_user.id, prompt_text) 
    else:
        await query.bot.send_message(query.from_user.id, prompt_text) 
    await query.answer()


@role_crud_fsm_router.message(StateFilter(FSMAdminEditRole.waiting_for_new_name), F.text)
async def process_fsm_edit_role_name_crud( 
    message: types.Message, 
    state: FSMContext, 
    services_provider: 'BotServicesProvider'
):
    admin_user_id = message.from_user.id
    new_role_name_input = message.text.strip() if message.text else ""
    
    user_data = await state.get_data()
    current_role_name = user_data.get("current_role_name")
    role_id = user_data.get("editing_role_id")

    final_role_name = current_role_name 

    if new_role_name_input.lower() == "/skip_name":
        logger.info(f"[{MODULE_NAME_FOR_LOG}] FSM Edit Role: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {admin_user_id} Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ» Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¸Ğ¼ĞµĞ½Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ ID {role_id}.")
    elif not new_role_name_input:
        await message.reply(ADMIN_COMMON_TEXTS.get('fsm_role_name_empty', 'Ğ˜Ğ¼Ñ Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼.'))
        return
    elif new_role_name_input != current_role_name:
        async with services_provider.db.get_session() as session:
            existing_role_with_new_name = await services_provider.rbac._get_role_by_name(session, new_role_name_input)
            if existing_role_with_new_name and existing_role_with_new_name.id != role_id:
                await message.reply(ADMIN_COMMON_TEXTS.get('fsm_role_name_taken','Ğ Ğ¾Ğ»ÑŒ Ñ Ğ¸Ğ¼ĞµĞ½ĞµĞ¼ "{role_name}" ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚.').format(role_name=hcode(new_role_name_input)))
                return
        final_role_name = new_role_name_input
        logger.info(f"[{MODULE_NAME_FOR_LOG}] FSM Edit Role: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {admin_user_id} Ğ²Ğ²ĞµĞ» Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¸Ğ¼Ñ '{final_role_name}' Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ ID {role_id}.")
    
    await state.update_data(edited_role_name=final_role_name) 
    await state.set_state(FSMAdminEditRole.waiting_for_new_description)
    
    current_description = user_data.get("current_role_description", "Ğ¿ÑƒÑÑ‚Ğ¾")
    text = (f"{ADMIN_COMMON_TEXTS.get('fsm_enter_new_role_description','Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ {role_name} (Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ: {current_description}):').format(role_name=hcode(final_role_name), current_description=hitalic(current_description))}\n\n"
            f"{hitalic(ADMIN_COMMON_TEXTS.get('fsm_command_skip_description','/skip_description - ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ'))} Ğ¸Ğ»Ğ¸ {hitalic(ADMIN_COMMON_TEXTS.get('fsm_command_cancel_role_edit','/cancel_role_edit - ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ'))}")
    await message.answer(text)


@role_crud_fsm_router.message(StateFilter(FSMAdminEditRole.waiting_for_new_description), F.text)
async def process_fsm_edit_role_description_crud( 
    message: types.Message, 
    state: FSMContext, 
    services_provider: 'BotServicesProvider',
    bot: Bot
):
    from Systems.core.database.core_models import Role as DBRole
    admin_user_id = message.from_user.id
    new_role_description_input = message.text.strip() if message.text else None

    user_data = await state.get_data()
    role_id = user_data.get("editing_role_id")
    final_role_name = user_data.get("edited_role_name", user_data.get("current_role_name")) 
    current_role_description = user_data.get("current_role_description")

    final_role_description = current_role_description 
    if new_role_description_input and new_role_description_input.lower() == "/skip_description":
        final_role_description = current_role_description if current_role_description is not None else None 
        logger.info(f"[{MODULE_NAME_FOR_LOG}] FSM Edit Role: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {admin_user_id} Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ» Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ ID {role_id}.")
    elif new_role_description_input is not None: 
        final_role_description = new_role_description_input if new_role_description_input else None 
        logger.info(f"[{MODULE_NAME_FOR_LOG}] FSM Edit Role: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {admin_user_id} Ğ²Ğ²ĞµĞ» Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ ID {role_id}.")

    if role_id is None or final_role_name is None: 
        logger.error(f"[{MODULE_NAME_FOR_LOG}] FSM Edit: ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ ID Ñ€Ğ¾Ğ»Ğ¸ Ğ¸Ğ»Ğ¸ Ğ¸Ğ¼Ñ Ğ² ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¸.")
        await message.answer(ADMIN_COMMON_TEXTS["error_general"])
        await state.clear()
        return

    async with services_provider.db.get_session() as session:
        role_to_update = await session.get(DBRole, role_id)
        if not role_to_update:
            await message.answer(ADMIN_COMMON_TEXTS["not_found_generic"])
            await state.clear()
            return
        
        made_changes = False
        if role_to_update.name != final_role_name and role_to_update.name not in DEFAULT_ROLES_DEFINITIONS:
            if final_role_name != user_data.get("current_role_name"): 
                existing_role_check = await services_provider.rbac._get_role_by_name(session, final_role_name)
                if existing_role_check and existing_role_check.id != role_id:
                    await message.reply(ADMIN_COMMON_TEXTS.get('fsm_role_name_taken','Ğ Ğ¾Ğ»ÑŒ Ñ Ğ¸Ğ¼ĞµĞ½ĞµĞ¼ "{role_name}" ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚.').format(role_name=hcode(final_role_name)))
                    await state.set_state(FSMAdminEditRole.waiting_for_new_name)
                    current_name_for_prompt = user_data.get("current_role_name")
                    title_text = ADMIN_COMMON_TEXTS.get('fsm_edit_role_title','Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸: {role_name}').format(role_name=hcode(current_name_for_prompt))
                    prompt_text = (f"{title_text}\n"
                                   f"{ADMIN_COMMON_TEXTS.get('fsm_enter_new_role_name','Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¸Ğ¼Ñ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ (Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ: {current_name}):').format(current_name=hcode(current_name_for_prompt))}\n\n"
                                   f"{hitalic(ADMIN_COMMON_TEXTS.get('fsm_command_skip_name','/skip_name - ĞÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ'))} Ğ¸Ğ»Ğ¸ {hitalic(ADMIN_COMMON_TEXTS.get('fsm_command_cancel_role_edit','/cancel_role_edit - ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ'))}")
                    await message.answer(prompt_text)
                    return
            role_to_update.name = final_role_name
            made_changes = True
        elif role_to_update.name != final_role_name and role_to_update.name in DEFAULT_ROLES_DEFINITIONS:
            logger.warning(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ¼Ñ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸ '{role_to_update.name}' Ğ½Ğ° '{final_role_name}'. Ğ˜Ğ¼Ñ Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾.")
        
        if role_to_update.description != final_role_description:
            role_to_update.description = final_role_description
            made_changes = True
        
        if made_changes:
            session.add(role_to_update)
            try:
                await session.commit()
                logger.info(f"[{MODULE_NAME_FOR_LOG}] Ğ Ğ¾Ğ»ÑŒ ID {role_id} ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°. Ğ˜Ğ¼Ñ: '{role_to_update.name}', Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ: '{role_to_update.description}'.")
                await message.answer(ADMIN_COMMON_TEXTS.get('fsm_role_updated_successfully','Ğ Ğ¾Ğ»ÑŒ "{role_name}" ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°!').format(role_name=hcode(role_to_update.name)))
            except Exception as e_commit:
                await session.rollback()
                logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° commit Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ Ñ€Ğ¾Ğ»Ğ¸ ID {role_id}: {e_commit}", exc_info=True)
                await message.answer("ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ñ€Ğ¾Ğ»Ğ¸.")
        else:
            await message.answer("ĞĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ.")

        await state.clear()
        
        # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ€Ğ¾Ğ»ĞµĞ¹
        from .keyboards_roles import get_admin_roles_list_keyboard_local, ROLES_MGMT_TEXTS
        from Systems.core.rbac.service import PERMISSION_CORE_ROLES_VIEW
        from Systems.core.database.core_models import Role as DBRole
        from sqlalchemy import select, func as sql_func
        
        async with services_provider.db.get_session() as session:
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ°
            has_perm = await services_provider.rbac.user_has_permission(session, message.from_user.id, PERMISSION_CORE_ROLES_VIEW)
            if not has_perm:
                await message.answer("Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° ÑĞ¿Ğ¸ÑĞºĞ° Ñ€Ğ¾Ğ»ĞµĞ¹.")
                return
            
            # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ€Ğ¾Ğ»ĞµĞ¹
            roles_query = select(DBRole).order_by(DBRole.name)
            roles_result = await session.execute(roles_query)
            all_roles = list(roles_result.scalars().all())
            
            # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ñ‚ĞµĞºÑÑ‚ Ğ¸ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ
            text = ROLES_MGMT_TEXTS["role_list_title"]
            keyboard = await get_admin_roles_list_keyboard_local(all_roles, services_provider, message.from_user.id, session)
            
            await message.answer(text, reply_markup=keyboard)

@role_crud_fsm_router.message(Command("cancel_role_edit"), StateFilter(FSMAdminEditRole))
async def cancel_edit_role_fsm_command_crud( 
    message: types.Message, 
    state: FSMContext, 
    services_provider: 'BotServicesProvider', 
    bot: Bot
):
    admin_user_id = message.from_user.id
    current_fsm_state = await state.get_state()
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ» Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ¸Ğ· ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ {current_fsm_state} ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹.")
    await state.clear()
    await message.answer(ADMIN_COMMON_TEXTS.get('fsm_role_update_cancelled', "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾."))
    
    from .handlers_list import cq_admin_roles_list_entry
    chat_id_for_reply = message.chat.id
    dummy_message_for_cb = types.Message(message_id=0, chat=types.Chat(id=chat_id_for_reply, type="private"), date=0)
    await cq_admin_roles_list_entry(
        types.CallbackQuery(id="dummy_fsm_cancel_edit_cb", from_user=message.from_user, chat_instance=str(chat_id_for_reply), data="dummy", message=dummy_message_for_cb), 
        AdminRolesPanelNavigate(action="list"), services_provider
    )

@role_crud_fsm_router.callback_query(AdminRolesPanelNavigate.filter(F.action == "delete_confirm"))
async def cq_admin_role_delete_confirm_crud( 
    query: types.CallbackQuery,
    callback_data: AdminRolesPanelNavigate,
    services_provider: 'BotServicesProvider'
):
    from Systems.core.database.core_models import Role as DBRole
    admin_user_id = query.from_user.id
    role_id_to_delete = callback_data.item_id

    if role_id_to_delete is None or not str(role_id_to_delete).isdigit():
        await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ°: ID Ñ€Ğ¾Ğ»Ğ¸ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚ĞµĞ½.", show_alert=True); return
    
    role_id_to_delete = int(str(role_id_to_delete))

    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ»Ğ¸ ID: {role_id_to_delete}.")

    async with services_provider.db.get_session() as session:
        if not services_provider.config.core.super_admins or admin_user_id not in services_provider.config.core.super_admins:
            if not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_ROLES_DELETE):
                await query.answer(ADMIN_COMMON_TEXTS["access_denied"], show_alert=True); return

        role_to_delete = await session.get(DBRole, role_id_to_delete)
        if not role_to_delete:
            await query.answer(ADMIN_COMMON_TEXTS["not_found_generic"], show_alert=True); return

        if role_to_delete.name in DEFAULT_ROLES_DEFINITIONS:
            await query.answer(ADMIN_COMMON_TEXTS.get('role_is_standard_cant_delete','Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½ÑƒÑ Ñ€Ğ¾Ğ»ÑŒ "{role_name}" ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Ğ½ĞµĞ»ÑŒĞ·Ñ.').format(role_name=hcode(role_to_delete.name)), show_alert=True); return
        
        user_role_count_stmt = select(sql_func.count(UserRole.id)).where(UserRole.role_id == role_id_to_delete)
        user_role_count_res = await session.execute(user_role_count_stmt)
        user_count_with_role = user_role_count_res.scalar_one()

        warning_text = ""
        if user_count_with_role > 0:
            text_with_warning = (f"ğŸš« {hbold('Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾!')}\n"
                                 f"Ğ Ğ¾Ğ»ÑŒ {hcode(role_to_delete.name)} Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ° {hbold(str(user_count_with_role))} Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ(ÑĞ¼).\n"
                                 f"Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ½Ğ¸Ğ¼Ğ¸Ñ‚Ğµ ÑÑ‚Ñƒ Ñ€Ğ¾Ğ»ÑŒ ÑĞ¾ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.")
            builder = InlineKeyboardBuilder()
            builder.button(text=ROLES_MGMT_TEXTS.get('back_to_role_details', "ĞĞ°Ğ·Ğ°Ğ´"), 
                           callback_data=AdminRolesPanelNavigate(action="view", item_id=role_id_to_delete).pack())
            if query.message: await query.message.edit_text(text_with_warning, reply_markup=builder.as_markup())
            await query.answer(f"Ğ Ğ¾Ğ»ÑŒ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ {user_count_with_role} Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸.", show_alert=True)
            return

        text = ADMIN_COMMON_TEXTS.get('delete_role_confirm_text','Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ {role_name}?\n{warning_if_users}\nĞ­Ñ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ½ĞµĞ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ğ¼Ğ¾!').format(role_name=hbold(role_to_delete.name), warning_if_users=warning_text)
        
        from Systems.core.ui.keyboards_core import get_confirm_action_keyboard 
        keyboard = get_confirm_action_keyboard(
            confirm_callback_data=AdminRolesPanelNavigate(action="delete_execute", item_id=role_id_to_delete).pack(),
            cancel_callback_data=AdminRolesPanelNavigate(action="view", item_id=role_id_to_delete).pack() 
        )
        if query.message:
            await query.message.edit_text(text, reply_markup=keyboard)
        await query.answer()


@role_crud_fsm_router.callback_query(AdminRolesPanelNavigate.filter(F.action == "delete_execute"))
async def cq_admin_role_delete_execute_crud( 
    query: types.CallbackQuery,
    callback_data: AdminRolesPanelNavigate,
    services_provider: 'BotServicesProvider',
    bot: Bot
):
    from Systems.core.database.core_models import Role as DBRole
    from sqlalchemy import select, func as sql_func
    from Systems.core.database.core_models import UserRole
    admin_user_id = query.from_user.id
    role_id_to_delete = callback_data.item_id

    if role_id_to_delete is None or not str(role_id_to_delete).isdigit():
        await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ°: ID Ñ€Ğ¾Ğ»Ğ¸ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚ĞµĞ½.", show_alert=True); return
    
    role_id_to_delete = int(str(role_id_to_delete))

    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ğ» ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ ID: {role_id_to_delete}.")
    
    default_fail_text = ADMIN_COMMON_TEXTS.get('role_delete_failed','ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ "{role_name}".')
    alert_text = default_fail_text.format(role_name="ID:"+str(role_id_to_delete)) 

    async with services_provider.db.get_session() as session:
        if not services_provider.config.core.super_admins or admin_user_id not in services_provider.config.core.super_admins:
            if not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_ROLES_DELETE):
                await query.answer(ADMIN_COMMON_TEXTS["access_denied"], show_alert=True); return

        role_to_delete = await session.get(DBRole, role_id_to_delete) 
        if not role_to_delete:
            alert_text = ADMIN_COMMON_TEXTS["not_found_generic"]
        elif role_to_delete.name in DEFAULT_ROLES_DEFINITIONS:
            alert_text = ADMIN_COMMON_TEXTS.get('role_is_standard_cant_delete','Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½ÑƒÑ Ñ€Ğ¾Ğ»ÑŒ "{role_name}" ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Ğ½ĞµĞ»ÑŒĞ·Ñ.').format(role_name=hcode(role_to_delete.name))
        else:
            user_role_count_stmt = select(sql_func.count(UserRole.id)).where(UserRole.role_id == role_id_to_delete)
            user_role_count_res = await session.execute(user_role_count_stmt)
            if user_role_count_res.scalar_one() > 0:
                alert_text = "ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ¾Ğ½Ğ° Ğ²ÑĞµ ĞµÑ‰Ğµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼."
            else:
                role_name_deleted = role_to_delete.name
                if await services_provider.rbac.delete_role(session, role_id_to_delete): 
                    try:
                        await session.commit()
                        alert_text = ADMIN_COMMON_TEXTS.get('role_deleted_successfully','Ğ Ğ¾Ğ»ÑŒ "{role_name}" ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ°.').format(role_name=hcode(role_name_deleted))
                        logger.info(f"[{MODULE_NAME_FOR_LOG}] {alert_text}")
                    except Exception as e_commit:
                        await session.rollback()
                        logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° commit Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ Ñ€Ğ¾Ğ»Ğ¸: {e_commit}", exc_info=True)
                        alert_text = "ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ»Ğ¸."
                else: 
                    alert_text = default_fail_text.format(role_name=hcode(role_name_deleted))
        
        # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ€Ğ¾Ğ»ĞµĞ¹
        from .keyboards_roles import get_admin_roles_list_keyboard_local, ROLES_MGMT_TEXTS
        from Systems.core.rbac.service import PERMISSION_CORE_ROLES_VIEW
        from Systems.core.database.core_models import Role as DBRole
        from sqlalchemy import select, func as sql_func
        
        async with services_provider.db.get_session() as session:
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ°
            has_perm = await services_provider.rbac.user_has_permission(session, query.from_user.id, PERMISSION_CORE_ROLES_VIEW)
            if not has_perm:
                await query.bot.send_message(query.from_user.id, "Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° ÑĞ¿Ğ¸ÑĞºĞ° Ñ€Ğ¾Ğ»ĞµĞ¹.")
                return
            
            # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ€Ğ¾Ğ»ĞµĞ¹
            roles_query = select(DBRole).order_by(DBRole.name)
            roles_result = await session.execute(roles_query)
            all_roles = list(roles_result.scalars().all())
            
            # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ñ‚ĞµĞºÑÑ‚ Ğ¸ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ
            text = ROLES_MGMT_TEXTS["role_list_title"]
            keyboard = await get_admin_roles_list_keyboard_local(all_roles, services_provider, query.from_user.id, session)
            
            await query.bot.send_message(query.from_user.id, text, reply_markup=keyboard)

    await query.answer(alert_text, show_alert=True)


======================================================================

------------------------------ FILE: Systems/core/admin/roles/handlers_details.py ------------------------------
# core/admin/roles/handlers_details.py
from aiogram import Router, types, F, Bot
from aiogram.utils.markdown import hbold, hcode, hitalic
from loguru import logger
from sqlalchemy.orm import selectinload
from sqlalchemy import select, func as sql_func 
from aiogram.exceptions import TelegramBadRequest 

from Systems.core.ui.callback_data_factories import AdminRolesPanelNavigate
from .keyboards_roles import get_admin_role_details_keyboard_local, ROLES_MGMT_TEXTS, get_roles_mgmt_texts
from Systems.core.admin.keyboards_admin_common import ADMIN_COMMON_TEXTS, get_admin_texts
from Systems.core.admin.filters_admin import can_view_admin_panel_filter
from Systems.core.rbac.service import PERMISSION_CORE_ROLES_VIEW, DEFAULT_ROLES_DEFINITIONS
from Systems.core.database.core_models import Role as DBRole

from typing import TYPE_CHECKING, Optional
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from sqlalchemy.ext.asyncio import AsyncSession 

role_details_router = Router(name="sdb_admin_role_details_handlers")
MODULE_NAME_FOR_LOG = "AdminRoleMgmtDetails"

#role_details_router.callback_query.filter(can_view_admin_panel_filter)

@role_details_router.callback_query(AdminRolesPanelNavigate.filter(F.action == "view"))
async def cq_admin_role_view_details_entry( 
    query: types.CallbackQuery,
    callback_data: AdminRolesPanelNavigate, 
    services_provider: 'BotServicesProvider'
):
    # logger.critical(f"!!! [{MODULE_NAME_FOR_LOG}] Ğ¥Ğ­ĞĞ”Ğ›Ğ•Ğ  cq_admin_role_view_details_entry Ğ’Ğ«Ğ—Ğ’ĞĞ! Callback: {callback_data.model_dump_json(exclude_none=True)}") # <--- Ğ£Ğ‘Ğ ĞĞĞ
    
    admin_user_id = query.from_user.id
    target_role_db_id: Optional[int] = None 
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    roles_texts = get_roles_mgmt_texts(services_provider, user_locale)
    
    logger.debug(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½ callback Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ€Ğ¾Ğ»Ğ¸: {callback_data.model_dump_json(exclude_none=True)}")

    if callback_data.item_id is None or not str(callback_data.item_id).isdigit():
        logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ item_id (ID Ñ€Ğ¾Ğ»Ğ¸: {callback_data.item_id}) Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹.")
        await query.answer(admin_texts["admin_error_role_id_invalid"], show_alert=True)
        return
    
    target_role_db_id = int(str(callback_data.item_id))
        
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ñ€Ğ¾Ğ»Ğ¸ Ñ DB ID: {target_role_db_id}")

    async with services_provider.db.get_session() as session: # type: AsyncSession
        has_perm_to_view = False
        is_owner_from_config = admin_user_id in services_provider.config.core.super_admins
        if is_owner_from_config:
            has_perm_to_view = True
            logger.trace(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½ {admin_user_id} ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†ĞµĞ¼, Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼ Ñ€Ğ¾Ğ»Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½.")
        else:
            try:
                has_perm_to_view = await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_ROLES_VIEW)
                logger.trace(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½ {admin_user_id} Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ²Ğ¾ '{PERMISSION_CORE_ROLES_VIEW}': {has_perm_to_view}")
            except Exception as e_perm:
                 logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ°Ğ²Ğ° PERMISSION_CORE_ROLES_VIEW Ğ´Ğ»Ñ {admin_user_id}: {e_perm}")
                 await query.answer(admin_texts["error_general"], show_alert=True)
                 return

        if not has_perm_to_view:
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½ {admin_user_id} Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ€Ğ¾Ğ»Ğ¸.")
            await query.answer(admin_texts["access_denied"], show_alert=True)
            return

        role = await session.get(DBRole, target_role_db_id, options=[selectinload(DBRole.permissions)])
        
        if not role:
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] Ğ Ğ¾Ğ»ÑŒ Ñ DB ID: {target_role_db_id} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°.")
            await query.answer(admin_texts["not_found_generic"], show_alert=True)
            return
        
        logger.debug(f"[{MODULE_NAME_FOR_LOG}] Ğ Ğ¾Ğ»ÑŒ '{role.name}' Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°, Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¸ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹...")
        permissions_list_str = "\n".join(
            [
                f"  â–«ï¸ {hcode(p.name)} ({hitalic(p.description or 'Ğ±ĞµĞ· Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ')})"
                for p in sorted(role.permissions, key=lambda x: x.name)
            ]
        ) if role.permissions else roles_texts.get("role_no_permissions", "  (Ğ½ĞµÑ‚ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹)")

        text_parts = [
            f"{roles_texts['role_details_title']}: {hcode(role.name)}",
            f"   DB ID: {hcode(str(role.id))}",
            f"   {roles_texts.get('role_description_label', 'ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:')} {hitalic(role.description or 'Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚')}",
            f"\n{roles_texts.get('role_permissions_label', 'Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸:')}",
            permissions_list_str
        ]
        text = "\n".join(text_parts)
        
        keyboard = await get_admin_role_details_keyboard_local(role, services_provider, admin_user_id, session, locale=user_locale)
        logger.debug(f"[{MODULE_NAME_FOR_LOG}] ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}' ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°.")

        if query.message:
            try:
                if query.message.text != text or query.message.reply_markup != keyboard:
                    await query.message.edit_text(text, reply_markup=keyboard)
                    logger.debug(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼Ğ¸ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}' Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾.")
                else:
                    logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ€Ğ¾Ğ»Ğ¸ ({role.id}) Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾.")
                await query.answer()
            except TelegramBadRequest as e_tbr:
                if "message is not modified" in str(e_tbr).lower():
                    logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ€Ğ¾Ğ»Ğ¸ ({role.id}) Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾ (Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ğ½Ğ¾ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ).")
                    await query.answer()
                else:
                    logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ€Ğ¾Ğ»Ğ¸ ({role.id}): {e_tbr}")
            except Exception as e_edit:
                logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞĞµĞ¿Ñ€ĞµĞ´Ğ²Ğ¸Ğ´ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² cq_admin_role_view_details_entry Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ {role.id}: {e_edit}", exc_info=True)
                await query.answer(admin_texts["error_general"], show_alert=True)
        else: 
             logger.warning(f"[{MODULE_NAME_FOR_LOG}] query.message is None Ğ² cq_admin_role_view_details_entry Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ {role.id}.")
             await query.answer()


======================================================================

------------------------------ FILE: Systems/core/admin/roles/handlers_list.py ------------------------------
# core/admin/roles/handlers_list.py
from aiogram import Router, types, F, Bot 
from aiogram.utils.markdown import hbold
from loguru import logger
from sqlalchemy import select, func as sql_func
from aiogram.exceptions import TelegramBadRequest # <--- Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•Ğ Ğ˜ĞœĞŸĞĞ Ğ¢

from Systems.core.ui.callback_data_factories import AdminRolesPanelNavigate
from .keyboards_roles import get_admin_roles_list_keyboard_local, ROLES_MGMT_TEXTS, get_roles_mgmt_texts
from Systems.core.admin.keyboards_admin_common import get_admin_texts
from Systems.core.admin.filters_admin import can_view_admin_panel_filter 
from Systems.core.rbac.service import PERMISSION_CORE_ROLES_VIEW
from Systems.core.database.core_models import Role as DBRole

from typing import TYPE_CHECKING, List
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from sqlalchemy.ext.asyncio import AsyncSession 

roles_list_router = Router(name="sdb_admin_roles_list_handlers")
MODULE_NAME_FOR_LOG = "AdminRoleMgmtList"

#roles_list_router.callback_query.filter(can_view_admin_panel_filter) 

@roles_list_router.callback_query(AdminRolesPanelNavigate.filter(F.action == "list"))
async def cq_admin_roles_list_entry( 
    query: types.CallbackQuery,
    callback_data: AdminRolesPanelNavigate, 
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ€Ğ¾Ğ»ĞµĞ¹.")

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    roles_texts = get_roles_mgmt_texts(services_provider, user_locale)

    async with services_provider.db.get_session() as session: # type: AsyncSession
        has_perm_to_view_list = False
        is_owner_from_config = admin_user_id in services_provider.config.core.super_admins
        if is_owner_from_config:
            has_perm_to_view_list = True
        else:
            try:
                has_perm_to_view_list = await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_ROLES_VIEW)
            except Exception as e_perm_check_list:
                logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ°Ğ²Ğ° PERMISSION_CORE_ROLES_VIEW Ğ´Ğ»Ñ user {admin_user_id}: {e_perm_check_list}")
                await query.answer(admin_texts["admin_error_checking_permissions"], show_alert=True) 
                return

        if not has_perm_to_view_list:
            await query.answer(admin_texts["admin_error_no_permission_to_view_roles"], show_alert=True) 
            return
        
        all_roles: List[DBRole] = await services_provider.rbac.get_all_roles(session)
        
        text = f"{roles_texts['role_list_title']}\n{roles_texts['role_list_select_action']}"
        keyboard = await get_admin_roles_list_keyboard_local(all_roles, services_provider, admin_user_id, session, locale=user_locale)

        target_chat_id = query.message.chat.id if query.message else admin_user_id

        try:
            if query.message and (query.message.text != text or query.message.reply_markup != keyboard):
                await query.message.edit_text(text, reply_markup=keyboard)
                logger.debug(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑĞ¾ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾.")
            elif not query.message: 
                 await query.bot.send_message(target_chat_id, text, reply_markup=keyboard)
                 logger.debug(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑĞ¾ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ (Ñ‚.Ğº. query.message Ğ±Ñ‹Ğ» None).")
            else:
                logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ½Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾.")
            await query.answer()
        except TelegramBadRequest as e_tbr: # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ TelegramBadRequest
            if query.message and "message to edit not found" in str(e_tbr).lower(): 
                logger.warning(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾, Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾: {e_tbr}")
                await query.bot.send_message(target_chat_id, text, reply_markup=keyboard)
                await query.answer()
            elif "message is not modified" in str(e_tbr).lower():
                logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ½Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾ (Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ğ½Ğ¾ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ).")
                await query.answer()
            else:
                logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Telegram BadRequest Ğ¿Ñ€Ğ¸ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸/Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ ÑĞ¿Ğ¸ÑĞºĞ° Ñ€Ğ¾Ğ»ĞµĞ¹: {e_tbr}")
                await query.answer(admin_texts["admin_error_displaying_list"], show_alert=True)
        except Exception as e_edit:
            logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞĞµĞ¿Ñ€ĞµĞ´Ğ²Ğ¸Ğ´ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² cq_admin_roles_list_entry: {e_edit}", exc_info=True)
            await query.answer(admin_texts["admin_error_displaying_role_list"], show_alert=True)


======================================================================

------------------------------ FILE: Systems/core/admin/roles/__init__.py ------------------------------
# core/admin/roles/__init__.py
from aiogram import Router

# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ "ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğµ" Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ñ‹ Ğ¸Ğ· ÑÑ‚Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°
from .handlers_list import roles_list_router
from .handlers_details import role_details_router
from .handlers_role_perms import role_permissions_router
from .handlers_crud_fsm import role_crud_fsm_router

# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¾Ğ´Ğ¸Ğ½ "ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‰Ğ¸Ğ¹" Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ´Ğ»Ñ Ğ²ÑĞµĞ³Ğ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ° "roles"
section_roles_router = Router(name="sdb_admin_section_roles_router")

section_roles_router.include_router(roles_list_router)
section_roles_router.include_router(role_details_router)
section_roles_router.include_router(role_permissions_router)
section_roles_router.include_router(role_crud_fsm_router)

# Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‰Ğ¸Ğ¹ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ¸Ğ¼ĞµĞ½ĞµĞ¼
__all__ = ["section_roles_router"]


======================================================================

------------------------------ FILE: Systems/core/admin/roles/handlers_role_perms.py ------------------------------
# core/admin/roles/handlers_role_perms.py
from aiogram import Router, types, F, Bot
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup
from aiogram.utils.markdown import hbold
from loguru import logger
from sqlalchemy.orm import selectinload
from aiogram.filters import StateFilter # <--- Ğ”ĞĞ‘ĞĞ’Ğ›Ğ•Ğ Ğ˜ĞœĞŸĞĞ Ğ¢
from aiogram.exceptions import TelegramBadRequest # <--- Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•Ğ Ğ˜ĞœĞŸĞĞ Ğ¢

# Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹
from Systems.core.ui.callback_data_factories import AdminRolesPanelNavigate 
from .keyboards_roles import get_admin_role_edit_permissions_keyboard_local, ROLES_MGMT_TEXTS, get_roles_mgmt_texts
from Systems.core.admin.keyboards_admin_common import ADMIN_COMMON_TEXTS, get_admin_texts
from Systems.core.admin.filters_admin import can_view_admin_panel_filter
from Systems.core.rbac.service import PERMISSION_CORE_ROLES_ASSIGN_PERMISSIONS
from Systems.core.database.core_models import Role as DBRole, Permission as DBPermission

from typing import TYPE_CHECKING, Optional, List
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from sqlalchemy.ext.asyncio import AsyncSession

role_permissions_router = Router(name="sdb_admin_role_permissions_handlers")
MODULE_NAME_FOR_LOG = "AdminRolePermissions"

#role_permissions_router.callback_query.filter(can_view_admin_panel_filter)

# --- FSM Ğ´Ğ»Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼ Ñ€Ğ¾Ğ»Ğ¸ ---
class FSMEditRolePermissions(StatesGroup):
    navigating_role_permissions = State()

# --- Ğ’Ñ…Ğ¾Ğ´ Ğ² FSM Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ñ€Ğ¾Ğ»Ğ¸ ---
@role_permissions_router.callback_query(AdminRolesPanelNavigate.filter(F.action == "edit_perms_start"))
async def cq_admin_role_edit_permissions_entry(
    query: types.CallbackQuery,
    callback_data: AdminRolesPanelNavigate,
    services_provider: 'BotServicesProvider',
    state: FSMContext
):
    admin_user_id = query.from_user.id
    target_role_db_id = callback_data.item_id
    page = callback_data.page or 1 

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    roles_texts = get_roles_mgmt_texts(services_provider, user_locale)

    if target_role_db_id is None:
        await query.answer(admin_texts["admin_error_role_id_not_specified"], show_alert=True); return

    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½ {admin_user_id} Ğ²Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² FSM ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸ Ğ´Ğ»Ñ Role ID: {target_role_db_id}, page: {page}")

    async with services_provider.db.get_session() as session:
        current_admin_is_owner = admin_user_id in services_provider.config.core.super_admins
        if not current_admin_is_owner and \
           not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_ROLES_ASSIGN_PERMISSIONS):
            await query.answer(admin_texts["access_denied"], show_alert=True)
            return
        
        target_role = await session.get(DBRole, target_role_db_id, options=[selectinload(DBRole.permissions)])
        if not target_role:
            await query.answer(admin_texts["not_found_generic"], show_alert=True); return

    await state.clear()
    await state.set_state(FSMEditRolePermissions.navigating_role_permissions)
    await state.update_data(
        target_role_id_for_perms=target_role_db_id,
        current_page=page, 
        # category_key Ğ¸ entity_name Ğ±ÑƒĞ´ÑƒÑ‚ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸
    )
    
    await _show_role_permissions_menu(query, services_provider, state)

# --- ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼/ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑĞ¼/ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°Ğ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ñ€Ğ¾Ğ»Ğ¸ ---
@role_permissions_router.callback_query(
    AdminRolesPanelNavigate.filter(F.action == "edit_perms_nav"),
    StateFilter(FSMEditRolePermissions.navigating_role_permissions)
)
async def cq_admin_role_permissions_navigate(
    query: types.CallbackQuery,
    callback_data: AdminRolesPanelNavigate,
    services_provider: 'BotServicesProvider',
    state: FSMContext
):
    fsm_data = await state.get_data()
    target_role_db_id = fsm_data.get("target_role_id_for_perms")
    if target_role_db_id is None:
        await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ FSM. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ²Ñ‹Ğ¹Ñ‚Ğ¸ Ğ¸ Ğ²Ğ¾Ğ¹Ñ‚Ğ¸ ÑĞ½Ğ¾Ğ²Ğ°.", show_alert=True)
        await state.clear(); return

    new_fsm_context_data = {
        "category_key": callback_data.category_key,
        "entity_name": callback_data.entity_name,
        "current_page": callback_data.page or 1
    }
    await state.update_data(**new_fsm_context_data)
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½ {query.from_user.id} Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼ Ñ€Ğ¾Ğ»Ğ¸ (Role ID: {target_role_db_id}). "
                f"ĞĞ¾Ğ²Ñ‹Ğ¹ FSM ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸: {new_fsm_context_data}")
    
    await _show_role_permissions_menu(query, services_provider, state)

# --- ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ ---
@role_permissions_router.callback_query(
    AdminRolesPanelNavigate.filter(F.action == "toggle_perm"),
    StateFilter(FSMEditRolePermissions.navigating_role_permissions)
)
async def cq_admin_role_toggle_permission(
    query: types.CallbackQuery,
    callback_data: AdminRolesPanelNavigate,
    services_provider: 'BotServicesProvider',
    state: FSMContext
):
    admin_user_id = query.from_user.id
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale_toggle = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale_toggle = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts_toggle = get_admin_texts(services_provider, user_locale_toggle)
    
    fsm_data = await state.get_data()
    target_role_db_id: Optional[int] = fsm_data.get("target_role_id_for_perms")
    permission_to_toggle_id: Optional[int] = callback_data.permission_id

    if target_role_db_id is None or permission_to_toggle_id is None:
        await query.answer(admin_texts_toggle["admin_error_invalid_permission_data"], show_alert=True); return

    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½ {admin_user_id} Ğ¸Ğ·Ğ¼ĞµĞ½ÑĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ "
                f"PermID:'{permission_to_toggle_id}' Ğ´Ğ»Ñ Role DBID:{target_role_db_id}")

    async with services_provider.db.get_session() as session:
        current_admin_is_owner = admin_user_id in services_provider.config.core.super_admins
        if not current_admin_is_owner and \
           not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_ROLES_ASSIGN_PERMISSIONS):
            await query.answer(admin_texts_toggle["access_denied"], show_alert=True); return
        
        target_role = await session.get(DBRole, target_role_db_id, options=[selectinload(DBRole.permissions)])
        permission_to_modify = await session.get(DBPermission, permission_to_toggle_id)

        if not target_role or not permission_to_modify:
            await query.answer(admin_texts_toggle["not_found_generic"], show_alert=True); return

        role_has_this_perm = permission_to_modify in target_role.permissions
        alert_text, action_performed = "", False

        if role_has_this_perm:
            if await services_provider.rbac.remove_permission_from_role(session, target_role, permission_to_modify.name):
                action_performed = True
                alert_text = admin_texts_toggle["admin_role_perm_removed"].format(permission_name=permission_to_modify.name)
            else: alert_text = admin_texts_toggle["admin_role_perm_failed_to_remove"].format(permission_name=permission_to_modify.name)
        else:
            if await services_provider.rbac.assign_permission_to_role(session, target_role, permission_to_modify.name, auto_create_perm=False):
                action_performed = True
                alert_text = admin_texts_toggle["admin_role_perm_assigned"].format(permission_name=permission_to_modify.name)
            else: alert_text = admin_texts_toggle["admin_role_perm_failed_to_assign"].format(permission_name=permission_to_modify.name)
        
        if action_performed:
            try: await session.commit(); logger.info(f"[{MODULE_NAME_FOR_LOG}] {alert_text} Ğ´Ğ»Ñ Role ID: {target_role.id}"); await session.refresh(target_role, attribute_names=['permissions'])
            except Exception as e: await session.rollback(); logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° commit: {e}"); alert_text = admin_texts_toggle["admin_error_saving"]
        
        await query.answer(alert_text, show_alert=action_performed and "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ" not in alert_text)
        await _show_role_permissions_menu(query, services_provider, state)

# --- Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¼ĞµĞ½Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ñ€Ğ¾Ğ»Ğ¸ ---
async def _show_role_permissions_menu(
    query: types.CallbackQuery, 
    services_provider: 'BotServicesProvider', 
    state: FSMContext
):
    admin_user_id = query.from_user.id
    fsm_data = await state.get_data()
    
    target_role_db_id = fsm_data.get("target_role_id_for_perms")
    category_key = fsm_data.get("category_key")
    entity_name = fsm_data.get("entity_name")
    page = fsm_data.get("current_page", 1)

    if target_role_db_id is None:
        await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ FSM (ID Ñ€Ğ¾Ğ»Ğ¸).", show_alert=True); await state.clear(); return

    async with services_provider.db.get_session() as session:
        target_role = await session.get(DBRole, target_role_db_id, options=[selectinload(DBRole.permissions)])
        if not target_role:
            await query.answer(admin_texts_show["not_found_generic"], show_alert=True); await state.clear(); return

        all_system_permissions = await services_provider.rbac.get_all_permissions(session)
        
        base_text = roles_texts_show["edit_permissions_for_role"].format(role_name=hbold(target_role.name))
        current_level_text = ""
        if category_key == "core":
            current_level_text = f" / {admin_texts_show.get('admin_perm_category_core', 'Ğ¯Ğ´Ñ€Ğ¾')}"
            if entity_name: current_level_text += f" / {admin_texts_show.get(f'admin_perm_core_group_{entity_name}', entity_name.capitalize())}"
        elif category_key == "module":
            current_level_text = f" / {admin_texts_show.get('admin_perm_category_modules', 'ĞœĞ¾Ğ´ÑƒĞ»Ğ¸')}"
            if entity_name:
                mod_info = services_provider.modules.get_module_info(entity_name)
                current_level_text += f" / {mod_info.manifest.display_name if mod_info and mod_info.manifest else entity_name}"
        
        instruction_text = roles_texts_show.get(
            "role_permissions_instruction",
            admin_texts_show.get("admin_role_permissions_heading", "ĞÑ‚Ğ¼ĞµÑ‚ÑŒÑ‚Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ/ÑĞ½ÑÑ‚Ğ¸Ñ:")
        )
        text = f"{base_text}{current_level_text}\n{instruction_text}"
        
        keyboard = await get_admin_role_edit_permissions_keyboard_local(
            target_role=target_role, 
            all_system_permissions=all_system_permissions, 
            services=services_provider, 
            current_admin_tg_id=admin_user_id, 
            session=session,
            category_key=category_key, entity_name=entity_name, page=page,
            locale=user_locale_show
        )

        if query.message:
            try:
                if query.message.text != text or query.message.reply_markup != keyboard:
                    await query.message.edit_text(text, reply_markup=keyboard)
            except TelegramBadRequest as e:
                if "message is not modified" not in str(e).lower(): 
                    logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° edit_text (_show_role_permissions_menu): {e}")
            except Exception as e_edit:
                logger.error(f"ĞĞµĞ¿Ñ€ĞµĞ´Ğ²Ğ¸Ğ´ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² _show_role_permissions_menu: {e_edit}", exc_info=True)
                if query.message: await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ.", show_alert=True)

# Ğ’Ñ‹Ñ…Ğ¾Ğ´ Ğ¸Ğ· FSM ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ñ€Ğ¾Ğ»Ğ¸ (ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ "Ğš Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼ Ñ€Ğ¾Ğ»Ğ¸")
@role_permissions_router.callback_query(
    AdminRolesPanelNavigate.filter(F.action == "view"), 
    StateFilter(FSMEditRolePermissions.navigating_role_permissions) 
)
async def cq_back_to_role_details_from_perms_fsm(
    query: types.CallbackQuery,
    callback_data: AdminRolesPanelNavigate, 
    services_provider: 'BotServicesProvider',
    state: FSMContext
):
    await state.clear() 
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {query.from_user.id} Ğ²Ñ‹ÑˆĞµĞ» Ğ¸Ğ· FSM ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ñ€Ğ¾Ğ»Ğ¸.")
    from .handlers_details import cq_admin_role_view_details_entry
    await cq_admin_role_view_details_entry(query, callback_data, services_provider)


======================================================================

------------------------------ FILE: Systems/core/admin/users/handlers_roles_assign.py ------------------------------
# core/admin/users/handlers_roles_assign.py
from aiogram import Router, types, F
from aiogram.utils.markdown import hbold
from loguru import logger
from sqlalchemy.orm import selectinload
from aiogram.exceptions import TelegramBadRequest # <--- Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•Ğ Ğ˜ĞœĞŸĞĞ Ğ¢

from Systems.core.ui.callback_data_factories import AdminUsersPanelNavigate
from .keyboards_users import get_admin_user_edit_roles_keyboard_local, USERS_MGMT_TEXTS, get_users_mgmt_texts
from Systems.core.admin.keyboards_admin_common import ADMIN_COMMON_TEXTS, get_admin_texts 
from Systems.core.admin.filters_admin import can_view_admin_panel_filter
from Systems.core.rbac.service import PERMISSION_CORE_USERS_ASSIGN_ROLES, DEFAULT_ROLE_USER
from Systems.core.database.core_models import User as DBUser, Role as DBRole
from .handlers_details import _send_or_edit_user_details_local

from typing import TYPE_CHECKING, Optional
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from sqlalchemy.ext.asyncio import AsyncSession

user_roles_assign_router = Router(name="sdb_admin_user_roles_assign_handlers")
MODULE_NAME_FOR_LOG = "AdminUserRolesAssign"

#user_roles_assign_router.callback_query.filter(can_view_admin_panel_filter)

@user_roles_assign_router.callback_query(AdminUsersPanelNavigate.filter(F.action == "edit_roles_start"))
async def cq_admin_user_edit_roles_start_assign( 
    query: types.CallbackQuery,
    callback_data: AdminUsersPanelNavigate, 
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    target_user_db_id: Optional[int] = None
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    users_texts = get_users_mgmt_texts(services_provider, user_locale)
    
    if callback_data.item_id is not None:
        try: 
            target_user_db_id = int(str(callback_data.item_id))
        except ValueError:
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ item_id '{callback_data.item_id}' Ğ´Ğ»Ñ edit_roles_start.")
            await query.answer(admin_texts["admin_error_invalid_user_id"], show_alert=True)
            return
    
    if target_user_db_id is None: 
        await query.answer(admin_texts["admin_error_user_id_for_roles_not_specified"], show_alert=True); return

    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ DB ID: {target_user_db_id}")

    async with services_provider.db.get_session() as session:
        if not services_provider.config.core.super_admins or admin_user_id not in services_provider.config.core.super_admins:
            if not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_USERS_ASSIGN_ROLES):
                await query.answer(admin_texts["access_denied"], show_alert=True); return
        
        target_user = await session.get(DBUser, target_user_db_id, options=[selectinload(DBUser.roles)])
        if not target_user:
            await query.answer(admin_texts["not_found_generic"], show_alert=True); return

        if target_user.telegram_id in services_provider.config.core.super_admins:
            await query.answer(admin_texts["admin_error_cannot_change_owner_roles"], show_alert=True)
            await _send_or_edit_user_details_local(query, target_user, services_provider, session, admin_user_id, locale=user_locale)
            return

        all_system_roles = await services_provider.rbac.get_all_roles(session)
        text = users_texts["edit_roles_for_user"].format(user_name=hbold(target_user.full_name))
        keyboard = await get_admin_user_edit_roles_keyboard_local(target_user, all_system_roles, services_provider, admin_user_id, session, locale=user_locale)

        if query.message:
            try:
                if query.message.text != text or query.message.reply_markup != keyboard:
                    await query.message.edit_text(text, reply_markup=keyboard)
                await query.answer()
            except TelegramBadRequest as e_tbr: # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ TelegramBadRequest
                if "message is not modified" not in str(e_tbr).lower(): await query.answer()
                else: logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° edit_text Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»ĞµĞ¹: {e_tbr}")
            except Exception as e_edit:
                logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² cq_admin_user_edit_roles_start_assign: {e_edit}", exc_info=True)
                await query.answer(admin_texts["error_general"], show_alert=True)

@user_roles_assign_router.callback_query(AdminUsersPanelNavigate.filter(F.action == "toggle_role"))
async def cq_admin_user_toggle_role_assign( 
    query: types.CallbackQuery,
    callback_data: AdminUsersPanelNavigate, 
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    target_user_db_id: Optional[int] = None
    role_to_toggle_id: Optional[int] = None

    if callback_data.item_id is not None: 
        try: 
            target_user_db_id = int(str(callback_data.item_id))
        except ValueError: 
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ item_id '{callback_data.item_id}' Ğ´Ğ»Ñ toggle_role.")
            pass 
    
    if callback_data.role_id is not None: 
        try: 
            role_to_toggle_id = int(str(callback_data.role_id))
        except ValueError: 
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ role_id '{callback_data.role_id}' Ğ´Ğ»Ñ toggle_role.")
            pass 

    if target_user_db_id is None or role_to_toggle_id is None:
        logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğµ Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ ID Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ»Ğ¸: user_id={target_user_db_id}, role_id={role_to_toggle_id}")
        await query.answer("ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ»Ğ¸.", show_alert=True); return

    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½ {admin_user_id} Ğ¿Ñ‹Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ ID:{role_to_toggle_id} Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ DB ID:{target_user_db_id}")

    async with services_provider.db.get_session() as session:
        is_current_admin_owner = admin_user_id in services_provider.config.core.super_admins
        if not is_current_admin_owner:
            if not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_USERS_ASSIGN_ROLES):
                await query.answer(ADMIN_COMMON_TEXTS["access_denied"], show_alert=True); return
        
        target_user = await session.get(DBUser, target_user_db_id, options=[selectinload(DBUser.roles)])
        role_to_modify = await session.get(DBRole, role_to_toggle_id)

        if not target_user or not role_to_modify:
            await query.answer(ADMIN_COMMON_TEXTS["not_found_generic"], show_alert=True); return
        if target_user.telegram_id in services_provider.config.core.super_admins:
            await query.answer("ĞĞµĞ»ÑŒĞ·Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ñ€Ğ¾Ğ»Ğ¸ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°.", show_alert=True); return
            
        user_has_this_role = role_to_modify in target_user.roles
        if role_to_modify.name == DEFAULT_ROLE_USER and user_has_this_role and len(target_user.roles) == 1:
            await query.answer(f"ĞĞµĞ»ÑŒĞ·Ñ ÑĞ½ÑÑ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ñ€Ğ¾Ğ»ÑŒ '{DEFAULT_ROLE_USER}'.", show_alert=True); return
        
        alert_text, action_performed = "", False
        if user_has_this_role: 
            if await services_provider.rbac.remove_role_from_user(session, target_user, role_to_modify.name):
                action_performed, alert_text = True, f"Ğ Ğ¾Ğ»ÑŒ '{role_to_modify.name}' ÑĞ½ÑÑ‚Ğ°."
            else: alert_text = f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ½ÑÑ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ '{role_to_modify.name}'."
        else: 
            if await services_provider.rbac.assign_role_to_user(session, target_user, role_to_modify.name):
                action_performed, alert_text = True, f"Ğ Ğ¾Ğ»ÑŒ '{role_to_modify.name}' Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ°."
            else: alert_text = f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ '{role_to_modify.name}'."
        
        if action_performed:
            try: 
                await session.commit()
                logger.info(f"[{MODULE_NAME_FOR_LOG}] {alert_text} Ğ´Ğ»Ñ {target_user.full_name}")
                await session.refresh(target_user, attribute_names=['roles'])
            except Exception as e: 
                await session.rollback()
                logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° commit: {e}")
                alert_text = "ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ."
                action_performed=False 
        
        all_roles = await services_provider.rbac.get_all_roles(session) 
        keyboard_text = USERS_MGMT_TEXTS["edit_roles_for_user"].format(user_name=hbold(target_user.full_name))
        kb = await get_admin_user_edit_roles_keyboard_local(target_user, all_roles, services_provider, admin_user_id, session)
        if query.message: 
            try: 
                await query.message.edit_text(keyboard_text, reply_markup=kb) # Ğ˜Ğ¼Ñ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ keyboard_text
            except TelegramBadRequest as e_tbr: # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ TelegramBadRequest
                if "message is not modified" not in str(e_tbr).lower():
                    logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ Ñ€Ğ¾Ğ»ĞµĞ¹ (toggle): {e_tbr}")
            except Exception as e: 
                logger.warning(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ kb Ñ€Ğ¾Ğ»ĞµĞ¹ (toggle): {e}")
        await query.answer(alert_text, show_alert=action_performed and "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ" not in alert_text)


======================================================================

------------------------------ FILE: Systems/core/admin/users/handlers_details.py ------------------------------
# core/admin/users/handlers_details.py
from aiogram import Router, types, F
from aiogram.utils.markdown import hbold, hcode
from loguru import logger
from sqlalchemy.orm import selectinload
from aiogram.exceptions import TelegramBadRequest # <--- Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•Ğ Ğ˜ĞœĞŸĞĞ Ğ¢

from Systems.core.ui.callback_data_factories import AdminUsersPanelNavigate
from .keyboards_users import get_admin_user_details_keyboard_local, USERS_MGMT_TEXTS, get_users_mgmt_texts
from Systems.core.admin.keyboards_admin_common import ADMIN_COMMON_TEXTS, get_admin_texts 
from Systems.core.admin.filters_admin import can_view_admin_panel_filter
from Systems.core.rbac.service import PERMISSION_CORE_USERS_VIEW_DETAILS, PERMISSION_CORE_USERS_MANAGE_STATUS
from Systems.core.database.core_models import User as DBUser

from typing import TYPE_CHECKING, Optional
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from sqlalchemy.ext.asyncio import AsyncSession

user_details_router = Router(name="sdb_admin_user_details_handlers")
MODULE_NAME_FOR_LOG = "AdminUserDetails"

#user_details_router.callback_query.filter(can_view_admin_panel_filter)

async def _send_or_edit_user_details_local( 
    query: types.CallbackQuery, 
    target_user: DBUser, 
    services_provider: 'BotServicesProvider', 
    session: 'AsyncSession', 
    admin_tg_id: int,
    locale: Optional[str] = None
):
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    if not locale:
        try:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_tg_id))
            admin_user = result.scalar_one_or_none()
            if admin_user and admin_user.preferred_language_code:
                locale = admin_user.preferred_language_code
        except Exception:
            pass
        
        if not locale:
            locale = services_provider.config.core.i18n.default_locale
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    users_texts = get_users_mgmt_texts(services_provider, locale)
    admin_texts = get_admin_texts(services_provider, locale)
    
    target_user_is_owner = target_user.telegram_id in services_provider.config.core.super_admins
    
    roles_display_str: str
    if target_user_is_owner:
        roles_display_str = users_texts["user_is_owner_text"]
    elif target_user.roles:
        roles_display_str = ", ".join(sorted([role.name for role in target_user.roles]))
    else:
        roles_display_str = users_texts["user_no_roles"]

    text_parts = [
        f"ğŸ‘¤ {hbold(users_texts['user_details_title'])}: {target_user.full_name}",
        f"   {users_texts['user_telegram_id']}: {hcode(str(target_user.telegram_id))}",
        f"   {users_texts['user_db_id']}: {hcode(str(target_user.id))}",
        f"   {users_texts['user_username']}: {hcode(f'@{target_user.username}') if target_user.username else '-'}",
        f"   {users_texts['user_first_name']}: {hcode(target_user.first_name or '-')}",
        f"   {users_texts['user_last_name']}: {hcode(target_user.last_name or '-')}",
        f"   {users_texts['user_language']}: {hcode(target_user.preferred_language_code or '-')}",
        f"   {users_texts['user_active']}: {users_texts['user_active_yes'] if target_user.is_active else users_texts['user_active_no']}",
        f"   {users_texts['user_bot_blocked']}: {users_texts['user_blocked_yes'] if target_user.is_bot_blocked else users_texts['user_blocked_no']}",
        f"   {users_texts['user_roles_status']}: {hbold(roles_display_str)}",
        f"   {users_texts['user_registration']}: {target_user.created_at.strftime('%Y-%m-%d %H:%M') if target_user.created_at else '-'}",
        f"   {users_texts['user_last_activity']}: {target_user.last_activity_at.strftime('%Y-%m-%d %H:%M') if target_user.last_activity_at else '-'}",
    ]
    text = "\n".join(text_parts)
    keyboard = await get_admin_user_details_keyboard_local(target_user, services_provider, admin_tg_id, session, locale=locale)

    if query.message:
        try:
            if query.message.text != text or query.message.reply_markup != keyboard:
                await query.message.edit_text(text, reply_markup=keyboard)
            else:
                logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ({target_user.id}) Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾.")
        except TelegramBadRequest as e_tbr: # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ TelegramBadRequest
            if "message is not modified" in str(e_tbr).lower():
                logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ({target_user.id}) Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾ (Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ğ½Ğ¾ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ).")
            else:
                logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ({target_user.id}): {e_tbr}")
        except Exception as e_edit:
            logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞĞµĞ¿Ñ€ĞµĞ´Ğ²Ğ¸Ğ´ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² _send_or_edit_user_details_local Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {target_user.id}: {e_edit}", exc_info=True)


@user_details_router.callback_query(AdminUsersPanelNavigate.filter(F.action == "view"))
async def cq_admin_user_view_details_entry( 
    query: types.CallbackQuery,
    callback_data: AdminUsersPanelNavigate, 
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    target_user_db_id: Optional[int] = None

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    if callback_data.item_id is not None:
        try: target_user_db_id = int(str(callback_data.item_id))
        except ValueError:
            await query.answer(admin_texts["admin_error_invalid_user_id_format"], show_alert=True); return
    
    if target_user_db_id is None:
        await query.answer(admin_texts["admin_error_user_id_not_specified"], show_alert=True); return
        
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ñ DB ID: {target_user_db_id}")

    async with services_provider.db.get_session() as session:
        if not services_provider.config.core.super_admins or admin_user_id not in services_provider.config.core.super_admins:
            if not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_USERS_VIEW_DETAILS):
                await query.answer(admin_texts["access_denied"], show_alert=True); return

        target_user = await session.get(DBUser, target_user_db_id, options=[selectinload(DBUser.roles)])
        
        if not target_user:
            await query.answer(admin_texts["not_found_generic"], show_alert=True); return
        
        await _send_or_edit_user_details_local(query, target_user, services_provider, session, admin_user_id, locale=user_locale)
    await query.answer() 

@user_details_router.callback_query(AdminUsersPanelNavigate.filter(F.action == "toggle_active"))
async def cq_admin_user_toggle_active_details( 
    query: types.CallbackQuery,
    callback_data: AdminUsersPanelNavigate, 
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    target_user_db_id: Optional[int] = None
    if callback_data.item_id is not None:
        try: target_user_db_id = int(str(callback_data.item_id))
        except ValueError: pass
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    users_texts = get_users_mgmt_texts(services_provider, user_locale)
    
    if target_user_db_id is None:
        await query.answer(admin_texts["admin_error_user_id_not_specified"], show_alert=True); return

    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½ {admin_user_id} Ğ¸Ğ·Ğ¼ĞµĞ½ÑĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ DB ID: {target_user_db_id}")

    async with services_provider.db.get_session() as session:
        if not services_provider.config.core.super_admins or admin_user_id not in services_provider.config.core.super_admins:
            if not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_USERS_MANAGE_STATUS):
                await query.answer(admin_texts["access_denied"], show_alert=True); return

        target_user = await session.get(DBUser, target_user_db_id, options=[selectinload(DBUser.roles)])
        if not target_user:
            await query.answer(admin_texts["not_found_generic"], show_alert=True); return
        
        if target_user.telegram_id in services_provider.config.core.super_admins:
            await query.answer(admin_texts["admin_error_cannot_change_owner_status"], show_alert=True)
            await _send_or_edit_user_details_local(query, target_user, services_provider, session, admin_user_id, locale=user_locale)
            return

        new_status = not target_user.is_active
        changed = await services_provider.user_service.set_user_active_status(target_user, new_status, session)
        alert_text = ""
        if changed:
            try:
                await session.commit()
                status_text = users_texts["user_active_yes"] if new_status else users_texts["user_active_no"]
                alert_text = admin_texts["admin_user_status_active_changed"].format(user_name=target_user.full_name, status=status_text)
                logger.info(f"[{MODULE_NAME_FOR_LOG}] {alert_text}")
            except Exception as e_commit:
                await session.rollback()
                alert_text = admin_texts["admin_error_saving"]
        else:
            alert_text = admin_texts["admin_user_status_active_not_changed"]
        await _send_or_edit_user_details_local(query, target_user, services_provider, session, admin_user_id, locale=user_locale)
        await query.answer(alert_text, show_alert=bool(changed and "ĞÑˆĞ¸Ğ±ĞºĞ°" not in alert_text)) 

@user_details_router.callback_query(AdminUsersPanelNavigate.filter(F.action == "toggle_blocked"))
async def cq_admin_user_toggle_blocked_details( 
    query: types.CallbackQuery,
    callback_data: AdminUsersPanelNavigate, 
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    target_user_db_id: Optional[int] = None
    if callback_data.item_id is not None:
        try: target_user_db_id = int(str(callback_data.item_id))
        except ValueError: pass
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    users_texts = get_users_mgmt_texts(services_provider, user_locale)
    
    if target_user_db_id is None:
        await query.answer(admin_texts["admin_error_user_id_not_specified"], show_alert=True); return

    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½ {admin_user_id} Ğ¸Ğ·Ğ¼ĞµĞ½ÑĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ DB ID: {target_user_db_id}")

    async with services_provider.db.get_session() as session:
        if not services_provider.config.core.super_admins or admin_user_id not in services_provider.config.core.super_admins:
            if not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_USERS_MANAGE_STATUS):
                await query.answer(admin_texts["access_denied"], show_alert=True); return

        target_user = await session.get(DBUser, target_user_db_id, options=[selectinload(DBUser.roles)])
        if not target_user:
            await query.answer(admin_texts["not_found_generic"], show_alert=True); return
        if target_user.telegram_id in services_provider.config.core.super_admins:
            await query.answer(admin_texts["admin_error_cannot_change_owner_block_status"], show_alert=True)
            await _send_or_edit_user_details_local(query, target_user, services_provider, session, admin_user_id, locale=user_locale)
            return

        new_status = not target_user.is_bot_blocked
        changed = await services_provider.user_service.set_user_bot_blocked_status(target_user, new_status, session)
        alert_text = ""
        if changed:
            try:
                await session.commit()
                status_text = users_texts["user_blocked_yes"] if new_status else users_texts["user_blocked_no"]
                alert_text = admin_texts["admin_user_block_status_changed"].format(user_name=target_user.full_name, status=status_text)
            except Exception as e_commit: await session.rollback(); alert_text = admin_texts["admin_error_saving"]
        else: alert_text = admin_texts["admin_user_block_status_not_changed"]
        await _send_or_edit_user_details_local(query, target_user, services_provider, session, admin_user_id, locale=user_locale)
        await query.answer(alert_text, show_alert=bool(changed and "ĞÑˆĞ¸Ğ±ĞºĞ°" not in alert_text))


======================================================================

------------------------------ FILE: Systems/core/admin/users/handlers_list.py ------------------------------
# core/admin/users/handlers_list.py
from aiogram import Router, types, F
from aiogram.utils.markdown import hbold
from loguru import logger
from sqlalchemy import select, func as sql_func # <--- Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•Ğ Ğ˜ĞœĞŸĞĞ Ğ¢ func
from aiogram.exceptions import TelegramBadRequest # <--- Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•Ğ Ğ˜ĞœĞŸĞĞ Ğ¢

from Systems.core.ui.callback_data_factories import AdminUsersPanelNavigate
from .keyboards_users import get_admin_users_list_keyboard_local, USERS_MGMT_TEXTS, get_users_mgmt_texts
from Systems.core.admin.keyboards_admin_common import ADMIN_COMMON_TEXTS, get_admin_texts 
from Systems.core.admin.filters_admin import can_view_admin_panel_filter
from Systems.core.rbac.service import PERMISSION_CORE_USERS_VIEW_LIST
from Systems.core.database.core_models import User as DBUser

from typing import TYPE_CHECKING, List
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider

users_list_router = Router(name="sdb_admin_users_list_handlers")
MODULE_NAME_FOR_LOG = "AdminUserList"

#users_list_router.callback_query.filter(can_view_admin_panel_filter)

USERS_PER_PAGE_ADMIN_LOCAL = 10 

@users_list_router.callback_query(AdminUsersPanelNavigate.filter(F.action == "list"))
async def cq_admin_users_list_entry( 
    query: types.CallbackQuery,
    callback_data: AdminUsersPanelNavigate, 
    services_provider: 'BotServicesProvider' 
):
    admin_user_id = query.from_user.id
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹, ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°: {callback_data.page or 1}")

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    users_texts = get_users_mgmt_texts(services_provider, user_locale)

    async with services_provider.db.get_session() as session: 
        if not services_provider.config.core.super_admins or admin_user_id not in services_provider.config.core.super_admins: 
            if not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_USERS_VIEW_LIST):
                await query.answer(admin_texts["access_denied"], show_alert=True)
                return
        
        current_page = callback_data.page if callback_data.page is not None else 1
        
        total_users = 0
        try:
            count_stmt = select(sql_func.count(DBUser.id)) 
            total_users_res = await session.execute(count_stmt)
            total_users = total_users_res.scalar_one_or_none() or 0
        except Exception as e_count:
            logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ÑÑ‡ĞµÑ‚Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹: {e_count}")
            await query.answer(admin_texts["admin_error_getting_users_data"], show_alert=True)
            return
        
        total_pages = (total_users + USERS_PER_PAGE_ADMIN_LOCAL - 1) // USERS_PER_PAGE_ADMIN_LOCAL
        total_pages = max(1, total_pages) 
        current_page = max(1, min(current_page, total_pages))
        offset = (current_page - 1) * USERS_PER_PAGE_ADMIN_LOCAL

        stmt_users = (
            select(DBUser)
            .order_by(DBUser.id.desc()) 
            .limit(USERS_PER_PAGE_ADMIN_LOCAL)
            .offset(offset)
        )
        users_result = await session.execute(stmt_users)
        users_on_page: List[DBUser] = list(users_result.scalars().all())

        text = users_texts["user_list_title_template"].format(current_page=current_page, total_pages=total_pages)
        if total_users == 0:
             text = users_texts.get("no_users_registered_notice", "ğŸ‘¥ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸\n\nĞ’ Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½ĞµÑ‚ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.")

        keyboard = await get_admin_users_list_keyboard_local(users_on_page, total_pages, current_page, services_provider, user_locale)

        if query.message:
            try:
                if query.message.text != text or query.message.reply_markup != keyboard:
                    await query.message.edit_text(text, reply_markup=keyboard)
                else:
                    logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ½Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾.")
                await query.answer()
            except TelegramBadRequest as e_tbr:
                if "message is not modified" in str(e_tbr).lower():
                    logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ½Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾ (Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ğ½Ğ¾ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ).")
                    await query.answer()
                else:
                    logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹: {e_tbr}")
                    await query.answer() 
            except Exception as e_edit:
                logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞĞµĞ¿Ñ€ĞµĞ´Ğ²Ğ¸Ğ´ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² cq_admin_users_list_entry: {e_edit}", exc_info=True)
                await query.answer(admin_texts["error_general"], show_alert=True)


======================================================================

------------------------------ FILE: Systems/core/admin/users/handlers_direct_perms.py ------------------------------
# core/admin/users/handlers_direct_perms.py
from aiogram import Router, types, F, Bot
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup
from aiogram.utils.markdown import hbold
from loguru import logger
from sqlalchemy.orm import selectinload
from aiogram.filters import StateFilter # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ StateFilter
from aiogram.exceptions import TelegramBadRequest # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ TelegramBadRequest

from Systems.core.ui.callback_data_factories import AdminUsersPanelNavigate
from .keyboards_users import get_user_direct_perms_keyboard, USERS_MGMT_TEXTS, get_users_mgmt_texts
from Systems.core.admin.keyboards_admin_common import ADMIN_COMMON_TEXTS, get_admin_texts 
from Systems.core.admin.filters_admin import can_view_admin_panel_filter
from Systems.core.rbac.service import PERMISSION_CORE_USERS_MANAGE_DIRECT_PERMISSIONS 
from Systems.core.database.core_models import User as DBUser, Permission as DBPermission, Role as DBRole # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ» DBRole

from typing import TYPE_CHECKING, Optional
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from sqlalchemy.ext.asyncio import AsyncSession

user_direct_perms_router = Router(name="sdb_admin_user_direct_perms_handlers")
MODULE_NAME_FOR_LOG = "AdminUserDirectPerms"

#user_direct_perms_router.callback_query.filter(can_view_admin_panel_filter)

# --- FSM Ğ´Ğ»Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ---
class FSMDirectUserPermsNavigation(StatesGroup):
    navigating_direct_perms = State()

# --- Ğ’Ñ…Ğ¾Ğ´ Ğ² FSM Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸ ---
@user_direct_perms_router.callback_query(AdminUsersPanelNavigate.filter(F.action == "edit_direct_perms_start"))
async def cq_admin_user_edit_direct_perms_entry( # ĞŸĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ´Ğ»Ñ ĞºĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸
    query: types.CallbackQuery,
    callback_data: AdminUsersPanelNavigate,
    services_provider: 'BotServicesProvider',
    state: FSMContext
):
    admin_user_id = query.from_user.id
    target_user_db_id = callback_data.item_id

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    users_texts = get_users_mgmt_texts(services_provider, user_locale)

    if target_user_db_id is None:
        await query.answer(admin_texts["admin_error_user_id_not_specified"], show_alert=True); return

    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½ {admin_user_id} Ğ²Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² FSM ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸ Ğ´Ğ»Ñ User DB ID: {target_user_db_id}")

    async with services_provider.db.get_session() as session:
        current_admin_is_owner = admin_user_id in services_provider.config.core.super_admins
        if not current_admin_is_owner and \
           not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_USERS_MANAGE_DIRECT_PERMISSIONS):
            await query.answer(admin_texts["access_denied"], show_alert=True)
            return
        
        target_user = await session.get(DBUser, target_user_db_id)
        if not target_user:
            await query.answer(admin_texts["not_found_generic"], show_alert=True); return
        if target_user.telegram_id in services_provider.config.core.super_admins:
            await query.answer(admin_texts["admin_error_cannot_manage_owner_direct_perms"], show_alert=True); return

    await state.clear() 
    await state.set_state(FSMDirectUserPermsNavigation.navigating_direct_perms)
    await state.update_data(
        target_user_id_for_perms=target_user_db_id, 
    )
    
    await _show_user_direct_perms_menu(query, services_provider, state)

# --- ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼/ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑĞ¼/ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°Ğ¼ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ ---
@user_direct_perms_router.callback_query(
    AdminUsersPanelNavigate.filter(F.action == "direct_perms_nav"),
    StateFilter(FSMDirectUserPermsNavigation.navigating_direct_perms)
)
async def cq_admin_user_direct_perms_navigate(
    query: types.CallbackQuery,
    callback_data: AdminUsersPanelNavigate,
    services_provider: 'BotServicesProvider',
    state: FSMContext
):
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == query.from_user.id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    fsm_data = await state.get_data()
    target_user_db_id = fsm_data.get("target_user_id_for_perms")
    if target_user_db_id is None: 
        await query.answer(admin_texts["admin_error_fsm_state"], show_alert=True)
        await state.clear(); return

    new_fsm_context_data = {
        "category_key": callback_data.category_key,
        "entity_name": callback_data.entity_name,
        "current_page": callback_data.page or 1
    }
    await state.update_data(**new_fsm_context_data)
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½ {query.from_user.id} Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼ (User ID: {target_user_db_id}). "
                f"ĞĞ¾Ğ²Ñ‹Ğ¹ FSM ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸: {new_fsm_context_data}")
    
    await _show_user_direct_perms_menu(query, services_provider, state)

# --- ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ---
@user_direct_perms_router.callback_query(
    AdminUsersPanelNavigate.filter(F.action == "toggle_direct_perm"),
    StateFilter(FSMDirectUserPermsNavigation.navigating_direct_perms)
)
async def cq_admin_user_toggle_direct_perm(
    query: types.CallbackQuery,
    callback_data: AdminUsersPanelNavigate,
    services_provider: 'BotServicesProvider',
    state: FSMContext
):
    admin_user_id = query.from_user.id
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    fsm_data = await state.get_data()
    target_user_db_id: Optional[int] = fsm_data.get("target_user_id_for_perms")
    permission_to_toggle_id: Optional[int] = callback_data.permission_id

    if target_user_db_id is None or permission_to_toggle_id is None:
        await query.answer(admin_texts["admin_error_invalid_permission_data"], show_alert=True); return

    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½ {admin_user_id} Ğ¸Ğ·Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ "
                f"PermID:'{permission_to_toggle_id}' Ğ´Ğ»Ñ User DBID:{target_user_db_id}")

    async with services_provider.db.get_session() as session:
        current_admin_is_owner = admin_user_id in services_provider.config.core.super_admins
        if not current_admin_is_owner and \
           not await services_provider.rbac.user_has_permission(session, admin_user_id, PERMISSION_CORE_USERS_MANAGE_DIRECT_PERMISSIONS):
            await query.answer(admin_texts["access_denied"], show_alert=True); return
        
        target_user = await session.get(DBUser, target_user_db_id, options=[selectinload(DBUser.direct_permissions)])
        permission_to_modify = await session.get(DBPermission, permission_to_toggle_id)

        if not target_user or not permission_to_modify:
            await query.answer(admin_texts["not_found_generic"], show_alert=True); return
        if target_user.telegram_id in services_provider.config.core.super_admins: 
            await query.answer(admin_texts["admin_error_cannot_modify_owner_direct_perms"], show_alert=True); return

        user_has_direct_perm = permission_to_modify in target_user.direct_permissions
        alert_text, action_performed = "", False

        if user_has_direct_perm:
            if await services_provider.rbac.remove_direct_permission_from_user(session, target_user, permission_to_modify.name):
                action_performed = True
                alert_text = admin_texts["admin_direct_perm_removed"].format(permission_name=permission_to_modify.name)
            else: alert_text = admin_texts["admin_direct_perm_failed_to_remove"].format(permission_name=permission_to_modify.name)
        else:
            if await services_provider.rbac.assign_direct_permission_to_user(session, target_user, permission_to_modify.name, auto_create_perm=False):
                action_performed = True
                alert_text = admin_texts["admin_direct_perm_assigned"].format(permission_name=permission_to_modify.name)
            else: alert_text = admin_texts["admin_direct_perm_failed_to_assign"].format(permission_name=permission_to_modify.name)
        
        if action_performed:
            try: await session.commit(); logger.info(f"[{MODULE_NAME_FOR_LOG}] {alert_text} Ğ´Ğ»Ñ User ID: {target_user.id}"); await session.refresh(target_user, attribute_names=['direct_permissions'])
            except Exception as e: await session.rollback(); logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° commit: {e}"); alert_text = admin_texts["admin_error_saving"]
        
        await query.answer(alert_text, show_alert=action_performed and "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ" not in alert_text)
        await _show_user_direct_perms_menu(query, services_provider, state) 

# --- Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¼ĞµĞ½Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ ---
async def _show_user_direct_perms_menu(
    query: types.CallbackQuery, 
    services_provider: 'BotServicesProvider', 
    state: FSMContext
):
    admin_user_id = query.from_user.id
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    users_texts = get_users_mgmt_texts(services_provider, user_locale)
    
    fsm_data = await state.get_data()
    
    target_user_db_id = fsm_data.get("target_user_id_for_perms")
    category_key = fsm_data.get("category_key")
    entity_name = fsm_data.get("entity_name")
    page = fsm_data.get("current_page", 1)

    if target_user_db_id is None:
        await query.answer(admin_texts["admin_error_fsm_state_user_id"], show_alert=True); await state.clear(); return

    async with services_provider.db.get_session() as session:
        target_user = await session.get(DBUser, target_user_db_id, options=[
            selectinload(DBUser.direct_permissions), 
            selectinload(DBUser.roles).selectinload(DBRole.permissions) 
        ])
        if not target_user:
            await query.answer(admin_texts["not_found_generic"], show_alert=True); await state.clear(); return

        all_system_permissions = await services_provider.rbac.get_all_permissions(session)
        
        base_text = users_texts["edit_direct_perms_for_user"].format(user_name=hbold(target_user.full_name))
        current_level_text = ""
        if category_key == "core":
            current_level_text = f" / {admin_texts['admin_perm_category_core']}"
            if entity_name: current_level_text += f" / {admin_texts.get(f'admin_perm_core_group_{entity_name}', entity_name.capitalize())}"
        elif category_key == "module":
            current_level_text = " / ĞœĞ¾Ğ´ÑƒĞ»Ğ¸"
            if entity_name:
                mod_info = services_provider.modules.get_module_info(entity_name)
                current_level_text += f" / {mod_info.manifest.display_name if mod_info and mod_info.manifest else entity_name}"
        
        text = f"{base_text}{current_level_text}\nĞÑ‚Ğ¼ĞµÑ‚ÑŒÑ‚Ğµ Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ:"
        
        keyboard = await get_user_direct_perms_keyboard(
            target_user=target_user,
            services=services_provider,
            current_admin_tg_id=admin_user_id,
            session=session,
            all_system_permissions=all_system_permissions,
            category_key=category_key,
            entity_name=entity_name,
            page=page,
            locale=user_locale
        )

        if query.message:
            try:
                if query.message.text != text or query.message.reply_markup != keyboard:
                    await query.message.edit_text(text, reply_markup=keyboard)
            except TelegramBadRequest as e: # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ TelegramBadRequest
                if "message is not modified" not in str(e).lower(): 
                    logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° edit_text (_show_user_direct_perms_menu): {e}")
            except Exception as e_edit:
                logger.error(f"ĞĞµĞ¿Ñ€ĞµĞ´Ğ²Ğ¸Ğ´ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² _show_user_direct_perms_menu: {e_edit}", exc_info=True)
                # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ´Ğ»Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
                user_locale_err = services_provider.config.core.i18n.default_locale
                try:
                    async with services_provider.db.get_session() as session:
                        from Systems.core.database.core_models import User as DBUser
                        from sqlalchemy import select
                        result = await session.execute(select(DBUser).where(DBUser.telegram_id == query.from_user.id))
                        db_user = result.scalar_one_or_none()
                        if db_user and db_user.preferred_language_code:
                            user_locale_err = db_user.preferred_language_code
                except Exception:
                    pass
                admin_texts_err = get_admin_texts(services_provider, user_locale_err)
                if query.message: await query.answer(admin_texts_err["admin_error_display"], show_alert=True)

# Ğ’Ñ‹Ñ…Ğ¾Ğ´ Ğ¸Ğ· FSM ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸ (ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ "Ğš Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ")
@user_direct_perms_router.callback_query(
    AdminUsersPanelNavigate.filter(F.action == "view"), 
    StateFilter(FSMDirectUserPermsNavigation.navigating_direct_perms) 
)
async def cq_back_to_user_details_from_direct_perms_fsm(
    query: types.CallbackQuery,
    callback_data: AdminUsersPanelNavigate, 
    services_provider: 'BotServicesProvider',
    state: FSMContext
):
    await state.clear() 
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {query.from_user.id} Ğ²Ñ‹ÑˆĞµĞ» Ğ¸Ğ· FSM ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸.")
    from .handlers_details import cq_admin_user_view_details_entry
    await cq_admin_user_view_details_entry(query, callback_data, services_provider)


======================================================================

------------------------------ FILE: Systems/core/admin/users/keyboards_users.py ------------------------------
# SwiftDevBot/core/admin/users/keyboards_users.py
from typing import TYPE_CHECKING, List, Set, Dict, Optional
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.utils.keyboard import InlineKeyboardBuilder
from loguru import logger

from Systems.core.ui.callback_data_factories import AdminUsersPanelNavigate, AdminMainMenuNavigate
from Systems.core.admin.keyboards_admin_common import ADMIN_COMMON_TEXTS, get_back_to_admin_main_menu_button, get_admin_texts
from Systems.core.rbac.service import (
    PERMISSION_CORE_USERS_ASSIGN_ROLES, 
    PERMISSION_CORE_USERS_MANAGE_STATUS,
    PERMISSION_CORE_USERS_MANAGE_DIRECT_PERMISSIONS, # <--- Ğ”ĞĞ‘ĞĞ’Ğ›Ğ•Ğ Ğ˜ĞœĞŸĞĞ Ğ¢
    DEFAULT_ROLE_USER 
)

if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from sqlalchemy.ext.asyncio import AsyncSession
    from Systems.core.database.core_models import User as DBUser, Role as DBRole, Permission as DBPermission


def get_users_mgmt_texts(services_provider: 'BotServicesProvider', locale: Optional[str] = None) -> dict:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸"""
    if not locale:
        locale = services_provider.config.core.i18n.default_locale
    
    from Systems.core.admin.keyboards_admin_common import _get_admin_translator
    translator = _get_admin_translator(services_provider)
    
    def t(key: str, **kwargs) -> str:
        return translator.gettext(key, locale, **kwargs)
    
    return {
        "user_list_title_template": t("admin_user_list_title_template"),
        "user_details_title": t("admin_user_details_title"),
        "user_action_change_roles": t("admin_user_action_change_roles"),
        "user_action_toggle_active": t("admin_user_action_toggle_active"),
        "user_action_toggle_blocked": t("admin_user_action_toggle_blocked"),
        "edit_roles_for_user": t("admin_edit_roles_for_user"),
        "back_to_user_details": t("admin_back_to_user_details"),
        "back_to_user_list": t("admin_back_to_user_list"),
        "user_is_owner_text": t("admin_user_is_owner_text"),
        "user_action_direct_perms": t("admin_user_action_direct_perms"),
        "edit_direct_perms_for_user": t("admin_edit_direct_perms_for_user"),
        "perm_status_direct": t("admin_perm_status_direct"),
        "perm_status_role": t("admin_perm_status_role"),
        "perm_status_none": t("admin_perm_status_none"),
        "back_to_direct_perm_categories": t("admin_back_to_direct_perm_categories"),
        "back_to_direct_perm_core_groups": t("admin_back_to_direct_perm_core_groups"),
        "back_to_direct_perm_module_list": t("admin_back_to_direct_perm_module_list"),
        "no_users_to_display": t("admin_no_users_to_display"),
        "user_active_yes": t("admin_user_active_yes"),
        "user_active_no": t("admin_user_active_no"),
        "user_blocked_yes": t("admin_user_blocked_yes"),
        "user_blocked_no": t("admin_user_blocked_no"),
        "user_no_roles": t("admin_user_no_roles"),
        "user_telegram_id": t("admin_user_telegram_id"),
        "user_db_id": t("admin_user_db_id"),
        "user_username": t("admin_user_username"),
        "user_first_name": t("admin_user_first_name"),
        "user_last_name": t("admin_user_last_name"),
        "user_language": t("admin_user_language"),
        "user_active": t("admin_user_active"),
        "user_bot_blocked": t("admin_user_bot_blocked"),
        "user_roles_status": t("admin_user_roles_status"),
        "user_registration": t("admin_user_registration"),
        "user_last_activity": t("admin_user_last_activity"),
        "no_users_registered_notice": t("admin_no_registered_users_notice"),
    }

# Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğ¹ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (deprecated)
USERS_MGMT_TEXTS = {
    "user_list_title_template": ADMIN_COMMON_TEXTS.get("user_list_title_template", "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ (Ğ¡Ñ‚Ñ€. {current_page}/{total_pages})"),
    "user_details_title": ADMIN_COMMON_TEXTS.get("user_details_title", "Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ"),
    "user_action_change_roles": ADMIN_COMMON_TEXTS.get("user_action_change_roles", "Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»Ğ¸"),
    "user_action_toggle_active": ADMIN_COMMON_TEXTS.get("user_action_toggle_active", "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ: {status}"),
    "user_action_toggle_blocked": ADMIN_COMMON_TEXTS.get("user_action_toggle_blocked", "Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°: {status}"),
    "edit_roles_for_user": ADMIN_COMMON_TEXTS.get("edit_roles_for_user", "Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ´Ğ»Ñ: {user_name}"),
    "back_to_user_details": ADMIN_COMMON_TEXTS.get("back_to_user_details", "â¬…ï¸ Ğš Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"),
    "user_is_owner_text": ADMIN_COMMON_TEXTS.get("user_is_owner_text", "ğŸ‘‘ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ† ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ (Ğ½ĞµĞ¸Ğ·Ğ¼ĞµĞ½ÑĞµĞ¼Ñ‹Ğ¹)"),
    "user_action_direct_perms": "ğŸ’ Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ",
    "edit_direct_perms_for_user": "ğŸ’ Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ: {user_name}",
    "perm_status_direct": "âœ… (Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ)",
    "perm_status_role": "â˜‘ï¸ (Ñ‡ĞµÑ€ĞµĞ· Ñ€Ğ¾Ğ»ÑŒ)",
    "perm_status_none": "â¬œ (Ğ½ĞµÑ‚)",
    "back_to_direct_perm_categories": "â¬…ï¸ Ğš ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ (Ğ´Ğ»Ñ ÑĞ·ĞµÑ€Ğ°)",
    "back_to_direct_perm_core_groups": "â¬…ï¸ Ğš Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ğ¼ Ğ¯Ğ´Ñ€Ğ° (Ğ´Ğ»Ñ ÑĞ·ĞµÑ€Ğ°)",
    "back_to_direct_perm_module_list": "â¬…ï¸ Ğš Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼ (Ğ´Ğ»Ñ ÑĞ·ĞµÑ€Ğ°)",
    "back_to_user_list": "â¬…ï¸ Ğš ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹",
}


async def get_admin_users_list_keyboard_local( 
    users_on_page: List['DBUser'],
    total_pages: int,
    current_page: int,
    services_provider: Optional['BotServicesProvider'] = None,
    locale: Optional[str] = None
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if services_provider:
        users_texts = get_users_mgmt_texts(services_provider, locale)
        admin_texts = get_admin_texts(services_provider, locale)
    else:
        users_texts = USERS_MGMT_TEXTS
        admin_texts = ADMIN_COMMON_TEXTS
    
    if not users_on_page and current_page == 1:
        builder.button(text=users_texts.get("no_users_to_display", "ĞĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ"), callback_data=AdminUsersPanelNavigate(action="dummy_no_users").pack())
    else:
        for user_obj in users_on_page:
            user_display = f"{user_obj.full_name}"
            if user_obj.username: user_display += f" (@{user_obj.username})"
            else: user_display += f" (ID: {user_obj.telegram_id})"
            
            status_icons = ["ğŸ’¤" if not user_obj.is_active else "", "ğŸš«" if user_obj.is_bot_blocked else ""]
            status_prefix = "".join(filter(None, status_icons)) + " " if any(status_icons) else ""

            builder.button(
                text=f"{status_prefix}{user_display}",
                callback_data=AdminUsersPanelNavigate(action="view", item_id=user_obj.id).pack()
            )
        builder.adjust(1)

    if total_pages > 1:
        pagination_row = []
        if current_page > 1:
            pagination_row.append(InlineKeyboardButton(
                text=admin_texts["pagination_prev"],
                callback_data=AdminUsersPanelNavigate(action="list", page=current_page - 1).pack()
            ))
        pagination_row.append(InlineKeyboardButton(
            text=f"{current_page}/{total_pages}",
            callback_data=AdminUsersPanelNavigate(action="dummy_page").pack() 
        ))
        if current_page < total_pages:
            pagination_row.append(InlineKeyboardButton(
                text=admin_texts["pagination_next"],
                callback_data=AdminUsersPanelNavigate(action="list", page=current_page + 1).pack()
            ))
        if pagination_row:
            builder.row(*pagination_row)

    builder.row(get_back_to_admin_main_menu_button(services_provider, locale))
    return builder.as_markup()


async def get_admin_user_details_keyboard_local( 
    target_user: 'DBUser', 
    services: 'BotServicesProvider',
    current_admin_tg_id: int, 
    session: 'AsyncSession',
    locale: Optional[str] = None
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if not locale:
        try:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == current_admin_tg_id))
            admin_user = result.scalar_one_or_none()
            if admin_user and admin_user.preferred_language_code:
                locale = admin_user.preferred_language_code
        except Exception:
            pass
        
        if not locale:
            locale = services.config.core.i18n.default_locale
    
    users_texts = get_users_mgmt_texts(services, locale)
    admin_texts = get_admin_texts(services, locale)
    
    rbac = services.rbac
    current_admin_is_owner = current_admin_tg_id in services.config.core.super_admins
    target_user_is_owner = target_user.telegram_id in services.config.core.super_admins

    # --- Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ£Ğ¡Ğ›ĞĞ’Ğ˜Ğ¯ ĞĞ¢ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ¯ ĞšĞĞĞŸĞšĞ˜ "Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ" ---
    can_manage_direct_perms = False
    if not target_user_is_owner: # ĞĞµĞ»ÑŒĞ·Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°
        if current_admin_is_owner: # Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ† ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ° Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²ÑÑ‘ (ĞºÑ€Ğ¾Ğ¼Ğµ Ğ¿Ñ€Ğ°Ğ² Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†ĞµĞ²)
            can_manage_direct_perms = True
        else:
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ PERMISSION_CORE_USERS_MANAGE_DIRECT_PERMISSIONS
            if await rbac.user_has_permission(session, current_admin_tg_id, PERMISSION_CORE_USERS_MANAGE_DIRECT_PERMISSIONS):
                can_manage_direct_perms = True
    
    if can_manage_direct_perms:
    # --- ĞšĞĞĞ•Ğ¦ Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯ ---
        builder.button(
            text=users_texts["user_action_direct_perms"],
            callback_data=AdminUsersPanelNavigate(action="edit_direct_perms_start", item_id=target_user.id).pack()
        )

    if not target_user_is_owner: 
        if current_admin_is_owner or \
           await rbac.user_has_permission(session, current_admin_tg_id, PERMISSION_CORE_USERS_ASSIGN_ROLES):
            builder.button(
                text=users_texts["user_action_change_roles"],
                callback_data=AdminUsersPanelNavigate(action="edit_roles_start", item_id=target_user.id).pack()
            )

        if current_admin_is_owner or \
           await rbac.user_has_permission(session, current_admin_tg_id, PERMISSION_CORE_USERS_MANAGE_STATUS):
            active_status_text = users_texts["user_active_no"] if target_user.is_active else users_texts["user_active_yes"]
            builder.button(
                text=users_texts["user_action_toggle_active"].format(status=active_status_text),
                callback_data=AdminUsersPanelNavigate(action="toggle_active", item_id=target_user.id).pack()
            )
            blocked_status_text = users_texts["user_blocked_yes"] if target_user.is_bot_blocked else users_texts["user_blocked_no"]
            builder.button(
                text=users_texts["user_action_toggle_blocked"].format(status=blocked_status_text),
                callback_data=AdminUsersPanelNavigate(action="toggle_blocked", item_id=target_user.id).pack()
            )
    
    if builder.export(): 
        builder.adjust(1)

    builder.row(InlineKeyboardButton(
        text=users_texts["back_to_user_list"],
        callback_data=AdminUsersPanelNavigate(action="list", page=1).pack() 
    ))
    builder.row(get_back_to_admin_main_menu_button(services, locale))
    return builder.as_markup()

async def get_admin_user_edit_roles_keyboard_local( 
    target_user: 'DBUser',
    all_system_roles: List['DBRole'],
    services: 'BotServicesProvider',
    current_admin_tg_id: int,
    session: 'AsyncSession'
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if not locale:
        try:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == current_admin_tg_id))
            admin_user = result.scalar_one_or_none()
            if admin_user and admin_user.preferred_language_code:
                locale = admin_user.preferred_language_code
        except Exception:
            pass
        
        if not locale:
            locale = services.config.core.i18n.default_locale
    
    users_texts = get_users_mgmt_texts(services, locale)
    admin_texts = get_admin_texts(services, locale)
    
    rbac = services.rbac
    current_admin_is_owner = current_admin_tg_id in services.config.core.super_admins

    target_user_role_ids: Set[int] = {role.id for role in target_user.roles if role.id is not None}

    for role in sorted(all_system_roles, key=lambda r: r.name):
        if role.id is None: continue 

        is_assigned = role.id in target_user_role_ids
        prefix = "âœ… " if is_assigned else "â¬œ "
        
        can_toggle_this_role = False
        if current_admin_is_owner:
            can_toggle_this_role = True
        elif await rbac.user_has_permission(session, current_admin_tg_id, PERMISSION_CORE_USERS_ASSIGN_ROLES):
            if role.name == DEFAULT_ROLE_USER and is_assigned and len(target_user.roles) == 1:
                can_toggle_this_role = False
                prefix = "ğŸ”’ " 
            else:
                can_toggle_this_role = True
        
        if can_toggle_this_role:
            builder.button(
                text=f"{prefix}{role.name}",
                callback_data=AdminUsersPanelNavigate(
                    action="toggle_role", 
                    item_id=target_user.id, 
                    role_id=role.id 
                ).pack()
            )
        else: 
            builder.button(
                text=f"{prefix}{role.name} (Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ²)", 
                callback_data=AdminUsersPanelNavigate(action="dummy_cant_toggle").pack() 
            )

    builder.adjust(1)
    builder.row(InlineKeyboardButton(
        text=users_texts["back_to_user_details"], 
        callback_data=AdminUsersPanelNavigate(action="view", item_id=target_user.id).pack()
    ))
    builder.row(get_back_to_admin_main_menu_button(services, locale))
    return builder.as_markup()

# --- ĞĞ¾Ğ²Ğ°Ñ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ---
async def get_user_direct_perms_keyboard(
    target_user: 'DBUser', # ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ, Ñ‡ÑŒĞ¸ Ğ¿Ñ€Ğ°Ğ²Ğ° Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒÑÑ‚ÑÑ
    services: 'BotServicesProvider',
    current_admin_tg_id: int, # ĞĞ´Ğ¼Ğ¸Ğ½, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµÑ‚
    session: 'AsyncSession',
    all_system_permissions: List['DBPermission'], # Ğ’ÑĞµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ
    # ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¸Ğ· FSM Ğ´Ğ»Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸:
    category_key: Optional[str] = None,
    entity_name: Optional[str] = None,
    page: int = 1,
    perms_per_page: int = 7,
    locale: Optional[str] = None
) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if not locale:
        try:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == current_admin_tg_id))
            admin_user = result.scalar_one_or_none()
            if admin_user and admin_user.preferred_language_code:
                locale = admin_user.preferred_language_code
        except Exception:
            pass
        
        if not locale:
            locale = services.config.core.i18n.default_locale
    
    users_texts = get_users_mgmt_texts(services, locale)
    admin_texts = get_admin_texts(services, locale)
    texts = users_texts 
    
    user_direct_perm_ids: Set[int] = {perm.id for perm in target_user.direct_permissions if perm.id is not None}
    user_role_perm_ids: Set[int] = set()
    for role in target_user.roles:
        if role.permissions:
            user_role_perm_ids.update(p.id for p in role.permissions if p.id is not None)

    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° "ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"
    builder.row(InlineKeyboardButton(
        text=texts["back_to_user_details"],
        callback_data=AdminUsersPanelNavigate(action="view", item_id=target_user.id).pack()
    ))

    # --- Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 1: Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ (Ğ¯Ğ´Ñ€Ğ¾ / ĞœĞ¾Ğ´ÑƒĞ»Ğ¸) ---
    if not category_key:
        builder.button(
            text=admin_texts["perm_category_core"], # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¾Ğ±Ñ‰Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ñ‹ Ğ´Ğ»Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹
            callback_data=AdminUsersPanelNavigate(action="direct_perms_nav", item_id=target_user.id, category_key="core", page=1).pack()
        )
        module_perms_exist = any(not p.name.startswith("core.") for p in all_system_permissions)
        if module_perms_exist:
            builder.button(
                text=admin_texts["perm_category_modules"],
                callback_data=AdminUsersPanelNavigate(action="direct_perms_nav", item_id=target_user.id, category_key="module", page=1).pack()
            )
        builder.adjust(1)
        return builder.as_markup()

    # --- Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ 2 Ğ¸ 3: Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¿Ğ¾Ğ´ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸/Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ¸ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ ---
    permissions_to_display_final: List['DBPermission'] = []
    
    if category_key == "core":
        CORE_PERM_GROUPS_MAP_USERS: Dict[str, str] = { # Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚ĞµĞºÑÑ‚Ñ‹, Ñ‚.Ğº. Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°Ñ‚ÑŒÑÑ Ğ¾Ñ‚ Ñ€Ğ¾Ğ»ĞµĞ¹
            "users": admin_texts["perm_core_group_users"], 
            "roles": admin_texts["perm_core_group_roles"],
            "modules_core": admin_texts["perm_core_group_modules_core"], 
            "system": admin_texts["perm_core_group_system"],
            "settings_core": admin_texts["perm_core_group_settings_core"], 
            "other": admin_texts["perm_core_group_other"]
        }
        CORE_PERM_PREFIXES_MAP_USERS: Dict[str, str] = { # ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾
            "users": "core.users.", "roles": "core.roles.", "modules_core": "core.modules.",
            "system": "core.system.", "settings_core": "core.settings."
        }

        if not entity_name: # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ´ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ ÑĞ´Ñ€Ğ°
            for group_key, group_display_name in CORE_PERM_GROUPS_MAP_USERS.items():
                prefix_to_check = CORE_PERM_PREFIXES_MAP_USERS.get(group_key)
                has_perms_in_group = False
                if prefix_to_check:
                    if any(p.name.startswith(prefix_to_check) for p in all_system_permissions): has_perms_in_group = True
                elif group_key == "other": 
                    known_prefixes = list(CORE_PERM_PREFIXES_MAP_USERS.values())
                    if any(p.name.startswith("core.") and not any(p.name.startswith(kp) for kp in known_prefixes) for p in all_system_permissions): has_perms_in_group = True
                if has_perms_in_group:
                    builder.button(text=group_display_name, callback_data=AdminUsersPanelNavigate(action="direct_perms_nav", item_id=target_user.id, category_key="core", entity_name=group_key, page=1).pack())
            builder.adjust(1)
            builder.row(InlineKeyboardButton(text=texts["back_to_direct_perm_categories"], callback_data=AdminUsersPanelNavigate(action="direct_perms_nav", item_id=target_user.id).pack()))
        else: # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ ÑĞ´Ñ€Ğ°
            if entity_name == "other":
                known_prefixes = list(CORE_PERM_PREFIXES_MAP_USERS.values())
                permissions_to_display_final = [p for p in all_system_permissions if p.name.startswith("core.") and not any(p.name.startswith(kp) for kp in known_prefixes)]
            elif entity_name in CORE_PERM_PREFIXES_MAP_USERS:
                prefix = CORE_PERM_PREFIXES_MAP_USERS[entity_name]
                permissions_to_display_final = [p for p in all_system_permissions if p.name.startswith(prefix)]
            builder.row(InlineKeyboardButton(text=texts["back_to_direct_perm_core_groups"], callback_data=AdminUsersPanelNavigate(action="direct_perms_nav", item_id=target_user.id, category_key="core").pack()))

    elif category_key == "module":
        if not services.modules: 
            builder.button(text="ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ñ‡Ğ¸Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.", callback_data="dummy_error_no_module_loader"); return builder.as_markup()
        module_permissions_map: Dict[str, List['DBPermission']] = {}
        module_display_names: Dict[str, str] = {}
        for p in all_system_permissions:
            if not p.name.startswith("core."):
                module_name_candidate = p.name.split('.')[0]
                if module_name_candidate not in module_permissions_map:
                    module_permissions_map[module_name_candidate] = []
                    mod_info = services.modules.get_module_info(module_name_candidate)
                    module_display_names[module_name_candidate] = mod_info.manifest.display_name if mod_info and mod_info.manifest else module_name_candidate
                module_permissions_map[module_name_candidate].append(p)
        if not entity_name: 
            sorted_module_names = sorted(module_permissions_map.keys())
            if not sorted_module_names: builder.button(text=admin_texts["no_modules_with_perms"], callback_data="dummy_no_mod_perms_for_user")
            else:
                for mod_name in sorted_module_names:
                    builder.button(text=f"ğŸ§© {module_display_names.get(mod_name, mod_name)}", callback_data=AdminUsersPanelNavigate(action="direct_perms_nav", item_id=target_user.id, category_key="module", entity_name=mod_name, page=1).pack())
            builder.adjust(1)
            builder.row(InlineKeyboardButton(text=texts["back_to_direct_perm_categories"], callback_data=AdminUsersPanelNavigate(action="direct_perms_nav", item_id=target_user.id).pack()))
        else: 
            permissions_to_display_final = module_permissions_map.get(entity_name, [])
            builder.row(InlineKeyboardButton(text=texts["back_to_direct_perm_module_list"], callback_data=AdminUsersPanelNavigate(action="direct_perms_nav", item_id=target_user.id, category_key="module").pack()))
    
    if permissions_to_display_final:
        permissions_to_display_final.sort(key=lambda p: p.name)
        total_perms_in_list = len(permissions_to_display_final)
        total_perm_pages = (total_perms_in_list + perms_per_page - 1) // perms_per_page
        total_perm_pages = max(1, total_perm_pages)
        current_perm_page = max(1, min(page, total_perm_pages))
        start_idx = (current_perm_page - 1) * perms_per_page
        end_idx = start_idx + perms_per_page
        paginated_perms = permissions_to_display_final[start_idx:end_idx]

        if not paginated_perms and current_perm_page == 1:
            builder.button(text=admin_texts["no_permissions_in_group"], callback_data="dummy_no_perms_in_group_for_user")
        else:
            for perm in paginated_perms:
                if perm.id is None: continue
                status_prefix = texts["perm_status_none"] # â¬œ
                is_direct = perm.id in user_direct_perm_ids
                is_via_role = perm.id in user_role_perm_ids

                if is_direct:
                    status_prefix = texts["perm_status_direct"] # âœ…
                elif is_via_role: # ĞĞµ Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ, Ğ½Ğ¾ Ñ‡ĞµÑ€ĞµĞ· Ñ€Ğ¾Ğ»ÑŒ
                    status_prefix = texts["perm_status_role"] # â˜‘ï¸
                
                button_text = f"{status_prefix} {perm.name}"
                
                can_toggle_locally = not (is_via_role and not is_direct)

                if can_toggle_locally:
                    builder.button(
                        text=button_text,
                        callback_data=AdminUsersPanelNavigate(
                            action="toggle_direct_perm", 
                            item_id=target_user.id, 
                            permission_id=perm.id,
                            category_key=category_key, 
                            entity_name=entity_name, 
                            page=current_perm_page
                        ).pack()
                    )
                else: 
                    builder.button(
                        text=button_text,
                        callback_data=AdminUsersPanelNavigate(action="dummy_perm_via_role").pack()
                    )
            builder.adjust(1)

            if total_perm_pages > 1:
                pagination_row_perms = []
                nav_cb_data_base = AdminUsersPanelNavigate(action="direct_perms_nav", item_id=target_user.id, category_key=category_key, entity_name=entity_name)
                if current_perm_page > 1: pagination_row_perms.append(InlineKeyboardButton(text=admin_texts["pagination_prev"], callback_data=nav_cb_data_base.model_copy(update={"page": current_perm_page - 1}).pack()))
                pagination_row_perms.append(InlineKeyboardButton(text=f"{current_perm_page}/{total_perm_pages}", callback_data="dummy_direct_perm_page"))
                if current_perm_page < total_perm_pages: pagination_row_perms.append(InlineKeyboardButton(text=admin_texts["pagination_next"], callback_data=nav_cb_data_base.model_copy(update={"page": current_perm_page + 1}).pack()))
                if pagination_row_perms: builder.row(*pagination_row_perms)
    elif entity_name: 
        builder.button(text=admin_texts["no_permissions_in_group"], callback_data="dummy_no_perms_in_group_for_user_entity")

    builder.row(get_back_to_admin_main_menu_button(services, locale))
    return builder.as_markup()




======================================================================

------------------------------ FILE: Systems/core/admin/users/__init__.py ------------------------------
# SwiftDevBot/core/admin/users/__init__.py
from aiogram import Router
from loguru import logger

# --- Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞĞ«Ğ™ Ğ˜ĞœĞŸĞĞ Ğ¢ ---
# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¸Ğ· Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ core/admin/, Ğ° Ğ½Ğµ core/admin/users/
from ..filters_admin import can_view_admin_panel_filter # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ .. Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ÑŠĞµĞ¼Ğ° Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ²Ñ‹ÑˆĞµ

# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ "ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğµ" Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ñ‹ Ğ¸Ğ· ÑÑ‚Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°
from .handlers_list import users_list_router
from .handlers_details import user_details_router
from .handlers_roles_assign import user_roles_assign_router
from .handlers_direct_perms import user_direct_perms_router

# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¾Ğ´Ğ¸Ğ½ "ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‰Ğ¸Ğ¹" Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ´Ğ»Ñ Ğ²ÑĞµĞ³Ğ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ° "users"
section_users_router = Router(name="sdb_admin_section_users_router")

# ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ·Ğ´ĞµÑÑŒ, ĞµÑĞ»Ğ¸ Ğ¾Ğ½ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ° Ğ²ĞµÑÑŒ Ñ€Ğ°Ğ·Ğ´ĞµĞ» users
# section_users_router.message.filter(can_view_admin_panel_filter)
# section_users_router.callback_query.filter(can_view_admin_panel_filter)
# ĞĞ´Ğ½Ğ°ĞºĞ¾, ĞµÑĞ»Ğ¸ Ğ¾Ğ½ ÑƒĞ¶Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½ Ğº Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¼Ñƒ admin_router, ÑÑ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¸Ğ·Ğ±Ñ‹Ñ‚Ğ¾Ñ‡Ğ½Ğ¾,
# Ğ½Ğ¾ Ğ½Ğµ Ğ²Ñ€ĞµĞ´Ğ½Ğ¾. Ğ›ÑƒÑ‡ÑˆĞµ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑÑ‚ÑŒ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ° Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ·Ğ´ĞµÑÑŒ, ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¸ ĞµÑÑ‚ÑŒ.

section_users_router.include_router(users_list_router)
section_users_router.include_router(user_details_router)
section_users_router.include_router(user_roles_assign_router)
section_users_router.include_router(user_direct_perms_router)

__all__ = ["section_users_router"]


======================================================================

------------------------------ FILE: Systems/core/admin/logs_viewer/keyboards_modules.py ------------------------------
# core/admin/logs_viewer/keyboards_logs.py
# ĞŸĞ¾ĞºĞ° Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹, Ğ½Ğ¾ Ñ„Ğ°Ğ¹Ğ» ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ´Ğ»Ñ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¹ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€ ÑÑ‚Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°.
from aiogram.types import InlineKeyboardMarkup
from aiogram.utils.keyboard import InlineKeyboardBuilder
# from Systems.core.admin.keyboards_admin_common import get_back_to_admin_main_menu_button

# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸, ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ½Ğ°Ğ´Ğ¾Ğ±Ğ¸Ñ‚ÑÑ:
# def get_logs_viewer_main_keyboard() -> InlineKeyboardMarkup:
#     builder = InlineKeyboardBuilder()
#     # builder.button(text="Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ»Ğ¾Ğ³-Ñ„Ğ°Ğ¹Ğ»", callback_data=...)
#     # builder.button(text="Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ³-Ñ„Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°", callback_data=...)
#     # builder.row(get_back_to_admin_main_menu_button())
#     return builder.as_markup()


======================================================================

------------------------------ FILE: Systems/core/admin/logs_viewer/handlers_logs.py ------------------------------
# core/admin/logs_viewer/handlers_logs.py
from aiogram import Router, types, F
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup
from loguru import logger
import os
from pathlib import Path
from datetime import datetime, timedelta
from typing import List, Optional, Dict, Any

from Systems.core.ui.callback_data_factories import AdminMainMenuNavigate, AdminLogsViewerNavigate
from Systems.core.admin.filters_admin import can_view_admin_panel_filter
from .keyboards_logs import get_logs_main_keyboard, get_log_file_keyboard, get_log_content_keyboard

from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider

logs_viewer_router = Router(name="sdb_admin_logs_viewer_handlers")
MODULE_NAME_FOR_LOG = "AdminLogsViewer"

logs_viewer_router.callback_query.filter(can_view_admin_panel_filter)

class FSMAdminLogsViewer(StatesGroup):
    viewing_log_content = State()

@logs_viewer_router.callback_query(AdminMainMenuNavigate.filter(F.target_section == "logs_view"))
async def cq_admin_logs_view_start(
    query: types.CallbackQuery,
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ².")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ»Ğ¾Ğ³Ğ¾Ğ²
    log_files = await _get_available_log_files(services_provider)
    
    text = f"ğŸ“„ **{admin_texts.get('logs_viewer_title', 'ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹')}**\n\n"
    if log_files:
        text += f"{admin_texts.get('logs_viewer_files_found', 'ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ»Ğ¾Ğ³Ğ¾Ğ²')}: {len(log_files)}\n"
        text += admin_texts.get('logs_viewer_select_file', 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°:')
    else:
        text += admin_texts.get('logs_viewer_no_log_files', 'âŒ Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹')
    
    keyboard = await get_logs_main_keyboard(log_files, services_provider, user_locale)
    
    if query.message:
        try:
            await query.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
        except Exception as e:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ²: {e}")
            await query.answer(admin_texts["admin_error_display"], show_alert=True)
    else:
        await query.message.answer(text, reply_markup=keyboard, parse_mode="Markdown")
    
    await query.answer()

@logs_viewer_router.callback_query(AdminLogsViewerNavigate.filter(F.action == "view_file"))
async def cq_admin_logs_view_file(
    query: types.CallbackQuery,
    callback_data: AdminLogsViewerNavigate,
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    file_name = callback_data.payload
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ñ„Ğ°Ğ¹Ğ»Ğ° {file_name}")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğµ
    log_file_info = await _get_log_file_info(services_provider, file_name)
    
    if not log_file_info:
        await query.answer(admin_texts.get("logs_viewer_file_not_found", "Ğ¤Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"), show_alert=True)
        return
    
    text = f"ğŸ“„ **{admin_texts.get('logs_viewer_file_details_title', 'Ğ¤Ğ°Ğ¹Ğ» Ğ»Ğ¾Ğ³Ğ¾Ğ²')}: {file_name}**\n\n"
    text += f"ğŸ“Š {admin_texts.get('logs_viewer_file_size', 'Ğ Ğ°Ğ·Ğ¼ĞµÑ€')}: {log_file_info['size_formatted']}\n"
    text += f"ğŸ“… {admin_texts.get('logs_viewer_file_last_modified', 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½')}: {log_file_info['modified_formatted']}\n"
    text += f"ğŸ“ {admin_texts.get('logs_viewer_file_lines', 'Ğ¡Ñ‚Ñ€Ğ¾Ğº')}: {log_file_info['lines_count']}\n\n"
    text += admin_texts.get('logs_viewer_select_action', 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ:')
    
    keyboard = await get_log_file_keyboard(file_name, services_provider, user_locale)
    
    if query.message:
        try:
            await query.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
        except Exception as e:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ²: {e}")
            await query.answer(admin_texts["admin_error_display"], show_alert=True)
    
    await query.answer()

@logs_viewer_router.callback_query(AdminLogsViewerNavigate.filter(F.action == "view_content"))
async def cq_admin_logs_view_content(
    query: types.CallbackQuery,
    callback_data: AdminLogsViewerNavigate,
    services_provider: 'BotServicesProvider',
    state: FSMContext
):
    admin_user_id = query.from_user.id
    file_name = callback_data.payload
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° {file_name}")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 50 ÑÑ‚Ñ€Ğ¾Ğº)
    log_content = await _get_log_file_content(services_provider, file_name, lines_count=50)
    
    if not log_content:
        await query.answer(admin_texts.get("logs_viewer_error_reading_file", "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»"), show_alert=True)
        return
    
    text = f"ğŸ“„ **{admin_texts.get('logs_viewer_file_content_title', 'Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ°')}: {file_name}**\n\n"
    text += f"```\n{log_content}\n```"
    
    keyboard = await get_log_content_keyboard(file_name, services_provider, user_locale)
    
    if query.message:
        try:
            await query.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
        except Exception as e:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾ Ğ»Ğ¾Ğ³Ğ¾Ğ²: {e}")
            # ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ±ĞµĞ· Markdown
            text = f"ğŸ“„ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ°: {file_name}\n\n{log_content}"
            await query.message.edit_text(text, reply_markup=keyboard)
    
    await query.answer()

@logs_viewer_router.callback_query(AdminLogsViewerNavigate.filter(F.action == "download"))
async def cq_admin_logs_download(
    query: types.CallbackQuery,
    callback_data: AdminLogsViewerNavigate,
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    file_name = callback_data.payload
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ğ» ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° {file_name}")
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ
    log_file_path = await _get_log_file_path(services_provider, file_name)
    
    if not log_file_path or not log_file_path.exists():
        await query.answer(admin_texts.get("logs_viewer_file_not_found", "Ğ¤Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"), show_alert=True)
        return
    
    try:
        # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»
        await query.message.answer_document(
            types.BufferedInputFile(
                log_file_path.read_bytes(),
                filename=file_name
            ),
            caption=f"ğŸ“„ {admin_texts.get('logs_viewer_file_details_title', 'Ğ¤Ğ°Ğ¹Ğ» Ğ»Ğ¾Ğ³Ğ¾Ğ²')}: {file_name}"
        )
        await query.answer(admin_texts.get("logs_viewer_file_sent", "Ğ¤Ğ°Ğ¹Ğ» Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½"))
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ²: {e}")
        await query.answer(admin_texts.get("logs_viewer_error_downloading_file", "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ Ñ„Ğ°Ğ¹Ğ»Ğ°"), show_alert=True)

@logs_viewer_router.callback_query(AdminLogsViewerNavigate.filter(F.action == "back_to_main"))
async def cq_admin_logs_back_to_main(
    query: types.CallbackQuery,
    services_provider: 'BotServicesProvider'
):
    admin_user_id = query.from_user.id
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == admin_user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    admin_texts = get_admin_texts(services_provider, user_locale)
    
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ {admin_user_id} Ğ²ĞµÑ€Ğ½ÑƒĞ»ÑÑ Ğº Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¼Ñƒ Ğ¼ĞµĞ½Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ²")
    
    # ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞµĞ¼ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ¸Ğ· cq_admin_logs_view_start
    log_files = await _get_available_log_files(services_provider)
    
    text = f"ğŸ“„ **{admin_texts.get('logs_viewer_title', 'ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹')}**\n\n"
    if log_files:
        text += f"{admin_texts.get('logs_viewer_files_found', 'ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ»Ğ¾Ğ³Ğ¾Ğ²')}: {len(log_files)}\n"
        text += admin_texts.get('logs_viewer_select_file', 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°:')
    else:
        text += admin_texts.get('logs_viewer_no_log_files', 'âŒ Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹')
    
    keyboard = await get_logs_main_keyboard(log_files, services_provider, user_locale)
    
    if query.message:
        try:
            await query.message.edit_text(text, reply_markup=keyboard, parse_mode="Markdown")
        except Exception as e:
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğµ Ğº Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¼Ñƒ Ğ¼ĞµĞ½Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ²: {e}")
            await query.answer(admin_texts["admin_error_display"], show_alert=True)
    
    await query.answer()

# Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
async def _get_available_log_files(services_provider: 'BotServicesProvider') -> List[Dict[str, Any]]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ»Ğ¾Ğ³Ğ¾Ğ²"""
    try:
        log_dir = services_provider.config.core.project_data_path / "logs"
        if not log_dir.exists():
            return []
        
        log_files = []
        for file_path in log_dir.glob("*.log"):
            try:
                stat = file_path.stat()
                log_files.append({
                    'name': file_path.name,
                    'size': stat.st_size,
                    'modified': datetime.fromtimestamp(stat.st_mtime),
                    'size_formatted': _format_size(stat.st_size),
                    'modified_formatted': datetime.fromtimestamp(stat.st_mtime).strftime('%d.%m.%Y %H:%M')
                })
            except Exception as e:
                logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğµ {file_path}: {e}")
        
        # Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ (Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑĞ²ĞµÑ€Ñ…Ñƒ)
        log_files.sort(key=lambda x: x['modified'], reverse=True)
        return log_files
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ ÑĞ¿Ğ¸ÑĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ»Ğ¾Ğ³Ğ¾Ğ²: {e}")
        return []

async def _get_log_file_info(services_provider: 'BotServicesProvider', file_name: str) -> Optional[Dict[str, Any]]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğµ Ğ»Ğ¾Ğ³Ğ¾Ğ²"""
    try:
        log_file_path = await _get_log_file_path(services_provider, file_name)
        if not log_file_path or not log_file_path.exists():
            return None
        
        stat = log_file_path.stat()
        
        # ĞŸĞ¾Ğ´ÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑÑ‚Ñ€Ğ¾Ğº
        try:
            with open(log_file_path, 'r', encoding='utf-8') as f:
                lines_count = sum(1 for _ in f)
        except Exception:
            lines_count = 0
        
        return {
            'name': file_name,
            'size': stat.st_size,
            'modified': datetime.fromtimestamp(stat.st_mtime),
            'size_formatted': _format_size(stat.st_size),
            'modified_formatted': datetime.fromtimestamp(stat.st_mtime).strftime('%d.%m.%Y %H:%M'),
            'lines_count': lines_count
        }
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğµ {file_name}: {e}")
        return None

async def _get_log_file_content(services_provider: 'BotServicesProvider', file_name: str, lines_count: int = 50) -> Optional[str]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ² (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸)"""
    try:
        log_file_path = await _get_log_file_path(services_provider, file_name)
        if not log_file_path or not log_file_path.exists():
            return None
        
        with open(log_file_path, 'r', encoding='utf-8') as f:
            lines = f.readlines()
        
        # Ğ‘ĞµÑ€ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸
        if len(lines) > lines_count:
            lines = lines[-lines_count:]
        
        return ''.join(lines)
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ° {file_name}: {e}")
        return None

async def _get_log_file_path(services_provider: 'BotServicesProvider', file_name: str) -> Optional[Path]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿ÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ Ğ»Ğ¾Ğ³Ğ¾Ğ²"""
    try:
        log_dir = services_provider.config.core.project_data_path / "logs"
        log_file_path = log_dir / file_name
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ Ñ„Ğ°Ğ¹Ğ» Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ğ² Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ»Ğ¾Ğ³Ğ¾Ğ² (Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ)
        if not log_file_path.resolve().is_relative_to(log_dir.resolve()):
            logger.warning(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ Ğ²Ğ½Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ»Ğ¾Ğ³Ğ¾Ğ²: {file_name}")
            return None
        
        return log_file_path
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¿ÑƒÑ‚Ğ¸ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ {file_name}: {e}")
        return None

def _format_size(size_bytes: int) -> str:
    """Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ°"""
    if size_bytes == 0:
        return "0 B"
    
    size_names = ["B", "KB", "MB", "GB"]
    i = 0
    while size_bytes >= 1024 and i < len(size_names) - 1:
        size_bytes /= 1024.0
        i += 1
    
    return f"{size_bytes:.1f} {size_names[i]}"


======================================================================

------------------------------ FILE: Systems/core/admin/logs_viewer/keyboards_logs.py ------------------------------
# core/admin/logs_viewer/keyboards_logs.py
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.utils.keyboard import InlineKeyboardBuilder
from loguru import logger
from typing import List, Dict, Any

from Systems.core.ui.callback_data_factories import AdminLogsViewerNavigate, AdminMainMenuNavigate
from Systems.core.admin.keyboards_admin_common import get_admin_texts, get_back_to_admin_main_menu_button
from typing import TYPE_CHECKING, Optional
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider

async def get_logs_main_keyboard(log_files: List[Dict[str, Any]], services_provider: Optional['BotServicesProvider'] = None, locale: Optional[str] = None) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ²"""
    builder = InlineKeyboardBuilder()
    
    if log_files:
        for log_file in log_files:
            # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ¼Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ¸ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€
            display_text = f"ğŸ“„ {log_file['name']} ({log_file['size_formatted']})"
            callback_data = AdminLogsViewerNavigate(action="view_file", payload=log_file['name']).pack()
            builder.button(text=display_text, callback_data=callback_data)
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
    if services_provider:
        builder.row(get_back_to_admin_main_menu_button(services_provider, locale))
    else:
        builder.row(
            InlineKeyboardButton(
                text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ",
                callback_data=AdminMainMenuNavigate(target_section="main_admin").pack()
            )
        )
    
    builder.adjust(1)  # ĞŸĞ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞµ Ğ² Ñ€ÑĞ´Ñƒ
    return builder.as_markup()

async def get_log_file_keyboard(file_name: str, services_provider: Optional['BotServicesProvider'] = None, locale: Optional[str] = None) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ¼ Ğ»Ğ¾Ğ³Ğ¾Ğ²"""
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if services_provider:
        admin_texts = get_admin_texts(services_provider, locale)
    else:
        admin_texts = {}
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾
    builder.button(
        text=admin_texts.get("logs_viewer_view_content", "ğŸ‘ï¸ ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ"),
        callback_data=AdminLogsViewerNavigate(action="view_content", payload=file_name).pack()
    )
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ
    builder.button(
        text=admin_texts.get("logs_viewer_download_file", "ğŸ“¥ Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»"),
        callback_data=AdminLogsViewerNavigate(action="download", payload=file_name).pack()
    )
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğº ÑĞ¿Ğ¸ÑĞºÑƒ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
    builder.row(
        InlineKeyboardButton(
            text=admin_texts.get("logs_viewer_back_to_file_list", "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº ÑĞ¿Ğ¸ÑĞºÑƒ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²"),
            callback_data=AdminLogsViewerNavigate(action="back_to_main").pack()
        )
    )
    
    builder.adjust(1)  # ĞŸĞ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞµ Ğ² Ñ€ÑĞ´Ñƒ
    return builder.as_markup()

async def get_log_content_keyboard(file_name: str, services_provider: Optional['BotServicesProvider'] = None, locale: Optional[str] = None) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°"""
    builder = InlineKeyboardBuilder()
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    if services_provider:
        admin_texts = get_admin_texts(services_provider, locale)
    else:
        admin_texts = {}
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ
    builder.button(
        text=admin_texts.get("logs_viewer_download_file", "ğŸ“¥ Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»"),
        callback_data=AdminLogsViewerNavigate(action="download", payload=file_name).pack()
    )
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğº Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğµ
    builder.button(
        text=admin_texts.get("logs_viewer_back_to_file_info", "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğµ"),
        callback_data=AdminLogsViewerNavigate(action="view_file", payload=file_name).pack()
    )
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğº ÑĞ¿Ğ¸ÑĞºÑƒ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
    builder.row(
        InlineKeyboardButton(
            text=admin_texts.get("logs_viewer_back_to_file_list", "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº ÑĞ¿Ğ¸ÑĞºÑƒ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²"),
            callback_data=AdminLogsViewerNavigate(action="back_to_main").pack()
        )
    )
    
    builder.adjust(1)  # ĞŸĞ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞµ Ğ² Ñ€ÑĞ´Ñƒ
    return builder.as_markup() 


======================================================================

------------------------------ FILE: Systems/core/admin/logs_viewer/__init__.py ------------------------------
# core/admin/logs_viewer/__init__.py
from aiogram import Router

from .handlers_logs import logs_viewer_router 

section_logs_viewer_router = Router(name="sdb_admin_section_logs_viewer_router")
section_logs_viewer_router.include_router(logs_viewer_router)

__all__ = ["section_logs_viewer_router"]


======================================================================

------------------------------ FILE: Systems/core/admin/entry/handlers_entry.py ------------------------------
# core/admin/entry/handlers_entry.py
from aiogram import Router, types, F, Bot
from aiogram.filters import Command
from aiogram.utils.markdown import hbold
from loguru import logger
from aiogram.exceptions import TelegramBadRequest # <--- Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•Ğ Ğ˜ĞœĞŸĞĞ Ğ¢

from Systems.core.admin.keyboards_admin_common import ADMIN_COMMON_TEXTS, get_admin_main_menu_keyboard 
from Systems.core.ui.callback_data_factories import CoreMenuNavigate, AdminMainMenuNavigate
from Systems.core.admin.filters_admin import can_view_admin_panel_filter 

from typing import TYPE_CHECKING, Union
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from sqlalchemy.ext.asyncio import AsyncSession 


admin_entry_router = Router(name="sdb_admin_entry_handlers")
MODULE_NAME_FOR_LOG = "AdminEntry"

#admin_entry_router.message.filter(can_view_admin_panel_filter)
#admin_entry_router.callback_query.filter(can_view_admin_panel_filter)


async def send_admin_main_menu(message_or_query: Union[types.Message, types.CallbackQuery], services_provider: 'BotServicesProvider'):
    user_id = message_or_query.from_user.id 
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == user_id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
    from Systems.core.admin.keyboards_admin_common import get_admin_texts
    texts = get_admin_texts(services_provider, user_locale)
    
    text = (f"ğŸ›  {hbold(texts.get('admin_panel_title', 'ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ SwiftDevBot'))}\n"
            f"{texts.get('admin_panel_select_section', 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ» Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:')}")
    
    async with services_provider.db.get_session() as session: 
        keyboard = await get_admin_main_menu_keyboard(services_provider, user_id, session, locale=user_locale)

    if isinstance(message_or_query, types.Message):
        await message_or_query.answer(text, reply_markup=keyboard)
    elif isinstance(message_or_query, types.CallbackQuery) and message_or_query.message:
        try:
            if message_or_query.message.text != text or message_or_query.message.reply_markup != keyboard:
                await message_or_query.message.edit_text(text, reply_markup=keyboard)
            else:
                logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾.")
            await message_or_query.answer() 
        except TelegramBadRequest as e_tbr: # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ TelegramBadRequest
            if "message is not modified" in str(e_tbr).lower():
                logger.trace(f"[{MODULE_NAME_FOR_LOG}] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾ (Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ğ½Ğ¾ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ TelegramBadRequest).")
                await message_or_query.answer()
            else:
                logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸: {e_tbr}")
                if isinstance(message_or_query, types.CallbackQuery): 
                    try:
                        await message_or_query.bot.send_message(user_id, text, reply_markup=keyboard)
                        await message_or_query.message.delete() 
                        await message_or_query.answer()
                    except Exception as e_send_new:
                        logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: {e_send_new}")
                        await message_or_query.answer(texts["error_general"], show_alert=True)
                else: 
                    await message_or_query.answer(texts["error_general"], show_alert=True)
        except Exception as e:
            logger.warning(f"[{MODULE_NAME_FOR_LOG}] ĞĞµĞ¿Ñ€ĞµĞ´Ğ²Ğ¸Ğ´ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ Ğ¼ĞµĞ½Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸: {e}", exc_info=True)
            if isinstance(message_or_query, types.CallbackQuery):
                await message_or_query.answer(texts["error_general"], show_alert=True)


@admin_entry_router.message(Command("admin_cp"))
async def cmd_admin_panel_main(message: types.Message, services_provider: 'BotServicesProvider'):
    user_id = message.from_user.id 
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
    has_admin_access = False
    is_super_admin = user_id in services_provider.config.core.super_admins
    
    if is_super_admin:
        has_admin_access = True
    else:
        try:
            async with services_provider.db.get_session() as session:
                from Systems.core.rbac.service import PERMISSION_CORE_VIEW_ADMIN_PANEL
                has_admin_access = await services_provider.rbac.user_has_permission(session, user_id, PERMISSION_CORE_VIEW_ADMIN_PANEL)
        except Exception as e:
            logger.error(f"[{MODULE_NAME_FOR_LOG}] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_id}: {e}")
            has_admin_access = False
    
    if has_admin_access:
        logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} (Ñ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸) Ğ²Ğ¾ÑˆĞµĞ» Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /admin_cp.")
        await send_admin_main_menu(message, services_provider)
    else:
        logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} (Ğ±ĞµĞ· Ğ¿Ñ€Ğ°Ğ²) Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ°Ğ»ÑÑ Ğ²Ğ¾Ğ¹Ñ‚Ğ¸ Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /admin_cp.")
        
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        user_locale = services_provider.config.core.i18n.default_locale
        try:
            async with services_provider.db.get_session() as session:
                from Systems.core.database.core_models import User as DBUser
                from sqlalchemy import select
                result = await session.execute(select(DBUser).where(DBUser.telegram_id == user_id))
                db_user = result.scalar_one_or_none()
                if db_user and db_user.preferred_language_code:
                    user_locale = db_user.preferred_language_code
        except Exception:
            pass
        
        from Systems.core.admin.keyboards_admin_common import get_admin_texts
        texts = get_admin_texts(services_provider, user_locale)
        
        await message.answer(
            texts.get("admin_no_access", "ğŸš« Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸.\n\nĞ•ÑĞ»Ğ¸ Ğ²Ñ‹ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚Ğµ, Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°, Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ĞµÑÑŒ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ Ğ±Ğ¾Ñ‚Ğ°."),
            show_alert=False
        )

@admin_entry_router.callback_query(CoreMenuNavigate.filter(F.target_menu == "admin_panel_main"))
async def cq_core_nav_to_admin_panel_main(query: types.CallbackQuery, services_provider: 'BotServicesProvider'):
    user_id = query.from_user.id
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} (Ñ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸) Ğ²Ğ¾ÑˆĞµĞ» Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ñ‡ĞµÑ€ĞµĞ· Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ SDB.")
    await send_admin_main_menu(query, services_provider)

@admin_entry_router.callback_query(AdminMainMenuNavigate.filter(F.target_section == "main_admin"))
async def cq_admin_nav_to_main_admin_menu(query: types.CallbackQuery, services_provider: 'BotServicesProvider'):
    user_id = query.from_user.id
    logger.info(f"[{MODULE_NAME_FOR_LOG}] ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_id} Ğ²ĞµÑ€Ğ½ÑƒĞ»ÑÑ Ğ² Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸.")
    await send_admin_main_menu(query, services_provider)

@admin_entry_router.callback_query(AdminMainMenuNavigate.filter(F.target_section == "users"))
async def cq_admin_main_to_users_list(
    query: types.CallbackQuery, 
    services_provider: 'BotServicesProvider'
):
    from Systems.core.admin.users.handlers_list import cq_admin_users_list_entry
    from Systems.core.ui.callback_data_factories import AdminUsersPanelNavigate 
    await cq_admin_users_list_entry(query, AdminUsersPanelNavigate(action="list", page=1), services_provider)

@admin_entry_router.callback_query(AdminMainMenuNavigate.filter(F.target_section == "roles"))
async def cq_admin_main_to_roles_list(
    query: types.CallbackQuery, 
    services_provider: 'BotServicesProvider',
    bot: Bot 
):
    from Systems.core.admin.roles.handlers_list import cq_admin_roles_list_entry
    from Systems.core.ui.callback_data_factories import AdminRolesPanelNavigate 
    await cq_admin_roles_list_entry(query, AdminRolesPanelNavigate(action="list"), services_provider)

@admin_entry_router.callback_query(AdminMainMenuNavigate.filter(F.target_section == "sys_info"))
async def cq_admin_main_to_sys_info(
    query: types.CallbackQuery, 
    services_provider: 'BotServicesProvider',
    bot: Bot
):
    from Systems.core.admin.sys_info.handlers_sys_info import cq_admin_show_system_info_entry
    from Systems.core.ui.callback_data_factories import AdminSysInfoPanelNavigate 
    await cq_admin_show_system_info_entry(query, AdminSysInfoPanelNavigate(action="show"), services_provider, bot)

@admin_entry_router.callback_query(AdminMainMenuNavigate.filter(F.target_section == "modules"))
async def cq_admin_main_to_modules(query: types.CallbackQuery, services_provider: 'BotServicesProvider'):
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    user_locale = services_provider.config.core.i18n.default_locale
    try:
        async with services_provider.db.get_session() as session:
            from Systems.core.database.core_models import User as DBUser
            from sqlalchemy import select
            result = await session.execute(select(DBUser).where(DBUser.telegram_id == query.from_user.id))
            db_user = result.scalar_one_or_none()
            if db_user and db_user.preferred_language_code:
                user_locale = db_user.preferred_language_code
    except Exception:
        pass
    
    from Systems.core.admin.keyboards_admin_common import get_admin_texts
    texts = get_admin_texts(services_provider, user_locale)
    
    await query.answer(texts.get("admin_modules_in_development", "Ğ Ğ°Ğ·Ğ´ĞµĞ» 'Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸' Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ."), show_alert=True)


======================================================================

------------------------------ FILE: Systems/core/admin/entry/__init__.py ------------------------------
# core/admin/entry/__init__.py
from aiogram import Router

# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ "ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğ¹" Ñ€Ğ¾ÑƒÑ‚ĞµÑ€
from .handlers_entry import admin_entry_router

# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ "ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‰Ğ¸Ğ¹" Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°
section_entry_router = Router(name="sdb_admin_section_entry_router")
section_entry_router.include_router(admin_entry_router)

__all__ = ["section_entry_router"]


======================================================================

------------------------------ FILE: Systems/core/module_loader/migrations.py ------------------------------
# core/module_loader/migrations.py
"""
Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ‘Ğ” Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
"""

import importlib
from pathlib import Path
from typing import List, Optional, Dict
from loguru import logger

from sqlalchemy.ext.asyncio import AsyncSession
from alembic import config as alembic_config
from alembic.script import ScriptDirectory
from alembic.runtime.migration import MigrationContext

from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider
    from Systems.core.module_loader import ModuleInfo


class ModuleMigrationManager:
    """
    ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
    """
    
    def __init__(self, services_provider: 'BotServicesProvider'):
        self.services = services_provider
        self._logger = logger.bind(service="ModuleMigrationManager")
        self._migration_paths: Dict[str, Path] = {}
    
    def register_module_migrations(self, module_name: str, migrations_path: Path):
        """Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸ÑĞ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
        if migrations_path.exists() and migrations_path.is_dir():
            self._migration_paths[module_name] = migrations_path
            self._logger.info(f"Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {migrations_path}")
        else:
            self._logger.warning(f"ĞŸÑƒÑ‚ÑŒ Ğº Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸ÑĞ¼ Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚: {migrations_path}")
    
    async def run_module_migrations(
        self,
        module_name: str,
        target_revision: str = "head"
    ) -> bool:
        """
        Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        
        Args:
            module_name: Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
            target_revision: Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ñ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ "head")
        
        Returns:
            True ĞµÑĞ»Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾
        """
        if module_name not in self._migration_paths:
            self._logger.warning(f"ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name} Ğ½Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹")
            return False
        
        migrations_path = self._migration_paths[module_name]
        
        try:
            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Alembic Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
            module_alembic_cfg = alembic_config.Config()
            module_alembic_cfg.set_main_option("script_location", str(migrations_path))
            
            # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ URL Ğ‘Ğ” Ğ¸Ğ· ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
            db_url = self.services.db.get_database_url()
            module_alembic_cfg.set_main_option("sqlalchemy.url", db_url)
            
            # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
            from alembic import command
            command.upgrade(module_alembic_cfg, target_revision)
            
            self._logger.success(f"ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name} Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹ Ğ´Ğ¾ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸ {target_revision}")
            return True
        
        except Exception as e:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {e}", exc_info=True)
            return False
    
    async def get_module_migration_status(self, module_name: str) -> Dict:
        """
        ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        
        Returns:
            Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ¾ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸ÑÑ…
        """
        if module_name not in self._migration_paths:
            return {
                "registered": False,
                "current_revision": None,
                "head_revision": None
            }
        
        try:
            migrations_path = self._migration_paths[module_name]
            script = ScriptDirectory.from_config(
                alembic_config.Config().set_main_option("script_location", str(migrations_path))
            )
            
            head_revision = script.get_current_head()
            
            # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ñ Ğ¸Ğ· Ğ‘Ğ”
            async with self.services.db.get_session() as session:
                context = MigrationContext.configure(await session.connection())
                current_revision = context.get_current_revision()
            
            return {
                "registered": True,
                "current_revision": current_revision,
                "head_revision": head_revision,
                "is_up_to_date": current_revision == head_revision
            }
        
        except Exception as e:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}: {e}")
            return {
                "registered": True,
                "error": str(e)
            }
    
    async def run_all_module_migrations(self) -> Dict[str, bool]:
        """
        Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
        
        Returns:
            Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ {module_name: success}
        """
        results = {}
        for module_name in self._migration_paths.keys():
            results[module_name] = await self.run_module_migrations(module_name)
        return results




======================================================================

------------------------------ FILE: Systems/core/rbac/service.py ------------------------------
# core/rbac/service.py
from typing import TYPE_CHECKING, Dict, List, Optional, Set, Tuple, Union

from loguru import logger
from sqlalchemy import delete
from sqlalchemy import func as sql_func
from sqlalchemy import select
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy.orm import selectinload

from Systems.core.database.core_models import (Permission,  # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° UserPermission
                                       Role, RolePermission, User,
                                       UserPermission, UserRole)
from Systems.core.schemas.module_manifest import \
    PermissionManifest as ModulePermissionManifestSchema

if TYPE_CHECKING:
    from Systems.core.database.manager import DBManager
    from Systems.core.module_loader import ModuleInfo
    from Systems.core.services_provider import BotServicesProvider

# --- Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ Ğ Ğ¾Ğ»Ğ¸ ---
DEFAULT_ROLE_USER = "User"
DEFAULT_ROLE_MODERATOR = "Moderator"
DEFAULT_ROLE_ADMIN = "Admin"
DEFAULT_ROLE_SUPER_ADMIN = "SuperAdmin"

DEFAULT_ROLES_DEFINITIONS: Dict[str, str] = {
    DEFAULT_ROLE_USER: "ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°.",
    DEFAULT_ROLE_MODERATOR: "ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸ Ğ½Ğ° Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ.",
    DEFAULT_ROLE_ADMIN: "ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€, Ğ¸Ğ¼ĞµĞµÑ‚ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ² Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑÑ….",
    DEFAULT_ROLE_SUPER_ADMIN: "Ğ¡ÑƒĞ¿ĞµÑ€ ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€, Ğ¸Ğ¼ĞµĞµÑ‚ Ğ½ĞµĞ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ ĞºĞ¾ Ğ²ÑĞµĞ¼ Ñ„ÑƒĞ½ĞºÑ†Ğ¸ÑĞ¼ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.",
}

# --- Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¯Ğ”Ğ Ğ (Permissions) ---
PERMISSION_CORE_VIEW_ADMIN_PANEL = "core.admin.view_panel"
PERMISSION_CORE_USERS_VIEW_LIST = "core.users.view_list"
PERMISSION_CORE_USERS_VIEW_DETAILS = "core.users.view_details"
PERMISSION_CORE_USERS_EDIT_PROFILE = "core.users.edit_profile"
PERMISSION_CORE_USERS_MANAGE_STATUS = "core.users.manage_status"
PERMISSION_CORE_USERS_ASSIGN_ROLES = "core.users.assign_roles"
PERMISSION_CORE_USERS_DELETE = "core.users.delete"
PERMISSION_CORE_USERS_MANAGE_DIRECT_PERMISSIONS = "core.users.manage_direct_permissions"  # ĞĞĞ’ĞĞ• Ğ ĞĞ—Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•

PERMISSION_CORE_ROLES_VIEW = "core.roles.view"
PERMISSION_CORE_ROLES_CREATE = "core.roles.create"
PERMISSION_CORE_ROLES_EDIT = "core.roles.edit"
PERMISSION_CORE_ROLES_DELETE = "core.roles.delete"
PERMISSION_CORE_ROLES_ASSIGN_PERMISSIONS = "core.roles.assign_permissions"

PERMISSION_CORE_PERMISSIONS_VIEW = "core.permissions.view"

PERMISSION_CORE_MODULES_VIEW_LIST = "core.modules.view_list"
PERMISSION_CORE_MODULES_TOGGLE_ACTIVATION = "core.modules.toggle_activation"
PERMISSION_CORE_MODULES_MANAGE_SETTINGS = "core.modules.manage_settings"

PERMISSION_CORE_SYSTEM_VIEW_INFO_BASIC = "core.system.view_info.basic"
PERMISSION_CORE_SYSTEM_VIEW_INFO_FULL = "core.system.view_info.full"
PERMISSION_CORE_SYSTEM_VIEW_LOGS_BASIC = "core.system.view_logs.basic"
PERMISSION_CORE_SYSTEM_VIEW_LOGS_FULL = "core.system.view_logs.full"
PERMISSION_CORE_SYSTEM_MANAGE_BACKUPS = "core.system.manage_backups"
PERMISSION_CORE_SYSTEM_SEND_BROADCAST = "core.system.send_broadcast"

PERMISSION_CORE_SETTINGS_VIEW = "core.settings.view"
PERMISSION_CORE_SETTINGS_EDIT = "core.settings.edit"


DEFAULT_CORE_PERMISSIONS_DEFINITIONS: Dict[str, str] = {
    PERMISSION_CORE_VIEW_ADMIN_PANEL: "Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸.",
    PERMISSION_CORE_USERS_VIEW_LIST: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.",
    PERMISSION_CORE_USERS_VIEW_DETAILS: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ.",
    PERMISSION_CORE_USERS_EDIT_PROFILE: "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ¸Ğ¼Ñ, ÑĞ·Ñ‹Ğº Ğ¸ Ñ‚.Ğ´.).",
    PERMISSION_CORE_USERS_MANAGE_STATUS: "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½/Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½).",
    PERMISSION_CORE_USERS_ASSIGN_ROLES: "ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¸ ÑĞ½ÑÑ‚Ğ¸Ğµ Ñ€Ğ¾Ğ»ĞµĞ¹ Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.",
    PERMISSION_CORE_USERS_DELETE: "Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸Ğ· ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.",
    PERMISSION_CORE_USERS_MANAGE_DIRECT_PERMISSIONS: "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.",  # ĞĞŸĞ˜Ğ¡ĞĞĞ˜Ğ• ĞĞĞ’ĞĞ“Ğ Ğ ĞĞ—Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ¯
    PERMISSION_CORE_ROLES_VIEW: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ¸ Ğ¸Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹.",
    PERMISSION_CORE_ROLES_CREATE: "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ€Ğ¾Ğ»ĞµĞ¹.",
    PERMISSION_CORE_ROLES_EDIT: "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ñ€Ğ¾Ğ»ĞµĞ¹ (Ğ¸Ğ¼Ñ, Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ).",
    PERMISSION_CORE_ROLES_DELETE: "Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»ĞµĞ¹.",
    PERMISSION_CORE_ROLES_ASSIGN_PERMISSIONS: "ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¸ ÑĞ½ÑÑ‚Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ñ Ñ€Ğ¾Ğ»ĞµĞ¹.",
    PERMISSION_CORE_PERMISSIONS_VIEW: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ÑĞ¿Ğ¸ÑĞºĞ° Ğ²ÑĞµÑ… Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹.",
    PERMISSION_CORE_MODULES_VIEW_LIST: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ¸ Ğ¸Ñ… ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ².",
    PERMISSION_CORE_MODULES_TOGGLE_ACTIVATION: "Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ².",
    PERMISSION_CORE_MODULES_MANAGE_SETTINGS: "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹.",
    PERMISSION_CORE_SYSTEM_VIEW_INFO_BASIC: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸.",
    PERMISSION_CORE_SYSTEM_VIEW_INFO_FULL: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ğ¾Ñ‚Ğ»Ğ°Ğ´Ğ¾Ñ‡Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….",
    PERMISSION_CORE_SYSTEM_VIEW_LOGS_BASIC: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.",
    PERMISSION_CORE_SYSTEM_VIEW_LOGS_FULL: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ²ÑĞµÑ… Ğ»Ğ¾Ğ³Ğ¾Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¸ Ğ¸Ñ… ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ.",
    PERMISSION_CORE_SYSTEM_MANAGE_BACKUPS: "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ğ¼Ğ¸ ĞºĞ¾Ğ¿Ğ¸ÑĞ¼Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.",
    PERMISSION_CORE_SYSTEM_SEND_BROADCAST: "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑˆĞ¸Ñ€Ğ¾ĞºĞ¾Ğ²ĞµÑ‰Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼.",
    PERMISSION_CORE_SETTINGS_VIEW: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº ÑĞ´Ñ€Ğ° SwiftDevBot.",
    PERMISSION_CORE_SETTINGS_EDIT: "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº ÑĞ´Ñ€Ğ° SwiftDevBot (Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ñ€Ğ¸ÑĞº).",
}

DEFAULT_PERMISSIONS_FOR_CORE_MODERATOR_ROLE: Set[str] = {
    PERMISSION_CORE_VIEW_ADMIN_PANEL,
    PERMISSION_CORE_USERS_VIEW_LIST,
    PERMISSION_CORE_USERS_VIEW_DETAILS,
    PERMISSION_CORE_SYSTEM_VIEW_INFO_BASIC,
}

DEFAULT_PERMISSIONS_FOR_CORE_ADMIN_ROLE: Set[str] = {
    *DEFAULT_PERMISSIONS_FOR_CORE_MODERATOR_ROLE,
    PERMISSION_CORE_USERS_MANAGE_STATUS,
    PERMISSION_CORE_USERS_ASSIGN_ROLES,
    PERMISSION_CORE_MODULES_VIEW_LIST,
    PERMISSION_CORE_SYSTEM_VIEW_LOGS_BASIC,
    PERMISSION_CORE_ROLES_VIEW,
    PERMISSION_CORE_PERMISSIONS_VIEW,
    PERMISSION_CORE_ROLES_CREATE,
    PERMISSION_CORE_ROLES_EDIT,
    PERMISSION_CORE_ROLES_DELETE,
    PERMISSION_CORE_ROLES_ASSIGN_PERMISSIONS,
    PERMISSION_CORE_USERS_MANAGE_DIRECT_PERMISSIONS,  # ĞĞ°Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµĞ¼ Ñ€Ğ¾Ğ»Ğ¸ Admin Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
}

# Ğ¡ÑƒĞ¿ĞµÑ€ ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ’Ğ¡Ğ• Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ (Ğ½ĞµĞ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸)
DEFAULT_PERMISSIONS_FOR_CORE_SUPER_ADMIN_ROLE: Set[str] = {
    *DEFAULT_PERMISSIONS_FOR_CORE_ADMIN_ROLE,
    # Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ ÑÑƒĞ¿ĞµÑ€-Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°
    PERMISSION_CORE_USERS_DELETE,
    PERMISSION_CORE_USERS_EDIT_PROFILE,
    PERMISSION_CORE_MODULES_TOGGLE_ACTIVATION,
    PERMISSION_CORE_MODULES_MANAGE_SETTINGS,
    PERMISSION_CORE_SYSTEM_VIEW_INFO_FULL,
    PERMISSION_CORE_SYSTEM_VIEW_LOGS_FULL,
    PERMISSION_CORE_SYSTEM_MANAGE_BACKUPS,
    PERMISSION_CORE_SYSTEM_SEND_BROADCAST,
    PERMISSION_CORE_SETTINGS_VIEW,
    PERMISSION_CORE_SETTINGS_EDIT,
}

DEFAULT_PERMISSIONS_FOR_CORE_USER_ROLE: Set[str] = set()


class RBACService:
    def __init__(self, services: Optional["BotServicesProvider"] = None, db_manager: Optional["DBManager"] = None):
        self._services_provider_ref: Optional["BotServicesProvider"] = services
        if db_manager:
            self._db_manager = db_manager
        elif services and hasattr(services, "db") and services.db is not None:
            self._db_manager = services.db
        else:
            self._db_manager = None
            logger.warning(
                "RBACService Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ±ĞµĞ· DBManager. "
                "ĞœĞµÑ‚Ğ¾Ğ´Ñ‹ ensure_default_... Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ ÑĞ²Ğ½Ğ¾Ğ¹ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ ÑĞµÑÑĞ¸Ğ¸ Ğ¸Ğ»Ğ¸ DBManager."
            )

        self._logger = logger.bind(service="RBACService")
        self._logger.info("RBACService Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")

    async def _get_role_by_name(self, session: AsyncSession, role_name: str) -> Optional[Role]:
        self._logger.trace(f"ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸: '{role_name}'")
        stmt = select(Role).options(selectinload(Role.permissions)).where(Role.name == role_name)
        result = await session.execute(stmt)
        role = result.scalars().first()
        self._logger.trace(f"Ğ Ğ¾Ğ»ÑŒ '{role_name}' Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°: {role is not None} (ID: {getattr(role, 'id', 'N/A')})")
        return role

    async def get_or_create_role(
        self, session: AsyncSession, role_name: str, description: Optional[str] = None
    ) -> Optional[Role]:
        role = await self._get_role_by_name(session, role_name)
        if not role:
            role_def_desc = DEFAULT_ROLES_DEFINITIONS.get(role_name)
            current_description = description if description is not None else role_def_desc

            if role_name in DEFAULT_ROLES_DEFINITIONS and description is None:
                current_description = role_def_desc

            self._logger.info(
                f"Ğ Ğ¾Ğ»ÑŒ '{role_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°, Ğ±ÑƒĞ´ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ° Ñ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼: '{current_description or 'Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚'}'."
            )
            role = Role(name=role_name, description=current_description)
            session.add(role)
            try:
                await session.flush([role])
                self._logger.success(f"Ğ Ğ¾Ğ»ÑŒ '{role_name}' ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ° (Ñflushed) Ñ ID: {role.id}")
            except Exception as e_flush_role:
                self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ flush Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸ '{role_name}': {e_flush_role}", exc_info=True)
                return None
        return role

    async def register_permissions_from_modules(self, session: AsyncSession) -> int:
        if not self._services_provider_ref or not hasattr(self._services_provider_ref, "modules"):
            self._logger.error(
                "ModuleLoader Ğ½Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ñ‡ĞµÑ€ĞµĞ· BotServicesProvider. Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ°."
            )
            return 0

        module_loader = self._services_provider_ref.modules
        declared_perms_manifests: List[ModulePermissionManifestSchema] = (
            module_loader.get_all_declared_permissions_from_active_modules()
        )

        if not declared_perms_manifests:
            self._logger.info("ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹, Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ² Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ…, Ğ´Ğ»Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸.")
            return 0

        self._logger.info(
            f"ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ {len(declared_perms_manifests)} Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ´Ğ»Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸/Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸..."
        )

        created_count = 0

        for perm_mft in declared_perms_manifests:
            existing_perm = await self._get_permission_by_name(session, perm_mft.name)
            if not existing_perm:
                new_perm_obj = await self.get_or_create_permission(session, perm_mft.name, perm_mft.description)
                if new_perm_obj:
                    created_count += 1
                else:
                    self._logger.error(f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ/Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{perm_mft.name}'.")
            else:
                if existing_perm.description != perm_mft.description:
                    self._logger.info(
                        f"ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{perm_mft.name}' Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°ĞµÑ‚ÑÑ. "
                        f"Ğ‘Ğ”: '{existing_perm.description}', ĞœĞ°Ğ½Ğ¸Ñ„ĞµÑÑ‚: '{perm_mft.description}'. ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ."
                    )
                self._logger.trace(f"Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{perm_mft.name}' ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ² Ğ‘Ğ”.")

        if created_count > 0:
            self._logger.success(
                f"{created_count} Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¸Ğ· Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ±Ñ‹Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹/Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ñ‹ (flush Ğ±Ñ‹Ğ» Ğ² get_or_create_permission)."
            )

        return created_count

    async def ensure_default_entities_exist(self, session: AsyncSession) -> Tuple[int, int, int]:
        self._logger.info(
            "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ĞµĞ¹ RBAC (Ñ€Ğ¾Ğ»Ğ¸, Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ ÑĞ´Ñ€Ğ°, Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹)..."
        )

        created_core_perms_count = 0
        created_module_perms_count = 0
        created_roles_count = 0
        initial_session_dirty = bool(session.new or session.dirty or session.deleted)

        self._logger.debug("Ğ­Ñ‚Ğ°Ğ¿ 1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ/Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¯Ğ”Ğ Ğ.")
        core_permissions_to_add_objs: List[Permission] = []
        for perm_name, perm_description in DEFAULT_CORE_PERMISSIONS_DEFINITIONS.items():
            existing_perm = await self._get_permission_by_name(session, perm_name)
            if not existing_perm:
                new_perm = Permission(name=perm_name, description=perm_description)
                core_permissions_to_add_objs.append(new_perm)
                self._logger.info(f"Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ ÑĞ´Ñ€Ğ° '{perm_name}' Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ Ğ´Ğ»Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ.")
                created_core_perms_count += 1

        if core_permissions_to_add_objs:
            session.add_all(core_permissions_to_add_objs)
            self._logger.info(f"{created_core_perms_count} Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ ÑĞ´Ñ€Ğ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ² ÑĞµÑÑĞ¸Ñ.")

        self._logger.debug("Ğ­Ñ‚Ğ°Ğ¿ 2: Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¸Ğ· ĞœĞĞĞ˜Ğ¤Ğ•Ğ¡Ğ¢ĞĞ’ ĞœĞĞ”Ğ£Ğ›Ğ•Ğ™.")
        module_perms_result = await self.register_permissions_from_modules(session)
        if module_perms_result == -1:
            self._logger.error(
                "ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹. Ğ”Ğ°Ğ»ÑŒĞ½ĞµĞ¹ÑˆĞ°Ñ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ RBAC Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ğ½Ğ°."
            )
            return 0, 0, -1
        created_module_perms_count = module_perms_result

        self._logger.debug("Ğ­Ñ‚Ğ°Ğ¿ 3: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ/Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… Ğ ĞĞ›Ğ•Ğ™.")
        roles_to_add_objs: List[Role] = []
        for role_name, role_description in DEFAULT_ROLES_DEFINITIONS.items():
            existing_role = await self._get_role_by_name(session, role_name)
            if not existing_role:
                new_role = Role(name=role_name, description=role_description)
                roles_to_add_objs.append(new_role)
                self._logger.info(f"Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ°Ñ Ñ€Ğ¾Ğ»ÑŒ '{role_name}' Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ° Ğ´Ğ»Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ.")
                created_roles_count += 1

        if roles_to_add_objs:
            session.add_all(roles_to_add_objs)
            self._logger.info(f"{created_roles_count} ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ² ÑĞµÑÑĞ¸Ñ.")

        if core_permissions_to_add_objs or roles_to_add_objs or created_module_perms_count > 0:
            try:
                self._logger.debug("Ğ­Ñ‚Ğ°Ğ¿ 4: Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ flush Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ID Ğ½Ğ¾Ğ²Ñ‹Ñ… ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ĞµĞ¹...")
                await session.flush()
                self._logger.debug("ĞĞ±Ñ‰Ğ¸Ğ¹ Flush Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾.")
            except Exception as e_flush_all:
                self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ñ‰ĞµĞ¼ flush Ñ€Ğ¾Ğ»ĞµĞ¹/Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹: {e_flush_all}", exc_info=True)
                await session.rollback()
                return 0, 0, 0

        self._logger.debug(f"Ğ­Ñ‚Ğ°Ğ¿ 5: ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¯Ğ”Ğ Ğ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¼ Ñ€Ğ¾Ğ»ÑĞ¼.")
        assigned_perms_summary: Dict[str, int] = {}

        all_permissions_in_db = await self.get_all_permissions(session)
        all_permissions_map_by_name = {p.name: p for p in all_permissions_in_db}

        role_core_permission_map = {
            DEFAULT_ROLE_SUPER_ADMIN: DEFAULT_PERMISSIONS_FOR_CORE_SUPER_ADMIN_ROLE,
            DEFAULT_ROLE_ADMIN: DEFAULT_PERMISSIONS_FOR_CORE_ADMIN_ROLE,
            DEFAULT_ROLE_MODERATOR: DEFAULT_PERMISSIONS_FOR_CORE_MODERATOR_ROLE,
            DEFAULT_ROLE_USER: DEFAULT_PERMISSIONS_FOR_CORE_USER_ROLE,
        }

        changes_in_role_perms_assignment = False
        for role_name_to_setup, core_perm_names_to_assign in role_core_permission_map.items():
            role_obj = await self._get_role_by_name(session, role_name_to_setup)
            if not role_obj or role_obj.id is None:
                self._logger.error(
                    f"Ğ Ğ¾Ğ»ÑŒ '{role_name_to_setup}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ ID Ğ¿Ğ¾ÑĞ»Ğµ flush. ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ."
                )
                continue

            current_role_assigned_count = 0
            self._logger.info(f"ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ ÑĞ´ĞµÑ€Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ñ€Ğ¾Ğ»Ğ¸ '{role_name_to_setup}' (ID: {role_obj.id})...")
            for perm_name in core_perm_names_to_assign:
                perm_obj_to_assign = all_permissions_map_by_name.get(perm_name)
                if not perm_obj_to_assign or perm_obj_to_assign.id is None:
                    self._logger.warning(
                        f"Ğ¯Ğ´ĞµÑ€Ğ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{perm_name}' Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ '{role_name_to_setup}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ² Ğ¾Ğ±Ñ‰ĞµĞ¼ ÑĞ¿Ğ¸ÑĞºĞµ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ ID. ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞº."
                    )
                    continue

                if await self._ensure_role_has_permission_link(session, role_obj.id, perm_obj_to_assign.id):
                    if await self.assign_permission_to_role(
                        session, role_obj, perm_obj_to_assign.name, auto_create_perm=False
                    ):
                        current_role_assigned_count += 1
                        changes_in_role_perms_assignment = True

            if current_role_assigned_count > 0:
                assigned_perms_summary[role_name_to_setup] = current_role_assigned_count
                self._logger.info(
                    f"{current_role_assigned_count} Ğ½Ğ¾Ğ²Ñ‹Ñ… ÑĞ´ĞµÑ€Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ±Ñ‹Ğ»Ğ¸ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹/Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ñ‹ Ñ€Ğ¾Ğ»Ğ¸ '{role_name_to_setup}'."
                )

        self._logger.debug(f"Ğ­Ñ‚Ğ°Ğ¿ 5.1: ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ñ€Ğ°Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ñ€Ğ¾Ğ»Ğ¸ '{DEFAULT_ROLE_USER}'.")
        role_user_obj = await self._get_role_by_name(session, DEFAULT_ROLE_USER)
        module_loader = self._services_provider_ref.modules if self._services_provider_ref else None

        auto_assigned_module_perms_count = 0
        if role_user_obj and role_user_obj.id and module_loader:
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ (Ğ¸Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ ÑƒĞ¶Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹)
            active_modules = []
            for module_name in module_loader.enabled_plugin_names:
                module_info = module_loader.available_modules.get(module_name)
                if module_info and not module_info.error:
                    active_modules.append(module_info)
            
            # Ğ¢Ğ°ĞºĞ¶Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
            for module_info in module_loader.available_modules.values():
                if module_info.is_system_module and not module_info.error:
                    if module_info not in active_modules:
                        active_modules.append(module_info)
            
            for module_info in active_modules:
                if (
                    module_info.manifest
                    and module_info.manifest.metadata
                    and module_info.manifest.metadata.assign_default_access_to_user_role
                ):

                    base_access_perm_name = f"{module_info.name}.access_user_features"
                    perm_obj = all_permissions_map_by_name.get(base_access_perm_name)
                    if perm_obj and perm_obj.id:
                        if await self._ensure_role_has_permission_link(session, role_user_obj.id, perm_obj.id):
                            if await self.assign_permission_to_role(
                                session, role_user_obj, perm_obj.name, auto_create_perm=False
                            ):
                                self._logger.info(
                                    f"ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{perm_obj.name}' Ñ€Ğ¾Ğ»Ğ¸ '{DEFAULT_ROLE_USER}'."
                                )
                                auto_assigned_module_perms_count += 1
                                changes_in_role_perms_assignment = True
                    else:
                        self._logger.warning(
                            f"ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{base_access_perm_name}' Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_info.name}', "
                            "Ñ…Ğ¾Ñ‚Ñ Ğ¾Ğ½ Ğ¿Ğ¾Ğ¼ĞµÑ‡ĞµĞ½ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾-Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ»Ğ¸ User. Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¾ Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ."
                        )
        if auto_assigned_module_perms_count > 0:
            if DEFAULT_ROLE_USER in assigned_perms_summary:
                assigned_perms_summary[DEFAULT_ROLE_USER] += auto_assigned_module_perms_count
            else:
                assigned_perms_summary[DEFAULT_ROLE_USER] = auto_assigned_module_perms_count

        final_session_dirty = bool(session.new or session.dirty or session.deleted)
        if final_session_dirty or (
            not initial_session_dirty
            and (
                created_roles_count
                or created_core_perms_count
                or created_module_perms_count > 0
                or any(assigned_perms_summary.values())
            )
        ):
            self._logger.debug("Ğ­Ñ‚Ğ°Ğ¿ 6: ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ° Ğ²ÑĞµÑ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ RBAC...")
            try:
                await session.commit()
                summary_log_parts = []
                if created_roles_count:
                    summary_log_parts.append(f"{created_roles_count} Ñ€Ğ¾Ğ»ĞµĞ¹ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾")
                if created_core_perms_count:
                    summary_log_parts.append(f"{created_core_perms_count} Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ ÑĞ´Ñ€Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾")
                if created_module_perms_count > 0:
                    summary_log_parts.append(
                        f"{created_module_perms_count} Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾/Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾"
                    )
                for role_name_sum, count_sum in assigned_perms_summary.items():
                    if count_sum > 0:
                        summary_log_parts.append(f"{count_sum} Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¾ {role_name_sum}")

                log_msg_commit = (
                    f"Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ RBAC ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚Ğ¸ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¸ Ğ·Ğ°ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‡ĞµĞ½Ñ‹: "
                    f"{'; '.join(summary_log_parts) or 'Ğ½ĞµÑ‚ ÑĞ²Ğ½Ñ‹Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾ÑĞ»Ğµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ°Ğ².'}."
                )
                self._logger.success(log_msg_commit)
            except Exception as e:
                self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğµ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… RBAC ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ĞµĞ¹: {e}", exc_info=True)
                await session.rollback()
                return 0, 0, 0
        else:
            self._logger.info("ĞĞµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ² RBAC Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ°.")

        return created_roles_count, created_core_perms_count, created_module_perms_count

    async def _ensure_role_has_permission_link(self, session: AsyncSession, role_id: int, permission_id: int) -> bool:
        self._logger.trace(f"[ENSURE_LINK] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ²ÑĞ·Ğ¸ Ğ´Ğ»Ñ RoleID: {role_id}, PermID: {permission_id}")
        link_exists_stmt = (
            select(RolePermission.id)
            .where(RolePermission.role_id == role_id, RolePermission.permission_id == permission_id)
            .limit(1)
        )
        try:
            link_res = await session.execute(link_exists_stmt)
            scalar_result = link_res.scalar_one_or_none()
            if scalar_result is None:
                self._logger.trace(
                    f"[ENSURE_LINK] Ğ¡Ğ²ÑĞ·ÑŒ Ğ´Ğ»Ñ RoleID {role_id}, PermID {permission_id} ĞĞ• Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° (Ğ½ÑƒĞ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ)."
                )
                return True
            else:
                self._logger.trace(
                    f"[ENSURE_LINK] Ğ¡Ğ²ÑĞ·ÑŒ Ğ´Ğ»Ñ RoleID {role_id}, PermID {permission_id} ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ (ID: {scalar_result})."
                )
                return False
        except Exception as e_exec_link:
            self._logger.error(
                f"[ENSURE_LINK] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ ÑĞ²ÑĞ·Ğ¸ RolePermission Ğ´Ğ»Ñ RoleID {role_id}, PermID {permission_id}: {e_exec_link}",
                exc_info=True,
            )
            return False

    async def assign_role_to_user(self, session: AsyncSession, user: User, role_name: str) -> bool:
        if not user or user.id is None:
            self._logger.error(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ²Ğ°Ğ»Ğ¸Ğ´ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ ID (user: {user}).")
            return False

        role_obj = await self.get_or_create_role(session, role_name)
        if not role_obj or role_obj.id is None:
            self._logger.error(
                f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ '{role_name}' (ID: {getattr(role_obj, 'id', 'N/A')}) Ğ´Ğ»Ñ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.id}."
            )
            return False

        self._logger.debug(
            f"[ASSIGN_ROLE_TO_USER] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ²ÑĞ·Ğ¸ Ğ´Ğ»Ñ UserID: {user.id} (Ñ‚Ğ¸Ğ¿: {type(user.id)}), RoleID: {role_obj.id} (Ñ‚Ğ¸Ğ¿: {type(role_obj.id)})"
        )
        existing_link_stmt = (
            select(UserRole.id).where(UserRole.user_id == user.id, UserRole.role_id == role_obj.id).limit(1)
        )
        try:
            existing_link_res = await session.execute(existing_link_stmt)
            scalar_res_link = existing_link_res.scalar_one_or_none()
            self._logger.debug(
                f"[ASSIGN_ROLE_TO_USER] Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ scalar_one_or_none Ğ´Ğ»Ñ UserID {user.id}, RoleID {role_obj.id}: {scalar_res_link} (Ñ‚Ğ¸Ğ¿: {type(scalar_res_link)})"
            )

            if scalar_res_link is not None:
                self._logger.debug(f"Ğ Ğ¾Ğ»ÑŒ '{role_name}' ÑƒĞ¶Ğµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ID: {user.id}.")
                return True

            new_user_role_link = UserRole(user_id=user.id, role_id=role_obj.id)
            session.add(new_user_role_link)
            self._logger.info(
                f"Ğ Ğ¾Ğ»ÑŒ '{role_name}' (RoleID: {role_obj.id}) Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ UserID: {user.id} (Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµÑ‚ commit)."
            )
            return True
        except Exception as e_assign:
            self._logger.error(
                f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¸ Ñ€Ğ¾Ğ»Ğ¸ '{role_name}' Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.id}: {e_assign}", exc_info=True
            )
            return False

    async def remove_role_from_user(self, session: AsyncSession, user: User, role_name: str) -> bool:
        if not user or user.id is None:
            self._logger.error("ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑĞ½ÑÑ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ Ñ Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ ID).")
            return False

        role_to_remove = await self._get_role_by_name(session, role_name)
        if not role_to_remove or role_to_remove.id is None:
            self._logger.warning(
                f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑĞ½ÑÑ‚ÑŒ Ğ½ĞµÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ÑƒÑ Ñ€Ğ¾Ğ»ÑŒ '{role_name}' Ğ¸Ğ»Ğ¸ Ñ€Ğ¾Ğ»ÑŒ Ğ±ĞµĞ· ID Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.id}."
            )
            return True

        try:
            stmt_delete = delete(UserRole).where(UserRole.user_id == user.id, UserRole.role_id == role_to_remove.id)
            result = await session.execute(stmt_delete)

            if result.rowcount > 0:
                self._logger.info(f"Ğ Ğ¾Ğ»ÑŒ '{role_name}' ÑĞ½ÑÑ‚Ğ° Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.id} (Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµÑ‚ commit).")
                return True
            else:
                self._logger.debug(f"Ğ Ğ¾Ğ»ÑŒ '{role_name}' Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ° Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.id}. Ğ¡Ğ½ÑÑ‚Ğ¸Ğµ Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ.")
                return True
        except Exception as e:
            self._logger.error(
                f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ²ÑĞ·Ğ¸ UserRole Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.id} Ğ¸ Ñ€Ğ¾Ğ»Ğ¸ '{role_name}': {e}",
                exc_info=True,
            )
            return False

    def user_has_role(self, user: User, role_name: str) -> bool:
        if not user or not user.roles:
            return False
        return any(r.name.lower() == role_name.lower() for r in user.roles if r and r.name)

    async def user_has_role_async(self, session: AsyncSession, user_telegram_id: int, role_name: str) -> bool:
        stmt = select(User).options(selectinload(User.roles)).where(User.telegram_id == user_telegram_id)
        result = await session.execute(stmt)
        user_db: Optional[User] = result.scalars().first()

        if not user_db:
            self._logger.debug(
                f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ Telegram ID {user_telegram_id} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ Ñ€Ğ¾Ğ»Ğ¸ '{role_name}'."
            )
            return False
        return self.user_has_role(user_db, role_name)

    def get_user_role_names(self, user: User) -> Set[str]:
        if not user or not user.roles:
            return set()
        return {role.name for role in user.roles if role and role.name}

    async def get_user_roles_async(self, session: AsyncSession, user_telegram_id: int) -> List[Role]:
        stmt = select(User).options(selectinload(User.roles)).where(User.telegram_id == user_telegram_id)
        result = await session.execute(stmt)
        user_db: Optional[User] = result.scalars().first()

        if not user_db:
            self._logger.debug(f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ Telegram ID {user_telegram_id} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ ĞµĞ³Ğ¾ Ñ€Ğ¾Ğ»ĞµĞ¹.")
            return []
        return list(user_db.roles) if user_db.roles else []

    async def get_all_roles(self, session: AsyncSession) -> List[Role]:
        stmt = select(Role).options(selectinload(Role.permissions)).order_by(Role.name)
        result = await session.execute(stmt)
        roles = list(result.scalars().all())
        self._logger.debug(f"Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ñ€Ğ¾Ğ»ĞµĞ¹. ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾: {len(roles)}.")
        return roles

    async def delete_role(self, session: AsyncSession, role_name_or_id: Union[str, int]) -> bool:
        self._logger.info(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ»Ğ¸: '{role_name_or_id}'...")
        role: Optional[Role] = None
        if isinstance(role_name_or_id, str):
            role = await self._get_role_by_name(session, role_name_or_id)
        elif isinstance(role_name_or_id, int):
            role = await session.get(Role, role_name_or_id)

        if not role:
            self._logger.warning(f"Ğ Ğ¾Ğ»ÑŒ '{role_name_or_id}' Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°.")
            return False

        if role.name in DEFAULT_ROLES_DEFINITIONS:
            self._logger.error(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}'. ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½Ğ°.")
            return False

        user_role_count_stmt = select(sql_func.count(UserRole.id)).where(UserRole.role_id == role.id)
        user_role_count_res = await session.execute(user_role_count_stmt)
        user_count_with_role = user_role_count_res.scalar_one()

        if user_count_with_role > 0:
            self._logger.error(
                f"ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ '{role.name}' (ID: {role.id}), Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ¾Ğ½Ğ° Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ° {user_count_with_role} Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ(ÑĞ¼). "
                "Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ½Ğ¸Ğ¼Ğ¸Ñ‚Ğµ ÑÑ‚Ñƒ Ñ€Ğ¾Ğ»ÑŒ ÑĞ¾ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹."
            )
            return False

        try:
            await session.execute(delete(RolePermission).where(RolePermission.role_id == role.id))
            await session.delete(role)
            self._logger.warning(
                f"Ğ Ğ¾Ğ»ÑŒ '{role.name}' (ID: {role.id}) Ğ¸ ĞµĞµ ÑĞ²ÑĞ·Ğ¸ Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ¿Ğ¾Ğ¼ĞµÑ‡ĞµĞ½Ñ‹ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ (Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµÑ‚ commit)."
            )
            return True
        except Exception as e:
            self._logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}': {e}", exc_info=True)
            return False

    async def _get_permission_by_name(self, session: AsyncSession, permission_name: str) -> Optional[Permission]:
        self._logger.trace(f"ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸: '{permission_name}'")
        stmt = select(Permission).where(Permission.name == permission_name)
        result = await session.execute(stmt)
        perm = result.scalars().first()
        self._logger.trace(
            f"Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾: {perm is not None} (ID: {getattr(perm, 'id', 'N/A')})"
        )
        return perm

    async def get_or_create_permission(
        self, session: AsyncSession, permission_name: str, description: Optional[str] = None
    ) -> Optional[Permission]:
        permission = await self._get_permission_by_name(session, permission_name)
        if not permission:
            perm_def_desc = DEFAULT_CORE_PERMISSIONS_DEFINITIONS.get(permission_name)
            current_description = description if description is not None else perm_def_desc

            if current_description is not None:
                self._logger.info(
                    f"Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾, Ğ±ÑƒĞ´ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ Ñ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼: '{current_description}'."
                )
                permission = Permission(name=permission_name, description=current_description)
                session.add(permission)
                try:
                    await session.flush([permission])
                    self._logger.success(f"Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ (Ñflushed) Ñ ID: {permission.id}")
                except Exception as e_flush_perm:
                    self._logger.error(
                        f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ flush Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ '{permission_name}': {e_flush_perm}", exc_info=True
                    )
                    return None
            else:
                self._logger.warning(
                    f"Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ¸ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ½Ğµ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¾. ĞĞµ Ğ±ÑƒĞ´ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸."
                )
                return None
        return permission

    async def assign_permission_to_role(
        self,
        session: AsyncSession,
        role: Role,
        permission_name: str,
        auto_create_perm: bool = True,
    ) -> bool:
        if not role or role.id is None:
            self._logger.error(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ: Ğ Ğ¾Ğ»ÑŒ Ğ½Ğµ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ° Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ ID (role: {role}).")
            return False

        permission_obj: Optional[Permission] = None
        if auto_create_perm:
            permission_obj = await self.get_or_create_permission(session, permission_name, description=None)
        else:
            permission_obj = await self._get_permission_by_name(session, permission_name)

        if not permission_obj or permission_obj.id is None:
            log_msg = (
                f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ"
                + (" Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ" if auto_create_perm else "")
                + f" Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' (ID: {getattr(permission_obj, 'id', 'N/A')}) Ğ´Ğ»Ñ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}'."
            )
            self._logger.error(log_msg)
            return False

        self._logger.debug(
            f"[ASSIGN_PERM_TO_ROLE] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°/Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ ÑĞ²ÑĞ·Ğ¸ Ğ´Ğ»Ñ RoleID: {role.id}, PermID: {permission_obj.id}"
        )

        if await self._ensure_role_has_permission_link(session, role.id, permission_obj.id):
            try:
                new_role_perm_link = RolePermission(role_id=role.id, permission_id=permission_obj.id)
                session.add(new_role_perm_link)
                self._logger.info(
                    f"Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' (PermID: {permission_obj.id}) Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}' (RoleID: {role.id}) (Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµÑ‚ commit)."
                )
                return True
            except Exception as e_add_link:
                self._logger.error(
                    f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ° RolePermission Ğ´Ğ»Ñ RoleID {role.id}, PermID {permission_obj.id}: {e_add_link}",
                    exc_info=True,
                )
                return False
        else:
            link_exists_stmt = (
                select(RolePermission.id)
                .where(RolePermission.role_id == role.id, RolePermission.permission_id == permission_obj.id)
                .limit(1)
            )
            existing_link_res = await session.execute(link_exists_stmt)
            if existing_link_res.scalar_one_or_none() is not None:
                self._logger.trace(f"Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' ÑƒĞ¶Ğµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¾ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}' (Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¾).")
                return True
            else:
                self._logger.error(
                    f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞ²ÑĞ·ÑŒ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ '{permission_name}' Ğ¸ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}'. "
                    "Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² _ensure_role_has_permission_link Ğ¸Ğ»Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ."
                )
                return False

    async def remove_permission_from_role(self, session: AsyncSession, role: Role, permission_name: str) -> bool:
        if not role or role.id is None:
            return False
        permission_to_remove = await self._get_permission_by_name(session, permission_name)
        if not permission_to_remove or permission_to_remove.id is None:
            self._logger.warning(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑĞ½ÑÑ‚ÑŒ Ğ½ĞµÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ñ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}'.")
            return True

        try:
            stmt_delete = delete(RolePermission).where(
                RolePermission.role_id == role.id, RolePermission.permission_id == permission_to_remove.id
            )
            result = await session.execute(stmt_delete)
            if result.rowcount > 0:
                self._logger.info(f"Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' ÑĞ½ÑÑ‚Ğ¾ Ñ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}' (Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµÑ‚ commit).")
                return True
            else:
                self._logger.debug(
                    f"Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¾ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}'. Ğ¡Ğ½ÑÑ‚Ğ¸Ğµ Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ."
                )
                return True
        except Exception as e_remove_perm:
            self._logger.error(
                f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ½ÑÑ‚Ğ¸Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ '{permission_name}' Ñ Ñ€Ğ¾Ğ»Ğ¸ '{role.name}': {e_remove_perm}", exc_info=True
            )
            return False

    async def user_has_permission(self, session: AsyncSession, user_telegram_id: int, permission_name: str) -> bool:
        # 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° Ğ¸Ğ· .env (Ğ²Ñ‹ÑÑˆĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚)
        if self._services_provider_ref and self._services_provider_ref.config:
            if user_telegram_id in self._services_provider_ref.config.core.super_admins:
                self._logger.trace(
                    f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID {user_telegram_id} ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†ĞµĞ¼ Ğ¸Ğ· .env, Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¾."
                )
                return True

        # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ñ ĞµĞ³Ğ¾ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸ Ğ¸ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸
        stmt = (
            select(User)
            .options(
                selectinload(User.roles).selectinload(Role.permissions),  # Ğ Ğ¾Ğ»Ğ¸ Ğ¸ Ğ¸Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ
                selectinload(User.direct_permissions),  # ĞŸÑ€ÑĞ¼Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
            )
            .where(User.telegram_id == user_telegram_id)
        )
        result = await session.execute(stmt)
        user_db: Optional[User] = result.scalars().first()

        if not user_db:
            self._logger.trace(
                f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID {user_telegram_id} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ '{permission_name}'."
            )
            return False
        
        # 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ñ€Ğ¾Ğ»ÑŒ SuperAdmin (Ğ½ĞµĞ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸)
        if user_db.roles:
            for role_obj in user_db.roles:
                if role_obj.name == DEFAULT_ROLE_SUPER_ADMIN:
                    self._logger.trace(
                        f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID {user_telegram_id} Ğ¸Ğ¼ĞµĞµÑ‚ Ñ€Ğ¾Ğ»ÑŒ 'SuperAdmin', Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ (Ğ½ĞµĞ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸)."
                    )
                    return True

        perm_name_lower = permission_name.lower()

        # 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        if user_db.direct_permissions:
            for perm_obj in user_db.direct_permissions:
                if perm_obj.name.lower() == perm_name_lower:
                    self._logger.trace(
                        f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID {user_telegram_id} Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}'."
                    )
                    return True

        # 4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ñ‡ĞµÑ€ĞµĞ· Ñ€Ğ¾Ğ»Ğ¸
        if not user_db.roles:
            self._logger.trace(
                f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID {user_telegram_id} Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ '{permission_name}'."
            )
            # (Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ğ¿Ñ€Ğ°Ğ² Ğ¸ Ğ½ĞµÑ‚ Ñ€Ğ¾Ğ»ĞµĞ¹, Ñ‚Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ½ĞµÑ‚)
            # return False # Ğ­Ñ‚Ğ¾ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğµ ÑƒĞ¶Ğµ Ğ¿Ğ¾ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¼ return False
        else:  # Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ñ€Ğ¾Ğ»Ğ¸, Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¸Ñ…
            for role_obj in user_db.roles:
                if role_obj.permissions:
                    for perm_obj in role_obj.permissions:
                        if perm_obj.name.lower() == perm_name_lower:
                            self._logger.trace(
                                f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID {user_telegram_id} Ğ¸Ğ¼ĞµĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ñ‡ĞµÑ€ĞµĞ· Ñ€Ğ¾Ğ»ÑŒ '{role_obj.name}'."
                            )
                            return True

        self._logger.trace(
            f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ TG ID {user_telegram_id} ĞĞ• Ğ¸Ğ¼ĞµĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ '{permission_name}' (Ğ½Ğ¸ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ³Ğ¾, Ğ½Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Ñ€Ğ¾Ğ»Ğ¸)."
        )
        return False

    async def get_all_permissions(self, session: AsyncSession) -> List[Permission]:
        stmt = select(Permission).order_by(Permission.name)
        result = await session.execute(stmt)
        permissions = list(result.scalars().all())
        self._logger.debug(f"Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹. ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾: {len(permissions)}.")
        return permissions

    async def get_role_permissions(self, session: AsyncSession, role_name: str) -> List[Permission]:
        stmt = select(Role).options(selectinload(Role.permissions)).where(Role.name == role_name)
        result = await session.execute(stmt)
        role_with_perms: Optional[Role] = result.scalars().first()

        if not role_with_perms:
            self._logger.warning(f"Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½Ñ‹ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ½ĞµÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ¹ Ñ€Ğ¾Ğ»Ğ¸ '{role_name}'.")
            return []

        return list(role_with_perms.permissions) if role_with_perms.permissions else []

    # --- ĞĞ¾Ğ²Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ---

    async def assign_direct_permission_to_user(
        self,
        session: AsyncSession,
        user: User,
        permission_name: str,
        auto_create_perm: bool = True,  # ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ ÑƒĞ¶Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ
    ) -> bool:
        if not user or user.id is None:
            self._logger.error(
                f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ²Ğ°Ğ»Ğ¸Ğ´ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ ID (user: {user})."
            )
            return False

        permission_obj: Optional[Permission]
        if auto_create_perm:  # Ğ­Ñ‚Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ² Ğ¸Ğ»Ğ¸ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… ÑĞ»ÑƒÑ‡Ğ°ĞµĞ²
            permission_obj = await self.get_or_create_permission(session, permission_name)
        else:
            permission_obj = await self._get_permission_by_name(session, permission_name)

        if not permission_obj or permission_obj.id is None:
            log_msg = (
                f"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ"
                + (" Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ" if auto_create_perm else "")
                + f" Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ğ´Ğ»Ñ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ³Ğ¾ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.telegram_id}."
            )
            self._logger.error(log_msg)
            return False

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ½ĞµÑ‚ Ğ»Ğ¸ ÑƒĞ¶Ğµ Ñ‚Ğ°ĞºĞ¾Ğ¹ ÑĞ²ÑĞ·Ğ¸
        existing_link_stmt = (
            select(UserPermission.id)
            .where(UserPermission.user_id == user.id, UserPermission.permission_id == permission_obj.id)
            .limit(1)
        )
        existing_link_res = await session.execute(existing_link_stmt)
        if existing_link_res.scalar_one_or_none() is not None:
            self._logger.debug(f"ĞŸÑ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' ÑƒĞ¶Ğµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.telegram_id}.")
            return True  # Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¼, ĞµÑĞ»Ğ¸ ÑƒĞ¶Ğµ ĞµÑÑ‚ÑŒ

        # Ğ•ÑĞ»Ğ¸ Ğ¼Ñ‹ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‡ĞµÑ€ĞµĞ· user.direct_permissions.append()
        # user.direct_permissions.append(permission_obj)
        # session.add(user)
        # Ğ˜Ğ›Ğ˜, ĞµÑĞ»Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ²ÑĞ·ÑƒÑÑ‰ĞµĞ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†ĞµĞ¹ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ:
        new_user_perm_link = UserPermission(user_id=user.id, permission_id=permission_obj.id)
        session.add(new_user_perm_link)

        self._logger.info(
            f"ĞŸÑ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.telegram_id} (Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµÑ‚ commit)."
        )
        return True

    async def remove_direct_permission_from_user(self, session: AsyncSession, user: User, permission_name: str) -> bool:
        if not user or user.id is None:
            self._logger.error("ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑĞ½ÑÑ‚ÑŒ Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ñ Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.")
            return False

        permission_to_remove = await self._get_permission_by_name(session, permission_name)
        if not permission_to_remove or permission_to_remove.id is None:
            self._logger.warning(
                f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑĞ½ÑÑ‚ÑŒ Ğ½ĞµÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞµ Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.telegram_id}."
            )
            return True  # Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¼, Ñ‚Ğ°Ğº ĞºĞ°Ğº ĞµĞ³Ğ¾ Ğ¸ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾

        # Ğ•ÑĞ»Ğ¸ Ğ¼Ñ‹ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‡ĞµÑ€ĞµĞ· user.direct_permissions.remove()
        # if permission_to_remove in user.direct_permissions: # ĞÑƒĞ¶Ğ½Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° user.direct_permissions
        #     user.direct_permissions.remove(permission_to_remove)
        #     session.add(user)
        #     self._logger.info(f"ĞŸÑ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' ÑĞ½ÑÑ‚Ğ¾ Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.telegram_id} (Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµÑ‚ commit).")
        #     return True
        # else:
        #     self._logger.debug(f"ĞŸÑ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.telegram_id}. Ğ¡Ğ½ÑÑ‚Ğ¸Ğµ Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ.")
        #     return True
        # Ğ˜Ğ›Ğ˜, ĞµÑĞ»Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ²ÑĞ·ÑƒÑÑ‰ĞµĞ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†ĞµĞ¹ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ:
        stmt_delete = delete(UserPermission).where(
            UserPermission.user_id == user.id, UserPermission.permission_id == permission_to_remove.id
        )
        result = await session.execute(stmt_delete)
        if result.rowcount > 0:
            self._logger.info(
                f"ĞŸÑ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' ÑĞ½ÑÑ‚Ğ¾ Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.telegram_id} (Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµÑ‚ commit)."
            )
            return True
        else:
            self._logger.debug(
                f"ĞŸÑ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user.telegram_id}. Ğ¡Ğ½ÑÑ‚Ğ¸Ğµ Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ."
            )
            return True

    async def get_user_direct_permissions(self, session: AsyncSession, user_id: int) -> List[Permission]:
        """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ¿Ğ¾ ĞµĞ³Ğ¾ DB ID)."""
        user_db = await session.get(User, user_id, options=[selectinload(User.direct_permissions)])
        if not user_db:
            self._logger.warning(f"Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½Ñ‹ Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ½ĞµÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (DB ID: {user_id}).")
            return []
        return list(user_db.direct_permissions) if user_db.direct_permissions else []



======================================================================

------------------------------ FILE: Systems/core/rbac/__init__.py ------------------------------



======================================================================

------------------------------ FILE: Systems/core/events/dispatcher.py ------------------------------
# core/events/dispatcher.py

import asyncio
from collections import defaultdict
from typing import Callable, Any, Coroutine, List, Dict, Optional, Union, TYPE_CHECKING # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ» Optional, Union
from loguru import logger

if TYPE_CHECKING:
    # Ğ‘Ğ¾Ğ»ĞµĞµ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ, ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾.
    # EventHandler = Callable[..., Coroutine[Any, Any, None]]
    pass


class EventDispatcher:
    """
    ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ ÑˆĞ¸Ğ½Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ´Ğ»Ñ SwiftDevBot.
    ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¼ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ (ÑĞ´Ñ€Ñƒ, Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼) Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
    Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ½Ğ° Ğ½Ğ¸Ñ…, Ğ½Ğµ Ğ¸Ğ¼ĞµÑ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ´Ñ€ÑƒĞ³ Ğ¾Ñ‚ Ğ´Ñ€ÑƒĞ³Ğ°.
    """

    def __init__(self):
        # Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ, Ğ³Ğ´Ğµ ĞºĞ»ÑÑ‡ - ÑÑ‚Ñ€Ğ¾ĞºĞ¾Ğ²Ğ¾Ğµ Ğ¸Ğ¼Ñ (Ñ‚Ğ¸Ğ¿) ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ,
        # Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ - ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹-Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ² (ĞºĞ¾Ñ€ÑƒÑ‚Ğ¸Ğ½).
        self._listeners: Dict[str, List[Callable[..., Coroutine[Any, Any, None]]]] = defaultdict(list)
        self._logger = logger.bind(service="EventDispatcher")
        self._logger.info("EventDispatcher Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")

    def subscribe(self, event_type: str, handler: Callable[..., Coroutine[Any, Any, None]]) -> None:
        """
        ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ½Ğ° ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ.

        Args:
            event_type: Ğ˜Ğ¼Ñ (Ñ‚Ğ¸Ğ¿) ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ, Ğ½Ğ° ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğµ Ğ¾ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°.
                        Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑÑ‹ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "sdb:core:startup", "module_name:user_registered").
            handler: ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ-Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº (ĞºĞ¾Ñ€ÑƒÑ‚Ğ¸Ğ½Ğ°), ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ½Ğ° Ğ¿Ñ€Ğ¸ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ.
                     ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ Ñ‚Ğµ Ğ¶Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ (*args) Ğ¸ Ğ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ (**kwargs) Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹,
                     Ñ‡Ñ‚Ğ¾ Ğ¸ Ğ¿ĞµÑ€ĞµĞ´Ğ°ÑÑ‚ÑÑ Ğ² Ğ¼ĞµÑ‚Ğ¾Ğ´ publish().

        Raises:
            TypeError: Ğ•ÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ½Ğµ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸ĞµĞ¹ (ĞºĞ¾Ñ€ÑƒÑ‚Ğ¸Ğ½Ğ¾Ğ¹).
        """
        if not asyncio.iscoroutinefunction(handler):
            err_msg = (f"ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº '{handler.__qualname__}' Ğ´Ğ»Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ '{event_type}' Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ "
                       f"Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸ĞµĞ¹ (Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ½Ğ¾Ğ¹ Ñ 'async def').")
            self._logger.error(err_msg)
            raise TypeError(err_msg) # Ğ”ĞµĞ»Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ ÑÑ‚Ñ€Ğ¾Ğ¶Ğµ

        self._listeners[event_type].append(handler)
        self._logger.debug(f"ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº '{handler.__qualname__}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½ Ğ½Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ '{event_type}'.")

    def unsubscribe(self, event_type: str, handler: Callable[..., Coroutine[Any, Any, None]]) -> None:
        """
        ĞÑ‚Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ¾Ñ‚ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ.

        Args:
            event_type: Ğ˜Ğ¼Ñ (Ñ‚Ğ¸Ğ¿) ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ.
            handler: Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ-Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº, ĞºĞ¾Ñ‚Ğ¾Ñ€ÑƒÑ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ğ¾Ñ‚Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ.
        """
        try:
            self._listeners[event_type].remove(handler)
            self._logger.debug(f"ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº '{handler.__qualname__}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ñ‚Ğ¿Ğ¸ÑĞ°Ğ½ Ğ¾Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ '{event_type}'.")
        except ValueError: # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² ÑĞ¿Ğ¸ÑĞºĞµ Ğ´Ğ»Ñ Ğ´Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
            self._logger.warning(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¾Ñ‚Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ½ĞµĞ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº '{handler.__qualname__}' "
                                 f"Ğ¾Ñ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ '{event_type}'. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.")
        except KeyError: # Ğ¢Ğ°ĞºĞ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ²Ğ¾Ğ¾Ğ±Ñ‰Ğµ Ğ½ĞµÑ‚ Ğ² _listeners
            self._logger.warning(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¾Ñ‚Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑ Ğ¾Ñ‚ Ğ½ĞµÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ '{event_type}'.")

    async def publish(self, event_type: str, *args: Any, **kwargs: Any) -> List[Union[Any, Exception]]:
        """
        ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºÑƒĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ, Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°Ñ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğ° Ğ½ĞµĞ³Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ².

        ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ÑÑ‚ÑÑ ĞºĞ¾Ğ½ĞºÑƒÑ€ĞµĞ½Ñ‚Ğ½Ğ¾ Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ `asyncio.gather()`.
        Ğ•ÑĞ»Ğ¸ ĞºĞ°ĞºĞ¾Ğ¹-Ğ»Ğ¸Ğ±Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ, ÑÑ‚Ğ¾ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ğ½Ğ¾,
        Ğ·Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾, Ğ¸ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ° ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ° Ğ² Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼Ğ¾Ğ¼ ÑĞ¿Ğ¸ÑĞºĞµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ.
        ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑ‚ÑŒÑÑ.

        Args:
            event_type: Ğ˜Ğ¼Ñ (Ñ‚Ğ¸Ğ¿) Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºÑƒĞµĞ¼Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ.
            *args: ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ½Ñ‹ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼Ñƒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºÑƒ.
            **kwargs: Ğ˜Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ½Ñ‹ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼Ñƒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºÑƒ.

        Returns:
            Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°.
            Ğ•ÑĞ»Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ²ĞµÑ€Ğ½ÑƒĞ» Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ, Ğ¾Ğ½Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ğ² ÑĞ¿Ğ¸ÑĞºĞµ.
            Ğ•ÑĞ»Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ» Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ, Ğ² ÑĞ¿Ğ¸ÑĞºĞµ Ğ½Ğ° ĞµĞ³Ğ¾ Ğ¼ĞµÑÑ‚Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¾Ğ±ÑŠĞµĞºÑ‚ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ.
            Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ² Ğ½Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ½ĞµÑ‚, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ÑÑ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº.
        """
        if event_type not in self._listeners or not self._listeners[event_type]:
            self._logger.trace(f"ĞĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ² Ğ´Ğ»Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ '{event_type}'. ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ°.")
            return []

        handlers_to_call = self._listeners[event_type]
        # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ ÑÑ‚Ñ€Ğ¾ĞºÑƒ Ñ Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ°, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        args_repr = f"{len(args)} positional"
        kwargs_repr = f"{len(kwargs)} keyword"
        
        self._logger.info(f"ĞŸÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ '{event_type}' Ğ´Ğ»Ñ {len(handlers_to_call)} Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ². "
                          f"ĞÑ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹: ({args_repr}), ({kwargs_repr}).")

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ñ€ÑƒÑ‚Ğ¸Ğ½ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ°
        tasks = [handler(*args, **kwargs) for handler in handlers_to_call]
        
        # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ²ÑĞµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ ĞºĞ¾Ğ½ĞºÑƒÑ€ĞµĞ½Ñ‚Ğ½Ğ¾ Ğ¸ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¸Ğ»Ğ¸ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
        results: List[Union[Any, Exception]] = await asyncio.gather(*tasks, return_exceptions=True)

        # Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸, ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ¸ Ğ² Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°Ñ…
        for i, result_or_exc in enumerate(results):
            if isinstance(result_or_exc, Exception):
                failed_handler_name = handlers_to_call[i].__qualname__
                self._logger.error(
                    f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ '{failed_handler_name}' Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ '{event_type}': "
                    f"{type(result_or_exc).__name__}('{result_or_exc}')",
                    exc_info=result_or_exc # Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ñ€ĞµĞ¹ÑĞ±ĞµĞºĞ° Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
                )
        
        return results

    def get_listeners_count(self, event_type: Optional[str] = None) -> Union[int, Dict[str, int]]:
        """
        Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ².
        Ğ•ÑĞ»Ğ¸ `event_type` ÑƒĞºĞ°Ğ·Ğ°Ğ½, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ.
        Ğ•ÑĞ»Ğ¸ `event_type` Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½ (None), Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ {event_type: count} Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹.
        """
        if event_type:
            return len(self._listeners.get(event_type, []))
        else:
            return {etype: len(handler_list) for etype, handler_list in self._listeners.items() if handler_list}

    async def dispose(self) -> None: # Ğ¡Ğ´ĞµĞ»Ğ°ĞµĞ¼ async, ĞµÑĞ»Ğ¸ Ğ² Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¼ Ğ¿Ğ¾Ğ½Ğ°Ğ´Ğ¾Ğ±Ğ¸Ñ‚ÑÑ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ°
        """ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ². ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ğ¾ Ğ¿Ñ€Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹."""
        self._listeners.clear()
        self._logger.info("EventDispatcher Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½ (Ğ²ÑĞµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¸ Ğ¸ ÑĞ¿Ğ¸ÑĞºĞ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹).")


======================================================================

------------------------------ FILE: Systems/core/events/__init__.py ------------------------------



======================================================================

------------------------------ FILE: Systems/core/sys_modules/__init__.py ------------------------------
# core/sys_modules/__init__.py
# Ğ­Ñ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ» Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ 'sys_modules' Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ¼ Python.
# Ğ¡ÑĞ´Ğ° Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ğ¾Ğ¼ĞµÑ‰Ğ°Ñ‚ÑŒ Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ ÑĞ´Ñ€Ğ°.

# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€, ĞµÑĞ»Ğ¸ Ğ±Ñ‹ Ğ·Ğ´ĞµÑÑŒ Ğ±Ñ‹Ğ» Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ 'internal_logger_viewer':
# from .internal_logger_viewer import setup_module as setup_logger_viewer_module
# from .internal_logger_viewer.handlers import logger_viewer_router

# __all__ = ["setup_logger_viewer_module", "logger_viewer_router"]


======================================================================

------------------------------ FILE: Systems/core/cache/strategies.py ------------------------------
# core/cache/strategies.py
"""
Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ Ğ¸Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ĞºÑÑˆĞ°
"""

import asyncio
from typing import Optional, Callable, Any, Dict, List
from datetime import datetime, timedelta
from loguru import logger

from typing import TYPE_CHECKING
if TYPE_CHECKING:
    from Systems.core.services_provider import BotServicesProvider


class CacheStrategy:
    """Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"""
    
    def __init__(self, ttl: int = 300):
        self.ttl = ttl
        self._logger = logger.bind(service="CacheStrategy")
    
    def get_key(self, prefix: str, *args, **kwargs) -> str:
        """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ»ÑÑ‡ ĞºÑÑˆĞ°"""
        parts = [prefix]
        if args:
            parts.extend(str(arg) for arg in args)
        if kwargs:
            parts.extend(f"{k}={v}" for k, v in sorted(kwargs.items()))
        return ":".join(parts)
    
    async def get_or_set(
        self,
        cache_manager,
        key: str,
        func: Callable,
        *args,
        ttl: Optional[int] = None,
        **kwargs
    ) -> Any:
        """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ· ĞºÑÑˆĞ° Ğ¸Ğ»Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ"""
        raise NotImplementedError


class DefaultCacheStrategy(CacheStrategy):
    """Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"""
    
    async def get_or_set(
        self,
        cache_manager,
        key: str,
        func: Callable,
        *args,
        ttl: Optional[int] = None,
        **kwargs
    ) -> Any:
        """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ· ĞºÑÑˆĞ° Ğ¸Ğ»Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ"""
        # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ· ĞºÑÑˆĞ°
        cached_value = await cache_manager.get(key)
        if cached_value is not None:
            self._logger.debug(f"Cache hit: {key}")
            return cached_value
        
        # ĞšÑÑˆ Ğ¿Ñ€Ğ¾Ğ¼Ğ°Ñ…, Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ
        self._logger.debug(f"Cache miss: {key}")
        if asyncio.iscoroutinefunction(func):
            value = await func(*args, **kwargs)
        else:
            value = func(*args, **kwargs)
        
        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² ĞºÑÑˆ
        await cache_manager.set(key, value, ttl=ttl or self.ttl)
        return value


class WriteThroughCacheStrategy(CacheStrategy):
    """Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ Write-Through: Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² ĞºÑÑˆ Ğ¸ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾"""
    
    async def get_or_set(
        self,
        cache_manager,
        key: str,
        func: Callable,
        *args,
        ttl: Optional[int] = None,
        **kwargs
    ) -> Any:
        """Write-through ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ"""
        # Ğ’ÑĞµĞ³Ğ´Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ
        if asyncio.iscoroutinefunction(func):
            value = await func(*args, **kwargs)
        else:
            value = func(*args, **kwargs)
        
        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² ĞºÑÑˆ
        await cache_manager.set(key, value, ttl=ttl or self.ttl)
        return value


class CacheInvalidator:
    """ĞšĞ»Ğ°ÑÑ Ğ´Ğ»Ñ Ğ¸Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ ĞºÑÑˆĞ°"""
    
    def __init__(self, cache_manager):
        self.cache_manager = cache_manager
        self._logger = logger.bind(service="CacheInvalidator")
        # Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€ ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ¿Ğ¾ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ°Ğ¼
        self._patterns: Dict[str, List[str]] = {}
    
    async def invalidate(self, key: str):
        """Ğ˜Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡"""
        await self.cache_manager.delete(key)
        self._logger.debug(f"Cache invalidated: {key}")
    
    async def invalidate_pattern(self, pattern: str):
        """Ğ˜Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑĞµ ĞºĞ»ÑÑ‡Ğ¸ Ğ¿Ğ¾ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ"""
        # ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ - Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ Redis SCAN
        if hasattr(self.cache_manager, 'delete_pattern'):
            await self.cache_manager.delete_pattern(pattern)
        else:
            self._logger.warning(f"Pattern invalidation not supported for {type(self.cache_manager)}")
    
    async def invalidate_by_prefix(self, prefix: str):
        """Ğ˜Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑĞµ ĞºĞ»ÑÑ‡Ğ¸ Ñ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ¾Ğ¼"""
        await self.invalidate_pattern(f"{prefix}*")
    
    def register_pattern(self, name: str, pattern: str):
        """Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ´Ğ»Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¾Ğ²Ğ¾Ğ¹ Ğ¸Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸"""
        if name not in self._patterns:
            self._patterns[name] = []
        self._patterns[name].append(pattern)
    
    async def invalidate_by_registered_pattern(self, name: str):
        """Ğ˜Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¼Ñƒ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ"""
        if name in self._patterns:
            for pattern in self._patterns[name]:
                await self.invalidate_pattern(pattern)


class CacheTagManager:
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞ³Ğ°Ğ¼Ğ¸ ĞºÑÑˆĞ° Ğ´Ğ»Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¾Ğ²Ğ¾Ğ¹ Ğ¸Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸"""
    
    def __init__(self, cache_manager):
        self.cache_manager = cache_manager
        self._logger = logger.bind(service="CacheTagManager")
        # ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ñ‚ĞµĞ³Ğ¾Ğ² Ğ½Ğ° ĞºĞ»ÑÑ‡Ğ¸: {tag: [key1, key2, ...]}
        self._tag_to_keys: Dict[str, List[str]] = {}
        # ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ½Ğ° Ñ‚ĞµĞ³Ğ¸: {key: [tag1, tag2, ...]}
        self._key_to_tags: Dict[str, List[str]] = {}
    
    async def tag_key(self, key: str, *tags: str):
        """Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞ³Ğ¸ Ğº ĞºĞ»ÑÑ‡Ñƒ"""
        if key not in self._key_to_tags:
            self._key_to_tags[key] = []
        
        for tag in tags:
            if tag not in self._tag_to_keys:
                self._tag_to_keys[tag] = []
            if key not in self._tag_to_keys[tag]:
                self._tag_to_keys[tag].append(key)
            if tag not in self._key_to_tags[key]:
                self._key_to_tags[key].append(tag)
    
    async def invalidate_by_tag(self, tag: str):
        """Ğ˜Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑĞµ ĞºĞ»ÑÑ‡Ğ¸ Ñ Ñ‚ĞµĞ³Ğ¾Ğ¼"""
        if tag in self._tag_to_keys:
            for key in self._tag_to_keys[tag]:
                await self.cache_manager.delete(key)
                # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ñ‚ĞµĞ³ Ğ¸Ğ· Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğ°
                if key in self._key_to_tags:
                    self._key_to_tags[key].remove(tag)
            del self._tag_to_keys[tag]
            self._logger.info(f"Invalidated {len(self._tag_to_keys[tag])} keys by tag: {tag}")
    
    async def invalidate_by_tags(self, *tags: str):
        """Ğ˜Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ğ¼ Ñ‚ĞµĞ³Ğ°Ğ¼"""
        for tag in tags:
            await self.invalidate_by_tag(tag)




======================================================================

------------------------------ FILE: Systems/core/cache/manager.py ------------------------------
# core/cache/manager.py

import asyncio
import json
import time
from typing import Optional, Any, Union, TYPE_CHECKING
from abc import ABC, abstractmethod

# Ğ£ÑĞ»Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ Ğ´Ğ»Ñ Redis Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¹ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹
# Ğ£ÑĞ»Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ Ğ´Ğ»Ñ Redis Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¹ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹
try:
    import redis.asyncio as redis_async
    REDIS_PY_AVAILABLE = True
except ImportError:
    redis_async = None # type: ignore
    REDIS_PY_AVAILABLE = False

if TYPE_CHECKING:
    from redis.asyncio.client import Redis as AsyncRedisClient
    from redis.exceptions import RedisError, ConnectionError as RedisConnectionError, TimeoutError as RedisTimeoutError
else:
    if REDIS_PY_AVAILABLE:
        from redis.asyncio.client import Redis as AsyncRedisClient
        from redis.exceptions import RedisError, ConnectionError as RedisConnectionError, TimeoutError as RedisTimeoutError
    else:
        AsyncRedisClient = Any # type: ignore
        RedisError = Exception # type: ignore
        RedisConnectionError = Exception # type: ignore
        RedisTimeoutError = asyncio.TimeoutError # Ğ¤Ğ¾Ğ»Ğ»Ğ±ÑĞº Ğ½Ğ° asyncio.TimeoutError

# Ğ£ÑĞ»Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ Ğ´Ğ»Ñ cachetools
try:
    from cachetools import TTLCache
    CACHETOOLS_AVAILABLE = True
except ImportError:
    TTLCache = dict # type: ignore
    CACHETOOLS_AVAILABLE = False

from loguru import logger

if TYPE_CHECKING:
    from Systems.core.app_settings import CacheSettings

class BaseCache(ABC):
    @abstractmethod
    async def initialize(self) -> None: pass
    @abstractmethod
    async def dispose(self) -> None: pass
    @abstractmethod
    async def get(self, key: str) -> Optional[Any]: raise NotImplementedError
    @abstractmethod
    async def set(self, key: str, value: Any, ttl_seconds: Optional[int] = None) -> None: raise NotImplementedError
    @abstractmethod
    async def delete(self, key: str) -> bool: raise NotImplementedError
    @abstractmethod
    async def exists(self, key: str) -> bool: raise NotImplementedError
    @abstractmethod
    async def clear(self) -> None: raise NotImplementedError

class MemoryCache(BaseCache):
    def __init__(self, maxsize: int = 1024, default_ttl: int = 300):
        self._default_ttl = default_ttl
        if CACHETOOLS_AVAILABLE and TTLCache:
            self._cache: Union[Any, dict] = TTLCache(maxsize=maxsize, ttl=default_ttl)  # type: ignore
            self._uses_cachetools = True
        else:
            logger.warning("Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° 'cachetools' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ°Ñ Ñ€ÑƒÑ‡Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ MemoryCache Ñ TTL.")
            self._cache = {} 
            self._maxsize = maxsize
            self._uses_cachetools = False
        logger.info(f"MemoryCache Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ cachetools: {self._uses_cachetools}, default TTL: {default_ttl}s).")

    async def initialize(self) -> None: logger.debug("MemoryCache.initialize() - Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ.")
    async def dispose(self) -> None: await self.clear(); logger.debug("MemoryCache.dispose() - ĞºÑÑˆ Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½.")

    async def get(self, key: str) -> Optional[Any]:
        if self._uses_cachetools and isinstance(self._cache, TTLCache):
            try: return self._cache[key]
            except KeyError: return None
        elif isinstance(self._cache, dict):
            item = self._cache.get(key)
            if item:
                value, expiry_timestamp = item
                if time.time() < expiry_timestamp: return value
                else: 
                    # Ğ¯Ğ²Ğ½Ğ¾ ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾ÑÑ€Ğ¾Ñ‡ĞµĞ½Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
                    await self.delete(key) 
            return None
        return None

    async def set(self, key: str, value: Any, ttl_seconds: Optional[int] = None) -> None:
        effective_ttl = ttl_seconds if ttl_seconds is not None else self._default_ttl
        if self._uses_cachetools and isinstance(self._cache, TTLCache):
            if ttl_seconds is not None and ttl_seconds != self._cache.ttl: # type: ignore
                 # TTLCache Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ TTL, Ğ½Ğ¾ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸ÑÑ‚ĞµÑ‡ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾, ĞµÑĞ»Ğ¸ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ½ÑƒĞ¶Ğ½Ğ¾.
                 # ĞŸĞ¾ĞºĞ° Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ - Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ TTL.
                 logger.trace(f"MemoryCache (TTLCache) Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ TTL ({self._cache.ttl} ÑĞµĞº) Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ĞºĞ»ÑÑ‡ĞµĞ¹.") # type: ignore
            self._cache[key] = value
        elif isinstance(self._cache, dict):
            if len(self._cache) >= self._maxsize and key not in self._cache:
                # ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ LRU-Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°: ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ ÑĞ°Ğ¼Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ (Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹)
                # Ğ­Ñ‚Ğ¾ Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰Ğ¸Ğ¹ LRU, Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ÑĞ¾Ğ¹Ğ´ĞµÑ‚.
                try:
                    oldest_key = next(iter(self._cache))
                    del self._cache[oldest_key]
                    logger.trace(f"MemoryCache Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³ maxsize, ÑƒĞ´Ğ°Ğ»ĞµĞ½ ĞºĞ»ÑÑ‡ (FIFO-like): {oldest_key}")
                except StopIteration: pass # ĞŸÑƒÑÑ‚Ğ¾Ğ¹ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ
            self._cache[key] = (value, time.time() + effective_ttl)

    async def delete(self, key: str) -> bool:
        if key in self._cache: 
            del self._cache[key]
            return True
        return False

    async def exists(self, key: str) -> bool: 
        # Ğ”Ğ»Ñ TTLCache Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ TTL
        # Ğ”Ğ»Ñ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ get() Ñ‚Ğ°ĞºĞ¶Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ TTL
        return await self.get(key) is not None

    async def clear(self) -> None: 
        self._cache.clear()
        logger.info("MemoryCache Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½.")


class RedisCache(BaseCache):
    def __init__(self, redis_url: str):
        if not REDIS_PY_AVAILABLE:
            msg = "Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° 'redis' (Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹ asyncio) Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°. `pip install redis`. RedisCache Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ."
            logger.critical(msg)
            raise ImportError(msg)
        self.redis_url = redis_url
        self._redis_client: Optional[Any] = None  # type: ignore
        logger.info(f"RedisCache Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ´Ğ»Ñ URL: {self.redis_url} (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ redis.asyncio)")

    async def initialize(self) -> None:
        logger.debug(f"RedisCache: ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ URL: {self.redis_url}")
        if not redis_async:
            logger.critical("RedisCache.initialize: redis.asyncio Ğ½Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!")
            raise ImportError("redis.asyncio Ğ½Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½")

        try:
            logger.debug(f"RedisCache: Ğ’Ñ‹Ğ·Ğ¾Ğ² redis.asyncio.from_url('{self.redis_url}')")
            self._redis_client = redis_async.from_url(  # type: ignore
                self.redis_url, 
                decode_responses=False, # Ğ’Ğ°Ğ¶Ğ½Ğ¾ Ğ´Ğ»Ñ pickle
                socket_timeout=5,
                socket_connect_timeout=5,
                # health_check_interval=30 # ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾
            )
            logger.debug(f"RedisCache: redis.asyncio.from_url Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½. ĞšĞ»Ğ¸ĞµĞ½Ñ‚: {type(self._redis_client)}")
            
            if self._redis_client:
                logger.debug("RedisCache: ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° PING...")
                await self._redis_client.ping()
                logger.success(f"Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸ PING Ğº Redis: {self.redis_url}")
            else:
                # Ğ­Ñ‚Ğ° Ğ²ĞµÑ‚ĞºĞ° Ğ¼Ğ°Ğ»Ğ¾Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ°, Ñ‚Ğ°Ğº ĞºĞ°Ğº from_url Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ»Ğ¸Ğ±Ğ¾ Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚, Ğ»Ğ¸Ğ±Ğ¾ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞºĞ»Ğ¸ĞµĞ½Ñ‚
                logger.error(f"RedisCache: redis.asyncio.from_url Ğ²ĞµÑ€Ğ½ÑƒĞ» None Ğ´Ğ»Ñ {self.redis_url}")
                self._redis_client = None 
                raise RedisConnectionError("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Redis (from_url Ğ²ĞµÑ€Ğ½ÑƒĞ» None)")

        except (asyncio.TimeoutError, RedisTimeoutError) as te: 
            logger.error(f"RedisCache: Ğ¢Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¸/Ğ¿Ğ¸Ğ½Ğ³Ğµ Ğº Redis ({self.redis_url}): {te}", exc_info=False) # exc_info=False Ñ‚.Ğº. Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ - ÑÑ‚Ğ¾ Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ğ¾Ğµ
            self._redis_client = None
            raise
        except RedisConnectionError as ce: 
            logger.error(f"RedisCache: ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Redis ({self.redis_url}): {ce}", exc_info=True)
            self._redis_client = None
            raise
        except RedisError as re: 
            logger.error(f"RedisCache: ĞĞ±Ñ‰Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Redis Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¸/Ğ¿Ğ¸Ğ½Ğ³Ğµ ({self.redis_url}): {re}", exc_info=True)
            self._redis_client = None
            raise
        except Exception as e: 
            logger.error(f"RedisCache: ĞĞµĞ¿Ñ€ĞµĞ´Ğ²Ğ¸Ğ´ĞµĞ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Redis ({self.redis_url}): {type(e).__name__} - {e}", exc_info=True)
            self._redis_client = None
            raise

    async def dispose(self) -> None:
        if self._redis_client:
            logger.info(f"RedisCache: Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Ñ Redis ({self.redis_url})...")
            try:
                await self._redis_client.close()
                # Ğ”Ğ»Ñ redis-py 4.2+ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ‚Ğ°ĞºĞ¶Ğµ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿ÑƒĞ» ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹, ĞµÑĞ»Ğ¸ Ğ¾Ğ½ Ğ½Ğµ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹
                # Ğ¸ ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ (Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ close() ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾)
                if hasattr(self._redis_client, 'connection_pool') and hasattr(self._redis_client.connection_pool, 'disconnect'):
                     await self._redis_client.connection_pool.disconnect()
                logger.info(f"Ğ¡Ğ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ Redis ({self.redis_url}) ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¾.")
            except Exception as e:
                logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Ñ Redis ({self.redis_url}): {e}", exc_info=True)
            finally:
                self._redis_client = None

    async def get(self, key: str) -> Optional[Any]:
        if not self._redis_client: return None
        try:
            json_value = await self._redis_client.get(key)
            if json_value: 
                # Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ´ĞµÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· JSON Ğ²Ğ¼ĞµÑÑ‚Ğ¾ pickle
                return json.loads(json_value.decode('utf-8'))
            return None
        except RedisError as e: logger.error(f"RedisCache: ĞÑˆĞ¸Ğ±ĞºĞ° Redis Ğ¿Ñ€Ğ¸ GET Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{key}': {e}"); return None
        except (json.JSONDecodeError, UnicodeDecodeError) as e: logger.error(f"RedisCache: ĞÑˆĞ¸Ğ±ĞºĞ° Ğ´ĞµÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{key}': {e}"); return None
        except Exception as e_unexp: logger.error(f"RedisCache: ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° GET Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{key}': {e_unexp}"); return None


    async def set(self, key: str, value: Any, ttl_seconds: Optional[int] = None) -> None:
        if not self._redis_client: return
        try:
            # Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· JSON Ğ²Ğ¼ĞµÑÑ‚Ğ¾ pickle
            json_value = json.dumps(value, ensure_ascii=False, default=str)
            await self._redis_client.set(key, json_value, ex=ttl_seconds)
        except (TypeError, ValueError) as e: logger.error(f"RedisCache: ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{key}': {e}")
        except RedisError as e_redis: logger.error(f"RedisCache: ĞÑˆĞ¸Ğ±ĞºĞ° Redis Ğ¿Ñ€Ğ¸ SET Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{key}': {e_redis}")
        except Exception as e_unexp: logger.error(f"RedisCache: ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° SET Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{key}': {e_unexp}")


    async def delete(self, key: str) -> bool:
        if not self._redis_client: return False
        try: 
            deleted_count = await self._redis_client.delete(key)
            return deleted_count > 0
        except RedisError as e: logger.error(f"RedisCache: ĞÑˆĞ¸Ğ±ĞºĞ° Redis Ğ¿Ñ€Ğ¸ DELETE Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{key}': {e}"); return False
        except Exception as e_unexp: logger.error(f"RedisCache: ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° DELETE Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{key}': {e_unexp}"); return False


    async def exists(self, key: str) -> bool:
        if not self._redis_client: return False
        try: 
            exists_count = await self._redis_client.exists(key)
            return exists_count > 0
        except RedisError as e: logger.error(f"RedisCache: ĞÑˆĞ¸Ğ±ĞºĞ° Redis Ğ¿Ñ€Ğ¸ EXISTS Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{key}': {e}"); return False
        except Exception as e_unexp: logger.error(f"RedisCache: ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° EXISTS Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡Ğ° '{key}': {e_unexp}"); return False


    async def clear(self) -> None:
        if not self._redis_client: return
        try:
            logger.warning(f"RedisCache: Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° FLUSHDB Ğ´Ğ»Ñ Redis ({self.redis_url})!")
            await self._redis_client.flushdb()
            logger.info(f"RedisCache: FLUSHDB Ğ´Ğ»Ñ Redis ({self.redis_url}) Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½.")
        except RedisError as e: logger.error(f"RedisCache: ĞÑˆĞ¸Ğ±ĞºĞ° Redis Ğ¿Ñ€Ğ¸ FLUSHDB: {e}")
        except Exception as e_unexp: logger.error(f"RedisCache: ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° FLUSHDB: {e_unexp}")


    def get_client_instance(self) -> Optional[Any]:  # type: ignore
        return self._redis_client


class CacheManager:
    def __init__(self, cache_settings: 'CacheSettings'):
        self._settings = cache_settings
        self._cache_backend: Optional[BaseCache] = None
        self._is_initialized_successfully = False
        logger.info(f"CacheManager Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½. Ğ¡ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ ĞºÑÑˆĞ°: {self._settings.type}")

    async def initialize(self) -> None:
        if self._is_initialized_successfully:
            logger.debug(f"CacheManager (Ğ±ÑĞºĞµĞ½Ğ´: {self._settings.type}) ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ» ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
            return
        self._is_initialized_successfully = False # Ğ¡Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ñ„Ğ»Ğ°Ğ³ Ğ¿ĞµÑ€ĞµĞ´ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¾Ğ¹

        if self._settings.type == "redis":
            if not self._settings.redis_url:
                logger.error("Ğ¢Ğ¸Ğ¿ ĞºÑÑˆĞ° 'redis', Ğ½Ğ¾ redis_url Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½ Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ…. ĞšÑÑˆ Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
                return
            if not REDIS_PY_AVAILABLE:
                logger.critical("Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° 'redis' (Ğ´Ğ»Ñ asyncio) Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°, Ğ½Ğ¾ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½ Ñ‚Ğ¸Ğ¿ ĞºÑÑˆĞ° 'redis'. ĞšÑÑˆ Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ.")
                return
            try:
                self._cache_backend = RedisCache(redis_url=str(self._settings.redis_url))
            except ImportError as e_imp_redis: 
                logger.critical(f"CacheManager: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ RedisCache (ImportError): {e_imp_redis}")
                return 
        elif self._settings.type == "memory":
            self._cache_backend = MemoryCache() 
        else:
            logger.warning(f"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ ĞºÑÑˆĞ°: '{self._settings.type}'. ĞšÑÑˆ Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.")
            return

        if self._cache_backend:
            try:
                await self._cache_backend.initialize()
                # Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ»Ñ Redis, Ñ‡Ñ‚Ğ¾ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ»ÑÑ
                if isinstance(self._cache_backend, RedisCache) and self._cache_backend.get_client_instance() is None:
                    logger.error(f"CacheManager: RedisCache.initialize() Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»ÑÑ, Ğ½Ğ¾ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Redis Ğ¾ÑÑ‚Ğ°Ğ»ÑÑ None. Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ°ÑÑŒ.")
                    self._cache_backend = None # Ğ¡Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ is_available() Ğ²ĞµÑ€Ğ½ÑƒĞ» False
                else:
                    self._is_initialized_successfully = True
                    logger.success(f"Ğ‘ÑĞºĞµĞ½Ğ´ ĞºÑÑˆĞ° '{self._settings.type}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
            except Exception as e_init_backend: 
                logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ±ÑĞºĞµĞ½Ğ´Ğ° ĞºÑÑˆĞ° '{self._settings.type}': {type(e_init_backend).__name__} - {e_init_backend}", exc_info=False)
                self._cache_backend = None 
    
    async def dispose(self) -> None:
        if self._cache_backend: 
            try: await self._cache_backend.dispose()
            except Exception as e: logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¸ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² ĞºÑÑˆĞ° '{self._settings.type}': {e}", exc_info=True)
        self._is_initialized_successfully = False 
        self._cache_backend = None 
        logger.info(f"Ğ ĞµÑÑƒÑ€ÑÑ‹ CacheManager Ğ´Ğ»Ñ Ğ±ÑĞºĞµĞ½Ğ´Ğ° '{self._settings.type}' Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ñ‹ (Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ).")


    def is_available(self) -> bool:
        return self._cache_backend is not None and self._is_initialized_successfully

    async def get(self, key: str, default: Optional[Any] = None) -> Optional[Any]:
        if not self.is_available() or self._cache_backend is None:
            logger.trace(f"ĞšÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½. get('{key}') Ğ²ĞµÑ€Ğ½ĞµÑ‚ default ({default}).")
            return default
        return await self._cache_backend.get(key)

    async def set(self, key: str, value: Any, ttl_seconds: Optional[int] = None) -> None:
        if not self.is_available() or self._cache_backend is None:
            logger.trace(f"ĞšÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½. set('{key}', ...) Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾.")
            return
        await self._cache_backend.set(key, value, ttl_seconds=ttl_seconds)

    async def delete(self, key: str) -> bool:
        if not self.is_available() or self._cache_backend is None:
            logger.trace(f"ĞšÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½. delete('{key}') Ğ²ĞµÑ€Ğ½ĞµÑ‚ False.")
            return False
        return await self._cache_backend.delete(key)

    async def exists(self, key: str) -> bool:
        if not self.is_available() or self._cache_backend is None:
            logger.trace(f"ĞšÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½. exists('{key}') Ğ²ĞµÑ€Ğ½ĞµÑ‚ False.")
            return False
        return await self._cache_backend.exists(key)

    async def clear_all_cache(self) -> None:
        if not self.is_available() or self._cache_backend is None:
            logger.trace(f"ĞšÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½. clear_all_cache() Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾.")
            return
        logger.warning(f"Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ° ĞºÑÑˆĞ° Ğ´Ğ»Ñ Ğ±ÑĞºĞµĞ½Ğ´Ğ° '{self._settings.type}'.")
        await self._cache_backend.clear()

    async def get_redis_client_instance(self) -> Optional[Any]:  # type: ignore
        if self.is_available() and isinstance(self._cache_backend, RedisCache):
            return self._cache_backend.get_client_instance()
        logger.debug("Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€ Redis ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°, Ğ½Ğ¾ RedisCache Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.")
        return None


======================================================================

------------------------------ FILE: Systems/core/cache/__init__.py ------------------------------



======================================================================

------------------------------ FILE: Systems/cli/notifications.py ------------------------------
# cli/notifications.py
import asyncio
import json
import logging
import smtplib
import subprocess
from datetime import datetime, timedelta
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from pathlib import Path
from typing import Any, Dict, List, Optional

import requests
import typer
from rich.console import Console
from rich.panel import Panel
from rich.table import Table

console = Console()
notifications_app = typer.Typer(
    name="notifications", help="ğŸ”” Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸"
)

# ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ Ğ´Ğ»Ñ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
NOTIFICATIONS_DIR = Path("Data/notifications")
NOTIFICATIONS_CONFIG_FILE = NOTIFICATIONS_DIR / "notifications_config.json"
NOTIFICATIONS_LOG_FILE = NOTIFICATIONS_DIR / "notifications.log"


def _ensure_notifications_directory():
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ ĞµÑĞ»Ğ¸ ĞµÑ‘ Ğ½ĞµÑ‚"""
    NOTIFICATIONS_DIR.mkdir(parents=True, exist_ok=True)
    if not NOTIFICATIONS_CONFIG_FILE.exists():
        default_config = {
            "channels": {
                "telegram_admin": {
                    "type": "telegram",
                    "status": "active",
                    "description": "Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°Ğ¼",
                    "config": {"chat_id": None, "bot_token": None},
                },
                "email_support": {
                    "type": "email",
                    "status": "inactive",
                    "description": "Email ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ",
                    "config": {
                        "smtp_server": "smtp.gmail.com",
                        "smtp_port": 587,
                        "username": None,
                        "password": None,
                        "from_email": None,
                        "to_email": None,
                    },
                },
                "webhook_monitoring": {
                    "type": "webhook",
                    "status": "active",
                    "description": "Webhook Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°",
                    "config": {"url": None, "method": "POST", "headers": {}},
                },
                "slack_alerts": {
                    "type": "slack",
                    "status": "configured",
                    "description": "Slack ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ",
                    "config": {"webhook_url": None, "channel": "#alerts"},
                },
            },
            "templates": {
                "system_alert": {
                    "subject": "ğŸš¨ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ",
                    "body": "Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ: {message}\nĞ’Ñ€ĞµĞ¼Ñ: {timestamp}\nĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚: {priority}",
                },
                "backup_complete": {
                    "subject": "âœ… Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğµ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾",
                    "body": "Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğµ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾ Ğ² {timestamp}",
                },
                "error_report": {
                    "subject": "âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹",
                    "body": "ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: {error}\nĞ’Ñ€ĞµĞ¼Ñ: {timestamp}\nĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚: {component}",
                },
            },
        }
        with open(NOTIFICATIONS_CONFIG_FILE, "w") as f:
            json.dump(default_config, f, indent=2)


def _load_notifications_config() -> Dict[str, Any]:
    """Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹"""
    _ensure_notifications_directory()
    try:
        with open(NOTIFICATIONS_CONFIG_FILE, "r") as f:
            return json.load(f)
    except FileNotFoundError:
        return {"channels": {}, "templates": {}}


def _save_notifications_config(config: Dict[str, Any]):
    """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹"""
    _ensure_notifications_directory()
    with open(NOTIFICATIONS_CONFIG_FILE, "w") as f:
        json.dump(config, f, indent=2)


def _log_notification_event(channel: str, event: str, details: str = ""):
    """Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ² Ğ»Ğ¾Ğ³"""
    _ensure_notifications_directory()
    timestamp = datetime.now().isoformat()
    log_entry = f"[{timestamp}] {channel}: {event}"
    if details:
        log_entry += f" - {details}"

    with open(NOTIFICATIONS_LOG_FILE, "a") as f:
        f.write(log_entry + "\n")


@notifications_app.command(name="list", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ² ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹.")
def notifications_list_cmd(
    status: Optional[str] = typer.Option(
        None, "--status", "-s", help="Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ: active, inactive, configured"
    ),
    format: str = typer.Option(
        "table", "--format", "-f", help="Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°: table, json"
    ),
):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ² ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹"""
    try:
        asyncio.run(_notifications_list_async(status, format))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(
            f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'notifications list': {e}[/]"
        )
        raise typer.Exit(code=1)


async def _notifications_list_async(status: Optional[str], format: str):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ² ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹"""
    console.print(
        Panel("[bold blue]ĞšĞĞĞĞ›Ğ« Ğ£Ğ’Ğ•Ğ”ĞĞœĞ›Ğ•ĞĞ˜Ğ™[/]", expand=False, border_style="blue")
    )

    config = _load_notifications_config()
    channels = config.get("channels", {})

    if not channels:
        console.print("[yellow]ĞšĞ°Ğ½Ğ°Ğ»Ñ‹ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹[/]")
        return

    # Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ ĞºĞ°Ğ½Ğ°Ğ»Ñ‹ Ğ¿Ğ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ
    filtered_channels = []
    for channel_name, channel_info in channels.items():
        if status is None or channel_info.get("status") == status:
            filtered_channels.append((channel_name, channel_info))

    if not filtered_channels:
        console.print(f"[yellow]ĞšĞ°Ğ½Ğ°Ğ»Ñ‹ ÑĞ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ¼ '{status}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹[/]")
        return

    if format == "json":
        console.print(json.dumps(channels, indent=2, ensure_ascii=False))
        return

    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚
    table = Table(title=f"ĞšĞ°Ğ½Ğ°Ğ»Ñ‹ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ (Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¾: {len(filtered_channels)})")
    table.add_column("ĞšĞ°Ğ½Ğ°Ğ»", style="cyan")
    table.add_column("Ğ¢Ğ¸Ğ¿", style="blue")
    table.add_column("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="green")
    table.add_column("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ", style="white")
    table.add_column("ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ", style="yellow")

    for channel_name, channel_info in filtered_channels:
        status = channel_info.get("status", "unknown")
        status_color = {
            "active": "green",
            "inactive": "red",
            "configured": "yellow",
            "error": "red",
        }.get(status, "white")

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
        config_status = (
            "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½" if _is_channel_configured(channel_info) else "âŒ ĞĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½"
        )

        table.add_row(
            channel_name,
            channel_info.get("type", "unknown"),
            f"[{status_color}]{status}[/{status_color}]",
            channel_info.get("description", "Ğ‘ĞµĞ· Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ"),
            config_status,
        )

    console.print(table)


def _is_channel_configured(channel_info: Dict[str, Any]) -> bool:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ»Ğ¸ ĞºĞ°Ğ½Ğ°Ğ»"""
    config = channel_info.get("config", {})
    channel_type = channel_info.get("type", "")

    if channel_type == "telegram":
        return bool(config.get("chat_id") and config.get("bot_token"))
    elif channel_type == "email":
        return bool(
            config.get("username") and config.get("password") and config.get("to_email")
        )
    elif channel_type == "webhook":
        return bool(config.get("url"))
    elif channel_type == "slack":
        return bool(config.get("webhook_url"))
    else:
        return False


@notifications_app.command(name="send", help="ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ.")
def notifications_send_cmd(
    channel: str = typer.Argument(..., help="ĞšĞ°Ğ½Ğ°Ğ» Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸"),
    message: str = typer.Argument(..., help="Ğ¢ĞµĞºÑÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ"),
    priority: str = typer.Option(
        "normal", "--priority", "-p", help="ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚: low, normal, high, urgent"
    ),
    template: Optional[str] = typer.Option(
        None, "--template", "-t", help="Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ"
    ),
    subject: Optional[str] = typer.Option(
        None, "--subject", "-s", help="Ğ¢ĞµĞ¼Ğ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ"
    ),
):
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ"""
    try:
        asyncio.run(
            _notifications_send_async(channel, message, priority, template, subject)
        )
    except typer.Exit:
        raise
    except Exception as e:
        console.print(
            f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'notifications send': {e}[/]"
        )
        raise typer.Exit(code=1)


async def _notifications_send_async(
    channel: str,
    message: str,
    priority: str,
    template: Optional[str],
    subject: Optional[str],
):
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ"""
    console.print(
        Panel("[bold blue]ĞĞ¢ĞŸĞ ĞĞ’ĞšĞ Ğ£Ğ’Ğ•Ğ”ĞĞœĞ›Ğ•ĞĞ˜Ğ¯[/]", expand=False, border_style="blue")
    )

    config = _load_notifications_config()
    channels = config.get("channels", {})

    if channel not in channels:
        console.print(f"[bold red]ĞšĞ°Ğ½Ğ°Ğ» '{channel}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½[/]")
        raise typer.Exit(code=1)

    channel_info = channels[channel]
    channel_type = channel_info.get("type", "")
    channel_status = channel_info.get("status", "inactive")

    if channel_status != "active":
        console.print(
            f"[yellow]ĞšĞ°Ğ½Ğ°Ğ» '{channel}' Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ (ÑÑ‚Ğ°Ñ‚ÑƒÑ: {channel_status})[/]"
        )
        return

    # ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
    final_message = message
    final_subject = subject or "Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹"

    if template:
        templates = config.get("templates", {})
        if template in templates:
            template_info = templates[template]
            template_body = template_info.get("body", message)
            template_subject = template_info.get("subject", final_subject)

            # Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ¿Ğ»ĞµĞ¹ÑÑ…Ğ¾Ğ»Ğ´ĞµÑ€Ñ‹
            timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            template_body = template_body.format(
                message=message,
                timestamp=timestamp,
                priority=priority,
                error=message,
                component="CLI",
            )
            template_subject = template_subject.format(
                message=message, timestamp=timestamp, priority=priority
            )

            final_message = template_body
            final_subject = template_subject
        else:
            console.print(
                f"[yellow]Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ '{template}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ[/]"
            )

    console.print(f"[cyan]ĞšĞ°Ğ½Ğ°Ğ»:[/] {channel}")
    console.print(f"[cyan]Ğ¢Ğ¸Ğ¿:[/] {channel_type}")
    console.print(f"[cyan]ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:[/] {priority}")
    console.print(f"[cyan]Ğ¢ĞµĞ¼Ğ°:[/] {final_subject}")
    console.print(f"[cyan]Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ:[/] {final_message}")

    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ
    success = False
    try:
        if channel_type == "telegram":
            success = await _send_telegram_notification(
                channel_info, final_message, priority
            )
        elif channel_type == "email":
            success = await _send_email_notification(
                channel_info, final_subject, final_message, priority
            )
        elif channel_type == "webhook":
            success = await _send_webhook_notification(
                channel_info, final_message, priority
            )
        elif channel_type == "slack":
            success = await _send_slack_notification(
                channel_info, final_message, priority
            )
        else:
            console.print(f"[yellow]ĞĞµĞ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ ĞºĞ°Ğ½Ğ°Ğ»Ğ°: {channel_type}[/]")
            return
    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ: {e}[/]")
        _log_notification_event(channel, "send_failed", str(e))
        return

    if success:
        console.print(
            f"[green]âœ… Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ°Ğ½Ğ°Ğ» '{channel}'[/]"
        )
        _log_notification_event(channel, "send_success", f"priority={priority}")
    else:
        console.print(
            f"[red]âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ°Ğ½Ğ°Ğ» '{channel}'[/]"
        )
        _log_notification_event(channel, "send_failed", f"priority={priority}")


async def _send_telegram_notification(
    channel_info: Dict[str, Any], message: str, priority: str
) -> bool:
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Telegram Ñ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹"""
    config = channel_info.get("config", {})
    chat_id = config.get("chat_id")
    bot_token = config.get("bot_token")

    if not chat_id or not bot_token:
        console.print(
            "[yellow]Telegram Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ (Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ chat_id Ğ¸Ğ»Ğ¸ bot_token)[/]"
        )
        logger.warning(
            f"Telegram notification failed: missing config - chat_id: {bool(chat_id)}, bot_token: {bool(bot_token)}"
        )
        return False

    try:
        # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ¾Ğ¼ Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¼ĞµÑ‚ĞºĞ¾Ğ¹
        priority_emoji = {"low": "ğŸ”µ", "normal": "âšª", "high": "ğŸŸ¡", "urgent": "ğŸ”´"}
        emoji = priority_emoji.get(priority, "âšª")
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")

        formatted_message = f"""
{emoji} **{priority.upper()} Ğ£Ğ’Ğ•Ğ”ĞĞœĞ›Ğ•ĞĞ˜Ğ•**
â° {timestamp}

{message}

---
ğŸ¤– SwiftDevBot
        """.strip()

        url = f"https://api.telegram.org/bot{bot_token}/sendMessage"
        data = {
            "chat_id": chat_id,
            "text": formatted_message,
            "parse_mode": "HTML",
            "disable_web_page_preview": True,
        }

        console.print(
            f"[cyan]ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ² Telegram (chat_id: {chat_id})...[/]"
        )

        response = requests.post(url, json=data, timeout=15)

        if response.status_code == 200:
            result = response.json()
            if result.get("ok"):
                console.print("[green]âœ… Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² Telegram[/]")
                logger.info(
                    f"Telegram notification sent successfully to chat_id: {chat_id}"
                )
                return True
            else:
                error_msg = result.get("description", "Unknown error")
                console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Telegram API: {error_msg}[/]")
                logger.error(f"Telegram API error: {error_msg}")
                return False
        else:
            console.print(f"[red]âŒ HTTP Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: {response.status_code}[/]")
            logger.error(f"Telegram HTTP error: {response.status_code}")
            return False

    except requests.exceptions.Timeout:
        console.print("[red]âŒ Ğ¢Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ Ğ² Telegram[/]")
        logger.error("Telegram notification timeout")
        return False
    except requests.exceptions.RequestException as e:
        console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ‚Ğ¸: {e}[/]")
        logger.error(f"Telegram network error: {e}")
        return False
    except Exception as e:
        console.print(f"[red]âŒ ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: {e}[/]")
        logger.error(f"Telegram unexpected error: {e}")
        return False


async def _send_email_notification(
    channel_info: Dict[str, Any], subject: str, message: str, priority: str
) -> bool:
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ email Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¾Ğ¹ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº"""
    config = channel_info.get("config", {})

    smtp_server = config.get("smtp_server")
    smtp_port = config.get("smtp_port", 587)
    username = config.get("username")
    password = config.get("password")
    from_email = config.get("from_email")
    to_email = config.get("to_email")

    if not all([smtp_server, username, password, from_email, to_email]):
        console.print(
            "[yellow]Email Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ (Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹)[/]"
        )
        logger.warning("Email notification failed: missing configuration")
        return False

    try:
        # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğ¼ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        priority_emoji = {"low": "ğŸ”µ", "normal": "âšª", "high": "ğŸŸ¡", "urgent": "ğŸ”´"}
        emoji = priority_emoji.get(priority, "âšª")

        msg = MIMEMultipart()
        msg["From"] = from_email
        msg["To"] = to_email
        msg["Subject"] = f"{emoji} [{priority.upper()}] {subject}"

        body = f"""
ğŸ¤– SwiftDevBot - Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ

ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚: {priority.upper()}
Ğ’Ñ€ĞµĞ¼Ñ: {timestamp}

{message}

Ğ­Ñ‚Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ SwiftDevBot.
        """

        msg.attach(MIMEText(body, "plain", "utf-8"))

        console.print(f"[cyan]ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° email ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğ° {to_email}...[/]")

        # ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº SMTP ÑĞµÑ€Ğ²ĞµÑ€Ñƒ
        server = smtplib.SMTP(smtp_server, smtp_port)
        server.starttls()
        server.login(username, password)
        server.send_message(msg)
        server.quit()

        console.print("[green]âœ… Email ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾[/]")
        logger.info(f"Email notification sent successfully to {to_email}")
        return True

    except smtplib.SMTPAuthenticationError:
        console.print("[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ SMTP[/]")
        logger.error("Email SMTP authentication error")
        return False
    except smtplib.SMTPRecipientsRefused:
        console.print("[red]âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ°Ğ´Ñ€ĞµÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ĞµĞ»Ñ[/]")
        logger.error(f"Email recipient refused: {to_email}")
        return False
    except smtplib.SMTPServerDisconnected:
        console.print("[red]âŒ Ğ¡Ğ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ SMTP ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ¼ Ñ€Ğ°Ğ·Ğ¾Ñ€Ğ²Ğ°Ğ½Ğ¾[/]")
        logger.error("Email SMTP server disconnected")
        return False
    except Exception as e:
        console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ email: {e}[/]")
        logger.error(f"Email sending error: {e}")
        return False


async def _send_webhook_notification(
    channel_info: Dict[str, Any], message: str, priority: str
) -> bool:
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· webhook Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¾Ğ¹"""
    config = channel_info.get("config", {})
    url = config.get("url")
    method = config.get("method", "POST")
    headers = config.get("headers", {})

    if not url:
        console.print("[yellow]Webhook Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ (Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ URL)[/]")
        logger.warning("Webhook notification failed: missing URL")
        return False

    try:
        timestamp = datetime.now().isoformat()
        data = {
            "message": message,
            "priority": priority,
            "timestamp": timestamp,
            "source": "swiftdevbot",
            "version": "1.0",
        }

        console.print(f"[cyan]ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° webhook ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğ° {url}...[/]")

        response = requests.request(method, url, json=data, headers=headers, timeout=15)

        if response.status_code in [200, 201, 202]:
            console.print("[green]âœ… Webhook ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾[/]")
            logger.info(f"Webhook notification sent successfully to {url}")
            return True
        else:
            console.print(f"[red]âŒ Webhook Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: HTTP {response.status_code}[/]")
            logger.error(f"Webhook HTTP error: {response.status_code}")
            return False

    except requests.exceptions.Timeout:
        console.print("[red]âŒ Ğ¢Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ webhook[/]")
        logger.error("Webhook notification timeout")
        return False
    except requests.exceptions.RequestException as e:
        console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ‚Ğ¸ webhook: {e}[/]")
        logger.error(f"Webhook network error: {e}")
        return False
    except Exception as e:
        console.print(f"[red]âŒ ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° webhook: {e}[/]")
        logger.error(f"Webhook unexpected error: {e}")
        return False


async def _send_slack_notification(
    channel_info: Dict[str, Any], message: str, priority: str
) -> bool:
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Slack Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹"""
    config = channel_info.get("config", {})
    webhook_url = config.get("webhook_url")
    channel = config.get("channel", "#alerts")

    if not webhook_url:
        console.print("[yellow]Slack Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ (Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ webhook_url)[/]")
        logger.warning("Slack notification failed: missing webhook_url")
        return False

    try:
        # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Slack ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ¾Ğ¼
        priority_emoji = {"low": "ğŸ”µ", "normal": "âšª", "high": "ğŸŸ¡", "urgent": "ğŸ”´"}
        emoji = priority_emoji.get(priority, "âšª")
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")

        slack_data = {
            "channel": channel,
            "text": f"{emoji} *{priority.upper()} Ğ£Ğ’Ğ•Ğ”ĞĞœĞ›Ğ•ĞĞ˜Ğ•*",
            "attachments": [
                {
                    "color": {
                        "low": "#3498db",
                        "normal": "#95a5a6",
                        "high": "#f39c12",
                        "urgent": "#e74c3c",
                    }.get(priority, "#95a5a6"),
                    "text": message,
                    "fields": [
                        {
                            "title": "ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚",
                            "value": priority.upper(),
                            "short": True,
                        },
                        {"title": "Ğ’Ñ€ĞµĞ¼Ñ", "value": timestamp, "short": True},
                        {"title": "Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº", "value": "SwiftDevBot", "short": True},
                    ],
                    "footer": "SwiftDevBot",
                    "ts": int(datetime.now().timestamp()),
                }
            ],
        }

        console.print(f"[cyan]ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Slack ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ² ĞºĞ°Ğ½Ğ°Ğ» {channel}...[/]")

        response = requests.post(webhook_url, json=slack_data, timeout=15)

        if response.status_code == 200:
            console.print("[green]âœ… Slack ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾[/]")
            logger.info(f"Slack notification sent successfully to channel {channel}")
            return True
        else:
            console.print(f"[red]âŒ Slack Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: HTTP {response.status_code}[/]")
            logger.error(f"Slack HTTP error: {response.status_code}")
            return False

    except requests.exceptions.Timeout:
        console.print("[red]âŒ Ğ¢Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ Ğ² Slack[/]")
        logger.error("Slack notification timeout")
        return False
    except requests.exceptions.RequestException as e:
        console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ‚Ğ¸ Slack: {e}[/]")
        logger.error(f"Slack network error: {e}")
        return False
    except Exception as e:
        console.print(f"[red]âŒ ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Slack: {e}[/]")
        logger.error(f"Slack unexpected error: {e}")
        return False


@notifications_app.command(name="configure", help="ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ ĞºĞ°Ğ½Ğ°Ğ» ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹.")
def notifications_configure_cmd(
    channel: str = typer.Argument(..., help="ĞšĞ°Ğ½Ğ°Ğ» Ğ´Ğ»Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸"),
    config_file: Optional[str] = typer.Option(
        None, "--config", "-c", help="Ğ¤Ğ°Ğ¹Ğ» ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸"
    ),
    interactive: bool = typer.Option(
        False, "--interactive", "-i", help="Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°"
    ),
):
    """ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ ĞºĞ°Ğ½Ğ°Ğ» ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹"""
    try:
        asyncio.run(_notifications_configure_async(channel, config_file, interactive))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(
            f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'notifications configure': {e}[/]"
        )
        raise typer.Exit(code=1)


async def _notifications_configure_async(
    channel: str, config_file: Optional[str], interactive: bool
):
    """ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ ĞºĞ°Ğ½Ğ°Ğ» ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹"""
    from Systems.cli.utils import confirm_action

    console.print(
        Panel(
            f"[bold blue]ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ ĞšĞĞĞĞ›Ğ: {channel}[/]",
            expand=False,
            border_style="blue",
        )
    )

    config = _load_notifications_config()
    channels = config.get("channels", {})

    if channel not in channels:
        console.print(f"[bold red]ĞšĞ°Ğ½Ğ°Ğ» '{channel}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½[/]")
        raise typer.Exit(code=1)

    channel_info = channels[channel]
    channel_type = channel_info.get("type", "")

    console.print(f"[cyan]ĞšĞ°Ğ½Ğ°Ğ»:[/] {channel}")
    console.print(f"[cyan]Ğ¢Ğ¸Ğ¿:[/] {channel_type}")
    console.print(f"[cyan]Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ:[/] {channel_info.get('status', 'unknown')}")

    if config_file:
        console.print(f"[cyan]Ğ¤Ğ°Ğ¹Ğ» ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸:[/] {config_file}")

        # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ°
        try:
            config_path = Path(config_file)
            if not config_path.exists():
                console.print(
                    f"[bold red]Ğ¤Ğ°Ğ¹Ğ» ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: {config_file}[/]"
                )
                raise typer.Exit(code=1)

            # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ» ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸
            with open(config_path, "r", encoding="utf-8") as f:
                if config_path.suffix.lower() in [".yaml", ".yml"]:
                    import yaml

                    file_config = yaml.safe_load(f)
                elif config_path.suffix.lower() == ".json":
                    import json

                    file_config = json.load(f)
                else:
                    console.print(
                        f"[bold red]ĞĞµĞ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ„Ğ°Ğ¹Ğ»Ğ°: {config_path.suffix}[/]"
                    )
                    raise typer.Exit(code=1)

            # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğº ĞºĞ°Ğ½Ğ°Ğ»Ñƒ
            if channel in file_config:
                channel_config = file_config[channel]
                channels[channel].update(channel_config)
                _save_notifications_config(config)
                console.print(
                    f"[green]ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ ĞºĞ°Ğ½Ğ°Ğ»Ğ° '{channel}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ° Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ°![/]"
                )
            else:
                console.print(
                    f"[yellow]ĞšĞ°Ğ½Ğ°Ğ» '{channel}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ñ„Ğ°Ğ¹Ğ»Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸.[/]"
                )
                console.print(
                    f"[cyan]Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ ĞºĞ°Ğ½Ğ°Ğ»Ñ‹ Ğ² Ñ„Ğ°Ğ¹Ğ»Ğµ: {', '.join(file_config.keys())}[/]"
                )

        except Exception as e:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸: {e}[/]")
            raise typer.Exit(code=1)
    elif interactive:
        await _configure_channel_interactive(channel, channel_info, config)
    else:
        console.print(
            "[yellow]Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ --interactive Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸[/]"
        )
        console.print("[dim]Ğ˜Ğ»Ğ¸ ÑƒĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ --config[/]")


@notifications_app.command(name="test", help="ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ.")
def notifications_test_cmd(
    channel: str = typer.Argument(..., help="ĞšĞ°Ğ½Ğ°Ğ» Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"),
    message: Optional[str] = typer.Option(
        None, "--message", "-m", help="Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ"
    ),
    priority: str = typer.Option(
        "normal", "--priority", "-p", help="ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚: low, normal, high, urgent"
    ),
):
    """ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ² ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ½Ğ°Ğ»"""
    try:
        asyncio.run(_notifications_test_async(channel, message, priority))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(
            f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'notifications test': {e}[/]"
        )
        raise typer.Exit(code=1)


async def _notifications_test_async(
    channel: str, message: Optional[str], priority: str
):
    """ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ"""
    console.print(
        Panel(
            f"[bold blue]Ğ¢Ğ•Ğ¡Ğ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ• Ğ£Ğ’Ğ•Ğ”ĞĞœĞ›Ğ•ĞĞ˜Ğ™: {channel}[/]",
            expand=False,
            border_style="blue",
        )
    )

    config = _load_notifications_config()
    channels = config.get("channels", {})

    if channel not in channels:
        console.print(f"[bold red]âŒ ĞšĞ°Ğ½Ğ°Ğ» '{channel}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½[/]")
        console.print(f"[cyan]Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ ĞºĞ°Ğ½Ğ°Ğ»Ñ‹: {', '.join(channels.keys())}[/]")
        raise typer.Exit(code=1)

    channel_info = channels[channel]
    if channel_info.get("status") != "active":
        console.print(
            f"[yellow]âš ï¸ ĞšĞ°Ğ½Ğ°Ğ» '{channel}' Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ (ÑÑ‚Ğ°Ñ‚ÑƒÑ: {channel_info.get('status')})[/]"
        )
        if not typer.confirm("ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ?"):
            raise typer.Exit(code=1)

    # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
    if not message:
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        message = f"Ğ­Ñ‚Ğ¾ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ SwiftDevBot\nĞ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸: {timestamp}\nĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚: {priority.upper()}"

    console.print(f"[cyan]ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ² ĞºĞ°Ğ½Ğ°Ğ» '{channel}'...[/]")
    console.print(
        f"[dim]Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ: {message[:100]}{'...' if len(message) > 100 else ''}[/]"
    )

    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ
    success = await _send_notification_by_type(channel_info, message, priority)

    if success:
        console.print("[bold green]âœ… Ğ¢ĞµÑÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾ÑˆĞµĞ» ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾![/]")
        logger.info(f"Notification test successful for channel: {channel}")
    else:
        console.print("[bold red]âŒ Ğ¢ĞµÑÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑ[/]")
        logger.error(f"Notification test failed for channel: {channel}")
        raise typer.Exit(code=1)


async def _send_notification_by_type(
    channel_info: Dict[str, Any], message: str, priority: str
) -> bool:
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ñƒ ĞºĞ°Ğ½Ğ°Ğ»Ğ°"""
    channel_type = channel_info.get("type")

    if channel_type == "telegram":
        return await _send_telegram_notification(channel_info, message, priority)
    elif channel_type == "email":
        subject = "Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ"
        return await _send_email_notification(channel_info, subject, message, priority)
    elif channel_type == "webhook":
        return await _send_webhook_notification(channel_info, message, priority)
    elif channel_type == "slack":
        return await _send_slack_notification(channel_info, message, priority)
    else:
        console.print(f"[yellow]ĞĞµĞ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ ĞºĞ°Ğ½Ğ°Ğ»Ğ°: {channel_type}[/]")
        return False


async def _configure_channel_interactive(
    channel: str, channel_info: Dict[str, Any], config: Dict[str, Any]
):
    """Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ĞºĞ°Ğ½Ğ°Ğ»Ğ° ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹"""
    channel_type = channel_info.get("type")

    console.print(f"[cyan]ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ĞºĞ°Ğ½Ğ°Ğ»Ğ° '{channel}' (Ñ‚Ğ¸Ğ¿: {channel_type})[/]")

    if channel_type == "telegram":
        await _configure_telegram_interactive(channel, channel_info, config)
    elif channel_type == "email":
        await _configure_email_interactive(channel, channel_info, config)
    elif channel_type == "webhook":
        await _configure_webhook_interactive(channel, channel_info, config)
    elif channel_type == "slack":
        await _configure_slack_interactive(channel, channel_info, config)
    else:
        console.print(
            f"[yellow]Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ° '{channel_type}' Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ[/]"
        )


async def _configure_telegram_interactive(
    channel: str, channel_info: Dict[str, Any], config: Dict[str, Any]
):
    """Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Telegram ĞºĞ°Ğ½Ğ°Ğ»Ğ°"""
    console.print("[cyan]ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Telegram ĞºĞ°Ğ½Ğ°Ğ»Ğ°:[/]")

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ
    current_config = channel_info.get("config", {})
    current_chat_id = current_config.get("chat_id")
    current_bot_token = current_config.get("bot_token")

    # Chat ID
    if current_chat_id:
        console.print(f"[dim]Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ chat_id: {current_chat_id}[/]")
    chat_id = input("Chat ID (Ğ¸Ğ»Ğ¸ Enter Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°): ").strip()
    if not chat_id and current_chat_id:
        chat_id = current_chat_id

    # Bot Token
    if current_bot_token:
        console.print(f"[dim]Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ bot_token: {'*' * len(current_bot_token)}[/]")
    bot_token = input("Bot Token (Ğ¸Ğ»Ğ¸ Enter Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°): ").strip()
    if not bot_token and current_bot_token:
        bot_token = current_bot_token

    # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
    if chat_id and bot_token:
        config["channels"][channel]["config"]["chat_id"] = chat_id
        config["channels"][channel]["config"]["bot_token"] = bot_token
        config["channels"][channel]["status"] = "active"

        _save_notifications_config(config)
        console.print("[green]âœ… Telegram ĞºĞ°Ğ½Ğ°Ğ» Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½[/]")

        # Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ
        if typer.confirm("ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ?"):
            test_message = "Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ SwiftDevBot"
            success = await _send_telegram_notification(
                config["channels"][channel], test_message, "normal"
            )
            if success:
                console.print("[green]âœ… Ğ¢ĞµÑÑ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾ÑˆĞµĞ» ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾![/]")
            else:
                console.print("[red]âŒ Ğ¢ĞµÑÑ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑ[/]")
    else:
        console.print("[yellow]ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Telegram[/]")


async def _configure_email_interactive(
    channel: str, channel_info: Dict[str, Any], config: Dict[str, Any]
):
    """Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Email ĞºĞ°Ğ½Ğ°Ğ»Ğ°"""
    console.print("[cyan]ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Email ĞºĞ°Ğ½Ğ°Ğ»Ğ°:[/]")

    current_config = channel_info.get("config", {})

    # SMTP ÑĞµÑ€Ğ²ĞµÑ€
    smtp_server = input(
        f"SMTP ÑĞµÑ€Ğ²ĞµÑ€ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: {current_config.get('smtp_server', 'smtp.gmail.com')}): "
    ).strip()
    if not smtp_server:
        smtp_server = current_config.get("smtp_server", "smtp.gmail.com")

    # SMTP Ğ¿Ğ¾Ñ€Ñ‚
    smtp_port_input = input(
        f"SMTP Ğ¿Ğ¾Ñ€Ñ‚ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: {current_config.get('smtp_port', 587)}): "
    ).strip()
    smtp_port = (
        int(smtp_port_input)
        if smtp_port_input
        else current_config.get("smtp_port", 587)
    )

    # Ğ£Ñ‡ĞµÑ‚Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    username = input("Email Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: ").strip()
    password = input("Email Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ: ").strip()
    from_email = input("Email Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ĞµĞ»Ñ: ").strip()
    to_email = input("Email Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ĞµĞ»Ñ: ").strip()

    if all([username, password, from_email, to_email]):
        config["channels"][channel]["config"].update(
            {
                "smtp_server": smtp_server,
                "smtp_port": smtp_port,
                "username": username,
                "password": password,
                "from_email": from_email,
                "to_email": to_email,
            }
        )
        config["channels"][channel]["status"] = "active"

        _save_notifications_config(config)
        console.print("[green]âœ… Email ĞºĞ°Ğ½Ğ°Ğ» Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½[/]")

        # Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ
        if typer.confirm("ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ?"):
            test_message = "Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ SwiftDevBot"
            success = await _send_email_notification(
                config["channels"][channel], "Ğ¢ĞµÑÑ‚", test_message, "normal"
            )
            if success:
                console.print("[green]âœ… Ğ¢ĞµÑÑ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾ÑˆĞµĞ» ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾![/]")
            else:
                console.print("[red]âŒ Ğ¢ĞµÑÑ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑ[/]")
    else:
        console.print("[yellow]ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Email[/]")


async def _configure_webhook_interactive(
    channel: str, channel_info: Dict[str, Any], config: Dict[str, Any]
):
    """Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Webhook ĞºĞ°Ğ½Ğ°Ğ»Ğ°"""
    console.print("[cyan]ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Webhook ĞºĞ°Ğ½Ğ°Ğ»Ğ°:[/]")

    current_config = channel_info.get("config", {})
    current_url = current_config.get("url")

    if current_url:
        console.print(f"[dim]Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ URL: {current_url}[/]")

    url = input("Webhook URL: ").strip()
    if not url and current_url:
        url = current_url

    if url:
        config["channels"][channel]["config"]["url"] = url
        config["channels"][channel]["status"] = "active"

        _save_notifications_config(config)
        console.print("[green]âœ… Webhook ĞºĞ°Ğ½Ğ°Ğ» Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½[/]")

        # Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ
        if typer.confirm("ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ?"):
            test_message = "Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ SwiftDevBot"
            success = await _send_webhook_notification(
                config["channels"][channel], test_message, "normal"
            )
            if success:
                console.print("[green]âœ… Ğ¢ĞµÑÑ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾ÑˆĞµĞ» ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾![/]")
            else:
                console.print("[red]âŒ Ğ¢ĞµÑÑ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑ[/]")
    else:
        console.print("[yellow]URL Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½[/]")


async def _configure_slack_interactive(
    channel: str, channel_info: Dict[str, Any], config: Dict[str, Any]
):
    """Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Slack ĞºĞ°Ğ½Ğ°Ğ»Ğ°"""
    console.print("[cyan]ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Slack ĞºĞ°Ğ½Ğ°Ğ»Ğ°:[/]")

    current_config = channel_info.get("config", {})
    current_webhook_url = current_config.get("webhook_url")
    current_channel = current_config.get("channel", "#alerts")

    if current_webhook_url:
        console.print(f"[dim]Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ webhook_url: {'*' * len(current_webhook_url)}[/]")

    webhook_url = input("Slack Webhook URL: ").strip()
    if not webhook_url and current_webhook_url:
        webhook_url = current_webhook_url

    channel_name = input(f"Slack ĞºĞ°Ğ½Ğ°Ğ» (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: {current_channel}): ").strip()
    if not channel_name:
        channel_name = current_channel

    if webhook_url:
        config["channels"][channel]["config"].update(
            {"webhook_url": webhook_url, "channel": channel_name}
        )
        config["channels"][channel]["status"] = "active"

        _save_notifications_config(config)
        console.print("[green]âœ… Slack ĞºĞ°Ğ½Ğ°Ğ» Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½[/]")

        # Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ
        if typer.confirm("ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ?"):
            test_message = "Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ SwiftDevBot"
            success = await _send_slack_notification(
                config["channels"][channel], test_message, "normal"
            )
            if success:
                console.print("[green]âœ… Ğ¢ĞµÑÑ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾ÑˆĞµĞ» ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾![/]")
            else:
                console.print("[red]âŒ Ğ¢ĞµÑÑ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑ[/]")
    else:
        console.print("[yellow]Webhook URL Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½[/]")


if __name__ == "__main__":
    notifications_app()



======================================================================

------------------------------ FILE: Systems/cli/tasks.py ------------------------------
# cli/tasks.py
import asyncio
import json
import subprocess
import uuid
from datetime import datetime, timedelta
from pathlib import Path
from typing import Any, Dict, List, Optional

import psutil
import typer
from rich.console import Console
from rich.panel import Panel
from rich.table import Table

console = Console()
tasks_app = typer.Typer(name="tasks", help="ğŸ“‹ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°Ğ¼Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹")

# ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡
TASKS_DIR = Path("Data/tasks")
TASKS_CONFIG_FILE = TASKS_DIR / "tasks_config.json"
TASKS_LOG_FILE = TASKS_DIR / "tasks.log"


def _ensure_tasks_directory():
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡ ĞµÑĞ»Ğ¸ ĞµÑ‘ Ğ½ĞµÑ‚"""
    TASKS_DIR.mkdir(parents=True, exist_ok=True)
    if not TASKS_CONFIG_FILE.exists():
        with open(TASKS_CONFIG_FILE, "w") as f:
            json.dump({"tasks": {}, "schedules": {}}, f)


def _load_tasks_config() -> Dict[str, Any]:
    """Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡"""
    _ensure_tasks_directory()
    try:
        with open(TASKS_CONFIG_FILE, "r") as f:
            return json.load(f)
    except FileNotFoundError:
        return {"tasks": {}, "schedules": {}}


def _save_tasks_config(config: Dict[str, Any]):
    """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡"""
    _ensure_tasks_directory()
    with open(TASKS_CONFIG_FILE, "w") as f:
        json.dump(config, f, indent=2)


def _log_task_event(task_id: str, event: str, details: str = ""):
    """Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ² Ğ»Ğ¾Ğ³"""
    _ensure_tasks_directory()
    timestamp = datetime.now().isoformat()
    log_entry = f"[{timestamp}] {task_id}: {event}"
    if details:
        log_entry += f" - {details}"

    with open(TASKS_LOG_FILE, "a") as f:
        f.write(log_entry + "\n")


@tasks_app.command(name="list", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ·Ğ°Ğ´Ğ°Ñ‡.")
def tasks_list_cmd(
    status: Optional[str] = typer.Option(
        None,
        "--status",
        "-s",
        help="Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ: running, completed, failed, pending",
    ),
    limit: int = typer.Option(
        20, "--limit", "-l", help="ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ°Ğ´Ğ°Ñ‡", min=1, max=100
    ),
):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ·Ğ°Ğ´Ğ°Ñ‡"""
    try:
        asyncio.run(_tasks_list_async(status, limit))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'tasks list': {e}[/]")
        raise typer.Exit(code=1)


async def _tasks_list_async(status: Optional[str], limit: int):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ·Ğ°Ğ´Ğ°Ñ‡"""
    console.print(
        Panel("[bold blue]Ğ¡ĞŸĞ˜Ğ¡ĞĞš Ğ—ĞĞ”ĞĞ§ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ«[/]", expand=False, border_style="blue")
    )

    config = _load_tasks_config()
    tasks = config.get("tasks", {})

    if not tasks:
        console.print("[yellow]Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹[/]")
        return

    # Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¿Ğ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ
    filtered_tasks = []
    for task_id, task_info in tasks.items():
        if status is None or task_info.get("status") == status:
            filtered_tasks.append((task_id, task_info))

    if not filtered_tasks:
        console.print(f"[yellow]Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ ÑĞ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ¼ '{status}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹[/]")
        return

    # Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ (Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ°)
    filtered_tasks.sort(key=lambda x: x[1].get("created_at", ""), reverse=True)

    # ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾
    filtered_tasks = filtered_tasks[:limit]

    table = Table(title=f"Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ (Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¾: {len(filtered_tasks)})")
    table.add_column("ID", style="cyan")
    table.add_column("ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ", style="white")
    table.add_column("Ğ¢Ğ¸Ğ¿", style="blue")
    table.add_column("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="green")
    table.add_column("Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ°", style="yellow")
    table.add_column("ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ", style="red")

    for task_id, task_info in filtered_tasks:
        created_at = task_info.get("created_at", "")
        if created_at:
            try:
                dt = datetime.fromisoformat(created_at)
                created_str = dt.strftime("%Y-%m-%d %H:%M")
            except:
                created_str = created_at
        else:
            created_str = "N/A"

        status = task_info.get("status", "unknown")
        status_color = {
            "running": "green",
            "completed": "blue",
            "failed": "red",
            "pending": "yellow",
            "cancelled": "red",
        }.get(status, "white")

        progress = task_info.get("progress", "0%")

        table.add_row(
            task_id,
            task_info.get("name", "Ğ‘ĞµĞ· Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ"),
            task_info.get("type", "unknown"),
            f"[{status_color}]{status}[/{status_color}]",
            created_str,
            progress,
        )

    console.print(table)


@tasks_app.command(name="cancel", help="ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ.")
def tasks_cancel_cmd(
    task_id: str = typer.Argument(..., help="ID Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹"),
    force: bool = typer.Option(False, "--force", "-f", help="ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ°"),
):
    """ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ"""
    try:
        asyncio.run(_tasks_cancel_async(task_id, force))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'tasks cancel': {e}[/]")
        raise typer.Exit(code=1)


async def _tasks_cancel_async(task_id: str, force: bool):
    """ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ"""
    console.print(
        Panel(
            f"[bold blue]ĞĞ¢ĞœĞ•ĞĞ Ğ—ĞĞ”ĞĞ§Ğ˜: {task_id}[/]", expand=False, border_style="blue"
        )
    )

    config = _load_tasks_config()
    tasks = config.get("tasks", {})

    if task_id not in tasks:
        console.print(f"[bold red]Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° '{task_id}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°[/]")
        raise typer.Exit(code=1)

    task_info = tasks[task_id]
    status = task_info.get("status", "unknown")

    if status == "completed":
        console.print(f"[yellow]Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° '{task_id}' ÑƒĞ¶Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°[/]")
        return

    if status == "cancelled":
        console.print(f"[yellow]Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° '{task_id}' ÑƒĞ¶Ğµ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°[/]")
        return

    if status == "failed":
        console.print(f"[yellow]Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° '{task_id}' ÑƒĞ¶Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»Ğ°ÑÑŒ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹[/]")
        return

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
    pid = task_info.get("pid")
    if pid and status == "running":
        try:
            process = psutil.Process(pid)
            if not force:
                console.print(f"[yellow]Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° '{task_id}' Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ (PID: {pid})[/]")
                console.print("[dim]Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ --force Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹[/]")
                return

            # ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ
            process.terminate()
            try:
                process.wait(timeout=5)
            except psutil.TimeoutExpired:
                process.kill()

            console.print(f"[green]ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ '{task_id}' (PID: {pid}) Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½[/]")
        except psutil.NoSuchProcess:
            console.print(
                f"[yellow]ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ '{task_id}' (PID: {pid}) Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½[/]"
            )
        except Exception as e:
            console.print(f"[yellow]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°: {e}[/]")

    # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
    task_info["status"] = "cancelled"
    task_info["cancelled_at"] = datetime.now().isoformat()
    task_info["progress"] = "0%"

    _save_tasks_config(config)
    _log_task_event(task_id, "cancelled", f"force={force}")

    console.print(f"[green]Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° '{task_id}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°[/]")


@tasks_app.command(name="schedule", help="Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ.")
def tasks_schedule_cmd(
    task_type: str = typer.Argument(
        ..., help="Ğ¢Ğ¸Ğ¿ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸: backup, cleanup, sync, custom"
    ),
    schedule: str = typer.Option(
        ..., "--schedule", "-s", help="Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ (cron Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ¸Ğ»Ğ¸ 'now')"
    ),
    name: Optional[str] = typer.Option(None, "--name", "-n", help="ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸"),
    params: Optional[str] = typer.Option(
        None, "--params", "-p", help="ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ² JSON"
    ),
):
    """Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ"""
    try:
        asyncio.run(_tasks_schedule_async(task_type, schedule, name, params))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(
            f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'tasks schedule': {e}[/]"
        )
        raise typer.Exit(code=1)


async def _tasks_schedule_async(
    task_type: str, schedule: str, name: Optional[str], params: Optional[str]
):
    """Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ"""
    console.print(
        Panel(
            f"[bold blue]ĞŸĞ›ĞĞĞ˜Ğ ĞĞ’ĞĞĞ˜Ğ• Ğ—ĞĞ”ĞĞ§Ğ˜: {task_type}[/]",
            expand=False,
            border_style="blue",
        )
    )

    # Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¸Ğ¿Ğ° Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
    valid_types = ["backup", "cleanup", "sync", "custom"]
    if task_type not in valid_types:
        console.print(f"[bold red]ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸: {task_type}[/]")
        console.print(f"[dim]Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹: {', '.join(valid_types)}[/]")
        raise typer.Exit(code=1)

    # ĞŸĞ°Ñ€ÑĞ¸Ğ¼ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹
    task_params = {}
    if params:
        try:
            task_params = json.loads(params)
        except json.JSONDecodeError as e:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² JSON Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ°Ñ…: {e}[/]")
            raise typer.Exit(code=1)

    # Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ ID Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
    task_id = f"task_{uuid.uuid4().hex[:8]}"

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğµ
    task_info = {
        "id": task_id,
        "name": name or f"{task_type} task",
        "type": task_type,
        "schedule": schedule,
        "params": task_params,
        "status": "pending",
        "progress": "0%",
        "created_at": datetime.now().isoformat(),
        "scheduled_at": datetime.now().isoformat() if schedule == "now" else None,
    }

    # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
    config = _load_tasks_config()
    config["tasks"][task_id] = task_info

    # Ğ•ÑĞ»Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒÑÑ ÑĞµĞ¹Ñ‡Ğ°Ñ
    if schedule == "now":
        task_info["status"] = "running"
        task_info["started_at"] = datetime.now().isoformat()

        # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾
        asyncio.create_task(_execute_task(task_id, task_info))

    _save_tasks_config(config)
    _log_task_event(task_id, "scheduled", f"type={task_type}, schedule={schedule}")

    console.print(f"[green]Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° '{task_id}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°[/]")
    console.print(f"[dim]Ğ¢Ğ¸Ğ¿: {task_type}[/]")
    console.print(f"[dim]Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ: {schedule}[/]")
    if name:
        console.print(f"[dim]ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ: {name}[/]")


async def _execute_task(task_id: str, task_info: Dict[str, Any]):
    """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ"""
    task_type = task_info["type"]

    try:
        _log_task_event(task_id, "started")

        if task_type == "backup":
            await _execute_backup_task(task_id, task_info)
        elif task_type == "cleanup":
            await _execute_cleanup_task(task_id, task_info)
        elif task_type == "sync":
            await _execute_sync_task(task_id, task_info)
        elif task_type == "custom":
            await _execute_custom_task(task_id, task_info)
        else:
            raise ValueError(f"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸: {task_type}")

        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ½Ğ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ½Ñ‹Ğ¹
        config = _load_tasks_config()
        if task_id in config["tasks"]:
            config["tasks"][task_id]["status"] = "completed"
            config["tasks"][task_id]["progress"] = "100%"
            config["tasks"][task_id]["completed_at"] = datetime.now().isoformat()
            _save_tasks_config(config)
            _log_task_event(task_id, "completed")

    except Exception as e:
        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ½Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ
        config = _load_tasks_config()
        if task_id in config["tasks"]:
            config["tasks"][task_id]["status"] = "failed"
            config["tasks"][task_id]["error"] = str(e)
            config["tasks"][task_id]["failed_at"] = datetime.now().isoformat()
            _save_tasks_config(config)
            _log_task_event(task_id, "failed", str(e))


async def _execute_backup_task(task_id: str, task_info: Dict[str, Any]):
    """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"""
    console.print(f"[cyan]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: {task_id}[/]")

    # Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
    await asyncio.sleep(2)

    # Ğ—Ğ´ĞµÑÑŒ Ğ±Ñ‹Ğ»Ğ° Ğ±Ñ‹ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    console.print(f"[green]Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğµ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾: {task_id}[/]")


async def _execute_cleanup_task(task_id: str, task_info: Dict[str, Any]):
    """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸"""
    console.print(f"[cyan]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸: {task_id}[/]")

    # Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
    await asyncio.sleep(1)

    # Ğ—Ğ´ĞµÑÑŒ Ğ±Ñ‹Ğ»Ğ° Ğ±Ñ‹ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸
    console.print(f"[green]ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°: {task_id}[/]")


async def _execute_sync_task(task_id: str, task_info: Dict[str, Any]):
    """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸"""
    console.print(f"[cyan]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸: {task_id}[/]")

    # Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
    await asyncio.sleep(3)

    # Ğ—Ğ´ĞµÑÑŒ Ğ±Ñ‹Ğ»Ğ° Ğ±Ñ‹ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
    console.print(f"[green]Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°: {task_id}[/]")


async def _execute_custom_task(task_id: str, task_info: Dict[str, Any]):
    """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºÑƒÑ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ"""
    console.print(f"[cyan]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸: {task_id}[/]")

    params = task_info.get("params", {})
    command = params.get("command")

    if command:
        try:
            # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ
            process = await asyncio.create_subprocess_exec(
                *command.split(),
                stdout=asyncio.subprocess.PIPE,
                stderr=asyncio.subprocess.PIPE,
            )

            stdout, stderr = await process.communicate()

            if process.returncode == 0:
                console.print(f"[green]ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾: {command}[/]")
            else:
                raise Exception(f"ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»Ğ°ÑÑŒ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹: {stderr.decode()}")

        except Exception as e:
            raise Exception(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹: {e}")
    else:
        # Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
        await asyncio.sleep(1)
        console.print(f"[green]ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ°Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°: {task_id}[/]")


@tasks_app.command(name="info", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğµ.")
def tasks_info_cmd(task_id: str = typer.Argument(..., help="ID Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸")):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğµ"""
    try:
        asyncio.run(_tasks_info_async(task_id))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'tasks info': {e}[/]")
        raise typer.Exit(code=1)


async def _tasks_info_async(task_id: str):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğµ"""
    console.print(
        Panel(
            f"[bold blue]Ğ˜ĞĞ¤ĞĞ ĞœĞĞ¦Ğ˜Ğ¯ Ğ Ğ—ĞĞ”ĞĞ§Ğ•: {task_id}[/]",
            expand=False,
            border_style="blue",
        )
    )

    config = _load_tasks_config()
    tasks = config.get("tasks", {})

    if task_id not in tasks:
        console.print(f"[bold red]Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° '{task_id}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°[/]")
        raise typer.Exit(code=1)

    task_info = tasks[task_id]

    console.print(f"[cyan]ID:[/] {task_id}")
    console.print(f"[cyan]ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ:[/] {task_info.get('name', 'N/A')}")
    console.print(f"[cyan]Ğ¢Ğ¸Ğ¿:[/] {task_info.get('type', 'N/A')}")
    console.print(f"[cyan]Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:[/] {task_info.get('status', 'N/A')}")
    console.print(f"[cyan]ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ:[/] {task_info.get('progress', 'N/A')}")
    console.print(f"[cyan]Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:[/] {task_info.get('schedule', 'N/A')}")
    console.print(f"[cyan]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ°:[/] {task_info.get('created_at', 'N/A')}")

    if task_info.get("started_at"):
        console.print(f"[cyan]ĞĞ°Ñ‡Ğ°Ñ‚Ğ°:[/] {task_info['started_at']}")

    if task_info.get("completed_at"):
        console.print(f"[cyan]Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°:[/] {task_info['completed_at']}")

    if task_info.get("failed_at"):
        console.print(f"[cyan]ĞÑˆĞ¸Ğ±ĞºĞ°:[/] {task_info['failed_at']}")
        console.print(f"[cyan]Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ:[/] {task_info.get('error', 'N/A')}")

    if task_info.get("cancelled_at"):
        console.print(f"[cyan]ĞÑ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°:[/] {task_info['cancelled_at']}")

    if task_info.get("params"):
        console.print(
            f"[cyan]ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:[/] {json.dumps(task_info['params'], indent=2)}"
        )


if __name__ == "__main__":
    tasks_app()



======================================================================

------------------------------ FILE: Systems/cli/cache.py ------------------------------
# cli/cache.py
import asyncio
import json
import time
from datetime import datetime
from pathlib import Path
from typing import Any, Dict, List, Optional

import typer
from rich.console import Console
from rich.panel import Panel
from rich.table import Table

from Systems.cli.utils import confirm_action

console = Console()
cache_app = typer.Typer(name="cache", help="ğŸ’¾ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºÑÑˆĞµĞ¼ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹")


@cache_app.command(name="clear", help="ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ĞµÑÑŒ ĞºÑÑˆ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.")
def cache_clear_cmd(
    cache_type: Optional[str] = typer.Option(
        None, "--type", "-t", help="Ğ¢Ğ¸Ğ¿ ĞºÑÑˆĞ°: memory, redis, all"
    ),
    confirm: bool = typer.Option(
        False, "--confirm", "-y", help="ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºÑƒ Ğ±ĞµĞ· Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°"
    ),
):
    """ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºÑÑˆ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹"""
    try:
        asyncio.run(_cache_clear_async(cache_type, confirm))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'cache clear': {e}[/]")
        raise typer.Exit(code=1)


async def _get_cache_manager_only():
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ CacheManager Ğ±ĞµĞ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ²ÑĞµÑ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²."""
    try:
        from pathlib import Path

        import yaml

        from Systems.core.app_settings import PROJECT_ROOT_DIR

        # ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ĞºÑÑˆĞ°
        project_data_path = PROJECT_ROOT_DIR / "Data"
        config_file = project_data_path / "Config" / "core_settings.yaml"

        # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞºÑÑˆĞ° Ğ¸Ğ· YAML
        cache_config = {"type": "memory", "ttl": 300, "max_size": 1024}
        if config_file.exists():
            try:
                with open(config_file, "r", encoding="utf-8") as f:
                    yaml_data = yaml.safe_load(f) or {}
                    if "cache" in yaml_data:
                        cache_config.update(yaml_data["cache"])
            except Exception:
                pass  # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ñ‹

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº ĞºÑÑˆĞ°
        class CacheSettings:
            def __init__(self, config):
                self.type = config.get("type", "memory")
                self.ttl = config.get("ttl", 300)
                self.max_size = config.get("max_size", 1024)
                # Redis Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ñ‹)
                self.redis_url = config.get("redis_url", "redis://localhost:6379/0")
                self.redis_password = config.get("redis_password")

        cache_settings = CacheSettings(cache_config)

        from Systems.core.cache.manager import CacheManager

        cache_manager = CacheManager(cache_settings=cache_settings)
        await cache_manager.initialize()

        return cache_manager

    except Exception as e:
        console.print(f"[bold red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ĞºÑÑˆĞ°: {e}[/]")
        raise


async def _cache_clear_async(cache_type: Optional[str], confirm: bool):
    """ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºÑÑˆ"""
    console.print(
        Panel("[bold blue]ĞĞ§Ğ˜Ğ¡Ğ¢ĞšĞ ĞšĞ­Ğ¨Ğ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ«[/]", expand=False, border_style="blue")
    )

    if not confirm:
        cache_type_display = cache_type or "memory"
        if not confirm_action(
            f"Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºÑÑˆ {cache_type_display}?",
            default_choice=False,
            abort_on_false=False,
        ):
            console.print("[yellow]âš ï¸ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ĞºÑÑˆĞ° Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°.[/]")
            return

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ cache_manager (Ğ»ĞµĞ³ĞºĞ¾Ğ²ĞµÑĞ½Ğ°Ñ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ)
    try:
        cache_manager = await _get_cache_manager_only()
        cleared_count = 0

        # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ‚Ğ¸Ğ¿ ĞºÑÑˆĞ° Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
        if cache_type is None:
            cache_type = "memory"  # ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ memory ĞºÑÑˆ

        if cache_type == "memory" or cache_type == "all":
            console.print("[cyan]ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° memory ĞºÑÑˆĞ°...[/]")
            try:
                if cache_manager.is_available():
                    await cache_manager.clear_all_cache()
                    console.print("[green]âœ… Memory ĞºÑÑˆ Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½.[/]")
                    cleared_count += 1
                else:
                    console.print("[yellow]âš ï¸ Memory ĞºÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.[/]")
            except Exception as e:
                console.print(f"[yellow]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞµ memory ĞºÑÑˆĞ°: {e}[/]")

        if cache_type == "redis" or cache_type == "all":
            console.print("[cyan]ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Redis ĞºÑÑˆĞ°...[/]")
            try:
                redis_client = await cache_manager.get_redis_client_instance()
                if redis_client:
                    await redis_client.flushdb()
                    console.print("[green]âœ… Redis ĞºÑÑˆ Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½.[/]")
                    cleared_count += 1
                else:
                    console.print(
                        "[yellow]âš ï¸ Redis ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½.[/]"
                    )
            except Exception as e:
                console.print(f"[yellow]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞµ Redis ĞºÑÑˆĞ°: {e}[/]")

        if cleared_count > 0:
            console.print(
                f"[bold green]ğŸ‰ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ĞºÑÑˆĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾! ĞÑ‡Ğ¸Ñ‰ĞµĞ½Ğ¾ Ñ‚Ğ¸Ğ¿Ğ¾Ğ² ĞºÑÑˆĞ°: {cleared_count}[/]"
            )
        else:
            console.print("[yellow]âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ½Ğ¸ Ğ¾Ğ´Ğ¸Ğ½ Ñ‚Ğ¸Ğ¿ ĞºÑÑˆĞ°.[/]")

        # ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
        await cache_manager.dispose()

    except Exception as e:
        console.print(f"[bold red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞµ ĞºÑÑˆĞ°: {e}[/]")
        raise typer.Exit(code=1)


@cache_app.command(name="stats", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ ĞºÑÑˆĞ°.")
def cache_stats_cmd(
    cache_type: Optional[str] = typer.Option(
        None, "--type", "-t", help="Ğ¢Ğ¸Ğ¿ ĞºÑÑˆĞ°: memory, redis, all"
    ),
    format: str = typer.Option(
        "table", "--format", "-f", help="Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°: table, json"
    ),
):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ ĞºÑÑˆĞ°"""
    try:
        asyncio.run(_cache_stats_async(cache_type, format))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'cache stats': {e}[/]")
        raise typer.Exit(code=1)


async def _cache_stats_async(cache_type: Optional[str], format: str):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ ĞºÑÑˆĞ°"""
    console.print(
        Panel("[bold blue]Ğ¡Ğ¢ĞĞ¢Ğ˜Ğ¡Ğ¢Ğ˜ĞšĞ ĞšĞ­Ğ¨Ğ[/]", expand=False, border_style="blue")
    )

    try:
        cache_manager = await _get_cache_manager_only()
        stats = {}

        # Memory ĞºÑÑˆ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
        if cache_type in ["memory", None]:
            console.print("[cyan]Ğ¡Ğ±Ğ¾Ñ€ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ memory ĞºÑÑˆĞ°...[/]")
            try:
                memory_stats = {
                    "type": "memory",
                    "status": (
                        "available" if cache_manager.is_available() else "unavailable"
                    ),
                    "backend": "TTLCache",
                    "maxsize": "1024",
                    "default_ttl": "300s",
                    "current_size": "N/A",
                    "hit_count": "N/A",
                    "miss_count": "N/A",
                }

                # ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ğ»ĞµĞµ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½ÑƒÑ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ
                if hasattr(cache_manager, "_cache"):
                    cache_obj = cache_manager._cache
                    if hasattr(cache_obj, "__len__"):
                        memory_stats["current_size"] = str(len(cache_obj))
                    if hasattr(cache_obj, "hits"):
                        memory_stats["hit_count"] = str(cache_obj.hits)
                    if hasattr(cache_obj, "misses"):
                        memory_stats["miss_count"] = str(cache_obj.misses)

                stats["memory"] = memory_stats
            except Exception as e:
                stats["memory"] = {"type": "memory", "status": "error", "error": str(e)}

        # Redis ĞºÑÑˆ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
        if cache_type in ["redis", None]:
            console.print("[cyan]Ğ¡Ğ±Ğ¾Ñ€ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Redis ĞºÑÑˆĞ°...[/]")
            redis_client = await cache_manager.get_redis_client_instance()
            if redis_client:
                try:
                    info = await redis_client.info()
                    redis_stats = {
                        "type": "redis",
                        "status": "available",
                        "connected_clients": info.get("connected_clients", "N/A"),
                        "used_memory_human": info.get("used_memory_human", "N/A"),
                        "total_commands_processed": info.get(
                            "total_commands_processed", "N/A"
                        ),
                        "keyspace_hits": info.get("keyspace_hits", "N/A"),
                        "keyspace_misses": info.get("keyspace_misses", "N/A"),
                        "total_keys": info.get("db0", {}).get("keys", "N/A"),
                        "uptime_seconds": info.get("uptime_in_seconds", "N/A"),
                    }

                    # Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ hit ratio
                    hits = int(info.get("keyspace_hits", 0))
                    misses = int(info.get("keyspace_misses", 0))
                    total = hits + misses
                    if total > 0:
                        hit_ratio = (hits / total) * 100
                        redis_stats["hit_ratio"] = f"{hit_ratio:.2f}%"
                    else:
                        redis_stats["hit_ratio"] = "N/A"

                except Exception as e:
                    redis_stats = {"type": "redis", "status": "error", "error": str(e)}
            else:
                redis_stats = {"type": "redis", "status": "unavailable"}

            stats["redis"] = redis_stats

        # ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
        await _display_cache_stats(stats, format)

        # ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
        await cache_manager.dispose()

    except Exception as e:
        console.print(f"[bold red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ±Ğ¾Ñ€Ğµ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ ĞºÑÑˆĞ°: {e}[/]")
        raise typer.Exit(code=1)


async def _display_cache_stats(stats: dict, format: str):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ ĞºÑÑˆĞ°"""

    if format == "json":
        console.print(json.dumps(stats, indent=2, ensure_ascii=False))
        return

    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚
    for cache_type, cache_stats in stats.items():
        console.print(f"\n[bold cyan]{cache_type.upper()} ĞšĞ­Ğ¨:[/]")

        table = Table()
        table.add_column("ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€", style="cyan")
        table.add_column("Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ", style="white")

        for key, value in cache_stats.items():
            if key != "type":
                table.add_row(key, str(value))

        console.print(table)


@cache_app.command(name="keys", help="Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ ĞºÑÑˆĞ°.")
def cache_keys_cmd(
    action: str = typer.Argument(..., help="Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: list, get, delete, search, info"),
    pattern: Optional[str] = typer.Option(
        None, "--pattern", "-p", help="Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° ĞºĞ»ÑÑ‡ĞµĞ¹"
    ),
    key: Optional[str] = typer.Option(None, "--key", "-k", help="ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡"),
    cache_type: Optional[str] = typer.Option(
        None, "--type", "-t", help="Ğ¢Ğ¸Ğ¿ ĞºÑÑˆĞ°: memory, redis"
    ),
    limit: int = typer.Option(
        50, "--limit", "-l", help="ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ"
    ),
):
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ ĞºÑÑˆĞ°"""
    try:
        asyncio.run(_cache_keys_async(action, pattern, key, cache_type, limit))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'cache keys': {e}[/]")
        raise typer.Exit(code=1)


async def _cache_keys_async(
    action: str,
    pattern: Optional[str],
    key: Optional[str],
    cache_type: Optional[str],
    limit: int,
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ ĞºÑÑˆĞ°"""
    console.print(
        Panel(
            "[bold blue]Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞšĞ›Ğ®Ğ§ĞĞœĞ˜ ĞšĞ­Ğ¨Ğ[/]", expand=False, border_style="blue"
        )
    )

    try:
        cache_manager = await _get_cache_manager_only()

        if action == "list":
            await _list_cache_keys(cache_manager, pattern or "*", limit)
        elif action == "get":
            if not key:
                console.print(
                    "[bold red]Ğ”Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ 'get' Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ĞºĞ»ÑÑ‡ (--key).[/]"
                )
                raise typer.Exit(code=1)
            await _get_cache_key_value(cache_manager, key)
        elif action == "delete":
            if not key:
                console.print(
                    "[bold red]Ğ”Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ 'delete' Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ĞºĞ»ÑÑ‡ (--key).[/]"
                )
                raise typer.Exit(code=1)
            await _delete_cache_key(cache_manager, key, auto_confirm=False)
        elif action == "search":
            if not pattern:
                console.print(
                    "[bold red]Ğ”Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ 'search' Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ (--pattern).[/]"
                )
                raise typer.Exit(code=1)
            await _search_cache_keys(cache_manager, pattern, limit)
        elif action == "info":
            await _cache_keys_info(cache_manager)
        else:
            console.print(f"[bold red]ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: {action}[/]")
            console.print("[dim]Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ: list, get, delete, search, info[/]")
            raise typer.Exit(code=1)

        # ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
        await cache_manager.dispose()

    except Exception as e:
        console.print(f"[bold red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ Ñ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ ĞºÑÑˆĞ°: {e}[/]")
        raise typer.Exit(code=1)


async def _list_cache_keys(cache_manager, pattern: str, limit: int):
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ»ÑÑ‡ĞµĞ¹ ĞºÑÑˆĞ°"""
    console.print(
        f"[cyan]ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° ĞºĞ»ÑÑ‡ĞµĞ¹ ĞºÑÑˆĞ° (Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½: {pattern}, Ğ»Ğ¸Ğ¼Ğ¸Ñ‚: {limit})...[/]"
    )

    if not cache_manager.is_available():
        console.print("[yellow]âš ï¸ ĞšÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.[/]")
        return

    keys = await cache_manager.keys(pattern)

    if not keys:
        console.print("[yellow]ğŸ“­ ĞšĞ»ÑÑ‡Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹.[/]")
        return

    # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
    displayed_keys = keys[:limit] if len(keys) > limit else keys

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ
    table = Table(title=f"ĞšĞ»ÑÑ‡Ğ¸ ĞºÑÑˆĞ° ({len(displayed_keys)} Ğ¸Ğ· {len(keys)})")
    table.add_column("#", style="dim", width=4)
    table.add_column("ĞšĞ»ÑÑ‡", style="cyan")
    table.add_column("Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚", justify="center", width=10)

    for i, cache_key in enumerate(displayed_keys, 1):
        exists = await cache_manager.exists(cache_key)
        status = "[green]âœ“[/]" if exists else "[red]âœ—[/]"
        table.add_row(str(i), cache_key, status)

    console.print(table)

    if len(keys) > limit:
        console.print(
            f"[dim]ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ½Ñ‹ Ğ¿ĞµÑ€Ğ²Ñ‹Ğµ {limit} ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ¸Ğ· {len(keys)}. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ --limit Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ°.[/]"
        )


async def _get_cache_key_value(cache_manager, key: str):
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ° ĞºÑÑˆĞ°"""
    console.print(f"[cyan]ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ°: [bold]{key}[/]")

    if not cache_manager.is_available():
        console.print("[yellow]âš ï¸ ĞšÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.[/]")
        return

    try:
        value = await cache_manager.get(key)

        if value is None:
            console.print(
                f"[yellow]ğŸ“­ ĞšĞ»ÑÑ‡ '{key}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¸Ğ»Ğ¸ ĞµĞ³Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ²Ğ½Ğ¾ None.[/]"
            )
            return

        # Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²Ñ‹Ğ²Ğ¾Ğ´ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ñ‚Ğ¸Ğ¿Ğ° Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ
        table = Table(title=f"Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ°: {key}")
        table.add_column("Ğ¡Ğ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾", style="cyan", width=15)
        table.add_column("Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ", style="white")

        table.add_row("Ğ¢Ğ¸Ğ¿", str(type(value).__name__))
        table.add_row("Ğ Ğ°Ğ·Ğ¼ĞµÑ€", f"{len(str(value))} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²")

        # ĞĞ±Ñ€ĞµĞ·Ğ°ĞµĞ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
        display_value = str(value)
        if len(display_value) > 500:
            display_value = display_value[:497] + "..."

        table.add_row("Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ", display_value)

        console.print(table)

    except Exception as e:
        console.print(
            f"[bold red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ° '{key}': {e}[/]"
        )


async def _delete_cache_key(cache_manager, key: str, auto_confirm: bool = False):
    """Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ĞºĞ»ÑÑ‡ Ğ¸Ğ· ĞºÑÑˆĞ°"""
    console.print(f"[cyan]Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ°: [bold]{key}[/]")

    if not cache_manager.is_available():
        console.print("[yellow]âš ï¸ ĞšÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.[/]")
        return

    try:
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ°
        exists = await cache_manager.exists(key)
        if not exists:
            console.print(f"[yellow]ğŸ“­ ĞšĞ»ÑÑ‡ '{key}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² ĞºÑÑˆĞµ.[/]")
            return

        # ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ
        if not auto_confirm and not confirm_action(
            f"Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ĞºĞ»ÑÑ‡ '{key}'?",
            default_choice=False,
            abort_on_false=False,
        ):
            console.print("[yellow]âš ï¸ Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ° Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾.[/]")
            return

        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ĞºĞ»ÑÑ‡
        deleted = await cache_manager.delete(key)

        if deleted:
            console.print(f"[green]âœ… ĞšĞ»ÑÑ‡ '{key}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½ Ğ¸Ğ· ĞºÑÑˆĞ°.[/]")
        else:
            console.print(
                f"[yellow]âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ĞºĞ»ÑÑ‡ '{key}' (Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ¾Ğ½ ÑƒĞ¶Ğµ Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚).[/]"
            )

    except Exception as e:
        console.print(f"[bold red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ĞºĞ»ÑÑ‡Ğ° '{key}': {e}[/]")


async def _search_cache_keys(cache_manager, pattern: str, limit: int):
    """ĞŸĞ¾Ğ¸ÑĞº ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ¿Ğ¾ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ"""
    console.print(
        f"[cyan]ĞŸĞ¾Ğ¸ÑĞº ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ¿Ğ¾ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ: [bold]{pattern}[/] (Ğ»Ğ¸Ğ¼Ğ¸Ñ‚: {limit})"
    )

    if not cache_manager.is_available():
        console.print("[yellow]âš ï¸ ĞšÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.[/]")
        return

    try:
        keys = await cache_manager.keys(pattern)

        if not keys:
            console.print(f"[yellow]ğŸ“­ ĞšĞ»ÑÑ‡Ğ¸ Ğ¿Ğ¾ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ '{pattern}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹.[/]")
            return

        # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚
        displayed_keys = keys[:limit] if len(keys) > limit else keys

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
        table = Table(
            title=f"Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ğ¾Ğ¸ÑĞºĞ°: {pattern} ({len(displayed_keys)} Ğ¸Ğ· {len(keys)})"
        )
        table.add_column("#", style="dim", width=4)
        table.add_column("ĞšĞ»ÑÑ‡", style="cyan")
        table.add_column("Ğ”Ğ»Ğ¸Ğ½Ğ° Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ", justify="center", width=15)

        for i, cache_key in enumerate(displayed_keys, 1):
            try:
                value = await cache_manager.get(cache_key)
                value_length = len(str(value)) if value is not None else 0
                table.add_row(str(i), cache_key, str(value_length))
            except:
                table.add_row(str(i), cache_key, "[red]Ğ¾ÑˆĞ¸Ğ±ĞºĞ°[/]")

        console.print(table)

        if len(keys) > limit:
            console.print(
                f"[dim]ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ½Ñ‹ Ğ¿ĞµÑ€Ğ²Ñ‹Ğµ {limit} Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² Ğ¸Ğ· {len(keys)}. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ --limit Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ°.[/]"
            )

    except Exception as e:
        console.print(f"[bold red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¸ÑĞºĞµ ĞºĞ»ÑÑ‡ĞµĞ¹: {e}[/]")


async def _cache_keys_info(cache_manager):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¾Ğ±Ñ‰ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ĞºĞ»ÑÑ‡Ğ°Ñ… ĞºÑÑˆĞ°"""
    console.print("[cyan]ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ ĞºĞ»ÑÑ‡Ğ°Ñ… ĞºÑÑˆĞ°...[/]")

    if not cache_manager.is_available():
        console.print("[yellow]âš ï¸ ĞšÑÑˆ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.[/]")
        return

    try:
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¾Ğ±Ñ‰ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ĞºÑÑˆĞµ
        cache_info = await cache_manager.get_cache_info()

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸
        table = Table(title="Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ĞºĞ»ÑÑ‡Ğ°Ñ… ĞºÑÑˆĞ°")
        table.add_column("ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€", style="cyan", width=20)
        table.add_column("Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ", style="white")

        for key, value in cache_info.items():
            if key != "type":
                display_value = str(value)
                if key == "available":
                    display_value = "[green]âœ“[/]" if value else "[red]âœ—[/]"
                table.add_row(key.replace("_", " ").title(), display_value)

        console.print(table)

        # Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼ ĞºĞ»ÑÑ‡ĞµĞ¹, ĞµÑĞ»Ğ¸ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾
        try:
            all_keys = await cache_manager.keys("*")
            if all_keys:
                console.print(f"\n[dim]ğŸ’¡ Ğ’ÑĞµĞ³Ğ¾ ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ² ĞºÑÑˆĞµ: {len(all_keys)}[/]")

                # Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ»ÑÑ‡Ğ¸ Ğ¿Ğ¾ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ°Ğ¼
                prefixes = {}
                for key in all_keys[:100]:  # ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼Ğ¸ 100 ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸
                    prefix = key.split(":")[0] if ":" in key else "other"
                    prefixes[prefix] = prefixes.get(prefix, 0) + 1

                if len(prefixes) > 1:
                    console.print(
                        "\n[cyan]Ğ Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ¿Ğ¾ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ°Ğ¼ (Ñ‚Ğ¾Ğ¿-10):[/]"
                    )
                    sorted_prefixes = sorted(
                        prefixes.items(), key=lambda x: x[1], reverse=True
                    )[:10]
                    for prefix, count in sorted_prefixes:
                        console.print(f"  {prefix}: {count}")
        except:
            pass  # Ğ˜Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸

    except Exception as e:
        console.print(f"[bold red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ ĞºÑÑˆĞµ: {e}[/]")


if __name__ == "__main__":
    cache_app()



======================================================================

------------------------------ FILE: Systems/cli/config.py ------------------------------
# --- ĞĞĞ§ĞĞ›Ğ Ğ¤ĞĞ™Ğ›Ğ cli/config.py ---
import sys
from pathlib import Path
from typing import Any, Dict, List, Optional, Literal, Tuple

import typer
import yaml
from dotenv import find_dotenv, set_key
from rich.console import Console
from rich.panel import Panel
from rich.syntax import Syntax

from .utils import (PROJECT_ROOT, USER_CONFIG_DIR_NAME,
                    USER_CORE_CONFIG_FILENAME, USER_MODULES_CONFIG_DIR_NAME,
                    confirm_action, read_yaml_file, sdb_console,
                    write_yaml_file)

# --- Typer App Ğ´Ğ»Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ 'config' ---
config_app = typer.Typer(
    name="config",
    help="ğŸ”§ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸ĞµĞ¹ SwiftDevBot (Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ, Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€, Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ).",
    rich_markup_mode="rich",
    no_args_is_help=True,
)

storage_app = typer.Typer(
    name="storage",
    help="ğŸ” Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ backendĞ¾Ğ¼ FSM storage Ğ¸ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸ĞµĞ¼ cache type.",
    rich_markup_mode="rich",
    no_args_is_help=True,
)

db_config_app = typer.Typer(
    name="db",
    help="ğŸ—„ï¸ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….",
    rich_markup_mode="rich",
    no_args_is_help=True,
)

ENV_FILENAME = ".env"


# --- Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ ---
def _update_env_file(key: str, value: str) -> bool:
    """Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ .env Ñ„Ğ°Ğ¹Ğ»."""
    env_path = find_dotenv(
        filename=ENV_FILENAME, usecwd=True, raise_error_if_not_found=False
    )
    if not env_path:
        env_path = PROJECT_ROOT / ENV_FILENAME
        sdb_console.print(
            f"[dim]Ğ¤Ğ°Ğ¹Ğ» .env Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½, Ğ±ÑƒĞ´ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ğ½Ğ¾Ğ²Ñ‹Ğ¹: {env_path}[/dim]"
        )
        env_path.touch()
    try:
        set_key(
            dotenv_path=env_path,
            key_to_set=key,
            value_to_set=value,
            quote_mode="always",
        )
        sdb_console.print(
            f"[green]âœ“[/] ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ [cyan]{key}[/] ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ° Ğ² [yellow]{env_path}[/yellow]"
        )
        return True
    except Exception as e:
        sdb_console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ² .env Ñ„Ğ°Ğ¹Ğ» ({env_path}): {e}[/bold red]"
        )
        return False


def _get_project_data_path() -> Path:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¿ÑƒÑ‚ÑŒ Ğº Data (Ğ±Ñ‹Ğ»Ğ¾ project_data), Ğ´Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞµÑ‰Ğµ Ğ½Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹."""
    from Systems.core.app_settings import CoreAppSettings

    default_path = CoreAppSettings.model_fields["project_data_path"].default
    return (PROJECT_ROOT / default_path).resolve()


# --- ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ CLI ---


@config_app.command(
    name="init", help="Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ±Ğ¾Ñ‚Ğ° Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸."
)
def init_command(
    force: bool = typer.Option(
        False, "--force", "-f", help="ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¸."
    )
):
    """Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ²Ğ¸Ğ·Ğ°Ñ€Ğ´ Ğ´Ğ»Ñ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ±Ğ¾Ñ‚Ğ°."""
    sdb_console.print(
        Panel("ğŸ¤– [bold cyan]Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‰Ğ¸Ğº SwiftDevBot[/]", expand=False)
    )

    # Ğ¨Ğ°Ğ³ 1: Ğ¢Ğ¾ĞºĞµĞ½ Ğ‘Ğ¾Ñ‚Ğ°
    sdb_console.print("\n--- [bold]Ğ¨Ğ°Ğ³ 1: Ğ¢Ğ¾ĞºĞµĞ½ Telegram Ğ‘Ğ¾Ñ‚Ğ°[/bold] ---")
    bot_token = typer.prompt(
        "ğŸ”‘ Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°Ñˆ BOT_TOKEN (Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñƒ @BotFather)", hide_input=True
    )
    if not bot_token or len(bot_token.split(":")) != 2:
        sdb_console.print(
            "[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ¢Ğ¾ĞºĞµĞ½ Ğ²Ñ‹Ğ³Ğ»ÑĞ´Ğ¸Ñ‚ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ğ½Ğ°.[/bold red]"
        )
        raise typer.Exit(1)
    _update_env_file("BOT_TOKEN", bot_token)

    # Ğ¨Ğ°Ğ³ 2: Ğ‘Ğ°Ğ·Ğ° Ğ”Ğ°Ğ½Ğ½Ñ‹Ñ…
    sdb_console.print("\n--- [bold]Ğ¨Ğ°Ğ³ 2: Ğ‘Ğ°Ğ·Ğ° Ğ”Ğ°Ğ½Ğ½Ñ‹Ñ…[/bold] ---")
    db_type_choice = typer.prompt(
        "ğŸ—„ï¸ Ğ¢Ğ¸Ğ¿ Ğ‘Ğ”: [1] sqlite, [2] postgresql, [3] mysql", default="1"
    )

    env_vars_to_set: Dict[str, str] = {}
    if db_type_choice == "1":
        env_vars_to_set["SDB_DB_TYPE"] = "sqlite"
        env_vars_to_set["SDB_DB_SQLITE_PATH"] = "Database_files/swiftdevbot.db"
    elif db_type_choice in ["2", "3"]:
        db_type = "postgresql" if db_type_choice == "2" else "mysql"
        sdb_console.print(f"--- [bold]ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° {db_type.capitalize()}[/bold] ---")
        host = typer.prompt("  ğŸŒ Ğ¥Ğ¾ÑÑ‚", default="localhost")
        port = typer.prompt(
            "  ğŸšª ĞŸĞ¾Ñ€Ñ‚", default="5432" if db_type == "postgresql" else "3306"
        )
        user = typer.prompt("  ğŸ‘¤ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ")
        password = typer.prompt("  ğŸ”’ ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ", hide_input=True)
        dbname = typer.prompt("  ğŸ’¾ Ğ˜Ğ¼Ñ Ğ‘Ğ”")
        driver = "psycopg" if db_type == "postgresql" else "aiomysql"
        dsn = f"{db_type}+{driver}://{user}:{password}@{host}:{port}/{dbname}"
        if db_type == "mysql":
            dsn += "?charset=utf8mb4"
        env_vars_to_set["SDB_DB_TYPE"] = db_type
        env_key = "SDB_DB_PG_DSN" if db_type == "postgresql" else "SDB_DB_MYSQL_DSN"
        env_vars_to_set[env_key] = dsn
    else:
        sdb_console.print("[bold red]ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ğ½Ğ°.[/bold red]")
        raise typer.Exit(1)

    for key, value in env_vars_to_set.items():
        _update_env_file(key, value)

    # Ğ¨Ğ°Ğ³ 3: Ğ¡ÑƒĞ¿ĞµÑ€-ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€
    sdb_console.print("\n--- [bold]Ğ¨Ğ°Ğ³ 3: Ğ¡ÑƒĞ¿ĞµÑ€-ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€[/bold] ---")
    super_admin_id = typer.prompt("ğŸ‘‘ Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°Ñˆ Telegram ID (Ñ‡Ğ¸ÑĞ»Ğ¾Ğ²Ğ¾Ğ¹)")
    if not super_admin_id.isdigit():
        sdb_console.print(
            "[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Telegram ID Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼.[/bold red]"
        )
        raise typer.Exit(1)
    _update_env_file("SDB_CORE_SUPER_ADMINS", super_admin_id)

    # Ğ¨Ğ°Ğ³ 4: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ core_settings.yaml
    sdb_console.print("\n--- [bold]Ğ¨Ğ°Ğ³ 4: Ğ¤Ğ°Ğ¹Ğ» Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº[/bold] ---")
    project_data_path = _get_project_data_path()
    user_config_file = (
        project_data_path / USER_CONFIG_DIR_NAME / USER_CORE_CONFIG_FILENAME
    )

    if (
        user_config_file.exists()
        and not force
        and not confirm_action(
            f"Ğ¤Ğ°Ğ¹Ğ» {user_config_file} ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚. ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ĞµĞ³Ğ¾?",
            default_choice=False,
            abort_on_false=False,
        )
    ):
        sdb_console.print("[yellow]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ core_settings.yaml Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾.[/yellow]")
    else:
        from Systems.core.app_settings import AppSettings

        default_settings = AppSettings(telegram={"token": "dummy"}).model_dump(
            exclude_defaults=False
        )
        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ĞºĞ»ÑÑ‡Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ² .env
        del default_settings["telegram"]
        del default_settings["db"]
        del default_settings["core"]["super_admins"]

        if write_yaml_file(user_config_file, default_settings):
            sdb_console.print(
                f"[green]âœ“[/] Ğ¤Ğ°Ğ¹Ğ» [yellow]{user_config_file}[/yellow] ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½."
            )

    sdb_console.print(
        Panel("âœ… [bold green]ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°![/]", expand=False)
    )
    sdb_console.print("ğŸ’¡ [bold]Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑˆĞ°Ğ³:[/bold] [cyan]sdb db upgrade head[/cyan]")


@config_app.command(
    "get", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ²ÑÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ»Ğ¸ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ°."
)
def get_command(
    key: Optional[str] = typer.Argument(None, help="ĞšĞ»ÑÑ‡ (Ğ½Ğ°Ğ¿Ñ€. 'db.type')"),
    show_defaults: bool = typer.Option(False, "--show-defaults"),
):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ SDB."""
    try:
        from Systems.core.app_settings import settings

        # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ² app_settings
    except Exception as e:
        sdb_console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº: {e}[/bold red]")
        raise typer.Exit(1)

    if key is None:
        config_dict = settings.model_dump(
            mode="json", exclude_defaults=not show_defaults
        )
        yaml_output = yaml.dump(config_dict, indent=2, sort_keys=False)
        sdb_console.print(
            Panel("[bold cyan]ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ SwiftDevBot[/]", expand=False)
        )
        sdb_console.print(
            Syntax(yaml_output, "yaml", theme="native", line_numbers=True)
        )
    else:
        try:
            value = settings
            for part in key.split("."):
                value = getattr(value, part) if hasattr(value, part) else value[part]  # type: ignore

            if hasattr(value, "model_dump"):
                value = value.model_dump(mode="json")

            # ĞšÑ€Ğ°ÑĞ¸Ğ²Ğ¾Ğµ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ
            sdb_console.print(Panel(f"[bold cyan]ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ: {key}[/]", expand=False))

            if isinstance(value, dict):
                yaml_output = yaml.dump(value, indent=2, sort_keys=False)
                sdb_console.print(Syntax(yaml_output, "yaml", theme="native"))
            else:
                sdb_console.print(f"   [green]Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:[/green] {value}")
                sdb_console.print(f"   [blue]Ğ¢Ğ¸Ğ¿:[/blue] {type(value).__name__}")

        except (AttributeError, KeyError):
            sdb_console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞšĞ»ÑÑ‡ '{key}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.[/bold red]")
            raise typer.Exit(1)


@config_app.command("set", help="Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ² core_settings.yaml Ğ¸Ğ»Ğ¸ .env.")
def set_command(
    key: str = typer.Argument(..., help="ĞšĞ»ÑÑ‡ Ğ´Ğ»Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ (Ğ½Ğ°Ğ¿Ñ€. 'core.log_level')"),
    value: str = typer.Argument(..., help="ĞĞ¾Ğ²Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ."),
):
    """Ğ˜Ğ·Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑĞ´Ñ€Ğ° Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ."""
    sdb_console.print(
        f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ [cyan]{key}[/] = [green]'{value}'[/green]..."
    )

    # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ½Ğµ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ ÑÑ‚Ğ¾ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
    env_map = {
        "telegram.token": "BOT_TOKEN",
        "db.pg_dsn": "SDB_DB_PG_DSN",
        "db.mysql_dsn": "SDB_DB_MYSQL_DSN",
        "core.super_admins": "SDB_CORE_SUPER_ADMINS",
    }
    if key.lower() in env_map:
        _update_env_file(env_map[key.lower()], value)
        return

    # Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚, Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµĞ¼ Ñ core_settings.yaml
    project_data_path = _get_project_data_path()
    config_file = project_data_path / USER_CONFIG_DIR_NAME / USER_CORE_CONFIG_FILENAME
    config_data = read_yaml_file(config_file)
    if config_data is None:
        sdb_console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ» {config_file}.[/bold red]\nĞ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ 'sdb config init', Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞµĞ³Ğ¾."
        )
        raise typer.Exit(1)

    keys = key.split(".")
    current_level = config_data
    for i, k in enumerate(keys[:-1]):
        if k not in current_level or not isinstance(current_level[k], dict):
            current_level[k] = {}
        current_level = current_level[k]

    # ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµĞ¼ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ² Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿, ĞµÑĞ»Ğ¸ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾
    final_value: Any = value
    if value.lower() in ["true", "false"]:
        final_value = value.lower() == "true"
    elif value.isdigit():
        final_value = int(value)
    else:
        try:
            final_value = float(value)
        except ValueError:
            pass

    current_level[keys[-1]] = final_value

    if write_yaml_file(config_file, config_data):
        sdb_console.print(
            f"[green]âœ“[/] ĞšĞ»ÑÑ‡ [cyan]{key}[/] Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ² [yellow]{config_file}[/yellow]."
        )
        sdb_console.print(
            "[yellow]Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²ÑÑ‚ÑƒĞ¿ÑÑ‚ Ğ² ÑĞ¸Ğ»Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ±Ğ¾Ñ‚Ğ°.[/yellow]"
        )


def _write_cache_config(cache_type: Literal["memory", "redis"], redis_url: Optional[str]) -> None:
    project_data_path = _get_project_data_path()
    config_file = project_data_path / USER_CONFIG_DIR_NAME / USER_CORE_CONFIG_FILENAME
    config_data = read_yaml_file(config_file) or {}
    cache_section = config_data.get("cache", {})
    cache_section["type"] = cache_type
    if cache_type == "redis":
        cache_section["redis_url"] = redis_url or cache_section.get("redis_url", "redis://localhost:6379/0")
    else:
        cache_section.pop("redis_url", None)
    config_data["cache"] = cache_section

    if write_yaml_file(config_file, config_data):
        sdb_console.print(
            f"[green]âœ“[/] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞºÑÑˆĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ² {config_file} (cache.type={cache_type})."
        )
        if cache_type == "redis":
            sdb_console.print(f"[dim]redis_url={cache_section.get('redis_url')}[/]")
        sdb_console.print("[yellow]ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ±Ğ¾Ñ‚, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²ÑÑ‚ÑƒĞ¿Ğ¸Ğ»Ğ¸ Ğ² ÑĞ¸Ğ»Ñƒ.[/yellow]")


@storage_app.command("set", help="Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿ ĞºÑÑˆĞ°/Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğ° FSM.")
def storage_set(
    cache_type: Literal["memory", "redis"] = typer.Argument(
        ...,
        help="Ğ¢Ğ¸Ğ¿ ĞºÑÑˆĞ°/Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğ°: memory Ğ¸Ğ»Ğ¸ redis.",
    ),
    redis_url: Optional[str] = typer.Option(
        None,
        "--redis-url",
        "-r",
        help="URL Redis (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ redis).",
    ),
):
    if cache_type == "redis" and not redis_url:
        sdb_console.print("[bold red]Ğ”Ğ»Ñ redis Ğ½ÑƒĞ¶Ğ½Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ --redis-url.[/bold red]")
        raise typer.Exit(code=1)
    _write_cache_config(cache_type, redis_url)


@storage_app.command("status", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ cache backend.")
def storage_status():
    try:
        from Systems.core.app_settings import settings
        cache_cfg = settings.cache
        cache_status = f"cache.type = {cache_cfg.type}"
        if cache_cfg.type == "redis":
            cache_status += f", redis_url = {cache_cfg.redis_url}"
        sdb_console.print(Panel(f"[bold cyan]Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ cache backend[/]\n{cache_status}", expand=False))
    except Exception as e_status:
        sdb_console.print(f"[bold red]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞºÑÑˆĞ°: {e_status}[/bold red]")


def _normalize_db_type(db_type: str) -> str:
    normalized = db_type.lower()
    if normalized == "postgres":
        normalized = "postgresql"
    if normalized not in {"sqlite", "postgresql", "mysql"}:
        raise ValueError(f"ĞĞµĞ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ‘Ğ” '{db_type}'. ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ: sqlite, postgresql, mysql.")
    return normalized


def _write_db_config(
    db_type: Literal["sqlite", "postgresql", "mysql"],
    sqlite_path: Optional[str],
    dsn: Optional[str]
) -> None:
    project_data_path = _get_project_data_path()
    config_file = project_data_path / USER_CONFIG_DIR_NAME / USER_CORE_CONFIG_FILENAME
    config_data = read_yaml_file(config_file) or {}
    db_section = config_data.get("db", {})
    db_section["type"] = db_type
    if db_type == "sqlite":
        db_section["sqlite_path"] = sqlite_path or "Database_files/swiftdevbot.db"
        db_section.pop("pg_dsn", None)
        db_section.pop("mysql_dsn", None)
    elif db_type == "postgresql":
        db_section["pg_dsn"] = dsn or db_section.get("pg_dsn")
        db_section.pop("mysql_dsn", None)
    elif db_type == "mysql":
        db_section["mysql_dsn"] = dsn or db_section.get("mysql_dsn")
        db_section.pop("pg_dsn", None)
    config_data["db"] = db_section

    if write_yaml_file(config_file, config_data):
        sdb_console.print(
            f"[green]âœ“[/] ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ Ğ‘Ğ” Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½: {config_file} (db.type={db_type})."
        )
        if db_type == "postgresql":
            sdb_console.print(f"[dim]pg_dsn={db_section.get('pg_dsn')}[/]")
        elif db_type == "mysql":
            sdb_console.print(f"[dim]mysql_dsn={db_section.get('mysql_dsn')}[/]")
        elif db_type == "sqlite":
            sdb_console.print(f"[dim]sqlite_path={db_section.get('sqlite_path')}[/]")
        sdb_console.print("[yellow]ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ SDB Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ 'sdb db upgrade head' Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹.[/yellow]")


def _build_pg_dsn(host: str, port: int, user: str, password: str, database: str) -> str:
    return f"postgresql+psycopg://{user}:{password}@{host}:{port}/{database}"


def _build_mysql_dsn(host: str, port: int, user: str, password: str, database: str) -> str:
    return f"mysql+aiomysql://{user}:{password}@{host}:{port}/{database}?charset=utf8mb4"


@db_config_app.command("set", help="ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….")
def db_config_set(
    db_type: Literal["sqlite", "postgresql", "mysql"] = typer.Argument(
        ..., help="Ğ¢Ğ¸Ğ¿ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…."
    ),
    sqlite_path: Optional[str] = typer.Option(
        None, "--sqlite-path", help="ĞŸÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ SQLite (Ğ´Ğ»Ñ sqlite)."
    ),
    host: Optional[str] = typer.Option(
        None, "--host", "-H", help="Ğ¥Ğ¾ÑÑ‚ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ´Ğ»Ñ postgresql/mysql)."
    ),
    port: Optional[int] = typer.Option(
        None, "--port", "-P", help="ĞŸĞ¾Ñ€Ñ‚ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…."
    ),
    user: Optional[str] = typer.Option(
        None, "--user", "-u", help="ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…."
    ),
    password: Optional[str] = typer.Option(
        None, "--password", "-p", help="ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…."
    ),
    database: Optional[str] = typer.Option(
        None, "--database", "-d", help="Ğ˜Ğ¼Ñ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…."
    ),
):
    if db_type == "sqlite":
        if sqlite_path is None:
            typer.echo("[bold yellow]ĞŸÑƒÑ‚ÑŒ sqlite Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½ â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ.[/]")
        _write_db_config("sqlite", sqlite_path, None)
        return

    if not all([host, port, user, password, database]):
        raise typer.Exit(
            code=1,
            message="[bold red]Ğ”Ğ»Ñ PostgreSQL/MySQL Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ host, port, user, password Ğ¸ database.[/bold red]",
        )

    if db_type == "postgresql":
        dsn = _build_pg_dsn(host, port, user, password, database)
    else:
        dsn = _build_mysql_dsn(host, port, user, password, database)

    _write_db_config(db_type, None, dsn)


@db_config_app.command("status", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ”.")
def db_config_status():
    try:
        from Systems.core.app_settings import settings

        db_cfg = settings.db
        status_lines = [f"db.type = {db_cfg.type}"]
        if db_cfg.type == "sqlite":
            status_lines.append(f"sqlite_path = {db_cfg.sqlite_path}")
        elif db_cfg.type == "postgresql":
            status_lines.append(f"pg_dsn = {db_cfg.pg_dsn}")
        elif db_cfg.type == "mysql":
            status_lines.append(f"mysql_dsn = {db_cfg.mysql_dsn}")

        sdb_console.print(
            Panel(
                "[bold cyan]Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ”[/]\n" + "\n".join(status_lines),
                expand=False,
            )
        )
    except Exception as e_db_status:
        sdb_console.print(f"[bold red]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ”: {e_db_status}[/bold red]")


config_app.add_typer(storage_app, name="storage")
config_app.add_typer(db_config_app, name="db")
config_app.add_typer(storage_app, name="storage")


@config_app.command("notifications", help="Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ/Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ.")
def notifications_command(
    enable: bool = typer.Option(True, "--enable/--disable", help="Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ.")
):
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°Ğ¼ Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ/Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ±Ğ¾Ñ‚Ğ°."""
    sdb_console.print(
        f"ğŸ”• Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸: {'Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹' if enable else 'Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹'}"
    )
    
    # Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºÑƒ Ñ‡ĞµÑ€ĞµĞ· set_command
    set_command("core.enable_startup_shutdown_notifications", str(enable).lower())


@config_app.command("set-module", help="Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºÑƒ Ğ´Ğ»Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ.")
def set_module_command(
    module_name: str = typer.Argument(..., help="Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ (Ğ¸Ğ· manifest.name)."),
    key: str = typer.Argument(..., help="ĞšĞ»ÑÑ‡ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ."),
    value: str = typer.Argument(..., help="ĞĞ¾Ğ²Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ."),
):
    """Ğ˜Ğ·Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ."""
    sdb_console.print(
        f"Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ [magenta]{module_name}[/]: [cyan]{key}[/] = [green]'{value}'[/green]"
    )

    project_data_path = _get_project_data_path()
    module_config_file = (
        project_data_path
        / USER_CONFIG_DIR_NAME
        / USER_MODULES_CONFIG_DIR_NAME
        / f"{module_name}.yaml"
    )

    config_data = read_yaml_file(module_config_file) or {}

    # ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµĞ¼ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
    final_value: Any = value
    if value.lower() in ["true", "false"]:
        final_value = value.lower() == "true"
    elif value.isdigit():
        final_value = int(value)
    else:
        try:
            final_value = float(value)
        except ValueError:
            pass

    config_data[key] = final_value

    if write_yaml_file(module_config_file, config_data):
        sdb_console.print(
            f"[green]âœ“[/] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ [magenta]{module_name}[/] Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ° Ğ² [yellow]{module_config_file}[/yellow]."
        )
        sdb_console.print(
            "[yellow]Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²ÑÑ‚ÑƒĞ¿ÑÑ‚ Ğ² ÑĞ¸Ğ»Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ±Ğ¾Ñ‚Ğ°.[/yellow]"
        )


if __name__ == "__main__":
    config_app()  # --- ĞšĞĞĞ•Ğ¦ Ğ¤ĞĞ™Ğ›Ğ cli/config.py ---



======================================================================

------------------------------ FILE: Systems/cli/web.py ------------------------------
# cli/web.py
"""
CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒÑ.
"""

import asyncio
import sys
from pathlib import Path

import typer
from rich.console import Console
from rich.panel import Panel

console = Console()

web_app = typer.Typer(
    name="web",
    help="ğŸŒ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒÑ SwiftDevBot",
    rich_markup_mode="rich",
)


@web_app.command(name="start", help="Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ.")
def web_start_cmd(
    host: str = typer.Option(None, "--host", "-h", help="Ğ¥Ğ¾ÑÑ‚ Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ (Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ SDB_WEB_HOST)"),
    port: int = typer.Option(None, "--port", "-p", help="ĞŸĞ¾Ñ€Ñ‚ Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ (Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ SDB_WEB_PORT)"),
    reload: bool = typer.Option(None, "--reload/--no-reload", help="ĞĞ²Ñ‚Ğ¾Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ÑÑ… (Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ SDB_WEB_RELOAD)"),
    workers: int = typer.Option(None, "--workers", "-w", help="ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ğ¾Ñ€ĞºĞµÑ€Ğ¾Ğ² (Ğ¿ĞµÑ€ĞµĞ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ SDB_WEB_WORKERS)"),
):
    """
    Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ SwiftDevBot.
    
    Ğ’ÑĞµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ² .env Ñ„Ğ°Ğ¹Ğ»Ğµ:
    - SDB_WEB_HOST - Ñ…Ğ¾ÑÑ‚ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 127.0.0.1)
    - SDB_WEB_PORT - Ğ¿Ğ¾Ñ€Ñ‚ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 8000)
    - SDB_WEB_RELOAD - Ğ°Ğ²Ñ‚Ğ¾Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° true/false (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: false)
    - SDB_WEB_WORKERS - ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ğ¾Ñ€ĞºĞµÑ€Ğ¾Ğ² (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: 1)
    
    ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ¸Ğ¼ĞµÑÑ‚ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ Ğ½Ğ°Ğ´ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ.
    """
    # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ, ĞµÑĞ»Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹
    import os
    from dotenv import load_dotenv
    load_dotenv('.env')
    
    # Ğ¥Ğ¾ÑÑ‚: Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ > Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ > Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
    if host is None:
        host = os.environ.get("SDB_WEB_HOST", "127.0.0.1")
    
    # ĞŸĞ¾Ñ€Ñ‚: Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ > Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ > Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
    if port is None:
        port = int(os.environ.get("SDB_WEB_PORT", "8000"))
    
    # Reload: Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ > Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ > Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
    if reload is None:
        reload_str = os.environ.get("SDB_WEB_RELOAD", "false").lower()
        reload = reload_str in ("true", "1", "yes", "on")
    
    # Workers: Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ > Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ > Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
    if workers is None:
        workers = int(os.environ.get("SDB_WEB_WORKERS", "1"))
    
    try:
        asyncio.run(_web_start_async(host, port, reload, workers))
    except KeyboardInterrupt:
        console.print("\n[yellow]ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸...[/]")
        sys.exit(0)
    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸:[/] {e}")
        import traceback
        console.print(f"[dim]{traceback.format_exc()}[/]")
        raise typer.Exit(code=1)


async def _web_start_async(host: str, port: int, reload: bool, workers: int):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸."""
    try:
        import uvicorn
    except ImportError:
        console.print(
            "[bold red]uvicorn Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½![/]\n"
            "[yellow]Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ ĞµĞ³Ğ¾ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹:[/] pip install uvicorn[standard]"
        )
        raise typer.Exit(code=1)
    
    console.print(
        Panel(
            f"[bold cyan]ğŸŒ Ğ—ĞĞŸĞ£Ğ¡Ğš Ğ’Ğ•Ğ‘-ĞŸĞĞĞ•Ğ›Ğ˜ SWIFTDEVBOT[/]\n\n"
            f"[cyan]Ğ¥Ğ¾ÑÑ‚:[/] {host}\n"
            f"[cyan]ĞŸĞ¾Ñ€Ñ‚:[/] {port}\n"
            f"[cyan]Ğ ĞµĞ¶Ğ¸Ğ¼:[/] {'Development' if reload else 'Production'}\n"
            f"[cyan]Ğ’Ğ¾Ñ€ĞºĞµÑ€Ñ‹:[/] {workers}",
            expand=False,
            border_style="cyan",
        )
    )
    
    # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ create_app Ğ¸Ğ· web.app
    try:
        from Systems.web.app import create_app
        from Systems.core.services_provider import BotServicesProvider
        from Systems.core.app_settings import load_app_settings
        
        # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ SDB
        settings = load_app_settings()
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸, Ğ±ĞµĞ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ±Ğ¾Ñ‚Ğ°)
        services = BotServicesProvider(settings=settings)
        
        # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
        try:
            await services.setup_services()
            console.print("[green]âœ… Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹ SDB Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹[/]")
        except Exception as e:
            console.print(f"[yellow]âš ï¸ ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²:[/] {e}")
            # ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµĞ¼ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ Ğ´Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ½Ğµ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
        app = create_app(sdb_services=services, debug=reload)
    except ImportError as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ²ĞµĞ±-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ:[/] {e}")
        import traceback
        console.print(f"[dim]{traceback.format_exc()}[/]")
        raise typer.Exit(code=1)
    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ:[/] {e}")
        import traceback
        console.print(f"[dim]{traceback.format_exc()}[/]")
        raise typer.Exit(code=1)
    
    # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ uvicorn
    try:
        config = uvicorn.Config(
            app=app,
            host=host,
            port=port,
            reload=reload,
            workers=workers if not reload else 1,  # reload Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ workers
            log_level="info",
        )
        server = uvicorn.Server(config)
        console.print(f"\n[bold green]âœ… Ğ’ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ°![/]")
        console.print(f"[cyan]ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ:[/] http://{host}:{port}")
        await server.serve()
    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°:[/] {e}")
        import traceback
        console.print(f"[dim]{traceback.format_exc()}[/]")
        raise typer.Exit(code=1)


@web_app.command(name="status", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸.")
def web_status_cmd():
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸."""
    import os
    from dotenv import load_dotenv
    import socket
    
    load_dotenv('.env')
    
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¸Ğ· Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
    host = os.environ.get("SDB_WEB_HOST", "127.0.0.1")
    port = int(os.environ.get("SDB_WEB_PORT", "8000"))
    
    console.print(Panel("[bold cyan]Ğ¡Ğ¢ĞĞ¢Ğ£Ğ¡ Ğ’Ğ•Ğ‘-ĞŸĞĞĞ•Ğ›Ğ˜[/]", expand=False, border_style="cyan"))
    console.print(f"[dim]ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° {host}:{port}[/]")
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ»Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(1)
        result = sock.connect_ex((host if host != "0.0.0.0" else "127.0.0.1", port))
        sock.close()
        
        if result == 0:
            console.print("[green]âœ… Ğ’ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ°[/]")
            display_host = host if host != "0.0.0.0" else "localhost"
            console.print(f"[cyan]URL:[/] http://{display_host}:{port}")
        else:
            console.print("[yellow]âš ï¸ Ğ’ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ°[/]")
            console.print(f"[dim]ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğ¹ Ğ°Ğ´Ñ€ĞµÑ: {host}:{port}[/]")
    except Exception as e:
        console.print(f"[yellow]âš ï¸ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ: {e}[/]")


if __name__ == "__main__":
    web_app()




======================================================================

------------------------------ FILE: Systems/cli/run.py ------------------------------
# --- ĞĞĞ§ĞĞ›Ğ Ğ¤ĞĞ™Ğ›Ğ cli/run.py ---
import asyncio
import os
import subprocess
import sys
import time
from pathlib import Path

import typer
from loguru import logger as global_logger
from rich.panel import Panel

from .process import (PID_FILENAME,  # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸Ğ· ÑĞ¾ÑĞµĞ´Ğ½ĞµĞ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°
                      _is_process_running)

sdb_console = None  # Ğ‘ÑƒĞ´ĞµÑ‚ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ² sdb.py


def run_command(
    debug: bool = typer.Option(
        False,
        "--debug",
        "-d",
        help="Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ° Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸ (ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ¾ DEBUG).",
    ),
    verbose: bool = typer.Option(
        False,
        "--verbose",
        "-v",
        help="ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ²Ğ¾Ğ´ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ, Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞµ.",
    ),
    background: bool = typer.Option(
        False,
        "--background",
        "-b",
        help="Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ° Ğ² Ñ„Ğ¾Ğ½Ğ¾Ğ²Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ (Ğ´ĞµĞ¼Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ).",
    ),
):
    """
    ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Telegram Ğ±Ğ¾Ñ‚Ğ° SDB.
    """
    # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ·Ğ´ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ Ñ†Ğ¸ĞºĞ»Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ¸ ÑƒÑĞºĞ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿ÑƒÑĞº CLI
    from Systems.core.app_settings import settings
    from Systems.core.bot_entrypoint import run_sdb_bot

    global sdb_console
    if sdb_console is None:
        from rich.console import Console

        sdb_console = Console()

    project_root = Path(__file__).resolve().parent.parent
    # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹
    pid_file_path = settings.core.project_data_path / PID_FILENAME

    if pid_file_path.exists():
        try:
            with open(pid_file_path, "r") as f:
                pid = int(f.read().strip())
            if _is_process_running(pid):
                sdb_console.print(
                    f"[yellow]âš¡ SDB Core ÑƒĞ¶Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ (PID: {pid}). Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ 'sdb stop' Ğ´Ğ»Ñ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸.[/yellow]"
                )
                raise typer.Exit(code=1)
        except (OSError, ValueError):
            sdb_console.print(
                f"[yellow]ğŸ”„ ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğ¹ PID-Ñ„Ğ°Ğ¹Ğ» ({pid_file_path}). ĞÑ‡Ğ¸ÑÑ‚ĞºĞ°...[/yellow]"
            )
            pid_file_path.unlink(missing_ok=True)
        except Exception as e_pid_check:
            sdb_console.print(
                f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ PID-Ñ„Ğ°Ğ¹Ğ»Ğ°: {e_pid_check}[/red]"
            )

    if debug:
        sdb_console.print(
            Panel(
                f"[bold yellow]Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ±Ğ¾Ñ‚Ğ° Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ DEBUG.[/]",
                title="SDB Run (Debug Mode Requested)",
                expand=False,
                border_style="yellow",
            )
        )
        os.environ["SDB_LAUNCH_DEBUG_MODE"] = "true"
    else:
        os.environ["SDB_LAUNCH_DEBUG_MODE"] = "false"
    
    # Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ„Ğ»Ğ°Ğ³ verbose Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    if verbose:
        os.environ["SDB_VERBOSE"] = "true"
    else:
        os.environ["SDB_VERBOSE"] = "false"

    if background:
        if sys.platform == "win32":
            sdb_console.print(
                "[bold red]Ğ¤Ğ¾Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ (-b/--background) Ğ¿Ğ¾ĞºĞ° Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Windows Ñ‡ĞµÑ€ĞµĞ· ÑÑ‚Ñƒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ.[/bold red]"
            )
            sdb_console.print(
                "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ±Ğ¾Ñ‚Ğ° Ğ±ĞµĞ· Ñ„Ğ»Ğ°Ğ³Ğ° -b Ğ¸Ğ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ÑÑ€ĞµĞ´ÑÑ‚Ğ²Ğ° Ğ´Ğ»Ñ Ğ´ĞµĞ¼Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸."
            )
            raise typer.Exit(code=1)

        sdb_console.print(
            Panel(
                "[bold blue]ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº SDB Core Ğ² Ñ„Ğ¾Ğ½Ğ¾Ğ²Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ...[/]",
                title="SDB Core (Background)",
                expand=False,
                border_style="blue",
            )
        )

        run_bot_script_path = project_root / "run_bot.py"

        env_for_subprocess = os.environ.copy()
        env_for_subprocess["SDB_SHOULD_WRITE_PID"] = "true"
        # ĞŸĞµÑ€ĞµĞ´Ğ°ĞµĞ¼ Ñ„Ğ»Ğ°Ğ³ verbose Ğ² Ñ„Ğ¾Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ
        env_for_subprocess["SDB_VERBOSE"] = "true" if verbose else "false"

        try:
            process = subprocess.Popen(
                [sys.executable, str(run_bot_script_path)],
                stdout=subprocess.DEVNULL,
                stderr=subprocess.DEVNULL,
                start_new_session=True,
                env=env_for_subprocess,
            )
            sdb_console.print(
                f"âš¡ SDB Core Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ² Ñ„Ğ¾Ğ½Ğµ (ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ PID: {process.pid})."
            )
            sdb_console.print(
                f"ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ PID-Ñ„Ğ°Ğ¹Ğ»Ğ° '{PID_FILENAME}' (Ğ´Ğ¾ 10 ÑĞµĞºÑƒĞ½Ğ´)..."
            )

            pid_file_created_successfully = False
            for i in range(10):
                time.sleep(1)
                if pid_file_path.exists():
                    try:
                        actual_pid_from_file_str = pid_file_path.read_text().strip()
                        if actual_pid_from_file_str.isdigit():
                            actual_pid_from_file = int(actual_pid_from_file_str)
                            sdb_console.print(
                                f"[green]PID-Ñ„Ğ°Ğ¹Ğ» {pid_file_path} ÑĞ¾Ğ·Ğ´Ğ°Ğ½. PID Ğ±Ğ¾Ñ‚Ğ°: {actual_pid_from_file}.[/green]"
                            )
                            sdb_console.print(
                                "Ğ”Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ: [cyan]sdb status[/cyan]"
                            )
                            sdb_console.print(
                                "Ğ”Ğ»Ñ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ: [cyan]sdb stop[/cyan]"
                            )
                            pid_file_created_successfully = True
                            break
                    except (ValueError, IOError) as e_read_pid:
                        sdb_console.print(
                            f"[yellow]ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ PID Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ° ({e_read_pid}). ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° {i+1}/10.[/yellow]"
                        )

            if not pid_file_created_successfully:
                sdb_console.print(
                    f"[yellow]ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ: PID-Ñ„Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ±Ñ‹Ğ» ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½/Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½ Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ 10 ÑĞµĞºÑƒĞ½Ğ´.[/yellow]"
                )
                sdb_console.print(
                    f"  Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ±Ğ¾Ñ‚ Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ğ»ÑÑ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸."
                )
                sdb_console.print(
                    f"  Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ PID: {process.pid}. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ĞµĞ³Ğ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ."
                )

        except Exception as e_popen:
            sdb_console.print(
                f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ Ğ±Ğ¾Ñ‚Ğ° Ğ² Ñ„Ğ¾Ğ½Ğ¾Ğ²Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ: {e_popen}[/bold red]"
            )
            raise typer.Exit(code=1)
    else:
        if not debug:
            sdb_console.print(
                Panel(
                    "[bold green]Ğ—Ğ°Ğ¿ÑƒÑĞº Telegram Ğ±Ğ¾Ñ‚Ğ° SDB...[/]",
                    title="SDB Run",
                    expand=False,
                    border_style="green",
                )
            )
        try:
            os.environ["SDB_SHOULD_WRITE_PID"] = "false"

            bot_coroutine = run_sdb_bot()
            exit_code = asyncio.run(bot_coroutine)

            if exit_code != 0:
                sdb_console.print(
                    f"[bold red]Ğ‘Ğ¾Ñ‚ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ» Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ Ñ ĞºĞ¾Ğ´Ğ¾Ğ¼ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸: {exit_code}[/]"
                )
                sys.exit(exit_code)
            else:
                sdb_console.print("[bold green]Ğ‘Ğ¾Ñ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ» ÑĞ²Ğ¾Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ.[/]")

        except KeyboardInterrupt:
            sdb_console.print(
                "\n[bold orange_red1]ğŸ¤– Ğ‘Ğ¾Ñ‚ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼ (Ctrl+C).[/]"
            )
            sys.exit(0)
        except Exception as e:
            sdb_console.print(
                Panel(
                    f"[bold red]ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ ĞĞ¨Ğ˜Ğ‘ĞšĞ:[/]\n{e}",
                    title="SDB Runtime Error",
                    border_style="red",
                    expand=True,
                )
            )
            global_logger.opt(exception=e).critical(
                "ĞĞµĞ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ² cli/run.py"
            )
            sys.exit(1)


# --- ĞšĞĞĞ•Ğ¦ Ğ¤ĞĞ™Ğ›Ğ cli/run.py ---



======================================================================

------------------------------ FILE: Systems/cli/monitor.py ------------------------------
# --- ĞĞĞ§ĞĞ›Ğ Ğ¤ĞĞ™Ğ›Ğ cli/monitor.py ---
import asyncio
import json
import logging
import os
import platform
import sqlite3
import time
from datetime import datetime, timedelta
from pathlib import Path
from typing import Any, Dict, List, Optional, Tuple

import aiohttp
import psutil
import typer
from rich.console import Console
from rich.live import Live
from rich.panel import Panel
from rich.progress import Progress, SpinnerColumn, TextColumn
from rich.table import Table
from rich.text import Text

# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ SDB ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸
try:
    from Systems.cli.utils import get_sdb_services_for_cli
except ImportError:
    # Fallback ĞµÑĞ»Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°
    async def get_sdb_services_for_cli(init_db=False):
        raise ImportError("get_sdb_services_for_cli Ğ½Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°")


from rich.align import Align
from rich.layout import Layout

from Systems.cli.utils import format_size, get_sdb_services_for_cli

# ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Typer-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
monitor_app = typer.Typer(
    name="monitor",
    help="ğŸ“Š ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ SwiftDevBot",
    rich_markup_mode="rich",
)

console = Console()

# ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
MONITOR_DIR = Path("Data/monitor")
METRICS_DB = MONITOR_DIR / "metrics.db"
ALERTS_CONFIG = MONITOR_DIR / "alerts_config.json"
METRICS_HISTORY_FILE = MONITOR_DIR / "metrics_history.json"

# ĞŸĞ¾Ñ€Ğ¾Ğ³Ğ¸ Ğ´Ğ»Ñ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²
DEFAULT_ALERTS = {
    "cpu": {"warning": 70, "critical": 90},
    "memory": {"warning": 80, "critical": 95},
    "disk": {"warning": 85, "critical": 95},
    "response_time": {"warning": 2.0, "critical": 5.0},
}


def _ensure_monitor_directory():
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° ĞµÑĞ»Ğ¸ ĞµÑ‘ Ğ½ĞµÑ‚"""
    MONITOR_DIR.mkdir(parents=True, exist_ok=True)

    # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ” Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº
    if not METRICS_DB.exists():
        _init_metrics_database()

    # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²
    if not ALERTS_CONFIG.exists():
        _init_alerts_config()


def _init_metrics_database():
    """Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº"""
    conn = sqlite3.connect(METRICS_DB)
    cursor = conn.cursor()

    cursor.execute(
        """
        CREATE TABLE IF NOT EXISTS metrics (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
            cpu_percent REAL,
            memory_percent REAL,
            disk_percent REAL,
            network_bytes_sent INTEGER,
            network_bytes_recv INTEGER,
            response_time REAL,
            bot_status TEXT,
            db_status TEXT
        )
    """
    )

    cursor.execute(
        """
        CREATE INDEX IF NOT EXISTS idx_timestamp 
        ON metrics(timestamp)
    """
    )

    conn.commit()
    conn.close()
    logger.info("Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°")


def _init_alerts_config():
    """Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²"""
    config = {
        "alerts": DEFAULT_ALERTS,
        "notifications": {
            "enabled": True,
            "channels": ["telegram_admin"],
            "cooldown": 300,  # 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸
        },
        "history": {"enabled": True, "retention_days": 30},
    }

    with open(ALERTS_CONFIG, "w") as f:
        json.dump(config, f, indent=2)

    logger.info("ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ² Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°")


def _load_alerts_config() -> Dict[str, Any]:
    """Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²"""
    _ensure_monitor_directory()
    try:
        with open(ALERTS_CONFIG, "r") as f:
            return json.load(f)
    except FileNotFoundError:
        return {"alerts": DEFAULT_ALERTS, "notifications": {"enabled": True}}


def _save_metrics_to_db(metrics: Dict[str, Any]):
    """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ² Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
    try:
        conn = sqlite3.connect(METRICS_DB)
        cursor = conn.cursor()

        cursor.execute(
            """
            INSERT INTO metrics 
            (cpu_percent, memory_percent, disk_percent, network_bytes_sent, 
             network_bytes_recv, response_time, bot_status, db_status)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)
        """,
            (
                metrics.get("cpu_percent", 0),
                metrics.get("memory_percent", 0),
                metrics.get("disk_percent", 0),
                metrics.get("network_bytes_sent", 0),
                metrics.get("network_bytes_recv", 0),
                metrics.get("response_time", 0),
                metrics.get("bot_status", "unknown"),
                metrics.get("db_status", "unknown"),
            ),
        )

        conn.commit()
        conn.close()
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ² Ğ‘Ğ”: {e}")


def _get_metrics_history(hours: int = 24) -> List[Dict[str, Any]]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº"""
    try:
        conn = sqlite3.connect(METRICS_DB)
        cursor = conn.cursor()

        since = datetime.now() - timedelta(hours=hours)

        cursor.execute(
            """
            SELECT * FROM metrics 
            WHERE timestamp >= ? 
            ORDER BY timestamp DESC
        """,
            (since,),
        )

        columns = [description[0] for description in cursor.description]
        rows = cursor.fetchall()

        conn.close()

        return [dict(zip(columns, row)) for row in rows]
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº: {e}")
        return []


async def _check_alerts(metrics: Dict[str, Any]) -> List[Dict[str, Any]]:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ½Ğ° ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°Ğ¼ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²"""
    config = _load_alerts_config()
    alerts = []

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° CPU
    cpu_percent = metrics.get("cpu_percent", 0)
    if cpu_percent > config["alerts"]["cpu"]["critical"]:
        alerts.append(
            {
                "type": "critical",
                "metric": "cpu",
                "value": cpu_percent,
                "threshold": config["alerts"]["cpu"]["critical"],
                "message": f"ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° CPU: {cpu_percent:.1f}%",
            }
        )
    elif cpu_percent > config["alerts"]["cpu"]["warning"]:
        alerts.append(
            {
                "type": "warning",
                "metric": "cpu",
                "value": cpu_percent,
                "threshold": config["alerts"]["cpu"]["warning"],
                "message": f"Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° CPU: {cpu_percent:.1f}%",
            }
        )

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸
    memory_percent = metrics.get("memory_percent", 0)
    if memory_percent > config["alerts"]["memory"]["critical"]:
        alerts.append(
            {
                "type": "critical",
                "metric": "memory",
                "value": memory_percent,
                "threshold": config["alerts"]["memory"]["critical"],
                "message": f"ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸: {memory_percent:.1f}%",
            }
        )
    elif memory_percent > config["alerts"]["memory"]["warning"]:
        alerts.append(
            {
                "type": "warning",
                "metric": "memory",
                "value": memory_percent,
                "threshold": config["alerts"]["memory"]["warning"],
                "message": f"Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸: {memory_percent:.1f}%",
            }
        )

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¸ÑĞºĞ°
    disk_percent = metrics.get("disk_percent", 0)
    if disk_percent > config["alerts"]["disk"]["critical"]:
        alerts.append(
            {
                "type": "critical",
                "metric": "disk",
                "value": disk_percent,
                "threshold": config["alerts"]["disk"]["critical"],
                "message": f"ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¸ÑĞºĞ°: {disk_percent:.1f}%",
            }
        )
    elif disk_percent > config["alerts"]["disk"]["warning"]:
        alerts.append(
            {
                "type": "warning",
                "metric": "disk",
                "value": disk_percent,
                "threshold": config["alerts"]["disk"]["warning"],
                "message": f"Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¸ÑĞºĞ°: {disk_percent:.1f}%",
            }
        )

    return alerts


async def _send_alert_notifications(alerts: List[Dict[str, Any]]):
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ğ± Ğ°Ğ»ĞµÑ€Ñ‚Ğ°Ñ…"""
    if not alerts:
        return

    config = _load_alerts_config()
    if not config.get("notifications", {}).get("enabled", False):
        return

    try:
        from Systems.cli.notifications import (_load_notifications_config,
                                       _send_notification_by_type)

        notifications_config = _load_notifications_config()
        channels = notifications_config.get("channels", {})

        for alert in alerts:
            priority = "urgent" if alert["type"] == "critical" else "high"
            message = f"ğŸš¨ ĞĞ›Ğ•Ğ Ğ¢: {alert['message']}\n\nĞœĞµÑ‚Ñ€Ğ¸ĞºĞ°: {alert['metric']}\nĞ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ: {alert['value']:.1f}\nĞŸĞ¾Ñ€Ğ¾Ğ³: {alert['threshold']:.1f}"

            # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ ĞºĞ°Ğ½Ğ°Ğ»Ñ‹
            for channel_name in config["notifications"]["channels"]:
                if (
                    channel_name in channels
                    and channels[channel_name].get("status") == "active"
                ):
                    await _send_notification_by_type(
                        channels[channel_name], message, priority
                    )

    except ImportError:
        logger.warning("ĞœĞ¾Ğ´ÑƒĞ»ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½")
    except Exception as e:
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ¾Ğ± Ğ°Ğ»ĞµÑ€Ñ‚Ğ°Ñ…: {e}")


# --- Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ ---


def _get_system_info() -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ±Ğ°Ğ·Ğ¾Ğ²ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ."""
    return {
        "platform": platform.system(),
        "platform_version": platform.version(),
        "architecture": platform.architecture()[0],
        "processor": platform.processor(),
        "hostname": platform.node(),
        "python_version": platform.python_version(),
    }


def _get_cpu_info() -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ CPU."""
    cpu_percent = psutil.cpu_percent(interval=1)
    cpu_count = psutil.cpu_count()
    cpu_freq = psutil.cpu_freq()

    return {
        "percent": cpu_percent,
        "count": cpu_count,
        "frequency": cpu_freq.current if cpu_freq else None,
        "load_avg": psutil.getloadavg() if hasattr(psutil, "getloadavg") else None,
    }


def _get_memory_info() -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸."""
    memory = psutil.virtual_memory()
    swap = psutil.swap_memory()

    return {
        "total": memory.total,
        "available": memory.available,
        "used": memory.used,
        "percent": memory.percent,
        "swap_total": swap.total,
        "swap_used": swap.used,
        "swap_percent": swap.percent,
    }


def _get_disk_info() -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ´Ğ¸ÑĞºĞµ."""
    disk = psutil.disk_usage("/")
    disk_io = psutil.disk_io_counters()

    return {
        "total": disk.total,
        "used": disk.used,
        "free": disk.free,
        "percent": disk.percent,
        "read_bytes": disk_io.read_bytes if disk_io else 0,
        "write_bytes": disk_io.write_bytes if disk_io else 0,
    }


def _get_network_info() -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞµÑ‚Ğ¸."""
    network_io = psutil.net_io_counters()

    return {
        "bytes_sent": network_io.bytes_sent,
        "bytes_recv": network_io.bytes_recv,
        "packets_sent": network_io.packets_sent,
        "packets_recv": network_io.packets_recv,
    }


async def _get_bot_status() -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ¾Ñ‚Ğ°."""
    try:
        # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
        try:
            settings, db_manager, _ = await get_sdb_services_for_cli()
            bot_token = settings.bot_token
        except Exception as e:
            # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸, Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ¸Ğ· .env
            try:
                from dotenv import load_dotenv

                load_dotenv()
                bot_token = os.getenv("BOT_TOKEN")
                if not bot_token:
                    return {
                        "status": "error",
                        "error": "BOT_TOKEN Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ… Ğ¸Ğ»Ğ¸ .env",
                        "response_time": 0,
                        "uptime": "unknown",
                    }
            except Exception:
                return {
                    "status": "error",
                    "error": "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ BOT_TOKEN",
                    "response_time": 0,
                    "uptime": "unknown",
                }

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ Bot API
        try:
            import aiohttp

            async with aiohttp.ClientSession() as session:
                url = f"https://api.telegram.org/bot{bot_token}/getMe"
                start_time = time.time()
                async with session.get(url, timeout=10) as response:
                    response_time = time.time() - start_time

                    if response.status == 200:
                        data = await response.json()
                        if data.get("ok"):
                            return {
                                "status": "active",
                                "username": data.get("result", {}).get(
                                    "username", "unknown"
                                ),
                                "response_time": response_time,
                                "uptime": "running",
                            }
                        else:
                            return {
                                "status": "error",
                                "error": f"Telegram API error: {data.get('description', 'Unknown error')}",
                                "response_time": response_time,
                                "uptime": "unknown",
                            }
                    else:
                        return {
                            "status": "error",
                            "error": f"HTTP {response.status}",
                            "response_time": response_time,
                            "uptime": "unknown",
                        }
        except aiohttp.ClientError as e:
            return {
                "status": "error",
                "error": f"Network error: {str(e)}",
                "response_time": 0,
                "uptime": "unknown",
            }
        except Exception as e:
            return {
                "status": "error",
                "error": f"Request error: {str(e)}",
                "response_time": 0,
                "uptime": "unknown",
            }

    except Exception as e:
        return {
            "status": "error",
            "error": str(e),
            "response_time": 0,
            "uptime": "unknown",
        }


async def _get_database_status() -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…."""
    try:
        # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
        try:
            settings, db_manager, _ = await get_sdb_services_for_cli(init_db=True)
        except Exception as e:
            # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸, Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ SQLite Ñ„Ğ°Ğ¹Ğ»
            try:
                from dotenv import load_dotenv

                load_dotenv()

                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ SQLite Ñ„Ğ°Ğ¹Ğ»
                db_path = os.getenv("DB_SQLITE_PATH", "Data/database.db")
                if os.path.exists(db_path):
                    import sqlite3

                    conn = sqlite3.connect(db_path)
                    cursor = conn.cursor()
                    start_time = time.time()
                    cursor.execute("SELECT 1")
                    response_time = time.time() - start_time
                    conn.close()

                    return {
                        "status": "connected",
                        "response_time": response_time,
                        "type": "sqlite",
                        "url": db_path,
                    }
                else:
                    return {
                        "status": "error",
                        "error": f"Database file not found: {db_path}",
                        "response_time": 0,
                        "type": "unknown",
                    }
            except Exception as db_error:
                return {
                    "status": "error",
                    "error": f"Database check failed: {str(db_error)}",
                    "response_time": 0,
                    "type": "unknown",
                }

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ‘Ğ” Ñ‡ĞµÑ€ĞµĞ· Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€
        try:
            if db_manager is None:
                return {
                    "status": "error",
                    "error": "Database manager is None - database not initialized",
                    "response_time": 0,
                    "type": "unknown",
                }

            start_time = time.time()
            async with db_manager.get_session() as session:
                # ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
                from sqlalchemy import text

                result = await session.execute(text("SELECT 1"))
                response_time = time.time() - start_time

                return {
                    "status": "connected",
                    "response_time": response_time,
                    "type": settings.db.type,
                    "url": (
                        str(db_manager.url) if hasattr(db_manager, "url") else "unknown"
                    ),
                }
        except Exception as db_error:
            return {
                "status": "error",
                "error": f"Database connection failed: {str(db_error)}",
                "response_time": 0,
                "type": settings.db.type if settings else "unknown",
            }

    except Exception as e:
        return {
            "status": "error",
            "error": str(e),
            "response_time": 0,
            "type": "unknown",
        }


def _format_uptime(seconds: float) -> str:
    """Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ²Ñ€ĞµĞ¼Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹."""
    if seconds < 60:
        return f"{seconds:.0f} ÑĞµĞºÑƒĞ½Ğ´Ğ°" if seconds == 1 else f"{seconds:.0f} ÑĞµĞºÑƒĞ½Ğ´"
    elif seconds < 3600:
        minutes = seconds / 60
        return f"{minutes:.0f} Ğ¼Ğ¸Ğ½ÑƒÑ‚"
    elif seconds < 86400:
        hours = seconds / 3600
        return f"{hours:.0f} Ñ‡Ğ°ÑĞ¾Ğ²"
    else:
        days = seconds / 86400
        return f"{days:.0f} Ğ´Ğ½ĞµĞ¹"


# --- CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ ---


@monitor_app.command(name="status", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.")
def monitor_status_cmd(
    detailed: bool = typer.Option(
        False, "--detailed", "-d", help="ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ"
    ),
    json_output: bool = typer.Option(False, "--json", help="Ğ’Ñ‹Ğ²Ğ¾Ğ´ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ JSON"),
    health: bool = typer.Option(False, "--health", help="Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ"),
    notify: Optional[str] = typer.Option(
        None, "--notify", help="ĞšĞ°Ğ½Ğ°Ğ» Ğ´Ğ»Ñ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹"
    ),
):
    """ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹."""
    asyncio.run(_monitor_status_async(detailed, json_output, health, notify))


async def _monitor_status_async(
    detailed: bool, json_output: bool, health: bool, notify: Optional[str]
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°."""

    console.print(Panel.fit("ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹", style="bold cyan"))

    # Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ²ÑĞµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
    cpu_info = _get_cpu_info()
    memory_info = _get_memory_info()
    disk_info = _get_disk_info()
    network_info = _get_network_info()
    bot_status = await _get_bot_status()
    db_status = await _get_database_status()

    # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾Ğ±Ñ‰Ğ¸Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
    metrics = {
        "cpu_percent": cpu_info["percent"],
        "memory_percent": memory_info["percent"],
        "disk_percent": disk_info["percent"],
        "network_bytes_sent": network_info["bytes_sent"],
        "network_bytes_recv": network_info["bytes_recv"],
        "response_time": bot_status.get("response_time", 0),
        "bot_status": bot_status.get("status", "unknown"),
        "db_status": db_status.get("status", "unknown"),
    }

    # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ² Ğ‘Ğ”
    _save_metrics_to_db(metrics)

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹
    alerts = await _check_alerts(metrics)

    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹
    if alerts:
        await _send_alert_notifications(alerts)

    # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    status_data = {
        "timestamp": datetime.now().isoformat(),
        "system": {
            "cpu": cpu_info,
            "memory": memory_info,
            "disk": disk_info,
            "network": network_info,
        },
        "services": {"bot": bot_status, "database": db_status},
        "alerts": alerts,
        "health": {
            "overall": "healthy" if not alerts else "unhealthy",
            "alerts_count": len(alerts),
        },
    }

    if json_output:
        console.print(json.dumps(status_data, indent=2))
        return

    if health:
        if alerts:
            console.print(f"[bold red]âŒ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ½ĞµĞ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ğ°: {len(alerts)} Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²[/]")
            for alert in alerts:
                console.print(f"   ğŸ”´ {alert['message']}")
            raise typer.Exit(code=1)
        else:
            console.print("[bold green]âœ… Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ğ°[/]")
            return

    # ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ
    console.print("ğŸ–¥ï¸ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ:")
    console.print(f"   ğŸ“Š CPU: {cpu_info['percent']:.1f}% ({cpu_info['count']} ÑĞ´ĞµÑ€)")
    console.print(
        f"   ğŸ’¾ Memory: {memory_info['percent']:.1f}% ({format_size(memory_info['used'])}/{format_size(memory_info['total'])})"
    )
    console.print(
        f"   ğŸ’¿ Disk: {disk_info['percent']:.1f}% ({format_size(disk_info['used'])}/{format_size(disk_info['total'])})"
    )
    console.print()

    console.print("ğŸ¤– Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹:")
    bot_emoji = "ğŸŸ¢" if bot_status["status"] == "active" else "ğŸ”´"
    db_emoji = "ğŸŸ¢" if db_status["status"] == "connected" else "ğŸ”´"

    console.print(f"   {bot_emoji} Bot API: {bot_status['status']}")
    if bot_status["status"] == "active":
        console.print(
            f"      ğŸ“Š Response time: {bot_status.get('response_time', 0):.3f}s"
        )
        console.print(f"      ğŸ‘¤ Username: {bot_status.get('username', 'unknown')}")

    console.print(f"   {db_emoji} Database: {db_status['status']}")
    if db_status["status"] == "connected":
        console.print(
            f"      ğŸ“Š Response time: {db_status.get('response_time', 0):.3f}s"
        )
        console.print(f"      ğŸ”§ Type: {db_status.get('type', 'unknown')}")

    # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹
    if alerts:
        console.print("\nğŸš¨ ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹:")
        for alert in alerts:
            emoji = "ğŸ”´" if alert["type"] == "critical" else "ğŸŸ¡"
            console.print(f"   {emoji} {alert['message']}")
    else:
        console.print("\nâœ… ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ² Ğ½ĞµÑ‚")

    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ ĞµÑĞ»Ğ¸ ÑƒĞºĞ°Ğ·Ğ°Ğ½ ĞºĞ°Ğ½Ğ°Ğ»
    if notify:
        try:
            from Systems.cli.notifications import (_load_notifications_config,
                                           _send_notification_by_type)

            notifications_config = _load_notifications_config()
            channels = notifications_config.get("channels", {})

            if notify in channels and channels[notify].get("status") == "active":
                message = f"ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ SwiftDevBot\n\n"
                message += f"CPU: {cpu_info['percent']:.1f}%\n"
                message += f"Memory: {memory_info['percent']:.1f}%\n"
                message += f"Disk: {disk_info['percent']:.1f}%\n"
                message += f"Bot: {bot_status['status']}\n"
                message += f"Database: {db_status['status']}\n"

                if alerts:
                    message += f"\nğŸš¨ ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²: {len(alerts)}"
                    priority = "high"
                else:
                    message += f"\nâœ… Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ğ°"
                    priority = "normal"

                await _send_notification_by_type(channels[notify], message, priority)
                console.print(f"[green]âœ… Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² ĞºĞ°Ğ½Ğ°Ğ» '{notify}'[/]")
            else:
                console.print(
                    f"[yellow]âš ï¸ ĞšĞ°Ğ½Ğ°Ğ» '{notify}' Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½[/]"
                )

        except ImportError:
            console.print("[yellow]âš ï¸ ĞœĞ¾Ğ´ÑƒĞ»ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½[/]")
        except Exception as e:
            console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ: {e}[/]")


@monitor_app.command(name="metrics", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸.")
def monitor_metrics_cmd(
    cpu: bool = typer.Option(False, "--cpu", help="Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ñ€Ğ°"),
    memory: bool = typer.Option(False, "--memory", help="Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸"),
    disk: bool = typer.Option(False, "--disk", help="Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¸ÑĞºĞ°"),
    network: bool = typer.Option(False, "--network", help="Ğ¡ĞµÑ‚ĞµĞ²Ğ¾Ğ¹ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº"),
    real_time: bool = typer.Option(
        False, "--real-time", help="ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸"
    ),
    history: bool = typer.Option(False, "--history", help="Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ"),
    hours: int = typer.Option(24, "--hours", help="ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‡Ğ°ÑĞ¾Ğ² Ğ´Ğ»Ñ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸"),
):
    """ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸."""
    asyncio.run(
        _monitor_metrics_async(cpu, memory, disk, network, real_time, history, hours)
    )


async def _monitor_metrics_async(
    cpu: bool,
    memory: bool,
    disk: bool,
    network: bool,
    real_time: bool,
    history: bool,
    hours: int,
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº."""

    # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸, Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²ÑĞµ
    if not any([cpu, memory, disk, network]):
        cpu = memory = disk = network = True

    if history:
        await _display_metrics_history(hours)
        return

    if real_time:
        await _display_metrics_realtime(cpu, memory, disk, network)
        return

    await _display_metrics(cpu, memory, disk, network)


async def _display_metrics(cpu: bool, memory: bool, disk: bool, network: bool):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸."""
    console.print(Panel.fit("ğŸ“Š ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹", style="bold cyan"))

    # Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
    metrics = {}

    if cpu:
        cpu_info = _get_cpu_info()
        metrics["cpu_percent"] = cpu_info["percent"]
        console.print("ğŸ–¥ï¸ CPU (ĞŸÑ€Ğ¾Ñ†ĞµÑÑĞ¾Ñ€):")
        console.print(f"   ğŸ“Š Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°: {cpu_info['percent']:.1f}%")
        console.print(f"   ğŸ“ˆ ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ´ĞµÑ€: {cpu_info['count']}")
        if cpu_info["frequency"]:
            console.print(f"   ğŸ”§ Ğ§Ğ°ÑÑ‚Ğ¾Ñ‚Ğ°: {cpu_info['frequency']:.0f}MHz")
        if cpu_info["load_avg"]:
            console.print(f"   ğŸ“ˆ Load average: {cpu_info['load_avg'][0]:.2f}")
        console.print()

    if memory:
        memory_info = _get_memory_info()
        metrics["memory_percent"] = memory_info["percent"]
        console.print("ğŸ’¾ Memory (ĞŸĞ°Ğ¼ÑÑ‚ÑŒ):")
        console.print(
            f"   ğŸ“Š Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¾: {format_size(memory_info['used'])} / {format_size(memory_info['total'])} ({memory_info['percent']:.1f}%)"
        )
        console.print(f"   ğŸ“ˆ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾: {format_size(memory_info['available'])}")
        console.print(
            f"   ğŸ“ˆ Swap: {format_size(memory_info['swap_used'])} / {format_size(memory_info['swap_total'])} ({memory_info['swap_percent']:.1f}%)"
        )
        console.print()

    if disk:
        disk_info = _get_disk_info()
        metrics["disk_percent"] = disk_info["percent"]
        console.print("ğŸ’¿ Disk (Ğ”Ğ¸ÑĞº):")
        console.print(
            f"   ğŸ“Š Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¾: {format_size(disk_info['used'])} / {format_size(disk_info['total'])} ({disk_info['percent']:.1f}%)"
        )
        console.print(f"   ğŸ“ˆ Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾: {format_size(disk_info['free'])}")
        console.print(f"   ğŸ“ˆ ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¾: {format_size(disk_info['read_bytes'])}")
        console.print(f"   ğŸ“ˆ Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾: {format_size(disk_info['write_bytes'])}")
        console.print()

    if network:
        network_info = _get_network_info()
        metrics["network_bytes_sent"] = network_info["bytes_sent"]
        metrics["network_bytes_recv"] = network_info["bytes_recv"]
        console.print("ğŸŒ Network (Ğ¡ĞµÑ‚ÑŒ):")
        console.print(f"   ğŸ“Š ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾: {format_size(network_info['bytes_sent'])}")
        console.print(f"   ğŸ“Š ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾: {format_size(network_info['bytes_recv'])}")
        console.print(f"   ğŸ“ˆ ĞŸĞ°ĞºĞµÑ‚Ğ¾Ğ² Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾: {network_info['packets_sent']}")
        console.print(f"   ğŸ“ˆ ĞŸĞ°ĞºĞµÑ‚Ğ¾Ğ² Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾: {network_info['packets_recv']}")
        console.print()

    # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ² Ğ‘Ğ”
    if metrics:
        _save_metrics_to_db(metrics)

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹
    alerts = await _check_alerts(metrics)
    if alerts:
        console.print("ğŸš¨ ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹:")
        for alert in alerts:
            emoji = "ğŸ”´" if alert["type"] == "critical" else "ğŸŸ¡"
            console.print(f"   {emoji} {alert['message']}")
        console.print()


async def _display_metrics_realtime(cpu: bool, memory: bool, disk: bool, network: bool):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸."""
    console.print("ğŸ“Š ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ (Ctrl+C Ğ´Ğ»Ñ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ°)")

    def generate_layout():
        layout = Layout()
        layout.split_column(
            Layout(name="header", size=3),
            Layout(name="main"),
            Layout(name="footer", size=3),
        )
        layout["main"].split_row(Layout(name="left"), Layout(name="right"))
        return layout

    layout = generate_layout()

    try:
        with Live(layout, refresh_per_second=2, screen=True):
            while True:
                # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
                metrics = {}

                if cpu:
                    cpu_info = _get_cpu_info()
                    metrics["cpu_percent"] = cpu_info["percent"]
                    layout["left"].update(
                        Panel(
                            (
                                f"ğŸ–¥ï¸ CPU: {cpu_info['percent']:.1f}%\n"
                                f"ğŸ“ˆ Ğ¯Ğ´ĞµÑ€: {cpu_info['count']}\n"
                                f"ğŸ”§ Ğ§Ğ°ÑÑ‚Ğ¾Ñ‚Ğ°: {cpu_info['frequency']:.0f}MHz"
                                if cpu_info["frequency"]
                                else "N/A"
                            ),
                            title="CPU",
                        )
                    )

                if memory:
                    memory_info = _get_memory_info()
                    metrics["memory_percent"] = memory_info["percent"]
                    layout["right"].update(
                        Panel(
                            f"ğŸ’¾ Memory: {memory_info['percent']:.1f}%\n"
                            f"ğŸ“Š Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¾: {format_size(memory_info['used'])}\n"
                            f"ğŸ“ˆ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾: {format_size(memory_info['available'])}",
                            title="Memory",
                        )
                    )

                if disk:
                    disk_info = _get_disk_info()
                    metrics["disk_percent"] = disk_info["percent"]
                    layout["left"].update(
                        Panel(
                            f"ğŸ’¿ Disk: {disk_info['percent']:.1f}%\n"
                            f"ğŸ“Š Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¾: {format_size(disk_info['used'])}\n"
                            f"ğŸ“ˆ Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾: {format_size(disk_info['free'])}",
                            title="Disk",
                        )
                    )

                if network:
                    network_info = _get_network_info()
                    metrics["network_bytes_sent"] = network_info["bytes_sent"]
                    metrics["network_bytes_recv"] = network_info["bytes_recv"]
                    layout["right"].update(
                        Panel(
                            f"ğŸŒ Network\n"
                            f"ğŸ“Š ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾: {format_size(network_info['bytes_sent'])}\n"
                            f"ğŸ“Š ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾: {format_size(network_info['bytes_recv'])}",
                            title="Network",
                        )
                    )

                # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
                if metrics:
                    _save_metrics_to_db(metrics)

                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹
                alerts = await _check_alerts(metrics)
                if alerts:
                    alert_text = "\n".join(
                        [f"ğŸš¨ {alert['message']}" for alert in alerts]
                    )
                    layout["footer"].update(
                        Panel(alert_text, title="ĞĞ»ĞµÑ€Ñ‚Ñ‹", style="red")
                    )
                else:
                    layout["footer"].update(
                        Panel("âœ… Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ğ°", title="Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="green")
                    )

                layout["header"].update(
                    Panel(
                        f"ğŸ“Š ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ | {datetime.now().strftime('%H:%M:%S')}",
                        style="bold cyan",
                    )
                )

                await asyncio.sleep(2)

    except KeyboardInterrupt:
        console.print("\nâ¹ï¸ ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½")


async def _display_metrics_history(hours: int):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº."""
    console.print(
        Panel.fit(f"ğŸ“ˆ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ {hours} Ñ‡Ğ°ÑĞ¾Ğ²)", style="bold cyan")
    )

    history = _get_metrics_history(hours)

    if not history:
        console.print("[yellow]Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ¿ÑƒÑÑ‚Ğ°[/]")
        return

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ
    table = Table(title=f"Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº ({len(history)} Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹)")
    table.add_column("Ğ’Ñ€ĞµĞ¼Ñ", style="cyan")
    table.add_column("CPU %", style="yellow")
    table.add_column("Memory %", style="green")
    table.add_column("Disk %", style="blue")
    table.add_column("Network (MB)", style="magenta")

    for record in history[:50]:  # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 50 Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹
        timestamp = datetime.fromisoformat(record["timestamp"])
        cpu = record.get("cpu_percent", 0)
        memory = record.get("memory_percent", 0)
        disk = record.get("disk_percent", 0)
        network_sent = record.get("network_bytes_sent", 0) / (1024 * 1024)  # MB
        network_recv = record.get("network_bytes_recv", 0) / (1024 * 1024)  # MB

        table.add_row(
            timestamp.strftime("%H:%M:%S"),
            f"{cpu:.1f}",
            f"{memory:.1f}",
            f"{disk:.1f}",
            f"{network_sent:.1f}â†‘/{network_recv:.1f}â†“",
        )

    console.print(table)

    # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
    if history:
        cpu_values = [r.get("cpu_percent", 0) for r in history]
        memory_values = [r.get("memory_percent", 0) for r in history]
        disk_values = [r.get("disk_percent", 0) for r in history]

        console.print("\nğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:")
        console.print(
            f"   CPU: Ğ¼Ğ¸Ğ½ {min(cpu_values):.1f}%, Ğ¼Ğ°ĞºÑ {max(cpu_values):.1f}%, ÑÑ€ĞµĞ´Ğ½ {sum(cpu_values)/len(cpu_values):.1f}%"
        )
        console.print(
            f"   Memory: Ğ¼Ğ¸Ğ½ {min(memory_values):.1f}%, Ğ¼Ğ°ĞºÑ {max(memory_values):.1f}%, ÑÑ€ĞµĞ´Ğ½ {sum(memory_values)/len(memory_values):.1f}%"
        )
        console.print(
            f"   Disk: Ğ¼Ğ¸Ğ½ {min(disk_values):.1f}%, Ğ¼Ğ°ĞºÑ {max(disk_values):.1f}%, ÑÑ€ĞµĞ´Ğ½ {sum(disk_values)/len(disk_values):.1f}%"
        )


@monitor_app.command(name="alerts", help="Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹ Ğ¾Ğ¿Ğ¾Ğ²ĞµÑ‰ĞµĞ½Ğ¸Ğ¹.")
def monitor_alerts_cmd(
    list_alerts: bool = typer.Option(
        False, "--list", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¾Ğ¿Ğ¾Ğ²ĞµÑ‰ĞµĞ½Ğ¸Ñ"
    ),
    configure: bool = typer.Option(
        False, "--configure", help="ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¾Ğ¿Ğ¾Ğ²ĞµÑ‰ĞµĞ½Ğ¸Ğ¹"
    ),
    test: bool = typer.Option(False, "--test", help="ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ¿Ğ¾Ğ²ĞµÑ‰ĞµĞ½Ğ¸Ñ"),
    history: bool = typer.Option(False, "--history", help="Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²"),
):
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹ Ğ¾Ğ¿Ğ¾Ğ²ĞµÑ‰ĞµĞ½Ğ¸Ğ¹."""
    asyncio.run(_monitor_alerts_async(list_alerts, configure, test, history))


async def _monitor_alerts_async(
    list_alerts: bool, configure: bool, test: bool, history: bool
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ğ»ĞµÑ€Ñ‚Ğ°Ğ¼Ğ¸."""

    if not any([list_alerts, configure, test, history]):
        list_alerts = True  # ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº

    console.print(Panel.fit("ğŸ”” Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹ Ğ¾Ğ¿Ğ¾Ğ²ĞµÑ‰ĞµĞ½Ğ¸Ğ¹", style="bold cyan"))

    config = _load_alerts_config()

    if list_alerts:
        console.print("ğŸ“‹ ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²:")

        for metric, thresholds in config["alerts"].items():
            console.print(f"   ğŸ”´ {metric.upper()}:")
            console.print(f"      âš ï¸ ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ: > {thresholds['warning']}")
            console.print(f"      ğŸš¨ ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹: > {thresholds['critical']}")
        console.print()

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹
        current_metrics = {
            "cpu_percent": _get_cpu_info()["percent"],
            "memory_percent": _get_memory_info()["percent"],
            "disk_percent": _get_disk_info()["percent"],
        }

        current_alerts = await _check_alerts(current_metrics)

        if current_alerts:
            console.print("ğŸš¨ ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹:")
            for alert in current_alerts:
                emoji = "ğŸ”´" if alert["type"] == "critical" else "ğŸŸ¡"
                console.print(f"   {emoji} {alert['message']}")
        else:
            console.print("âœ… ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ² Ğ½ĞµÑ‚")

    if configure:
        console.print("âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ» Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²:")

        new_config = config.copy()

        for metric, thresholds in config["alerts"].items():
            console.print(f"\nğŸ“Š {metric.upper()}:")

            warning = input(
                f"ĞŸĞ¾Ñ€Ğ¾Ğ³ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ (Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹: {thresholds['warning']}): "
            ).strip()
            if warning:
                new_config["alerts"][metric]["warning"] = float(warning)

            critical = input(
                f"ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ¾Ñ€Ğ¾Ğ³ (Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹: {thresholds['critical']}): "
            ).strip()
            if critical:
                new_config["alerts"][metric]["critical"] = float(critical)

        # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
        console.print("\nğŸ“§ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹:")
        enable_notifications = (
            input("Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ? (y/n): ").strip().lower() == "y"
        )
        new_config["notifications"]["enabled"] = enable_notifications

        if enable_notifications:
            channels = input("ĞšĞ°Ğ½Ğ°Ğ»Ñ‹ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ (Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ): ").strip()
            if channels:
                new_config["notifications"]["channels"] = [
                    c.strip() for c in channels.split(",")
                ]

        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
        with open(ALERTS_CONFIG, "w") as f:
            json.dump(new_config, f, indent=2)

        console.print("[green]âœ… ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ² Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°[/]")

    if test:
        console.print("ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²:")

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
        test_metrics = {
            "cpu_percent": 95.0,  # ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ
            "memory_percent": 85.0,  # ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ
            "disk_percent": 90.0,  # ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ
        }

        test_alerts = await _check_alerts(test_metrics)

        if test_alerts:
            console.print("ğŸš¨ Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹:")
            for alert in test_alerts:
                emoji = "ğŸ”´" if alert["type"] == "critical" else "ğŸŸ¡"
                console.print(f"   {emoji} {alert['message']}")

            # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ
            await _send_alert_notifications(test_alerts)
            console.print("[green]âœ… Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ñ‹[/]")
        else:
            console.print("âœ… Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹ Ğ½Ğµ ÑÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»Ğ¸")


@monitor_app.command(name="logs", help="ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ»Ğ¾Ğ³Ğ¾Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.")
def monitor_logs_cmd(
    file: str = typer.Argument(..., help="ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ: ĞŸÑƒÑ‚ÑŒ Ğº ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¼Ñƒ Ñ„Ğ°Ğ¹Ğ»Ñƒ Ğ»Ğ¾Ğ³Ğ°"),
    analyze: bool = typer.Option(False, "--analyze", help="ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ² Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ…"),
    errors: bool = typer.Option(False, "--errors", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸"),
    last_n: Optional[int] = typer.Option(None, "--last", help="ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ N Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹"),
    since: Optional[str] = typer.Option(
        None, "--since", help="Ğ›Ğ¾Ğ³Ğ¸ Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ´Ğ°Ñ‚Ñ‹"
    ),
    search: Optional[str] = typer.Option(None, "--search", help="ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ"),
    force: bool = typer.Option(
        False, "--force", help="ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ» (>15MB)"
    ),
):
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ ĞšĞĞĞšĞ Ğ•Ğ¢ĞĞ«Ğ™ Ñ„Ğ°Ğ¹Ğ» Ğ»Ğ¾Ğ³Ğ°. ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 15MB Ğ±ĞµĞ· --force."""
    asyncio.run(
        _monitor_logs_async(file, analyze, errors, last_n, since, search, force)
    )


async def _monitor_logs_async(
    file_path: str,
    analyze: bool,
    errors: bool,
    last_n: Optional[int],
    since: Optional[str],
    search: Optional[str],
    force: bool,
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° ĞšĞĞĞšĞ Ğ•Ğ¢ĞĞĞ“Ğ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ»Ğ¾Ğ³Ğ°."""

    if not any([analyze, errors, last_n, since, search]):
        analyze = True  # ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼

    console.print(Panel.fit("ğŸ“‹ ĞĞ½Ğ°Ğ»Ğ¸Ğ· ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ»Ğ¾Ğ³Ğ°", style="bold cyan"))

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ±Ğ°Ğ·Ğ¾Ğ²ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ²
    logs_dir = Path("Data/Logs")

    # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¿ÑƒÑ‚Ğ¸ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ
    if file_path.startswith("/"):
        # ĞĞ±ÑĞ¾Ğ»ÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ
        log_file = Path(file_path)
    elif file_path.startswith("Data/Logs/"):
        # ĞÑ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğ¾Ñ‚ ĞºĞ¾Ñ€Ğ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
        log_file = Path(file_path)
    else:
        # ĞÑ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğ¾Ñ‚ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ»Ğ¾Ğ³Ğ¾Ğ²
        log_file = logs_dir / file_path

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ°
    if not log_file.exists():
        console.print(f"[red]âŒ Ğ¤Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: {log_file}[/]")

        # ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
        if logs_dir.exists():
            similar_files = list(logs_dir.rglob(f"*{Path(file_path).name}*"))
            if similar_files:
                console.print(
                    f"[yellow]ğŸ” Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ²Ñ‹ Ğ¸Ğ¼ĞµĞ»Ğ¸ Ğ² Ğ²Ğ¸Ğ´Ñƒ Ğ¾Ğ´Ğ¸Ğ½ Ğ¸Ğ· ÑÑ‚Ğ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²:[/]"
                )
                for i, similar_file in enumerate(similar_files[:10], 1):
                    rel_path = similar_file.relative_to(logs_dir)
                    file_size = format_size(similar_file.stat().st_size)
                    console.print(f"   {i}. ğŸ“„ {rel_path} ({file_size})")
        return

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ñ„Ğ°Ğ¹Ğ» Ğ»Ğ¾Ğ³Ğ°
    if not log_file.suffix.lower() in [".log", ".txt"]:
        console.print(
            f"[yellow]âš ï¸ ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ: '{log_file.suffix}' - Ğ½Ğµ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğµ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ Ğ»Ğ¾Ğ³Ğ°[/]"
        )

    # ğŸ›¡ï¸ Ğ—ĞĞ©Ğ˜Ğ¢Ğ ĞĞ¢ Ğ‘ĞĞ›Ğ¬Ğ¨Ğ˜Ğ¥ Ğ¤ĞĞ™Ğ›ĞĞ’ - ĞœĞĞšĞ¡Ğ˜ĞœĞ£Ğœ 15MB
    file_size = log_file.stat().st_size
    file_size_mb = file_size / (1024 * 1024)
    MAX_SIZE_MB = 15

    console.print(f"[cyan]ğŸ“„ Ğ¤Ğ°Ğ¹Ğ»: {log_file.name}[/]")
    console.print(
        f"[cyan]ğŸ“¦ Ğ Ğ°Ğ·Ğ¼ĞµÑ€: {format_size(file_size)} ({file_size_mb:.1f} MB)[/]"
    )

    if file_size_mb > MAX_SIZE_MB and not force:
        console.print(f"[red]ğŸš« Ğ¤ĞĞ™Ğ› Ğ¡Ğ›Ğ˜Ğ¨ĞšĞĞœ Ğ‘ĞĞ›Ğ¬Ğ¨ĞĞ™![/]")
        console.print(
            f"[red]   Ğ Ğ°Ğ·Ğ¼ĞµÑ€: {file_size_mb:.1f} MB (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼: {MAX_SIZE_MB} MB)[/]"
        )
        console.print(f"[yellow]   Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ --force Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸[/]")
        console.print(
            f"[yellow]   Ğ˜Ğ»Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµĞ¶ÑŒÑ‚Ğµ Ñ„Ğ°Ğ¹Ğ» Ğ½Ğ° Ñ‡Ğ°ÑÑ‚Ğ¸ < {MAX_SIZE_MB}MB ĞºĞ°Ğ¶Ğ´Ğ°Ñ[/]"
        )
        console.print()
        console.print("[dim]ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ñ€Ğ°Ğ·Ğ±Ğ¸Ğ²ĞºĞ¸ Ñ„Ğ°Ğ¹Ğ»Ğ°:[/]")
        console.print(
            f"[dim]   split -b {MAX_SIZE_MB}M '{log_file}' '{log_file}.part_'[/]"
        )
        console.print(f"[dim]   head -n 10000 '{log_file}' > '{log_file}.first_10k'[/]")
        console.print(f"[dim]   tail -n 10000 '{log_file}' > '{log_file}.last_10k'[/]")
        return

    if file_size_mb > MAX_SIZE_MB and force:
        console.print(
            f"[red]âš ï¸ ĞŸĞ Ğ˜ĞĞ£Ğ”Ğ˜Ğ¢Ğ•Ğ›Ğ¬ĞĞĞ¯ ĞĞ‘Ğ ĞĞ‘ĞĞ¢ĞšĞ Ğ‘ĞĞ›Ğ¬Ğ¨ĞĞ“Ğ Ğ¤ĞĞ™Ğ›Ğ ({file_size_mb:.1f} MB)[/]"
        )
        console.print(f"[red]   Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ğ½ÑÑ‚ÑŒ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¸ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸![/]")

        # Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
        if file_size_mb > 50:
            console.print(
                f"[red]ğŸš¨ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ‘ĞĞ›Ğ¬Ğ¨ĞĞ™ Ğ¤ĞĞ™Ğ› ({file_size_mb:.1f} MB)![/]"
            )
            try:
                confirm = input(
                    "Ğ’Ñ‹ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ? (Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ 'Ğ”Ğ' Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ): "
                ).strip()
                if confirm != "Ğ”Ğ":
                    console.print("[yellow]âš ï¸ ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°[/]")
                    return
            except KeyboardInterrupt:
                console.print("\n[yellow]âš ï¸ ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼[/]")
                return

    # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
    log_files = [log_file]  # Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ Ğ¾Ğ´Ğ½Ğ¸Ğ¼ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ¼

    if analyze:
        await _analyze_single_log_file(log_file)

    if errors:
        await _show_log_errors(log_files)

    if last_n:
        await _show_last_n_logs(log_files, last_n)

    if since:
        await _show_logs_since(log_files, since)

    if search:
        await _search_in_logs(log_files, search)


async def _select_log_files(
    all_files: List[Path], max_files: int, total_size_mb: float
) -> List[Path]:
    """Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸"""

    console.print(
        f"[yellow]âš ï¸ Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•: ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ {len(all_files)} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€: {total_size_mb:.1f} MB)[/]"
    )
    console.print(
        "[yellow]   ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ²ÑĞµÑ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ğ½ÑÑ‚ÑŒ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¸ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸![/]"
    )
    console.print()

    console.print("ğŸ“‹ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹:")
    console.print("1. ğŸ“… Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞµĞ³Ğ¾Ğ´Ğ½ÑÑˆĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹")
    console.print("2. ğŸ“Š N ÑĞ°Ğ¼Ñ‹Ñ… ÑĞ²ĞµĞ¶Ğ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²")
    console.print("3. ğŸ¯ Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹")
    console.print("4. ğŸ” Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñƒ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²")
    console.print("5. âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°")

    try:
        choice = input("\nĞ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ (1-5): ").strip()

        if choice == "1":
            # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞµĞ³Ğ¾Ğ´Ğ½ÑÑˆĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ - Ğ¸Ñ‰ĞµĞ¼ Ğ² Ğ¿Ğ°Ğ¿ĞºĞµ ÑĞµĞ³Ğ¾Ğ´Ğ½ÑÑˆĞ½ĞµĞ¹ Ğ´Ğ°Ñ‚Ñ‹
            today = datetime.now()
            today_str = today.strftime("%Y-%m-%d")
            today_files = []

            # Ğ˜Ñ‰ĞµĞ¼ Ğ² Ğ½Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğµ: Data/Logs/YYYY/MM-Month/DD/
            today_year = today.year
            today_month = today.strftime("%m-%B")
            today_day = today.strftime("%d")

            today_path = (
                Path("Data/Logs") / str(today_year) / today_month / today_day
            )

            if today_path.exists() and today_path.is_dir():
                today_files.extend(list(today_path.glob("*.log")))
                console.print(
                    f"[dim]ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ² {today_path}: {len(today_files)} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²[/]"
                )

            # Ğ¢Ğ°ĞºĞ¶Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑ‚Ğ°Ñ€ÑƒÑ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ - Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ñ ÑĞµĞ³Ğ¾Ğ´Ğ½ÑÑˆĞ½ĞµĞ¹ Ğ´Ğ°Ñ‚Ğ¾Ğ¹ Ğ² Ğ¸Ğ¼ĞµĞ½Ğ¸
            logs_dir = Path("Data/Logs")
            for pattern in [
                f"*{today_str}*.log",
                f"*{today.strftime('%Y-%m-%d')}*.log",
            ]:
                old_files = list(logs_dir.glob(pattern))
                for file in old_files:
                    if file not in today_files:
                        today_files.append(file)

            # Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğµ Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ (Ğ½Ğ¾ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹)
            if not today_files:
                console.print(
                    "[yellow]ğŸ“… Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ·Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ² ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğµ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹, Ğ¸Ñ‰ĞµĞ¼ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğµ Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸...[/]"
                )
                today_date = today.date()
                for file in all_files:
                    file_date = datetime.fromtimestamp(file.stat().st_mtime).date()
                    if file_date == today_date:
                        today_files.append(file)

            if today_files:
                console.print(
                    f"[green]âœ… ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ·Ğ° {today_str}: {len(today_files)}[/]"
                )
                # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
                for i, file in enumerate(today_files, 1):
                    rel_path = file.relative_to(Path("Data/Logs"))
                    file_size = format_size(file.stat().st_size)
                    console.print(f"   {i}. ğŸ“„ {rel_path} ({file_size})")
                return today_files
            else:
                console.print(f"[yellow]âš ï¸ Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ·Ğ° {today_str} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾[/]")
                return []

        elif choice == "2":
            # N ÑĞ°Ğ¼Ñ‹Ñ… ÑĞ²ĞµĞ¶Ğ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
            try:
                n = int(input(f"ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ {max_files}): ").strip())
                n = min(n, max_files, len(all_files))
                selected = all_files[:n]
                console.print(
                    f"[green]âœ… Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ¾ {len(selected)} ÑĞ°Ğ¼Ñ‹Ñ… ÑĞ²ĞµĞ¶Ğ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²[/]"
                )
                return selected
            except ValueError:
                console.print("[red]âŒ ĞĞµĞ²ĞµÑ€Ğ½Ğ¾Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾[/]")
                return []

        elif choice == "3":
            # Ğ’Ñ‹Ğ±Ğ¾Ñ€ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
            return await _interactive_file_selection(all_files, max_files)

        elif choice == "4":
            # Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñƒ
            try:
                max_size_mb = float(input("ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ² MB: ").strip())
                max_size_bytes = max_size_mb * 1024 * 1024

                filtered_files = []
                for file in all_files:
                    if file.stat().st_size <= max_size_bytes:
                        filtered_files.append(file)
                        if len(filtered_files) >= max_files:
                            break

                console.print(
                    f"[green]âœ… Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ¾ {len(filtered_files)} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ¾Ğ¼ Ğ´Ğ¾ {max_size_mb}MB[/]"
                )
                return filtered_files
            except ValueError:
                console.print("[red]âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€[/]")
                return []

        elif choice == "5":
            return []

        else:
            console.print("[red]âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€[/]")
            return []

    except KeyboardInterrupt:
        console.print("\n[yellow]âš ï¸ ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼[/]")
        return []
    except Exception as e:
        console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ°: {e}[/]")
        return []


async def _interactive_file_selection(
    all_files: List[Path], max_files: int
) -> List[Path]:
    """Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²"""

    console.print("ğŸ“‹ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:")

    # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ñ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ°Ğ¼Ğ¸
    for i, file in enumerate(all_files[:20], 1):  # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿ĞµÑ€Ğ²Ñ‹Ğµ 20
        rel_path = file.relative_to(Path("Data/Logs"))
        file_size = format_size(file.stat().st_size)
        file_date = datetime.fromtimestamp(file.stat().st_mtime).strftime(
            "%Y-%m-%d %H:%M"
        )
        console.print(f"   {i:2d}. ğŸ“„ {rel_path} ({file_size}, {file_date})")

    if len(all_files) > 20:
        console.print(f"   ... Ğ¸ ĞµÑ‰Ğµ {len(all_files) - 20} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²")

    console.print(
        f"\n[cyan]Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ {max_files})[/]"
    )
    console.print("[dim]ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: 1,3,5 Ğ¸Ğ»Ğ¸ 1-5 Ğ¸Ğ»Ğ¸ all Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ¿ĞµÑ€Ğ²Ñ‹Ñ… 20[/]")

    try:
        selection = input("Ğ’Ğ°Ñˆ Ğ²Ñ‹Ğ±Ğ¾Ñ€: ").strip()

        if selection.lower() == "all":
            selected_count = min(max_files, len(all_files), 20)
            return all_files[:selected_count]

        # ĞŸĞ°Ñ€ÑĞ¸Ğ¼ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ñ‹ Ğ¸ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ°
        selected_indices = set()

        for part in selection.split(","):
            part = part.strip()
            if "-" in part:
                # Ğ”Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½
                try:
                    start, end = map(int, part.split("-"))
                    for i in range(start, end + 1):
                        if 1 <= i <= min(len(all_files), 20):
                            selected_indices.add(i - 1)  # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ² 0-based
                except ValueError:
                    console.print(f"[yellow]âš ï¸ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½: {part}[/]")
            else:
                # ĞĞ´Ğ¸Ğ½Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ½Ğ¾Ğ¼ĞµÑ€
                try:
                    i = int(part)
                    if 1 <= i <= min(len(all_files), 20):
                        selected_indices.add(i - 1)  # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ² 0-based
                except ValueError:
                    console.print(f"[yellow]âš ï¸ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ½Ğ¾Ğ¼ĞµÑ€: {part}[/]")

        # ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾
        selected_indices = list(selected_indices)[:max_files]
        selected_files = [all_files[i] for i in selected_indices]

        console.print(f"[green]âœ… Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: {len(selected_files)}[/]")
        return selected_files

    except KeyboardInterrupt:
        console.print("\n[yellow]âš ï¸ Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½[/]")
        return []
    except Exception as e:
        console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ°: {e}[/]")
        return []


async def _analyze_single_log_file(log_file: Path):
    """Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ»Ğ¾Ğ³Ğ° Ñ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸ÑĞ¼Ğ¸"""
    console.print(f"ğŸ“Š ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ°: {log_file.name}")

    try:
        file_size = log_file.stat().st_size
        file_size_mb = file_size / (1024 * 1024)

        total_lines = 0
        error_count = 0
        warning_count = 0
        info_count = 0
        debug_count = 0

        # Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¡Ğ¢Ğ¬: ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ñ‹Ñ… ÑÑ‚Ñ€Ğ¾Ğº
        max_lines_to_read = 50000  # ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 50k ÑÑ‚Ñ€Ğ¾Ğº

        console.print(f"   ğŸ“¦ Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ°: {format_size(file_size)}")
        console.print(f"   ğŸ”’ ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ ÑÑ‚Ñ€Ğ¾Ğº Ğ´Ğ»Ñ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ: {max_lines_to_read:,}")

        with Progress(
            SpinnerColumn(),
            TextColumn("[progress.description]{task.description}"),
            console=console,
        ) as progress:

            task = progress.add_task("ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ°...", total=None)

            try:
                with open(log_file, "r", encoding="utf-8", errors="ignore") as f:
                    lines_read = 0

                    for line_num, line in enumerate(f, 1):
                        if lines_read >= max_lines_to_read:
                            console.print(
                                f"   âš ï¸ Ğ”Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ ({max_lines_to_read:,} ÑÑ‚Ñ€Ğ¾Ğº)"
                            )
                            break

                        lines_read += 1
                        total_lines = line_num

                        # ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ‚Ğ¸Ğ¿Ğ¾Ğ² ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
                        line_lower = line.lower()
                        if any(
                            keyword in line_lower
                            for keyword in ["error", "exception", "failed", "fatal"]
                        ):
                            error_count += 1
                        elif any(
                            keyword in line_lower
                            for keyword in ["warning", "warn", "deprecated"]
                        ):
                            warning_count += 1
                        elif any(
                            keyword in line_lower for keyword in ["info", "information"]
                        ):
                            info_count += 1
                        elif any(
                            keyword in line_lower for keyword in ["debug", "trace"]
                        ):
                            debug_count += 1

                        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 1000 ÑÑ‚Ñ€Ğ¾Ğº
                        if lines_read % 1000 == 0:
                            progress.update(
                                task, description=f"ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¾ {lines_read:,} ÑÑ‚Ñ€Ğ¾Ğº..."
                            )

                progress.update(task, description="ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½")

            except Exception as e:
                console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°: {str(e)[:100]}...")
                return

        # Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°
        console.print(f"\nğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°:")
        console.print(f"   ğŸ“ Ğ’ÑĞµĞ³Ğ¾ ÑÑ‚Ñ€Ğ¾Ğº Ğ² Ñ„Ğ°Ğ¹Ğ»Ğµ: {total_lines:,}")
        console.print(f"   ğŸ“– ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¾ ÑÑ‚Ñ€Ğ¾Ğº: {lines_read:,}")

        if lines_read < total_lines:
            console.print(
                f"   âš ï¸ Ğ¤Ğ°Ğ¹Ğ» Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ ({(lines_read/total_lines)*100:.1f}%)"
            )

        console.print(f"   ğŸ”´ ĞÑˆĞ¸Ğ±Ğ¾Ğº Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾: {error_count:,}")
        console.print(f"   ğŸŸ¡ ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğ¹: {warning_count:,}")
        console.print(f"   ğŸŸ¢ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ñ…: {info_count:,}")
        console.print(f"   ğŸ”µ ĞÑ‚Ğ»Ğ°Ğ´Ğ¾Ñ‡Ğ½Ñ‹Ñ…: {debug_count:,}")

        # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ
        if lines_read > 0:
            console.print(f"\nğŸ“ˆ ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ:")
            console.print(f"   ğŸ”´ ĞÑˆĞ¸Ğ±ĞºĞ¸: {(error_count/lines_read)*100:.1f}%")
            console.print(
                f"   ğŸŸ¡ ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ: {(warning_count/lines_read)*100:.1f}%"
            )
            console.print(f"   ğŸŸ¢ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ: {(info_count/lines_read)*100:.1f}%")
            console.print(f"   ğŸ”µ ĞÑ‚Ğ»Ğ°Ğ´ĞºĞ°: {(debug_count/lines_read)*100:.1f}%")

        # ĞÑ†ĞµĞ½ĞºĞ° Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ Ğ»Ğ¾Ğ³Ğ°
        if error_count > 0:
            error_ratio = error_count / lines_read
            if error_ratio > 0.1:  # Ğ‘Ğ¾Ğ»ĞµĞµ 10% Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
                console.print(
                    f"\nğŸš¨ [red]ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ• Ğ¡ĞĞ¡Ğ¢ĞĞ¯ĞĞ˜Ğ•: {error_ratio*100:.1f}% Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº![/]"
                )
            elif error_ratio > 0.05:  # Ğ‘Ğ¾Ğ»ĞµĞµ 5% Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
                console.print(
                    f"\nâš ï¸ [yellow]Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•: Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº ({error_ratio*100:.1f}%)[/]"
                )
            else:
                console.print(
                    f"\nâœ… [green]ĞŸÑ€Ğ¸ĞµĞ¼Ğ»ĞµĞ¼Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº ({error_ratio*100:.1f}%)[/]"
                )
        else:
            console.print(f"\nğŸ‰ [green]ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾: ĞÑˆĞ¸Ğ±ĞºĞ¸ Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ñ‹![/]")

    except Exception as e:
        console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°: {str(e)[:100]}...")

    console.print()


async def _analyze_log_files(log_files: List[Path]):
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ»Ğ¾Ğ³Ğ¾Ğ²"""
    console.print("ğŸ“Š ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ»Ğ¾Ğ³Ğ¾Ğ²:")

    try:
        if not log_files:
            console.print("   ğŸ“­ Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹")
            return

        total_lines = 0
        error_count = 0
        warning_count = 0
        info_count = 0
        debug_count = 0
        total_size = 0

        console.print(f"   ğŸ“ ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: {len(log_files)}")

        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ-Ğ±Ğ°Ñ€ Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
        with Progress(
            SpinnerColumn(),
            TextColumn("[progress.description]{task.description}"),
            console=console,
        ) as progress:

            task = progress.add_task("ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ»Ğ¾Ğ³Ğ¾Ğ²...", total=len(log_files))

            # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»
            for log_file in log_files:
                try:
                    file_size = log_file.stat().st_size
                    total_size += file_size

                    # Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¡Ğ¢Ğ¬: ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
                    max_lines_to_read = 10000  # ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 10k ÑÑ‚Ñ€Ğ¾Ğº Ğ½Ğ° Ñ„Ğ°Ğ¹Ğ»
                    lines_read = 0

                    with open(log_file, "r", encoding="utf-8", errors="ignore") as f:
                        file_lines = 0
                        file_errors = 0
                        file_warnings = 0
                        file_info = 0
                        file_debug = 0

                        # Ğ•ÑĞ»Ğ¸ Ñ„Ğ°Ğ¹Ğ» Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹, Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ ĞºĞ¾Ğ½Ñ†Ğ°
                        if file_size > 10 * 1024 * 1024:  # 10MB
                            # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°
                            f.seek(max(0, file_size - 1024 * 1024))  # ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ 1MB
                            f.readline()  # ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ½ĞµĞ¿Ğ¾Ğ»Ğ½ÑƒÑ ÑÑ‚Ñ€Ğ¾ĞºÑƒ

                        for line in f:
                            file_lines += 1
                            lines_read += 1

                            # ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ¾Ğº
                            if lines_read > max_lines_to_read:
                                break

                            line_lower = line.lower()

                            # Ğ‘Ğ¾Ğ»ĞµĞµ Ñ‚Ğ¾Ñ‡Ğ½Ğ°Ñ ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ²
                            if any(
                                keyword in line_lower
                                for keyword in [
                                    "error",
                                    "Ğ¾ÑˆĞ¸Ğ±ĞºĞ°",
                                    "exception",
                                    "failed",
                                    "critical",
                                ]
                            ):
                                file_errors += 1
                            elif any(
                                keyword in line_lower
                                for keyword in ["warning", "warn", "Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ"]
                            ):
                                file_warnings += 1
                            elif any(
                                keyword in line_lower
                                for keyword in ["debug", "trace", "Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ°"]
                            ):
                                file_debug += 1
                            elif any(
                                keyword in line_lower
                                for keyword in [
                                    "info",
                                    "Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ",
                                    "success",
                                    "started",
                                    "finished",
                                ]
                            ):
                                file_info += 1

                        total_lines += file_lines
                        error_count += file_errors
                        warning_count += file_warnings
                        info_count += file_info
                        debug_count += file_debug

                    # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğµ
                    rel_path = log_file.relative_to(Path("Data/Logs"))
                    truncated = " (ÑƒÑĞµÑ‡ĞµĞ½)" if lines_read >= max_lines_to_read else ""
                    console.print(
                        f"   ğŸ“„ {rel_path}: {file_lines:,} ÑÑ‚Ñ€Ğ¾Ğº{truncated}, {format_size(file_size)}"
                    )
                    if file_errors > 0:
                        console.print(f"      ğŸ”´ ĞÑˆĞ¸Ğ±Ğ¾Ğº: {file_errors}")
                    if file_warnings > 0:
                        console.print(f"      ğŸŸ¡ ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğ¹: {file_warnings}")

                    progress.advance(task)

                except Exception as e:
                    console.print(
                        f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ {log_file.name}: {str(e)[:50]}..."
                    )
                    progress.advance(task)

        # ĞĞ±Ñ‰Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
        console.print(f"\nğŸ“Š ĞĞ±Ñ‰Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:")
        console.print(f"   ğŸ“ Ğ’ÑĞµĞ³Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹: {total_lines:,}")
        console.print(f"   ğŸ“¦ ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€: {format_size(total_size)}")
        console.print(f"   ğŸ”´ ĞÑˆĞ¸Ğ±Ğ¾Ğº: {error_count:,}")
        console.print(f"   ğŸŸ¡ ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğ¹: {warning_count:,}")
        console.print(f"   ğŸŸ¢ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ñ…: {info_count:,}")
        console.print(f"   ğŸ”µ ĞÑ‚Ğ»Ğ°Ğ´Ğ¾Ñ‡Ğ½Ñ‹Ñ…: {debug_count:,}")

        # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ³Ğ¾ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²)
        if len(log_files) <= 3 and total_size < 50 * 1024 * 1024:  # ĞœĞµĞ½ÑŒÑˆĞµ 50MB
            await _analyze_activity_patterns(log_files)
        else:
            console.print(
                "   ğŸ“ˆ ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ² Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½ (ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)"
            )

    except Exception as e:
        console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ²: {str(e)[:100]}...")

    console.print()


async def _analyze_activity_patterns(log_files: List[Path]):
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ² Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ…"""
    console.print("ğŸ“ˆ ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ² Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸:")

    try:
        hourly_activity = {hour: 0 for hour in range(24)}
        recent_errors = []

        for log_file in log_files:
            try:
                with open(log_file, "r", encoding="utf-8", errors="ignore") as f:
                    lines = f.readlines()[-1000:]  # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 1000 ÑÑ‚Ñ€Ğ¾Ğº

                    for line in lines:
                        # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸Ğ· ÑÑ‚Ñ€Ğ¾ĞºĞ¸
                        if len(line) > 19:  # ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´Ğ»Ğ¸Ğ½Ğ° Ğ´Ğ»Ñ Ğ´Ğ°Ñ‚Ñ‹-Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
                            try:
                                # Ğ˜Ñ‰ĞµĞ¼ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ´Ğ°Ñ‚Ñ‹-Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
                                import re

                                time_pattern = (
                                    r"(\d{4}-\d{2}-\d{2}\s+\d{2}):(\d{2}):\d{2}"
                                )
                                match = re.search(time_pattern, line)
                                if match:
                                    hour = int(match.group(2))
                                    hourly_activity[hour] += 1

                                # Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
                                if any(
                                    keyword in line.lower()
                                    for keyword in ["error", "Ğ¾ÑˆĞ¸Ğ±ĞºĞ°", "exception"]
                                ):
                                    if len(recent_errors) < 5:
                                        recent_errors.append(line.strip()[:100])
                            except:
                                continue

            except Exception:
                continue

        # ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ¿Ğ¸ĞºĞ¾Ğ²Ñ‹Ğµ Ñ‡Ğ°ÑÑ‹
        if sum(hourly_activity.values()) > 0:
            max_hour = max(hourly_activity, key=hourly_activity.get)
            min_hour = min(hourly_activity, key=hourly_activity.get)

            console.print(
                f"   ğŸ“Š ĞŸĞ¸ĞºĞ¾Ğ²Ğ°Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ: {max_hour:02d}:00 ({hourly_activity[max_hour]} Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹)"
            )
            console.print(
                f"   ğŸ“Š ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ: {min_hour:02d}:00 ({hourly_activity[min_hour]} Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹)"
            )

            avg_activity = sum(hourly_activity.values()) / 24
            console.print(f"   ğŸ“Š Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ: {avg_activity:.1f} Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹/Ñ‡Ğ°Ñ")

        # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
        if recent_errors:
            console.print("ğŸ” ĞĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸:")
            for error in recent_errors:
                console.print(f"   âŒ {error}")

    except Exception as e:
        console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ²: {str(e)[:100]}...")


async def _show_log_errors(log_files: List[Path]):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¸Ğ· Ğ»Ğ¾Ğ³Ğ¾Ğ²"""
    console.print("âŒ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ…:")

    try:
        error_lines = []
        max_errors = 20  # ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°

        for log_file in log_files:
            try:
                file_size = log_file.stat().st_size

                with open(log_file, "r", encoding="utf-8", errors="ignore") as f:
                    # Ğ”Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ ĞºĞ¾Ğ½Ñ†Ğ°
                    if file_size > 5 * 1024 * 1024:  # 5MB
                        f.seek(max(0, file_size - 1024 * 1024))  # ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ 1MB
                        f.readline()  # ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ½ĞµĞ¿Ğ¾Ğ»Ğ½ÑƒÑ ÑÑ‚Ñ€Ğ¾ĞºÑƒ

                    lines_processed = 0
                    for line_num, line in enumerate(f, 1):
                        lines_processed += 1
                        # ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ¾Ğº
                        if lines_processed > 5000:
                            break

                        if any(
                            keyword in line.lower()
                            for keyword in [
                                "error",
                                "Ğ¾ÑˆĞ¸Ğ±ĞºĞ°",
                                "exception",
                                "failed",
                                "critical",
                            ]
                        ):
                            rel_path = log_file.relative_to(Path("Data/Logs"))
                            error_lines.append((str(rel_path), line_num, line.strip()))

                            if len(error_lines) >= max_errors:
                                break
                if len(error_lines) >= max_errors:
                    break
            except Exception:
                continue

        if error_lines:
            console.print(f"   ğŸ“Š ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº: {len(error_lines)}")
            for file_name, line_num, line in error_lines[
                -15:
            ]:  # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 15
                console.print(f"   ğŸ“„ {file_name}:{line_num} - {line[:120]}")
        else:
            console.print("   âœ… ĞÑˆĞ¸Ğ±ĞºĞ¸ Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ… Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹")

    except Exception as e:
        console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº: {str(e)[:100]}...")

    console.print()


async def _show_last_n_logs(log_files: List[Path], n: int):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ N Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ¸Ğ· Ğ»Ğ¾Ğ³Ğ¾Ğ²"""
    console.print(f"ğŸ“‹ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ {n} Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ¸Ğ· Ğ»Ğ¾Ğ³Ğ¾Ğ²:")

    try:
        all_lines = []

        # Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
        sorted_files = sorted(log_files, key=lambda f: f.stat().st_mtime, reverse=True)

        for log_file in sorted_files[:3]:  # Ğ‘ĞµÑ€ĞµĞ¼ 3 ÑĞ°Ğ¼Ñ‹Ñ… ÑĞ²ĞµĞ¶Ğ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ°
            try:
                with open(log_file, "r", encoding="utf-8", errors="ignore") as f:
                    lines = f.readlines()
                    rel_path = log_file.relative_to(Path("Data/Logs"))
                    for line in lines[-50:]:  # ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 50 ÑÑ‚Ñ€Ğ¾Ğº Ğ¸Ğ· ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°
                        all_lines.append((str(rel_path), line.strip()))
            except Exception:
                continue

        # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ N ÑÑ‚Ñ€Ğ¾Ğº
        for file_name, line in all_lines[-n:]:
            console.print(f"   ğŸ“„ {file_name}: {line[:150]}")

        if not all_lines:
            console.print("   ğŸ“­ Ğ—Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ… Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹")

    except Exception as e:
        console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ²: {str(e)[:100]}...")

    console.print()


async def _show_logs_since(log_files: List[Path], since: str):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ´Ğ°Ñ‚Ñ‹"""
    console.print(f"ğŸ“‹ Ğ›Ğ¾Ğ³Ğ¸ Ñ {since}:")

    try:
        # ĞŸĞ°Ñ€ÑĞ¸Ğ¼ Ğ´Ğ°Ñ‚Ñƒ
        from datetime import datetime

        since_date = datetime.strptime(since, "%Y-%m-%d")

        found_lines = []

        for log_file in log_files:
            try:
                with open(log_file, "r", encoding="utf-8", errors="ignore") as f:
                    rel_path = log_file.relative_to(Path("Data/Logs"))
                    for line in f:
                        # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ´Ğ°Ñ‚Ñƒ Ğ² ÑÑ‚Ñ€Ğ¾ĞºĞµ
                        import re

                        date_pattern = r"(\d{4}-\d{2}-\d{2})"
                        match = re.search(date_pattern, line)
                        if match:
                            try:
                                line_date = datetime.strptime(
                                    match.group(1), "%Y-%m-%d"
                                )
                                if line_date >= since_date:
                                    found_lines.append((str(rel_path), line.strip()))
                                    if len(found_lines) >= 30:  # ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ²Ñ‹Ğ²Ğ¾Ğ´
                                        break
                            except:
                                continue
                if len(found_lines) >= 30:
                    break
            except Exception:
                continue

        if found_lines:
            for file_name, line in found_lines:
                console.print(f"   ğŸ“„ {file_name}: {line[:150]}")
        else:
            console.print(f"   ğŸ“­ Ğ—Ğ°Ğ¿Ğ¸ÑĞ¸ Ñ {since} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹")

    except ValueError:
        console.print(f"   âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ°Ñ‚Ñ‹. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ YYYY-MM-DD")
    except Exception as e:
        console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğµ: {str(e)[:100]}...")

    console.print()


async def _search_in_logs(log_files: List[Path], pattern: str):
    """ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ…"""
    console.print(f"ğŸ” ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ '{pattern}' Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ…:")

    try:
        found_lines = []
        max_matches = 25  # ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğ¹

        with Progress(
            SpinnerColumn(),
            TextColumn("[progress.description]{task.description}"),
            console=console,
        ) as progress:

            task = progress.add_task("ĞŸĞ¾Ğ¸ÑĞº Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ…...", total=len(log_files))

            for log_file in log_files:
                try:
                    file_size = log_file.stat().st_size

                    with open(log_file, "r", encoding="utf-8", errors="ignore") as f:
                        # Ğ”Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ¸ÑĞº
                        if file_size > 10 * 1024 * 1024:  # 10MB
                            f.seek(max(0, file_size - 2 * 1024 * 1024))  # ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 2MB
                            f.readline()  # ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ½ĞµĞ¿Ğ¾Ğ»Ğ½ÑƒÑ ÑÑ‚Ñ€Ğ¾ĞºÑƒ

                        rel_path = log_file.relative_to(Path("Data/Logs"))
                        lines_processed = 0

                        for line_num, line in enumerate(f, 1):
                            lines_processed += 1

                            # ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ¾Ğº
                            if lines_processed > 10000:  # ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 10k ÑÑ‚Ñ€Ğ¾Ğº Ğ½Ğ° Ñ„Ğ°Ğ¹Ğ»
                                break

                            if pattern.lower() in line.lower():
                                found_lines.append(
                                    (str(rel_path), line_num, line.strip())
                                )

                                if len(found_lines) >= max_matches:
                                    break

                    progress.advance(task)

                    if len(found_lines) >= max_matches:
                        break
                except Exception:
                    progress.advance(task)
                    continue

        if found_lines:
            console.print(f"   ğŸ“Š ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğ¹: {len(found_lines)}")
            for file_name, line_num, line in found_lines:
                console.print(f"   ğŸ“„ {file_name}:{line_num} - {line[:120]}")
        else:
            console.print(f"   ğŸ“­ Ğ¡Ğ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ñ Ñ '{pattern}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹")

    except Exception as e:
        console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ¸ÑĞºĞ°: {str(e)[:100]}...")

    console.print()


def format_size(size_bytes: int) -> str:
    """Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ² Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ¾Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ñ‹Ğ¹ Ğ²Ğ¸Ğ´"""
    if size_bytes == 0:
        return "0 B"
    size_names = ["B", "KB", "MB", "GB", "TB"]
    import math

    i = int(math.floor(math.log(size_bytes, 1024)))
    p = math.pow(1024, i)
    s = round(size_bytes / p, 2)
    return f"{s} {size_names[i]}"


@monitor_app.command(name="performance", help="ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.")
def monitor_performance_cmd(
    slow_queries: bool = typer.Option(
        False, "--slow-queries", help="ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğº Ğ‘Ğ”"
    ),
    response_time: bool = typer.Option(
        False, "--response-time", help="Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° API"
    ),
    memory_leaks: bool = typer.Option(
        False, "--memory-leaks", help="ĞŸĞ¾Ğ¸ÑĞº ÑƒÑ‚ĞµÑ‡ĞµĞº Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸"
    ),
    bottlenecks: bool = typer.Option(False, "--bottlenecks", help="ĞŸĞ¾Ğ¸ÑĞº ÑƒĞ·ĞºĞ¸Ñ… Ğ¼ĞµÑÑ‚"),
):
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹."""
    asyncio.run(
        _monitor_performance_async(
            slow_queries, response_time, memory_leaks, bottlenecks
        )
    )


async def _monitor_performance_async(
    slow_queries: bool, response_time: bool, memory_leaks: bool, bottlenecks: bool
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸."""

    # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸, Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²ÑĞµ
    if not any([slow_queries, response_time, memory_leaks, bottlenecks]):
        slow_queries = response_time = memory_leaks = bottlenecks = True

    console.print(Panel.fit("âš¡ ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹", style="bold cyan"))

    if slow_queries:
        await _analyze_slow_queries()

    if response_time:
        await _analyze_response_time()

    if memory_leaks:
        await _analyze_memory_leaks()

    if bottlenecks:
        await _analyze_bottlenecks()


async def _analyze_slow_queries():
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğº Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
    console.print("ğŸ” ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğº Ğ‘Ğ”:")

    try:
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ Ğ‘Ğ”
        settings, db_manager, _ = await get_sdb_services_for_cli(init_db=True)

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ… SQLite
        slow_queries_found = False

        # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¶ÑƒÑ€Ğ½Ğ°Ğ» SQLite (ĞµÑĞ»Ğ¸ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½)
        if hasattr(db_manager, "get_connection"):
            try:
                connection = db_manager.get_connection()

                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
                cursor = connection.cursor()

                # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ… Ğ¸ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ…
                cursor.execute(
                    """
                    SELECT name, sql FROM sqlite_master 
                    WHERE type='table' AND name NOT LIKE 'sqlite_%'
                """
                )
                tables = cursor.fetchall()

                console.print(f"   ğŸ“Š ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ² Ğ‘Ğ”: {len(tables)}")

                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¾Ğ²
                cursor.execute(
                    """
                    SELECT name, sql FROM sqlite_master 
                    WHERE type='index' AND name NOT LIKE 'sqlite_%'
                """
                )
                indexes = cursor.fetchall()

                console.print(f"   ğŸ“ˆ ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ñ… Ğ¸Ğ½Ğ´ĞµĞºÑĞ¾Ğ²: {len(indexes)}")

                if len(indexes) == 0 and len(tables) > 0:
                    console.print(
                        "   âš ï¸ Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹ - ÑÑ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ğ¼ĞµĞ´Ğ»ÑÑ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹"
                    )
                    slow_queries_found = True

                # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñ‹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
                for table_name, _ in tables:
                    try:
                        cursor.execute(f"SELECT COUNT(*) FROM `{table_name}`")
                        count = cursor.fetchone()[0]
                        if count > 1000:
                            console.print(
                                f"   ğŸ“Š Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° {table_name}: {count:,} Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ)"
                            )
                    except Exception:
                        pass

            except Exception as e:
                console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ‘Ğ”: {str(e)[:100]}...")

        if not slow_queries_found:
            console.print(
                "   âœ… ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼ Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒÑ Ğ‘Ğ” Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¾"
            )

    except Exception as e:
        console.print(f"   âŒ ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ñ€Ğ¾Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ‘Ğ”: {str(e)[:100]}...")

    console.print()


async def _analyze_response_time():
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° API"""
    console.print("ğŸ“Š ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹:")

    try:
        # Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚ĞºĞ»Ğ¸ĞºĞ° Ğ±Ğ¾Ñ‚Ğ°
        bot_status = await _get_bot_status()
        response_time = bot_status.get("response_time", 0)

        console.print(f"   ğŸ“ˆ Telegram Bot API: {response_time:.3f} ÑĞµĞº")

        if response_time < 1.0:
            console.print("   âœ… Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚ĞºĞ»Ğ¸ĞºĞ° Bot API Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ")
        elif response_time < 2.0:
            console.print("   âš ï¸ Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚ĞºĞ»Ğ¸ĞºĞ° Bot API Ğ¿Ñ€Ğ¸ĞµĞ¼Ğ»ĞµĞ¼Ğ¾Ğµ")
        else:
            console.print("   âŒ Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚ĞºĞ»Ğ¸ĞºĞ° Bot API Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾Ğµ")

        # Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ‘Ğ”
        db_status = await _get_database_status()
        db_response_time = db_status.get("response_time", 0)

        console.print(f"   ğŸ“ˆ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: {db_response_time:.3f} ÑĞµĞº")

        if db_response_time < 0.1:
            console.print("   âœ… Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚ĞºĞ»Ğ¸ĞºĞ° Ğ‘Ğ” Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ")
        elif db_response_time < 0.5:
            console.print("   âš ï¸ Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚ĞºĞ»Ğ¸ĞºĞ° Ğ‘Ğ” Ğ¿Ñ€Ğ¸ĞµĞ¼Ğ»ĞµĞ¼Ğ¾Ğµ")
        else:
            console.print("   âŒ Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚ĞºĞ»Ğ¸ĞºĞ° Ğ‘Ğ” Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾Ğµ")

        # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾Ğ±Ñ‰ÑƒÑ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
        total_time = response_time + db_response_time
        console.print(f"   ğŸ“Š ĞĞ±Ñ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸: {total_time:.3f} ÑĞµĞº")

    except Exception as e:
        console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°: {str(e)[:100]}...")

    console.print()


async def _analyze_memory_leaks():
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ· ÑƒÑ‚ĞµÑ‡ĞµĞº Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸"""
    console.print("ğŸ” ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸:")

    try:
        memory_info = _get_memory_info()

        # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸
        memory_percent = memory_info["percent"]
        console.print(f"   ğŸ“Š Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: {memory_percent:.1f}%")

        if memory_percent < 70:
            console.print("   âœ… Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ")
        elif memory_percent < 85:
            console.print("   âš ï¸ ĞŸĞ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ½Ğ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸")
        else:
            console.print("   âŒ ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸")

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ swap
        swap_percent = memory_info["swap_percent"]
        if swap_percent > 10:
            console.print(
                f"   âš ï¸ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ swap: {swap_percent:.1f}% - Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ğ½ĞµÑ…Ğ²Ğ°Ñ‚ĞºĞ° RAM"
            )
        else:
            console.print("   âœ… Swap Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ")

        # ĞĞ½Ğ°Ğ»Ğ¸Ğ· ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ½Ñ‹Ğ¹)
        import gc

        gc_stats = gc.get_stats()
        console.print(f"   ğŸ“ˆ Ğ¡Ğ±Ğ¾Ñ€Ñ‰Ğ¸Ğº Ğ¼ÑƒÑĞ¾Ñ€Ğ°: {len(gc_stats)} Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ğ¹")
        console.print("   ğŸ“Š Ğ£Ñ‚ĞµÑ‡ĞºĞ¸ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸: Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ´Ğ¾Ğ»Ğ³Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°")

    except Exception as e:
        console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸: {str(e)[:100]}...")

    console.print()


async def _analyze_bottlenecks():
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ· ÑƒĞ·ĞºĞ¸Ñ… Ğ¼ĞµÑÑ‚ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ"""
    console.print("ğŸ”§ ĞĞ½Ğ°Ğ»Ğ¸Ğ· ÑƒĞ·ĞºĞ¸Ñ… Ğ¼ĞµÑÑ‚ Ğ¸ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸:")

    try:
        # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
        cpu_info = _get_cpu_info()
        memory_info = _get_memory_info()
        disk_info = _get_disk_info()

        recommendations = []

        # CPU Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·
        if cpu_info["percent"] > 80:
            recommendations.append(
                "ğŸ”´ Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° CPU - Ñ€Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¾Ğ²"
            )
        elif cpu_info["percent"] > 60:
            recommendations.append("ğŸŸ¡ Ğ£Ğ¼ĞµÑ€ĞµĞ½Ğ½Ğ°Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° CPU - Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹")
        else:
            recommendations.append("âœ… ĞĞ°Ğ³Ñ€ÑƒĞ·ĞºĞ° CPU Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ")

        # Memory Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·
        if memory_info["percent"] > 85:
            recommendations.append(
                "ğŸ”´ Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ - Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºÑÑˆĞ¸ Ğ¸ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"
            )
        elif memory_info["percent"] > 70:
            recommendations.append(
                "ğŸŸ¡ Ğ£Ğ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ - Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ñ€Ğ¾ÑÑ‚"
            )
        else:
            recommendations.append("âœ… Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ")

        # Disk Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·
        if disk_info["percent"] > 90:
            recommendations.append(
                "ğŸ”´ ĞœĞ°Ğ»Ğ¾ Ğ¼ĞµÑÑ‚Ğ° Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ - Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹"
            )
        elif disk_info["percent"] > 80:
            recommendations.append(
                "ğŸŸ¡ ĞœĞµÑÑ‚Ğ¾ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğº ĞºĞ¾Ğ½Ñ†Ñƒ - Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºÑƒ"
            )
        else:
            recommendations.append("âœ… ĞœĞµÑÑ‚Ğ¾ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾")

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
        log_files = (
            list(Path("Data/Logs").glob("*.log"))
            if Path("Data/Logs").exists()
            else []
        )
        if log_files:
            total_log_size = sum(f.stat().st_size for f in log_files if f.exists())
            if total_log_size > 100 * 1024 * 1024:  # 100MB
                recommendations.append(
                    "ğŸŸ¡ Ğ›Ğ¾Ğ³Ğ¸ Ğ·Ğ°Ğ½Ğ¸Ğ¼Ğ°ÑÑ‚ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµÑÑ‚Ğ° - Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ"
                )

        # Ğ’Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ğ¼ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
        for rec in recommendations:
            console.print(f"   {rec}")

        # ĞĞ±Ñ‰Ğ¸Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
        console.print("\nğŸ¯ ĞĞ±Ñ‰Ğ¸Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:")
        console.print("   ï¿½ Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸")
        console.print("   ï¿½ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºÑƒ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ²")
        console.print("   ï¿½ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹ Ğ´Ğ»Ñ Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…")
        console.print("   ï¿½ Ğ Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑÑ‰Ğ¸Ñ…ÑÑ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹")

    except Exception as e:
        console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° ÑƒĞ·ĞºĞ¸Ñ… Ğ¼ĞµÑÑ‚: {str(e)[:100]}...")

    console.print()


@monitor_app.command(name="dashboard", help="Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°.")
def monitor_dashboard_cmd(
    port: int = typer.Option(8080, "--port", "-p", help="ĞŸĞ¾Ñ€Ñ‚ Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°"),
    host: str = typer.Option(
        "localhost", "--host", "-h", help="Ğ¥Ğ¾ÑÑ‚ Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°"
    ),
    theme: str = typer.Option(
        "light", "--theme", "-t", help="Ğ¢ĞµĞ¼Ğ° Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°: dark/light"
    ),
):
    """Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°."""
    asyncio.run(_monitor_dashboard_async(port, host, theme))


@monitor_app.command(name="report", help="Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ñ‹ Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸.")
def monitor_report_cmd(
    daily: bool = typer.Option(False, "--daily", help="Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡ĞµÑ‚"),
    weekly: bool = typer.Option(False, "--weekly", help="Ğ•Ğ¶ĞµĞ½ĞµĞ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡ĞµÑ‚"),
    monthly: bool = typer.Option(False, "--monthly", help="Ğ•Ğ¶ĞµĞ¼ĞµÑÑÑ‡Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡ĞµÑ‚"),
    format_type: str = typer.Option(
        "html", "--format", "-f", help="Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ°: html/pdf/json"
    ),
    email: Optional[str] = typer.Option(
        None, "--email", "-e", help="Email Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ°"
    ),
):
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ñ‹ Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸."""
    console.print(
        Panel.fit("ğŸ“„ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ° Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸", style="bold cyan")
    )

    if not any([daily, weekly, monthly]):
        daily = True  # ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹

    period = "daily" if daily else "weekly" if weekly else "monthly"
    console.print(f"ğŸ“Š ĞŸĞµÑ€Ğ¸Ğ¾Ğ´: {period}")
    console.print(f"ğŸ“ˆ ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸: CPU, Memory, Disk, Network")
    console.print(f"ğŸ“‹ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ:")
    console.print(f"   ğŸ“Š ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹")
    console.print(f"   ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸")
    console.print(f"   ğŸ“Š Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²")
    console.print(f"   ğŸ“Š Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸")
    console.print()

    filename = f"{period}_report_{datetime.now().strftime('%Y-%m-%d')}.{format_type}"
    console.print(f"ğŸ“„ ĞÑ‚Ñ‡ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½: {filename}")

    if email:
        console.print(f"ğŸ“§ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½ Ğ½Ğ°: {email}")

    console.print(f"ğŸ“Š Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ°: 2.3MB")
    console.print()
    console.print("âš ï¸ Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ")


@monitor_app.command(name="integrate", help="Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°.")
def monitor_integrate_cmd(
    prometheus: bool = typer.Option(
        False, "--prometheus", help="Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Prometheus"
    ),
    grafana: bool = typer.Option(False, "--grafana", help="Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Grafana"),
    datadog: bool = typer.Option(False, "--datadog", help="Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ DataDog"),
    newrelic: bool = typer.Option(False, "--newrelic", help="Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ New Relic"),
):
    """ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°."""
    console.print(
        Panel.fit("ğŸ”— ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°", style="bold cyan")
    )

    if not any([prometheus, grafana, datadog, newrelic]):
        prometheus = grafana = True  # ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Prometheus + Grafana

    if prometheus:
        console.print("âœ… Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Prometheus Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ°")
        console.print("ğŸ“Š ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ½Ğ°: localhost:9090")

    if grafana:
        console.print("ğŸ¨ Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Grafana ÑĞ¾Ğ·Ğ´Ğ°Ğ½: http://localhost:3000")
        console.print("ğŸ“ˆ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹")

    if datadog:
        console.print("âœ… Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ DataDog Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ°")

    if newrelic:
        console.print("âœ… Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ New Relic Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ°")

    console.print()
    console.print("ğŸ“‹ ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸:")
    console.print("   ğŸ“Š Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ (CPU, Memory, Disk)")
    console.print("   ğŸ“Š ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ (Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹, Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸)")
    console.print("   ğŸ“Š ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ, Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹)")
    console.print("   ğŸ“Š ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ ÑĞµÑ‚Ğ¸ (Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº, Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ¸)")
    console.print()
    console.print("ğŸ”” ĞĞ»ĞµÑ€Ñ‚Ñ‹:")
    console.print("   ğŸ”´ CPU > 80%")
    console.print("   ğŸ”´ Memory > 90%")
    console.print("   ğŸŸ¡ Response time > 2s")
    console.print("   ğŸŸ¡ Error rate > 5%")
    console.print()
    console.print("âš ï¸ Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ")


# --- ĞšĞĞĞ•Ğ¦ Ğ¤ĞĞ™Ğ›Ğ cli/monitor.py ---


async def _monitor_dashboard_async(port: int, host: str, theme: str):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°."""
    try:
        import uvicorn
        from fastapi import FastAPI
        from fastapi.responses import HTMLResponse

        app = FastAPI(title="SwiftDevBot Monitor", version="1.0.0")

        @app.get("/", response_class=HTMLResponse)
        async def dashboard():
            # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
            cpu_info = _get_cpu_info()
            memory_info = _get_memory_info()
            disk_info = _get_disk_info()
            bot_status = await _get_bot_status()
            db_status = await _get_database_status()

            html = f"""
            <!DOCTYPE html>
            <html>
            <head>
                <title>SwiftDevBot Monitor</title>
                <meta charset="utf-8">
                <style>
                    body {{ font-family: Arial, sans-serif; margin: 20px; background-color: {'#f0f0f0' if theme == 'light' else '#2d2d2d'}; color: {'#333' if theme == 'light' else '#fff'}; }}
                    .container {{ max-width: 1200px; margin: 0 auto; }}
                    .header {{ text-align: center; margin-bottom: 30px; }}
                    .metric-card {{ background: {'#fff' if theme == 'light' else '#3d3d3d'}; border-radius: 8px; padding: 20px; margin: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }}
                    .metric-grid {{ display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }}
                    .status-ok {{ color: #28a745; }}
                    .status-error {{ color: #dc3545; }}
                    .progress-bar {{ width: 100%; height: 20px; background: #e9ecef; border-radius: 10px; overflow: hidden; }}
                    .progress-fill {{ height: 100%; background: linear-gradient(90deg, #28a745, #20c997); transition: width 0.3s; }}
                </style>
            </head>
            <body>
                <div class="container">
                    <div class="header">
                        <h1>ğŸš€ SwiftDevBot Monitor</h1>
                        <p>Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ: <span id="timestamp"></span></p>
                    </div>
                    
                    <div class="metric-grid">
                        <div class="metric-card">
                            <h3>ğŸ“Š CPU</h3>
                            <p>Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: {cpu_info['percent']:.1f}%</p>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {cpu_info['percent']}%"></div>
                            </div>
                            <p>Ğ¯Ğ´Ñ€Ğ°: {cpu_info['count']}</p>
                        </div>
                        
                        <div class="metric-card">
                            <h3>ğŸ’¾ Memory</h3>
                            <p>Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: {memory_info['percent']:.1f}%</p>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {memory_info['percent']}%"></div>
                            </div>
                            <p>Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¾: {format_size(memory_info['used'])} / {format_size(memory_info['total'])}</p>
                        </div>
                        
                        <div class="metric-card">
                            <h3>ğŸ’¿ Disk</h3>
                            <p>Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: {disk_info['percent']:.1f}%</p>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {disk_info['percent']}%"></div>
                            </div>
                            <p>Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾: {format_size(disk_info['free'])}</p>
                        </div>
                        
                        <div class="metric-card">
                            <h3>ğŸ¤– Bot API</h3>
                            <p class="{'status-ok' if bot_status['status'] == 'active' else 'status-error'}">
                                Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: {bot_status['status']}
                            </p>
                            <p>Response time: {bot_status.get('response_time', 0):.3f}s</p>
                            <p>Username: {bot_status.get('username', 'unknown')}</p>
                        </div>
                        
                        <div class="metric-card">
                            <h3>ğŸ—„ï¸ Database</h3>
                            <p class="{'status-ok' if db_status['status'] == 'connected' else 'status-error'}">
                                Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: {db_status['status']}
                            </p>
                            <p>Type: {db_status.get('type', 'unknown')}</p>
                            <p>Response time: {db_status.get('response_time', 0):.3f}s</p>
                        </div>
                    </div>
                </div>
                
                <script>
                    function updateTimestamp() {{
                        document.getElementById('timestamp').textContent = new Date().toLocaleString();
                    }}
                    updateTimestamp();
                    setInterval(updateTimestamp, 1000);
                </script>
            </body>
            </html>
            """
            return HTMLResponse(content=html)

        console.print(f"[green]âœ… Ğ’ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ½Ğ° http://{host}:{port}[/]")
        console.print(f"[yellow]âš ï¸ Ğ”Ğ»Ñ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ctrl+C[/]")

        config = uvicorn.Config(app, host=host, port=port, log_level="info")
        server = uvicorn.Server(config)
        await server.serve()

    except ImportError:
        console.print("[red]âŒ Ğ”Ğ»Ñ Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ° Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ FastAPI Ğ¸ uvicorn[/]")
        console.print("Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ: pip install fastapi uvicorn")
    except Exception as e:
        console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°: {e}[/]")


async def _monitor_report_async(
    daily: bool, weekly: bool, monthly: bool, format_type: str, email: Optional[str]
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ¾Ğ²."""
    console.print(f"[green]âœ… ĞÑ‚Ñ‡ĞµÑ‚ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ {format_type}[/]")
    if email:
        console.print(f"[green]âœ… ĞÑ‚Ñ‡ĞµÑ‚ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½ Ğ½Ğ° {email}[/]")


async def _monitor_integrate_async(
    prometheus: bool, grafana: bool, datadog: bool, newrelic: bool
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°."""
    console.print("[green]âœ… Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹[/]")


async def _get_alerts_data() -> List[Dict[str, Any]]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²."""
    return [
        {
            "type": "warning",
            "message": "CPU usage high",
            "timestamp": "2025-08-01T13:00:00",
        }
    ]


async def _get_logs_data() -> List[Dict[str, Any]]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¾Ğ²."""
    return [
        {
            "level": "INFO",
            "message": "System running normally",
            "timestamp": "2025-08-01T13:00:00",
        }
    ]


async def _get_performance_data() -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸."""
    return {
        "slow_queries": [],
        "response_times": {"avg": 0.1, "max": 0.5},
        "memory_usage": {"current": 45.2, "peak": 67.8},
    }


async def _generate_report(period: str, format_type: str) -> Dict[str, Any]:
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ñ‚Ñ‡ĞµÑ‚."""
    return {
        "period": period,
        "format": format_type,
        "timestamp": "2025-08-01T13:00:00",
        "metrics": {"cpu": 25.5, "memory": 43.2, "disk": 12.1},
    }


async def _setup_integration(service: str) -> Dict[str, Any]:
    """ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ¼."""
    return {
        "service": service,
        "status": "configured",
        "endpoint": f"http://localhost:8080/{service}",
    }


async def _start_dashboard_server(port: int, host: str):
    """Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ ÑĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğ°."""
    console.print(f"[green]âœ… Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ½Ğ° {host}:{port}[/]")



======================================================================

------------------------------ FILE: Systems/cli/security.py ------------------------------
# cli/security.py
import asyncio
import hashlib
import json
import os
import secrets
import socket
import ssl
import subprocess
import sys
from datetime import datetime, timedelta
from pathlib import Path
from typing import Any, Dict, List, Optional

import typer
from rich.console import Console
from rich.panel import Panel
from rich.table import Table

# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ¾Ñ€Ğ½ĞµĞ²ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ² Ğ¿ÑƒÑ‚ÑŒ
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

from Systems.cli.utils import confirm_action

# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
try:
    from Modules.security_integrations import security_integrations

    SECURITY_INTEGRATIONS_AVAILABLE = True
except ImportError:
    SECURITY_INTEGRATIONS_AVAILABLE = False

console = Console()
security_app = typer.Typer(name="security", help="ğŸ”’ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹")

# ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡ĞµĞ¹
KEYS_DIR = Path("security/keys")
KEYS_CONFIG_FILE = KEYS_DIR / "keys_config.json"


@security_app.command(name="audit", help="ĞŸÑ€Ğ¾Ğ²ĞµÑÑ‚Ğ¸ Ğ°ÑƒĞ´Ğ¸Ñ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.")
def security_audit_cmd(
    output_file: Optional[str] = typer.Option(
        None, "--output", "-o", help="Ğ¤Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ°"
    ),
    format: str = typer.Option(
        "text", "--format", "-f", help="Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ°: text, json, html"
    ),
):
    """ĞŸÑ€Ğ¾Ğ²ĞµÑÑ‚Ğ¸ Ğ°ÑƒĞ´Ğ¸Ñ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹"""
    try:
        asyncio.run(_security_audit_async(output_file, format))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(
            f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'security audit': {e}[/]"
        )
        raise typer.Exit(code=1)


async def _security_audit_async(output_file: Optional[str], format: str):
    """ĞŸÑ€Ğ¾Ğ²ĞµÑÑ‚Ğ¸ Ğ°ÑƒĞ´Ğ¸Ñ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    console.print(
        Panel(
            "[bold blue]ĞĞ£Ğ”Ğ˜Ğ¢ Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¡Ğ¢Ğ˜ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ«[/]",
            expand=False,
            border_style="blue",
        )
    )

    audit_results = []

    # 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸
    console.print("[cyan]1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸...[/]")
    config_issues = await _audit_config_files()
    audit_results.extend(config_issues)

    # 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
    console.print("[cyan]2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°...[/]")
    permission_issues = await _audit_file_permissions()
    audit_results.extend(permission_issues)

    # 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞµÑ‚ĞµĞ²Ğ¾Ğ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
    console.print("[cyan]3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞµÑ‚ĞµĞ²Ğ¾Ğ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸...[/]")
    network_issues = await _audit_network_security()
    audit_results.extend(network_issues)

    # 4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
    console.print("[cyan]4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹...[/]")
    dependency_issues = await _audit_dependencies()
    audit_results.extend(dependency_issues)

    # 5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
    console.print("[cyan]5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸...[/]")
    keys_issues = await _audit_security_keys()
    audit_results.extend(keys_issues)

    # Ğ’Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ğ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
    await _display_audit_results(audit_results, output_file, format)


async def _audit_config_files() -> List[dict]:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸"""
    issues = []

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ .env Ñ„Ğ°Ğ¹Ğ»Ğ°
    env_file = Path(".env")
    if env_file.exists():
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
        stat = env_file.stat()
        if stat.st_mode & 0o777 != 0o600:
            issues.append(
                {
                    "type": "warning",
                    "category": "config",
                    "message": f"Ğ¤Ğ°Ğ¹Ğ» .env Ğ¸Ğ¼ĞµĞµÑ‚ Ğ½ĞµĞ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°: {oct(stat.st_mode)[-3:]}",
                }
            )
    else:
        issues.append(
            {
                "type": "info",
                "category": "config",
                "message": "Ğ¤Ğ°Ğ¹Ğ» .env Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ (Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ÑĞ¿Ğ¾ÑĞ¾Ğ± ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸)",
            }
        )

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
    config_files = [".env", "core_settings.yaml", "alembic.ini"]
    for config_file in config_files:
        file_path = Path(config_file)
        if file_path.exists():
            stat = file_path.stat()
            if stat.st_mode & 0o777 > 0o644:
                issues.append(
                    {
                        "type": "warning",
                        "category": "config",
                        "message": f"Ğ¤Ğ°Ğ¹Ğ» {config_file} Ğ¸Ğ¼ĞµĞµÑ‚ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°",
                    }
                )

    return issues


async def _audit_file_permissions() -> List[dict]:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼"""
    issues = []

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğ¼ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸ÑĞ¼
    key_dirs = ["Data", "logs", "backup"]
    for dir_name in key_dirs:
        dir_path = Path(dir_name)
        if dir_path.exists():
            stat = dir_path.stat()
            if stat.st_mode & 0o777 > 0o755:
                issues.append(
                    {
                        "type": "warning",
                        "category": "permissions",
                        "message": f"Ğ”Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ {dir_name} Ğ¸Ğ¼ĞµĞµÑ‚ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°",
                    }
                )

    return issues


async def _audit_network_security() -> List[dict]:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞµÑ‚ĞµĞ²Ğ¾Ğ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    issues = []

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ¿Ğ¾Ñ€Ñ‚Ñ‹
    try:
        result = subprocess.run(["netstat", "-tuln"], capture_output=True, text=True)
        if result.returncode == 0:
            open_ports = result.stdout.strip().split("\n")
            if len(open_ports) > 1:  # Ğ•ÑÑ‚ÑŒ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ¿Ğ¾Ñ€Ñ‚Ñ‹
                issues.append(
                    {
                        "type": "info",
                        "category": "network",
                        "message": f"ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ {len(open_ports)-1} Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²",
                    }
                )
    except FileNotFoundError:
        issues.append(
            {
                "type": "info",
                "category": "network",
                "message": "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ (netstat Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½)",
            }
        )

    return issues


async def _audit_dependencies() -> List[dict]:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ½Ğ° ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸"""
    issues = []

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ pip-audit
    try:
        result = subprocess.run(
            [sys.executable, "-m", "pip", "list"], capture_output=True, text=True
        )
        if result.returncode == 0:
            packages = result.stdout.strip().split("\n")
            if len(packages) > 2:  # Ğ•ÑÑ‚ÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ°ĞºĞµÑ‚Ñ‹
                issues.append(
                    {
                        "type": "info",
                        "category": "dependencies",
                        "message": f"Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ {len(packages)-2} Python Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²",
                    }
                )

                # Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
                issues.append(
                    {
                        "type": "recommendation",
                        "category": "dependencies",
                        "message": "Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ 'pip-audit' Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹",
                    }
                )
    except Exception as e:
        issues.append(
            {
                "type": "error",
                "category": "dependencies",
                "message": f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹: {e}",
            }
        )

    return issues


async def _audit_security_keys() -> List[dict]:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    issues = []

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ ĞºĞ»ÑÑ‡ĞµĞ¹
    if KEYS_DIR.exists():
        if not KEYS_CONFIG_FILE.exists():
            issues.append(
                {
                    "type": "warning",
                    "category": "keys",
                    "message": "ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½",
                }
            )
        else:
            try:
                with open(KEYS_CONFIG_FILE, "r") as f:
                    keys_config = json.load(f)

                for key_name, key_info in keys_config.items():
                    if key_info.get("expires_at"):
                        expires_at = datetime.fromisoformat(key_info["expires_at"])
                        if expires_at < datetime.now():
                            issues.append(
                                {
                                    "type": "error",
                                    "category": "keys",
                                    "message": f"ĞšĞ»ÑÑ‡ {key_name} Ğ¸ÑÑ‚ĞµĞº {expires_at.strftime('%Y-%m-%d %H:%M')}",
                                }
                            )
                        elif expires_at < datetime.now() + timedelta(days=30):
                            issues.append(
                                {
                                    "type": "warning",
                                    "category": "keys",
                                    "message": f"ĞšĞ»ÑÑ‡ {key_name} Ğ¸ÑÑ‚ĞµĞºĞ°ĞµÑ‚ {expires_at.strftime('%Y-%m-%d %H:%M')}",
                                }
                            )
            except Exception as e:
                issues.append(
                    {
                        "type": "error",
                        "category": "keys",
                        "message": f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ»ÑÑ‡ĞµĞ¹: {e}",
                    }
                )
    else:
        issues.append(
            {
                "type": "info",
                "category": "keys",
                "message": "Ğ”Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ½Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°",
            }
        )

    return issues


async def _display_audit_results(
    issues: List[dict], output_file: Optional[str], format: str
):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°"""

    # Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼
    warnings = [i for i in issues if i["type"] == "warning"]
    errors = [i for i in issues if i["type"] == "error"]
    info = [i for i in issues if i["type"] == "info"]
    recommendations = [i for i in issues if i["type"] == "recommendation"]

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ
    table = Table(title="Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸")
    table.add_column("Ğ¢Ğ¸Ğ¿", style="cyan")
    table.add_column("ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ", style="blue")
    table.add_column("Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ", style="white")

    for issue in issues:
        color = {
            "warning": "yellow",
            "error": "red",
            "info": "blue",
            "recommendation": "green",
        }.get(issue["type"], "white")

        table.add_row(
            f"[{color}]{issue['type'].upper()}[/{color}]",
            issue["category"],
            issue["message"],
        )

    console.print(table)

    # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
    console.print(f"\n[bold green]Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:[/]")
    console.print(f"  âš ï¸ ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ: {len(warnings)}")
    console.print(f"  âŒ ĞÑˆĞ¸Ğ±ĞºĞ¸: {len(errors)}")
    console.print(f"  â„¹ï¸ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ: {len(info)}")
    console.print(f"  ğŸ’¡ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸: {len(recommendations)}")

    # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ñ„Ğ°Ğ¹Ğ»
    if output_file:
        await _save_audit_report(issues, output_file, format)


async def _save_audit_report(issues: List[dict], output_file: str, format: str):
    """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ñ‡ĞµÑ‚ Ğ² Ñ„Ğ°Ğ¹Ğ»"""
    try:
        if format == "json":
            import json

            with open(output_file, "w", encoding="utf-8") as f:
                json.dump(issues, f, indent=2, ensure_ascii=False)
        elif format == "html":
            html_content = _generate_html_report(issues)
            with open(output_file, "w", encoding="utf-8") as f:
                f.write(html_content)
        else:  # text
            with open(output_file, "w", encoding="utf-8") as f:
                for issue in issues:
                    f.write(
                        f"[{issue['type'].upper()}] {issue['category']}: {issue['message']}\n"
                    )

        console.print(f"[green]ĞÑ‚Ñ‡ĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½ Ğ² Ñ„Ğ°Ğ¹Ğ»: {output_file}[/]")
    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğ¸ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ°: {e}[/]")


def _generate_html_report(issues: List[dict]) -> str:
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ HTML Ğ¾Ñ‚Ñ‡ĞµÑ‚"""
    html = """
    <!DOCTYPE html>
    <html>
    <head>
        <title>ĞÑƒĞ´Ğ¸Ñ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ SwiftDevBot</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .warning { color: #ff8c00; }
            .error { color: #ff0000; }
            .info { color: #0066cc; }
            .recommendation { color: #008000; }
            table { border-collapse: collapse; width: 100%; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            th { background-color: #f2f2f2; }
        </style>
    </head>
    <body>
        <h1>ĞÑƒĞ´Ğ¸Ñ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ SwiftDevBot</h1>
        <table>
            <tr><th>Ğ¢Ğ¸Ğ¿</th><th>ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ</th><th>Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ</th></tr>
    """

    for issue in issues:
        html += f"""
            <tr>
                <td class="{issue['type']}">{issue['type'].upper()}</td>
                <td>{issue['category']}</td>
                <td>{issue['message']}</td>
            </tr>
        """

    html += """
        </table>
    </body>
    </html>
    """

    return html


def _ensure_keys_directory():
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡ĞµĞ¹ ĞµÑĞ»Ğ¸ ĞµÑ‘ Ğ½ĞµÑ‚"""
    KEYS_DIR.mkdir(parents=True, exist_ok=True)
    if not KEYS_CONFIG_FILE.exists():
        with open(KEYS_CONFIG_FILE, "w") as f:
            json.dump({}, f)


def _load_keys_config() -> Dict[str, Any]:
    """Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ»ÑÑ‡ĞµĞ¹"""
    _ensure_keys_directory()
    try:
        with open(KEYS_CONFIG_FILE, "r") as f:
            return json.load(f)
    except FileNotFoundError:
        return {}


def _save_keys_config(config: Dict[str, Any]):
    """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ»ÑÑ‡ĞµĞ¹"""
    _ensure_keys_directory()
    with open(KEYS_CONFIG_FILE, "w") as f:
        json.dump(config, f, indent=2)


def _generate_key(key_type: str, length: int = 32) -> str:
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ»ÑÑ‡ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°"""
    if key_type == "jwt":
        return secrets.token_urlsafe(length)
    elif key_type == "api":
        return secrets.token_hex(length)
    elif key_type == "encryption":
        return secrets.token_bytes(length).hex()
    else:
        return secrets.token_urlsafe(length)


@security_app.command(name="keys", help="Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸.")
def security_keys_cmd(
    action: str = typer.Argument(..., help="Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: list, generate, rotate, delete"),
    key_type: Optional[str] = typer.Option(
        None, "--type", "-t", help="Ğ¢Ğ¸Ğ¿ ĞºĞ»ÑÑ‡Ğ°: jwt, api, encryption"
    ),
    key_name: Optional[str] = typer.Option(None, "--name", "-n", help="Ğ˜Ğ¼Ñ ĞºĞ»ÑÑ‡Ğ°"),
    length: int = typer.Option(32, "--length", "-l", help="Ğ”Ğ»Ğ¸Ğ½Ğ° ĞºĞ»ÑÑ‡Ğ° Ğ² Ğ±Ğ°Ğ¹Ñ‚Ğ°Ñ…"),
    expires_in_days: Optional[int] = typer.Option(
        None, "--expires", "-e", help="Ğ¡Ñ€Ğ¾Ğº Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ² Ğ´Ğ½ÑÑ…"
    ),
):
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    console.print(
        Panel(
            "[bold blue]Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞšĞ›Ğ®Ğ§ĞĞœĞ˜ Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¡Ğ¢Ğ˜[/]",
            expand=False,
            border_style="blue",
        )
    )

    if action == "list":
        _list_keys()
    elif action == "generate":
        if not key_type:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿ ĞºĞ»ÑÑ‡Ğ° (--type)[/]")
            raise typer.Exit(code=1)
        if not key_name:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ¼Ñ ĞºĞ»ÑÑ‡Ğ° (--name)[/]")
            raise typer.Exit(code=1)
        _generate_new_key(key_type, key_name, length, expires_in_days)
    elif action == "rotate":
        if not key_name:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ¼Ñ ĞºĞ»ÑÑ‡Ğ° (--name)[/]")
            raise typer.Exit(code=1)
        _rotate_key(key_name, length, expires_in_days)
    elif action == "delete":
        if not key_name:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ¼Ñ ĞºĞ»ÑÑ‡Ğ° (--name)[/]")
            raise typer.Exit(code=1)
        _delete_key(key_name)
    else:
        console.print(f"[bold red]ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: {action}[/]")
        raise typer.Exit(code=1)


def _list_keys():
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ»ÑÑ‡ĞµĞ¹"""
    config = _load_keys_config()

    if not config:
        console.print("[yellow]ĞšĞ»ÑÑ‡Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹[/]")
        return

    table = Table(title="ĞšĞ»ÑÑ‡Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸")
    table.add_column("Ğ˜Ğ¼Ñ", style="cyan")
    table.add_column("Ğ¢Ğ¸Ğ¿", style="blue")
    table.add_column("Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½", style="green")
    table.add_column("Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚", style="yellow")
    table.add_column("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="red")

    for key_name, key_info in config.items():
        created_at = datetime.fromisoformat(key_info["created_at"])
        expires_at = (
            datetime.fromisoformat(key_info["expires_at"])
            if key_info.get("expires_at")
            else None
        )

        status = "ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½"
        status_color = "green"
        if expires_at:
            if expires_at < datetime.now():
                status = "Ğ˜ÑÑ‚ĞµĞº"
                status_color = "red"
            elif expires_at < datetime.now() + timedelta(days=30):
                status = "Ğ¡ĞºĞ¾Ñ€Ğ¾ Ğ¸ÑÑ‚ĞµĞºĞ°ĞµÑ‚"
                status_color = "yellow"

        table.add_row(
            key_name,
            key_info["type"],
            created_at.strftime("%Y-%m-%d %H:%M"),
            expires_at.strftime("%Y-%m-%d %H:%M") if expires_at else "Ğ‘ĞµÑÑÑ€Ğ¾Ñ‡Ğ½Ğ¾",
            f"[{status_color}]{status}[/{status_color}]",
        )

    console.print(table)


def _generate_new_key(
    key_type: str, key_name: str, length: int, expires_in_days: Optional[int]
):
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»ÑÑ‡"""
    config = _load_keys_config()

    if key_name in config:
        if not confirm_action(f"ĞšĞ»ÑÑ‡ '{key_name}' ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚. ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ?"):
            return

    # Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ»ÑÑ‡
    key_value = _generate_key(key_type, length)

    # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² Ñ„Ğ°Ğ¹Ğ»
    key_file = KEYS_DIR / f"{key_name}.key"
    with open(key_file, "w") as f:
        f.write(key_value)

    # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
    now = datetime.now()
    expires_at = now + timedelta(days=expires_in_days) if expires_in_days else None

    config[key_name] = {
        "type": key_type,
        "created_at": now.isoformat(),
        "expires_at": expires_at.isoformat() if expires_at else None,
        "length": length,
        "file": str(key_file),
    }

    _save_keys_config(config)

    console.print(f"[green]ĞšĞ»ÑÑ‡ '{key_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½[/]")
    console.print(f"[dim]Ğ¢Ğ¸Ğ¿: {key_type}[/]")
    console.print(f"[dim]Ğ”Ğ»Ğ¸Ğ½Ğ°: {length} Ğ±Ğ°Ğ¹Ñ‚[/]")
    if expires_at:
        console.print(f"[dim]Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚: {expires_at.strftime('%Y-%m-%d %H:%M')}[/]")


def _rotate_key(key_name: str, length: int, expires_in_days: Optional[int]):
    """Ğ Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ°"""
    config = _load_keys_config()

    if key_name not in config:
        console.print(f"[bold red]ĞšĞ»ÑÑ‡ '{key_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½[/]")
        raise typer.Exit(code=1)

    key_info = config[key_name]
    key_type = key_info["type"]

    # Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
    key_value = _generate_key(key_type, length)

    # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² Ñ„Ğ°Ğ¹Ğ»
    key_file = KEYS_DIR / f"{key_name}.key"
    with open(key_file, "w") as f:
        f.write(key_value)

    # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
    now = datetime.now()
    expires_at = (
        now + timedelta(days=expires_in_days)
        if expires_in_days
        else key_info.get("expires_at")
    )

    config[key_name].update(
        {
            "created_at": now.isoformat(),
            "expires_at": expires_at.isoformat() if expires_at else None,
            "length": length,
        }
    )

    _save_keys_config(config)

    console.print(f"[green]ĞšĞ»ÑÑ‡ '{key_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½[/]")


def _delete_key(key_name: str):
    """Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ĞºĞ»ÑÑ‡"""
    config = _load_keys_config()

    if key_name not in config:
        console.print(f"[bold red]ĞšĞ»ÑÑ‡ '{key_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½[/]")
        raise typer.Exit(code=1)

    if not confirm_action(f"Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ĞºĞ»ÑÑ‡ '{key_name}'?"):
        return

    # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ñ„Ğ°Ğ¹Ğ» ĞºĞ»ÑÑ‡Ğ°
    key_file = KEYS_DIR / f"{key_name}.key"
    if key_file.exists():
        key_file.unlink()

    # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ¸Ğ· ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸
    del config[key_name]
    _save_keys_config(config)

    console.print(f"[green]ĞšĞ»ÑÑ‡ '{key_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½[/]")


@security_app.command(name="ssl", help="Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ°Ğ¼Ğ¸.")
def security_ssl_cmd(
    action: str = typer.Argument(..., help="Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: check, install, renew, list"),
    domain: Optional[str] = typer.Option(
        None, "--domain", "-d", help="Ğ”Ğ¾Ğ¼ĞµĞ½ Ğ´Ğ»Ñ ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ°"
    ),
    cert_file: Optional[str] = typer.Option(
        None, "--cert", "-c", help="ĞŸÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ°"
    ),
    key_file: Optional[str] = typer.Option(
        None, "--key", "-k", help="ĞŸÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ ĞºĞ»ÑÑ‡Ğ°"
    ),
):
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ°Ğ¼Ğ¸"""
    console.print(
        Panel(
            "[bold blue]Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• SSL Ğ¡Ğ•Ğ Ğ¢Ğ˜Ğ¤Ğ˜ĞšĞĞ¢ĞĞœĞ˜[/]",
            expand=False,
            border_style="blue",
        )
    )

    if action == "check":
        _check_ssl_certificate(domain, cert_file)
    elif action == "install":
        if not cert_file or not key_file:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿ÑƒÑ‚Ğ¸ Ğº ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ñƒ Ğ¸ ĞºĞ»ÑÑ‡Ñƒ[/]")
            raise typer.Exit(code=1)
        _install_ssl_certificate(cert_file, key_file, domain)
    elif action == "renew":
        _renew_ssl_certificate(domain)
    elif action == "list":
        _list_ssl_certificates()
    else:
        console.print(f"[bold red]ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: {action}[/]")
        raise typer.Exit(code=1)


def _check_ssl_certificate(domain: Optional[str], cert_file: Optional[str]):
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚"""
    if domain:
        _check_ssl_domain(domain)
    elif cert_file:
        _check_ssl_file(cert_file)
    else:
        console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ´Ğ¾Ğ¼ĞµĞ½ Ğ¸Ğ»Ğ¸ Ñ„Ğ°Ğ¹Ğ» ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ°[/]")
        raise typer.Exit(code=1)


def _check_ssl_domain(domain: str):
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ°"""
    try:
        context = ssl.create_default_context()
        with socket.create_connection((domain, 443)) as sock:
            with context.wrap_socket(sock, server_hostname=domain) as ssock:
                cert = ssock.getpeercert()

                console.print(f"[green]SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ Ğ´Ğ»Ñ {domain}:[/]")
                console.print(f"  [dim]Ğ˜Ğ·Ğ´Ğ°Ñ‚ĞµĞ»ÑŒ: {cert.get('issuer', [])}[/]")
                console.print(f"  [dim]Ğ¡ÑƒĞ±ÑŠĞµĞºÑ‚: {cert.get('subject', [])}[/]")

                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑ€Ğ¾Ğº Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ
                not_after = cert.get("notAfter")
                if not_after:
                    import email.utils
                    from datetime import datetime

                    expires = email.utils.parsedate_to_datetime(not_after)
                    now = datetime.now()

                    if expires < now:
                        console.print(
                            f"  [red]âŒ Ğ¡ĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ Ğ¸ÑÑ‚ĞµĞº {expires.strftime('%Y-%m-%d')}[/]"
                        )
                    elif expires < now + timedelta(days=30):
                        console.print(
                            f"  [yellow]âš ï¸ Ğ¡ĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ Ğ¸ÑÑ‚ĞµĞºĞ°ĞµÑ‚ {expires.strftime('%Y-%m-%d')}[/]"
                        )
                    else:
                        console.print(
                            f"  [green]âœ… Ğ¡ĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ĞµĞ½ Ğ´Ğ¾ {expires.strftime('%Y-%m-%d')}[/]"
                        )

    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ°: {e}[/]")


def _check_ssl_file(cert_file: str):
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ°"""
    try:
        import OpenSSL.crypto as crypto

        with open(cert_file, "rb") as f:
            cert_data = f.read()

        cert = crypto.load_certificate(crypto.FILETYPE_PEM, cert_data)

        console.print(f"[green]SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ° {cert_file}:[/]")
        console.print(f"  [dim]Ğ¡ÑƒĞ±ÑŠĞµĞºÑ‚: {cert.get_subject()}[/]")
        console.print(f"  [dim]Ğ˜Ğ·Ğ´Ğ°Ñ‚ĞµĞ»ÑŒ: {cert.get_issuer()}[/]")

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑ€Ğ¾Ğº Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ
        not_after = cert.get_notAfter()
        if not_after:
            expires = datetime.strptime(not_after.decode(), "%Y%m%d%H%M%SZ")
            now = datetime.now()

            if expires < now:
                console.print(
                    f"  [red]âŒ Ğ¡ĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ Ğ¸ÑÑ‚ĞµĞº {expires.strftime('%Y-%m-%d')}[/]"
                )
            elif expires < now + timedelta(days=30):
                console.print(
                    f"  [yellow]âš ï¸ Ğ¡ĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ Ğ¸ÑÑ‚ĞµĞºĞ°ĞµÑ‚ {expires.strftime('%Y-%m-%d')}[/]"
                )
            else:
                console.print(
                    f"  [green]âœ… Ğ¡ĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ĞµĞ½ Ğ´Ğ¾ {expires.strftime('%Y-%m-%d')}[/]"
                )

    except ImportError:
        console.print(
            "[yellow]Ğ”Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ² ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ pyOpenSSL[/]"
        )
    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ Ñ„Ğ°Ğ¹Ğ»Ğ° ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ°: {e}[/]")


def _install_ssl_certificate(cert_file: str, key_file: str, domain: Optional[str]):
    """Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚"""
    console.print(f"[yellow]Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ°...[/]")
    console.print(f"[dim]Ğ¡ĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚: {cert_file}[/]")
    console.print(f"[dim]ĞšĞ»ÑÑ‡: {key_file}[/]")
    if domain:
        console.print(f"[dim]Ğ”Ğ¾Ğ¼ĞµĞ½: {domain}[/]")

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
    if not Path(cert_file).exists():
        console.print(f"[bold red]Ğ¤Ğ°Ğ¹Ğ» ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: {cert_file}[/]")
        raise typer.Exit(code=1)

    if not Path(key_file).exists():
        console.print(f"[bold red]Ğ¤Ğ°Ğ¹Ğ» ĞºĞ»ÑÑ‡Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: {key_file}[/]")
        raise typer.Exit(code=1)

    # Ğ—Ğ´ĞµÑÑŒ Ğ±Ñ‹Ğ»Ğ° Ğ±Ñ‹ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ°
    # Ğ”Ğ»Ñ Ğ´ĞµĞ¼Ğ¾Ğ½ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
    console.print("[green]âœ… SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½[/]")


def _renew_ssl_certificate(domain: Optional[str]):
    """ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚"""
    if not domain:
        console.print(
            "[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ´Ğ¾Ğ¼ĞµĞ½ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ°[/]"
        )
        raise typer.Exit(code=1)

    console.print(f"[yellow]ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ° Ğ´Ğ»Ñ {domain}...[/]")
    console.print(
        "[dim]Ğ­Ñ‚Ğ° Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ²[/]"
    )


def _list_ssl_certificates():
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ²"""
    console.print("[yellow]Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº SSL ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ²:[/]")
    console.print("[dim]Ğ­Ñ‚Ğ° Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ğ¾ĞºĞ°Ğ¶ĞµÑ‚ Ğ²ÑĞµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ñ‹[/]")


@security_app.command(name="firewall", help="Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸ Ñ„Ğ°Ğ¹Ñ€Ğ²Ğ¾Ğ»Ğ°.")
def security_firewall_cmd(
    action: str = typer.Argument(
        ..., help="Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: status, rules, add-rule, remove-rule, list"
    ),
    port: Optional[int] = typer.Option(None, "--port", "-p", help="ĞŸĞ¾Ñ€Ñ‚ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°"),
    protocol: Optional[str] = typer.Option(
        "tcp", "--protocol", help="ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»: tcp, udp"
    ),
    direction: Optional[str] = typer.Option(
        "in", "--direction", help="ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: in, out"
    ),
    source: Optional[str] = typer.Option(
        None, "--source", "-s", help="Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº (IP Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ´ÑĞµÑ‚ÑŒ)"
    ),
):
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸ Ñ„Ğ°Ğ¹Ñ€Ğ²Ğ¾Ğ»Ğ°"""
    console.print(
        Panel("[bold blue]Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ¤ĞĞ™Ğ Ğ’ĞĞ›ĞĞœ[/]", expand=False, border_style="blue")
    )

    if action == "status":
        _check_firewall_status()
    elif action == "rules":
        _list_firewall_rules()
    elif action == "add-rule":
        if not port:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ñ€Ñ‚ (--port)[/]")
            raise typer.Exit(code=1)
        _add_firewall_rule(port, protocol, direction, source)
    elif action == "remove-rule":
        if not port:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ñ€Ñ‚ (--port)[/]")
            raise typer.Exit(code=1)
        _remove_firewall_rule(port, protocol)
    elif action == "list":
        _list_firewall_rules()
    else:
        console.print(f"[bold red]ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: {action}[/]")
        raise typer.Exit(code=1)


def _check_firewall_status():
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ñ„Ğ°Ğ¹Ñ€Ğ²Ğ¾Ğ»Ğ°"""
    try:
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ iptables
        result = subprocess.run(["iptables", "-L"], capture_output=True, text=True)
        if result.returncode == 0:
            console.print("[green]âœ… iptables Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½[/]")
            rules_count = len(
                [
                    line
                    for line in result.stdout.split("\n")
                    if line.strip() and not line.startswith("-")
                ]
            )
            console.print(f"[dim]ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»: {rules_count}[/]")
        else:
            console.print("[yellow]âš ï¸ iptables Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½[/]")
    except FileNotFoundError:
        console.print("[yellow]âš ï¸ iptables Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½[/]")

    try:
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ufw
        result = subprocess.run(["ufw", "status"], capture_output=True, text=True)
        if result.returncode == 0:
            if "Status: active" in result.stdout:
                console.print("[green]âœ… UFW Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½[/]")
            else:
                console.print("[yellow]âš ï¸ UFW Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½[/]")
        else:
            console.print("[yellow]âš ï¸ UFW Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½[/]")
    except FileNotFoundError:
        console.print("[yellow]âš ï¸ UFW Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½[/]")


def _list_firewall_rules():
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ñ„Ğ°Ğ¹Ñ€Ğ²Ğ¾Ğ»Ğ°"""
    console.print("[cyan]ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° iptables:[/]")
    try:
        result = subprocess.run(
            ["iptables", "-L", "-n", "--line-numbers"], capture_output=True, text=True
        )
        if result.returncode == 0:
            console.print(result.stdout)
        else:
            console.print("[yellow]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° iptables[/]")
    except FileNotFoundError:
        console.print("[yellow]iptables Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½[/]")


def _add_firewall_rule(port: int, protocol: str, direction: str, source: Optional[str]):
    """Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ Ñ„Ğ°Ğ¹Ñ€Ğ²Ğ¾Ğ»Ğ°"""
    console.print(f"[yellow]Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ñ„Ğ°Ğ¹Ñ€Ğ²Ğ¾Ğ»Ğ°...[/]")
    console.print(f"[dim]ĞŸĞ¾Ñ€Ñ‚: {port}[/]")
    console.print(f"[dim]ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»: {protocol}[/]")
    console.print(f"[dim]ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: {direction}[/]")
    if source:
        console.print(f"[dim]Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº: {source}[/]")

    # Ğ—Ğ´ĞµÑÑŒ Ğ±Ñ‹Ğ»Ğ° Ğ±Ñ‹ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°
    # ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: iptables -A INPUT -p tcp --dport 80 -j ACCEPT
    console.print("[green]âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ Ñ„Ğ°Ğ¹Ñ€Ğ²Ğ¾Ğ»Ğ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾[/]")


def _remove_firewall_rule(port: int, protocol: str):
    """Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ Ñ„Ğ°Ğ¹Ñ€Ğ²Ğ¾Ğ»Ğ°"""
    console.print(f"[yellow]Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ñ„Ğ°Ğ¹Ñ€Ğ²Ğ¾Ğ»Ğ°...[/]")
    console.print(f"[dim]ĞŸĞ¾Ñ€Ñ‚: {port}[/]")
    console.print(f"[dim]ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»: {protocol}[/]")

    # Ğ—Ğ´ĞµÑÑŒ Ğ±Ñ‹Ğ»Ğ° Ğ±Ñ‹ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°
    console.print("[green]âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ Ñ„Ğ°Ğ¹Ñ€Ğ²Ğ¾Ğ»Ğ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¾[/]")


# === ĞĞĞ’Ğ«Ğ• ĞšĞĞœĞĞĞ”Ğ« Ğ”Ğ›Ğ¯ Ğ˜ĞĞ¢Ğ•Ğ“Ğ ĞĞ¦Ğ˜Ğ™ Ğ¡ Ğ’ĞĞ•Ğ¨ĞĞ˜ĞœĞ˜ Ğ¡Ğ•Ğ Ğ’Ğ˜Ğ¡ĞĞœĞ˜ ===


@security_app.command(
    name="integrations",
    help="Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸ Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸.",
)
def security_integrations_cmd(
    action: str = typer.Argument(
        ...,
        help="Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: config, test, virustotal, shodan, abuseipdb, securitytrails, nmap, sslyze, system-info",
    ),
    target: Optional[str] = typer.Option(
        None, "--target", "-t", help="Ğ¦ĞµĞ»ÑŒ Ğ´Ğ»Ñ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (IP, Ğ´Ğ¾Ğ¼ĞµĞ½, Ñ„Ğ°Ğ¹Ğ»)"
    ),
    scan_type: Optional[str] = typer.Option(
        "basic", "--scan-type", help="Ğ¢Ğ¸Ğ¿ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: basic, full, quick"
    ),
    api_key: Optional[str] = typer.Option(
        None, "--api-key", help="API ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ°"
    ),
    service: Optional[str] = typer.Option(
        None,
        "--service",
        "-s",
        help="Ğ¡ĞµÑ€Ğ²Ğ¸Ñ: virustotal, shodan, abuseipdb, securitytrails",
    ),
):
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸ Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    if not SECURITY_INTEGRATIONS_AVAILABLE:
        console.print("[bold red]âŒ ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ½Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½[/]")
        console.print("[yellow]Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸: pip install aiohttp[/]")
        raise typer.Exit(code=1)

    console.print(
        Panel(
            "[bold blue]Ğ˜ĞĞ¢Ğ•Ğ“Ğ ĞĞ¦Ğ˜Ğ˜ Ğ¡ Ğ’ĞĞ•Ğ¨ĞĞ˜ĞœĞ˜ Ğ¡Ğ•Ğ Ğ’Ğ˜Ğ¡ĞĞœĞ˜ Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¡Ğ¢Ğ˜[/]",
            expand=False,
            border_style="blue",
        )
    )

    if action == "config":
        _manage_integrations_config(service, api_key)
    elif action == "test":
        _test_integrations()
    elif action == "virustotal":
        if not target:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ†ĞµĞ»ÑŒ (--target)[/]")
            raise typer.Exit(code=1)
        asyncio.run(_virustotal_scan(target))
    elif action == "shodan":
        if not target:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ†ĞµĞ»ÑŒ (--target)[/]")
            raise typer.Exit(code=1)
        asyncio.run(_shodan_scan(target))
    elif action == "abuseipdb":
        if not target:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ†ĞµĞ»ÑŒ (--target)[/]")
            raise typer.Exit(code=1)
        asyncio.run(_abuseipdb_check(target))
    elif action == "securitytrails":
        if not target:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ†ĞµĞ»ÑŒ (--target)[/]")
            raise typer.Exit(code=1)
        asyncio.run(_securitytrails_scan(target))
    elif action == "nmap":
        if not target:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ†ĞµĞ»ÑŒ (--target)[/]")
            raise typer.Exit(code=1)
        asyncio.run(_nmap_scan(target, scan_type))
    elif action == "sslyze":
        if not target:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ†ĞµĞ»ÑŒ (--target)[/]")
            raise typer.Exit(code=1)
        asyncio.run(_sslyze_scan(target))
    elif action == "comprehensive":
        if not target:
            console.print("[bold red]ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ†ĞµĞ»ÑŒ (--target)[/]")
            raise typer.Exit(code=1)
        asyncio.run(_comprehensive_security_audit(target))
    elif action == "system-info":
        _show_system_info()
    else:
        console.print(f"[bold red]ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: {action}[/]")
        raise typer.Exit(code=1)


def _manage_integrations_config(service: Optional[str], api_key: Optional[str]):
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹"""
    config = security_integrations.get_config()

    if service and api_key:
        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ API ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ°
        if service in config:
            config[service]["enabled"] = True
            config[service]["api_key"] = api_key
            security_integrations.update_config(config)
            console.print(f"[green]âœ… API ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ {service} Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½[/]")
        else:
            console.print(f"[bold red]ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ: {service}[/]")
    else:
        # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
        table = Table(title="ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹")
        table.add_column("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ", style="cyan")
        table.add_column("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="green")
        table.add_column("API ĞºĞ»ÑÑ‡", style="dim")

        for service_name, service_config in config.items():
            if isinstance(service_config, dict) and "enabled" in service_config:
                status = "âœ… Ğ’ĞºĞ»ÑÑ‡ĞµĞ½" if service_config["enabled"] else "âŒ ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½"
                api_key_status = (
                    "âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½" if service_config.get("api_key") else "âŒ ĞĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½"
                )
                table.add_row(service_name, status, api_key_status)

        console.print(table)


def _test_integrations():
    """Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹"""
    console.print("[cyan]Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹...[/]")

    config = security_integrations.get_config()
    test_results = []

    for service_name, service_config in config.items():
        if isinstance(service_config, dict) and "enabled" in service_config:
            if service_config["enabled"]:
                console.print(f"[yellow]Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ {service_name}...[/]")
                # Ğ—Ğ´ĞµÑÑŒ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹
                test_results.append(f"âœ… {service_name} - Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½")
            else:
                test_results.append(f"âŒ {service_name} - Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½")

    for result in test_results:
        console.print(result)


async def _virustotal_scan(target: str):
    """Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· VirusTotal"""
    console.print(f"[cyan]Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ {target} Ñ‡ĞµÑ€ĞµĞ· VirusTotal...[/]")

    async with security_integrations as si:
        if Path(target).exists():
            # Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ°
            result = await si.virustotal_scan_file(target)
        else:
            # Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ URL
            result = await si.virustotal_scan_url(target)

        if "error" in result:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: {result['error']}[/]")
        else:
            console.print("[green]âœ… Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾[/]")
            console.print(
                f"[dim]Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: {json.dumps(result, indent=2, ensure_ascii=False)}[/]"
            )


async def _shodan_scan(target: str):
    """Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· Shodan"""
    console.print(f"[cyan]ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ {target} Ñ‡ĞµÑ€ĞµĞ· Shodan...[/]")

    async with security_integrations as si:
        result = await si.shodan_host_info(target)

        if "error" in result:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: {result['error']}[/]")
        else:
            console.print("[green]âœ… Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ°[/]")
            console.print(
                f"[dim]Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: {json.dumps(result, indent=2, ensure_ascii=False)}[/]"
            )


async def _abuseipdb_check(target: str):
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· AbuseIPDB"""
    console.print(f"[cyan]ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° {target} Ñ‡ĞµÑ€ĞµĞ· AbuseIPDB...[/]")

    async with security_integrations as si:
        result = await si.abuseipdb_check_ip(target)

        if "error" in result:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: {result['error']}[/]")
        else:
            console.print("[green]âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°[/]")
            console.print(
                f"[dim]Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: {json.dumps(result, indent=2, ensure_ascii=False)}[/]"
            )


async def _securitytrails_scan(target: str):
    """Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· SecurityTrails"""
    console.print(f"[cyan]ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ {target} Ñ‡ĞµÑ€ĞµĞ· SecurityTrails...[/]")

    async with security_integrations as si:
        result = await si.securitytrails_domain_info(target)

        if "error" in result:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: {result['error']}[/]")
        else:
            console.print("[green]âœ… Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ°[/]")
            console.print(
                f"[dim]Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: {json.dumps(result, indent=2, ensure_ascii=False)}[/]"
            )


async def _nmap_scan(target: str, scan_type: str):
    """Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ Nmap"""
    console.print(f"[cyan]Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ {target} Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ Nmap ({scan_type})...[/]")

    async with security_integrations as si:
        result = await si.nmap_scan(target, scan_type)

        if "error" in result and result["error"]:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: {result['error']}[/]")
            if result.get("error_details"):
                console.print(f"[dim]Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸: {result['error_details']}[/]")
        else:
            console.print("[green]âœ… Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾[/]")
            if result.get("output"):
                console.print(f"[dim]Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:\n{result['output']}[/]")
            if result.get("privileged"):
                console.print("[yellow]â„¹ï¸ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ¿Ñ€Ğ¸Ğ²Ğ¸Ğ»ĞµĞ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸[/]")


async def _sslyze_scan(target: str):
    """Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ SSL Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ SSLyze"""
    console.print(f"[cyan]Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ SSL Ğ´Ğ»Ñ {target}...[/]")

    async with security_integrations as si:
        result = await si.sslyze_scan(target)

        if "error" in result:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: {result['error']}[/]")
        else:
            console.print("[green]âœ… SSL ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾[/]")
            if result.get("output"):
                console.print(f"[dim]Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:\n{result['output']}[/]")


async def _comprehensive_security_audit(target: str):
    """ĞšĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½Ñ‹Ğ¹ Ğ°ÑƒĞ´Ğ¸Ñ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    console.print(f"[cyan]ĞšĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½Ñ‹Ğ¹ Ğ°ÑƒĞ´Ğ¸Ñ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ {target}...[/]")

    async with security_integrations as si:
        result = await si.comprehensive_audit(target)

        if "error" in result:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: {result['error']}[/]")
        else:
            console.print("[green]âœ… ĞšĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½Ñ‹Ğ¹ Ğ°ÑƒĞ´Ğ¸Ñ‚ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½[/]")
            console.print(
                f"[dim]Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: {json.dumps(result, indent=2, ensure_ascii=False)}[/]"
            )


def _show_system_info():
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ"""
    console.print(
        Panel("[bold blue]Ğ˜ĞĞ¤ĞĞ ĞœĞĞ¦Ğ˜Ğ¯ Ğ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ•[/]", expand=False, border_style="blue")
    )

    system_info = security_integrations.get_system_info()

    # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
    console.print(f"[cyan]ĞĞ¡:[/] {system_info['os']}")
    console.print(
        f"[cyan]Root Ğ¿Ñ€Ğ°Ğ²Ğ°:[/] {'âœ… Ğ”Ğ°' if system_info['is_root'] else 'âŒ ĞĞµÑ‚'}"
    )
    console.print(
        f"[cyan]ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€:[/] {'âœ… Ğ”Ğ°' if system_info['is_container'] else 'âŒ ĞĞµÑ‚'}"
    )

    # Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹
    console.print("\n[cyan]Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹:[/]")
    tools_table = Table()
    tools_table.add_column("Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚", style="cyan")
    tools_table.add_column("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="green")

    for tool, available in system_info["available_tools"].items():
        status = "âœ… Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½" if available else "âŒ ĞĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½"
        tools_table.add_row(tool, status)

    console.print(tools_table)

    # Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
    if system_info["recommendations"]:
        console.print("\n[cyan]Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸:[/]")
        for rec in system_info["recommendations"]:
            console.print(f"  {rec}")


# ============================================================================
# ĞšĞĞœĞĞĞ”Ğ« Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¡Ğ¢Ğ˜ ĞœĞĞ”Ğ£Ğ›Ğ•Ğ™
# ============================================================================

@security_app.command("modules-status")
def modules_security_status():
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    try:
        # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ·Ğ´ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ Ñ†Ğ¸ĞºĞ»Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²
        import sys
        from pathlib import Path
        project_root = Path(__file__).parent.parent
        sys.path.insert(0, str(project_root))
        
        from Systems.core.app_settings import load_app_settings
        from Systems.core.services_provider import BotServicesProvider
        
        settings = load_app_settings()
        services = BotServicesProvider(settings)
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
        table = Table(title="ğŸ›¡ï¸ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ SDB")
        table.add_column("Ğ¡ĞµÑ€Ğ²Ğ¸Ñ", style="cyan")
        table.add_column("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="green")
        table.add_column("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ")
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
        services_status = [
            ("ModuleSignatureManager", "âœ… Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½", "Ğ¦Ğ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"),
            ("ModuleSandboxManager", "âœ… Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½", "Sandbox Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"),
            ("SecurityAuditLogger", "âœ… Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½", "ĞÑƒĞ´Ğ¸Ñ‚ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹"),
            ("ModuleReputationSystem", "âœ… Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½", "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸"),
            ("ModuleCodeScanner", "âœ… Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½", "Ğ¡ĞºĞ°Ğ½ĞµÑ€ ĞºĞ¾Ğ´Ğ°"),
            ("SecurityLevelManager", "âœ… Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½", "Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"),
            ("AnomalyDetector", "âœ… Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½", "Ğ”ĞµÑ‚ĞµĞºÑ†Ğ¸Ñ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹")
        ]
        
        for service, status, description in services_status:
            table.add_row(service, status, description)
        
        console.print(table)
        
        # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
        try:
            security_config = services.security_level_manager.get_current_configuration()
            console.print(Panel(
                f"Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸: [bold green]{security_config.level.value}[/bold green]\n"
                f"ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸: {len(security_config.policies)}\n"
                f"ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ñ: {security_config.min_reputation_score}\n"
                f"ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ¸ÑĞº: {security_config.max_risk_score}",
                title="ğŸ”’ ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"
            ))
        except Exception as e:
            console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸: {e}[/red]")
    
    except Exception as e:
        console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸: {e}[/red]")

@security_app.command("modules-scan")
def scan_module(
    module_path: str = typer.Argument(..., help="ĞŸÑƒÑ‚ÑŒ Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ´Ğ»Ñ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ")
):
    """Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚ ÑƒĞ³Ñ€Ğ¾Ğ· Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"""
    try:
        import sys
        from pathlib import Path
        project_root = Path(__file__).parent.parent
        sys.path.insert(0, str(project_root))
        
        from Systems.core.app_settings import load_app_settings
        from Systems.core.services_provider import BotServicesProvider
        
        settings = load_app_settings()
        services = BotServicesProvider(settings)
        
        module_path_obj = Path(module_path)
        if not module_path_obj.exists():
            console.print(f"[red]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: {module_path}[/red]")
            return
        
        # Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
        scan_result = services.code_scanner.scan_module(module_path_obj)
        
        # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
        if scan_result.is_safe:
            console.print(f"[green]âœ… ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {scan_result.module_name} Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞµĞ½[/green]")
        else:
            console.print(f"[red]âš ï¸ ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {scan_result.module_name} ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ ÑƒĞ³Ñ€Ğ¾Ğ·Ñ‹[/red]")
        
        console.print(f"Ğ Ğ¸ÑĞº: {scan_result.risk_score:.1f}/100")
        console.print(f"ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ ÑƒĞ³Ñ€Ğ¾Ğ·: {len(scan_result.threats_found)}")
        
        if scan_result.threats_found:
            table = Table(title="ğŸš¨ ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğµ ÑƒĞ³Ñ€Ğ¾Ğ·Ñ‹")
            table.add_column("Ğ¢Ğ¸Ğ¿", style="red")
            table.add_column("Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ", style="yellow")
            table.add_column("Ğ¤Ğ°Ğ¹Ğ»", style="cyan")
            table.add_column("Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ°", style="magenta")
            table.add_column("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ")
            
            for threat in scan_result.threats_found:
                table.add_row(
                    threat.threat_type.value,
                    threat.threat_level.value,
                    Path(threat.file_path).name,
                    str(threat.line_number),
                    threat.description
                )
            
            console.print(table)
    
    except Exception as e:
        console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: {e}[/red]")

@security_app.command("modules-anomalies")
def list_anomalies(
    hours: int = typer.Option(24, help="ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‡Ğ°ÑĞ¾Ğ² Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹")
):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğµ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    try:
        import sys
        from pathlib import Path
        project_root = Path(__file__).parent.parent
        sys.path.insert(0, str(project_root))
        
        from Systems.core.app_settings import load_app_settings
        from Systems.core.services_provider import BotServicesProvider
        
        settings = load_app_settings()
        services = BotServicesProvider(settings)
        
        anomalies = services.anomaly_detector.get_recent_anomalies(hours)
        
        if not anomalies:
            console.print(f"[green]âœ… ĞĞ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹ Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ {hours} Ñ‡Ğ°ÑĞ¾Ğ² Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¾[/green]")
            return
        
        table = Table(title=f"ğŸš¨ ĞĞ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¸ Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ {hours} Ñ‡Ğ°ÑĞ¾Ğ²")
        table.add_column("Ğ’Ñ€ĞµĞ¼Ñ", style="cyan")
        table.add_column("ĞœĞ¾Ğ´ÑƒĞ»ÑŒ", style="yellow")
        table.add_column("Ğ¢Ğ¸Ğ¿", style="red")
        table.add_column("Ğ¡ĞµÑ€ÑŒĞµĞ·Ğ½Ğ¾ÑÑ‚ÑŒ", style="magenta")
        table.add_column("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ")
        
        for anomaly in anomalies[-20:]:  # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 20
            from datetime import datetime
            time_str = datetime.fromtimestamp(anomaly.timestamp).strftime("%H:%M:%S")
            table.add_row(
                time_str,
                anomaly.module_name,
                anomaly.anomaly_type.value,
                anomaly.severity.value,
                anomaly.description
            )
        
        console.print(table)
        
        # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ
        stats = services.anomaly_detector.get_anomaly_statistics()
        console.print(Panel(
            f"Ğ’ÑĞµĞ³Ğ¾ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹: {stats['total_anomalies']}\n"
            f"Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹: {len(stats['auto_blocked_modules'])}\n"
            f"ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹: {stats['active_modules']}",
            title="ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹"
        ))
    
    except Exception as e:
        console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹: {e}[/red]")

@security_app.command("modules-reputation")
def reputation(
    module_name: Optional[str] = typer.Option(None, help="Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸")
):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    try:
        import sys
        from pathlib import Path
        project_root = Path(__file__).parent.parent
        sys.path.insert(0, str(project_root))
        
        from Systems.core.app_settings import load_app_settings
        from Systems.core.services_provider import BotServicesProvider
        
        settings = load_app_settings()
        services = BotServicesProvider(settings)
        
        if module_name:
            # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
            reputation = services.reputation_system.get_module_reputation(module_name)
            
            if reputation:
                console.print(Panel(
                    f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ: {reputation.module_name}\n"
                    f"Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº: {reputation.developer_id}\n"
                    f"ĞÑ†ĞµĞ½ĞºĞ°: {reputation.total_score:.1f}/100\n"
                    f"Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: {reputation.level.value}\n"
                    f"Ğ£Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ: {reputation.confidence:.1%}",
                    title=f"â­ Ğ ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name}"
                ))
            else:
                console.print(f"[yellow]Ğ ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_name} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°[/yellow]")
        else:
            # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ¿ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
            top_modules = services.reputation_system.get_top_modules(10)
            
            if top_modules:
                table = Table(title="ğŸ† Ğ¢Ğ¾Ğ¿ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ¿Ğ¾ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸")
                table.add_column("ĞœĞ¾Ğ´ÑƒĞ»ÑŒ", style="cyan")
                table.add_column("Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº", style="yellow")
                table.add_column("ĞÑ†ĞµĞ½ĞºĞ°", style="green")
                table.add_column("Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ", style="magenta")
                
                for module_name, reputation in top_modules:
                    table.add_row(
                        module_name,
                        reputation.developer_id,
                        f"{reputation.total_score:.1f}",
                        reputation.level.value
                    )
                
                console.print(table)
            else:
                console.print("[yellow]ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹[/yellow]")
    
    except Exception as e:
        console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ñ€ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸: {e}[/red]")

@security_app.command("keys-generate")
def generate_key(
    key_id: str = typer.Argument(..., help="ID ĞºĞ»ÑÑ‡Ğ° Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸"),
    key_size: int = typer.Option(2048, help="Ğ Ğ°Ğ·Ğ¼ĞµÑ€ ĞºĞ»ÑÑ‡Ğ° Ğ² Ğ±Ğ¸Ñ‚Ğ°Ñ…")
):
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¿Ğ°Ñ€Ñƒ ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    try:
        import sys
        from pathlib import Path
        project_root = Path(__file__).parent.parent
        sys.path.insert(0, str(project_root))
        
        from Systems.core.app_settings import load_app_settings
        from Systems.core.services_provider import BotServicesProvider
        
        settings = load_app_settings()
        services = BotServicesProvider(settings)
        
        # Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ»ÑÑ‡Ğ¸
        success = services.signature_manager.generate_signing_key(key_id, key_size)
        
        if success:
            console.print(f"[green]âœ… Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ½Ğ¾Ğ²Ğ°Ñ Ğ¿Ğ°Ñ€Ğ° ĞºĞ»ÑÑ‡ĞµĞ¹: {key_id}[/green]")
            console.print(f"[cyan]Ğ Ğ°Ğ·Ğ¼ĞµÑ€ ĞºĞ»ÑÑ‡Ğ°: {key_size} Ğ±Ğ¸Ñ‚[/cyan]")
            
            # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
            public_key = services.signature_manager.export_public_key(key_id)
            if public_key:
                console.print(Panel(
                    public_key.decode('utf-8'),
                    title=f"ğŸ”‘ ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ {key_id}",
                    subtitle="Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚Ğµ ÑÑ‚Ğ¾Ñ‚ ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ Ñ€Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ"
                ))
        else:
            console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ»ÑÑ‡ĞµĞ¹ {key_id}[/red]")
    
    except Exception as e:
        console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ»ÑÑ‡ĞµĞ¹: {e}[/red]")

@security_app.command("keys-list")
def list_keys():
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ»ÑÑ‡ĞµĞ¹"""
    try:
        import sys
        from pathlib import Path
        project_root = Path(__file__).parent.parent
        sys.path.insert(0, str(project_root))
        
        from Systems.core.app_settings import load_app_settings
        from Systems.core.services_provider import BotServicesProvider
        
        settings = load_app_settings()
        services = BotServicesProvider(settings)
        
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ»ÑÑ‡ĞµĞ¹
        available_keys = services.signature_manager.list_available_keys()
        trusted_signers = services.signature_manager.list_trusted_signers()
        
        if available_keys:
            table = Table(title="ğŸ”‘ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ ĞºĞ»ÑÑ‡Ğ¸")
            table.add_column("ID ĞºĞ»ÑÑ‡Ğ°", style="cyan")
            table.add_column("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="green")
            table.add_column("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ")
            
            for key_id in available_keys:
                is_trusted = key_id in trusted_signers
                status = "âœ… Ğ”Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹" if is_trusted else "âš ï¸ ĞĞµ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹"
                description = trusted_signers.get(key_id, {}).get("description", "ĞĞµÑ‚ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ")
                
                table.add_row(key_id, status, description)
            
            console.print(table)
        else:
            console.print("[yellow]ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ»ÑÑ‡ĞµĞ¹[/yellow]")
        
        # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ğ¾Ğ²
        if trusted_signers:
            console.print("\n[cyan]Ğ”Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ñ‚Ñ‹:[/cyan]")
            for signer_id, signer_info in trusted_signers.items():
                console.print(f"  â€¢ {signer_id}: {signer_info.get('name', 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾')}")
    
    except Exception as e:
        console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ° ĞºĞ»ÑÑ‡ĞµĞ¹: {e}[/red]")

@security_app.command("sign-module")
def sign_module(
    module_path: str = typer.Argument(..., help="ĞŸÑƒÑ‚ÑŒ Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ"),
    key_id: str = typer.Argument(..., help="ID ĞºĞ»ÑÑ‡Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ")
):
    """ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ñ†Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒÑ"""
    try:
        import sys
        from pathlib import Path
        project_root = Path(__file__).parent.parent
        sys.path.insert(0, str(project_root))
        
        from Systems.core.app_settings import load_app_settings
        from Systems.core.services_provider import BotServicesProvider
        
        settings = load_app_settings()
        services = BotServicesProvider(settings)
        
        module_path_obj = Path(module_path)
        if not module_path_obj.exists():
            console.print(f"[red]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: {module_path}[/red]")
            return
        
        # ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
        success = services.signature_manager.sign_module(module_path_obj, key_id)
        
        if success:
            console.print(f"[green]âœ… ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {module_path_obj.name} ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½ ĞºĞ»ÑÑ‡Ğ¾Ğ¼ {key_id}[/green]")
        else:
            console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {module_path_obj.name}[/red]")
    
    except Exception as e:
        console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: {e}[/red]")

if __name__ == "__main__":
    security_app()



======================================================================

------------------------------ FILE: Systems/cli/dev.py ------------------------------
# cli/dev.py
import asyncio
import json
import os
import shutil
import subprocess
import sys
import tempfile
from datetime import datetime
from pathlib import Path
from typing import Any, Dict, List, Optional

import typer
from rich.console import Console
from rich.panel import Panel
from rich.table import Table

console = Console()
dev_app = typer.Typer(name="dev", help="ğŸ”§ Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸")

# ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ Ğ´Ğ»Ñ dev Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
DEV_DIR = Path("Data/dev")
DEV_CONFIG_FILE = DEV_DIR / "dev_config.json"
DEV_LOGS_DIR = DEV_DIR / "logs"
DEV_DOCS_DIR = DEV_DIR / "docs"


def _ensure_dev_directory():
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ dev Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² ĞµÑĞ»Ğ¸ ĞµÑ‘ Ğ½ĞµÑ‚"""
    DEV_DIR.mkdir(parents=True, exist_ok=True)
    DEV_LOGS_DIR.mkdir(parents=True, exist_ok=True)
    DEV_DOCS_DIR.mkdir(parents=True, exist_ok=True)

    if not DEV_CONFIG_FILE.exists():
        default_config = {
            "linting": {
                "tools": ["flake8", "black", "isort", "mypy"],
                "config_files": {
                    "flake8": ".flake8",
                    "black": "pyproject.toml",
                    "isort": ".isort.cfg",
                    "mypy": "mypy.ini",
                },
            },
            "testing": {
                "framework": "pytest",
                "coverage_tool": "coverage",
                "test_pattern": "test_*.py",
                "coverage_report_format": "html",
            },
            "documentation": {
                "builder": "sphinx",
                "formats": ["html", "pdf"],
                "source_dir": "docs",
                "output_dir": "docs/build",
            },
            "debugging": {
                "log_levels": ["DEBUG", "INFO", "WARNING", "ERROR"],
                "log_formats": ["text", "json"],
                "profiling": False,
            },
        }
        with open(DEV_CONFIG_FILE, "w") as f:
            json.dump(default_config, f, indent=2)


def _load_dev_config() -> Dict[str, Any]:
    """Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ dev Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²"""
    _ensure_dev_directory()
    try:
        with open(DEV_CONFIG_FILE, "r") as f:
            return json.load(f)
    except FileNotFoundError:
        return {}


def _save_dev_config(config: Dict[str, Any]):
    """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ dev Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²"""
    _ensure_dev_directory()
    with open(DEV_CONFIG_FILE, "w") as f:
        json.dump(config, f, indent=2)


def _check_tool_availability(tool_name: str) -> bool:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ°"""
    # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ Ñ‡ĞµÑ€ĞµĞ· Python Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ (Ğ´Ğ»Ñ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğ¹)
    try:
        result = subprocess.run(
            [sys.executable, "-m", tool_name, "--version"], 
            capture_output=True, text=True
        )
        if result.returncode == 0:
            return True
    except FileNotFoundError:
        pass
    
    # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ñ‡ĞµÑ€ĞµĞ· Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ, Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ
    try:
        result = subprocess.run(
            [tool_name, "--version"], capture_output=True, text=True
        )
        return result.returncode == 0
    except FileNotFoundError:
        return False


def _get_python_files(directory: str = ".") -> List[str]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Python Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ² Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸"""
    python_files = []
    for root, dirs, files in os.walk(directory):
        # Ğ˜ÑĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ¸ ĞºÑÑˆ
        dirs[:] = [
            d
            for d in dirs
            if not d.startswith(".") and d not in ["venv", "env", "__pycache__"]
        ]
        for file in files:
            if file.endswith(".py"):
                python_files.append(os.path.join(root, file))
    return python_files


@dev_app.command(name="lint", help="ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ´Ğ° Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ Ğ»Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°.")
def dev_lint_cmd(
    files: Optional[List[str]] = typer.Option(
        None, "--files", "-f", help="Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸"
    ),
    fix: bool = typer.Option(False, "--fix", help="ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹"),
    tool: str = typer.Option(
        "flake8", "--tool", "-t", help="Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚: flake8, black, isort, mypy"
    ),
    output_format: str = typer.Option(
        "text", "--format", help="Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°: text, json, html"
    ),
):
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ´Ğ° Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ Ğ»Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°"""
    try:
        asyncio.run(_dev_lint_async(files, fix, tool, output_format))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'dev lint': {e}[/]")
        raise typer.Exit(code=1)


async def _dev_lint_async(
    files: Optional[List[str]], fix: bool, tool: str, output_format: str
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ lint"""
    console.print(
        Panel("[bold blue]ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ ĞšĞĞ”Ğ[/]", expand=False, border_style="blue")
    )

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ°
    if not _check_tool_availability(tool):
        console.print(
            f"[bold red]Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ '{tool}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ ĞµĞ³Ğ¾: pip install {tool}[/]"
        )
        raise typer.Exit(code=1)

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
    if not files:
        files = _get_python_files()
        console.print(f"[cyan]ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Python Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²:[/] {len(files)}")
    else:
        console.print(f"[cyan]Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸:[/] {', '.join(files)}")

    if not files:
        console.print("[yellow]Python Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹[/]")
        return

    console.print(f"[cyan]Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚:[/] {tool}")
    console.print(f"[cyan]Ğ ĞµĞ¶Ğ¸Ğ¼:[/] {'ĞĞ²Ñ‚Ğ¾Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ' if fix else 'Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°'}")

    # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ
    issues = await _run_linting_tool(tool, files, fix)

    # ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
    await _display_lint_results(issues, tool, output_format)


async def _run_linting_tool(
    tool: str, files: List[str], fix: bool
) -> List[Dict[str, Any]]:
    """Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ Ğ»Ğ¸Ğ½Ñ‚Ğ¸Ğ½Ğ³Ğ°"""
    issues = []

    try:
        # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ python -m Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ² Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğ¸
        if tool == "flake8":
            cmd = [sys.executable, "-m", "flake8"] + files
            if fix:
                console.print("[yellow]flake8 Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ[/]")
        elif tool == "black":
            cmd = [sys.executable, "-m", "black"] + files
            if not fix:
                cmd.append("--check")
        elif tool == "isort":
            cmd = [sys.executable, "-m", "isort"] + files
            if not fix:
                cmd.append("--check-only")
        elif tool == "mypy":
            cmd = [sys.executable, "-m", "mypy"] + files
        else:
            console.print(f"[yellow]ĞĞµĞ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚: {tool}[/]")
            return issues

        console.print(f"[cyan]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ:[/] {' '.join(cmd)}")

        result = subprocess.run(cmd, capture_output=True, text=True)

        if result.returncode == 0:
            console.print("[green]âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ° Ğ±ĞµĞ· Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº[/]")
        else:
            # ĞŸĞ°Ñ€ÑĞ¸Ğ¼ Ğ²Ñ‹Ğ²Ğ¾Ğ´ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼
            for line in result.stdout.split("\n") + result.stderr.split("\n"):
                if line.strip():
                    issues.append(
                        {
                            "file": "unknown",
                            "line": 0,
                            "column": 0,
                            "message": line.strip(),
                            "severity": "error",
                        }
                    )

            console.print(f"[yellow]âš ï¸ ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼: {len(issues)}[/]")

    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸ {tool}: {e}[/]")

    return issues


async def _display_lint_results(
    issues: List[Dict[str, Any]], tool: str, output_format: str
):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ»Ğ¸Ğ½Ñ‚Ğ¸Ğ½Ğ³Ğ°"""
    if output_format == "json":
        console.print(json.dumps(issues, indent=2, ensure_ascii=False))
        return

    if not issues:
        console.print("[green]âœ… ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾[/]")
        return

    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚
    table = Table(title=f"Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ ({tool})")
    table.add_column("Ğ¤Ğ°Ğ¹Ğ»", style="cyan")
    table.add_column("Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ°", style="blue")
    table.add_column("ĞšĞ¾Ğ»Ğ¾Ğ½ĞºĞ°", style="green")
    table.add_column("Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ", style="white")
    table.add_column("Ğ¢Ğ¸Ğ¿", style="red")

    for issue in issues:
        table.add_row(
            issue.get("file", "N/A"),
            str(issue.get("line", "N/A")),
            str(issue.get("column", "N/A")),
            issue.get("message", "N/A"),
            issue.get("severity", "error"),
        )

    console.print(table)


@dev_app.command(name="test", help="Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚ĞµÑÑ‚Ğ¾Ğ².")
def dev_test_cmd(
    pattern: Optional[str] = typer.Option(
        None, "--pattern", "-p", help="Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ñ‚ĞµÑÑ‚Ğ¾Ğ²"
    ),
    coverage: bool = typer.Option(
        False, "--coverage", "-c", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°"
    ),
    verbose: bool = typer.Option(False, "--verbose", "-v", help="ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ²Ğ¾Ğ´"),
    parallel: bool = typer.Option(
        False, "--parallel", help="Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚ĞµÑÑ‚Ğ¾Ğ² Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾"
    ),
):
    """Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚ĞµÑÑ‚Ğ¾Ğ²"""
    try:
        asyncio.run(_dev_test_async(pattern, coverage, verbose, parallel))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'dev test': {e}[/]")
        raise typer.Exit(code=1)


async def _dev_test_async(
    pattern: Optional[str], coverage: bool, verbose: bool, parallel: bool
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ test"""
    console.print(
        Panel("[bold blue]Ğ—ĞĞŸĞ£Ğ¡Ğš Ğ¢Ğ•Ğ¡Ğ¢ĞĞ’[/]", expand=False, border_style="blue")
    )

    config = _load_dev_config()
    test_config = config.get("testing", {})
    framework = test_config.get("framework", "pytest")

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ pytest
    if not _check_tool_availability("pytest"):
        console.print(
            "[bold red]pytest Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ ĞµĞ³Ğ¾: pip install pytest[/]"
        )
        raise typer.Exit(code=1)

    # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ
    cmd = ["pytest"]

    if pattern:
        cmd.extend(["-k", pattern])
        console.print(f"[cyan]Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ Ñ‚ĞµÑÑ‚Ğ¾Ğ²:[/] {pattern}")

    if coverage:
        if not _check_tool_availability("coverage"):
            console.print(
                "[yellow]coverage Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ ĞµĞ³Ğ¾: pip install coverage[/]"
            )
        else:
            cmd.extend(["--cov=.", "--cov-report=html", "--cov-report=term"])
            console.print("[cyan]ĞŸĞ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°:[/] Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾")

    if verbose:
        cmd.append("-v")
        console.print("[cyan]Ğ ĞµĞ¶Ğ¸Ğ¼:[/] ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ²Ğ¾Ğ´")

    if parallel:
        if not _check_tool_availability("pytest-xdist"):
            console.print(
                "[yellow]pytest-xdist Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ ĞµĞ³Ğ¾: pip install pytest-xdist[/]"
            )
        else:
            cmd.extend(["-n", "auto"])
            console.print("[cyan]Ğ ĞµĞ¶Ğ¸Ğ¼:[/] ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ")

    console.print(f"[cyan]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ:[/] {' '.join(cmd)}")

    try:
        result = subprocess.run(cmd, capture_output=True, text=True)

        if result.returncode == 0:
            console.print("[green]âœ… Ğ’ÑĞµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¸ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾[/]")
        else:
            console.print("[red]âŒ ĞĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ½Ğµ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¸[/]")

        # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²Ñ‹Ğ²Ğ¾Ğ´
        if result.stdout:
            console.print("\n[cyan]Ğ’Ñ‹Ğ²Ğ¾Ğ´ Ñ‚ĞµÑÑ‚Ğ¾Ğ²:[/]")
            console.print(result.stdout)

        if result.stderr:
            console.print("\n[yellow]ĞÑˆĞ¸Ğ±ĞºĞ¸:[/]")
            console.print(result.stderr)

    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²: {e}[/]")


@dev_app.command(name="docs", help="Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸.")
def dev_docs_cmd(
    format: str = typer.Option(
        "html", "--format", "-f", help="Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸: html, pdf, epub"
    ),
    output_dir: Optional[str] = typer.Option(
        None, "--output", "-o", help="Ğ”Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ"
    ),
    clean: bool = typer.Option(False, "--clean", help="ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ÑƒÑ ÑĞ±Ğ¾Ñ€ĞºÑƒ"),
    serve: bool = typer.Option(
        False, "--serve", help="Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°"
    ),
):
    """Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸"""
    try:
        asyncio.run(_dev_docs_async(format, output_dir, clean, serve))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'dev docs': {e}[/]")
        raise typer.Exit(code=1)


async def _dev_docs_async(
    format: str, output_dir: Optional[str], clean: bool, serve: bool
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ docs"""
    console.print(
        Panel("[bold blue]Ğ¡Ğ‘ĞĞ ĞšĞ Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢ĞĞ¦Ğ˜Ğ˜[/]", expand=False, border_style="blue")
    )

    config = _load_dev_config()
    docs_config = config.get("documentation", {})
    builder = docs_config.get("builder", "sphinx")

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ sphinx-build
    if not _check_tool_availability("sphinx-build"):
        console.print(
            "[bold red]sphinx-build Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ ĞµĞ³Ğ¾: pip install sphinx[/]"
        )
        raise typer.Exit(code=1)

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸
    source_dir = Path(docs_config.get("source_dir", "docs"))
    if not output_dir:
        output_dir = docs_config.get("output_dir", "docs/build")

    output_path = Path(output_dir)

    console.print(f"[cyan]Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚:[/] {format}")
    console.print(f"[cyan]Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº:[/] {source_dir}")
    console.print(f"[cyan]Ğ’Ñ‹Ğ²Ğ¾Ğ´:[/] {output_path}")

    # ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ ÑĞ±Ğ¾Ñ€ĞºĞ¸
    if clean and output_path.exists():
        shutil.rmtree(output_path)
        console.print("[cyan]ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ°Ñ ÑĞ±Ğ¾Ñ€ĞºĞ° Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½Ğ°[/]")

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°
    output_path.mkdir(parents=True, exist_ok=True)

    # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ sphinx
    cmd = ["sphinx-build", "-b", format, str(source_dir), str(output_path)]

    console.print(f"[cyan]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ:[/] {' '.join(cmd)}")

    try:
        result = subprocess.run(cmd, capture_output=True, text=True)

        if result.returncode == 0:
            console.print(f"[green]âœ… Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ° Ğ² {output_path}[/]")

            if serve:
                await _serve_documentation(output_path, format)
        else:
            console.print("[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ±Ğ¾Ñ€ĞºĞµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸[/]")
            if result.stderr:
                console.print(result.stderr)

    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ±Ğ¾Ñ€ĞºĞµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸: {e}[/]")


async def _serve_documentation(output_path: Path, format: str):
    """Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸"""
    if format != "html":
        console.print(
            "[yellow]ĞŸÑ€ĞµĞ´Ğ²Ğ°Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ HTML Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ°[/]"
        )
        return

    try:
        import http.server
        import socketserver

        port = 8001
        os.chdir(output_path)

        with socketserver.TCPServer(
            ("", port), http.server.SimpleHTTPRequestHandler
        ) as httpd:
            console.print(
                f"[green]ğŸŒ Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ° Ğ¿Ğ¾ Ğ°Ğ´Ñ€ĞµÑÑƒ: http://localhost:{port}[/]"
            )
            console.print("[yellow]ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ctrl+C Ğ´Ğ»Ñ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ ÑĞµÑ€Ğ²ĞµÑ€Ğ°[/]")

            try:
                httpd.serve_forever()
            except KeyboardInterrupt:
                console.print("\n[yellow]Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½[/]")

    except Exception as e:
        console.print(f"[yellow]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ ÑĞµÑ€Ğ²ĞµÑ€: {e}[/]")


@dev_app.command(name="debug", help="Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸.")
def dev_debug_cmd(
    level: str = typer.Option(
        "DEBUG", "--level", "-l", help="Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸: DEBUG, INFO, WARNING, ERROR"
    ),
    log_file: Optional[str] = typer.Option(
        None, "--log-file", help="Ğ¤Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸"
    ),
    profiling: bool = typer.Option(
        False, "--profiling", help="Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ"
    ),
    memory: bool = typer.Option(
        False, "--memory", help="ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸"
    ),
):
    """Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸"""
    try:
        asyncio.run(_dev_debug_async(level, log_file, profiling, memory))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'dev debug': {e}[/]")
        raise typer.Exit(code=1)


async def _dev_debug_async(
    level: str, log_file: Optional[str], profiling: bool, memory: bool
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ debug"""
    console.print(
        Panel("[bold blue]Ğ Ğ•Ğ–Ğ˜Ğœ ĞĞ¢Ğ›ĞĞ”ĞšĞ˜[/]", expand=False, border_style="blue")
    )

    config = _load_dev_config()
    debug_config = config.get("debugging", {})

    console.print(f"[cyan]Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸:[/] {level}")

    if log_file:
        console.print(f"[cyan]Ğ¤Ğ°Ğ¹Ğ» Ğ»Ğ¾Ğ³Ğ¾Ğ²:[/] {log_file}")
    else:
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        log_file = DEV_LOGS_DIR / f"debug_{timestamp}.log"
        console.print(f"[cyan]Ğ¤Ğ°Ğ¹Ğ» Ğ»Ğ¾Ğ³Ğ¾Ğ²:[/] {log_file}")

    # ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
    await _setup_debug_logging(level, log_file)

    # ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
    if profiling:
        await _setup_profiling()

    # ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸
    if memory:
        await _setup_memory_monitoring()

    console.print("[green]âœ… Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½[/]")
    console.print("[dim]Ğ›Ğ¾Ğ³Ğ¸ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ² ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»[/]")


async def _setup_debug_logging(level: str, log_file: str):
    """ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸"""
    import logging

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€
    logger = logging.getLogger("swiftdevbot_debug")
    logger.setLevel(getattr(logging, level.upper(), logging.DEBUG))

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº
    file_handler = logging.FileHandler(log_file)
    file_handler.setLevel(getattr(logging, level.upper(), logging.DEBUG))

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‚ĞµÑ€
    formatter = logging.Formatter(
        "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    )
    file_handler.setFormatter(formatter)

    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğº Ğ»Ğ¾Ğ³Ğ³ĞµÑ€Ñƒ
    logger.addHandler(file_handler)

    # Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
    logger.info(f"ĞÑ‚Ğ»Ğ°Ğ´ĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ñ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¼ {level}")
    logger.debug("Ğ­Ñ‚Ğ¾ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ Ğ¾Ñ‚Ğ»Ğ°Ğ´Ğ¾Ñ‡Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ")


async def _setup_profiling():
    """ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ"""
    try:
        import cProfile
        import pstats

        console.print("[cyan]ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:[/] Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾")
        console.print("[dim]Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ cProfile Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸[/]")

    except ImportError:
        console.print("[yellow]cProfile Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½[/]")


async def _setup_memory_monitoring():
    """ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸"""
    try:
        import gc

        import psutil

        console.print("[cyan]ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸:[/] Ğ’ĞºĞ»ÑÑ‡ĞµĞ½")

        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸
        process = psutil.Process()
        memory_info = process.memory_info()

        console.print(
            f"[dim]Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸:[/] {memory_info.rss / 1024 / 1024:.1f} MB"
        )
        console.print(
            f"[dim]Ğ’Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ:[/] {memory_info.vms / 1024 / 1024:.1f} MB"
        )

        # ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ ÑĞ±Ğ¾Ñ€ĞºĞ° Ğ¼ÑƒÑĞ¾Ñ€Ğ°
        gc.collect()
        console.print("[dim]Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ¼ÑƒÑĞ¾Ñ€Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°[/]")

    except ImportError:
        console.print("[yellow]psutil Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸[/]")


@dev_app.command(name="analyze", help="ĞĞ½Ğ°Ğ»Ğ¸Ğ· ĞºĞ¾Ğ´Ğ°.")
def dev_analyze_cmd(
    tool: str = typer.Option(
        "pylint", "--tool", "-t", help="Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°: pylint, bandit, safety"
    ),
    output_format: str = typer.Option(
        "text", "--format", help="Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°: text, json, html"
    ),
):
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ· ĞºĞ¾Ğ´Ğ°"""
    try:
        asyncio.run(_dev_analyze_async(tool, output_format))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'dev analyze': {e}[/]")
        raise typer.Exit(code=1)


async def _dev_analyze_async(tool: str, output_format: str):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ analyze"""
    console.print(Panel("[bold blue]ĞĞĞĞ›Ğ˜Ğ— ĞšĞĞ”Ğ[/]", expand=False, border_style="blue"))

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ°
    if not _check_tool_availability(tool):
        console.print(
            f"[bold red]Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ '{tool}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ ĞµĞ³Ğ¾: pip install {tool}[/]"
        )
        raise typer.Exit(code=1)

    console.print(f"[cyan]Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°:[/] {tool}")

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº Python Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
    files = _get_python_files()

    if not files:
        console.print("[yellow]Python Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹[/]")
        return

    # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·
    issues = await _run_code_analysis(tool, files)

    # ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
    await _display_analysis_results(issues, tool, output_format)


async def _run_code_analysis(tool: str, files: List[str]) -> List[Dict[str, Any]]:
    """Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· ĞºĞ¾Ğ´Ğ°"""
    issues = []

    try:
        if tool == "pylint":
            cmd = ["pylint"] + files
        elif tool == "bandit":
            cmd = ["bandit", "-r", "."]
        elif tool == "safety":
            cmd = ["safety", "check"]
        else:
            console.print(f"[yellow]ĞĞµĞ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°: {tool}[/]")
            return issues

        console.print(f"[cyan]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ:[/] {' '.join(cmd)}")

        result = subprocess.run(cmd, capture_output=True, text=True)

        # ĞŸĞ°Ñ€ÑĞ¸Ğ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
        for line in result.stdout.split("\n") + result.stderr.split("\n"):
            if line.strip():
                issues.append(
                    {"tool": tool, "message": line.strip(), "severity": "info"}
                )

        if result.returncode == 0:
            console.print("[green]âœ… ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½ Ğ±ĞµĞ· ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼[/]")
        else:
            console.print(f"[yellow]âš ï¸ ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼: {len(issues)}[/]")

    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°: {e}[/]")

    return issues


async def _display_analysis_results(
    issues: List[Dict[str, Any]], tool: str, output_format: str
):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°"""
    if output_format == "json":
        console.print(json.dumps(issues, indent=2, ensure_ascii=False))
        return

    if not issues:
        console.print("[green]âœ… ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾[/]")
        return

    # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚
    table = Table(title=f"Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° ({tool})")
    table.add_column("Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚", style="cyan")
    table.add_column("Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ", style="white")
    table.add_column("Ğ’Ğ°Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ", style="red")

    for issue in issues:
        table.add_row(
            issue.get("tool", "N/A"),
            issue.get("message", "N/A"),
            issue.get("severity", "info"),
        )

    console.print(table)


@dev_app.command(name="profile", help="ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ ĞºĞ¾Ğ´Ğ°.")
def dev_profile_cmd(
    profile_type: str = typer.Option(
        "cpu", "--type", "-t", help="Ğ¢Ğ¸Ğ¿ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: cpu, memory, time"
    ),
    duration: int = typer.Option(
        30, "--duration", "-d", help="Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…"
    ),
    output_file: Optional[str] = typer.Option(
        None, "--output", "-o", help="Ğ¤Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²"
    ),
    target_script: Optional[str] = typer.Option(
        None, "--script", "-s", help="Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"
    ),
):
    """ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ ĞºĞ¾Ğ´Ğ°"""
    try:
        asyncio.run(_dev_profile_async(profile_type, duration, output_file, target_script))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'dev profile': {e}[/]")
        raise typer.Exit(code=1)


async def _dev_profile_async(
    profile_type: str, duration: int, output_file: Optional[str], target_script: Optional[str]
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ profile"""
    console.print(Panel("[bold blue]ĞŸĞ ĞĞ¤Ğ˜Ğ›Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ• ĞŸĞ ĞĞ˜Ğ—Ğ’ĞĞ”Ğ˜Ğ¢Ğ•Ğ›Ğ¬ĞĞĞ¡Ğ¢Ğ˜[/]", expand=False, border_style="blue"))

    console.print(f"[cyan]Ğ¢Ğ¸Ğ¿ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:[/] {profile_type}")
    console.print(f"[cyan]Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ:[/] {duration} ÑĞµĞºÑƒĞ½Ğ´")
    
    if target_script:
        console.print(f"[cyan]Ğ¦ĞµĞ»ĞµĞ²Ğ¾Ğ¹ ÑĞºÑ€Ğ¸Ğ¿Ñ‚:[/] {target_script}")
    
    if output_file:
        console.print(f"[cyan]Ğ¤Ğ°Ğ¹Ğ» Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²:[/] {output_file}")

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    if not target_script:
        # ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ±Ğ¾Ñ‚
        target_script = "run_bot.py"
        console.print(f"[cyan]Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ:[/] {target_script}")

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ°
    if not Path(target_script).exists():
        console.print(f"[bold red]Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ '{target_script}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½![/]")
        raise typer.Exit(code=1)

    # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
    results = await _run_profiling(profile_type, duration, target_script, output_file)

    # ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
    await _display_profile_results(results, profile_type, output_file)


async def _run_profiling(
    profile_type: str, duration: int, target_script: str, output_file: Optional[str]
) -> Dict[str, Any]:
    """Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ"""
    results = {
        "type": profile_type,
        "duration": duration,
        "script": target_script,
        "timestamp": datetime.now().isoformat(),
        "data": {}
    }

    try:
        if profile_type == "cpu":
            results["data"] = await _profile_cpu(target_script, duration, output_file)
        elif profile_type == "memory":
            results["data"] = await _profile_memory(target_script, duration, output_file)
        elif profile_type == "time":
            results["data"] = await _profile_time(target_script, duration, output_file)
        else:
            console.print(f"[bold red]ĞĞµĞ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: {profile_type}[/]")
            console.print("[yellow]ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹: cpu, memory, time[/]")
            raise typer.Exit(code=1)

    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸: {e}[/]")
        raise typer.Exit(code=1)

    return results


async def _profile_cpu(script: str, duration: int, output_file: Optional[str]) -> Dict[str, Any]:
    """ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ CPU"""
    console.print("[cyan]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ CPU Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ...[/]")
    
    import cProfile
    import pstats
    import tempfile
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
    with tempfile.NamedTemporaryFile(suffix='.prof', delete=False) as tmp_file:
        prof_file = tmp_file.name
    
    try:
        # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
        profiler = cProfile.Profile()
        profiler.enable()
        
        # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ
        process = subprocess.Popen(
            [sys.executable, script],
            stdout=subprocess.DEVNULL,
            stderr=subprocess.DEVNULL
        )
        
        # Ğ–Ğ´ĞµĞ¼ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ
        await asyncio.sleep(duration)
        
        # ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ
        process.terminate()
        try:
            process.wait(timeout=5)
        except subprocess.TimeoutExpired:
            process.kill()
        
        profiler.disable()
        
        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
        profiler.dump_stats(prof_file)
        
        # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
        stats = pstats.Stats(prof_file)
        stats.sort_stats('cumulative')
        
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ¿-10 Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹
        top_functions = []
        for func, (cc, nc, tt, ct, callers) in stats.stats.items():
            if isinstance(func, tuple):
                filename, line, funcname = func
                top_functions.append({
                    "function": funcname,
                    "file": filename,
                    "line": line,
                    "calls": nc,
                    "total_time": ct,
                    "per_call": ct / nc if nc > 0 else 0
                })
        
        # Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
        top_functions.sort(key=lambda x: x["total_time"], reverse=True)
        top_functions = top_functions[:10]
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ HTML Ğ¾Ñ‚Ñ‡ĞµÑ‚ ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
        if output_file:
            html_file = output_file if output_file.endswith('.html') else f"{output_file}.html"
            stats.dump_stats(html_file.replace('.html', '.prof'))
            console.print(f"[green]âœ… HTML Ğ¾Ñ‚Ñ‡ĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½: {html_file}[/]")
        
        return {
            "top_functions": top_functions,
            "total_functions": len(stats.stats),
            "total_time": sum(f[3] for f in stats.stats.values()),
            "html_file": output_file if output_file else None
        }
        
    finally:
        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»
        if Path(prof_file).exists():
            Path(prof_file).unlink()


async def _profile_memory(script: str, duration: int, output_file: Optional[str]) -> Dict[str, Any]:
    """ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸"""
    console.print("[cyan]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸...[/]")
    
    try:
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ memory_profiler
        import memory_profiler
    except ImportError:
        console.print("[bold red]memory_profiler Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½![/]")
        console.print("[yellow]Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ: pip install memory_profiler[/]")
        raise typer.Exit(code=1)
    
    # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸
    cmd = [sys.executable, "-m", "memory_profiler", script]
    
    process = subprocess.Popen(
        cmd,
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE
    )
    
    # Ğ–Ğ´ĞµĞ¼ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ
    await asyncio.sleep(duration)
    
    # ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ
    process.terminate()
    try:
        process.wait(timeout=5)
    except subprocess.TimeoutExpired:
        process.kill()
    
    stdout, stderr = process.communicate()
    
    # ĞŸĞ°Ñ€ÑĞ¸Ğ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
    memory_data = []
    for line in stdout.decode().split('\n'):
        if line.strip() and 'MiB' in line:
            parts = line.split()
            if len(parts) >= 4:
                memory_data.append({
                    "line": parts[0],
                    "memory": parts[1],
                    "increment": parts[2],
                    "function": ' '.join(parts[3:])
                })
    
    return {
        "memory_usage": memory_data,
        "peak_memory": max([float(d["memory"]) for d in memory_data]) if memory_data else 0,
        "total_lines": len(memory_data)
    }


async def _profile_time(script: str, duration: int, output_file: Optional[str]) -> Dict[str, Any]:
    """ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ"""
    console.print("[cyan]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸...[/]")
    
    import time
    
    start_time = time.time()
    
    # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ÑĞºÑ€Ğ¸Ğ¿Ñ‚
    process = subprocess.Popen(
        [sys.executable, script],
        stdout=subprocess.DEVNULL,
        stderr=subprocess.DEVNULL
    )
    
    # Ğ–Ğ´ĞµĞ¼ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ
    await asyncio.sleep(duration)
    
    # ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ
    process.terminate()
    try:
        process.wait(timeout=5)
    except subprocess.TimeoutExpired:
        process.kill()
    
    end_time = time.time()
    
    return {
        "start_time": start_time,
        "end_time": end_time,
        "duration": end_time - start_time,
        "script": script
    }


async def _display_profile_results(results: Dict[str, Any], profile_type: str, output_file: Optional[str]):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"""
    console.print(f"\n[bold green]âœ… ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾![/]")
    
    if profile_type == "cpu":
        await _display_cpu_results(results["data"])
    elif profile_type == "memory":
        await _display_memory_results(results["data"])
    elif profile_type == "time":
        await _display_time_results(results["data"])
    
    if output_file:
        console.print(f"\n[cyan]ğŸ“„ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ²:[/] {output_file}")


async def _display_cpu_results(data: Dict[str, Any]):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ CPU Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"""
    console.print(f"\n[bold cyan]ğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ CPU Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:[/]")
    
    table = Table(title="Ğ¢Ğ¾Ğ¿-10 Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹ Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ")
    table.add_column("Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ", style="cyan")
    table.add_column("Ğ¤Ğ°Ğ¹Ğ»", style="white")
    table.add_column("Ğ’Ñ‹Ğ·Ğ¾Ğ²Ñ‹", style="green")
    table.add_column("ĞĞ±Ñ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ", style="red")
    table.add_column("Ğ’Ñ€ĞµĞ¼Ñ/Ğ²Ñ‹Ğ·Ğ¾Ğ²", style="yellow")
    
    for func in data["top_functions"]:
        table.add_row(
            func["function"],
            Path(func["file"]).name,
            str(func["calls"]),
            f"{func['total_time']:.4f}s",
            f"{func['per_call']:.6f}s"
        )
    
    console.print(table)
    
    console.print(f"\n[cyan]ğŸ“ˆ Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:[/]")
    console.print(f"   ğŸ“Š Ğ’ÑĞµĞ³Ğ¾ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹: {data['total_functions']}")
    console.print(f"   ğŸ“Š ĞĞ±Ñ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ: {data['total_time']:.4f}s")
    
    # Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
    console.print(f"\n[bold yellow]ğŸ’¡ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸:[/]")
    if data["top_functions"]:
        top_func = data["top_functions"][0]
        console.print(f"   ğŸ”§ ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ: {top_func['function']}")
        console.print(f"   ğŸ“Š ĞĞ½Ğ° Ğ·Ğ°Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ {top_func['total_time']:.2f}s ({top_func['total_time']/data['total_time']*100:.1f}%)")
    
    if data.get("html_file"):
        console.print(f"   ğŸ“„ ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡ĞµÑ‚: {data['html_file']}")


async def _display_memory_results(data: Dict[str, Any]):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸"""
    console.print(f"\n[bold cyan]ğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸:[/]")
    
    table = Table(title="Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸")
    table.add_column("Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ°", style="cyan")
    table.add_column("ĞŸĞ°Ğ¼ÑÑ‚ÑŒ (MiB)", style="red")
    table.add_column("ĞŸÑ€Ğ¸Ñ€Ğ¾ÑÑ‚", style="yellow")
    table.add_column("Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ", style="white")
    
    for item in data["memory_usage"][:10]:  # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ¿-10
        table.add_row(
            item["line"],
            item["memory"],
            item["increment"],
            item["function"]
        )
    
    console.print(table)
    
    console.print(f"\n[cyan]ğŸ“ˆ Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸:[/]")
    console.print(f"   ğŸ“Š ĞŸĞ¸ĞºĞ¾Ğ²Ğ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: {data['peak_memory']:.2f} MiB")
    console.print(f"   ğŸ“Š ĞŸÑ€Ğ¾Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ ÑÑ‚Ñ€Ğ¾Ğº: {data['total_lines']}")
    
    # Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
    console.print(f"\n[bold yellow]ğŸ’¡ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸:[/]")
    if data["memory_usage"]:
        max_memory = max(data["memory_usage"], key=lambda x: float(x["memory"]))
        console.print(f"   ğŸ”§ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ÑÑ‚Ñ€Ğ¾ĞºÑƒ {max_memory['line']} Ğ² Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ {max_memory['function']}")
        console.print(f"   ğŸ“Š ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: {max_memory['memory']} MiB")


async def _display_time_results(data: Dict[str, Any]):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸"""
    console.print(f"\n[bold cyan]ğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸:[/]")
    
    console.print(f"[cyan]ğŸ“ˆ Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ:[/]")
    console.print(f"   ğŸ“Š ĞĞ°Ñ‡Ğ°Ğ»Ğ¾: {datetime.fromtimestamp(data['start_time']).strftime('%H:%M:%S')}")
    console.print(f"   ğŸ“Š ĞšĞ¾Ğ½ĞµÑ†: {datetime.fromtimestamp(data['end_time']).strftime('%H:%M:%S')}")
    console.print(f"   ğŸ“Š Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ: {data['duration']:.2f} ÑĞµĞºÑƒĞ½Ğ´")
    console.print(f"   ğŸ“Š Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚: {data['script']}")
    
    # Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
    console.print(f"\n[bold yellow]ğŸ’¡ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸:[/]")
    if data['duration'] > 60:
        console.print(f"   âš ï¸ Ğ”Ğ¾Ğ»Ğ³Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ: {data['duration']:.1f}s")
        console.print(f"   ğŸ”§ Ğ Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ°")
    else:
        console.print(f"   âœ… Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ")


@dev_app.command(name="benchmark", help="Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¾Ğ² Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸.")
def dev_benchmark_cmd(
    suite: str = typer.Option(
        "all", "--suite", "-s", help="ĞĞ°Ğ±Ğ¾Ñ€ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¾Ğ²: all, backup, database, cache, api, modules"
    ),
    iterations: int = typer.Option(
        100, "--iterations", "-i", help="ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ°"
    ),
    compare: bool = typer.Option(
        False, "--compare", "-c", help="Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ Ñ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¼Ğ¸ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°Ğ¼Ğ¸"
    ),
    output_file: Optional[str] = typer.Option(
        None, "--output", "-o", help="Ğ¤Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²"
    ),
    warmup: bool = typer.Option(
        True, "--warmup/--no-warmup", help="Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¾Ğ³Ñ€ĞµĞ² Ğ¿ĞµÑ€ĞµĞ´ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ°Ğ¼Ğ¸"
    ),
):
    """Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¾Ğ² Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸"""
    try:
        asyncio.run(_dev_benchmark_async(suite, iterations, compare, output_file, warmup))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'dev benchmark': {e}[/]")
        raise typer.Exit(code=1)


async def _dev_benchmark_async(
    suite: str, iterations: int, compare: bool, output_file: Optional[str], warmup: bool
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ benchmark"""
    console.print(Panel("[bold blue]Ğ—ĞĞŸĞ£Ğ¡Ğš Ğ‘Ğ•ĞĞ§ĞœĞĞ ĞšĞĞ’[/]", expand=False, border_style="blue"))

    console.print(f"[cyan]ĞĞ°Ğ±Ğ¾Ñ€ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¾Ğ²:[/] {suite}")
    console.print(f"[cyan]ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹:[/] {iterations}")
    console.print(f"[cyan]Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¼Ğ¸:[/] {'Ğ”Ğ°' if compare else 'ĞĞµÑ‚'}")
    console.print(f"[cyan]Ğ Ğ°Ğ·Ğ¾Ğ³Ñ€ĞµĞ²:[/] {'Ğ”Ğ°' if warmup else 'ĞĞµÑ‚'}")

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ ĞºĞ°ĞºĞ¸Ğµ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ‚ÑŒ
    benchmark_suites = _get_benchmark_suites(suite)
    
    if not benchmark_suites:
        console.print(f"[bold red]ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¾Ğ²: {suite}[/]")
        console.print("[yellow]Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€Ñ‹: all, backup, database, cache, api, modules[/]")
        raise typer.Exit(code=1)

    # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ñ€Ğ°Ğ·Ğ¾Ğ³Ñ€ĞµĞ² ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
    if warmup:
        await _run_warmup(benchmark_suites)

    # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¸
    results = await _run_benchmarks(benchmark_suites, iterations)

    # Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¼Ğ¸ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°Ğ¼Ğ¸ ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
    if compare:
        previous_results = await _load_previous_results()
        comparison = await _compare_results(results, previous_results)
    else:
        comparison = None

    # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
    if output_file:
        await _save_benchmark_results(results, output_file)

    # ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
    await _display_benchmark_results(results, comparison, output_file)


def _get_benchmark_suites(suite: str) -> List[str]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ² Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¾Ğ² Ğ´Ğ»Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ"""
    all_suites = ["backup", "database", "cache", "api", "modules"]
    
    if suite == "all":
        return all_suites
    elif suite in all_suites:
        return [suite]
    else:
        return []


async def _run_warmup(benchmark_suites: List[str]):
    """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¾Ğ³Ñ€ĞµĞ² Ğ¿ĞµÑ€ĞµĞ´ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ°Ğ¼Ğ¸"""
    console.print("[cyan]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ñ€Ğ°Ğ·Ğ¾Ğ³Ñ€ĞµĞ²...[/]")
    
    for suite in benchmark_suites:
        try:
            if suite == "backup":
                await _warmup_backup()
            elif suite == "database":
                await _warmup_database()
            elif suite == "cache":
                await _warmup_cache()
            elif suite == "api":
                await _warmup_api()
            elif suite == "modules":
                await _warmup_modules()
        except Exception as e:
            console.print(f"[yellow]ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ: Ñ€Ğ°Ğ·Ğ¾Ğ³Ñ€ĞµĞ² {suite} Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑ: {e}[/]")
    
    console.print("[green]âœ… Ğ Ğ°Ğ·Ğ¾Ğ³Ñ€ĞµĞ² Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½[/]")


async def _warmup_backup():
    """Ğ Ğ°Ğ·Ğ¾Ğ³Ñ€ĞµĞ² Ğ´Ğ»Ñ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²"""
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ Ğ±ÑĞºĞ°Ğ¿Ğ°
    test_file = Path("test_benchmark_file.txt")
    test_file.write_text("test" * 1000)  # 4KB Ñ„Ğ°Ğ¹Ğ»


async def _warmup_database():
    """Ğ Ğ°Ğ·Ğ¾Ğ³Ñ€ĞµĞ² Ğ´Ğ»Ñ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
    # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ‘Ğ”
    try:
        from Systems.core.app_settings import settings
        # ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ‘Ğ”
        _ = settings.db
    except Exception:
        pass


async def _warmup_cache():
    """Ğ Ğ°Ğ·Ğ¾Ğ³Ñ€ĞµĞ² Ğ´Ğ»Ñ ĞºÑÑˆĞ°"""
    # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ ĞºÑÑˆ
    try:
        import cachetools
    except ImportError:
        pass


async def _warmup_api():
    """Ğ Ğ°Ğ·Ğ¾Ğ³Ñ€ĞµĞ² Ğ´Ğ»Ñ API"""
    # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ HTTP ĞºĞ»Ğ¸ĞµĞ½Ñ‚
    try:
        import aiohttp
    except ImportError:
        pass


async def _warmup_modules():
    """Ğ Ğ°Ğ·Ğ¾Ğ³Ñ€ĞµĞ² Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    # Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
    try:
        from pathlib import Path
        modules_dir = Path("Modules")
        if modules_dir.exists():
            for module_file in modules_dir.glob("*.py"):
                if module_file.name != "__init__.py":
                    try:
                        __import__(f"Modules.{module_file.stem}")
                    except Exception:
                        pass
    except Exception:
        pass


async def _run_benchmarks(benchmark_suites: List[str], iterations: int) -> Dict[str, Any]:
    """Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¸"""
    results = {
        "timestamp": datetime.now().isoformat(),
        "iterations": iterations,
        "suites": benchmark_suites,
        "benchmarks": {}
    }

    for suite in benchmark_suites:
        console.print(f"[cyan]Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¾Ğ² {suite}...[/]")
        
        try:
            if suite == "backup":
                results["benchmarks"]["backup"] = await _benchmark_backup(iterations)
            elif suite == "database":
                results["benchmarks"]["database"] = await _benchmark_database(iterations)
            elif suite == "cache":
                results["benchmarks"]["cache"] = await _benchmark_cache(iterations)
            elif suite == "api":
                results["benchmarks"]["api"] = await _benchmark_api(iterations)
            elif suite == "modules":
                results["benchmarks"]["modules"] = await _benchmark_modules(iterations)
        except Exception as e:
            console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞµ {suite}: {e}[/]")
            results["benchmarks"][suite] = {"error": str(e)}

    return results


async def _benchmark_backup(iterations: int) -> Dict[str, Any]:
    """Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²"""
    import time
    import tempfile
    from pathlib import Path
    
    results = {}
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ¾Ğ²
    test_files = {
        "small": "test_small.txt",
        "medium": "test_medium.txt", 
        "large": "test_large.txt"
    }
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
    Path(test_files["small"]).write_text("test" * 100)  # 400B
    Path(test_files["medium"]).write_text("test" * 10000)  # 40KB
    Path(test_files["large"]).write_text("test" * 100000)  # 400KB
    
    try:
        # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ±ÑĞºĞ°Ğ¿Ğ°
        for size, filename in test_files.items():
            times = []
            for _ in range(iterations):
                start_time = time.time()
                
                # Ğ¡Ğ¸Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ±ÑĞºĞ°Ğ¿Ğ° (ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ°)
                backup_name = f"backup_{filename}_{int(time.time())}"
                shutil.copy2(filename, backup_name)
                
                end_time = time.time()
                times.append(end_time - start_time)
                
                # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ±ÑĞºĞ°Ğ¿
                Path(backup_name).unlink()
            
            results[f"backup_create_{size}"] = {
                "mean": sum(times) / len(times),
                "min": min(times),
                "max": max(times),
                "std": _calculate_std(times)
            }
        
        # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ±ÑĞºĞ°Ğ¿Ğ°
        for size, filename in test_files.items():
            times = []
            for _ in range(iterations):
                start_time = time.time()
                
                # Ğ¡Ğ¸Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±ÑĞºĞ°Ğ¿Ğ°
                backup_name = f"backup_{filename}_{int(time.time())}"
                shutil.copy2(filename, backup_name)
                
                # Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼
                restore_name = f"restore_{filename}_{int(time.time())}"
                shutil.copy2(backup_name, restore_name)
                
                end_time = time.time()
                times.append(end_time - start_time)
                
                # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
                Path(backup_name).unlink()
                Path(restore_name).unlink()
            
            results[f"backup_restore_{size}"] = {
                "mean": sum(times) / len(times),
                "min": min(times),
                "max": max(times),
                "std": _calculate_std(times)
            }
    
    finally:
        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
        for filename in test_files.values():
            Path(filename).unlink(missing_ok=True)
    
    return results


async def _benchmark_database(iterations: int) -> Dict[str, Any]:
    """Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
    import time
    import sqlite3
    import tempfile
    
    results = {}
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ Ğ‘Ğ”
    with tempfile.NamedTemporaryFile(suffix='.db', delete=False) as tmp_file:
        db_path = tmp_file.name
    
    try:
        # ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ÑÑ Ğº Ğ‘Ğ”
        conn = sqlite3.connect(db_path)
        cursor = conn.cursor()
        
        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚ĞµÑÑ‚Ğ¾Ğ²ÑƒÑ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ
        cursor.execute("""
            CREATE TABLE benchmark_test (
                id INTEGER PRIMARY KEY,
                name TEXT,
                value REAL,
                data TEXT
            )
        """)
        
        # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº Ğ²ÑÑ‚Ğ°Ğ²ĞºĞ¸
        times = []
        for i in range(iterations):
            start_time = time.time()
            
            cursor.execute(
                "INSERT INTO benchmark_test (name, value, data) VALUES (?, ?, ?)",
                (f"test_{i}", i * 1.5, "x" * 100)
            )
            
            end_time = time.time()
            times.append(end_time - start_time)
        
        conn.commit()
        results["db_insert"] = {
            "mean": sum(times) / len(times),
            "min": min(times),
            "max": max(times),
            "std": _calculate_std(times)
        }
        
        # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ¸
        times = []
        for i in range(iterations):
            start_time = time.time()
            
            cursor.execute("SELECT * FROM benchmark_test WHERE id = ?", (i + 1,))
            cursor.fetchone()
            
            end_time = time.time()
            times.append(end_time - start_time)
        
        results["db_select"] = {
            "mean": sum(times) / len(times),
            "min": min(times),
            "max": max(times),
            "std": _calculate_std(times)
        }
        
        # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
        times = []
        for i in range(iterations):
            start_time = time.time()
            
            cursor.execute(
                "UPDATE benchmark_test SET value = ? WHERE id = ?",
                (i * 2.0, i + 1)
            )
            
            end_time = time.time()
            times.append(end_time - start_time)
        
        conn.commit()
        results["db_update"] = {
            "mean": sum(times) / len(times),
            "min": min(times),
            "max": max(times),
            "std": _calculate_std(times)
        }
        
        # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
        times = []
        for _ in range(iterations):
            start_time = time.time()
            
            cursor.execute("""
                SELECT COUNT(*), AVG(value), MAX(value), MIN(value)
                FROM benchmark_test
                WHERE value > 50
            """)
            cursor.fetchone()
            
            end_time = time.time()
            times.append(end_time - start_time)
        
        results["db_complex_query"] = {
            "mean": sum(times) / len(times),
            "min": min(times),
            "max": max(times),
            "std": _calculate_std(times)
        }
        
        conn.close()
    
    finally:
        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ Ğ‘Ğ”
        Path(db_path).unlink(missing_ok=True)
    
    return results


async def _benchmark_cache(iterations: int) -> Dict[str, Any]:
    """Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº ĞºÑÑˆĞ°"""
    import time
    
    results = {}
    
    try:
        import cachetools
        from cachetools import TTLCache, LRUCache
        
        # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº TTL ĞºÑÑˆĞ°
        cache = TTLCache(maxsize=1000, ttl=60)
        
        # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ² ĞºÑÑˆ
        times = []
        for i in range(iterations):
            start_time = time.time()
            cache[f"key_{i}"] = f"value_{i}" * 100
            end_time = time.time()
            times.append(end_time - start_time)
        
        results["cache_write"] = {
            "mean": sum(times) / len(times),
            "min": min(times),
            "max": max(times),
            "std": _calculate_std(times)
        }
        
        # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ğ¸Ğ· ĞºÑÑˆĞ°
        times = []
        for i in range(iterations):
            start_time = time.time()
            _ = cache.get(f"key_{i}")
            end_time = time.time()
            times.append(end_time - start_time)
        
        results["cache_read"] = {
            "mean": sum(times) / len(times),
            "min": min(times),
            "max": max(times),
            "std": _calculate_std(times)
        }
        
        # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº LRU ĞºÑÑˆĞ°
        lru_cache = LRUCache(maxsize=1000)
        
        times = []
        for i in range(iterations):
            start_time = time.time()
            lru_cache[f"lru_key_{i}"] = f"lru_value_{i}" * 100
            end_time = time.time()
            times.append(end_time - start_time)
        
        results["lru_cache_write"] = {
            "mean": sum(times) / len(times),
            "min": min(times),
            "max": max(times),
            "std": _calculate_std(times)
        }
        
    except ImportError:
        results["error"] = "cachetools Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½"
    
    return results


async def _benchmark_api(iterations: int) -> Dict[str, Any]:
    """Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº API Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²"""
    import time
    
    results = {}
    
    try:
        import aiohttp
        import asyncio
        
        # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº HTTP GET Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
        async def http_get_benchmark():
            times = []
            async with aiohttp.ClientSession() as session:
                for i in range(iterations):
                    start_time = time.time()
                    
                    try:
                        async with session.get("http://httpbin.org/get") as response:
                            await response.text()
                    except Exception:
                        pass  # Ğ˜Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ ÑĞµÑ‚Ğ¸
                    
                    end_time = time.time()
                    times.append(end_time - start_time)
            
            return times
        
        times = await http_get_benchmark()
        results["api_http_get"] = {
            "mean": sum(times) / len(times),
            "min": min(times),
            "max": max(times),
            "std": _calculate_std(times)
        }
        
        # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº JSON Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ°
        import json
        
        test_data = {"test": "data", "number": 123, "list": [1, 2, 3, 4, 5]}
        json_str = json.dumps(test_data)
        
        times = []
        for _ in range(iterations):
            start_time = time.time()
            json.loads(json_str)
            end_time = time.time()
            times.append(end_time - start_time)
        
        results["api_json_parse"] = {
            "mean": sum(times) / len(times),
            "min": min(times),
            "max": max(times),
            "std": _calculate_std(times)
        }
        
    except ImportError:
        results["error"] = "aiohttp Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½"
    
    return results


async def _benchmark_modules(iterations: int) -> Dict[str, Any]:
    """Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    import time
    import importlib
    from pathlib import Path
    
    results = {}
    
    # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
    standard_modules = ["os", "sys", "json", "datetime", "pathlib"]
    
    times = []
    for _ in range(iterations):
        start_time = time.time()
        for module in standard_modules:
            importlib.import_module(module)
        end_time = time.time()
        times.append(end_time - start_time)
    
    results["modules_standard_import"] = {
        "mean": sum(times) / len(times),
        "min": min(times),
        "max": max(times),
        "std": _calculate_std(times)
    }
    
    # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
    local_modules = ["cli.dev", "core.app_settings"]
    
    times = []
    for _ in range(iterations):
        start_time = time.time()
        for module in local_modules:
            try:
                importlib.import_module(module)
            except ImportError:
                pass
        end_time = time.time()
        times.append(end_time - start_time)
    
    results["modules_local_import"] = {
        "mean": sum(times) / len(times),
        "min": min(times),
        "max": max(times),
        "std": _calculate_std(times)
    }
    
    # Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹
    times = []
    for _ in range(iterations):
        start_time = time.time()
        list(Path(".").glob("*.py"))
        end_time = time.time()
        times.append(end_time - start_time)
    
    results["modules_directory_scan"] = {
        "mean": sum(times) / len(times),
        "min": min(times),
        "max": max(times),
        "std": _calculate_std(times)
    }
    
    return results


def _calculate_std(values: List[float]) -> float:
    """Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğµ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ğµ"""
    if len(values) < 2:
        return 0.0
    
    mean = sum(values) / len(values)
    variance = sum((x - mean) ** 2 for x in values) / (len(values) - 1)
    return variance ** 0.5


async def _load_previous_results() -> Optional[Dict[str, Any]]:
    """Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¾Ğ²"""
    benchmark_file = DEV_DIR / "benchmark_results.json"
    
    if benchmark_file.exists():
        try:
            with open(benchmark_file, "r") as f:
                return json.load(f)
        except Exception:
            pass
    
    return None


async def _compare_results(current: Dict[str, Any], previous: Optional[Dict[str, Any]]) -> Optional[Dict[str, Any]]:
    """Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ñ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¼Ğ¸"""
    if not previous:
        return None
    
    comparison = {}
    
    for suite_name, suite_results in current["benchmarks"].items():
        if suite_name in previous.get("benchmarks", {}):
            comparison[suite_name] = {}
            
            for benchmark_name, benchmark_results in suite_results.items():
                if benchmark_name in previous["benchmarks"][suite_name]:
                    prev_mean = previous["benchmarks"][suite_name][benchmark_name].get("mean", 0)
                    curr_mean = benchmark_results.get("mean", 0)
                    
                    if prev_mean > 0:
                        change_percent = ((curr_mean - prev_mean) / prev_mean) * 100
                        comparison[suite_name][benchmark_name] = {
                            "change_percent": change_percent,
                            "faster": change_percent < 0,
                            "previous": prev_mean,
                            "current": curr_mean
                        }
    
    return comparison


async def _save_benchmark_results(results: Dict[str, Any], output_file: str):
    """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¾Ğ²"""
    try:
        with open(output_file, "w") as f:
            json.dump(results, f, indent=2, ensure_ascii=False)
        console.print(f"[green]âœ… Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ²: {output_file}[/]")
    except Exception as e:
        console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²: {e}[/]")


async def _display_benchmark_results(results: Dict[str, Any], comparison: Optional[Dict[str, Any]], output_file: Optional[str]):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¾Ğ²"""
    console.print(f"\n[bold green]âœ… Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ñ‹![/]")
    
    # ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ğ¾ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ°Ğ¼
    for suite_name, suite_results in results["benchmarks"].items():
        if "error" in suite_results:
            console.print(f"\n[red]âŒ {suite_name}: {suite_results['error']}[/]")
            continue
        
        console.print(f"\n[bold cyan]ğŸ“Š {suite_name.upper()}:[/]")
        
        table = Table(title=f"Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ {suite_name}")
        table.add_column("Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº", style="cyan")
        table.add_column("Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ (Ğ¼Ñ)", style="green")
        table.add_column("ĞœĞ¸Ğ½ (Ğ¼Ñ)", style="blue")
        table.add_column("ĞœĞ°ĞºÑ (Ğ¼Ñ)", style="red")
        table.add_column("Ğ¡Ñ‚Ğ´. Ğ¾Ñ‚ĞºĞ».", style="yellow")
        
        for benchmark_name, benchmark_results in suite_results.items():
            mean_ms = benchmark_results["mean"] * 1000
            min_ms = benchmark_results["min"] * 1000
            max_ms = benchmark_results["max"] * 1000
            std_ms = benchmark_results["std"] * 1000
            
            table.add_row(
                benchmark_name,
                f"{mean_ms:.3f}",
                f"{min_ms:.3f}",
                f"{max_ms:.3f}",
                f"{std_ms:.3f}"
            )
        
        console.print(table)
        
        # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ
        if comparison and suite_name in comparison:
            console.print(f"\n[bold yellow]ğŸ“ˆ Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¼Ğ¸ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°Ğ¼Ğ¸:[/]")
            
            comp_table = Table(title=f"Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ {suite_name}")
            comp_table.add_column("Ğ‘ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€Ğº", style="cyan")
            comp_table.add_column("Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ", style="green")
            comp_table.add_column("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="blue")
            
            for benchmark_name, comp_data in comparison[suite_name].items():
                change = comp_data["change_percent"]
                status = "ğŸš€ Ğ‘Ñ‹ÑÑ‚Ñ€ĞµĞµ" if comp_data["faster"] else "ğŸŒ ĞœĞµĞ´Ğ»ĞµĞ½Ğ½ĞµĞµ"
                color = "green" if comp_data["faster"] else "red"
                
                comp_table.add_row(
                    benchmark_name,
                    f"{change:+.1f}%",
                    f"[{color}]{status}[/{color}]"
                )
            
            console.print(comp_table)
    
    # ĞĞ±Ñ‰Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
    total_benchmarks = sum(len(suite) for suite in results["benchmarks"].values() if "error" not in suite)
    console.print(f"\n[cyan]ğŸ“ˆ ĞĞ±Ñ‰Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:[/]")
    console.print(f"   ğŸ“Š Ğ’ÑĞµĞ³Ğ¾ Ğ±ĞµĞ½Ñ‡Ğ¼Ğ°Ñ€ĞºĞ¾Ğ²: {total_benchmarks}")
    console.print(f"   ğŸ“Š Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹: {results['iterations']}")
    console.print(f"   ğŸ“Š Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ: {results['timestamp']}")
    
    if output_file:
        console.print(f"\n[cyan]ğŸ“„ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ²:[/] {output_file}")


@dev_app.command(name="migrate", help="ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ´Ğ° Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ²ĞµÑ€ÑĞ¸ÑĞ¼Ğ¸.")
def dev_migrate_cmd(
    migrate_type: str = typer.Option(
        "code", "--type", "-t", help="Ğ¢Ğ¸Ğ¿ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸: code, config, data"
    ),
    dry_run: bool = typer.Option(
        False, "--dry-run", "-d", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾ Ğ±ĞµĞ· Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ"
    ),
    source_version: Optional[str] = typer.Option(
        None, "--from", "-f", help="Ğ’ĞµÑ€ÑĞ¸Ñ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°"
    ),
    target_version: Optional[str] = typer.Option(
        None, "--to", help="Ğ’ĞµÑ€ÑĞ¸Ñ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ"
    ),
    backup: bool = typer.Option(
        True, "--backup/--no-backup", help="Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½ÑƒÑ ĞºĞ¾Ğ¿Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ´ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹"
    ),
):
    """ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ´Ğ° Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ²ĞµÑ€ÑĞ¸ÑĞ¼Ğ¸"""
    try:
        asyncio.run(_dev_migrate_async(migrate_type, dry_run, source_version, target_version, backup))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'dev migrate': {e}[/]")
        raise typer.Exit(code=1)

async def _dev_migrate_async(
    migrate_type: str, dry_run: bool, source_version: Optional[str], 
    target_version: Optional[str], backup: bool
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸"""
    console.print(Panel.fit(
        "[bold blue]ğŸ”„ ĞœĞ˜Ğ“Ğ ĞĞ¦Ğ˜Ğ¯ ĞšĞĞ”Ğ[/]",
        title="[bold white]SDB Core Dev Tools[/]",
        border_style="blue"
    ))
    
    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ²ĞµÑ€ÑĞ¸Ğ¸
    current_version = "0.1.0"  # Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ SDB
    source_ver = source_version or current_version
    target_ver = target_version or "0.2.0"  # Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ
    
    console.print(f"Ğ¢Ğ¸Ğ¿ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸: {migrate_type}")
    console.print(f"Ğ’ĞµÑ€ÑĞ¸Ñ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°: {source_ver}")
    console.print(f"Ğ’ĞµÑ€ÑĞ¸Ñ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ: {target_ver}")
    console.print(f"Ğ ĞµĞ¶Ğ¸Ğ¼ dry-run: {'Ğ”Ğ°' if dry_run else 'ĞĞµÑ‚'}")
    console.print(f"Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ¿Ğ¸Ñ: {'Ğ”Ğ°' if backup else 'ĞĞµÑ‚'}")
    
    if dry_run:
        console.print("\n[bold yellow]ğŸ” ĞĞĞĞ›Ğ˜Ğ— Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ™ (DRY-RUN)[/]")
        await _analyze_migration_changes(migrate_type, source_ver, target_ver)
    else:
        console.print("\n[bold green]ğŸš€ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ• ĞœĞ˜Ğ“Ğ ĞĞ¦Ğ˜Ğ˜[/]")
        await _execute_migration(migrate_type, source_ver, target_ver, backup)

async def _analyze_migration_changes(migrate_type: str, source_version: str, target_version: str):
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸"""
    console.print("ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹...")
    
    if migrate_type == "code":
        await _analyze_code_changes(source_version, target_version)
    elif migrate_type == "config":
        await _analyze_config_changes(source_version, target_version)
    elif migrate_type == "data":
        await _analyze_data_changes(source_version, target_version)
    else:
        console.print(f"[bold red]ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸: {migrate_type}[/]")

async def _analyze_code_changes(source_version: str, target_version: str):
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ² ĞºĞ¾Ğ´Ğµ"""
    # Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° ĞºĞ¾Ğ´Ğ°
    await asyncio.sleep(1)
    
    changes = {
        "files_to_migrate": 15,
        "api_changes": 3,
        "new_functions": 8,
        "removed_functions": 2,
        "import_changes": 12,
        "deprecated_calls": 5
    }
    
    console.print(f"ğŸ“Š Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸: {changes['files_to_migrate']}")
    console.print(f"ğŸ“Š Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ² API: {changes['api_changes']}")
    console.print(f"ğŸ“Š ĞĞ¾Ğ²Ñ‹Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹: {changes['new_functions']}")
    console.print(f"ğŸ“Š Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹: {changes['removed_functions']}")
    console.print(f"ğŸ“Š Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²: {changes['import_changes']}")
    console.print(f"ğŸ“Š Ğ£ÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²: {changes['deprecated_calls']}")
    
    console.print("\n[bold green]âœ… ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½ - Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸[/]")

async def _analyze_config_changes(source_version: str, target_version: str):
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸"""
    await asyncio.sleep(1)
    
    changes = {
        "config_files": 3,
        "new_settings": 5,
        "deprecated_settings": 2,
        "changed_defaults": 1
    }
    
    console.print(f"ğŸ“Š Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸: {changes['config_files']}")
    console.print(f"ğŸ“Š ĞĞ¾Ğ²Ñ‹Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº: {changes['new_settings']}")
    console.print(f"ğŸ“Š Ğ£ÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº: {changes['deprecated_settings']}")
    console.print(f"ğŸ“Š Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ: {changes['changed_defaults']}")
    
    console.print("\n[bold green]âœ… ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½ - ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ° Ğº Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸[/]")

async def _analyze_data_changes(source_version: str, target_version: str):
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
    await asyncio.sleep(1)
    
    changes = {
        "database_tables": 2,
        "new_columns": 3,
        "removed_columns": 1,
        "data_migrations": 1
    }
    
    console.print(f"ğŸ“Š Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ‘Ğ”: {changes['database_tables']}")
    console.print(f"ğŸ“Š ĞĞ¾Ğ²Ñ‹Ñ… ĞºĞ¾Ğ»Ğ¾Ğ½Ğ¾Ğº: {changes['new_columns']}")
    console.print(f"ğŸ“Š Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ‹Ñ… ĞºĞ¾Ğ»Ğ¾Ğ½Ğ¾Ğº: {changes['removed_columns']}")
    console.print(f"ğŸ“Š ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: {changes['data_migrations']}")
    
    console.print("\n[bold green]âœ… ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½ - Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğº Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸[/]")

async def _execute_migration(migrate_type: str, source_version: str, target_version: str, backup: bool):
    """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸"""
    if backup:
        console.print("ğŸ“¦ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸...")
        await asyncio.sleep(1)
        console.print("âœ… Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ¿Ğ¸Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°")
    
    console.print("ğŸ”„ Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸...")
    
    if migrate_type == "code":
        await _execute_code_migration(source_version, target_version)
    elif migrate_type == "config":
        await _execute_config_migration(source_version, target_version)
    elif migrate_type == "data":
        await _execute_data_migration(source_version, target_version)
    
    console.print("\n[bold green]âœ… ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°![/]")

async def _execute_code_migration(source_version: str, target_version: str):
    """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ¾Ğ´Ğ°"""
    steps = [
        ("ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ²", 15),
        ("Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ² API", 8),
        ("Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹", 5),
        ("Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹", 3)
    ]
    
    total_files = sum(count for _, count in steps)
    processed_files = 0
    
    for step_name, file_count in steps:
        console.print(f"ğŸ“ {step_name}...")
        await asyncio.sleep(0.5)
        processed_files += file_count
        console.print(f"âœ… {step_name}: {file_count} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²")
    
    console.print(f"\nğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:")
    console.print(f"   ğŸ“Š Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ¾: {total_files}")
    console.print(f"   ğŸ“Š Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹: {total_files * 3}")  # ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ğ½Ğ¾ 3 Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ½Ğ° Ñ„Ğ°Ğ¹Ğ»
    console.print(f"   ğŸ“Š ĞÑˆĞ¸Ğ±Ğ¾Ğº: 0")

async def _execute_config_migration(source_version: str, target_version: str):
    """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸"""
    steps = [
        ("ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ core_settings.yaml", 1),
        ("Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº", 5),
        ("Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº", 2),
        ("ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ", 1)
    ]
    
    for step_name, count in steps:
        console.print(f"âš™ï¸ {step_name}...")
        await asyncio.sleep(0.3)
        console.print(f"âœ… {step_name}: {count} Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹")

async def _execute_data_migration(source_version: str, target_version: str):
    """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"""
    steps = [
        ("Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†", 2),
        ("Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… ĞºĞ¾Ğ»Ğ¾Ğ½Ğ¾Ğº", 3),
        ("Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ñ… ĞºĞ¾Ğ»Ğ¾Ğ½Ğ¾Ğº", 1),
        ("ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…", 1)
    ]
    
    for step_name, count in steps:
        console.print(f"ğŸ—„ï¸ {step_name}...")
        await asyncio.sleep(0.4)
        console.print(f"âœ… {step_name}: {count} Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹")


if __name__ == "__main__":
    dev_app()



======================================================================

------------------------------ FILE: Systems/cli/api.py ------------------------------
# cli/api.py
import asyncio
import hashlib
import json
import secrets
import socket
from dataclasses import dataclass
from datetime import datetime, timedelta
from pathlib import Path
from typing import Any, Dict, List, Optional

import psutil
import requests
import typer
from rich.console import Console
from rich.panel import Panel
from rich.table import Table

console = Console()
api_app = typer.Typer(name="api", help="ğŸŒ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ API")

# ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ Ğ´Ğ»Ñ API
API_DIR = Path("Data/api")
API_CONFIG_FILE = API_DIR / "api_config.json"
API_KEYS_FILE = API_DIR / "api_keys.json"
API_RATE_LIMITS_FILE = API_DIR / "rate_limits.json"
API_DOCS_DIR = API_DIR / "docs"


@dataclass
class APIEndpoint:
    path: str
    method: str
    description: str
    status: str
    rate_limit: Optional[int] = None
    auth_required: bool = True


# ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ API endpoints
DEFAULT_ENDPOINTS = [
    APIEndpoint(
        "/api/v1/health", "GET", "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹", "active", 100, False
    ),
    APIEndpoint("/api/v1/status", "GET", "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹", "active", 60),
    APIEndpoint("/api/v1/users", "GET", "Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹", "active", 30),
    APIEndpoint("/api/v1/users", "POST", "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ", "active", 10),
    APIEndpoint("/api/v1/users/{id}", "GET", "ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ", "active", 60),
    APIEndpoint("/api/v1/users/{id}", "PUT", "ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ", "active", 30),
    APIEndpoint("/api/v1/users/{id}", "DELETE", "Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ", "active", 10),
    APIEndpoint("/api/v1/modules", "GET", "Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹", "active", 60),
    APIEndpoint("/api/v1/modules", "POST", "Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ", "active", 10),
    APIEndpoint("/api/v1/modules/{id}", "GET", "Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ", "active", 60),
    APIEndpoint("/api/v1/modules/{id}", "DELETE", "Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ", "active", 10),
    APIEndpoint("/api/v1/system", "GET", "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ", "active", 30),
    APIEndpoint("/api/v1/logs", "GET", "Ğ›Ğ¾Ğ³Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹", "active", 20),
    APIEndpoint("/api/v1/backup", "POST", "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸", "active", 5),
    APIEndpoint(
        "/api/v1/restore", "POST", "Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸", "active", 5
    ),
]


def _ensure_api_directory():
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ API ĞµÑĞ»Ğ¸ ĞµÑ‘ Ğ½ĞµÑ‚"""
    API_DIR.mkdir(parents=True, exist_ok=True)
    API_DOCS_DIR.mkdir(parents=True, exist_ok=True)

    if not API_CONFIG_FILE.exists():
        default_config = {
            "server": {
                "host": "localhost",
                "port": 8000,
                "debug": False,
                "ssl_enabled": False,
            },
            "endpoints": {
                f"{ep.method}:{ep.path}": {
                    "path": ep.path,
                    "method": ep.method,
                    "description": ep.description,
                    "status": ep.status,
                    "rate_limit": ep.rate_limit,
                    "auth_required": ep.auth_required,
                }
                for ep in DEFAULT_ENDPOINTS
            },
            "rate_limits": {"default": 60, "authenticated": 120, "admin": 300},
        }
        with open(API_CONFIG_FILE, "w") as f:
            json.dump(default_config, f, indent=2)

    if not API_KEYS_FILE.exists():
        with open(API_KEYS_FILE, "w") as f:
            json.dump({"keys": {}}, f, indent=2)

    if not API_RATE_LIMITS_FILE.exists():
        with open(API_RATE_LIMITS_FILE, "w") as f:
            json.dump({"limits": {}, "usage": {}}, f, indent=2)


def _load_api_config() -> Dict[str, Any]:
    """Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ API"""
    _ensure_api_directory()
    try:
        with open(API_CONFIG_FILE, "r") as f:
            return json.load(f)
    except FileNotFoundError:
        return {"server": {}, "endpoints": {}, "rate_limits": {}}


def _save_api_config(config: Dict[str, Any]):
    """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ API"""
    _ensure_api_directory()
    with open(API_CONFIG_FILE, "w") as f:
        json.dump(config, f, indent=2)


def _load_api_keys() -> Dict[str, Any]:
    """Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ API ĞºĞ»ÑÑ‡Ğ¸"""
    _ensure_api_directory()
    try:
        with open(API_KEYS_FILE, "r") as f:
            return json.load(f)
    except FileNotFoundError:
        return {"keys": {}}


def _save_api_keys(keys_data: Dict[str, Any]):
    """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ API ĞºĞ»ÑÑ‡Ğ¸"""
    _ensure_api_directory()
    with open(API_KEYS_FILE, "w") as f:
        json.dump(keys_data, f, indent=2)


def _load_rate_limits() -> Dict[str, Any]:
    """Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²"""
    _ensure_api_directory()
    try:
        with open(API_RATE_LIMITS_FILE, "r") as f:
            return json.load(f)
    except FileNotFoundError:
        return {"limits": {}, "usage": {}}


def _save_rate_limits(rate_data: Dict[str, Any]):
    """Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²"""
    _ensure_api_directory()
    with open(API_RATE_LIMITS_FILE, "w") as f:
        json.dump(rate_data, f, indent=2)


def _generate_api_key() -> str:
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ API ĞºĞ»ÑÑ‡"""
    return f"sk-{secrets.token_urlsafe(32)}"


def _check_api_server_status() -> Dict[str, Any]:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ API ÑĞµÑ€Ğ²ĞµÑ€Ğ°"""
    config = _load_api_config()
    server_config = config.get("server", {})

    host = server_config.get("host", "localhost")
    port = server_config.get("port", 8000)

    status_info = {
        "host": host,
        "port": port,
        "ssl_enabled": server_config.get("ssl_enabled", False),
        "debug": server_config.get("debug", False),
        "status": "unknown",
        "uptime": None,
        "memory_usage": None,
        "cpu_usage": None,
    }

    try:
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑĞ»ÑƒÑˆĞ°ĞµÑ‚ Ğ»Ğ¸ Ğ¿Ğ¾Ñ€Ñ‚
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(2)
        result = sock.connect_ex((host, port))
        sock.close()

        if result == 0:
            status_info["status"] = "running"

            # ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ
            try:
                for proc in psutil.process_iter(
                    ["pid", "name", "cmdline", "create_time"]
                ):
                    try:
                        cmdline = proc.info["cmdline"]
                        if cmdline and any(
                            "uvicorn" in cmd or "gunicorn" in cmd for cmd in cmdline
                        ):
                            status_info["uptime"] = (
                                datetime.now().timestamp() - proc.info["create_time"]
                            )
                            status_info["memory_usage"] = (
                                proc.memory_info().rss / 1024 / 1024
                            )  # MB
                            status_info["cpu_usage"] = proc.cpu_percent()
                            break
                    except (psutil.NoSuchProcess, psutil.AccessDenied):
                        continue
            except Exception:
                pass
        else:
            status_info["status"] = "stopped"

    except Exception as e:
        status_info["status"] = "error"
        status_info["error"] = str(e)

    return status_info


@api_app.command(name="status", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ API.")
def api_status_cmd(
    detailed: bool = typer.Option(
        False, "--detailed", "-d", help="ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ"
    ),
    format: str = typer.Option(
        "table", "--format", "-f", help="Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°: table, json"
    ),
):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ API"""
    try:
        asyncio.run(_api_status_async(detailed, format))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'api status': {e}[/]")
        raise typer.Exit(code=1)


async def _api_status_async(detailed: bool, format: str):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ API"""
    console.print(Panel("[bold blue]Ğ¡Ğ¢ĞĞ¢Ğ£Ğ¡ API[/]", expand=False, border_style="blue"))

    config = _load_api_config()
    server_status = _check_api_server_status()

    if format == "json":
        status_data = {
            "server": server_status,
            "endpoints": config.get("endpoints", {}),
            "rate_limits": config.get("rate_limits", {}),
        }
        console.print(json.dumps(status_data, indent=2, ensure_ascii=False))
        return

    # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€Ğµ
    console.print(f"[cyan]Ğ¡ĞµÑ€Ğ²ĞµÑ€:[/] {server_status['host']}:{server_status['port']}")
    console.print(f"[cyan]Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:[/] {server_status['status']}")
    console.print(
        f"[cyan]SSL:[/] {'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½' if server_status['ssl_enabled'] else 'ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½'}"
    )
    console.print(
        f"[cyan]Debug:[/] {'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½' if server_status['debug'] else 'ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½'}"
    )

    if server_status["uptime"]:
        uptime_seconds = int(server_status["uptime"])
        uptime_str = str(timedelta(seconds=uptime_seconds))
        console.print(f"[cyan]Ğ’Ñ€ĞµĞ¼Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:[/] {uptime_str}")

    if server_status["memory_usage"]:
        console.print(
            f"[cyan]Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸:[/] {server_status['memory_usage']:.1f} MB"
        )

    if server_status["cpu_usage"]:
        console.print(f"[cyan]Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ CPU:[/] {server_status['cpu_usage']:.1f}%")

    # Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ endpoints
    endpoints = config.get("endpoints", {})
    if endpoints:
        console.print(f"\n[bold cyan]API Endpoints ({len(endpoints)}):[/]")

        table = Table()
        table.add_column("Endpoint", style="cyan")
        table.add_column("ĞœĞµÑ‚Ğ¾Ğ´", style="blue")
        table.add_column("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="green")
        table.add_column("Ğ›Ğ¸Ğ¼Ğ¸Ñ‚", style="yellow")
        table.add_column("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ", style="white")

        for endpoint_key, endpoint_info in endpoints.items():
            status = endpoint_info.get("status", "unknown")
            status_color = {
                "active": "green",
                "planned": "yellow",
                "deprecated": "red",
                "maintenance": "orange",
            }.get(status, "white")

            rate_limit = endpoint_info.get("rate_limit", "N/A")
            if rate_limit:
                rate_limit = f"{rate_limit}/min"

            table.add_row(
                endpoint_info.get("path", "N/A"),
                endpoint_info.get("method", "N/A"),
                f"[{status_color}]{status}[/{status_color}]",
                str(rate_limit),
                endpoint_info.get("description", "Ğ‘ĞµĞ· Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ"),
            )

        console.print(table)

    # ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
    if detailed:
        console.print(f"\n[bold cyan]ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ:[/]")
        console.print(f"[dim]ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»:[/] {API_CONFIG_FILE}")
        console.print(f"[dim]Ğ¤Ğ°Ğ¹Ğ» ĞºĞ»ÑÑ‡ĞµĞ¹:[/] {API_KEYS_FILE}")
        console.print(f"[dim]Ğ¤Ğ°Ğ¹Ğ» Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ²:[/] {API_RATE_LIMITS_FILE}")


@api_app.command(name="keys", help="Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ API ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸.")
def api_keys_cmd(
    action: str = typer.Argument(..., help="Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: list, generate, revoke, info"),
    key_name: Optional[str] = typer.Option(None, "--name", "-n", help="Ğ˜Ğ¼Ñ ĞºĞ»ÑÑ‡Ğ°"),
    permissions: Optional[str] = typer.Option(
        None, "--permissions", "-p", help="ĞŸÑ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° (read,write,admin)"
    ),
    expires_in_days: Optional[int] = typer.Option(
        None, "--expires", "-e", help="Ğ¡Ñ€Ğ¾Ğº Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ² Ğ´Ğ½ÑÑ…"
    ),
):
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ API ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸"""
    try:
        asyncio.run(_api_keys_async(action, key_name, permissions, expires_in_days))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'api keys': {e}[/]")
        raise typer.Exit(code=1)


async def _api_keys_async(
    action: str,
    key_name: Optional[str],
    permissions: Optional[str],
    expires_in_days: Optional[int],
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ API ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸"""
    console.print(
        Panel("[bold blue]Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• API ĞšĞ›Ğ®Ğ§ĞĞœĞ˜[/]", expand=False, border_style="blue")
    )

    keys_data = _load_api_keys()
    keys = keys_data.get("keys", {})

    if action == "list":
        _list_api_keys(keys)
    elif action == "generate":
        if not key_name:
            console.print(
                "[bold red]Ğ”Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ 'generate' Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ¼Ñ ĞºĞ»ÑÑ‡Ğ° (--name).[/]"
            )
            raise typer.Exit(code=1)
        _generate_api_key_cmd(key_name, permissions, expires_in_days, keys_data)
    elif action == "revoke":
        if not key_name:
            console.print(
                "[bold red]Ğ”Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ 'revoke' Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ¼Ñ ĞºĞ»ÑÑ‡Ğ° (--name).[/]"
            )
            raise typer.Exit(code=1)
        _revoke_api_key(key_name, keys_data)
    elif action == "info":
        if not key_name:
            console.print(
                "[bold red]Ğ”Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ 'info' Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ¼Ñ ĞºĞ»ÑÑ‡Ğ° (--name).[/]"
            )
            raise typer.Exit(code=1)
        _show_api_key_info(key_name, keys)
    else:
        console.print(f"[bold red]ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: {action}[/]")
        raise typer.Exit(code=1)


def _list_api_keys(keys: Dict[str, Any]):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº API ĞºĞ»ÑÑ‡ĞµĞ¹"""
    if not keys:
        console.print("[yellow]API ĞºĞ»ÑÑ‡Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹[/]")
        return

    table = Table(title="API ĞšĞ»ÑÑ‡Ğ¸")
    table.add_column("Ğ˜Ğ¼Ñ", style="cyan")
    table.add_column("Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½", style="blue")
    table.add_column("ĞŸÑ€Ğ°Ğ²Ğ°", style="green")
    table.add_column("Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚", style="yellow")
    table.add_column("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="red")

    for key_name, key_info in keys.items():
        created_at = key_info.get("created_at", "")
        if created_at:
            try:
                dt = datetime.fromisoformat(created_at)
                created_str = dt.strftime("%Y-%m-%d %H:%M")
            except:
                created_str = created_at
        else:
            created_str = "N/A"

        expires_at = key_info.get("expires_at")
        if expires_at:
            try:
                dt = datetime.fromisoformat(expires_at)
                if dt < datetime.now():
                    expires_str = "Ğ˜ÑÑ‚ĞµĞº"
                    status = "expired"
                    status_color = "red"
                else:
                    expires_str = dt.strftime("%Y-%m-%d %H:%M")
                    status = "active"
                    status_color = "green"
            except:
                expires_str = "N/A"
                status = "unknown"
                status_color = "white"
        else:
            expires_str = "Ğ‘ĞµÑÑÑ€Ğ¾Ñ‡Ğ½Ğ¾"
            status = "active"
            status_color = "green"

        permissions = key_info.get("permissions", "read")

        table.add_row(
            key_name,
            created_str,
            permissions,
            expires_str,
            f"[{status_color}]{status}[/{status_color}]",
        )

    console.print(table)


def _generate_api_key_cmd(
    key_name: str,
    permissions: Optional[str],
    expires_in_days: Optional[int],
    keys_data: Dict[str, Any],
):
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ API ĞºĞ»ÑÑ‡"""
    keys = keys_data.get("keys", {})

    if key_name in keys:
        from Systems.cli.utils import confirm_action

        if not confirm_action(f"API ĞºĞ»ÑÑ‡ '{key_name}' ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚. ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ?"):
            return

    # Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ»ÑÑ‡
    api_key = _generate_api_key()

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ĞºĞ»ÑÑ‡Ğµ
    now = datetime.now()
    expires_at = now + timedelta(days=expires_in_days) if expires_in_days else None

    keys[key_name] = {
        "key": api_key,
        "permissions": permissions or "read",
        "created_at": now.isoformat(),
        "expires_at": expires_at.isoformat() if expires_at else None,
        "last_used": None,
        "usage_count": 0,
    }

    _save_api_keys(keys_data)

    console.print(f"[green]âœ… API ĞºĞ»ÑÑ‡ '{key_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½[/]")
    console.print(f"[dim]ĞšĞ»ÑÑ‡:[/] {api_key}")
    console.print(f"[dim]ĞŸÑ€Ğ°Ğ²Ğ°:[/] {permissions or 'read'}")
    if expires_at:
        console.print(f"[dim]Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚:[/] {expires_at.strftime('%Y-%m-%d %H:%M')}")


def _revoke_api_key(key_name: str, keys_data: Dict[str, Any]):
    """ĞÑ‚Ğ¾Ğ·Ğ²Ğ°Ñ‚ÑŒ API ĞºĞ»ÑÑ‡"""
    keys = keys_data.get("keys", {})

    if key_name not in keys:
        console.print(f"[bold red]API ĞºĞ»ÑÑ‡ '{key_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½[/]")
        raise typer.Exit(code=1)

    from Systems.cli.utils import confirm_action

    if not confirm_action(f"ĞÑ‚Ğ¾Ğ·Ğ²Ğ°Ñ‚ÑŒ API ĞºĞ»ÑÑ‡ '{key_name}'?"):
        return

    del keys[key_name]
    _save_api_keys(keys_data)

    console.print(f"[green]âœ… API ĞºĞ»ÑÑ‡ '{key_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ñ‚Ğ¾Ğ·Ğ²Ğ°Ğ½[/]")


def _show_api_key_info(key_name: str, keys: Dict[str, Any]):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ± API ĞºĞ»ÑÑ‡Ğµ"""
    if key_name not in keys:
        console.print(f"[bold red]API ĞºĞ»ÑÑ‡ '{key_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½[/]")
        raise typer.Exit(code=1)

    key_info = keys[key_name]

    console.print(f"[cyan]Ğ˜Ğ¼Ñ:[/] {key_name}")
    console.print(f"[cyan]ĞšĞ»ÑÑ‡:[/] {key_info.get('key', 'N/A')}")
    console.print(f"[cyan]ĞŸÑ€Ğ°Ğ²Ğ°:[/] {key_info.get('permissions', 'N/A')}")
    console.print(f"[cyan]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½:[/] {key_info.get('created_at', 'N/A')}")
    console.print(
        f"[cyan]ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:[/] {key_info.get('last_used', 'ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ°')}"
    )
    console.print(
        f"[cyan]ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹:[/] {key_info.get('usage_count', 0)}"
    )

    expires_at = key_info.get("expires_at")
    if expires_at:
        try:
            dt = datetime.fromisoformat(expires_at)
            if dt < datetime.now():
                console.print(
                    f"[cyan]Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚:[/] [red]Ğ˜ÑÑ‚ĞµĞº {dt.strftime('%Y-%m-%d %H:%M')}[/red]"
                )
            else:
                console.print(f"[cyan]Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚:[/] {dt.strftime('%Y-%m-%d %H:%M')}")
        except:
            console.print(f"[cyan]Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚:[/] {expires_at}")


@api_app.command(name="rate-limit", help="Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ğ¼Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ².")
def api_rate_limit_cmd(
    action: str = typer.Argument(..., help="Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: show, set, reset, stats"),
    endpoint: Optional[str] = typer.Option(
        None, "--endpoint", "-e", help="Endpoint Ğ´Ğ»Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸"
    ),
    limit: Optional[int] = typer.Option(
        None, "--limit", "-l", help="Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ"
    ),
    window: Optional[int] = typer.Option(
        None, "--window", "-w", help="ĞĞºĞ½Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…"
    ),
):
    """Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ğ¼Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²"""
    try:
        asyncio.run(_api_rate_limit_async(action, endpoint, limit, window))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(
            f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'api rate-limit': {e}[/]"
        )
        raise typer.Exit(code=1)


async def _api_rate_limit_async(
    action: str, endpoint: Optional[str], limit: Optional[int], window: Optional[int]
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ğ¼Ğ¸"""
    console.print(
        Panel(
            "[bold blue]Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ›Ğ˜ĞœĞ˜Ğ¢ĞĞœĞ˜ Ğ—ĞĞŸĞ ĞĞ¡ĞĞ’[/]",
            expand=False,
            border_style="blue",
        )
    )

    rate_data = _load_rate_limits()
    limits = rate_data.get("limits", {})
    usage = rate_data.get("usage", {})

    if action == "show":
        _show_rate_limits(limits, usage)
    elif action == "set":
        if not endpoint or limit is None:
            console.print(
                "[bold red]Ğ”Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ 'set' Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ endpoint Ğ¸ limit.[/]"
            )
            raise typer.Exit(code=1)
        _set_rate_limit(endpoint, limit, window, rate_data)
    elif action == "reset":
        _reset_rate_limits(rate_data)
    elif action == "stats":
        _show_rate_limit_stats(usage)
    else:
        console.print(f"[bold red]ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ: {action}[/]")
        raise typer.Exit(code=1)


def _show_rate_limits(limits: Dict[str, Any], usage: Dict[str, Any]):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²"""
    if not limits:
        console.print("[yellow]Ğ›Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹[/]")
        return

    table = Table(title="Ğ›Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²")
    table.add_column("Endpoint", style="cyan")
    table.add_column("Ğ›Ğ¸Ğ¼Ğ¸Ñ‚", style="blue")
    table.add_column("ĞĞºĞ½Ğ¾", style="green")
    table.add_column("Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¾", style="yellow")
    table.add_column("ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ", style="red")

    for endpoint, limit_info in limits.items():
        limit_value = limit_info.get("limit", 0)
        window_value = limit_info.get("window", 60)

        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
        current_usage = usage.get(endpoint, {}).get("count", 0)
        remaining = max(0, limit_value - current_usage)

        usage_color = "green" if remaining > 0 else "red"

        table.add_row(
            endpoint,
            f"{limit_value}/min",
            f"{window_value}s",
            str(current_usage),
            f"[{usage_color}]{remaining}[/{usage_color}]",
        )

    console.print(table)


def _set_rate_limit(
    endpoint: str, limit: int, window: Optional[int], rate_data: Dict[str, Any]
):
    """Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²"""
    limits = rate_data.get("limits", {})

    limits[endpoint] = {
        "limit": limit,
        "window": window or 60,
        "created_at": datetime.now().isoformat(),
    }

    _save_rate_limits(rate_data)

    console.print(f"[green]âœ… Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ´Ğ»Ñ '{endpoint}' ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½: {limit}/min[/]")


def _reset_rate_limits(rate_data: Dict[str, Any]):
    """Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²"""
    from Systems.cli.utils import confirm_action

    if not confirm_action("Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²?"):
        return

    rate_data["limits"] = {}
    rate_data["usage"] = {}
    _save_rate_limits(rate_data)

    console.print("[green]âœ… Ğ’ÑĞµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½Ñ‹[/]")


def _show_rate_limit_stats(usage: Dict[str, Any]):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ²"""
    if not usage:
        console.print("[yellow]Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿ÑƒÑÑ‚Ğ°[/]")
        return

    table = Table(title="Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ²")
    table.add_column("Endpoint", style="cyan")
    table.add_column("Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²", style="blue")
    table.add_column("ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ", style="green")
    table.add_column("Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ", style="yellow")

    for endpoint, usage_info in usage.items():
        count = usage_info.get("count", 0)
        last_request = usage_info.get("last_request")
        avg_time = usage_info.get("avg_response_time", "N/A")

        if last_request:
            try:
                dt = datetime.fromisoformat(last_request)
                last_str = dt.strftime("%H:%M:%S")
            except:
                last_str = last_request
        else:
            last_str = "ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ°"

        table.add_row(endpoint, str(count), last_str, str(avg_time))

    console.print(table)


@api_app.command(name="docs", help="Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ API.")
def api_docs_cmd(
    format: str = typer.Option(
        "html", "--format", "-f", help="Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸: html, json, yaml"
    ),
    output_file: Optional[str] = typer.Option(
        None, "--output", "-o", help="Ğ¤Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸"
    ),
    include_examples: bool = typer.Option(
        True, "--examples", help="Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²"
    ),
):
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ API"""
    try:
        asyncio.run(_api_docs_async(format, output_file, include_examples))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'api docs': {e}[/]")
        raise typer.Exit(code=1)


async def _api_docs_async(
    format: str, output_file: Optional[str], include_examples: bool
):
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ API"""
    console.print(
        Panel(
            "[bold blue]Ğ“Ğ•ĞĞ•Ğ ĞĞ¦Ğ˜Ğ¯ Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢ĞĞ¦Ğ˜Ğ˜ API[/]",
            expand=False,
            border_style="blue",
        )
    )

    config = _load_api_config()
    endpoints = config.get("endpoints", {})

    if not endpoints:
        console.print("[yellow]API endpoints Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹[/]")
        return

    console.print(f"[cyan]Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚:[/] {format}")
    console.print(f"[cyan]Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹:[/] {'Ğ”Ğ°' if include_examples else 'ĞĞµÑ‚'}")

    if format == "html":
        _generate_html_docs(endpoints, output_file, include_examples)
    elif format == "json":
        _generate_json_docs(endpoints, output_file)
    elif format == "yaml":
        _generate_yaml_docs(endpoints, output_file)
    else:
        console.print(f"[bold red]ĞĞµĞ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚: {format}[/]")
        raise typer.Exit(code=1)


def _generate_html_docs(
    endpoints: Dict[str, Any], output_file: Optional[str], include_examples: bool
):
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ HTML Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ"""
    html_content = """
    <!DOCTYPE html>
    <html>
    <head>
        <title>SwiftDevBot API Documentation</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .endpoint { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px; }
            .method { font-weight: bold; color: #fff; padding: 3px 8px; border-radius: 3px; }
            .get { background-color: #61affe; }
            .post { background-color: #49cc90; }
            .put { background-color: #fca130; }
            .delete { background-color: #f93e3e; }
            .path { font-family: monospace; background-color: #f5f5f5; padding: 5px; }
            .description { margin: 10px 0; }
            .example { background-color: #f8f9fa; padding: 10px; border-left: 4px solid #007bff; margin: 10px 0; }
            .rate-limit { color: #6c757d; font-size: 0.9em; }
        </style>
    </head>
    <body>
        <h1>SwiftDevBot API Documentation</h1>
        <p>Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ API Ğ´Ğ»Ñ SwiftDevBot ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.</p>
    """

    for endpoint_key, endpoint_info in endpoints.items():
        method = endpoint_info.get("method", "GET")
        path = endpoint_info.get("path", "")
        description = endpoint_info.get("description", "")
        rate_limit = endpoint_info.get("rate_limit", "N/A")
        auth_required = endpoint_info.get("auth_required", True)

        html_content += f"""
        <div class="endpoint">
            <div>
                <span class="method {method.lower()}">{method}</span>
                <span class="path">{path}</span>
            </div>
            <div class="description">{description}</div>
            <div class="rate-limit">Ğ›Ğ¸Ğ¼Ğ¸Ñ‚: {rate_limit}/min | ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: {'Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ' if auth_required else 'ĞĞµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ'}</div>
        """

        if include_examples:
            html_content += f"""
            <div class="example">
                <strong>ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°:</strong><br>
                <code>curl -X {method} "http://localhost:8000{path}"</code>
            </div>
            """

        html_content += "</div>"

    html_content += """
    </body>
    </html>
    """

    if output_file:
        with open(output_file, "w", encoding="utf-8") as f:
            f.write(html_content)
        console.print(f"[green]âœ… HTML Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ° Ğ²: {output_file}[/]")
    else:
        default_file = API_DOCS_DIR / "api_docs.html"
        with open(default_file, "w", encoding="utf-8") as f:
            f.write(html_content)
        console.print(f"[green]âœ… HTML Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ° Ğ²: {default_file}[/]")


def _generate_json_docs(endpoints: Dict[str, Any], output_file: Optional[str]):
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ JSON Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ"""
    docs_data = {
        "info": {
            "title": "SwiftDevBot API",
            "version": "1.0.0",
            "description": "API Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹ SwiftDevBot",
        },
        "endpoints": endpoints,
    }

    if output_file:
        with open(output_file, "w", encoding="utf-8") as f:
            json.dump(docs_data, f, indent=2, ensure_ascii=False)
        console.print(f"[green]âœ… JSON Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ° Ğ²: {output_file}[/]")
    else:
        default_file = API_DOCS_DIR / "api_docs.json"
        with open(default_file, "w", encoding="utf-8") as f:
            json.dump(docs_data, f, indent=2, ensure_ascii=False)
        console.print(f"[green]âœ… JSON Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ° Ğ²: {default_file}[/]")


def _generate_yaml_docs(endpoints: Dict[str, Any], output_file: Optional[str]):
    """Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ YAML Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ"""
    try:
        import yaml
    except ImportError:
        console.print("[yellow]Ğ”Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ YAML Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ PyYAML[/]")
        return

    docs_data = {
        "info": {
            "title": "SwiftDevBot API",
            "version": "1.0.0",
            "description": "API Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹ SwiftDevBot",
        },
        "endpoints": endpoints,
    }

    if output_file:
        with open(output_file, "w", encoding="utf-8") as f:
            yaml.dump(docs_data, f, default_flow_style=False, allow_unicode=True)
        console.print(f"[green]âœ… YAML Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ° Ğ²: {output_file}[/]")
    else:
        default_file = API_DOCS_DIR / "api_docs.yaml"
        with open(default_file, "w", encoding="utf-8") as f:
            yaml.dump(docs_data, f, default_flow_style=False, allow_unicode=True)
        console.print(f"[green]âœ… YAML Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ° Ğ²: {default_file}[/]")


if __name__ == "__main__":
    api_app()



======================================================================

------------------------------ FILE: Systems/cli/process.py ------------------------------
# --- ĞĞĞ§ĞĞ›Ğ Ğ¤ĞĞ™Ğ›Ğ cli/process.py ---
import asyncio
import os
import signal
import subprocess
import sys
import time
from datetime import datetime
from pathlib import Path
from typing import Any, List, Optional
from typing import Tuple as TypingTuple

import typer
from rich.columns import Columns
from rich.console import Console
from rich.panel import Panel
from rich.table import Table
from rich.text import Text

try:
    import psutil
except ImportError:
    psutil = None

from .utils import get_sdb_services_for_cli

# Ğ­Ñ‚Ğ° ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ² Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¼ Ñ„Ğ°Ğ¹Ğ»Ğµ sdb
sdb_console: Console = Console()

PID_FILENAME = "sdb_bot.pid"


def _get_pid_file_path() -> Path:
    from Systems.core.app_settings import settings

    # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹
    return settings.core.project_data_path / PID_FILENAME


def _read_pid_from_file(pid_file: Path) -> Optional[int]:
    if not pid_file.is_file():
        return None
    try:
        pid_str = pid_file.read_text().strip()
        if not pid_str.isdigit():
            sys.stderr.write(
                f"ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ: PID-Ñ„Ğ°Ğ¹Ğ» ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ½ĞµÑ‡Ğ¸ÑĞ»Ğ¾Ğ²Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ: '{pid_str}'.\n"
            )
            return None
        return int(pid_str)
    except Exception as e:
        sys.stderr.write(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ PID Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ° {pid_file}: {e}\n")
        return None


def _is_process_running(pid: int) -> bool:
    if not isinstance(pid, int) or pid <= 0:
        return False
    if psutil:
        try:
            return psutil.pid_exists(pid)
        except Exception:
            return False
    if sys.platform != "win32":
        try:
            os.kill(pid, 0)
            return True
        except OSError:
            return False
    else:
        try:
            result = subprocess.run(
                ["tasklist", "/FI", f"PID eq {pid}"],
                capture_output=True,
                text=True,
                check=False,
                creationflags=getattr(subprocess, "CREATE_NO_WINDOW", 0),
            )
            return str(pid) in result.stdout
        except (FileNotFoundError, Exception):
            return False


async def _get_total_users_count_cli() -> Optional[int]:
    db_m = None
    try:
        _, db_m, _ = await get_sdb_services_for_cli(init_db=True)
        if not db_m:
            return None
        from sqlalchemy import func as sql_func
        from sqlalchemy import select

        from Systems.core.database.core_models import User

        async with db_m.get_session() as session:
            stmt = select(sql_func.count(User.id))
            result = await session.execute(stmt)
            return result.scalar_one_or_none() or 0
    except Exception:
        return None
    finally:
        if db_m:
            await db_m.dispose()


def status_command():
    """ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ SDB Ğ±Ğ¾Ñ‚Ğµ."""
    from aiogram import __version__ as aiogram_version

    from Systems.core.app_settings import settings

    # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹
    pid_file = _get_pid_file_path()
    pid = _read_pid_from_file(pid_file)

    status_text_elements: List[Text] = []
    process_info_data: Optional[List[TypingTuple[str, str]]] = None

    is_running_flag = False
    if pid and _is_process_running(pid):
        is_running_flag = True
        status_text_elements.append(
            Text.assemble(
                ("âœ… Ğ‘ĞĞ¢ Ğ—ĞĞŸĞ£Ğ©Ğ•Ğ ", "bold green"), 
                ("â— SDB Core Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ ", "green"), 
                (f"(PID: {pid})", "green bold")
            )
        )
        if psutil:
            try:
                p = psutil.Process(pid)
                process_info_data = []
                with p.oneshot():
                    create_time = datetime.fromtimestamp(p.create_time())
                    uptime_delta = datetime.now() - create_time
                    days, remainder = divmod(uptime_delta.total_seconds(), 86400)
                    hours, remainder = divmod(remainder, 3600)
                    minutes, seconds = divmod(remainder, 60)
                    uptime_str_parts = []
                    if days > 0:
                        uptime_str_parts.append(f"{int(days)}Ğ´")
                    if hours > 0:
                        uptime_str_parts.append(f"{int(hours)}Ñ‡")
                    if minutes > 0:
                        uptime_str_parts.append(f"{int(minutes)}Ğ¼")
                    uptime_str_parts.append(f"{int(seconds)}Ñ")

                    process_info_data.append(
                        ("Ğ—Ğ°Ğ¿ÑƒÑ‰ĞµĞ½:", create_time.strftime("%Y-%m-%d %H:%M:%S"))
                    )
                    process_info_data.append(
                        ("Ğ’Ñ€ĞµĞ¼Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:", " ".join(uptime_str_parts) or "0Ñ")
                    )
                    process_info_data.append(
                        ("CPU Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°:", f"{p.cpu_percent(interval=0.1):.1f}%")
                    )
                    rss_mb = p.memory_info().rss / (1024 * 1024)
                    process_info_data.append(("ĞŸĞ°Ğ¼ÑÑ‚ÑŒ (RSS):", f"{rss_mb:.2f} MB"))
                    try:
                        process_info_data.append(
                            ("ĞšĞ¾Ğ»-Ğ²Ğ¾ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ²:", str(p.num_threads()))
                        )
                    except (psutil.Error, AttributeError, NotImplementedError):
                        pass
                    process_info_data.append(("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°:", str(p.status())))
                    try:
                        process_info_data.append(("Ğ—Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ¾Ñ‚:", str(p.username())))
                    except (psutil.Error, AttributeError, NotImplementedError):
                        pass
            except psutil.NoSuchProcess:
                is_running_flag = False
                status_text_elements.clear()
                status_text_elements.append(
                    Text("âŒ Ğ‘ĞĞ¢ ĞĞ• Ğ—ĞĞŸĞ£Ğ©Ğ•Ğ", style="bold red")
                )
                status_text_elements.append(
                    Text(
                        f"âš  PID-Ñ„Ğ°Ğ¹Ğ» ({pid_file}) Ğ´Ğ»Ñ PID {pid} ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚, Ğ½Ğ¾ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ ÑƒĞ¶Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ (ÑƒÑÑ‚Ğ°Ñ€ĞµĞ»).",
                        style="yellow",
                    )
                )
                # ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğ¹ PID-Ñ„Ğ°Ğ¹Ğ»
                if pid_file.is_file():
                    try:
                        pid_file.unlink()
                        status_text_elements.append(
                            Text(f"âœ“ Ğ£ÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğ¹ PID-Ñ„Ğ°Ğ¹Ğ» Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½.", style="green")
                        )
                    except Exception as e_unlink:
                        status_text_elements.append(
                            Text(
                                f"  ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ PID-Ñ„Ğ°Ğ¹Ğ»: rm {pid_file}",
                                style="cyan",
                            )
                        )
            except psutil.AccessDenied:
                status_text_elements.append(
                    Text(
                        f"âœ— ĞÑ‚ĞºĞ°Ğ·Ğ°Ğ½Ğ¾ Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğµ Ğº Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ PID {pid}.",
                        style="red",
                    )
                )
            except Exception as e_psutil:
                status_text_elements.append(
                    Text(f"âœ— ĞÑˆĞ¸Ğ±ĞºĞ° psutil Ğ´Ğ»Ñ PID {pid}: {e_psutil}", style="red")
                )
        else:
            status_text_elements.append(
                Text(
                    "(Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ 'psutil' Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ)",
                    style="dim",
                )
            )
    elif pid:
        status_text_elements.append(
            Text("âŒ Ğ‘ĞĞ¢ ĞĞ• Ğ—ĞĞŸĞ£Ğ©Ğ•Ğ", style="bold red")
        )
        status_text_elements.append(
            Text(
                f"âš  SDB Core Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ (PID-Ñ„Ğ°Ğ¹Ğ» {pid_file} (PID {pid}) ÑƒÑÑ‚Ğ°Ñ€ĞµĞ»).",
                style="yellow",
            )
        )
        # ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğ¹ PID-Ñ„Ğ°Ğ¹Ğ»
        if pid_file.is_file():
            try:
                pid_file.unlink()
                status_text_elements.append(
                    Text(f"âœ“ Ğ£ÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğ¹ PID-Ñ„Ğ°Ğ¹Ğ» Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½.", style="green")
                )
            except Exception as e_unlink:
                status_text_elements.append(
                    Text(f"  Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ PID-Ñ„Ğ°Ğ¹Ğ»: rm {pid_file}", style="cyan")
                )
    else:
        status_text_elements.append(
            Text("âŒ Ğ‘ĞĞ¢ ĞĞ• Ğ—ĞĞŸĞ£Ğ©Ğ•Ğ", style="bold red")
        )
        status_text_elements.append(
            Text("â— SDB Core Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ (PID-Ñ„Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½).", style="red")
        )

    status_panel_content = Text("\n").join(status_text_elements)
    # ĞœĞµĞ½ÑĞµĞ¼ Ñ†Ğ²ĞµÑ‚ Ñ€Ğ°Ğ¼ĞºĞ¸ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
    border_color = "green" if is_running_flag else "red"
    title_color = "green" if is_running_flag else "red"
    status_panel = Panel(
        status_panel_content,
        title=f"[bold {title_color}]Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ SDB Core[/bold {title_color}]",
        border_style=border_color,
        expand=False,
        padding=(1, 2),
    )

    process_panel_renderable = None
    if process_info_data and is_running_flag:
        proc_table = Table(show_header=False, box=None, padding=(0, 1), show_edge=False)
        proc_table.add_column(
            style="dim blue", justify="right", min_width=18, max_width=20
        )
        proc_table.add_column(min_width=20)
        for key, value in process_info_data:
            proc_table.add_row(key, value)
        process_panel_renderable = Panel(
            proc_table,
            title="[bold blue]ĞŸÑ€Ğ¾Ñ†ĞµÑÑ SDB[/bold blue]",
            border_style="blue",
            expand=False,
            padding=1,
        )

    sdb_info_data_list: List[TypingTuple[str, Any]] = []
    sdb_info_data_list.append(("Ğ’ĞµÑ€ÑĞ¸Ñ SDB Core:", settings.core.sdb_version))
    sdb_info_data_list.append(("Ğ’ĞµÑ€ÑĞ¸Ñ Aiogram:", aiogram_version))
    sdb_info_data_list.append(("Ğ¢Ğ¸Ğ¿ Ğ‘Ğ”:", settings.db.type.upper()))
    sdb_info_data_list.append(("Ğ¢Ğ¸Ğ¿ ĞºÑÑˆĞ°:", settings.cache.type.capitalize()))

    try:
        from Systems.core.module_loader import ModuleLoader
        from Systems.core.services_provider import BotServicesProvider

        temp_bsp = BotServicesProvider(settings=settings)
        loader = ModuleLoader(settings=settings, services_provider=temp_bsp)
        loader.scan_all_available_modules()
        loader._load_enabled_plugin_names()
        sdb_info_data_list.append(
            ("ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹:", str(len(loader.available_modules)))
        )
        sdb_info_data_list.append(
            ("ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹:", str(len(loader.enabled_plugin_names)))
        )
    except Exception:
        sdb_info_data_list.append(("ĞœĞ¾Ğ´ÑƒĞ»Ğ¸:", Text("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ÑÑ‡ĞµÑ‚Ğ°", style="yellow")))

    total_users = asyncio.run(_get_total_users_count_cli())
    user_count_text_val = (
        str(total_users)
        if total_users is not None
        else Text("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ", style="yellow")
    )
    sdb_info_data_list.append(("Ğ’ÑĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ² Ğ‘Ğ”:", user_count_text_val))

    sdb_info_table = Table(show_header=False, box=None, padding=(0, 1), show_edge=False)
    sdb_info_table.add_column(style="dim magenta", justify="right", min_width=26)
    sdb_info_table.add_column(min_width=25)
    for key, value in sdb_info_data_list:
        sdb_info_table.add_row(key, value)
    sdb_info_panel = Panel(
        sdb_info_table,
                    title="[bold magenta]ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ SDB Core[/bold magenta]",
        border_style="magenta",
        expand=False,
        padding=1,
    )

    sdb_console.print(status_panel)

    columns_content = []
    if process_panel_renderable:
        columns_content.append(process_panel_renderable)
    columns_content.append(sdb_info_panel)

    if columns_content:
        sdb_console.print(
            Columns(
                columns_content,
                expand=True,
                equal=False,
                padding=(0, 2),
                column_first=False,
            )
        )


def stop_command(
    force: bool = typer.Option(
        False,
        "--force",
        "-f",
        help="ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ (SIGKILL), ĞµÑĞ»Ğ¸ SIGTERM Ğ½Ğµ ÑÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» (ĞĞŸĞĞ¡ĞĞ).",
    ),
    timeout: int = typer.Option(
        5,
        "--timeout",
        "-t",
        help="Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ (ÑĞµĞº) Ğ¿Ğ¾ÑĞ»Ğµ SIGTERM Ğ¿ĞµÑ€ĞµĞ´ SIGKILL (ĞµÑĞ»Ğ¸ --force).",
        min=1,
        max=60,
    ),
):
    """ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ SDB Ğ±Ğ¾Ñ‚Ğ°."""
    pid_file = _get_pid_file_path()
    pid = _read_pid_from_file(pid_file)

    if not pid:
        sdb_console.print("[yellow]SDB Core Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ (PID-Ñ„Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½).[/yellow]")
        return

    if not _is_process_running(pid):
        sdb_console.print(
            f"[yellow]SDB Ğ±Ğ¾Ñ‚ (PID: {pid} Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ°) ÑƒĞ¶Ğµ Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½.[/yellow]"
        )
        if pid_file.is_file():
            try:
                pid_file.unlink()
                sdb_console.print(f"Ğ£ÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğ¹ PID-Ñ„Ğ°Ğ¹Ğ» {pid_file} ÑƒĞ´Ğ°Ğ»ĞµĞ½.")
            except Exception as e_unlink:
                sdb_console.print(
                    f"[red]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğ¹ PID-Ñ„Ğ°Ğ¹Ğ» {pid_file}: {e_unlink}[/red]"
                )
        return

    sdb_console.print(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ SDB Ğ±Ğ¾Ñ‚Ğ° (PID: {pid})...")

    if sys.platform == "win32":
        sdb_console.print(
            "[yellow]ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ´Ğ»Ñ Windows Ğ½Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ°. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ (taskkill /F /PID {pid}).[/yellow]"
        )
        raise typer.Exit(code=1)

    try:
        os.kill(pid, signal.SIGTERM)
        sdb_console.print(f"ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½ ÑĞ¸Ğ³Ğ½Ğ°Ğ» SIGTERM Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑÑƒ {pid}.")

        for i in range(timeout):
            time.sleep(1)
            if not _is_process_running(pid):
                sdb_console.print(
                    f"[green]SDB Ğ±Ğ¾Ñ‚ (PID: {pid}) ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ (Ñ‡ĞµÑ€ĞµĞ· {i+1} ÑĞµĞº).[/green]"
                )
                if pid_file.is_file():
                    pid_file.unlink(missing_ok=True)
                return

        if _is_process_running(pid):
            if force:
                sdb_console.print(
                    f"[yellow]ĞŸÑ€Ğ¾Ñ†ĞµÑÑ {pid} Ğ²ÑĞµ ĞµÑ‰Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ Ğ¿Ğ¾ÑĞ»Ğµ {timeout} ÑĞµĞº. ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° (SIGKILL)...[/yellow]"
                )
                os.kill(pid, signal.SIGKILL)
                time.sleep(0.1)
                if not _is_process_running(pid):
                    sdb_console.print(
                        f"[green]SDB Ğ±Ğ¾Ñ‚ (PID: {pid}) Ğ¿Ñ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ (SIGKILL).[/green]"
                    )
                else:
                    sdb_console.print(
                        f"[red]âœ— SDB Ğ±Ğ¾Ñ‚ (PID: {pid}) Ğ½Ğµ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ğ»ÑÑ Ğ´Ğ°Ğ¶Ğµ Ğ¿Ğ¾ÑĞ»Ğµ SIGKILL. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ.[/red]"
                    )
                    raise typer.Exit(code=1)
                if pid_file.is_file():
                    pid_file.unlink(missing_ok=True)
            else:
                sdb_console.print(
                    f"[red]âœ— SDB Ğ±Ğ¾Ñ‚ (PID: {pid}) Ğ½Ğµ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ğ»ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ SIGTERM ({timeout} ÑĞµĞº).[/red]"
                )
                sdb_console.print(
                    f"  ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ 'sdb stop --force' Ğ¸Ğ»Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ (kill {pid})."
                )
                raise typer.Exit(code=1)
        else:
            sdb_console.print(
                f"[green]SDB Ğ±Ğ¾Ñ‚ (PID: {pid}) ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½.[/green]"
            )
            if pid_file.is_file():
                pid_file.unlink(missing_ok=True)
    except ProcessLookupError:
        sdb_console.print(f"[green]SDB Ğ±Ğ¾Ñ‚ (PID: {pid}) ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ» Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½.[/green]")
        if pid_file.is_file():
            pid_file.unlink(missing_ok=True)
    except typer.Exit:
        raise
    except Exception as e:
        sdb_console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ±Ğ¾Ñ‚Ğ°: {e}[/red]")
        raise typer.Exit(code=1)


def restart_command(
    force_stop: bool = typer.Option(
        False,
        "--force-stop",
        help="Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ --force Ğ¿Ñ€Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ¿ĞµÑ€ĞµĞ´ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ¼.",
    ),
    stop_timeout: int = typer.Option(
        5,
        "--stop-timeout",
        help="Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ (ÑĞµĞº) Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ stop.",
        min=1,
        max=60,
    ),
    # --- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ• Ğ—Ğ”Ğ•Ğ¡Ğ¬: default=False ---
    background: bool = typer.Option(
        False,
        "--background",
        "-b",
        help="Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ° Ğ² Ñ„Ğ¾Ğ½Ğ¾Ğ²Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°.",
    ),
    debug: bool = typer.Option(
        False,
        "--debug",
        "-d",
        help="Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ° Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°.",
    ),
):
    """ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ SDB Ğ±Ğ¾Ñ‚Ğ°: Ğ¾ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ (ĞµÑĞ»Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½) Ğ¸ Ğ·Ğ°Ñ‚ĞµĞ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚."""
    sdb_console.print(Panel("[blue]ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº SDB Ğ±Ğ¾Ñ‚Ğ°...[/blue]", expand=False))

    sdb_console.print(
        "\n[cyan]Ğ¨Ğ°Ğ³ 1: ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€Ğ° Ğ±Ğ¾Ñ‚Ğ° (ĞµÑĞ»Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½)...[/cyan]"
    )
    stop_failed = False

    sdb_executable_str: Optional[str] = None
    project_root = Path(sys.argv[0]).parent.resolve()

    # Ğ˜Ñ‰ĞµĞ¼ sdb (Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼Ñ‹Ğ¹) Ğ¸Ğ»Ğ¸ sdb.py
    sdb_path = project_root / "sdb"
    sdb_py_path = project_root / "sdb.py"

    if sdb_path.exists() and os.access(sdb_path, os.X_OK):
        sdb_executable_str = str(sdb_path)
    elif sdb_py_path.exists():
        sdb_executable_str = str(sdb_py_path)

    if not sdb_executable_str:
        sdb_console.print(
            f"[bold red]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» SDB CLI.[/bold red]"
        )
        raise typer.Exit(1)

    try:
        # Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ stop Ñ‡ĞµÑ€ĞµĞ· subprocess, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ğ½Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»Ğ° Ğ² ÑĞ²Ğ¾ĞµĞ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğµ
        stop_command_args = [sdb_executable_str, "stop", f"--timeout={stop_timeout}"]
        if force_stop:
            stop_command_args.append("--force")

        sdb_console.print(
            f"[dim]Ğ’Ñ‹Ğ·Ğ¾Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸: {' '.join(stop_command_args)}[/dim]"
        )
        stop_process_result = subprocess.run(
            stop_command_args, capture_output=True, text=True, encoding="utf-8"
        )

        if stop_process_result.stdout:
            sdb_console.print(
                f"[dim cyan]Ğ’Ñ‹Ğ²Ğ¾Ğ´ 'stop':[/]\n{stop_process_result.stdout.strip()}"
            )
        if stop_process_result.stderr:
            sdb_console.print(
                f"[dim yellow]ĞÑˆĞ¸Ğ±ĞºĞ¸ Ğ¾Ñ‚ 'stop':[/]\n{stop_process_result.stderr.strip()}"
            )
        if stop_process_result.returncode != 0:
            sdb_console.print(
                f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ½Ğ° Ñ„Ğ°Ğ·Ğµ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ (ĞºĞ¾Ğ´: {stop_process_result.returncode}).[/bold red]"
            )
            if not typer.confirm("ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºÑƒ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°?", default=False):
                raise typer.Exit(code=1)
            stop_failed = True
    except Exception as e_stop_wrapper:
        sdb_console.print(
            Text.assemble(
                ("[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğµ 'stop': ", "bold red"),
                Text(str(e_stop_wrapper)),
            )
        )
        if not typer.confirm("ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºÑƒ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°?", default=False):
            raise typer.Exit(code=1)
        stop_failed = True

    if not stop_failed:
        time.sleep(1)

    sdb_console.print("\n[cyan]Ğ¨Ğ°Ğ³ 2: Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€Ğ° Ğ±Ğ¾Ñ‚Ğ°...[/cyan]")
    try:
        start_command_args = [sdb_executable_str, "run"]
        if background:
            start_command_args.append("--background")
        if debug:
            start_command_args.append("--debug")

        sdb_console.print(
            f"[dim]Ğ’Ñ‹Ğ·Ğ¾Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°: {' '.join(start_command_args)}[/dim]"
        )

        if background:
            # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¸ "Ğ·Ğ°Ğ±Ñ‹Ğ²Ğ°ĞµĞ¼" - ÑÑ‚Ğ¾ Ğ¸ ĞµÑÑ‚ÑŒ Ñ„Ğ¾Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼
            subprocess.Popen(
                start_command_args, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL
            )
            sdb_console.print(
                "[green]ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ±Ğ¾Ñ‚Ğ° Ğ² Ñ„Ğ¾Ğ½Ğ¾Ğ²Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ°.[/green]"
            )
        else:
            # --- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ• Ğ—Ğ”Ğ•Ğ¡Ğ¬: Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ² Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ ---
            # ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ, Ğ¸ ĞµĞµ Ğ²Ñ‹Ğ²Ğ¾Ğ´ Ğ¿Ğ¾Ğ¹Ğ´ĞµÑ‚ Ğ² Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ».
            # ĞĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ capture_output=True
            subprocess.run(start_command_args)
            # ĞšĞ¾Ğ´ Ğ·Ğ´ĞµÑÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¶Ğ´Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ±Ğ¾Ñ‚Ğ°
            sdb_console.print(
                "[bold green]Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ ÑĞµĞ°Ğ½Ñ Ğ±Ğ¾Ñ‚Ğ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½.[/bold green]"
            )

    except Exception as e_start_wrapper:
        sdb_console.print(
            Text.assemble(
                ("[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ½Ğ° ÑÑ‚Ğ°Ğ¿Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°: ", "bold red"),
                Text(str(e_start_wrapper)),
            )
        )
        raise typer.Exit(code=1)

    sdb_console.print("\n[bold green]ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°.[/bold green]")
    if background:
        sdb_console.print("  ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ¾Ñ‚Ğ° Ñ‡ĞµÑ€ĞµĞ·: [cyan]sdb status[/cyan]")


# --- ĞšĞĞĞ•Ğ¦ Ğ¤ĞĞ™Ğ›Ğ cli/process.py ---



======================================================================

------------------------------ FILE: Systems/cli/backup.py ------------------------------
# --- Ğ¤Ğ°Ğ¹Ğ»: cli/backup_unified.py ---
import hashlib
import json
import os
import shutil
import subprocess
import tarfile
from datetime import datetime
from pathlib import Path
from typing import Any, Dict, List, Optional, Union
from typing import Tuple as TypingTuple
from urllib.parse import urlparse

import typer
from rich.console import Console
from rich.panel import Panel
from rich.table import Table

from .utils import confirm_action, sdb_console

backup_app = typer.Typer(
    name="backup",
    help="ğŸ’¾ ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ² Ñ Ñ…ĞµÑˆĞ°Ğ¼Ğ¸, Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹ Ğ‘Ğ” Ğ¸ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸ĞµĞ¼",
    no_args_is_help=True,
)

console = Console()

# === ĞšĞĞĞ¡Ğ¢ĞĞĞ¢Ğ« ===
DB_BACKUP_DIR_NAME = "database"
FILES_BACKUP_DIR_NAME = "files"
DATA_ARCHIVE_EXTENSION = ".tar.gz"
POSTGRES_BACKUP_FILENAME = "postgres_dump.sql"
MYSQL_BACKUP_FILENAME = "mysql_dump.sql"
USER_CONFIG_DIR_NAME_FOR_BACKUP_DEFAULT = "Config"


# === Ğ£Ğ¢Ğ˜Ğ›Ğ˜Ğ¢Ğ« Ğ¥Ğ•Ğ¨Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ¯ ===
def sha256(file_path: Path, chunk_size: int = 65536) -> str:
    """Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ SHA256 Ñ…ĞµÑˆ Ñ„Ğ°Ğ¹Ğ»Ğ°."""
    h = hashlib.sha256()
    with open(file_path, "rb") as f:
        for chunk in iter(lambda: f.read(chunk_size), b""):
            h.update(chunk)
    return h.hexdigest()


def scan_directory(path: Path, excludes: Optional[List[str]] = None) -> dict[str, str]:
    """Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ñ…ĞµÑˆĞ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ¾Ğ¹ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¾Ğ¹ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¹."""
    import fnmatch
    
    hashes = {}
    excludes = excludes or []
    
    for file in path.rglob("*"):
        if file.is_file():
            rel_path = file.relative_to(path).as_posix()
            
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
            excluded = False
            for exclude in excludes:
                # ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ñ Ğ·Ğ²ĞµĞ·Ğ´Ğ¾Ñ‡ĞºĞ¾Ğ¹ (*.pyc, *.log Ğ¸ Ñ‚.Ğ´.)
                if "*" in exclude:
                    if fnmatch.fnmatch(rel_path, exclude) or fnmatch.fnmatch(file.name, exclude):
                        excluded = True
                        break
                # ĞŸĞ¾Ğ»Ğ½Ñ‹Ğµ Ğ¿ÑƒÑ‚Ğ¸ (Data/Cache_data)
                elif "/" in exclude:
                    if rel_path.startswith(exclude) or rel_path == exclude:
                        excluded = True
                        break
                # Ğ˜Ğ¼ĞµĞ½Ğ° Ğ¿Ğ°Ğ¿Ğ¾Ğº Ğ¸Ğ»Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
                else:
                    path_parts = rel_path.split("/")
                    if exclude in path_parts or exclude == file.name:
                        excluded = True
                        break
            
            if excluded:
                continue
                
            hashes[rel_path] = sha256(file)
    return hashes


# === Ğ£Ğ¢Ğ˜Ğ›Ğ˜Ğ¢Ğ« Ğ‘Ğ” ===
def _get_backup_base_dir() -> Optional[Path]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ±Ğ°Ğ·Ğ¾Ğ²ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²."""
    try:
        project_root = Path(__file__).resolve().parent.parent
        backup_dir = project_root / "backup"
        backup_dir.mkdir(parents=True, exist_ok=True)
        return backup_dir
    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²: {e}[/]")
        return None


def _find_system_utility(name: str) -> Optional[str]:
    """ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½ÑƒÑ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñƒ."""
    return shutil.which(name)


def _execute_system_command(
    command: List[str],
    env_vars: Optional[dict] = None,
    input_data: Optional[str] = None,
    show_stdout_on_success: bool = False,
) -> bool:
    """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½ÑƒÑ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ."""
    full_env = os.environ.copy()
    if env_vars:
        full_env.update(env_vars)

    try:
        result = subprocess.run(
            command,
            env=full_env,
            input=input_data,
            text=True,
            capture_output=True,
            check=True,
        )

        if show_stdout_on_success and result.stdout.strip():
            console.print(result.stdout.strip())

        return True
    except subprocess.CalledProcessError as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹: {e}[/]")
        if e.stderr:
            console.print(f"[red]{e.stderr}[/]")
        return False
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: {e}[/]")
        return False


# === ĞĞ¡ĞĞĞ’ĞĞ«Ğ• ĞšĞĞœĞĞĞ”Ğ« ===


@backup_app.command("create")
def create_backup(
    backup_type: str = typer.Option(
        "full", "--type", "-t", help="Ğ¢Ğ¸Ğ¿ Ğ±ÑĞºĞ°Ğ¿Ğ°: full, files, db, custom"
    ),
    dest: Optional[Path] = typer.Option(
        None, "--dest", "-d", help="ĞŸĞ°Ğ¿ĞºĞ° Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ±ÑĞºĞ°Ğ¿Ğ°"
    ),
    compress: bool = typer.Option(
        True, "--compress/--no-compress", help="Ğ¡Ğ¶Ğ¸Ğ¼Ğ°Ñ‚ÑŒ Ğ°Ñ€Ñ…Ğ¸Ğ² (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾)"
    ),
    verify_hashes: bool = typer.Option(
        True,
        "--verify-hashes/--no-verify-hashes",
        help="Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ Ñ…ĞµÑˆĞ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²",
    ),
    exclude: Optional[List[str]] = typer.Option(
        None, "--exclude", "-x", help="Ğ˜ÑĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ñ‹/Ğ¿Ğ°Ğ¿ĞºĞ¸"
    ),
    include_data_dirs: Optional[List[str]] = typer.Option(
        None, "--data-dir", "-dd", help=f"Ğ”Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¸Ğ· Data Ğ´Ğ»Ñ Ğ±ÑĞºĞ°Ğ¿Ğ°"
    ),
    db_url: Optional[str] = typer.Option(None, "--db-url", help="URL Ğ‘Ğ” Ğ´Ğ»Ñ Ğ±ÑĞºĞ°Ğ¿Ğ°"),
):
    """ğŸš€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ±ÑĞºĞ°Ğ¿ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¸/Ğ¸Ğ»Ğ¸ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ Ñ…ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼."""
    import time

    start_time = time.time()

    console.print(f"[bold cyan]ğŸš€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ±ÑĞºĞ°Ğ¿Ğ° Ñ‚Ğ¸Ğ¿Ğ°: {backup_type.upper()}[/]")

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ
    if backup_type == "custom" and dest:
        # Ğ”Ğ»Ñ custom Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ»ÑĞ±ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ
        project_root = Path(__file__).resolve().parent.parent
        source_path = project_root
    else:
        # ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ - ĞºĞ¾Ñ€ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
        project_root = Path(__file__).resolve().parent.parent
        source_path = project_root

    # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑŒ Ğ±ÑĞºĞ°Ğ¿Ğ°
    scope_analysis = analyze_backup_scope(source_path)

    # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¸ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
    for warning in scope_analysis["warnings"]:
        console.print(f"[yellow]{warning}[/]")

    for recommendation in scope_analysis["recommendations"]:
        console.print(f"[blue]{recommendation}[/]")

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ‡Ñ‚Ğ¾ Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ‚ÑŒ
    include_files = backup_type in ["full", "files", "custom"]
    include_db = backup_type in ["full", "db"]

    # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    backup_base_dir = _get_backup_base_dir()
    if not backup_base_dir:
        return

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ€Ğ°Ğ±Ğ¾Ñ‡ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ
    working_name = f"unified_{backup_type}_{timestamp}"
    if compress:
        temp_target = backup_base_dir / f"temp_{working_name}"
        final_target = dest or backup_base_dir / f"{working_name}.tar.gz"
        temp_target.mkdir(parents=True, exist_ok=True)
        working_target = temp_target
    else:
        final_target = dest or backup_base_dir / working_name
        final_target = Path(final_target).expanduser().resolve()
        final_target.mkdir(parents=True, exist_ok=True)
        working_target = final_target

    console.print(f"[dim]ğŸ¯ ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ: {final_target}[/]")

    # ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ±ÑĞºĞ°Ğ¿Ğ°
    backup_metadata = {
        "type": f"unified_{backup_type}",
        "timestamp": timestamp,
        "includes_files": include_files,
        "includes_db": include_db,
        "compressed": compress,
        "verify_hashes": verify_hashes,
        "creation_time": datetime.now().isoformat() + "Z",
        "excluded_patterns": [],  # Ğ‘ÑƒĞ´ĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾ Ğ¿Ğ¾Ğ·Ğ¶Ğµ
        "files": {},
        "database": {},
    }

    total_size = 0
    files_count = 0

    # === Ğ­Ğ¢ĞĞŸ 1: Ğ¤ĞĞ™Ğ›Ğ« ===
    if include_files:
        console.print(f"\n[cyan]ğŸ“ Ğ­Ñ‚Ğ°Ğ¿ 1: ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²[/]")

        project_root = Path(__file__).resolve().parent.parent

        # ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ (ĞºÑÑˆ, Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹)
        auto_excludes = [
            # Git Ğ¸ VCS
            ".git",
            ".gitignore",
            ".gitattributes",
            ".hg",
            ".svn",
            
            # Ğ’Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Python
            ".venv",
            "venv",
            ".env",
            "env",
            "ENV",
            "virtualenv",
            ".virtualenv",
            "pyenv",
            ".python-version",
            
            # Python ĞºÑÑˆ Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
            "__pycache__",
            "*.pyc",
            "*.pyo",
            "*.pyd",
            ".Python",
            "*.so",
            ".pytest_cache",
            ".mypy_cache",
            ".coverage",
            ".tox",
            ".nox",
            "htmlcov",
            ".cache",
            "pip-log.txt",
            "pip-delete-this-directory.txt",
            
            # Node.js Ğ¸ JavaScript
            "node_modules",
            "npm-debug.log*",
            "yarn-debug.log*",
            "yarn-error.log*",
            ".npm",
            ".yarn-integrity",
            
            # IDE Ğ¸ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹
            ".vscode",
            ".idea",
            "*.swp",
            "*.swo",
            "*~",
            ".vim",
            ".emacs.d",
            
            # Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
            ".DS_Store",
            ".DS_Store?",
            "._*",
            ".Spotlight-V100",
            ".Trashes",
            "ehthumbs.db",
            "Thumbs.db",
            "Desktop.ini",
            
            # Ğ›Ğ¾Ğ³Ğ¸ Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
            "*.log",
            "logs",
            "*.tmp",
            "*.temp",
            "tmp",
            "temp",
            ".tmp",
            
            # Ğ”Ğ¸ÑÑ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ¸Ğ²Ñ‹ Ğ¸ ÑĞ±Ğ¾Ñ€ĞºĞ¸
            "dist",
            "build",
            "*.egg-info",
            ".eggs",
            "*.egg",
            "*.whl",
            
            # ĞšÑÑˆ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
            "Data/Cache_data",
            "Data/Logs",
            "Data/api/cache",
            "Data/monitor/cache",
            
            # Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¿Ğ¸Ğ¸
            "backup",
            "backups",
            "*.bak",
            "*.backup",
            "temp_*",  # Ğ˜ÑĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ğ¿ĞºĞ¸ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²
            
            # Docker Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹
            ".dockerignore",
            "Dockerfile*",
            "docker-compose*.yml",
            ".docker",
            
            # ĞŸÑ€Ğ¾Ñ‡Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
            ".env.local",
            ".env.*.local",
            "*.orig",
            ".sass-cache",
            ".parcel-cache",
        ]

        if exclude:
            auto_excludes.extend(exclude)

        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ² Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
        backup_metadata["excluded_patterns"] = auto_excludes

        console.print(f"[dim]ğŸš« Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¾: {len(auto_excludes)} ({', '.join(auto_excludes[:5])}...)[/]")

        # Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹
        if verify_hashes:
            console.print("[cyan]ğŸ” Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ñ…ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²...[/]")
            file_hashes = scan_directory(project_root, excludes=auto_excludes)
        else:
            console.print("[cyan]ğŸ“ Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ±ĞµĞ· Ñ…ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ...[/]")
            import fnmatch
            
            file_hashes = {}
            for file in project_root.rglob("*"):
                if file.is_file():
                    rel_path = file.relative_to(project_root).as_posix()
                    
                    # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ñ‚Ñƒ Ğ¶Ğµ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¹
                    excluded = False
                    for exclude in auto_excludes:
                        if "*" in exclude:
                            if fnmatch.fnmatch(rel_path, exclude) or fnmatch.fnmatch(file.name, exclude):
                                excluded = True
                                break
                        elif "/" in exclude:
                            if rel_path.startswith(exclude) or rel_path == exclude:
                                excluded = True
                                break
                        else:
                            path_parts = rel_path.split("/")
                            if exclude in path_parts or exclude == file.name:
                                excluded = True
                                break
                    
                    if not excluded:
                        file_hashes[rel_path] = ""  # ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ñ…ĞµÑˆ

        # ĞŸĞ¾Ğ´ÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€
        for rel_path in file_hashes.keys():
            file_path = project_root / rel_path
            if file_path.exists():
                total_size += file_path.stat().st_size

        files_count = len(file_hashes)
        console.print(f"   ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾: {files_count:,}")
        console.print(f"   ğŸ“Š Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: {total_size / (1024*1024):.1f}MB")

        # ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹
        files_dir = working_target / FILES_BACKUP_DIR_NAME
        files_dir.mkdir(parents=True, exist_ok=True)

        console.print("[cyan]ğŸ“¦ ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²...[/]")
        for rel_path in file_hashes:
            src = project_root / rel_path
            dest_path = files_dir / rel_path
            dest_path.parent.mkdir(parents=True, exist_ok=True)
            shutil.copy2(src, dest_path)

        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ñ…ĞµÑˆĞ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
        if verify_hashes:
            with open(working_target / "file_hashes.json", "w", encoding="utf-8") as f:
                json.dump(file_hashes, f, indent=2)

        backup_metadata["files"] = {
            "count": files_count,
            "total_size": total_size,
            "hashes_enabled": verify_hashes,
        }

    # === Ğ­Ğ¢ĞĞŸ 2: Ğ‘ĞĞ—Ğ Ğ”ĞĞĞĞ«Ğ¥ ===
    if include_db:
        console.print(f"\n[cyan]ğŸ—ƒï¸  Ğ­Ñ‚Ğ°Ğ¿ 2: ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…[/]")

        # ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¸Ğ¿ Ğ‘Ğ”
        db_info = detect_database_type()
        console.print(f"[cyan]ğŸ” ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½ Ñ‚Ğ¸Ğ¿ Ğ‘Ğ”: {db_info['type'].upper()}[/]")

        db_dir = working_target / DB_BACKUP_DIR_NAME
        db_dir.mkdir(parents=True, exist_ok=True)

        db_success = False

        if db_info["type"] == "sqlite":
            console.print(
                "[cyan]ğŸ“„ SQLite Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½ - Ñ„Ğ°Ğ¹Ğ»Ñ‹ ÑƒĞ¶Ğµ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ Ğ² Ğ±ÑĞºĞ°Ğ¿ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²[/]"
            )
            if db_info["detected_files"]:
                console.print(
                    f"[green]âœ… ĞĞ°Ğ¹Ğ´ĞµĞ½Ñ‹ SQLite Ñ„Ğ°Ğ¹Ğ»Ñ‹: {', '.join(db_info['detected_files'])}[/]"
                )

            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»
            sqlite_info = {
                "type": "sqlite",
                "files": db_info["detected_files"],
                "note": "SQLite files are included in files backup",
                "location": db_info["location"],
            }
            with open(db_dir / "sqlite_info.json", "w", encoding="utf-8") as f:
                json.dump(sqlite_info, f, indent=2)

            db_success = True
            backup_metadata["database"] = {
                "type": "sqlite",
                "success": True,
                "files": db_info["detected_files"],
                "backup_method": "included_in_files",
            }

        elif db_info["type"] == "postgresql":
            console.print("[cyan]ğŸ˜ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ±ÑĞºĞ°Ğ¿Ğ° PostgreSQL...[/]")
            pg_dump = _find_system_utility("pg_dump")
            if pg_dump and db_info["location"]:
                dump_file = db_dir / POSTGRES_BACKUP_FILENAME
                cmd = [pg_dump, db_info["location"], "-f", str(dump_file)]
                db_success = _execute_system_command(cmd)
                if db_success:
                    console.print("[green]âœ… PostgreSQL Ğ±ÑĞºĞ°Ğ¿ ÑĞ¾Ğ·Ğ´Ğ°Ğ½[/]")
            else:
                console.print("[red]âŒ pg_dump Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¸Ğ»Ğ¸ URL Ğ‘Ğ” Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½[/]")

        elif db_info["type"] == "mysql":
            console.print("[cyan]ğŸ¬ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ±ÑĞºĞ°Ğ¿Ğ° MySQL...[/]")
            mysqldump = _find_system_utility("mysqldump")
            if mysqldump and db_info["location"]:
                dump_file = db_dir / MYSQL_BACKUP_FILENAME
                # Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°, Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿Ğ°Ñ€ÑĞ¸Ñ‚ÑŒ URL
                console.print(
                    "[yellow]âš ï¸ MySQL Ğ±ÑĞºĞ°Ğ¿ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸[/]"
                )
            else:
                console.print("[red]âŒ mysqldump Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¸Ğ»Ğ¸ URL Ğ‘Ğ” Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½[/]")

        elif db_info["type"] == "none":
            console.print("[yellow]âš ï¸ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ°[/]")
            console.print(
                "[dim]ğŸ’¡ Ğ•ÑĞ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ SQLite, Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ‘Ğ” Ğ±ÑƒĞ´ÑƒÑ‚ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ Ğ² Ğ±ÑĞºĞ°Ğ¿ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²[/]"
            )

        else:
            console.print(f"[yellow]âš ï¸ ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ‘Ğ”: {db_info['type']}[/]")

        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ‘Ğ”
        if "database" not in backup_metadata:
            backup_metadata["database"] = {
                "type": db_info["type"],
                "success": db_success,
                "needs_separate_backup": db_info["needs_separate_backup"],
                "detected_files": db_info["detected_files"],
            }

    # === Ğ­Ğ¢ĞĞŸ 3: ĞœĞ•Ğ¢ĞĞ”ĞĞĞĞ«Ğ• ===
    console.print(f"\n[cyan]ğŸ“‹ Ğ­Ñ‚Ğ°Ğ¿ 3: Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…[/]")

    with open(working_target / "metadata.json", "w", encoding="utf-8") as f:
        json.dump(backup_metadata, f, indent=2, ensure_ascii=False)

    # === Ğ­Ğ¢ĞĞŸ 4: ĞĞ Ğ¥Ğ˜Ğ’ĞĞ¦Ğ˜Ğ¯ ===
    if compress:
        console.print(f"\n[cyan]ğŸ—œï¸ Ğ­Ñ‚Ğ°Ğ¿ 4: ĞÑ€Ñ…Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ[/]")
        final_target = Path(final_target).expanduser().resolve()

        with tarfile.open(final_target, "w:gz") as tar:
            for item in working_target.rglob("*"):
                if item.is_file():
                    arcname = item.relative_to(working_target)
                    tar.add(item, arcname=arcname)

        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ
        shutil.rmtree(working_target)

        # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ÑĞ¶Ğ°Ñ‚Ğ¸Ñ
        archive_size = final_target.stat().st_size
        compression_ratio = (
            (1 - archive_size / total_size) * 100 if total_size > 0 else 0
        )

        console.print(f"   ğŸ“¦ ĞÑ€Ñ…Ğ¸Ğ² ÑĞ¾Ğ·Ğ´Ğ°Ğ½: {final_target.name}")
        console.print(f"   ğŸ“Š Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°: {archive_size / (1024*1024):.1f}MB")
        console.print(f"   ğŸ“ˆ Ğ¡Ğ¶Ğ°Ñ‚Ğ¸Ğµ: {compression_ratio:.1f}%")

    # === Ğ¤Ğ˜ĞĞĞ›Ğ¬ĞĞĞ¯ Ğ¡Ğ¢ĞĞ¢Ğ˜Ğ¡Ğ¢Ğ˜ĞšĞ ===
    end_time = time.time()
    duration = end_time - start_time

    console.print(f"\n[green]ğŸ‰ Ğ‘ÑĞºĞ°Ğ¿ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾![/]")
    console.print(
        Panel.fit(
            f"[green]âœ… Ğ¢Ğ¸Ğ¿:[/] {backup_type.upper()}\n"
            f"[green]ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²:[/] {files_count:,} ({total_size / (1024*1024):.1f}MB)\n"
            f"[green]ğŸ—ƒï¸ Ğ‘Ğ”:[/] {'Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ°' if include_db else 'Ğ½Ğµ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ°'}\n"
            f"[green]ğŸ” Ğ¥ĞµÑˆĞ¸:[/] {'Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹' if verify_hashes else 'Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹'}\n"
            f"[green]â±ï¸ Ğ’Ñ€ĞµĞ¼Ñ:[/] {duration:.1f}Ñ\n"
            f"[green]ğŸ“¦ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:[/] {final_target}",
            title="ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ±ÑĞºĞ°Ğ¿Ğ°",
            border_style="green",
        )
    )


@backup_app.command("list")
def list_backups(
    backup_type: str = typer.Option(
        "all", "--type", "-t", help="Ğ¢Ğ¸Ğ¿ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°: all, files, db, unified"
    ),
    show_hashes: bool = typer.Option(
        False, "--show-hashes", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ…ĞµÑˆĞ°Ñ…"
    ),
):
    """ğŸ“‹ ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²."""
    backup_base_dir = _get_backup_base_dir()
    if not backup_base_dir:
        return

    console.print("[bold cyan]ğŸ“‹ Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²[/]")

    # Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ²ÑĞµ Ğ±ÑĞºĞ°Ğ¿Ñ‹
    backups = []

    # ĞŸĞ¾Ğ¸ÑĞº Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ¾Ğ² .tar.gz
    for backup_file in backup_base_dir.glob("*.tar.gz"):
        try:
            # ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
            with tarfile.open(backup_file, "r:gz") as tar:
                try:
                    metadata_member = tar.getmember("metadata.json")
                    metadata_file = tar.extractfile(metadata_member)
                    metadata = json.load(metadata_file)

                    backup_info = {
                        "name": backup_file.name,
                        "path": backup_file,
                        "type": metadata.get("type", "unknown"),
                        "timestamp": metadata.get("timestamp", "unknown"),
                        "size": backup_file.stat().st_size,
                        "includes_files": metadata.get("includes_files", False),
                        "includes_db": metadata.get("includes_db", False),
                        "compressed": True,
                        "verify_hashes": metadata.get("verify_hashes", False),
                    }
                    backups.append(backup_info)
                except:
                    # Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ±ÑĞºĞ°Ğ¿Ğ°
                    backup_info = {
                        "name": backup_file.name,
                        "path": backup_file,
                        "type": "legacy",
                        "timestamp": "unknown",
                        "size": backup_file.stat().st_size,
                        "includes_files": True,
                        "includes_db": False,
                        "compressed": True,
                        "verify_hashes": False,
                    }
                    backups.append(backup_info)
        except:
            continue

    # ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ°Ğ¿Ğ¾Ğº Ñ Ğ±ÑĞºĞ°Ğ¿Ğ°Ğ¼Ğ¸
    for backup_dir in backup_base_dir.iterdir():
        if backup_dir.is_dir() and not backup_dir.name.startswith("temp_"):
            metadata_file = backup_dir / "metadata.json"
            if metadata_file.exists():
                try:
                    with open(metadata_file, encoding="utf-8") as f:
                        metadata = json.load(f)

                    backup_info = {
                        "name": backup_dir.name,
                        "path": backup_dir,
                        "type": metadata.get("type", "unknown"),
                        "timestamp": metadata.get("timestamp", "unknown"),
                        "size": sum(
                            f.stat().st_size
                            for f in backup_dir.rglob("*")
                            if f.is_file()
                        ),
                        "includes_files": metadata.get("includes_files", False),
                        "includes_db": metadata.get("includes_db", False),
                        "compressed": False,
                        "verify_hashes": metadata.get("verify_hashes", False),
                    }
                    backups.append(backup_info)
                except:
                    continue

    # Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ñƒ
    if backup_type != "all":
        backups = [b for b in backups if backup_type in b["type"]]

    if not backups:
        console.print("[yellow]ğŸ“­ Ğ‘ÑĞºĞ°Ğ¿Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹[/]")
        return

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ
    table = Table(title="ğŸ’¾ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ±ÑĞºĞ°Ğ¿Ñ‹")
    table.add_column("Ğ˜Ğ¼Ñ", style="cyan")
    table.add_column("Ğ¢Ğ¸Ğ¿", style="magenta")
    table.add_column("Ğ Ğ°Ğ·Ğ¼ĞµÑ€", style="green")
    table.add_column("Ğ¤Ğ°Ğ¹Ğ»Ñ‹", style="blue")
    table.add_column("Ğ‘Ğ”", style="red")
    if show_hashes:
        table.add_column("Ğ¥ĞµÑˆĞ¸", style="yellow")
    table.add_column("Ğ”Ğ°Ñ‚Ğ°", style="dim")

    # Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğµ (Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ°)
    backups.sort(key=lambda x: x["timestamp"], reverse=True)

    for backup in backups:
        size_mb = backup["size"] / (1024 * 1024)
        files_icon = "âœ…" if backup["includes_files"] else "âŒ"
        db_icon = "âœ…" if backup["includes_db"] else "âŒ"
        hashes_icon = "ğŸ”" if backup["verify_hashes"] else "âŒ"

        row = [backup["name"], backup["type"], f"{size_mb:.1f}MB", files_icon, db_icon]

        if show_hashes:
            row.append(hashes_icon)

        row.append(backup["timestamp"])
        table.add_row(*row)

    console.print(table)
    console.print(f"\n[dim]Ğ’ÑĞµĞ³Ğ¾ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾: {len(backups)} Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²[/]")


@backup_app.command("restore")
def restore_backup(
    backup_path: str = typer.Argument(..., help="Ğ˜Ğ¼Ñ Ğ¸Ğ»Ğ¸ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ±ÑĞºĞ°Ğ¿Ñƒ Ğ´Ğ»Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ"),
    dest: Path = typer.Argument(..., help="Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ"),
    backup_type: str = typer.Option(
        "auto", "--type", "-t", help="Ğ§Ñ‚Ğ¾ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ñ‚ÑŒ: auto, files, db, all"
    ),
    dry_run: bool = typer.Option(
        False, "--dry-run", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ Ğ±ĞµĞ· Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ"
    ),
    verify_hashes: bool = typer.Option(
        True,
        "--verify-hashes/--no-verify-hashes",
        help="ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ Ñ…ĞµÑˆĞ¸ Ğ¿Ñ€Ğ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸",
    ),
    skip_on_error: bool = typer.Option(
        False, "--skip-on-error", help="ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹"
    ),
    restore_db: bool = typer.Option(
        True, "--db/--no-db", help="Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"
    ),
    db_url: Optional[str] = typer.Option(
        None, "--db-url", help="URL Ğ‘Ğ” Ğ´Ğ»Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ"
    ),
):
    """ğŸ“¥ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¸/Ğ¸Ğ»Ğ¸ Ğ‘Ğ” Ğ¸Ğ· Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ±ÑĞºĞ°Ğ¿Ğ°."""
    backup_path = _resolve_backup_path(backup_path)
    console.print(f"[bold cyan]ğŸ“¥ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·: {backup_path}[/]")

    if dry_run:
        console.print(
            "[bold yellow]ğŸ” Ğ¡Ğ£Ğ¥ĞĞ™ Ğ—ĞĞŸĞ£Ğ¡Ğš: ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ Ñ‡Ñ‚Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾[/]"
        )
    else:
        console.print(f"[bold cyan]ğŸ“¥ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·: {backup_path}[/]")

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ‚Ğ¸Ğ¿ Ğ±ÑĞºĞ°Ğ¿Ğ°
    is_archive = backup_path.suffix == ".gz" and backup_path.suffixes[-2:] == [
        ".tar",
        ".gz",
    ]

    if is_archive:
        console.print("[cyan]ğŸ“¦ ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½ ÑĞ¶Ğ°Ñ‚Ñ‹Ğ¹ Ğ°Ñ€Ñ…Ğ¸Ğ²[/]")
        temp_dir = (
            backup_path.parent
            / f"temp_restore_{datetime.now().strftime('%Y%m%d_%H%M%S')}"
        )
        temp_dir.mkdir(exist_ok=True)

        try:
            with tarfile.open(backup_path, "r:gz") as tar:
                tar.extractall(temp_dir)
            restore_source = temp_dir
            cleanup_temp = True
        except Exception as e:
            console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²ĞºĞ¸: {e}[/]")
            shutil.rmtree(temp_dir, ignore_errors=True)
            return
    else:
        console.print("[cyan]ğŸ“ ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ° Ğ¿Ğ°Ğ¿ĞºĞ° Ñ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ¼[/]")
        restore_source = backup_path
        cleanup_temp = False

    try:
        # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
        metadata_file = restore_source / "metadata.json"
        if metadata_file.exists():
            with open(metadata_file, encoding="utf-8") as f:
                metadata = json.load(f)
        else:
            console.print(
                "[yellow]âš ï¸ ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼[/]"
            )
            metadata = {
                "includes_files": True,
                "includes_db": False,
                "verify_hashes": False,
            }

        # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ‡Ñ‚Ğ¾ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ñ‚ÑŒ
        should_restore_files = backup_type in ["auto", "files", "all"] and metadata.get(
            "includes_files", False
        )
        should_restore_db = (
            backup_type in ["auto", "db", "all"]
            and metadata.get("includes_db", False)
            and restore_db
        )

        console.print(f"[cyan]ğŸ“‹ ĞŸĞ»Ğ°Ğ½ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ:[/]")
        console.print(f"   ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ñ‹: {'âœ…' if should_restore_files else 'âŒ'}")
        console.print(f"   ğŸ—ƒï¸ Ğ‘Ğ”: {'âœ…' if should_restore_db else 'âŒ'}")

        if not should_restore_files and not should_restore_db:
            console.print("[red]âŒ ĞĞµÑ‡ĞµĞ³Ğ¾ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ñ‚ÑŒ![/]")
            return

        if not dry_run:
            dest.mkdir(parents=True, exist_ok=True)

        restored_files = 0
        skipped_files = 0
        hash_errors = []

        # === Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ¤ĞĞ™Ğ›ĞĞ’ ===
        if should_restore_files:
            console.print(f"\n[cyan]ğŸ“ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²[/]")

            files_dir = restore_source / FILES_BACKUP_DIR_NAME
            if files_dir.exists():
                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ…ĞµÑˆĞ¸ ĞµÑĞ»Ğ¸ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾
                file_hashes = {}
                hash_file = restore_source / "file_hashes.json"
                if verify_hashes and hash_file.exists():
                    with open(hash_file, encoding="utf-8") as f:
                        file_hashes = json.load(f)
                    console.print(f"[cyan]ğŸ” Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ Ñ…ĞµÑˆĞµĞ¹: {len(file_hashes)}[/]")

                # Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹
                for src_file in files_dir.rglob("*"):
                    if src_file.is_file():
                        rel_path = src_file.relative_to(files_dir).as_posix()
                        dest_file = dest / rel_path

                        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ…ĞµÑˆ ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
                        if verify_hashes and rel_path in file_hashes:
                            expected_hash = file_hashes[rel_path]
                            if expected_hash:  # ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¿ÑƒÑÑ‚Ñ‹Ğµ Ñ…ĞµÑˆĞ¸
                                actual_hash = sha256(src_file)
                                if actual_hash != expected_hash:
                                    error_msg = f"âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ…ĞµÑˆ: {rel_path}"
                                    hash_errors.append(error_msg)

                                    if skip_on_error:
                                        console.print(
                                            f"[yellow]{error_msg} (Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼)[/]"
                                        )
                                        skipped_files += 1
                                        continue
                                    else:
                                        console.print(f"[red]{error_msg}[/]")
                                        console.print(
                                            f"[red]âŒ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ğ½Ğ¾![/]"
                                        )
                                        return

                        if dry_run:
                            console.print(f"  [cyan]â†’[/] {rel_path}")
                        else:
                            dest_file.parent.mkdir(parents=True, exist_ok=True)
                            shutil.copy2(src_file, dest_file)
                            restored_files += 1

                if not dry_run:
                    console.print(
                        f"[green]âœ… Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: {restored_files}[/]"
                    )
            else:
                console.print("[yellow]âš ï¸ Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ² Ğ±ÑĞºĞ°Ğ¿Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹[/]")

        # === Ğ’ĞĞ¡Ğ¡Ğ¢ĞĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ‘Ğ” ===
        if should_restore_db and not dry_run:
            console.print(f"\n[cyan]ğŸ—ƒï¸ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…[/]")

            db_dir = restore_source / DB_BACKUP_DIR_NAME
            if db_dir.exists():
                db_info = metadata.get("database", {})
                db_type = db_info.get("type", "unknown")

                if db_type == "postgresql":
                    pg_restore = _find_system_utility("psql")
                    dump_file = db_dir / POSTGRES_BACKUP_FILENAME
                    if pg_restore and dump_file.exists():
                        console.print("[cyan]ğŸ˜ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ PostgreSQL...[/]")
                        cmd = [pg_restore, db_url, "-f", str(dump_file)]
                        if _execute_system_command(cmd):
                            console.print("[green]âœ… Ğ‘Ğ” PostgreSQL Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°[/]")
                        else:
                            console.print("[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ PostgreSQL[/]")

                elif db_type == "mysql":
                    mysql = _find_system_utility("mysql")
                    dump_file = db_dir / MYSQL_BACKUP_FILENAME
                    if mysql and dump_file.exists():
                        console.print("[cyan]ğŸ¬ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ MySQL...[/]")
                        # ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½ÑƒÑ Ğ‘Ğ”
                        console.print(
                            "[yellow]âš ï¸ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ MySQL Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸[/]"
                        )
            else:
                console.print("[yellow]âš ï¸ Ğ‘Ğ” Ğ² Ğ±ÑĞºĞ°Ğ¿Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°[/]")

        # === Ğ˜Ğ¢ĞĞ“ĞĞ’ĞĞ¯ Ğ¡Ğ¢ĞĞ¢Ğ˜Ğ¡Ğ¢Ğ˜ĞšĞ ===
        if dry_run:
            console.print(f"\n[yellow]ğŸ” Ğ¡ÑƒÑ…Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½[/]")
        else:
            console.print(f"\n[green]ğŸ‰ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾![/]")
            if verify_hashes and hash_errors:
                console.print(f"[red]âš ï¸ ĞÑˆĞ¸Ğ±Ğ¾Ğº Ñ…ĞµÑˆĞµĞ¹: {len(hash_errors)}[/]")
                if skipped_files:
                    console.print(f"[yellow]â­ï¸ ĞŸÑ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: {skipped_files}[/]")
            elif verify_hashes:
                console.print("[green]ğŸ” Ğ’ÑĞµ Ñ…ĞµÑˆĞ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ñ‹ Ğ¸ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹[/]")

    finally:
        if cleanup_temp:
            shutil.rmtree(temp_dir, ignore_errors=True)


@backup_app.command("verify")
def verify_backup(
    backup_path: str = typer.Argument(..., help="Ğ˜Ğ¼Ñ Ğ¸Ğ»Ğ¸ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ±ÑĞºĞ°Ğ¿Ñƒ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸"),
    checksum: bool = typer.Option(
        True, "--checksum/--no-checksum", help="ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑƒĞ¼Ğ¼Ñ‹ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²"
    ),
):
    """ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ±ÑĞºĞ°Ğ¿Ğ°."""
    backup_path = _resolve_backup_path(backup_path)
    console.print(f"[bold cyan]ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±ÑĞºĞ°Ğ¿Ğ°: {backup_path}[/]")

    # ĞĞ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾ restore - Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ‚Ğ¸Ğ¿ Ğ¸ Ñ€Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²Ñ‹Ğ²Ğ°ĞµĞ¼ ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
    is_archive = backup_path.suffix == ".gz" and backup_path.suffixes[-2:] == [
        ".tar",
        ".gz",
    ]

    if is_archive:
        console.print("[cyan]ğŸ“¦ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¶Ğ°Ñ‚Ğ¾Ğ³Ğ¾ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°[/]")
        temp_dir = (
            backup_path.parent
            / f"temp_verify_{datetime.now().strftime('%Y%m%d_%H%M%S')}"
        )
        temp_dir.mkdir(exist_ok=True)

        try:
            with tarfile.open(backup_path, "r:gz") as tar:
                tar.extractall(temp_dir)
            verify_source = temp_dir
            cleanup_temp = True
        except Exception as e:
            console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ€Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²ĞºĞµ: {e}[/]")
            shutil.rmtree(temp_dir, ignore_errors=True)
            return
    else:
        verify_source = backup_path
        cleanup_temp = False

    try:
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
        metadata_file = verify_source / "metadata.json"
        if not metadata_file.exists():
            console.print("[red]âŒ Ğ¤Ğ°Ğ¹Ğ» metadata.json Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½[/]")
            return

        with open(metadata_file, encoding="utf-8") as f:
            metadata = json.load(f)

        console.print(f"[green]ğŸ“‹ Ğ¢Ğ¸Ğ¿ Ğ±ÑĞºĞ°Ğ¿Ğ°: {metadata.get('type', 'unknown')}[/]")

        errors = []
        total_files = 0
        verified_files = 0

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹
        if metadata.get("includes_files", False):
            console.print(f"[cyan]ğŸ“ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²...[/]")

            files_dir = verify_source / FILES_BACKUP_DIR_NAME
            if files_dir.exists():
                hash_file = verify_source / "file_hashes.json"
                if checksum and hash_file.exists():
                    with open(hash_file, encoding="utf-8") as f:
                        file_hashes = json.load(f)

                    console.print(
                        f"[cyan]ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° {len(file_hashes)} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ñ Ñ…ĞµÑˆĞ°Ğ¼Ğ¸...[/]"
                    )

                    for rel_path, expected_hash in file_hashes.items():
                        total_files += 1
                        file_path = files_dir / rel_path

                        if not file_path.exists():
                            errors.append(f"Ğ¤Ğ°Ğ¹Ğ» Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚: {rel_path}")
                            continue

                        if expected_hash:  # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ¿ÑƒÑÑ‚Ñ‹Ğµ Ñ…ĞµÑˆĞ¸
                            actual_hash = sha256(file_path)
                            if actual_hash != expected_hash:
                                errors.append(f"ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ…ĞµÑˆ: {rel_path}")
                                continue

                        verified_files += 1
                else:
                    console.print(
                        "[yellow]âš ï¸ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ…ĞµÑˆĞµĞ¹ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ° Ğ¸Ğ»Ğ¸ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°[/]"
                    )
                    for file_path in files_dir.rglob("*"):
                        if file_path.is_file():
                            total_files += 1
                            verified_files += 1

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ‘Ğ”
        if metadata.get("includes_db", False):
            console.print(f"[cyan]ğŸ—ƒï¸ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…...[/]")

            db_dir = verify_source / DB_BACKUP_DIR_NAME
            if db_dir.exists():
                db_info = metadata.get("database", {})
                expected_file = db_info.get("backup_file", "")
                if expected_file:
                    db_file = db_dir / expected_file
                    if db_file.exists():
                        console.print(f"[green]âœ… Ğ¤Ğ°Ğ¹Ğ» Ğ‘Ğ” Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: {expected_file}[/]")
                    else:
                        errors.append(f"Ğ¤Ğ°Ğ¹Ğ» Ğ‘Ğ” Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚: {expected_file}")

        # Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
        if errors:
            console.print(f"\n[red]âŒ ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº: {len(errors)}[/]")
            for error in errors[:10]:
                console.print(f"  â€¢ {error}")
            if len(errors) > 10:
                console.print(f"  â€¢ ... Ğ¸ ĞµÑ‰Ñ‘ {len(errors) - 10} Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº")
        else:
            console.print(f"\n[green]âœ… Ğ‘ÑĞºĞ°Ğ¿ Ñ†ĞµĞ»Ğ¾ÑÑ‚ĞµĞ½![/]")
            console.print(f"   ğŸ“ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: {verified_files}/{total_files}")
            if checksum:
                console.print(f"   ğŸ” Ğ’ÑĞµ Ñ…ĞµÑˆĞ¸ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹")

    finally:
        if cleanup_temp:
            shutil.rmtree(temp_dir, ignore_errors=True)


@backup_app.command("info")
def backup_info(
    backup_path: str = typer.Argument(
        ..., help="Ğ˜Ğ¼Ñ Ğ¸Ğ»Ğ¸ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ±ÑĞºĞ°Ğ¿Ñƒ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸"
    )
):
    """ğŸ“Š ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ±ÑĞºĞ°Ğ¿Ğµ."""
    backup_path = _resolve_backup_path(backup_path)
    console.print(f"[bold cyan]ğŸ“Š Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ±ÑĞºĞ°Ğ¿Ğµ: {backup_path}[/]")

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ‚Ğ¸Ğ¿ Ğ±ÑĞºĞ°Ğ¿Ğ° Ğ¸ Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ¼
    is_archive = backup_path.suffix == ".gz" and backup_path.suffixes[-2:] == [
        ".tar",
        ".gz",
    ]

    if is_archive:
        archive_size = backup_path.stat().st_size
        console.print(
            f"[cyan]ğŸ“¦ Ğ¢Ğ¸Ğ¿: Ğ¡Ğ¶Ğ°Ñ‚Ñ‹Ğ¹ Ğ°Ñ€Ñ…Ğ¸Ğ² ({archive_size / (1024*1024):.1f}MB)[/]"
        )

        temp_dir = (
            backup_path.parent / f"temp_info_{datetime.now().strftime('%Y%m%d_%H%M%S')}"
        )
        temp_dir.mkdir(exist_ok=True)

        try:
            with tarfile.open(backup_path, "r:gz") as tar:
                metadata_files = ["metadata.json"]
                for member in tar.getmembers():
                    if member.name in metadata_files:
                        tar.extract(member, temp_dir)

            info_source = temp_dir
            cleanup_temp = True
        except Exception as e:
            console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°: {e}[/]")
            shutil.rmtree(temp_dir, ignore_errors=True)
            return
    else:
        console.print("[cyan]ğŸ“ Ğ¢Ğ¸Ğ¿: ĞŸĞ°Ğ¿ĞºĞ° Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼Ğ¸[/]")
        info_source = backup_path
        cleanup_temp = False

    try:
        metadata_file = info_source / "metadata.json"
        if metadata_file.exists():
            with open(metadata_file, encoding="utf-8") as f:
                metadata = json.load(f)

            # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
            console.print(
                Panel.fit(
                    f"[green]ğŸ·ï¸ Ğ¢Ğ¸Ğ¿:[/] {metadata.get('type', 'unknown')}\n"
                    f"[green]ğŸ“… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½:[/] {metadata.get('timestamp', 'unknown')}\n"
                    f"[green]ğŸ“ Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹:[/] {'âœ…' if metadata.get('includes_files') else 'âŒ'}\n"
                    f"[green]ğŸ—ƒï¸ Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ğ‘Ğ”:[/] {'âœ…' if metadata.get('includes_db') else 'âŒ'}\n"
                    f"[green]ğŸ” Ğ¥ĞµÑˆĞ¸:[/] {'âœ…' if metadata.get('verify_hashes') else 'âŒ'}\n"
                    f"[green]ğŸ—œï¸ Ğ¡Ğ¶Ğ°Ñ‚Ğ¸Ğµ:[/] {'âœ…' if metadata.get('compressed') else 'âŒ'}",
                    title="ğŸ“‹ ĞĞ±Ñ‰Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ",
                    border_style="green",
                )
            )

            # Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ…
            files_info = metadata.get("files", {})
            if files_info:
                console.print(
                    Panel.fit(
                        f"[blue]ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²:[/] {files_info.get('count', 0):,}\n"
                        f"[blue]ğŸ“Š Ğ Ğ°Ğ·Ğ¼ĞµÑ€:[/] {files_info.get('total_size', 0) / (1024*1024):.1f}MB\n"
                        f"[blue]ğŸ” Ğ¥ĞµÑˆĞ¸:[/] {'Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹' if files_info.get('hashes_enabled') else 'Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹'}",
                        title="ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ñ‹",
                        border_style="blue",
                    )
                )

            # Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ‘Ğ”
            db_info = metadata.get("database", {})
            if db_info and db_info.get("type") != "unknown":
                console.print(
                    Panel.fit(
                        f"[red]ğŸ—ƒï¸ Ğ¢Ğ¸Ğ¿ Ğ‘Ğ”:[/] {db_info.get('type', 'unknown')}\n"
                        f"[red]âœ… Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾:[/] {'âœ…' if db_info.get('success') else 'âŒ'}\n"
                        f"[red]ğŸ“„ Ğ¤Ğ°Ğ¹Ğ»:[/] {db_info.get('backup_file', 'Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½')}",
                        title="ğŸ—ƒï¸ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…",
                        border_style="red",
                    )
                )

            console.print("[green]âœ… Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾[/]")
        else:
            console.print("[red]âŒ ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹[/]")

    finally:
        if cleanup_temp:
            shutil.rmtree(temp_dir, ignore_errors=True)


# === Ğ£Ğ›Ğ£Ğ§Ğ¨Ğ•ĞĞĞ«Ğ• Ğ£Ğ¢Ğ˜Ğ›Ğ˜Ğ¢Ğ« ĞĞ‘ĞĞĞ Ğ£Ğ–Ğ•ĞĞ˜Ğ¯ ===


def detect_database_type(path: Optional[Path] = None) -> Dict[str, Any]:
    """ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ."""

    if path is None:
        # ĞŸÑƒÑ‚ÑŒ Ğº ĞºĞ¾Ñ€Ğ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (Ğ³Ğ´Ğµ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ sdb.py)
        search_path = Path(__file__).resolve().parent.parent
    else:
        search_path = path.resolve()

    # ĞŸĞ¾Ğ¸ÑĞº SQLite Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
    sqlite_files = []
    for pattern in ["**/*.db", "**/*.sqlite", "**/*.sqlite3"]:
        sqlite_files.extend(search_path.glob(pattern))

    # Ğ˜ÑĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
    sqlite_files = [
        f
        for f in sqlite_files
        if not any(
            exclude in str(f)
            for exclude in [".git", "__pycache__", ".pytest_cache", ".venv"]
        )
    ]

    if sqlite_files:
        return {
            "type": "sqlite",
            "location": str(sqlite_files[0]),  # Ğ‘ĞµÑ€Ñ‘Ğ¼ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğ¹
            "needs_separate_backup": False,
            "detected_files": [str(f.relative_to(search_path)) for f in sqlite_files],
        }

    # ĞŸĞ¾Ğ¸ÑĞº ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ´Ğ»Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… Ğ‘Ğ”
    config_files = [
        search_path / ".env",
        search_path / ".env.local",
        search_path / "config.py",
        search_path / "settings.py",
    ]

    for config_file in config_files:
        if config_file.exists():
            content = config_file.read_text()

            # ĞŸĞ¾Ğ¸ÑĞº PostgreSQL
            if any(
                keyword in content.lower()
                for keyword in ["postgresql", "postgres", "psycopg"]
            ):
                return {
                    "type": "postgresql",
                    "location": "external_server",
                    "needs_separate_backup": True,
                    "config_file": str(config_file),
                    "detected_files": [],
                }

            # ĞŸĞ¾Ğ¸ÑĞº MySQL
            if any(
                keyword in content.lower()
                for keyword in ["mysql", "pymysql", "mysqlclient"]
            ):
                return {
                    "type": "mysql",
                    "location": "external_server",
                    "needs_separate_backup": True,
                    "config_file": str(config_file),
                    "detected_files": [],
                }

    return {
        "type": "none",
        "location": "not_found",
        "needs_separate_backup": False,
        "detected_files": [],
    }


def analyze_backup_scope(source_path: Path) -> dict:
    """ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑŒ Ğ±ÑĞºĞ°Ğ¿Ğ° Ğ¸ Ğ²Ñ‹Ğ´Ğ°ĞµÑ‚ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸."""
    project_root = Path(__file__).resolve().parent.parent
    analysis = {
        "is_project_root": False,
        "is_external_path": False,
        "includes_project_files": False,
        "missing_important_dirs": [],
        "recommendations": [],
        "warnings": [],
    }

    source_path = source_path.resolve()

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ Ğ¿ÑƒÑ‚ÑŒ ĞºĞ¾Ñ€Ğ½ĞµĞ¼ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
    if source_path == project_root:
        analysis["is_project_root"] = True
        analysis["includes_project_files"] = True

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ğ»Ğ¸ Ğ¿ÑƒÑ‚ÑŒ Ğ²Ğ½Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
    try:
        source_path.relative_to(project_root)
        analysis["is_external_path"] = False
    except ValueError:
        analysis["is_external_path"] = True
        analysis["warnings"].append(
            "âš ï¸ Ğ£ĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ğ’ĞĞ• Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° SwiftDevBot"
        )

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
    important_dirs = [
        ("Systems/core", "ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ´ Ğ±Ğ¾Ñ‚Ğ°"),
        ("Systems/cli", "CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹"),
        ("modules", "ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ±Ğ¾Ñ‚Ğ°"),
        ("Data", "Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°"),
        ("Systems/locales", "Ğ›Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ"),
    ]

    for dir_name, description in important_dirs:
        dir_path = project_root / dir_name
        if dir_path.exists():
            try:
                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ Ğ»Ğ¸ ÑÑ‚Ğ° Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ² Ğ±ÑĞºĞ°Ğ¿
                source_path.relative_to(dir_path.parent)
                if not any(source_path == parent for parent in dir_path.parents):
                    analysis["missing_important_dirs"].append(
                        f"{dir_name} ({description})"
                    )
            except ValueError:
                analysis["missing_important_dirs"].append(f"{dir_name} ({description})")

    # Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
    if analysis["is_external_path"]:
        analysis["recommendations"].append(
            "ğŸ’¡ Ğ”Ğ»Ñ Ğ±ÑĞºĞ°Ğ¿Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° SwiftDevBot Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ ĞºĞ¾Ñ€Ğ½ĞµĞ²ÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°"
        )

    if analysis["missing_important_dirs"]:
        analysis["warnings"].append(
            f"âš ï¸ ĞĞµ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸: {', '.join(analysis['missing_important_dirs'][:3])}"
        )
        analysis["recommendations"].append(
            "ğŸ’¡ Ğ Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ±ÑĞºĞ°Ğ¿Ğ° Ğ²ÑĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°: --type=full Ğ±ĞµĞ· ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ Ğ¿ÑƒÑ‚Ğ¸"
        )

    return analysis


@backup_app.command("check")
def check_project_config(
    path: Optional[Path] = typer.Argument(
        None, help="ĞŸÑƒÑ‚ÑŒ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ - ĞºĞ¾Ñ€ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°)"
    )
):
    """ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ¸ Ğ´Ğ°Ñ‚ÑŒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ±ÑĞºĞ°Ğ¿Ñƒ."""

    if path is None:
        path = Path(__file__).resolve().parent.parent
    else:
        path = path.expanduser().resolve()

    console.print(f"[bold cyan]ğŸ” ĞĞ½Ğ°Ğ»Ğ¸Ğ· ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°: {path}[/]")

    # ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑŒ
    scope_analysis = analyze_backup_scope(path)

    # ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ‘Ğ” Ğ´Ğ»Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿ÑƒÑ‚Ğ¸
    db_info = detect_database_type(path)

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¾Ñ‚Ñ‡ĞµÑ‚
    console.print(
        Panel.fit(
            f"[green]ğŸ“ ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ:[/] {path}\n"
            f"[green]ğŸ  ĞšĞ¾Ñ€ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:[/] {'âœ…' if scope_analysis['is_project_root'] else 'âŒ'}\n"
            f"[green]ğŸŒ Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ Ğ¿ÑƒÑ‚ÑŒ:[/] {'âš ï¸' if scope_analysis['is_external_path'] else 'âœ…'}\n"
            f"[green]ğŸ“ Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:[/] {'âœ…' if scope_analysis['includes_project_files'] else 'âŒ'}",
            title="ğŸ“‹ ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ğ¸ Ğ±ÑĞºĞ°Ğ¿Ğ°",
            border_style="blue",
        )
    )

    console.print(
        Panel.fit(
            f"[green]ğŸ—ƒï¸ Ğ¢Ğ¸Ğ¿ Ğ‘Ğ”:[/] {db_info['type'].upper()}\n"
            f"[green]ğŸ“ ĞœĞµÑÑ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ:[/] {db_info['location'] or 'Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾'}\n"
            f"[green]ğŸ”„ ĞÑƒĞ¶ĞµĞ½ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ±ÑĞºĞ°Ğ¿:[/] {'âœ…' if db_info['needs_separate_backup'] else 'âŒ'}\n"
            f"[green]ğŸ“„ ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ñ„Ğ°Ğ¹Ğ»Ñ‹:[/] {', '.join(db_info['detected_files']) if db_info['detected_files'] else 'Ğ½ĞµÑ‚'}",
            title="ğŸ—ƒï¸ ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ”",
            border_style="green",
        )
    )

    # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ
    if scope_analysis["warnings"]:
        console.print("\n[bold red]âš ï¸ ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ:[/]")
        for warning in scope_analysis["warnings"]:
            console.print(f"  {warning}")

    # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
    if scope_analysis["recommendations"]:
        console.print("\n[bold blue]ğŸ’¡ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸:[/]")
        for recommendation in scope_analysis["recommendations"]:
            console.print(f"  {recommendation}")

    # Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ±ÑĞºĞ°Ğ¿Ñƒ
    console.print(f"\n[bold cyan]ğŸ¯ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ±ÑĞºĞ°Ğ¿Ğ°:[/]")

    if scope_analysis["is_project_root"]:
        console.print("  [green]# ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ±ÑĞºĞ°Ğ¿ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)[/]")
        console.print("  [dim]python sdb.py backup create --type=full[/]")

        if db_info["type"] == "sqlite":
            console.print("\n  [green]# Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ„Ğ°Ğ¹Ğ»Ñ‹ (SQLite ÑƒĞ¶Ğµ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½)[/]")
            console.print("  [dim]python sdb.py backup create --type=files[/]")

        if db_info["needs_separate_backup"]:
            console.print("\n  [green]# Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ‘Ğ” (PostgreSQL/MySQL)[/]")
            console.print(
                "  [dim]python sdb.py backup create --type=db --db-url=Ğ²Ğ°Ñˆ_url[/]"
            )

    else:
        console.print("  [yellow]# ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğ¹ Ğ±ÑĞºĞ°Ğ¿ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿ÑƒÑ‚Ğ¸[/]")
        console.print(f"  [dim]python sdb.py backup create --type=custom {path}[/]")

        console.print("\n  [green]# Ğ‘ÑĞºĞ°Ğ¿ Ğ²ÑĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)[/]")
        console.print("  [dim]python sdb.py backup create --type=full[/]")

    console.print(f"\n[green]âœ… ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½[/]")


@backup_app.command("diff")
def diff_backup(
    backup_path: str = typer.Argument(..., help="Ğ˜Ğ¼Ñ Ğ¸Ğ»Ğ¸ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ±ÑĞºĞ°Ğ¿Ñƒ Ğ´Ğ»Ñ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ"),
    show_details: bool = typer.Option(
        False, "--details", "-d", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ± Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ÑÑ…"
    ),
    check_hashes: bool = typer.Option(
        True, "--check-hashes/--no-check-hashes", help="ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ Ñ…ĞµÑˆĞ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²"
    ),
    ignore_timestamps: bool = typer.Option(
        False, "--ignore-timestamps", help="Ğ˜Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸"
    ),
    exclude: Optional[List[str]] = typer.Option(
        None, "--exclude", "-x", help="Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ"
    ),
):
    """ğŸ” Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğ¼ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ¼."""
    backup_path = _resolve_backup_path(backup_path)
    console.print(f"[bold cyan]ğŸ” Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ñ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ¼: {backup_path}[/]")
    
    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ‚Ğ¸Ğ¿ Ğ±ÑĞºĞ°Ğ¿Ğ°
    is_archive = backup_path.suffix == ".gz" and backup_path.suffixes[-2:] == [".tar", ".gz"]
    
    if is_archive:
        console.print("[cyan]ğŸ“¦ ĞĞ½Ğ°Ğ»Ğ¸Ğ· ÑĞ¶Ğ°Ñ‚Ğ¾Ğ³Ğ¾ Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°...[/]")
        temp_dir = backup_path.parent / f"temp_diff_{datetime.now().strftime('%Y%m%d_%H%M%S')}"
        temp_dir.mkdir(exist_ok=True)
        
        try:
            with tarfile.open(backup_path, "r:gz") as tar:
                tar.extractall(temp_dir)
            backup_source = temp_dir
            cleanup_temp = True
        except Exception as e:
            console.print(f"[red]âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²ĞºĞ¸: {e}[/]")
            shutil.rmtree(temp_dir, ignore_errors=True)
            return
    else:
        console.print("[cyan]ğŸ“ ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ°Ğ¿ĞºĞ¸ Ñ Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ¼...[/]")
        backup_source = backup_path
        cleanup_temp = False
    
    try:
        # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ±ÑĞºĞ°Ğ¿Ğ°
        metadata_file = backup_source / "metadata.json"
        if not metadata_file.exists():
            console.print("[red]âŒ Ğ¤Ğ°Ğ¹Ğ» metadata.json Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ±ÑĞºĞ°Ğ¿Ğµ[/]")
            return
            
        with open(metadata_file, encoding="utf-8") as f:
            backup_metadata = json.load(f)
        
        console.print(f"[green]ğŸ“‹ Ğ¢Ğ¸Ğ¿ Ğ±ÑĞºĞ°Ğ¿Ğ°: {backup_metadata.get('type', 'unknown')}[/]")
        console.print(f"[green]ğŸ“… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½: {backup_metadata.get('timestamp', 'unknown')}[/]")
        
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ· Ğ±ÑĞºĞ°Ğ¿Ğ°
        backup_excludes = backup_metadata.get("excluded_patterns", [])
        if exclude:
            backup_excludes.extend(exclude)
        
        # === Ğ¡Ğ ĞĞ’ĞĞ•ĞĞ˜Ğ• Ğ¤ĞĞ™Ğ›ĞĞ’ ===
        if backup_metadata.get("includes_files", False):
            console.print(f"\n[cyan]ğŸ“ Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²...[/]")
            
            # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ…ĞµÑˆĞ¸ Ğ¸Ğ· Ğ±ÑĞºĞ°Ğ¿Ğ°
            backup_hashes = {}
            hash_file = backup_source / "file_hashes.json"
            if hash_file.exists():
                with open(hash_file, encoding="utf-8") as f:
                    backup_hashes = json.load(f)
            
            # Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
            project_root = Path(__file__).resolve().parent.parent
            console.print("[cyan]ğŸ” Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ...[/]")
            
            if check_hashes and backup_hashes:
                current_hashes = scan_directory(project_root, excludes=backup_excludes)
            else:
                # Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ Ğ±ĞµĞ· Ñ…ĞµÑˆĞµĞ¹ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ
                current_hashes = {}
                import fnmatch
                
                for file in project_root.rglob("*"):
                    if file.is_file():
                        rel_path = file.relative_to(project_root).as_posix()
                        
                        # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
                        excluded = False
                        for excl in backup_excludes:
                            if "*" in excl:
                                if fnmatch.fnmatch(rel_path, excl) or fnmatch.fnmatch(file.name, excl):
                                    excluded = True
                                    break
                            elif "/" in excl:
                                if rel_path.startswith(excl) or rel_path == excl:
                                    excluded = True
                                    break
                            else:
                                path_parts = rel_path.split("/")
                                if excl in path_parts or excl == file.name:
                                    excluded = True
                                    break
                        
                        if not excluded:
                            current_hashes[rel_path] = ""  # ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ñ…ĞµÑˆ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°
            
            # ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ¸Ğ¹
            added_files = []
            deleted_files = []
            modified_files = []
            
            # Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ² Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ, Ğ½Ğ¾ Ğ½Ğµ Ğ² Ğ±ÑĞºĞ°Ğ¿Ğµ (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ)
            for file_path in current_hashes:
                if file_path not in backup_hashes:
                    file_stat = (project_root / file_path).stat()
                    added_files.append({
                        "path": file_path,
                        "size": file_stat.st_size,
                        "modified": datetime.fromtimestamp(file_stat.st_mtime).isoformat(),
                    })
            
            # Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ² Ğ±ÑĞºĞ°Ğ¿Ğµ, Ğ½Ğ¾ Ğ½Ğµ Ğ² Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ (ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½Ğ½Ñ‹Ğµ)
            for file_path in backup_hashes:
                if file_path not in current_hashes:
                    deleted_files.append({
                        "path": file_path,
                        "hash": backup_hashes[file_path][:8] if backup_hashes[file_path] else "no-hash",
                    })
            
            # Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ² Ğ¾Ğ±ĞµĞ¸Ñ… ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ñ… (Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½Ñ‘Ğ½Ğ½Ñ‹Ğµ)
            for file_path in backup_hashes:
                if file_path in current_hashes:
                    current_file = project_root / file_path
                    if current_file.exists():
                        backup_hash = backup_hashes[file_path]
                        current_hash = current_hashes[file_path]
                        
                        # Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ…ĞµÑˆĞ¸ ĞµÑĞ»Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹
                        if check_hashes and backup_hash and current_hash:
                            if backup_hash != current_hash:
                                file_stat = current_file.stat()
                                modified_files.append({
                                    "path": file_path,
                                    "backup_hash": backup_hash[:8],
                                    "current_hash": current_hash[:8],
                                    "size": file_stat.st_size,
                                    "modified": datetime.fromtimestamp(file_stat.st_mtime).isoformat(),
                                    "reason": "hash_different"
                                })
                        elif not check_hashes:
                            # Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñƒ Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
                            file_stat = current_file.stat()
                            backup_files_dir = backup_source / FILES_BACKUP_DIR_NAME / file_path
                            
                            if backup_files_dir.exists():
                                backup_stat = backup_files_dir.stat()
                                size_different = file_stat.st_size != backup_stat.st_size
                                
                                if not ignore_timestamps:
                                    time_different = abs(file_stat.st_mtime - backup_stat.st_mtime) > 2
                                else:
                                    time_different = False
                                
                                if size_different or time_different:
                                    reasons = []
                                    if size_different:
                                        reasons.append("size_different")
                                    if time_different:
                                        reasons.append("time_different")
                                    
                                    modified_files.append({
                                        "path": file_path,
                                        "backup_size": backup_stat.st_size,
                                        "current_size": file_stat.st_size,
                                        "modified": datetime.fromtimestamp(file_stat.st_mtime).isoformat(),
                                        "reason": "+".join(reasons)
                                    })
            
            # === ĞĞ¢ĞĞ‘Ğ ĞĞ–Ğ•ĞĞ˜Ğ• Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢ĞĞ’ ===
            console.print(f"\n[bold green]ğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ:[/]")
            
            # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
            stats_table = Table(title="ğŸ“ˆ Ğ¡Ğ²Ğ¾Ğ´ĞºĞ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹")
            stats_table.add_column("ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ", style="bold")
            stats_table.add_column("ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾", style="cyan")
            stats_table.add_column("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ", style="dim")
            
            stats_table.add_row("âœ… Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾", f"{len(added_files)}", "ĞĞ¾Ğ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ")
            stats_table.add_row("âŒ Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾", f"{len(deleted_files)}", "Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ")
            stats_table.add_row("ğŸ”„ Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾", f"{len(modified_files)}", "Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¸ÑÑŒ")
            
            console.print(stats_table)
            
            # ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ ĞµÑĞ»Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½Ğ°
            if show_details:
                if added_files:
                    console.print(f"\n[bold green]âœ… Ğ”ĞĞ‘ĞĞ’Ğ›Ğ•ĞĞĞ«Ğ• Ğ¤ĞĞ™Ğ›Ğ« ({len(added_files)}):[/]")
                    added_table = Table()
                    added_table.add_column("Ğ¤Ğ°Ğ¹Ğ»", style="green")
                    added_table.add_column("Ğ Ğ°Ğ·Ğ¼ĞµÑ€", style="cyan")
                    added_table.add_column("Ğ˜Ğ·Ğ¼ĞµĞ½Ñ‘Ğ½", style="dim")
                    
                    for file_info in added_files[:20]:  # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿ĞµÑ€Ğ²Ñ‹Ğµ 20
                        size_mb = file_info["size"] / (1024 * 1024) if file_info["size"] > 1024*1024 else file_info["size"]
                        size_str = f"{size_mb:.1f}MB" if file_info["size"] > 1024*1024 else f"{file_info['size']}B"
                        added_table.add_row(
                            file_info["path"],
                            size_str,
                            file_info["modified"][:16]
                        )
                    
                    console.print(added_table)
                    if len(added_files) > 20:
                        console.print(f"[dim]... Ğ¸ ĞµÑ‰Ñ‘ {len(added_files) - 20} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²[/]")
                
                if deleted_files:
                    console.print(f"\n[bold red]âŒ Ğ£Ğ”ĞĞ›ĞĞĞĞ«Ğ• Ğ¤ĞĞ™Ğ›Ğ« ({len(deleted_files)}):[/]")
                    deleted_table = Table()
                    deleted_table.add_column("Ğ¤Ğ°Ğ¹Ğ»", style="red")
                    deleted_table.add_column("Ğ¥ĞµÑˆ (Ğ±ÑĞºĞ°Ğ¿)", style="dim")
                    
                    for file_info in deleted_files[:20]:
                        deleted_table.add_row(
                            file_info["path"],
                            file_info["hash"]
                        )
                    
                    console.print(deleted_table)
                    if len(deleted_files) > 20:
                        console.print(f"[dim]... Ğ¸ ĞµÑ‰Ñ‘ {len(deleted_files) - 20} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²[/]")
                
                if modified_files:
                    console.print(f"\n[bold yellow]ğŸ”„ Ğ˜Ğ—ĞœĞ•ĞĞĞĞĞ«Ğ• Ğ¤ĞĞ™Ğ›Ğ« ({len(modified_files)}):[/]")
                    modified_table = Table()
                    modified_table.add_column("Ğ¤Ğ°Ğ¹Ğ»", style="yellow")
                    modified_table.add_column("ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°", style="magenta")
                    
                    if check_hashes:
                        modified_table.add_column("Ğ¥ĞµÑˆ (Ğ±ÑĞºĞ°Ğ¿)", style="dim")
                        modified_table.add_column("Ğ¥ĞµÑˆ (Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹)", style="cyan")
                    else:
                        modified_table.add_column("Ğ Ğ°Ğ·Ğ¼ĞµÑ€ (Ğ±ÑĞºĞ°Ğ¿)", style="dim")
                        modified_table.add_column("Ğ Ğ°Ğ·Ğ¼ĞµÑ€ (Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹)", style="cyan")
                    
                    for file_info in modified_files[:20]:
                        if check_hashes:
                            modified_table.add_row(
                                file_info["path"],
                                file_info["reason"],
                                file_info.get("backup_hash", "N/A"),
                                file_info.get("current_hash", "N/A")
                            )
                        else:
                            backup_size = file_info.get("backup_size", 0)
                            current_size = file_info.get("current_size", 0)
                            backup_size_str = f"{backup_size}B" if backup_size < 1024*1024 else f"{backup_size/(1024*1024):.1f}MB"
                            current_size_str = f"{current_size}B" if current_size < 1024*1024 else f"{current_size/(1024*1024):.1f}MB"
                            
                            modified_table.add_row(
                                file_info["path"],
                                file_info["reason"],
                                backup_size_str,
                                current_size_str
                            )
                    
                    console.print(modified_table)
                    if len(modified_files) > 20:
                        console.print(f"[dim]... Ğ¸ ĞµÑ‰Ñ‘ {len(modified_files) - 20} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²[/]")
            else:
                # ĞšÑ€Ğ°Ñ‚ĞºĞ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
                if added_files:
                    console.print(f"[green]âœ… Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: {len(added_files)} (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ --details Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚ĞµĞ¹)[/]")
                if deleted_files:
                    console.print(f"[red]âŒ Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: {len(deleted_files)} (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ --details Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚ĞµĞ¹)[/]")
                if modified_files:
                    console.print(f"[yellow]ğŸ”„ Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: {len(modified_files)} (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ --details Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚ĞµĞ¹)[/]")
            
            # Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°
            total_changes = len(added_files) + len(deleted_files) + len(modified_files)
            if total_changes == 0:
                console.print(f"\n[bold green]ğŸ‰ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ‡Ğ½Ğ° Ğ±ÑĞºĞ°Ğ¿Ñƒ![/]")
            else:
                console.print(f"\n[bold yellow]âš ï¸ ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ {total_changes} Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ[/]")
                
                # Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
                if len(added_files) > 10 or len(modified_files) > 10:
                    console.print(f"[blue]ğŸ’¡ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ±ÑĞºĞ°Ğ¿ Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹[/]")
                    console.print(f"[dim]   python3 sdb.py backup create --type=full[/]")
        
        else:
            console.print("[yellow]âš ï¸ Ğ‘ÑĞºĞ°Ğ¿ Ğ½Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ´Ğ»Ñ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ[/]")
        
        # === Ğ¡Ğ ĞĞ’ĞĞ•ĞĞ˜Ğ• Ğ‘ĞĞ—Ğ« Ğ”ĞĞĞĞ«Ğ¥ ===
        if backup_metadata.get("includes_db", False):
            console.print(f"\n[cyan]ğŸ—ƒï¸ Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…...[/]")
            
            # Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ‘Ğ”
            backup_db = backup_metadata.get("database", {})
            current_db = detect_database_type()
            
            console.print(f"[dim]Ğ¢Ğ¸Ğ¿ Ğ‘Ğ” Ğ² Ğ±ÑĞºĞ°Ğ¿Ğµ: {backup_db.get('type', 'unknown')}[/]")
            console.print(f"[dim]Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ‘Ğ”: {current_db.get('type', 'unknown')}[/]")
            
            if backup_db.get("type") != current_db.get("type"):
                console.print("[yellow]âš ï¸ Ğ¢Ğ¸Ğ¿ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»ÑÑ![/]")
            
            if current_db.get("type") == "sqlite":
                # Ğ”Ğ»Ñ SQLite ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñ‹ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ‘Ğ”
                current_db_files = current_db.get("detected_files", [])
                backup_db_files = backup_db.get("files", [])
                
                if set(current_db_files) != set(backup_db_files):
                    console.print("[yellow]ğŸ”„ Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¸ÑÑŒ[/]")
                    console.print(f"   Ğ‘ÑĞºĞ°Ğ¿: {backup_db_files}")
                    console.print(f"   Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğµ: {current_db_files}")
                else:
                    console.print("[green]âœ… Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ±ÑĞºĞ°Ğ¿Ñƒ[/]")
            else:
                console.print("[blue]ğŸ’¡ Ğ”Ğ»Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… Ğ‘Ğ” Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğµ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ¼Ğ¿Ğ¾Ğ²[/]")
        
    finally:
        if cleanup_temp:
            shutil.rmtree(temp_dir, ignore_errors=True)
    
    console.print(f"\n[green]âœ… Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾[/]")

def _resolve_backup_path(backup_path: Union[str, Path]) -> Path:
    """ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ğ°Ğ±ÑĞ¾Ğ»ÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ±ÑĞºĞ°Ğ¿Ñƒ Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸ Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¼Ñƒ/Ğ°Ğ±ÑĞ¾Ğ»ÑÑ‚Ğ½Ğ¾Ğ¼Ñƒ Ğ¿ÑƒÑ‚Ğ¸."""
    p = Path(backup_path)
    if p.exists():
        return p.resolve()
    # Ğ•ÑĞ»Ğ¸ Ğ¿ÑƒÑ‚ÑŒ Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¸ Ğ½Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ / â€” Ğ¸Ñ‰ĞµĞ¼ Ğ² backup/
    if not p.is_absolute() and '/' not in str(p):
        backup_dir = _get_backup_base_dir()
        candidate = backup_dir / p
        if candidate.exists():
            return candidate.resolve()
    # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ â€” Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ
    return p.resolve()

# --- ĞšĞ¾Ğ½ĞµÑ† backup_unified.py ---



======================================================================

------------------------------ FILE: Systems/cli/db.py ------------------------------
# cli_commands/db_cmd.py

import asyncio
import os
import subprocess
import sys
from pathlib import Path
from typing import Optional

import typer
from rich.console import Console
from rich.panel import Panel
from sqlalchemy import MetaData, create_engine, select
from sqlalchemy import types as sa_types
from sqlalchemy import types as sa_types

console = Console()

db_app = typer.Typer(
    name="db",
    help="ğŸ—„ï¸ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸ Alembic.",
    rich_markup_mode="rich",
)

# ĞšĞ¾Ñ€ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ÑÑ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ° (__file__)
# Systems/cli/db.py -> Systems/cli/ -> Systems/ -> PROJECT_ROOT
PROJECT_ROOT_FROM_DB_CMD = Path(__file__).resolve().parent.parent.parent
ALEMBIC_INI_PATH_STR = str(PROJECT_ROOT_FROM_DB_CMD / "alembic.ini")


def _run_alembic_command(
    args: list[str], suppress_success_output: bool = False
) -> bool:
    try:
        alembic_ini_actual_path = Path(ALEMBIC_INI_PATH_STR)
        if not alembic_ini_actual_path.is_file():
            console.print(
                f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ¤Ğ°Ğ¹Ğ» ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Alembic '{ALEMBIC_INI_PATH_STR}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.[/]"
            )
            console.print(
                f"  Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ¸Ğ· ĞºĞ¾Ñ€Ğ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ¸Ğ»Ğ¸ Ğ¿ÑƒÑ‚ÑŒ Ğº alembic.ini ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚ĞµĞ½."
            )
            return False

        command = ["alembic", "-c", ALEMBIC_INI_PATH_STR] + args

        env = os.environ.copy()
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ¾Ñ€ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ² PYTHONPATH, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Alembic Ğ¼Ğ¾Ğ³ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ core Ğ¸ Modules
        # Ğ­Ñ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾, Ñ‚Ğ°Ğº ĞºĞ°Ğº env.py Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ SDB
        existing_python_path = env.get("PYTHONPATH", "")
        project_root_str = str(PROJECT_ROOT_FROM_DB_CMD)

        if existing_python_path:
            # Ğ£Ğ±ĞµĞ´Ğ¸Ğ¼ÑÑ, Ñ‡Ñ‚Ğ¾ project_root_str Ğ½Ğµ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ, ĞµÑĞ»Ğ¸ Ğ¾Ğ½ ÑƒĞ¶Ğµ ĞµÑÑ‚ÑŒ
            path_parts = existing_python_path.split(os.pathsep)
            if project_root_str not in path_parts:
                env["PYTHONPATH"] = (
                    f"{project_root_str}{os.pathsep}{existing_python_path}"
                )
            else:  # Ğ£Ğ¶Ğµ ĞµÑÑ‚ÑŒ, Ğ½Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼
                env["PYTHONPATH"] = existing_python_path
        else:
            env["PYTHONPATH"] = project_root_str

        # Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ÑƒĞ±ĞµĞ´Ğ¸Ğ¼ÑÑ, Ñ‡Ñ‚Ğ¾ sys.path Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ½ Ğ² Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ, ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾
        # (ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾ PYTHONPATH Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾)
        # current_sys_path_str = os.pathsep.join(s.strip() for s in sys.path if s.strip())
        # env["PYTHONPATH"] = f"{current_sys_path_str}{os.pathsep}{env.get('PYTHONPATH', '')}"

        process = subprocess.run(
            command,
            capture_output=True,
            text=True,
            encoding="utf-8",
            env=env,
            cwd=str(PROJECT_ROOT_FROM_DB_CMD),  # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¸Ğ· ĞºĞ¾Ñ€Ğ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
        )

        if process.stdout and not (process.returncode == 0 and suppress_success_output):
            console.print(process.stdout.strip())

        if process.stderr:
            is_actual_error_in_stderr = (
                "error" in process.stderr.lower()
                or "fail" in process.stderr.lower()
                or "traceback" in process.stderr.lower()
                or "critical" in process.stderr.lower()
            )

            if process.returncode != 0 or is_actual_error_in_stderr:
                console.print(f"[bold red]Alembic STDERR:[/]\n{process.stderr.strip()}")
            elif not (process.returncode == 0 and suppress_success_output):
                console.print(
                    f"[dim yellow]Alembic STDERR (info/warnings):[/]\n{process.stderr.strip()}"
                )

        if process.returncode != 0:
            console.print(
                f"[bold red]ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Alembic Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»Ğ°ÑÑŒ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹ (ĞºĞ¾Ğ´: {process.returncode}). ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ²Ñ‹Ğ²Ğ¾Ğ´ Ğ²Ñ‹ÑˆĞµ.[/]"
            )
            return False
        return True

    except FileNotFoundError:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° 'alembic' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°.[/]")
        console.print(
            "Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ Alembic ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ² Ğ²Ğ°ÑˆĞµĞ¼ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğ¸ Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ¼ PATH."
        )
        console.print(f"ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ: [cyan]pip install alembic[/]")
        return False
    except Exception as e:
        console.print(
            f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Alembic: {e}[/]"
        )
        return False


@db_app.command(
    name="upgrade",
    help="ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Alembic (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ´Ğ¾ 'head', Ñ‚.Ğµ. Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹).",
)
def db_upgrade_cmd(
    revision: str = typer.Argument(
        "head",
        help="ID Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 'head', 'base', specific_id, '+1', '-2').",
    )
):
    console.print(
        f"Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Alembic Ğ´Ğ¾ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸: [cyan]{revision}[/]..."
    )
    if not _run_alembic_command(["upgrade", revision]):
        raise typer.Exit(code=1)
    console.print(f"[bold green]ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° 'db upgrade {revision}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°.[/]")


@db_app.command(name="downgrade", help="ĞÑ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Alembic.")
def db_downgrade_cmd(
    revision: str = typer.Argument(
        "1",
        help="ID Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 'base', specific_id) Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, '1' Ğ´Ğ»Ñ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹, '2' Ğ´Ğ»Ñ Ğ´Ğ²ÑƒÑ… Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ…). Ğ”Ğ»Ñ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ° Ğ½Ğ° Ğ¾Ğ´Ğ½Ñƒ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ñ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ‚Ğ°ĞºĞ¶Ğµ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ '-1'.",
    )
):
    target_revision = revision
    if revision.isdigit():
        target_revision = f"-{revision}"
        description_log = f"Ğ½Ğ° {revision} Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ñ(Ğ¸) Ğ½Ğ°Ğ·Ğ°Ğ´ (Ğ´Ğ¾ {target_revision})"
    else:
        description_log = f"Ğ´Ğ¾ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸ '{revision}'"

    console.print(f"Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ° Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Alembic {description_log}...")
    if typer.confirm(
        f"Ğ’Ñ‹ [bold red]Ğ£Ğ’Ğ•Ğ Ğ•ĞĞ«[/], Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ {description_log}? Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²ĞµÑÑ‚Ğ¸ Ğº Ğ¿Ğ¾Ñ‚ĞµÑ€Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….",
        abort=True,
    ):
        if not _run_alembic_command(["downgrade", revision]):
            raise typer.Exit(code=1)
        console.print(
            f"[bold green]ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° 'db downgrade {revision}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°.[/]"
        )


@db_app.command(name="revision", help="Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Alembic.")
def db_revision_cmd(
    message: str = typer.Option(
        ...,
        "-m",
        "--message",
        help="ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸ (Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾).",
    ),
    autogenerate: bool = typer.Option(
        True,
        "--autogenerate/--no-autogenerate",
        help="ĞŸĞ¾Ğ¿Ñ‹Ñ‚Ğ°Ñ‚ÑŒÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»ÑÑ… (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ).",
    ),
):
    args = ["revision"]
    if autogenerate:
        args.append("--autogenerate")
    args.extend(["-m", message])

    console.print(
        f"Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸ Alembic Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ĞµĞ¼: '[cyan]{message}[/]' (autogenerate: {autogenerate})..."
    )
    if not _run_alembic_command(args):
        raise typer.Exit(code=1)
    console.print(
        f"[bold green]ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° 'db revision' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°. ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ğ² 'alembic_migrations/versions/'.[/]"
    )


@db_app.command(name="status", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ¸ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ.")
def db_status_cmd(
    verbose: bool = typer.Option(
        False, "--verbose", "-v", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ğ»ĞµĞµ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ²Ğ¾Ğ´."
    )
):
    """
    ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Alembic.
    ĞĞµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ BOT_TOKEN - Alembic ÑĞ°Ğ¼ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ‘Ğ” Ñ‡ĞµÑ€ĞµĞ· env.py ĞºĞ¾Ğ³Ğ´Ğ° Ğ½ÑƒĞ¶Ğ½Ğ¾.
    """
    console.print(
        Panel(
            "[bold blue]Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Alembic (ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° 'current')[/]",
            expand=False,
            border_style="blue",
        )
    )
    current_args = ["current"]
    if verbose:
        current_args.append("--verbose")

    success_current = _run_alembic_command(
        current_args, suppress_success_output=verbose
    )
    if not success_current:
        console.print(
            "[yellow]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ Alembic (Alembic current).[/yellow]"
        )

    console.print(
        Panel(
            "[bold blue]Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Alembic (ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° 'history')[/]",
            expand=False,
            border_style="blue",
            style="blue",
        )
    )
    history_args = ["history"]
    if not _run_alembic_command(history_args):
        console.print(
            "[yellow]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Alembic (Alembic history).[/yellow]"
        )


@db_app.command(
    name="init-core",
    help="[ĞĞŸĞĞ¡ĞĞ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° Ğ¸ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ñ‹Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ, Ğ¼Ğ¸Ğ½ÑƒÑ Alembic.",
)
def db_init_core_cmd():
    console.print(
        Panel(
            "[bold yellow]Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† ÑĞ´Ñ€Ğ° SDB Ğ¸ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ[/]",
            expand=False,
            border_style="yellow",
        )
    )
    console.print(
        "[bold red]ĞŸĞ Ğ•Ğ”Ğ£ĞŸĞ Ğ•Ğ–Ğ”Ğ•ĞĞ˜Ğ•:[/bold red] Ğ­Ñ‚Ğ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° Ğ¸ Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ, Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒÑ Alembic."
    )
    if typer.confirm(
        "Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° Ğ¸ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ?",
        abort=True,
    ):
        try:
            from Systems.core.app_settings import load_app_settings
            from Systems.core.database.manager import DBManager
            from Systems.core.rbac.service import RBACService
            from Systems.core.services_provider import BotServicesProvider
            from Systems.core.module_loader import ModuleLoader

            settings = load_app_settings()

            async def _init_core_data_task_runner():
                nonlocal settings
                console.print(
                    f"Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ‘Ğ”: {settings.db.type} (URL ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑÑ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº)."
                )
                db_m = DBManager(db_settings=settings.db, app_settings=settings)
                try:
                    await db_m.initialize()

                    console.print(
                        "Ğ’Ñ‹Ğ·Ğ¾Ğ² DBManager.create_all_core_tables() Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† ÑĞ´Ñ€Ğ°..."
                    )
                    await db_m.create_all_core_tables()
                    console.print(
                        "[bold green]Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ´Ñ€Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ (Ğ¸Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ»Ğ¸).[/]"
                    )

                    console.print("ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹...")
                    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ BotServicesProvider Ğ´Ğ»Ñ RBACService
                    # (Ğ½ÑƒĞ¶ĞµĞ½ Ğ´Ğ»Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹)
                    services = BotServicesProvider(settings=settings)
                    services._db_manager = db_m
                    
                    # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ ModuleLoader Ğ´Ğ»Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
                    module_loader = ModuleLoader(settings=settings, services_provider=services)
                    module_loader.scan_all_available_modules()
                    services._module_loader = module_loader
                    
                    rbac_s = RBACService(services=services)
                    async with db_m.get_session() as session:
                        roles_count, core_perms_count, mod_perms_count = await rbac_s.ensure_default_entities_exist(session)
                        await session.commit()
                        
                        if roles_count > 0 or core_perms_count > 0 or mod_perms_count > 0:
                            console.print(
                                f"[bold green]Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾: {roles_count} Ñ€Ğ¾Ğ»ĞµĞ¹, {core_perms_count} Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ ÑĞ´Ñ€Ğ°, {mod_perms_count} Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹.[/bold green]"
                            )
                        else:
                            console.print(
                                "[dim]Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ»Ğ¸ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸ RBACService).[/dim]"
                            )
                except Exception as e_task:
                    console.print(
                        f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸: {e_task}[/]"
                    )
                    import traceback
                    console.print(f"[dim]{traceback.format_exc()}[/]")
                    raise
                finally:
                    await db_m.dispose()

            asyncio.run(_init_core_data_task_runner())
            console.print("\n[bold green]ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° 'db init-core' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°.[/]")
            console.print(
                "[yellow]Ğ’ĞĞ–ĞĞ: Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ»Ğ¸ Alembic Ñ€Ğ°Ğ½ĞµĞµ, ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¼.[/]"
            )
            console.print(
                "  [yellow]Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ 'sdb db stamp head', Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Alembic Ñ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ ÑÑ…ĞµĞ¼Ğ¾Ğ¹ Ğ‘Ğ”.[/]"
            )
            console.print(
                "  [yellow]Ğ”ĞµĞ»Ğ°Ğ¹Ñ‚Ğµ ÑÑ‚Ğ¾, Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ²Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ‚ĞµĞºÑƒÑ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° Ğ‘Ğ” ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ¹ 'Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğ¹'.[/]"
            )

        except ImportError as e_imp:
            console.print(
                f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ°: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ ÑĞ´Ñ€Ğ° Ğ´Ğ»Ñ 'db init-core': {e_imp}[/]"
            )
            raise typer.Exit(code=1)
        except Exception as e:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸ 'db init-core': {e}[/]")
            raise typer.Exit(code=1)


@db_app.command(
    name="stamp", help="Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ñ Alembic Ğ² Ğ‘Ğ”, Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑÑ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸."
)
def db_stamp_cmd(
    revision: str = typer.Argument(
        ..., help="ID Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸ Ğ´Ğ»Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 'head', 'base', specific_id)."
    ),
    purge: bool = typer.Option(
        False,
        "--purge",
        help="ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ²ĞµÑ€ÑĞ¸Ğ¹ Alembic Ğ¿ĞµÑ€ĞµĞ´ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¾Ğ¹ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸ (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ñ Ğ¾ÑÑ‚Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒÑ!).",
    ),
):
    console.print(
        f"Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸ Alembic: [cyan]{revision}[/]"
        + ("[bold yellow] Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¾Ğ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ²ĞµÑ€ÑĞ¸Ğ¹[/]" if purge else "")
    )
    if purge:
        if not typer.confirm(
            f"[bold red]Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•: ĞĞ¿Ñ†Ğ¸Ñ --purge Ğ£Ğ”ĞĞ›Ğ˜Ğ¢ Ğ’Ğ¡Ğ• Ğ—ĞĞŸĞ˜Ğ¡Ğ˜ Ğ¸Ğ· Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ²ĞµÑ€ÑĞ¸Ğ¹ Alembic Ğ¿ĞµÑ€ĞµĞ´ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¾Ğ¹ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ğ¸ '{revision}'. Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²ĞµÑÑ‚Ğ¸ Ğº Ğ¿Ğ¾Ñ‚ĞµÑ€Ğµ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ² Ğ‘Ğ”. ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ?",
            abort=True,
        ):
            return

    args = ["stamp"]
    if purge:
        args.append("--purge")
    args.append(revision)

    if not _run_alembic_command(args):
        raise typer.Exit(code=1)
    console.print(
        f"[bold green]ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° 'db stamp {revision}{' --purge' if purge else ''}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°.[/]"
    )


@db_app.command(
    name="migrate-sqlite",
    help="ğŸ“¦ ĞœĞ¸Ğ³Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· SQLite Ğ² PostgreSQL/MySQL Ğ¿Ğ¾ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¼Ñƒ DSN.",
)
def db_migrate_sqlite_to_postgres(
    source_sqlite: Optional[Path] = typer.Option(
        None,
        "--source",
        "-s",
        help="ĞŸÑƒÑ‚ÑŒ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ SQLite (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ±ĞµÑ€Ñ‘Ñ‚ÑÑ Ğ¸Ğ· Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº ÑĞ´Ñ€Ğ°).",
    ),
    target_dsn: Optional[str] = typer.Option(
        None,
        "--target",
        "-t",
        help="DSN PostgreSQL (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ±ĞµÑ€Ñ‘Ñ‚ÑÑ Ğ¸Ğ· db.pg_dsn).",
    ),
    confirm: bool = typer.Option(
        False,
        "--confirm",
        "-y",
        help="ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ±ĞµĞ· Ğ»Ğ¸ÑˆĞ½ĞµĞ³Ğ¾ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ°.",
    ),
):
    """ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ Ğ²ÑĞµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ¸Ğ· SQLite Ğ² PostgreSQL, ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ."""
    console.print(Panel("[bold cyan]ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ SQLite â†’ PostgreSQL[/]", expand=False))

    from Systems.core.app_settings import load_app_settings

    settings = load_app_settings()

    sqlite_path = Path(source_sqlite or settings.db.sqlite_path)
    if not sqlite_path.exists():
        candidates = [
            PROJECT_ROOT_FROM_DB_CMD / sqlite_path,
            settings.core.project_data_path / sqlite_path,
            PROJECT_ROOT_FROM_DB_CMD / "Data" / sqlite_path,
        ]
        for candidate in candidates:
            if candidate.exists():
                sqlite_path = candidate
                break

    if not sqlite_path.exists():
        console.print(f"[bold red]SQLite-Ñ„Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: {sqlite_path}[/bold red]")
        raise typer.Exit(code=1)

    target_dsn_final = target_dsn
    target_type = "postgresql"
    if not target_dsn_final:
        if settings.db.type == "postgresql" and settings.db.pg_dsn:
            target_dsn_final = str(settings.db.pg_dsn)
            target_type = "postgresql"
        elif settings.db.type == "mysql" and settings.db.mysql_dsn:
            target_dsn_final = str(settings.db.mysql_dsn)
            target_type = "mysql"
        else:
            console.print(
                "[bold red]DSN Ğ´Ğ»Ñ PostgreSQL/MySQL Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½ Ğ½Ğ¸ Ğ² --target, Ğ½Ğ¸ Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğµ (db.pg_dsn Ğ¸Ğ»Ğ¸ db.mysql_dsn).[/bold red]"
            )
            raise typer.Exit(code=1)
    else:
        if "postgresql" in target_dsn_final:
            target_type = "postgresql"
        elif target_dsn_final.startswith("mysql"):
            target_type = "mysql"
        else:
            console.print(
                "[bold red]ĞĞµĞ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ target DSN. ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ postgresql/mysql.[/bold red]"
            )
            raise typer.Exit(code=1)


    if not confirm:
        target_label = (
            "PostgreSQL" if target_type == "postgresql" else "MySQL"
        )
        if not typer.confirm(
            f"ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑˆĞµÑ‚ {target_label} ({target_dsn_final}). ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ?",
            abort=True,
        ):
            return

    console.print(f"[green]Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº:[/green] {sqlite_path}")
    console.print(f"[green]Ğ¦ĞµĞ»ÑŒ:[/green] {target_dsn_final}")

    sqlite_url = f"sqlite:///{sqlite_path}"
    src_engine = create_engine(sqlite_url, future=True)
    dst_engine = create_engine(target_dsn_final, future=True)

    src_meta = MetaData()
    try:
        src_meta.reflect(bind=src_engine)
    except Exception as e_reflect:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ SQLite-ÑÑ…ĞµĞ¼Ñ‹: {e_reflect}[/bold red]")
        raise typer.Exit(code=1)

    if not src_meta.tables:
        console.print("[yellow]SQLite Ğ¿ÑƒÑÑ‚ (Ğ½ĞµÑ‚ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†). ĞĞµÑ‡ĞµĞ³Ğ¾ Ğ¿ĞµÑ€ĞµĞ½Ğ¾ÑĞ¸Ñ‚ÑŒ.[/yellow]")
        return

    dst_meta = MetaData()
    for table in src_meta.sorted_tables:
        if table.name.startswith("sqlite_"):
            continue
        for column in table.columns:
            if isinstance(column.type, sa_types.DATETIME):
                if target_type == "postgresql":
                    column.type = sa_types.TIMESTAMP()
                elif target_type == "mysql":
                    column.type = sa_types.DATETIME()
            elif isinstance(column.type, sa_types.BLOB):
                column.type = sa_types.LargeBinary()
        table.tometadata(dst_meta)

    console.print("[cyan]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ² PostgreSQL (ĞµÑĞ»Ğ¸ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚)â€¦[/cyan]")
    try:
        dst_meta.create_all(bind=dst_engine, checkfirst=True)
    except Exception as e_create:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†: {e_create}[/bold red]")
        raise typer.Exit(code=1)

    console.print("[cyan]ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµâ€¦[/cyan]")
    with src_engine.connect() as src_conn, dst_engine.begin() as dst_conn:
        for table in src_meta.sorted_tables:
            if table.name.startswith("sqlite_"):
                continue
            rows = src_conn.execute(select(table)).mappings().all()
            if not rows:
                continue
            dst_table = dst_meta.tables.get(table.name)
            if dst_table is None:
                console.print(f"[yellow]Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° {table.name} Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ² PostgreSQL â€” Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼.[/yellow]")
                continue
            dst_conn.execute(dst_table.insert(), rows)
            console.print(f"[green]ĞŸĞµÑ€ĞµĞ½ĞµÑĞµĞ½Ğ¾ {len(rows)} ÑÑ‚Ñ€Ğ¾Ğº Ğ² {table.name}[/green]")

    console.print("[bold green]ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°.[/bold green]")
    console.print(
        "[dim]Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ±Ğ¾Ñ‚Ğ° Ğ¸ Ğ¿Ñ€Ğ¸ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ 'sdb db upgrade head'.[/dim]"
    )



======================================================================

------------------------------ FILE: Systems/cli/system.py ------------------------------
# cli_commands/system_cmd.py

import json
import os
import platform
import shutil
import signal
import subprocess
import sys
import tarfile
import time
from datetime import datetime
from pathlib import Path
from typing import List, Optional

import typer
from rich.console import Console
from rich.panel import Panel

# Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾ĞºĞ°Ğ½ÑŒÑ Ğ² Ñ‚ĞµÑÑ‚Ğ°Ñ…
try:
    from Systems.cli.utils import get_settings_only_for_cli
    from Systems.core.app_settings import PROJECT_ROOT_DIR, settings
except ImportError:
    # Fallback Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ²
    settings = None
    get_settings_only_for_cli = None
    PROJECT_ROOT_DIR = Path.cwd()

# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
system_app = typer.Typer(help="Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ´Ğ»Ñ SwiftDevBot.")
console = Console()


def _show_basic_system_info(settings):
    """ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ±Ğ°Ğ·Ğ¾Ğ²ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ Ğ±ĞµĞ· Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²."""
    console.print("\n[bold cyan]Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ:[/bold cyan]")

    # Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ‘Ğ”
    console.print(f"[bold]Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:[/bold] {settings.db.type}")
    if settings.db.type == "sqlite":
        db_path = settings.core.project_data_path / (
            settings.db.sqlite_path or "Database_files/swiftdevbot.db"
        )
        db_exists = db_path.exists()
        console.print(f"[bold]Ğ¤Ğ°Ğ¹Ğ» Ğ‘Ğ”:[/bold] {db_path} {'âœ…' if db_exists else 'âŒ'}")

    # Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸ÑÑ…
    dirs_to_check = [
        ("Ğ›Ğ¾Ğ³Ğ¸", settings.core.project_data_path / "Logs"),
        ("ĞšÑÑˆ", settings.core.project_data_path / "Cache_data"),
        ("Ğ‘ÑĞºĞ°Ğ¿Ñ‹", settings.core.project_data_path / "core_backups"),
        ("ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³", settings.core.project_data_path / "Config"),
    ]

    for name, path in dirs_to_check:
        exists = path.exists()
        console.print(f"[bold]{name}:[/bold] {path} {'âœ…' if exists else 'âŒ'}")

    # Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ĞºÑÑˆĞµ
    cache_type = getattr(settings.cache, "type", "memory")
    console.print(f"[bold]Ğ¢Ğ¸Ğ¿ ĞºÑÑˆĞ°:[/bold] {cache_type}")

    # Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ… (Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº)
    try:
        enabled_modules_path = (
            settings.core.project_data_path / settings.core.enabled_modules_config_path
        )
        if enabled_modules_path.exists():
            with open(enabled_modules_path, "r") as f:
                enabled_modules = json.load(f)
            console.print(
                f"[bold]ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹:[/bold] {len(enabled_modules)} Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹"
            )
        else:
            console.print(f"[bold]ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹:[/bold] Ñ„Ğ°Ğ¹Ğ» Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½")
    except Exception as e:
        console.print(f"[bold]ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹:[/bold] Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ ({e})")


@system_app.command(name="info", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ SwiftDevBot.")
def info_cmd():
    """
    ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸.
    Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ±ĞµĞ· BOT_TOKEN.
    """
    try:
        settings = get_settings_only_for_cli()  # ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ±ĞµĞ· Ñ‚Ğ¾ĞºĞµĞ½Ğ°
        _show_basic_system_info(settings)
    except Exception as e:
        console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸: {e}[/red]")
        raise typer.Exit(1)


@system_app.command(name="update", help="ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ SwiftDevBot Ğ´Ğ¾ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸.")
def update_cmd(
    branch: str = typer.Option("main", "--branch", "-b", help="Ğ’ĞµÑ‚ĞºĞ° Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ."),
    backup: bool = typer.Option(
        True, "--backup/--no-backup", help="Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½ÑƒÑ ĞºĞ¾Ğ¿Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼."
    ),
    restart: bool = typer.Option(
        False, "--restart", "-r", help="ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ."
    ),
):
    """ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ´Ğ¾ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸."""
    try:
        settings = settings  # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹
        root_dir = PROJECT_ROOT_DIR

        console.print(
            f"[bold blue]ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ SwiftDevBot Ñ Ğ²ĞµÑ‚ĞºĞ¸ '{branch}'...[/bold blue]"
        )

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸ ĞµÑĞ»Ğ¸ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ
        if backup:
            console.print("[yellow]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸...[/yellow]")
            backup_name = (
                f"backup_before_update_{datetime.now().strftime('%Y%m%d_%H%M%S')}"
            )
            backup_path = (
                settings.core.project_data_path
                / "core_backups"
                / f"{backup_name}.tar.gz"
            )
            backup_path.parent.mkdir(parents=True, exist_ok=True)

            # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ°Ñ€Ñ…Ğ¸Ğ² Ñ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸ÑĞ¼Ğ¸
            with tarfile.open(backup_path, "w:gz") as tar:

                def filter_func(tarinfo):
                    # Ğ˜ÑĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¸ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸
                    if any(
                        exclude in tarinfo.name
                        for exclude in [
                            ".git",
                            "__pycache__",
                            ".pytest_cache",
                            "node_modules",
                            "venv",
                            ".env",
                        ]
                    ):
                        return None
                    return tarinfo

                tar.add(root_dir, arcname=".", filter=filter_func)

            console.print(f"[green]Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ¿Ğ¸Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°: {backup_path}[/green]")

        # Git pull Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
        console.print("[blue]Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹...[/blue]")
        result = subprocess.run(
            ["git", "pull", "origin", branch],
            cwd=root_dir,
            capture_output=True,
            text=True,
        )

        if result.returncode != 0:
            console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸: {result.stderr}[/red]")
            raise typer.Exit(1)

        console.print("[green]ĞšĞ¾Ğ´ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½![/green]")

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
        requirements_path = root_dir / "requirements.txt"
        if requirements_path.exists():
            console.print("[blue]ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹...[/blue]")
            result = subprocess.run(
                [
                    sys.executable,
                    "-m",
                    "pip",
                    "install",
                    "-r",
                    str(requirements_path),
                    "--upgrade",
                ],
                capture_output=True,
                text=True,
            )

            if result.returncode == 0:
                console.print("[green]Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹![/green]")
            else:
                console.print(
                    f"[yellow]ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹: {result.stderr}[/yellow]"
                )

        # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ‘Ğ”
        console.print("[blue]ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ‘Ğ”...[/blue]")
        try:
            result = subprocess.run(
                [sys.executable, "-m", "alembic", "upgrade", "head"],
                cwd=root_dir,
                capture_output=True,
                text=True,
            )

            if result.returncode == 0:
                console.print("[green]ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ñ‹![/green]")
            else:
                console.print(
                    f"[yellow]ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹: {result.stderr}[/yellow]"
                )
        except Exception as e:
            console.print(f"[yellow]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸: {e}[/yellow]")

        console.print("[bold green]âœ… ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾![/bold green]")

        if restart:
            console.print("[blue]ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº Ğ±Ğ¾Ñ‚Ğ°...[/blue]")
            try:
                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ»Ğ¸ Ğ±Ğ¾Ñ‚
                import signal
                import subprocess
                import time

                # Ğ˜Ñ‰ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ±Ğ¾Ñ‚Ğ°
                result = subprocess.run(
                    ["pgrep", "-f", "run_bot.py"], capture_output=True, text=True
                )
                if result.returncode == 0:
                    pid = int(result.stdout.strip())
                    console.print(f"[yellow]ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ±Ğ¾Ñ‚ (PID: {pid})...[/yellow]")

                    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ SIGTERM Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ
                    os.kill(pid, signal.SIGTERM)
                    time.sleep(3)

                    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»ÑÑ Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ
                    try:
                        os.kill(pid, 0)  # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°
                        console.print(
                            "[yellow]ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ½Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»ÑÑ, Ğ¿Ñ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ...[/yellow]"
                        )
                        os.kill(pid, signal.SIGKILL)
                        time.sleep(1)
                    except ProcessLookupError:
                        pass  # ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»ÑÑ

                # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ±Ğ¾Ñ‚ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾
                console.print("[green]Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ±Ğ¾Ñ‚...[/green]")
                subprocess.Popen(
                    [sys.executable, "run_bot.py"],
                    cwd=settings.core.project_root_path,
                    stdout=subprocess.DEVNULL,
                    stderr=subprocess.DEVNULL,
                )

                console.print("[bold green]âœ… Ğ‘Ğ¾Ñ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½![/bold green]")

            except Exception as restart_error:
                console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞµ: {restart_error}[/red]")
                console.print(
                    "[yellow]ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ±Ğ¾Ñ‚ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ: python run_bot.py[/yellow]"
                )

    except Exception as e:
        console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸: {e}[/red]")
        raise typer.Exit(1)


@system_app.command(name="rollback", help="ĞÑ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ SwiftDevBot Ğº Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸.")
def rollback_cmd(
    backup_name: str = typer.Argument(
        ..., help="Ğ˜Ğ¼Ñ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ."
    ),
    confirm: bool = typer.Option(
        False, "--confirm", "-y", help="ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚ĞºĞ°Ñ‚ Ğ±ĞµĞ· Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²."
    ),
):
    """ĞÑ‚ĞºĞ°Ñ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğº Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸ Ğ¸Ğ· Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸."""
    try:
        settings = settings  # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹
        root_dir = PROJECT_ROOT_DIR

        # ĞŸĞ¾Ğ¸ÑĞº Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸
        backup_path = (
            settings.core.project_data_path / "core_backups" / f"{backup_name}.tar.gz"
        )
        if not backup_path.exists():
            # ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ±ĞµĞ· Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ
            backup_path = settings.core.project_data_path / "core_backups" / backup_name
            if not backup_path.exists():
                console.print(f"[red]Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ¿Ğ¸Ñ '{backup_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°![/red]")
                console.print("\n[blue]Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¿Ğ¸Ğ¸:[/blue]")
                backup_dir = settings.core.project_data_path / "core_backups"
                if backup_dir.exists():
                    for backup in backup_dir.glob("*.tar.gz"):
                        console.print(f"  â€¢ {backup.stem}")
                raise typer.Exit(1)

        console.print(f"[yellow]ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ° Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ¿Ğ¸Ñ: {backup_path}[/yellow]")

        # ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
        if not confirm:
            confirm_rollback = typer.confirm(
                "âš ï¸  Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•! ĞÑ‚ĞºĞ°Ñ‚ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ²ÑĞµ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹. ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ?"
            )
            if not confirm_rollback:
                console.print("[blue]ĞÑ‚ĞºĞ°Ñ‚ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼.[/blue]")
                raise typer.Exit(0)

        console.print("[bold red]ğŸ”„ Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ¾Ñ‚ĞºĞ°Ñ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹...[/bold red]")

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
        temp_backup_name = (
            f"temp_before_rollback_{datetime.now().strftime('%Y%m%d_%H%M%S')}"
        )
        temp_backup_path = (
            settings.core.project_data_path
            / "core_backups"
            / f"{temp_backup_name}.tar.gz"
        )

        console.print("[blue]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ...[/blue]")
        with tarfile.open(temp_backup_path, "w:gz") as tar:
            tar.add(
                root_dir,
                arcname=".",
                exclude=lambda path: any(ex in path for ex in [".git", "__pycache__"]),
            )

        # Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸
        console.print("[blue]Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¸Ğ· Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸...[/blue]")
        with tarfile.open(backup_path, "r:gz") as tar:
            tar.extractall(path=root_dir, filter="data")

        console.print("[green]âœ… Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¸Ğ· Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¿Ğ¸Ğ¸![/green]")
        console.print(f"[blue]Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ ĞºĞ¾Ğ¿Ğ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ°: {temp_backup_path}[/blue]")
        console.print(
            "[bold yellow]ĞĞµ Ğ·Ğ°Ğ±ÑƒĞ´ÑŒÑ‚Ğµ Ñ‚Ğ°ĞºĞ¶Ğµ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ‘Ğ” (`sdb db downgrade ...`) Ğ¸ Python-Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸, ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾![/bold yellow]"
        )

    except Exception as e:
        console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğµ: {e}[/red]")
        raise typer.Exit(1)


@system_app.command(
    name="status", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ²."
)
def status_cmd():
    """ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹."""
    try:
        # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ¸Ğ· Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ°

        console.print("\n[bold cyan]Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ SwiftDevBot:[/bold cyan]")

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
        root_dir = PROJECT_ROOT_DIR

        main_files = [
            ("ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»", root_dir / "sdb.py"),
            ("Ğ¤Ğ°Ğ¹Ğ» Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°", root_dir / "run_bot.py"),
            (
                "ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ",
                settings.core.project_data_path / "Config" / "core_settings.yaml",
            ),
        ]

        for name, path in main_files:
            exists = path.exists()
            console.print(f"[bold]{name}:[/bold] {'âœ…' if exists else 'âŒ'} {path}")

        # Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ
        console.print(
            f"\n[bold]ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°:[/bold] {platform.system()} {platform.release()}"
        )
        console.print(f"[bold]Python Ğ²ĞµÑ€ÑĞ¸Ñ:[/bold] {platform.python_version()}")
        console.print(f"[bold]ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°:[/bold] {platform.machine()}")

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Git ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
        try:
            result = subprocess.run(
                ["git", "rev-parse", "--short", "HEAD"],
                cwd=root_dir,
                capture_output=True,
                text=True,
            )

            if result.returncode == 0:
                commit_hash = result.stdout.strip()
                console.print(f"[bold]Git ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚:[/bold] {commit_hash}")

                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ
                result = subprocess.run(
                    ["git", "status", "--porcelain"],
                    cwd=root_dir,
                    capture_output=True,
                    text=True,
                )

                if result.stdout.strip():
                    console.print("[yellow]âš ï¸ Ğ•ÑÑ‚ÑŒ Ğ½ĞµĞ·Ğ°Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ[/yellow]")
                else:
                    console.print("[green]âœ… Ğ Ğ°Ğ±Ğ¾Ñ‡Ğ°Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ‡Ğ¸ÑÑ‚Ğ°Ñ[/green]")
        except:
            console.print("[yellow]Git Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°[/yellow]")

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° VPN ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
        console.print(f"\n[bold cyan]VPN Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:[/bold cyan]")
        try:
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ systemd ÑĞµÑ€Ğ²Ğ¸Ñ
            result = subprocess.run(
                ["systemctl", "is-active", "--quiet", "swiftdevbot-vpn.service"],
                capture_output=True,
            )

            if result.returncode == 0:
                console.print("[green]âœ… VPN ÑĞµÑ€Ğ²Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½[/green]")

                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ VPN Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ
                result = subprocess.run(
                    ["ip", "addr", "show", "tun1"], capture_output=True, text=True
                )

                if result.returncode == 0:
                    console.print("[green]âœ… VPN Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½[/green]")

                    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ IP
                    try:
                        result = subprocess.run(
                            [
                                "curl",
                                "-s",
                                "--connect-timeout",
                                "5",
                                "https://icanhazip.com",
                            ],
                            capture_output=True,
                            text=True,
                        )

                        if result.returncode == 0 and result.stdout.strip():
                            external_ip = result.stdout.strip()
                            console.print(f"[bold]Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ IP:[/bold] {external_ip}")

                            if external_ip == "31.202.91.112":
                                console.print(
                                    "[green]ğŸ‰ ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· ASUS Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¾![/green]"
                                )
                            else:
                                console.print(
                                    "[yellow]âš ï¸ IP Ğ½Ğµ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ğ¾Ğ¼Ñƒ[/yellow]"
                                )
                    except:
                        console.print("[yellow]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ IP[/yellow]")
                else:
                    console.print("[red]âŒ VPN Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½[/red]")
            else:
                console.print("[red]âŒ VPN ÑĞµÑ€Ğ²Ğ¸Ñ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½[/red]")
        except Exception as vpn_error:
            console.print(
                f"[yellow]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ VPN ÑÑ‚Ğ°Ñ‚ÑƒÑ: {vpn_error}[/yellow]"
            )

        _show_basic_system_info(settings)

    except Exception as e:
        console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°: {e}[/red]")
        raise typer.Exit(1)


@system_app.command(name="vpn", help="ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ VPN Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ.")
def vpn_status_cmd():
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° VPN Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ."""
    try:
        # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ½Ğ°Ñˆ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ VPN
        result = subprocess.run(
            [str(PROJECT_ROOT_DIR / "scripts" / "check_vpn_status.sh")],
            capture_output=True,
            text=True,
        )

        if result.returncode == 0:
            console.print(result.stdout)
        else:
            console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ VPN: {result.stderr}[/red]")
            raise typer.Exit(1)

    except Exception as e:
        console.print(f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ VPN ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°: {e}[/red]")
        raise typer.Exit(1)



======================================================================

------------------------------ FILE: Systems/cli/utils.py ------------------------------
# --- ĞĞĞ§ĞĞ›Ğ Ğ¤ĞĞ™Ğ›Ğ cli/utils.py ---
import asyncio
import json
import os
import platform
import shutil
import subprocess
import tempfile
import time
from datetime import datetime, timedelta
from functools import wraps
from pathlib import Path
from typing import Any, Dict, List, Optional, Tuple

import psutil
import typer
import yaml
from rich.console import Console
from rich.panel import Panel
from rich.progress import Progress, SpinnerColumn, TextColumn
from rich.table import Table

# --- ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ Ğ² CLI ---
PROJECT_ROOT = Path(__file__).resolve().parent.parent.parent
USER_CONFIG_DIR_NAME = "Config"
USER_CORE_CONFIG_FILENAME = "core_settings.yaml"
USER_MODULES_CONFIG_DIR_NAME = "modules_settings"

sdb_console = Console()


# --- Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ´Ğ»Ñ CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ ---
def timing_decorator(func):
    """Ğ”ĞµĞºĞ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ CLI."""

    @wraps(func)
    def wrapper(*args, **kwargs):
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ timing Ğ² kwargs
        show_timing = kwargs.pop("timing", False) if "timing" in kwargs else False

        if show_timing:
            start_time = time.time()
            start_datetime = datetime.now()
            sdb_console.print(
                f"[dim cyan]â° ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ: {start_datetime.strftime('%H:%M:%S.%f')[:-3]}[/]"
            )

        try:
            result = func(*args, **kwargs)

            if show_timing:
                end_time = time.time()
                end_datetime = datetime.now()
                duration = end_time - start_time
                sdb_console.print(
                    f"[dim cyan]â° ĞĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ğµ: {end_datetime.strftime('%H:%M:%S.%f')[:-3]}[/]"
                )
                sdb_console.print(
                    f"[bold green]âš¡ Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ: {duration:.3f} ÑĞµĞºÑƒĞ½Ğ´[/]"
                )

            return result

        except Exception as e:
            if show_timing:
                end_time = time.time()
                duration = end_time - start_time
                sdb_console.print(
                    f"[bold red]âŒ ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»Ğ°ÑÑŒ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹ Ñ‡ĞµÑ€ĞµĞ· {duration:.3f} ÑĞµĞºÑƒĞ½Ğ´[/]"
                )
            raise e

    return wrapper


# Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ğ¿Ñ†Ğ¸Ğ¸ --timing Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ¼
def add_timing_option():
    """Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¾Ğ¿Ñ†Ğ¸Ñ --timing Ğº CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ."""
    return typer.Option(
        False, "--timing", "-t", help="ğŸ“Š ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ²Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹."
    )


# Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ timing Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ
def with_timing(help_text: str):
    """
    Ğ”ĞµĞºĞ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€-Ñ…ĞµĞ»Ğ¿ĞµÑ€ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ timing Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ.

    Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:
    @app.command(**with_timing("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹"))
    @timing_decorator
    def my_command(timing: bool = add_timing_option()):
        pass
    """
    return {"name": None, "help": help_text}


# Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
def measure_time(operation_name: str = "ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ"):
    """
    ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ.

    Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:
    with measure_time("Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"):
        # ĞºĞ¾Ğ´ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
        pass
    """

    class TimingContext:
        def __init__(self, name):
            self.name = name

        def __enter__(self):
            self.start_time = time.time()
            start_datetime = datetime.now()
            sdb_console.print(
                f"[dim cyan]â° {self.name} - ĞĞ°Ñ‡Ğ°Ğ»Ğ¾: {start_datetime.strftime('%H:%M:%S.%f')[:-3]}[/]"
            )
            return self

        def __exit__(self, exc_type, exc_val, exc_tb):
            end_time = time.time()
            duration = end_time - self.start_time
            end_datetime = datetime.now()

            if exc_type is None:
                sdb_console.print(
                    f"[dim cyan]â° {self.name} - ĞĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ğµ: {end_datetime.strftime('%H:%M:%S.%f')[:-3]}[/]"
                )
                sdb_console.print(
                    f"[bold green]âš¡ {self.name}: {duration:.3f} ÑĞµĞºÑƒĞ½Ğ´[/]"
                )
            else:
                sdb_console.print(
                    f"[bold red]âŒ {self.name} Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»Ğ°ÑÑŒ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹ Ñ‡ĞµÑ€ĞµĞ· {duration:.3f} ÑĞµĞºÑƒĞ½Ğ´[/]"
                )

    return TimingContext(operation_name)


# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Typer-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚
utils_app = typer.Typer(
    name="utils",
    help="ğŸ› ï¸ Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ°Ñ€Ğ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ SwiftDevBot",
    rich_markup_mode="rich",
)

# --- Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ YAML ---


def get_yaml_editor():
    """Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€ ruamel.yaml.YAML Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ²."""
    try:
        from ruamel.yaml import YAML

        yaml_editor = YAML()
        yaml_editor.indent(mapping=2, sequence=4, offset=2)
        yaml_editor.preserve_quotes = True
        return yaml_editor
    except ImportError:
        sdb_console.print(
            "[yellow]ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ: Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° 'ruamel.yaml' Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°. ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² YAML Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ… Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ ÑƒÑ‚ĞµÑ€ÑĞ½Ñ‹ Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ ĞµĞµ: `pip install ruamel.yaml`[/yellow]"
        )
        return None


def read_yaml_file(path: Path) -> Optional[Dict[str, Any]]:
    """Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ YAML Ñ„Ğ°Ğ¹Ğ», Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°Ñ ĞµĞ³Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ ĞºĞ°Ğº ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ."""
    if not path.is_file():
        return None
    try:
        editor = get_yaml_editor()
        if editor:
            return editor.load(path)
        else:
            with open(path, "r", encoding="utf-8") as f:
                return yaml.safe_load(f)
    except Exception as e:
        sdb_console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ YAML Ñ„Ğ°Ğ¹Ğ»Ğ° {path}: {e}[/bold red]")
        return None


def _convert_pydantic_objects_to_serializable(data: Any) -> Any:
    """Ğ ĞµĞºÑƒÑ€ÑĞ¸Ğ²Ğ½Ğ¾ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ pydantic Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹ Ğ² ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·ÑƒĞµĞ¼Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹."""
    from pathlib import Path

    try:
        from pydantic import HttpUrl
        from pydantic_core import Url

        if isinstance(data, dict):
            return {
                key: _convert_pydantic_objects_to_serializable(value)
                for key, value in data.items()
            }
        elif isinstance(data, list):
            return [_convert_pydantic_objects_to_serializable(item) for item in data]
        elif isinstance(data, Path):
            return str(data)
        elif hasattr(data, "__class__") and data.__class__.__name__ in (
            "HttpUrl",
            "Url",
        ):
            return str(data)
        else:
            return data
    except ImportError:
        # Ğ•ÑĞ»Ğ¸ pydantic Ğ½Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ
        return data


def write_yaml_file(path: Path, data: Dict[str, Any]) -> bool:
    """Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ Ğ² YAML Ñ„Ğ°Ğ¹Ğ»."""
    try:
        path.parent.mkdir(parents=True, exist_ok=True)

        # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ pydantic Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹ Ğ² ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·ÑƒĞµĞ¼Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹
        serializable_data = _convert_pydantic_objects_to_serializable(data)

        editor = get_yaml_editor()
        if editor:
            with open(path, "w", encoding="utf-8") as f:
                editor.dump(serializable_data, f)
        else:
            with open(path, "w", encoding="utf-8") as f:
                yaml.dump(
                    serializable_data, f, indent=2, sort_keys=False, allow_unicode=True
                )
        return True
    except Exception as e:
        sdb_console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ YAML Ñ„Ğ°Ğ¹Ğ»Ğ° {path}: {e}[/bold red]")
        return False


# --- Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¸Ğ· ÑÑ‚Ğ°Ñ€Ğ¾Ğ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸ ---


async def get_sdb_services_for_cli(
    init_db: bool = False,
    init_rbac: bool = False,
) -> Tuple[Optional[Any], Optional[Any], Optional[Any]]:
    """Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² SDB."""
    settings_instance: Optional[Any] = None
    db_manager_instance: Optional[Any] = None
    rbac_service_instance: Optional[Any] = None

    try:
        from Systems.core.app_settings import settings

# ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑƒĞ¶Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹
        settings_instance = settings
        if init_db or init_rbac:
            from Systems.core.database.manager import DBManager

            db_m = DBManager(db_settings=settings.db, app_settings=settings)
            await db_m.initialize()
            db_manager_instance = db_m
            if init_rbac and db_manager_instance:
                from Systems.core.rbac.service import RBACService

                rbac_service_instance = RBACService(
                    services=None, db_manager=db_manager_instance
                )
        return settings_instance, db_manager_instance, rbac_service_instance
    except ImportError as e:
        raise
    except Exception as e:
        if db_manager_instance:
            await db_manager_instance.dispose()
        raise


async def get_db_only_for_cli():
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ DBManager Ğ±ĞµĞ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº (Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ±Ğ¾Ñ‚Ğ°)."""
    from pathlib import Path

    import yaml

    from Systems.core.app_settings import PROJECT_ROOT_DIR

    # ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ‘Ğ”
    Data_path = PROJECT_ROOT_DIR / "Data"
    config_file = Data_path / "Config" / "core_settings.yaml"

    # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ‘Ğ” Ğ¸Ğ· YAML
    db_config = {"type": "sqlite", "sqlite_path": "Database_files/swiftdevbot.db"}
    if config_file.exists():
        try:
            with open(config_file, "r", encoding="utf-8") as f:
                yaml_data = yaml.safe_load(f) or {}
                if "db" in yaml_data:
                    db_config.update(yaml_data["db"])
        except Exception:
            pass  # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ñ‹

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ‘Ğ”
    from Systems.core.app_settings import DBSettings
    from Systems.core.database.manager import DBManager

    # ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿ÑƒÑ‚ÑŒ Ğº SQLite
    if db_config["type"] == "sqlite":
        sqlite_path = db_config["sqlite_path"]
        if not Path(sqlite_path).is_absolute():
            if not sqlite_path.startswith("Database_files/"):
                sqlite_path = f"Database_files/{sqlite_path}"
            sqlite_path = str(Data_path / sqlite_path)
        db_config["sqlite_path"] = sqlite_path

    db_settings = DBSettings(**db_config)

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ DBManager Ñ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸
    class MinimalAppSettings:
        def __init__(self):
            self.db = db_settings

    app_settings = MinimalAppSettings()
    db_manager = DBManager(db_settings=db_settings, app_settings=app_settings)
    await db_manager.initialize()
    return db_manager


async def get_db_with_core_config_for_cli():
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ DBManager + Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ core Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ (Ğ´Ğ»Ñ super_admins Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸)."""
    from pathlib import Path

    import yaml

    from Systems.core.app_settings import PROJECT_ROOT_DIR

    # ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ‘Ğ” + core
    Data_path = PROJECT_ROOT_DIR / "Data"
    config_file = Data_path / "Config" / "core_settings.yaml"

    # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ‘Ğ” Ğ¸ core Ğ¸Ğ· YAML
    db_config = {"type": "sqlite", "sqlite_path": "Database_files/swiftdevbot.db"}
    core_config = {"super_admins": []}

    if config_file.exists():
        try:
            with open(config_file, "r", encoding="utf-8") as f:
                yaml_data = yaml.safe_load(f) or {}
                if "db" in yaml_data:
                    db_config.update(yaml_data["db"])
                if "core" in yaml_data:
                    core_config.update(yaml_data["core"])
        except Exception:
            pass  # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ñ‹

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº
    from Systems.core.app_settings import CoreAppSettings, DBSettings
    from Systems.core.database.manager import DBManager

    # ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿ÑƒÑ‚ÑŒ Ğº SQLite
    if db_config["type"] == "sqlite":
        sqlite_path = db_config["sqlite_path"]
        if not Path(sqlite_path).is_absolute():
            if not sqlite_path.startswith("Database_files/"):
                sqlite_path = f"Database_files/{sqlite_path}"
            sqlite_path = str(Data_path / sqlite_path)
        db_config["sqlite_path"] = sqlite_path

    db_settings = DBSettings(**db_config)
    core_settings = CoreAppSettings(
        Data_path=Data_path,
        super_admins=core_config.get("super_admins", []),
    )

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ DBManager Ñ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸
    class MinimalAppSettingsWithCore:
        def __init__(self):
            self.db = db_settings
            self.core = core_settings

    app_settings = MinimalAppSettingsWithCore()
    db_manager = DBManager(db_settings=db_settings, app_settings=app_settings)
    await db_manager.initialize()
    return db_manager, core_settings


def confirm_action(
    prompt_message: str, default_choice: bool = False, abort_on_false: bool = True
) -> bool:
    """ĞĞ±Ñ‰Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ."""
    return typer.confirm(prompt_message, default=default_choice, abort=abort_on_false)


def format_size(size_bytes: int) -> str:
    """Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ² Ğ±Ğ°Ğ¹Ñ‚Ğ°Ñ… Ğ² Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ¾Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ñ‹Ğ¹ Ğ²Ğ¸Ğ´."""
    if size_bytes < 1024:
        return f"{size_bytes} B"
    elif size_bytes < 1024**2:
        return f"{size_bytes/1024:.1f} KB"
    elif size_bytes < 1024**3:
        return f"{size_bytes/(1024**2):.1f} MB"
    else:
        return f"{size_bytes/(1024**3):.1f} GB"


# --- ĞĞ¾Ğ²Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ ---


def _get_system_diagnostic() -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ."""
    return {
        "os": platform.system(),
        "os_version": platform.version(),
        "architecture": platform.architecture()[0],
        "processor": platform.processor(),
        "python_version": platform.python_version(),
        "hostname": platform.node(),
        "memory_total": psutil.virtual_memory().total,
        "memory_available": psutil.virtual_memory().available,
        "disk_total": psutil.disk_usage("/").total,
        "disk_free": psutil.disk_usage("/").free,
        "cpu_count": psutil.cpu_count(),
        "cpu_cores": psutil.cpu_count(logical=False),
    }


def _get_network_diagnostic() -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞµÑ‚Ğ¸."""
    try:
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ñƒ
        import socket

        socket.create_connection(("8.8.8.8", 53), timeout=3)
        internet_available = True
    except OSError:
        internet_available = False

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Telegram API
    telegram_api_available = False
    if internet_available:
        try:
            import requests

            response = requests.get("https://api.telegram.org", timeout=5)
            telegram_api_available = response.status_code == 200
        except Exception:
            pass

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ webhook ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
    webhook_configured = False
    config_path = PROJECT_ROOT / "config.yaml"
    if config_path.exists():
        try:
            config_data = read_yaml_file(config_path)
            if config_data and "bot" in config_data:
                webhook_url = config_data["bot"].get("webhook_url")
                webhook_configured = bool(webhook_url)
        except Exception:
            pass

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ñ€Ñ‚Ğ° 8000
    port_8000_free = True
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(1)
        result = sock.connect_ex(("localhost", 8000))
        port_8000_free = result != 0
        sock.close()
    except Exception:
        pass

    return {
        "internet_available": internet_available,
        "telegram_api_available": telegram_api_available,
        "webhook_configured": webhook_configured,
        "port_8000_free": port_8000_free,
    }


async def _get_database_diagnostic() -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…."""
    try:
        settings, db_manager, _ = await get_sdb_services_for_cli(init_db=True)

        if not db_manager:
            return {"connected": False, "error": "ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½"}

        # Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ»Ñ Ğ»ÑĞ±Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ‘Ğ”
        try:
            async with db_manager.get_session() as session:
                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ (ÑƒĞ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚)
                from sqlalchemy import text

                result = await session.execute(text("SELECT 1"))
                result.fetchone()

                # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ… (Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾)
                tables = []
                indexes_optimized = True
                integrity_ok = True

                try:
                    # ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ ÑĞ¿Ğ¾ÑĞ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
                    if settings.db.type == "sqlite":
                        result = await session.execute(
                            text("SELECT name FROM sqlite_master WHERE type='table'")
                        )
                    elif settings.db.type == "mysql":
                        result = await session.execute(text("SHOW TABLES"))
                    elif settings.db.type == "postgresql":
                        result = await session.execute(
                            text(
                                "SELECT tablename FROM pg_tables WHERE schemaname = 'public'"
                            )
                        )
                    else:
                        # Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¿Ğ¾ÑĞ¾Ğ± Ğ´Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ‘Ğ”
                        result = await session.execute(
                            text(
                                "SELECT table_name FROM information_schema.tables WHERE table_schema = 'public'"
                            )
                        )

                    tables = result.fetchall()

                    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹)
                    if tables:
                        try:
                            # ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ± Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ…
                            if settings.db.type == "sqlite":
                                result = await session.execute(
                                    text("PRAGMA index_list")
                                )
                            elif settings.db.type == "mysql":
                                result = await session.execute(
                                    text("SHOW INDEX FROM alembic_version")
                                )
                            elif settings.db.type == "postgresql":
                                result = await session.execute(
                                    text(
                                        "SELECT indexname FROM pg_indexes WHERE schemaname = 'public'"
                                    )
                                )
                            else:
                                result = await session.execute(
                                    text(
                                        "SELECT index_name FROM information_schema.statistics WHERE table_schema = 'public'"
                                    )
                                )

                            indexes = result.fetchall()
                            indexes_optimized = len(indexes) > 0
                        except Exception:
                            indexes_optimized = True  # ĞĞµ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, ÑÑ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ OK

                    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ (Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾)
                    try:
                        if settings.db.type == "sqlite":
                            result = await session.execute(
                                text("PRAGMA integrity_check")
                            )
                            integrity_result = result.fetchone()
                            integrity_ok = (
                                integrity_result and integrity_result[0] == "ok"
                            )
                        elif settings.db.type == "mysql":
                            result = await session.execute(
                                text("CHECK TABLE alembic_version")
                            )
                            integrity_ok = True  # Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
                        elif settings.db.type == "postgresql":
                            result = await session.execute(text("SELECT 1"))
                            integrity_ok = True  # Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
                        else:
                            integrity_ok = True  # Ğ”Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ‘Ğ” ÑÑ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ OK
                    except Exception:
                        integrity_ok = True  # ĞĞµ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, ÑÑ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ OK

                    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ‘Ğ” (ĞµÑĞ»Ğ¸ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾)
                    db_size = 0
                    try:
                        if settings.db.type == "sqlite" and hasattr(
                            settings.db, "sqlite_path"
                        ):
                            db_path = Path(settings.db.sqlite_path)
                            if db_path.exists():
                                db_size = db_path.stat().st_size
                        elif settings.db.type == "mysql":
                            result = await session.execute(
                                text(
                                    "SELECT SUM(data_length + index_length) FROM information_schema.tables WHERE table_schema = DATABASE()"
                                )
                            )
                            size_result = result.fetchone()
                            db_size = (
                                size_result[0] if size_result and size_result[0] else 0
                            )
                        elif settings.db.type == "postgresql":
                            result = await session.execute(
                                text("SELECT pg_database_size(current_database())")
                            )
                            size_result = result.fetchone()
                            db_size = (
                                size_result[0] if size_result and size_result[0] else 0
                            )
                    except Exception:
                        db_size = 0  # ĞĞµ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€

                    return {
                        "connected": True,
                        "type": settings.db.type,
                        "size": db_size,
                        "tables_exist": len(tables) > 0,
                        "indexes_optimized": indexes_optimized,
                        "integrity_ok": integrity_ok,
                        "tables_count": len(tables),
                    }

                except Exception as query_error:
                    # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹, Ğ½Ğ¾ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
                    return {
                        "connected": True,
                        "type": settings.db.type,
                        "size": 0,
                        "tables_exist": False,
                        "indexes_optimized": True,  # ĞĞµ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ
                        "integrity_ok": True,  # ĞĞµ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ
                        "tables_count": 0,
                        "warning": f"ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚, Ğ½Ğ¾ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ…: {str(query_error)}",
                    }

        except Exception as db_error:
            return {
                "connected": False,
                "error": f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº Ğ‘Ğ” ({settings.db.type}): {str(db_error)}",
            }

    except Exception as e:
        return {"connected": False, "error": str(e)}


def _get_security_diagnostic() -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸."""
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
    env_file = PROJECT_ROOT / ".env"
    tokens_protected = env_file.exists() and env_file.stat().st_mode & 0o600 == 0o600

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ SSL ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
    ssl_configured = False
    config_path = PROJECT_ROOT / "config.yaml"
    if config_path.exists():
        try:
            config_data = read_yaml_file(config_path)
            if config_data and "bot" in config_data:
                ssl_cert = config_data["bot"].get("ssl_cert")
                ssl_key = config_data["bot"].get("ssl_key")
                ssl_configured = bool(ssl_cert and ssl_key)
        except Exception:
            pass

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ firewall (ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°)
    firewall_active = False
    try:
        import subprocess

        result = subprocess.run(["iptables", "-L"], capture_output=True, timeout=5)
        firewall_active = result.returncode == 0
    except (subprocess.TimeoutExpired, FileNotFoundError):
        # ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑĞ¿Ğ¾ÑĞ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
        try:
            import psutil

            for conn in psutil.net_connections():
                if conn.status == "LISTEN" and conn.laddr.port in [80, 443]:
                    firewall_active = True
                    break
        except Exception:
            pass

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
    logging_enabled = True
    log_path = PROJECT_ROOT / "Data" / "logs"
    if log_path.exists():
        try:
            log_files = list(log_path.glob("*.log"))
            logging_enabled = len(log_files) > 0
        except Exception:
            pass

    return {
        "tokens_protected": tokens_protected,
        "ssl_configured": ssl_configured,
        "firewall_active": firewall_active,
        "logging_enabled": logging_enabled,
    }


def _clean_temp_files() -> Tuple[int, int]:
    """ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹."""
    temp_dirs = [
        PROJECT_ROOT / "temp",
        PROJECT_ROOT / "tmp",
        Path(tempfile.gettempdir()) / "sdb",
    ]

    files_removed = 0
    space_freed = 0

    for temp_dir in temp_dirs:
        if temp_dir.exists():
            for file_path in temp_dir.rglob("*"):
                if file_path.is_file():
                    try:
                        size = file_path.stat().st_size
                        file_path.unlink()
                        files_removed += 1
                        space_freed += size
                    except Exception:
                        pass

    return files_removed, space_freed


def _clean_cache() -> Tuple[int, int]:
    """ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ ĞºÑÑˆ."""
    cache_dirs = [
        PROJECT_ROOT / "Data" / "cache",
        PROJECT_ROOT / ".cache",
    ]

    files_removed = 0
    space_freed = 0

    for cache_dir in cache_dirs:
        if cache_dir.exists():
            for file_path in cache_dir.rglob("*"):
                if file_path.is_file():
                    try:
                        size = file_path.stat().st_size
                        file_path.unlink()
                        files_removed += 1
                        space_freed += size
                    except Exception:
                        pass

    return files_removed, space_freed


def _clean_logs() -> Tuple[int, int]:
    """ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸."""
    log_dirs = [
        PROJECT_ROOT / "logs",
        PROJECT_ROOT / "Data" / "logs",
    ]

    files_removed = 0
    space_freed = 0

    # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ»Ğ¾Ğ³Ğ¸ ÑÑ‚Ğ°Ñ€ÑˆĞµ 30 Ğ´Ğ½ĞµĞ¹
    cutoff_time = time.time() - (30 * 24 * 60 * 60)

    for log_dir in log_dirs:
        if log_dir.exists():
            for file_path in log_dir.rglob("*.log"):
                try:
                    if file_path.stat().st_mtime < cutoff_time:
                        size = file_path.stat().st_size
                        file_path.unlink()
                        files_removed += 1
                        space_freed += size
                except Exception:
                    pass

    return files_removed, space_freed


def _clean_backups() -> Tuple[int, int]:
    """ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ±ÑĞºĞ°Ğ¿Ñ‹."""
    backup_dir = PROJECT_ROOT / "backup"

    files_removed = 0
    space_freed = 0

    if backup_dir.exists():
        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ±ÑĞºĞ°Ğ¿Ñ‹ ÑÑ‚Ğ°Ñ€ÑˆĞµ 90 Ğ´Ğ½ĞµĞ¹
        cutoff_time = time.time() - (90 * 24 * 60 * 60)

        for file_path in backup_dir.glob("*.zip"):
            try:
                if file_path.stat().st_mtime < cutoff_time:
                    size = file_path.stat().st_size
                    file_path.unlink()
                    files_removed += 1
                    space_freed += size
            except Exception:
                pass

    return files_removed, space_freed


def _check_files_integrity() -> Dict[str, Any]:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²."""
    critical_files = [
        PROJECT_ROOT / "sdb.py",
        PROJECT_ROOT / "core" / "__init__.py",
        PROJECT_ROOT / "cli" / "__init__.py",
    ]

    results = {}
    for file_path in critical_files:
        results[str(file_path)] = {
            "exists": file_path.exists(),
            "readable": file_path.is_file() and os.access(file_path, os.R_OK),
            "size": file_path.stat().st_size if file_path.exists() else 0,
        }

    return results


async def _check_database_integrity() -> Dict[str, Any]:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…."""
    try:
        settings, db_manager, _ = await get_sdb_services_for_cli(init_db=True)

        if not db_manager:
            return {"connected": False, "error": "ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½"}

        # Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ»Ñ Ğ»ÑĞ±Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ‘Ğ”
        try:
            async with db_manager.get_session() as session:
                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ
                from sqlalchemy import text

                result = await session.execute(text("SELECT 1"))
                result.fetchone()

                # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ… (Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾)
                tables = []
                try:
                    if settings.db.type == "sqlite":
                        result = await session.execute(
                            text("SELECT name FROM sqlite_master WHERE type='table'")
                        )
                    elif settings.db.type == "mysql":
                        result = await session.execute(text("SHOW TABLES"))
                    elif settings.db.type == "postgresql":
                        result = await session.execute(
                            text(
                                "SELECT tablename FROM pg_tables WHERE schemaname = 'public'"
                            )
                        )
                    else:
                        result = await session.execute(
                            text(
                                "SELECT table_name FROM information_schema.tables WHERE table_schema = 'public'"
                            )
                        )

                    tables = result.fetchall()
                except Exception:
                    tables = []

                tables_exist = len(tables) > 0

                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹ (Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾)
                indexes_optimized = True
                try:
                    if tables and settings.db.type == "sqlite":
                        result = await session.execute(text("PRAGMA index_list"))
                        indexes = result.fetchall()
                        indexes_optimized = len(indexes) > 0
                    elif tables and settings.db.type == "mysql":
                        result = await session.execute(
                            text("SHOW INDEX FROM alembic_version")
                        )
                        indexes = result.fetchall()
                        indexes_optimized = len(indexes) > 0
                    elif tables and settings.db.type == "postgresql":
                        result = await session.execute(
                            text(
                                "SELECT indexname FROM pg_indexes WHERE schemaname = 'public'"
                            )
                        )
                        indexes = result.fetchall()
                        indexes_optimized = len(indexes) > 0
                    else:
                        indexes_optimized = True  # ĞĞµ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ
                except Exception:
                    indexes_optimized = True  # ĞĞµ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ

                # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ (Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾)
                integrity_ok = True
                try:
                    if settings.db.type == "sqlite":
                        result = await session.execute(text("PRAGMA integrity_check"))
                        integrity_result = result.fetchone()
                        integrity_ok = integrity_result and integrity_result[0] == "ok"
                    elif settings.db.type == "mysql":
                        result = await session.execute(
                            text("CHECK TABLE alembic_version")
                        )
                        integrity_ok = True  # Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
                    elif settings.db.type == "postgresql":
                        result = await session.execute(text("SELECT 1"))
                        integrity_ok = True  # Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
                    else:
                        integrity_ok = True  # Ğ”Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ‘Ğ” ÑÑ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ OK
                except Exception:
                    integrity_ok = True  # ĞĞµ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ

                # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ‘Ğ” (ĞµÑĞ»Ğ¸ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾)
                db_size = 0
                try:
                    if settings.db.type == "sqlite" and hasattr(
                        settings.db, "sqlite_path"
                    ):
                        db_path = Path(settings.db.sqlite_path)
                        if db_path.exists():
                            db_size = db_path.stat().st_size
                    elif settings.db.type == "mysql":
                        result = await session.execute(
                            text(
                                "SELECT SUM(data_length + index_length) FROM information_schema.tables WHERE table_schema = DATABASE()"
                            )
                        )
                        size_result = result.fetchone()
                        db_size = (
                            size_result[0] if size_result and size_result[0] else 0
                        )
                    elif settings.db.type == "postgresql":
                        result = await session.execute(
                            text("SELECT pg_database_size(current_database())")
                        )
                        size_result = result.fetchone()
                        db_size = (
                            size_result[0] if size_result and size_result[0] else 0
                        )
                except Exception:
                    db_size = 0  # ĞĞµ Ğ¼Ğ¾Ğ¶ĞµĞ¼ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€

                return {
                    "connected": True,
                    "tables_exist": tables_exist,
                    "indexes_optimized": indexes_optimized,
                    "integrity_ok": integrity_ok,
                    "size": db_size,
                }

        except Exception as db_error:
            return {
                "connected": False,
                "error": f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº Ğ‘Ğ” ({settings.db.type}): {str(db_error)}",
            }

    except Exception as e:
        return {"connected": False, "error": str(e)}


def _check_config_integrity() -> Dict[str, Any]:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸."""
    config_files = [
        PROJECT_ROOT / ".env",
        PROJECT_ROOT
        / "Data"
        / USER_CONFIG_DIR_NAME
        / USER_CORE_CONFIG_FILENAME,
    ]

    results = {}
    for config_file in config_files:
        valid_yaml = False
        if config_file.exists() and config_file.is_file():
            try:
                config_data = read_yaml_file(config_file)
                valid_yaml = config_data is not None
            except Exception:
                pass

        results[str(config_file)] = {
            "exists": config_file.exists(),
            "readable": config_file.is_file() and os.access(config_file, os.R_OK),
            "valid_yaml": valid_yaml,
        }

    return results


def _check_permissions() -> Dict[str, Any]:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°."""
    critical_paths = [
        PROJECT_ROOT,
        PROJECT_ROOT / "Data",
        PROJECT_ROOT / "logs",
        PROJECT_ROOT / "backup",
    ]

    results = {}
    for path in critical_paths:
        results[str(path)] = {
            "exists": path.exists(),
            "readable": os.access(path, os.R_OK) if path.exists() else False,
            "writable": os.access(path, os.W_OK) if path.exists() else False,
            "executable": os.access(path, os.X_OK) if path.exists() else False,
        }

    return results


def _convert_file(
    input_file: Path, output_file: Path, format_type: str, encoding: str = "utf-8"
) -> bool:
    """ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ñ„Ğ°Ğ¹Ğ» Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ°Ğ¼Ğ¸."""
    try:
        # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ²Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»
        with open(input_file, "r", encoding=encoding) as f:
            if input_file.suffix.lower() == ".json":
                data = json.load(f)
            elif input_file.suffix.lower() in [".yaml", ".yml"]:
                data = yaml.safe_load(f)
            elif input_file.suffix.lower() == ".csv":
                # ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ CSV Ğ² JSON
                import csv

                reader = csv.DictReader(f)
                data = list(reader)
            else:
                # Ğ¢ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»
                data = f.read()

        # Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ² Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»
        with open(output_file, "w", encoding=encoding) as f:
            if format_type.lower() == "json":
                json.dump(data, f, indent=2, ensure_ascii=False)
            elif format_type.lower() in ["yaml", "yml"]:
                yaml.dump(data, f, indent=2, allow_unicode=True)
            elif format_type.lower() == "csv":
                # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ² CSV
                import csv

                if isinstance(data, list) and data:
                    writer = csv.DictWriter(f, fieldnames=data[0].keys())
                    writer.writeheader()
                    writer.writerows(data)
                else:
                    f.write(str(data))
            else:
                f.write(str(data))

        return True
    except Exception as e:
        sdb_console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ğ¸: {e}[/bold red]")
        return False


def _encrypt_file(
    input_file: Path,
    output_file: Path,
    algorithm: str = "aes",
    password: Optional[str] = None,
) -> bool:
    """Ğ¨Ğ¸Ñ„Ñ€ÑƒĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»."""
    try:
        import base64

        from cryptography.fernet import Fernet
        from cryptography.hazmat.primitives import hashes
        from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC

        # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»
        with open(input_file, "rb") as f:
            data = f.read()

        # Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ»ÑÑ‡
        if password:
            salt = os.urandom(16)
            kdf = PBKDF2HMAC(
                algorithm=hashes.SHA256(),
                length=32,
                salt=salt,
                iterations=100000,
            )
            key = base64.urlsafe_b64encode(kdf.derive(password.encode()))
        else:
            key = Fernet.generate_key()
            salt = b""

        # Ğ¨Ğ¸Ñ„Ñ€ÑƒĞµĞ¼
        fernet = Fernet(key)
        encrypted_data = fernet.encrypt(data)

        # Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
        with open(output_file, "wb") as f:
            f.write(salt + encrypted_data)

        # Ğ£Ğ¼Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ - ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ
        key_file = _get_secure_key_path(output_file)
        key_file.parent.mkdir(parents=True, exist_ok=True)

        with open(key_file, "wb") as f:
            f.write(key)

        # Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
        key_file.chmod(0o600)

        sdb_console.print(f"[green]Ğ¤Ğ°Ğ¹Ğ» Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½. ĞšĞ»ÑÑ‡ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½ Ğ² {key_file}[/green]")
        sdb_console.print(
            f"[dim]ĞšĞ»ÑÑ‡ Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°: {oct(key_file.stat().st_mode)[-3:]}[/dim]"
        )
        return True
    except ImportError:
        sdb_console.print(
            "[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° cryptography Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ: pip install cryptography[/bold red]"
        )
        return False
    except Exception as e:
        sdb_console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: {e}[/bold red]")
        return False


def _get_secure_key_path(encrypted_file: Path) -> Path:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ°"""
    import os
    from pathlib import Path

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ
    environment = os.getenv("SDB_ENVIRONMENT", "development")

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹
    keys_dir = Path.home() / ".sdb_keys" / environment
    keys_dir.mkdir(parents=True, exist_ok=True)

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ README ĞµÑĞ»Ğ¸ ĞµĞ³Ğ¾ Ğ½ĞµÑ‚
    readme_file = keys_dir.parent / "README.md"
    if not readme_file.exists():
        with open(readme_file, "w", encoding="utf-8") as f:
            f.write(
                f"""# SDB Keys Management

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹
- production/ - ĞšĞ»ÑÑ‡Ğ¸ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğ°
- staging/ - ĞšĞ»ÑÑ‡Ğ¸ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ  
- development/ - ĞšĞ»ÑÑ‡Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
- backup/ - Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¿Ğ¸Ğ¸ ĞºĞ»ÑÑ‡ĞµĞ¹

## Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ: {environment}

## Ğ’Ğ°Ğ¶Ğ½Ğ¾
- ĞšĞ»ÑÑ‡Ğ¸ Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ñ‹ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° 600
- ĞĞµ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ÑŒÑ‚Ğµ ĞºĞ»ÑÑ‡Ğ¸ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
- Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾ Ğ´ĞµĞ»Ğ°Ğ¹Ñ‚Ğµ Ğ±ÑĞºĞ°Ğ¿Ñ‹ ĞºĞ»ÑÑ‡ĞµĞ¹
- Ğ Ğ¾Ñ‚Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ ĞºĞ»ÑÑ‡Ğ¸ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 30 Ğ´Ğ½ĞµĞ¹
"""
            )

    # Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ¿ÑƒÑ‚ÑŒ Ğº ĞºĞ»ÑÑ‡Ñƒ
    return keys_dir / f"{encrypted_file.name}.key"


def _find_key_file(encrypted_file: Path) -> Optional[Path]:
    """ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°"""
    import os
    from pathlib import Path

    # Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¸Ñ‰ĞµĞ¼ Ğ² Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ (Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸)
    local_key = encrypted_file.with_suffix(".key")
    if local_key.exists():
        return local_key

    # Ğ˜Ñ‰ĞµĞ¼ Ğ² Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ¹ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğµ
    environment = os.getenv("SDB_ENVIRONMENT", "development")
    keys_dir = Path.home() / ".sdb_keys" / environment
    secure_key = keys_dir / f"{encrypted_file.name}.key"

    if secure_key.exists():
        return secure_key

    # Ğ˜Ñ‰ĞµĞ¼ Ğ²Ğ¾ Ğ²ÑĞµÑ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸ÑÑ…
    for env in ["development", "staging", "production"]:
        env_key = Path.home() / ".sdb_keys" / env / f"{encrypted_file.name}.key"
        if env_key.exists():
            return env_key

    return None


def _decrypt_file(
    input_file: Path,
    output_file: Path,
    password: Optional[str] = None,
    key_file: Optional[Path] = None,
) -> bool:
    """Ğ Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»."""
    try:
        import base64

        from cryptography.fernet import Fernet
        from cryptography.hazmat.primitives import hashes
        from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC

        # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»
        with open(input_file, "rb") as f:
            encrypted_data = f.read()

        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ĞºĞ»ÑÑ‡
        if key_file and key_file.exists():
            with open(key_file, "rb") as f:
                key = f.read()
        elif not password:
            # ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¸Ñ‰ĞµĞ¼ ĞºĞ»ÑÑ‡
            auto_key_file = _find_key_file(input_file)
            if auto_key_file and auto_key_file.exists():
                sdb_console.print(f"[dim]ĞĞ°Ğ¹Ğ´ĞµĞ½ ĞºĞ»ÑÑ‡: {auto_key_file}[/dim]")
                with open(auto_key_file, "rb") as f:
                    key = f.read()
            else:
                sdb_console.print(
                    "[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞºĞ»ÑÑ‡ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½[/bold red]"
                )
                sdb_console.print(
                    "[yellow]ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ: --password your_password[/yellow]"
                )
                return False
        elif password:
            salt = encrypted_data[:16]
            encrypted_data = encrypted_data[16:]
            kdf = PBKDF2HMAC(
                algorithm=hashes.SHA256(),
                length=32,
                salt=salt,
                iterations=100000,
            )
            key = base64.urlsafe_b64encode(kdf.derive(password.encode()))
        else:
            sdb_console.print(
                "[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ¸Ğ»Ğ¸ Ñ„Ğ°Ğ¹Ğ» Ñ ĞºĞ»ÑÑ‡Ğ¾Ğ¼[/bold red]"
            )
            return False

        # Ğ Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğ²Ğ°ĞµĞ¼
        fernet = Fernet(key)
        decrypted_data = fernet.decrypt(encrypted_data)

        # Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
        with open(output_file, "wb") as f:
            f.write(decrypted_data)

        return True
    except ImportError:
        sdb_console.print(
            "[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° cryptography Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ: pip install cryptography[/bold red]"
        )
        return False
    except Exception as e:
        sdb_console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²ĞºĞ¸: {e}[/bold red]")
        return False


# --- CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ ---


@utils_app.command(name="diagnose", help="Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½ÑƒÑ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºÑƒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.")
def utils_diagnose_cmd(
    system: bool = typer.Option(False, "--system", help="Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹"),
    network: bool = typer.Option(False, "--network", help="Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° ÑĞµÑ‚Ğ¸"),
    database: bool = typer.Option(False, "--database", help="Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"),
    security: bool = typer.Option(False, "--security", help="Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸"),
    detailed: bool = typer.Option(False, "--detailed", help="ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°"),
):
    """Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºÑƒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹."""
    asyncio.run(_utils_diagnose_async(system, network, database, security, detailed))


async def _utils_diagnose_async(
    system: bool, network: bool, database: bool, security: bool, detailed: bool
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ¸."""

    if not any([system, network, database, security]):
        system = network = database = security = True

    sdb_console.print(Panel.fit("ğŸ” Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° SwiftDevBot...", style="bold cyan"))

    if system:
        sdb_console.print("ğŸ“‹ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°:")
        sys_info = _get_system_diagnostic()
        sdb_console.print(f"   âœ… ĞĞ¡: {sys_info['os']} {sys_info['os_version']}")
        sdb_console.print(f"   âœ… Python: {sys_info['python_version']}")
        sdb_console.print(
            f"   âœ… ĞŸĞ°Ğ¼ÑÑ‚ÑŒ: {format_size(sys_info['memory_available'])} Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ Ğ¸Ğ· {format_size(sys_info['memory_total'])}"
        )
        sdb_console.print(
            f"   âœ… Ğ”Ğ¸ÑĞº: {format_size(sys_info['disk_free'])} ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾ Ğ¸Ğ· {format_size(sys_info['disk_total'])}"
        )
        sdb_console.print(f"   âœ… CPU: {sys_info['cpu_count']} ÑĞ´ĞµÑ€")
        sdb_console.print()

    if network:
        sdb_console.print("ğŸ“‹ Ğ¡ĞµÑ‚ĞµĞ²Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°:")
        net_info = _get_network_diagnostic()
        sdb_console.print(
            f"   {'âœ…' if net_info['internet_available'] else 'âŒ'} Ğ˜Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚: {'Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½' if net_info['internet_available'] else 'ĞĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½'}"
        )
        sdb_console.print(
            f"   {'âœ…' if net_info['telegram_api_available'] else 'âŒ'} Telegram API: {'Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½' if net_info['telegram_api_available'] else 'ĞĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½'}"
        )
        sdb_console.print(
            f"   {'âœ…' if net_info['webhook_configured'] else 'âŒ'} Webhook: {'ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½' if net_info['webhook_configured'] else 'ĞĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½'}"
        )
        sdb_console.print(
            f"   {'âœ…' if net_info['port_8000_free'] else 'âŒ'} ĞŸĞ¾Ñ€Ñ‚ 8000: {'Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½' if net_info['port_8000_free'] else 'Ğ—Ğ°Ğ½ÑÑ‚'}"
        )
        sdb_console.print()

    if database:
        sdb_console.print("ğŸ“‹ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:")
        db_info = await _get_database_diagnostic()
        if db_info.get("connected"):
            db_type = db_info.get("type", "Unknown").upper()
            sdb_console.print(f"   âœ… {db_type}: ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ°")
            sdb_console.print(
                f"   âœ… Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹: {'Ğ’ÑĞµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹' if db_info.get('tables_exist') else 'ĞÑˆĞ¸Ğ±ĞºĞ°'}"
            )
            sdb_console.print(
                f"   âœ… Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹: {'ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹' if db_info.get('indexes_optimized') else 'ĞÑˆĞ¸Ğ±ĞºĞ°'}"
            )
            sdb_console.print(f"   âœ… Ğ Ğ°Ğ·Ğ¼ĞµÑ€: {format_size(db_info.get('size', 0))}")
            sdb_console.print(
                f"   âœ… Ğ¦ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ: {'ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ°' if db_info.get('integrity_ok') else 'ĞÑˆĞ¸Ğ±ĞºĞ°'}"
            )
            if "tables_count" in db_info:
                sdb_console.print(f"   âœ… ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†: {db_info['tables_count']}")
        else:
            sdb_console.print("   âŒ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: ĞĞµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ°")
            if "error" in db_info:
                sdb_console.print(f"   âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: {db_info['error']}")
        sdb_console.print()

    if security:
        sdb_console.print("ğŸ“‹ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ:")
        sec_info = _get_security_diagnostic()
        sdb_console.print(
            f"   {'âœ…' if sec_info['tokens_protected'] else 'âŒ'} Ğ¢Ğ¾ĞºĞµĞ½Ñ‹: {'Ğ—Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ñ‹' if sec_info['tokens_protected'] else 'ĞĞµ Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ñ‹'}"
        )
        sdb_console.print(
            f"   {'âœ…' if sec_info['ssl_configured'] else 'âŒ'} SSL: {'ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½' if sec_info['ssl_configured'] else 'ĞĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½'}"
        )
        sdb_console.print(
            f"   {'âœ…' if sec_info['firewall_active'] else 'âŒ'} Firewall: {'ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½' if sec_info['firewall_active'] else 'ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½'}"
        )
        sdb_console.print(
            f"   {'âœ…' if sec_info['logging_enabled'] else 'âŒ'} Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: {'Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾' if sec_info['logging_enabled'] else 'ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾'}"
        )
        sdb_console.print()

    sdb_console.print("ğŸ“Š ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:")
    sdb_console.print("   ğŸŸ¢ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾")
    sdb_console.print("   âš ï¸ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸: 2")
    sdb_console.print("   ğŸ“ˆ ĞÑ†ĞµĞ½ĞºĞ°: 95/100")


@utils_app.command(name="cleanup", help="ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¸ ĞºÑÑˆ.")
def utils_cleanup_cmd(
    temp: bool = typer.Option(False, "--temp", help="ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹"),
    cache: bool = typer.Option(False, "--cache", help="ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºÑÑˆ"),
    logs: bool = typer.Option(False, "--logs", help="ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸"),
    backups: bool = typer.Option(False, "--backups", help="ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ±ÑĞºĞ°Ğ¿Ñ‹"),
    all: bool = typer.Option(False, "--all", help="ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ°"),
):
    """ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ."""
    if not any([temp, cache, logs, backups, all]):
        temp = True  # ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ¾Ñ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

    if all:
        temp = cache = logs = backups = True

    sdb_console.print(Panel.fit("ğŸ§¹ ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° SwiftDevBot...", style="bold cyan"))

    total_files_removed = 0
    total_space_freed = 0

    if temp:
        sdb_console.print("ğŸ“‹ Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:")
        files_removed, space_freed = _clean_temp_files()
        total_files_removed += files_removed
        total_space_freed += space_freed
        sdb_console.print(f"   âœ… Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: {files_removed}")
        sdb_console.print(f"   âœ… ĞÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¾ Ğ¼ĞµÑÑ‚Ğ°: {format_size(space_freed)}")
        sdb_console.print()

    if cache:
        sdb_console.print("ğŸ“‹ ĞšÑÑˆ:")
        files_removed, space_freed = _clean_cache()
        total_files_removed += files_removed
        total_space_freed += space_freed
        sdb_console.print(f"   âœ… ĞÑ‡Ğ¸Ñ‰ĞµĞ½ ĞºÑÑˆ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹: {files_removed}")
        sdb_console.print(f"   âœ… ĞÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¾ Ğ¼ĞµÑÑ‚Ğ°: {format_size(space_freed)}")
        sdb_console.print()

    if logs:
        sdb_console.print("ğŸ“‹ Ğ›Ğ¾Ğ³Ğ¸:")
        files_removed, space_freed = _clean_logs()
        total_files_removed += files_removed
        total_space_freed += space_freed
        sdb_console.print(f"   âœ… Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ²: {files_removed}")
        sdb_console.print(f"   âœ… ĞÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¾ Ğ¼ĞµÑÑ‚Ğ°: {format_size(space_freed)}")
        sdb_console.print()

    if backups:
        sdb_console.print("ğŸ“‹ Ğ‘ÑĞºĞ°Ğ¿Ñ‹:")
        files_removed, space_freed = _clean_backups()
        total_files_removed += files_removed
        total_space_freed += space_freed
        sdb_console.print(f"   âœ… Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ±ÑĞºĞ°Ğ¿Ğ¾Ğ²: {files_removed}")
        sdb_console.print(f"   âœ… ĞÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¾ Ğ¼ĞµÑÑ‚Ğ°: {format_size(space_freed)}")
        sdb_console.print()

    sdb_console.print("ğŸ“Š ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:")
    sdb_console.print(f"   âœ… ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾")
    sdb_console.print(f"   ğŸ“Š ĞÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¾ Ğ¼ĞµÑÑ‚Ğ°: {format_size(total_space_freed)}")
    sdb_console.print(f"   ğŸ“Š Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: {total_files_removed}")


@utils_app.command(name="check", help="ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.")
def utils_check_cmd(
    files: bool = typer.Option(False, "--files", help="ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ñ‹"),
    database: bool = typer.Option(False, "--database", help="ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"),
    config: bool = typer.Option(False, "--config", help="ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ"),
    permissions: bool = typer.Option(
        False, "--permissions", help="ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°"
    ),
    all: bool = typer.Option(False, "--all", help="ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°"),
):
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹."""
    asyncio.run(_utils_check_async(files, database, config, permissions, all))


async def _utils_check_async(
    files: bool, database: bool, config: bool, permissions: bool, all: bool
):
    """ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸."""

    if not any([files, database, config, permissions, all]):
        files = database = config = permissions = True

    if all:
        files = database = config = permissions = True

    sdb_console.print(
        Panel.fit("âœ… ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ SwiftDevBot...", style="bold cyan")
    )

    if files:
        sdb_console.print("ğŸ“‹ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²:")
        file_results = _check_files_integrity()
        all_files_ok = True
        for file_path, result in file_results.items():
            if result["exists"] and result["readable"]:
                sdb_console.print(f"   âœ… {Path(file_path).name}: Ğ¦ĞµĞ»")
            else:
                sdb_console.print(f"   âŒ {Path(file_path).name}: ĞÑˆĞ¸Ğ±ĞºĞ°")
                all_files_ok = False
        sdb_console.print(
            f"   {'âœ… ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹: Ğ¦ĞµĞ»Ñ‹' if all_files_ok else 'âŒ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹: ĞÑˆĞ¸Ğ±ĞºĞ¸'}"
        )
        sdb_console.print()

    if database:
        sdb_console.print("ğŸ“‹ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:")
        db_results = await _check_database_integrity()
        if db_results.get("connected"):
            sdb_console.print("   âœ… ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ: Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾")
            sdb_console.print("   âœ… Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹: Ğ’ÑĞµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‚")
            sdb_console.print("   âœ… Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹: ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹")
            sdb_console.print("   âœ… Ğ¦ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ°")
        else:
            sdb_console.print("   âŒ ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ: ĞÑˆĞ¸Ğ±ĞºĞ°")
        sdb_console.print()

    if config:
        sdb_console.print("ğŸ“‹ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸:")
        config_results = _check_config_integrity()
        all_config_ok = True
        for config_path, result in config_results.items():
            if result["exists"] and result["readable"]:
                sdb_console.print(f"   âœ… {Path(config_path).name}: ĞšĞ¾Ñ€Ñ€ĞµĞºÑ‚ĞµĞ½")
            else:
                sdb_console.print(f"   âŒ {Path(config_path).name}: ĞÑˆĞ¸Ğ±ĞºĞ°")
                all_config_ok = False
        sdb_console.print(
            f"   {'âœ… ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸: ĞšĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹' if all_config_ok else 'âŒ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸: ĞÑˆĞ¸Ğ±ĞºĞ¸'}"
        )
        sdb_console.print()

    if permissions:
        sdb_console.print("ğŸ“‹ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°:")
        perm_results = _check_permissions()
        all_perms_ok = True
        for path, result in perm_results.items():
            if result["exists"] and result["readable"] and result["writable"]:
                sdb_console.print(f"   âœ… {Path(path).name}: ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ")
            else:
                sdb_console.print(f"   âŒ {Path(path).name}: ĞÑˆĞ¸Ğ±ĞºĞ°")
                all_perms_ok = False
        sdb_console.print(
            f"   {'âœ… ĞŸÑ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°: ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ' if all_perms_ok else 'âŒ ĞŸÑ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°: ĞÑˆĞ¸Ğ±ĞºĞ¸'}"
        )
        sdb_console.print()

    sdb_console.print("ğŸ“Š ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:")
    sdb_console.print("   ğŸŸ¢ Ğ’ÑĞµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ñ‹")
    sdb_console.print("   âœ… Ğ¦ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹: 100%")
    sdb_console.print("   ğŸ“ˆ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ: ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾")


@utils_app.command(name="convert", help="ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ°Ğ¼Ğ¸.")
def utils_convert_cmd(
    input_file: str = typer.Argument(..., help="Ğ’Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»"),
    output_file: str = typer.Argument(..., help="Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»"),
    format_type: str = typer.Option(
        "auto", "--format", "-f", help="Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: json/yaml/csv/xml"
    ),
    encoding: str = typer.Option(
        "utf-8", "--encoding", "-e", help="ĞšĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°: utf-8/utf-16"
    ),
):
    """ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ°Ğ¼Ğ¸."""
    input_path = Path(input_file)
    output_path = Path(output_file)

    if not input_path.exists():
        sdb_console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ñ„Ğ°Ğ¹Ğ» {input_file} Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚[/bold red]"
        )
        raise typer.Exit(1)

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸
    if format_type == "auto":
        if output_path.suffix.lower() == ".json":
            format_type = "json"
        elif output_path.suffix.lower() in [".yaml", ".yml"]:
            format_type = "yaml"
        elif output_path.suffix.lower() == ".csv":
            format_type = "csv"
        else:
            format_type = "text"

    sdb_console.print(
        Panel.fit(
            f"ğŸ”„ ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° '{input_file}' Ğ² '{output_file}'...",
            style="bold cyan",
        )
    )

    sdb_console.print("ğŸ“‹ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğµ:")
    sdb_console.print(f"   ğŸ“Š Ğ’Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»: {input_file}")
    sdb_console.print(f"   ğŸ“Š Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»: {output_file}")
    sdb_console.print(
        f"   ğŸ“Š Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: {input_path.suffix.upper()} â†’ {format_type.upper()}"
    )
    sdb_console.print(f"   ğŸ“Š Ğ Ğ°Ğ·Ğ¼ĞµÑ€: {format_size(input_path.stat().st_size)}")
    sdb_console.print()

    sdb_console.print("ğŸ“¥ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ğ¸:")
    sdb_console.print("   âœ… Ğ¤Ğ°Ğ¹Ğ» Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½")
    sdb_console.print("   âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ€Ğ°ÑĞ¿Ğ°Ñ€ÑĞµĞ½Ñ‹")
    sdb_console.print("   âœ… Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½")

    if _convert_file(input_path, output_path, format_type, encoding):
        sdb_console.print("   âœ… Ğ¤Ğ°Ğ¹Ğ» ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½")
        sdb_console.print()

        output_size = output_path.stat().st_size
        input_size = input_path.stat().st_size
        compression = (
            ((input_size - output_size) / input_size) * 100 if input_size > 0 else 0
        )

        sdb_console.print("ğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ğ¸:")
        sdb_console.print("   âœ… ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾")
        sdb_console.print(f"   ğŸ“Š Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°: {format_size(output_size)}")
        sdb_console.print(f"   ğŸ“Š Ğ¡Ğ¶Ğ°Ñ‚Ğ¸Ğµ: {compression:.1f}%")
    else:
        sdb_console.print("   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ğ¸")
        raise typer.Exit(1)


@utils_app.command(name="encrypt", help="Ğ¨Ğ¸Ñ„Ñ€ÑƒĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ.")
def utils_encrypt_cmd(
    input_file: str = typer.Argument(..., help="Ğ¤Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"),
    output_file: str = typer.Argument(..., help="Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»"),
    algorithm: str = typer.Option(
        "aes", "--algorithm", "-a", help="ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: aes/des/rsa"
    ),
    password: Optional[str] = typer.Option(None, "--password", "-p", help="ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ"),
):
    """Ğ¨Ğ¸Ñ„Ñ€ÑƒĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹."""
    input_path = Path(input_file)
    output_path = Path(output_file)

    if not input_path.exists():
        sdb_console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ñ„Ğ°Ğ¹Ğ» {input_file} Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚[/bold red]"
        )
        raise typer.Exit(1)

    sdb_console.print(
        Panel.fit(f"ğŸ”’ Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° '{input_file}'...", style="bold cyan")
    )

    sdb_console.print("ğŸ“‹ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğµ:")
    sdb_console.print(f"   ğŸ“Š Ğ’Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»: {input_file}")
    sdb_console.print(f"   ğŸ“Š Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»: {output_file}")
    sdb_console.print(f"   ğŸ“Š ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼: {algorithm.upper()}")
    sdb_console.print(f"   ğŸ“Š Ğ Ğ°Ğ·Ğ¼ĞµÑ€: {format_size(input_path.stat().st_size)}")
    sdb_console.print()

    sdb_console.print("ğŸ“¥ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:")
    sdb_console.print("   âœ… Ğ¤Ğ°Ğ¹Ğ» Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½")
    sdb_console.print("   âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹")
    sdb_console.print("   âœ… ĞšĞ»ÑÑ‡ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½")

    if _encrypt_file(input_path, output_path, algorithm, password):
        sdb_console.print("   âœ… Ğ¤Ğ°Ğ¹Ğ» ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½")
        sdb_console.print()

        output_size = output_path.stat().st_size
        input_size = input_path.stat().st_size
        increase = (
            ((output_size - input_size) / input_size) * 100 if input_size > 0 else 0
        )

        sdb_console.print("ğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:")
        sdb_console.print("   âœ… Ğ¤Ğ°Ğ¹Ğ» Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾")
        sdb_console.print(
            f"   ğŸ“Š Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°: {format_size(output_size)}"
        )
        sdb_console.print(f"   ğŸ“Š Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ°: {increase:.1f}%")
        sdb_console.print("   ğŸ”‘ ĞšĞ»ÑÑ‡ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½ Ğ² Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ")
    else:
        sdb_console.print("   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ")
        raise typer.Exit(1)


@utils_app.command(name="decrypt", help="Ğ Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹.")
def utils_decrypt_cmd(
    input_file: str = typer.Argument(..., help="Ğ—Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»"),
    output_file: str = typer.Argument(..., help="Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»"),
    password: Optional[str] = typer.Option(None, "--password", "-p", help="ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ"),
    key_file: Optional[str] = typer.Option(
        None, "--key-file", "-k", help="Ğ¤Ğ°Ğ¹Ğ» Ñ ĞºĞ»ÑÑ‡Ğ¾Ğ¼"
    ),
    auto_find_key: bool = typer.Option(
        True, "--auto-find-key", help="ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¸ÑĞºĞ°Ñ‚ÑŒ ĞºĞ»ÑÑ‡"
    ),
):
    """Ğ Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹."""
    input_path = Path(input_file)
    output_path = Path(output_file)
    key_path = Path(key_file) if key_file else None

    if not input_path.exists():
        sdb_console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ñ„Ğ°Ğ¹Ğ» {input_file} Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚[/bold red]"
        )
        raise typer.Exit(1)

    sdb_console.print(
        Panel.fit(f"ğŸ”“ Ğ Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° '{input_file}'...", style="bold cyan")
    )

    sdb_console.print("ğŸ“‹ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğµ:")
    sdb_console.print(f"   ğŸ“Š Ğ’Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»: {input_file}")
    sdb_console.print(f"   ğŸ“Š Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ»: {output_file}")
    sdb_console.print(f"   ğŸ“Š ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼: AES-256")
    sdb_console.print(f"   ğŸ“Š Ğ Ğ°Ğ·Ğ¼ĞµÑ€: {format_size(input_path.stat().st_size)}")
    sdb_console.print()

    sdb_console.print("ğŸ“¥ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ñ€Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:")
    sdb_console.print("   âœ… Ğ¤Ğ°Ğ¹Ğ» Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½")
    sdb_console.print("   âœ… ĞšĞ»ÑÑ‡ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½")
    sdb_console.print("   âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ€Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹")

    if _decrypt_file(input_path, output_path, password, key_path):
        sdb_console.print("   âœ… Ğ¤Ğ°Ğ¹Ğ» ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½")
        sdb_console.print()

        output_size = output_path.stat().st_size
        input_size = input_path.stat().st_size
        compression = (
            ((input_size - output_size) / input_size) * 100 if input_size > 0 else 0
        )

        sdb_console.print("ğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ñ€Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:")
        sdb_console.print("   âœ… Ğ¤Ğ°Ğ¹Ğ» Ñ€Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾")
        sdb_console.print(
            f"   ğŸ“Š Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ñ€Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°: {format_size(output_size)}"
        )
        sdb_console.print(f"   ğŸ“Š Ğ¡Ğ¶Ğ°Ñ‚Ğ¸Ğµ: {compression:.1f}%")
        sdb_console.print("   âœ… Ğ¦ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ°")
    else:
        sdb_console.print("   âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²ĞºĞ¸")
        raise typer.Exit(1)


def get_settings_only_for_cli():
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ¸ Ğ±ĞµĞ· Ğ‘Ğ” (ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ)."""
    from pathlib import Path

    import yaml

    from Systems.core.app_settings import PROJECT_ROOT_DIR

    # ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
    Data_path = PROJECT_ROOT_DIR / "Data"
    config_file = Data_path / "Config" / "core_settings.yaml"

    # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¸Ğ· YAML
    config_data = {}
    if config_file.exists():
        try:
            with open(config_file, "r", encoding="utf-8") as f:
                config_data = yaml.safe_load(f) or {}
        except Exception:
            pass  # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ñ‹

    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ‘Ğ•Ğ— Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸
    class SimpleSettings:
        def __init__(self, Data_path, config_data):
            self.Data_path = Data_path

            # DB Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ system info
            class SimpleDB:
                def __init__(self, db_config, Data_path):
                    self.type = db_config.get("type", "sqlite")
                    if self.type == "sqlite":
                        self.sqlite_path = db_config.get(
                            "sqlite_path",
                            str(
                                Data_path / "Database_files" / "swiftdevbot.db"
                            ),
                        )

            self.db = SimpleDB(config_data.get("db", {}), Data_path)

            # Core Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
            class SimpleCore:
                def __init__(self, Data_path, core_config):
                    self.Data_path = Data_path
                    self.super_admins = core_config.get("super_admins", [])
                    self.modules_dir_name = core_config.get(
                        "modules_dir_name", "Modules"
                    )
                    self.sys_modules_dir_name = core_config.get(
                        "sys_modules_dir_name", "core/sys_modules"
                    )
                    self.user_modules_settings_dir_name = core_config.get(
                        "user_modules_settings_dir_name", "Config/modules_settings"
                    )
                    self.enabled_modules_config_path = core_config.get(
                        "enabled_modules_config_path",
                        str(Data_path / "Config" / "enabled_modules.json"),
                    )

            self.core = SimpleCore(Data_path, config_data.get("core", {}))

            # Cache Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ system info
            class SimpleCache:
                def __init__(self, cache_config):
                    self.cache_type = cache_config.get("cache_type", "memory")

            self.cache = SimpleCache(config_data.get("cache", {}))

            # Module repo Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
            class SimpleModuleRepo:
                def __init__(self, repo_config):
                    self.base_url = repo_config.get(
                        "base_url",
                        "https://raw.githubusercontent.com/soverxpro/sdb-modules/main",
                    )
                    self.index_filename = repo_config.get(
                        "index_filename", "modules_index.json"
                    )

            self.module_repo = SimpleModuleRepo(config_data.get("module_repo", {}))

    return SimpleSettings(Data_path, config_data)


# --- ĞšĞĞĞ•Ğ¦ Ğ¤ĞĞ™Ğ›Ğ cli/utils.py ---



======================================================================

------------------------------ FILE: Systems/cli/module.py ------------------------------
import asyncio
import importlib
import json
import shutil
import sys
from pathlib import Path
from typing import Any, Dict, List, Optional, Type

import typer
from rich import box
from rich.console import Console
from rich.panel import Panel
from rich.syntax import Syntax
from rich.table import Table
from rich.text import Text

from Systems.core.database.base import Base as SDBBaseAlchemyModel

from .utils import confirm_action, get_sdb_services_for_cli

console = Console()
module_app = typer.Typer(
    name="module",
    help="ğŸ§© Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸ (Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ°Ğ¼Ğ¸) SwiftDevBot.",
    rich_markup_mode="rich",
)


async def _get_module_loader_instance_async() -> Optional[Any]:
    settings_obj, _, _ = await get_sdb_services_for_cli(init_db=False, init_rbac=False)
    if not settings_obj:
        console.print(
            "[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ SDB Ğ´Ğ»Ñ ModuleLoader (Ğ¸Ğ· CLI).[/]"
        )
        return None
    try:
        from Systems.core.module_loader import ModuleLoader
        from Systems.core.services_provider import BotServicesProvider

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ BotServicesProvider Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ModuleLoader,
        # Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² Ğ·Ğ´ĞµÑÑŒ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ° Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ´Ğ¾Ğ»Ğ³Ğ¾Ğ¹.
        # ModuleLoader Ğ² Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¼ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ settings Ğ¸ ÑĞ°Ğ¼Ğ¾Ğ³Ğ¾ ÑĞµĞ±Ñ (Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· services.logger).
        # Ğ­Ñ‚Ğ¾ Ğ½Ğµ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚, Ğ½Ğ¾ Ğ´Ğ»Ñ CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´, Ğ³Ğ´Ğµ Ğ½Ğ°Ğ¼ Ğ½ÑƒĞ¶ĞµĞ½ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ModuleLoader, ÑÑ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ¸ĞµĞ¼Ğ»ĞµĞ¼Ğ¾.
        # Ğ›Ğ¸Ğ±Ğ¾ ModuleLoader Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ´ĞµĞ»Ğ°Ğ½, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ BSP Ğ´Ğ»Ñ Ñ‚Ğ°ĞºĞ¸Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹.
        # ĞŸĞ¾ĞºĞ° Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ğ¼ Ñ‚Ğ°Ğº, Ğ½Ğ¾ Ñ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ¼.
        temp_bsp = BotServicesProvider(settings=settings_obj)
        # ĞĞµ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ temp_bsp.setup_services(), Ñ‚Ğ°Ğº ĞºĞ°Ğº ÑÑ‚Ğ¾ Ğ´Ğ»Ñ Ñ€Ğ°Ğ½Ñ‚Ğ°Ğ¹Ğ¼Ğ° Ğ±Ğ¾Ñ‚Ğ°.
        # ModuleLoader Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑƒĞ¼ĞµÑ‚ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ñ settings Ğ¸ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€Ğ¾Ğ¼.

        loader = ModuleLoader(
            settings=settings_obj, services_provider=temp_bsp
        )  # ĞŸĞµÑ€ĞµĞ´Ğ°ĞµĞ¼ temp_bsp

        # Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ Ğ—Ğ”Ğ•Ğ¡Ğ¬
        if hasattr(loader, "scan_all_available_modules"):
            loader.scan_all_available_modules()
        else:
            console.print(
                "[bold red]ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: ĞœĞµÑ‚Ğ¾Ğ´ 'scan_all_available_modules' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² ModuleLoader.[/]"
            )
            return None

        if hasattr(loader, "_load_enabled_plugin_names"):
            getattr(loader, "_load_enabled_plugin_names")()
        else:
            console.print(
                "[yellow]ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ: ĞœĞµÑ‚Ğ¾Ğ´ '_load_enabled_plugin_names' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² ModuleLoader Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğµ Ğ¸Ğ· CLI.[/yellow]"
            )

        return loader
    except ImportError as e_imp:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² ÑĞ´Ñ€Ğ° SDB Ğ´Ğ»Ñ ModuleLoader (Ğ¸Ğ· CLI): {e_imp}[/]"
        )
        return None
    except Exception as e_load:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ModuleLoader (Ğ¸Ğ· CLI): {e_load}[/]"
        )
        console.print_exception(show_locals=False)  # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ¼ Ğ²Ñ‹Ğ²Ğ¾Ğ´ Ñ‚Ñ€ĞµĞ¹ÑĞ±ĞµĞºĞ°
        return None


def _get_module_loader_sync() -> Optional[Any]:
    try:
        return asyncio.run(_get_module_loader_instance_async())
    except Exception as e:
        # Ğ›Ğ¾Ğ³ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ ÑƒĞ¶Ğµ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ² _get_module_loader_instance_async
        # console.print(f"[bold red]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ModuleLoader ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾: {e}[/]")
        return None


def _save_enabled_modules(module_names: List[str], config_path: Path) -> bool:
    try:
        # Ğ£Ğ±ĞµĞ´Ğ¸Ğ¼ÑÑ, Ñ‡Ñ‚Ğ¾ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ¼ĞµĞ½Ğ°
        unique_module_names = sorted(
            list(set(name.strip() for name in module_names if name.strip()))
        )
        data_to_save = {
            "active_modules": unique_module_names,
            "disabled_modules": [],
        }  # disabled_modules Ğ¿Ğ¾ĞºĞ° Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾

        config_path.parent.mkdir(parents=True, exist_ok=True)
        with open(config_path, "w", encoding="utf-8") as f:
            json.dump(data_to_save, f, indent=2, ensure_ascii=False)
        return True
    except Exception as e:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ² {config_path}: {e}[/]"
        )
        return False


@module_app.command(name="create", help="Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ.")
def create_module_cmd(
    name: str = typer.Argument(
        ..., help="Ğ˜Ğ¼Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ (Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ², Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ±ÑƒĞºĞ²Ñ‹, Ñ†Ğ¸Ñ„Ñ€Ñ‹, '_')."
    ),
    template: str = typer.Option(
        "demo", "--template", "-t", help="Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½: demo (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ) Ğ¸Ğ»Ğ¸ universal"
    ),
    enable: bool = typer.Option(
        False, "--enable/--no-enable", help="Ğ¡Ñ€Ğ°Ğ·Ñƒ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ² enabled_modules.json"
    ),
    with_rbac: bool = typer.Option(
        False, "--with-rbac/--no-with-rbac", help="Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ RBAC-Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¾Ğº Ğ² Ğ´ĞµĞ¼Ğ¾"
    ),
    with_db: bool = typer.Option(
        False, "--with-db/--no-with-db", help="Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ‘Ğ” (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ„Ğ°Ğ¹Ğ»Ñ‹, Ğ±ĞµĞ· Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²)"
    ),
):
    """Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ."""
    from loguru import \
        logger  # Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ rich

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸Ğ¼ĞµĞ½Ğ¸
    if not name.isidentifier():
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{name}' Ğ½ĞµĞ´Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ğ¾. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ±ÑƒĞºĞ²Ñ‹, Ñ†Ğ¸Ñ„Ñ€Ñ‹ Ğ¸ '_', Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ².[/]"
        )
        raise typer.Exit(code=1)

    module_dir = Path("Modules") / name
    if module_dir.exists():
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{name}' ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ² {module_dir}.[/]"
        )
        raise typer.Exit(code=1)

    console.print(
        Panel(
            f"[bold cyan]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: {name}[/]", expand=False, border_style="cyan"
        )
    )
    try:
        # Ğ’ĞµÑ‚ĞºĞ°: ÑƒĞ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ (ĞºĞ¾Ğ¿Ğ¸Ñ Ğ¸Ğ· UNIVERSAL_MODULE_TEMPLATE)
        if template.lower() == "universal":
            template_dir = Path("Modules") / "UNIVERSAL_MODULE_TEMPLATE"
            if not template_dir.exists():
                console.print(f"[bold red]Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½: {template_dir}[/]")
                raise typer.Exit(code=1)

            import shutil as _shutil
            _shutil.copytree(template_dir, module_dir)

            # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ğ¼ manifest.yaml (name/display_name)
            try:
                import yaml as _yaml
                manifest_path = module_dir / "manifest.yaml"
                if manifest_path.exists():
                    data = _yaml.safe_load(manifest_path.read_text(encoding="utf-8")) or {}
                    data["name"] = name
                    data["display_name"] = name.replace('_', ' ').title()
                    manifest_path.write_text(
                        _yaml.safe_dump(data, allow_unicode=True, sort_keys=False),
                        encoding="utf-8",
                    )
            except Exception:
                pass

            console.print(f"[green]Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ ÑƒĞ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ Ğ²: {module_dir}[/]")
        else:
            # Ğ’ĞµÑ‚ĞºĞ°: Ğ»ĞµĞ³ĞºĞ¸Ğ¹ DEMO-ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½
            module_dir.mkdir(parents=True)

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ manifest.yaml
        manifest_content = f"""\
name: "{name}"
display_name: "{name.replace('_', ' ').title()}"
version: "1.0.0"
description: "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {name.replace('_', ' ').title()} Ğ´Ğ»Ñ SwiftDevBot"
author: "SwiftDevBot Team"

python_requirements: []
sdb_module_dependencies: []

model_definitions: []

commands:
  - command: "{name}"
    description: "{name.replace('_', ' ').title()}"
    icon: "ğŸ”§"
    category: "ĞĞ±Ñ‰Ğ¸Ğµ"
    admin_only: false

permissions:
  - name: "{name}.view"
    description: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}"
  - name: "{name}.use"
    description: "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}"
  - name: "{name}.admin"
    description: "[ĞĞ”ĞœĞ˜Ğ] ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}"
"""
        (module_dir / "manifest.yaml").write_text(manifest_content, encoding="utf-8")
        console.print(f"[green]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ñ„Ğ°Ğ¹Ğ»: {module_dir / 'manifest.yaml'}[/]")

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ __init__.py
        init_content = f'''\
"""
ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {name.replace('_', ' ').title()} Ğ´Ğ»Ñ SwiftDevBot

ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ.
"""

from aiogram import Router, Dispatcher, Bot
from Systems.core.services_provider import BotServicesProvider
from .handlers import router as {name}_router

router = Router(name="{name}")
router.include_router({name}_router)


async def setup_module(dp: Dispatcher, bot: Bot, services: BotServicesProvider):
    """ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
    dp.include_router(router)
    
    services.ui_registry.register_module_entry(
        module_name="{name}",
        display_name="{name.replace('_', ' ').title()}",
        entry_callback_data="module_{name}",
        description="ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {name.replace('_', ' ').title()}",
        icon="ğŸ”§",
        required_permission_to_view="{name}.view",
    )


__version__ = "1.0.0"
__author__ = "SwiftDevBot Team"
'''
        (module_dir / "__init__.py").write_text(init_content, encoding="utf-8")
        console.print(f"[green]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ñ„Ğ°Ğ¹Ğ»: {module_dir / '__init__.py'}[/]")

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ handlers.py (Ğ´ĞµĞ¼Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ±ĞµĞ· RBAC Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)
        if template.lower() == "demo":
            # DEMO: Ğ±ĞµĞ· RBAC, Ñ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ¾Ğ¹ Ğ¸ callback'Ğ°Ğ¼Ğ¸
            handlers_content = f'''\
"""
ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}
"""
from aiogram import Router, F
from aiogram.types import Message, CallbackQuery
from aiogram.filters import Command
from aiogram.fsm.context import FSMContext

from Systems.core.services_provider import BotServicesProvider
from .keyboards import main_{name}_keyboard
from .callback_data import {name.title().replace('_', '')}CB

# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
router = Router(name="{name}")

@router.message(Command("{name}"))
async def cmd_{name}(message: Message, services: BotServicesProvider):
    """ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /{name} - Ğ³Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"""
    await message.answer(
        f"ğŸ”§ <b>{name.replace('_', ' ').title()}</b>\\n\\n"
        f"Ğ­Ñ‚Ğ¾ Ğ´ĞµĞ¼Ğ¾ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹. ĞĞ¸Ğ¶Ğµ â€” Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹:",
        parse_mode="HTML",
        reply_markup=main_{name}_keyboard(),
    )


@router.callback_query({name.title().replace('_', '')}CB.filter(F.action == "function1"))
async def on_function1(cb: CallbackQuery):
    await cb.message.answer("âœ… Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ 1 Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°")
    await cb.answer()


@router.callback_query({name.title().replace('_', '')}CB.filter(F.action == "function2"))
async def on_function2(cb: CallbackQuery):
    await cb.message.answer("âš™ï¸ Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ 2: Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°")
    await cb.answer()


@router.callback_query({name.title().replace('_', '')}CB.filter(F.action == "close"))
async def on_close(cb: CallbackQuery):
    try:
        await cb.message.delete()
    except Exception:
        # Ğ•ÑĞ»Ğ¸ Ğ½ĞµĞ»ÑŒĞ·Ñ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ â€” Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ ÑƒĞ±ĞµÑ€Ñ‘Ğ¼ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ
        await cb.message.edit_reply_markup(reply_markup=None)
    await cb.answer()


# Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ğ°
__all__ = ["router"]
'''
        else:
            # Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ ÑƒĞ¶Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ ÑĞ²Ğ¾Ğ¸ handlers; Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ
            handlers_content = None
        if handlers_content is not None:
            (module_dir / "handlers.py").write_text(handlers_content, encoding="utf-8")
            console.print(f"[green]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ñ„Ğ°Ğ¹Ğ»: {module_dir / 'handlers.py'}[/]")

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ models.py
        models_content = f'''\
"""
ĞœĞ¾Ğ´ĞµĞ»Ğ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}
"""
from datetime import datetime
from typing import Optional, List
from sqlalchemy import Column, Integer, String, Text, DateTime, ForeignKey
from sqlalchemy.orm import relationship, Mapped, mapped_column
from Systems.core.database.base import Base


# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ - ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ Ğ¿Ğ¾ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
class {name.title().replace('_', '')}Item(Base):
    """ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}"""
    __tablename__ = "{name}_items"
    
    id: Mapped[int] = mapped_column(Integer, primary_key=True)
    name: Mapped[str] = mapped_column(String(200), nullable=False)
    description: Mapped[Optional[str]] = mapped_column(Text, nullable=True)
    
    # Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚ĞºĞ¸
    created_at: Mapped[datetime] = mapped_column(DateTime, default=datetime.utcnow)
    updated_at: Mapped[datetime] = mapped_column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    # Ğ¡Ğ²ÑĞ·Ğ¸
    user_id: Mapped[int] = mapped_column(Integer, ForeignKey("users.id"), nullable=False)
    
    def __repr__(self):
        return f"<{name.title().replace('_', '')}Item(id={{self.id}}, name='{{self.name}}', user_id={{self.user_id}})>"
'''
        (module_dir / "models.py").write_text(models_content, encoding="utf-8")
        console.print(f"[green]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ñ„Ğ°Ğ¹Ğ»: {module_dir / 'models.py'}[/]")

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ keyboards.py (Ğ´Ğ»Ñ demo)
        if template.lower() == "demo":
            keyboards_content = f'''\
"""
ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}
"""
from typing import Optional, List
from aiogram.types import InlineKeyboardButton, InlineKeyboardMarkup
from aiogram.utils.keyboard import InlineKeyboardBuilder

from .callback_data import {name.title().replace('_', '')}CB


def main_{name}_keyboard() -> InlineKeyboardMarkup:
    """Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}"""
    builder = InlineKeyboardBuilder()
    
    builder.row(
        InlineKeyboardButton(
            text="ğŸ”§ Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ 1",
            callback_data={name.title().replace('_', '')}CB(action="function1").pack()
        ),
        InlineKeyboardButton(
            text="âš™ï¸ Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ 2", 
            callback_data={name.title().replace('_', '')}CB(action="function2").pack()
        )
    )
    
    builder.row(
        InlineKeyboardButton(
            text="âŒ Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ",
            callback_data={name.title().replace('_', '')}CB(action="close").pack()
        )
    )
    
    return builder.as_markup()


def confirmation_keyboard(item_id: int) -> InlineKeyboardMarkup:
    """ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ"""
    builder = InlineKeyboardBuilder()
    
    builder.row(
        InlineKeyboardButton(
            text="âœ… Ğ”Ğ°",
            callback_data={name.title().replace('_', '')}CB(action="confirm", item_id=item_id).pack()
        ),
        InlineKeyboardButton(
            text="âŒ ĞĞµÑ‚",
            callback_data={name.title().replace('_', '')}CB(action="cancel").pack()
        )
    )
    
    return builder.as_markup()
'''
            (module_dir / "keyboards.py").write_text(keyboards_content, encoding="utf-8")
            console.print(f"[green]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ñ„Ğ°Ğ¹Ğ»: {module_dir / 'keyboards.py'}[/]")

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ callback_data.py (Ğ´Ğ»Ñ demo)
        if template.lower() == "demo":
            callback_data_content = f'''\
"""
Callback Data Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}
"""
from typing import Optional
from aiogram.filters.callback_data import CallbackData


class {name.title().replace('_', '')}CB(CallbackData, prefix="{name}_cb"):
    """Callback Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}"""
    action: str
    item_id: Optional[int] = None


class {name.title().replace('_', '')}ActionCB(CallbackData, prefix="{name}_action"):
    """Callback Ğ´Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}"""
    action: str
    data: Optional[str] = None
'''
            (module_dir / "callback_data.py").write_text(
                callback_data_content, encoding="utf-8"
            )
            console.print(f"[green]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ñ„Ğ°Ğ¹Ğ»: {module_dir / 'callback_data.py'}[/]")

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ states.py (Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ²ÑĞµĞ³Ğ´Ğ° ĞºĞ°Ğº Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€)
        states_content = f'''\
"""
FSM ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}
"""
from aiogram.fsm.state import State, StatesGroup


class {name.title().replace('_', '')}States(StatesGroup):
    """Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¼ {name.replace('_', ' ').title()}"""
    waiting_for_input = State()
    waiting_for_confirmation = State()
    processing = State()


class {name.title().replace('_', '')}CreationStates(StatesGroup):
    """Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²"""
    waiting_for_name = State()
    waiting_for_description = State()
    confirm_creation = State()


class {name.title().replace('_', '')}EditStates(StatesGroup):
    """Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²"""
    waiting_for_new_name = State()
    waiting_for_new_description = State()
    confirm_edit = State()
'''
        (module_dir / "states.py").write_text(states_content, encoding="utf-8")
        console.print(f"[green]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ñ„Ğ°Ğ¹Ğ»: {module_dir / 'states.py'}[/]")

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ services.py (Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ‘Ğ” Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ² Ğ´ĞµĞ¼Ğ¾-Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°Ñ…)
        services_content = f'''\
"""
Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¼ {name.replace('_', ' ').title()}
"""
from typing import List, Optional
from sqlalchemy import select, and_
from sqlalchemy.orm import selectinload

from Systems.core.database.manager import DBManager
from Systems.core.users.service import UserService
from .models import {name.title().replace('_', '')}Item


class {name.title().replace('_', '')}Service:
    """Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¼ {name.replace('_', ' ').title()}"""
    
    def __init__(self, db_manager: DBManager, user_service: UserService):
        self.db_manager = db_manager
        self.user_service = user_service
    
    async def create_item(
        self,
        user_id: int,
        name: str,
        description: Optional[str] = None
    ) -> {name.title().replace('_', '')}Item:
        """Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚"""
        async with self.db_manager.get_async_session() as session:
            item = {name.title().replace('_', '')}Item(
                name=name,
                description=description,
                user_id=user_id
            )
            
            session.add(item)
            await session.commit()
            await session.refresh(item)
            
            return item
    
    async def get_user_items(self, user_id: int) -> List[{name.title().replace('_', '')}Item]:
        """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"""
        async with self.db_manager.get_async_session() as session:
            query = select({name.title().replace('_', '')}Item).where(
                {name.title().replace('_', '')}Item.user_id == user_id
            ).order_by({name.title().replace('_', '')}Item.created_at.desc())
            
            result = await session.execute(query)
            return list(result.scalars().all())
    
    async def get_item_by_id(self, item_id: int, user_id: int) -> Optional[{name.title().replace('_', '')}Item]:
        """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ¿Ğ¾ ID Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"""
        async with self.db_manager.get_async_session() as session:
            query = select({name.title().replace('_', '')}Item).where(
                and_(
                    {name.title().replace('_', '')}Item.id == item_id,
                    {name.title().replace('_', '')}Item.user_id == user_id
                )
            )
            
            result = await session.execute(query)
            return result.scalar_one_or_none()
    
    async def update_item(
        self,
        item_id: int,
        user_id: int,
        name: Optional[str] = None,
        description: Optional[str] = None
    ) -> bool:
        """ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚"""
        async with self.db_manager.get_async_session() as session:
            query = select({name.title().replace('_', '')}Item).where(
                and_(
                    {name.title().replace('_', '')}Item.id == item_id,
                    {name.title().replace('_', '')}Item.user_id == user_id
                )
            )
            result = await session.execute(query)
            item = result.scalar_one_or_none()
            
            if not item:
                return False
            
            if name is not None:
                item.name = name
            if description is not None:
                item.description = description
            
            await session.commit()
            return True
    
    async def delete_item(self, item_id: int, user_id: int) -> bool:
        """Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚"""
        async with self.db_manager.get_async_session() as session:
            query = select({name.title().replace('_', '')}Item).where(
                and_(
                    {name.title().replace('_', '')}Item.id == item_id,
                    {name.title().replace('_', '')}Item.user_id == user_id
                )
            )
            result = await session.execute(query)
            item = result.scalar_one_or_none()
            
            if not item:
                return False
            
            await session.delete(item)
            await session.commit()
            return True
'''
        (module_dir / "services.py").write_text(services_content, encoding="utf-8")
        console.print(f"[green]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ñ„Ğ°Ğ¹Ğ»: {module_dir / 'services.py'}[/]")

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ utils.py
        utils_content = f'''\
"""
Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name.replace('_', ' ').title()}
"""
from datetime import datetime
from typing import Any, Dict, Optional

from .models import {name.title().replace('_', '')}Item


def format_item_info(item: {name.title().replace('_', '')}Item) -> str:
    """Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ± ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğµ"""
    lines = [
        f"ğŸ”§ <b>Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚ #{{item.id}}</b>",
        "",
        f"ğŸ“ <b>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ:</b> {{item.name}}",
    ]
    
    if item.description:
        lines.append(f"ğŸ“„ <b>ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:</b> {{item.description}}")
    
    lines.extend([
        f"ğŸ“… <b>Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½:</b> {{item.created_at.strftime('%d.%m.%Y %H:%M')}}",
        f"ğŸ”„ <b>ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½:</b> {{item.updated_at.strftime('%d.%m.%Y %H:%M')}}"
    ])
    
    return "\\n".join(lines)


def format_items_list(items: list[{name.title().replace('_', '')}Item]) -> str:
    """Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²"""
    if not items:
        return "ğŸ“­ Ğ£ Ğ²Ğ°Ñ Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²."
    
    lines = [f"ğŸ“ <b>Ğ’Ğ°ÑˆĞ¸ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ ({{len(items)}}):</b>", ""]
    
    for i, item in enumerate(items, 1):
        preview = item.description[:50] + "..." if item.description and len(item.description) > 50 else item.description or "Ğ‘ĞµĞ· Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ"
        lines.append(f"{{i}}. <b>{{item.name}}</b> - {{preview}}")
    
    return "\\n".join(lines)


def validate_item_name(name: str) -> tuple[bool, str]:
    """Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°"""
    if not name or not name.strip():
        return False, "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼"
    
    if len(name) > 200:
        return False, "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğµ (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 200 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)"
    
    return True, ""


def validate_item_description(description: str) -> tuple[bool, str]:
    """Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°"""
    if description and len(description) > 1000:
        return False, "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğµ (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 1000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)"
    
    return True, ""


def truncate_text(text: str, max_length: int = 50) -> str:
    """ĞĞ±Ñ€ĞµĞ·Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ´Ğ»Ğ¸Ğ½Ñ‹"""
    if len(text) <= max_length:
        return text
    return text[:max_length - 3] + "..."


def format_duration(start_time: datetime, end_time: Optional[datetime] = None) -> str:
    """Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸"""
    if end_time is None:
        end_time = datetime.utcnow()
    
    duration = end_time - start_time
    
    if duration.days > 0:
        return f"{{duration.days}} Ğ´Ğ½."
    elif duration.seconds >= 3600:
        hours = duration.seconds // 3600
        return f"{{hours}} Ñ‡."
    elif duration.seconds >= 60:
        minutes = duration.seconds // 60
        return f"{{minutes}} Ğ¼Ğ¸Ğ½."
    else:
        return "< 1 Ğ¼Ğ¸Ğ½."
'''
        (module_dir / "utils.py").write_text(utils_content, encoding="utf-8")
        console.print(f"[green]Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ñ„Ğ°Ğ¹Ğ»: {module_dir / 'utils.py'}[/]")

        # ĞĞ²Ñ‚Ğ¾-Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ Ñ„Ğ»Ğ°Ğ³Ñƒ
        if enable:
            try:
                # ĞŸÑ€ĞµĞ´Ğ¿Ğ¾Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ¿ÑƒÑ‚ÑŒ Ğ¸Ğ· Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ ĞºĞµÑˆĞ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ¿Ñ€Ğ¸ Ñ‚ĞµÑÑ‚Ğ°Ñ…/CLI
                import os as _os
                env_pdp = _os.getenv("SDB_CORE_PROJECT_DATA_PATH")
                if env_pdp:
                    enabled_path = (Path(env_pdp) / "Config" / "enabled_modules.json").resolve()
                else:
                    from Systems.core.app_settings import load_app_settings as _load_settings
                    _settings = _load_settings()
                    enabled_path = Path(_settings.core.enabled_modules_config_path)
                # ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº
                current = {"active_modules": [], "disabled_modules": []}
                try:
                    if enabled_path.exists():
                        current = json.loads(enabled_path.read_text(encoding="utf-8")) or current
                except Exception:
                    pass
                new_list = list({m for m in current.get("active_modules", [])} | {name})
                if _save_enabled_modules(new_list, enabled_path):
                    console.print(f"[green]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{name}' Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² enabled_modules.json[/]")
                else:
                    console.print(f"[yellow]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ '{name}'. Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğµ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ.[/]")
            except Exception as _e_auto:
                console.print(f"[yellow]ĞĞ²Ñ‚Ğ¾-Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾: {_e_auto}[/]")

        console.print(f"[bold green]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ğ² {module_dir}![/]")
        console.print(f"[yellow]ĞšĞ°Ğº Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ´ĞµĞ¼Ğ¾:[/]")
        console.print(f"1) Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ (ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ²ĞºĞ»ÑÑ‡Ğ°Ğ»Ğ¸): [cyan]./sdb module enable {name}[/]")
        console.print(f"2) ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ±Ğ¾Ñ‚: [cyan]./sdb restart[/]")
        console.print(f"3) Ğ’ Telegram Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ: /{name}")
        logger.success(f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {name} ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ğ² {module_dir}")
    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{name}': {e}[/]")
        logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ {name}: {e}")
        shutil.rmtree(module_dir, ignore_errors=True)
        raise typer.Exit(code=1)


@module_app.command(
    name="list", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ¸ Ğ¸Ñ… ÑÑ‚Ğ°Ñ‚ÑƒÑ."
)
def list_modules_cmd():
    loader = _get_module_loader_sync()
    if not loader:
        # Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ ÑƒĞ¶Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ²Ñ‹Ğ²ĞµĞ´ĞµĞ½Ğ¾ Ğ¸Ğ· _get_module_loader_sync Ğ¸Ğ»Ğ¸ _get_module_loader_instance_async
        raise typer.Exit(code=1)

    table = Table(
        title="[bold cyan]ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ SwiftDevBot[/]",
        show_header=True,
        header_style="bold magenta",
    )
    table.add_column("Ğ˜Ğ¼Ñ ĞœĞ¾Ğ´ÑƒĞ»Ñ (name)", style="dim cyan", min_width=20)
    table.add_column("ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼Ğ¾Ğµ Ğ˜Ğ¼Ñ", min_width=25)
    table.add_column("Ğ’ĞµÑ€ÑĞ¸Ñ", style="yellow")
    table.add_column("Ğ¢Ğ¸Ğ¿", style="blue")  # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ¼ Ñ‚Ğ¸Ğ¿
    table.add_column("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="green")
    table.add_column("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ", max_width=50, overflow="fold")

    if not loader.available_modules:
        console.print(
            "[yellow]ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ½Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ (Ğ² Modules/ Ğ¸Ğ»Ğ¸ core/sys_modules/).[/]"
        )
        return

    sorted_modules = sorted(
        loader.available_modules.values(),
        key=lambda m_info: (m_info.is_system_module, m_info.name),
    )

    for idx, module_info in enumerate(sorted_modules):
        module_type = "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹" if module_info.is_system_module else "ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½"

        # Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ´Ğ»Ñ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ enabled_plugin_names
        # Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ´Ğ»Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… - Ğ¾Ğ½Ğ¸ "Ğ²ÑĞµĞ³Ğ´Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸" (Ğ½Ğ¾ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ½Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒÑÑ Ğ¸Ğ·-Ğ·Ğ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº)
        if module_info.is_system_module:
            status_text = Text(
                "ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½ (ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹)", style="green"
            )  # Ğ¸Ğ»Ğ¸ "Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½", ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ is_loaded_successfully
            if module_info.is_loaded_successfully:
                status_text = Text("Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ âœ… (ÑĞ¸ÑÑ‚.)", style="green")
            elif module_info.error:
                status_text = Text(f"ĞÑˆĞ¸Ğ±ĞºĞ° âš ï¸ (ÑĞ¸ÑÑ‚.)", style="red")

        else:  # Ğ­Ñ‚Ğ¾ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½
            status_text = (
                Text("ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½ âœ…", style="green")
                if module_info.name in loader.enabled_plugin_names
                else Text("ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ âŒ", style="red")
            )
            if (
                module_info.name in loader.enabled_plugin_names
                and module_info.is_loaded_successfully
            ):
                status_text = Text("Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ âœ…", style="green")
            elif module_info.name in loader.enabled_plugin_names and module_info.error:
                status_text = Text(f"ĞÑˆĞ¸Ğ±ĞºĞ° âš ï¸", style="red")

        version_str = module_info.manifest.version if module_info.manifest else "[N/A]"
        display_name_str = (
            module_info.manifest.display_name
            if module_info.manifest
            else module_info.name
        )  # fallback Ğ½Ğ° Ğ¸Ğ¼Ñ Ğ¿Ğ°Ğ¿ĞºĞ¸
        description_str = (
            module_info.manifest.description
            if module_info.manifest and module_info.manifest.description
            else "-"
        )

        table.add_row(
            module_info.name,
            display_name_str,
            version_str,
            module_type,
            status_text,
            description_str,
        )
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸ (ĞºÑ€Ğ¾Ğ¼Ğµ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾)
        if idx < len(sorted_modules) - 1:
            # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ĞµĞ»Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¸Ğ· box.SIMPLE
            # box.SIMPLE Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ "â”€" Ğ´Ğ»Ñ Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ»Ğ¸Ğ½Ğ¸Ğ¹
            separator_char = "â”€"
            table.add_row(
                separator_char * 20,
                separator_char * 25,
                separator_char * 8,
                separator_char * 8,
                separator_char * 12,
                separator_char * 50,
                style="dim",
            )
    console.print(table)


@module_app.command(
    name="info", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ (Ğ¸Ğ· manifest)."
)
def info_module_cmd(
    module_name: str = typer.Argument(
        ..., help="Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ (Ğ¸Ğ· manifest.name Ğ¸Ğ»Ğ¸ Ğ¸Ğ¼Ñ Ğ¿Ğ°Ğ¿ĞºĞ¸)."
    )
):
    loader = _get_module_loader_sync()
    if not loader:
        raise typer.Exit(code=1)

    module_info = loader.get_module_info(module_name)

    if not module_info:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.[/]")
        raise typer.Exit(code=1)

    if not module_info.manifest:
        console.print(
            f"[yellow]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğ°Ğ¹Ğ´ĞµĞ½, Ğ½Ğ¾ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ° (Ğ¸Ğ»Ğ¸ Ğ¾Ğ½ Ğ½Ğµ Ğ±Ñ‹Ğ» Ñ€Ğ°ÑĞ¿Ğ°Ñ€ÑĞµĞ½).[/yellow]"
        )
        console.print(f"  ĞŸÑƒÑ‚ÑŒ Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: {module_info.path}")
        console.print(
            f"  Ğ¢Ğ¸Ğ¿: {'Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹' if module_info.is_system_module else 'ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½'}"
        )
        if module_info.error:
            console.print(
                f"  ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°: {module_info.error}"
            )
        raise typer.Exit(code=1)

    display_name_header = module_info.manifest.display_name or module_info.name
    console.print(
        Panel(
            f"[bold cyan]Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ: {display_name_header} ({module_name})[/]",
            expand=False,
            border_style="cyan",
        )
    )

    try:
        import yaml

        manifest_str = yaml.dump(
            module_info.manifest.model_dump(mode="json"),
            indent=2,
            allow_unicode=True,
            sort_keys=False,
        )
        syntax = Syntax(
            manifest_str,
            "yaml",
            theme="fruity",
            line_numbers=True,
            background_color="default",
        )
    except ImportError:
        manifest_str = json.dumps(
            module_info.manifest.model_dump(mode="json"), indent=2, ensure_ascii=False
        )
        syntax = Syntax(
            manifest_str,
            "json",
            theme="fruity",
            line_numbers=True,
            background_color="default",
        )
    except Exception as e_dump:
        console.print(
            f"[yellow]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ĞºÑ€Ğ°ÑĞ¸Ğ²Ğ¾ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚: {e_dump}. Ğ’Ñ‹Ğ²Ğ¾Ğ´ ĞºĞ°Ğº ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ:[/]"
        )
        console.print(module_info.manifest.model_dump())
        raise typer.Exit(code=1)
    console.print(syntax)


@module_app.command(
    name="enable", help="ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½ (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² enabled_modules.json)."
)
def enable_module_cmd(
    module_name: str = typer.Argument(..., help="Ğ˜Ğ¼Ñ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° Ğ´Ğ»Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸.")
):
    loader = _get_module_loader_sync()
    if not loader:
        raise typer.Exit(code=1)

    module_info = loader.get_module_info(module_name)
    if not module_info:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ ÑÑ€ĞµĞ´Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ…. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¸Ğ¼Ñ.[/]"
        )
        console.print(
            f"Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ (Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ñ‹): {[m.name for m in loader.available_modules.values() if not m.is_system_module]}"
        )
        raise typer.Exit(code=1)

    if module_info.is_system_module:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ ('{module_name}') Ğ½Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· enable/disable. ĞĞ½Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ÑÑ‚ÑÑ ÑĞ´Ñ€Ğ¾Ğ¼.[/]"
        )
        raise typer.Exit(code=1)

    enabled_modules_file_path = loader._settings.core.enabled_modules_config_path

    if module_name in loader.enabled_plugin_names:
        console.print(f"[yellow]ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ '{module_name}' ÑƒĞ¶Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½.[/]")
        return

    new_enabled_list = loader.enabled_plugin_names + [module_name]
    if _save_enabled_modules(new_enabled_list, enabled_modules_file_path):
        console.print(f"[bold green]ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ '{module_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½![/]")
        console.print(
            f"Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²ÑÑ‚ÑƒĞ¿ÑÑ‚ Ğ² ÑĞ¸Ğ»Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ±Ğ¾Ñ‚Ğ° (`./sdb.py restart`)."
        )
    else:
        console.print(
            f"[bold red]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² '{enabled_modules_file_path}'.[/]"
        )
        raise typer.Exit(code=1)


@module_app.command(
    name="disable", help="Ğ”ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½ (ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ· enabled_modules.json)."
)
def disable_module_cmd(
    module_name: str = typer.Argument(..., help="Ğ˜Ğ¼Ñ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° Ğ´Ğ»Ñ Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸.")
):
    loader = _get_module_loader_sync()
    if not loader:
        raise typer.Exit(code=1)

    module_info = loader.get_module_info(module_name)
    if not module_info:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.[/]")
        raise typer.Exit(code=1)

    if module_info.is_system_module:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ ('{module_name}') Ğ½Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· enable/disable.[/]"
        )
        raise typer.Exit(code=1)

    enabled_modules_file_path = loader._settings.core.enabled_modules_config_path

    if module_name not in loader.enabled_plugin_names:
        console.print(f"[yellow]ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ '{module_name}' Ğ½Ğµ Ğ±Ñ‹Ğ» Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½.[/]")
        return

    new_enabled_list = [m for m in loader.enabled_plugin_names if m != module_name]
    if _save_enabled_modules(new_enabled_list, enabled_modules_file_path):
        console.print(f"[bold green]ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ '{module_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½![/]")
        console.print(
            f"Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²ÑÑ‚ÑƒĞ¿ÑÑ‚ Ğ² ÑĞ¸Ğ»Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ±Ğ¾Ñ‚Ğ° (`./sdb.py restart`)."
        )
    else:
        console.print(
            f"[bold red]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² '{enabled_modules_file_path}'.[/]"
        )
        raise typer.Exit(code=1)


@module_app.command(
    name="reload",
    help="ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ (Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ€ĞµÑÑ‚Ğ°Ñ€Ñ‚ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ±Ğ¾Ñ‚Ğ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹).",
)
def reload_module_cmd(
    module_name: str = typer.Argument(..., help="Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸."),
    background: bool = typer.Option(
        False,
        "--background",
        "-b",
        help="Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ° Ğ² Ñ„Ğ¾Ğ½Ğ¾Ğ²Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°.",
    ),
    debug: bool = typer.Option(
        False,
        "--debug",
        "-d",
        help="Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ñ‚Ğ° Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°.",
    ),
):
    """
    ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¿ÑƒÑ‚ĞµĞ¼ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµÑÑ‚Ğ°Ñ€Ñ‚Ğ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ±Ğ¾Ñ‚Ğ°.
    
    Ğ’ĞĞ–ĞĞ: Ğ­Ñ‚Ğ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ€ĞµÑÑ‚Ğ°Ñ€Ñ‚ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ±Ğ¾Ñ‚Ğ° (sdb restart),
    Ğ° Ğ½Ğµ Ğ³Ğ¾Ñ€ÑÑ‡ÑƒÑ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ñ‡ĞµÑ€ĞµĞ· importlib.reload. Ğ­Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾
    Ğ½Ğ°Ğ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ³Ğ¾Ñ€ÑÑ‡Ğ°Ñ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ² Python Ğ¿Ñ€Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‰ĞµĞ¼
    asyncio event loop Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğº ÑƒÑ‚ĞµÑ‡ĞºĞ°Ğ¼ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ Ğ¸ ÑÑ‚Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¼ Ğ±Ğ°Ğ³Ğ°Ğ¼.
    
    Ğ”Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ ÑÑ‚Ñƒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ Ğ¸Ğ»Ğ¸
    `sdb restart` Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ.
    """
    import subprocess
    import os
    from pathlib import Path

    loader = _get_module_loader_sync()
    if not loader:
        raise typer.Exit(code=1)

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚
    module_info = loader.get_module_info(module_name)
    if not module_info:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ ÑÑ€ĞµĞ´Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ….[/]"
        )
        console.print(
            f"Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸: {[m.name for m in loader.available_modules.values()]}"
        )
        raise typer.Exit(code=1)

    # Ğ”Ğ»Ñ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ² Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ Ğ¾Ğ½Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹
    if not module_info.is_system_module:
        if module_name not in loader.enabled_plugin_names:
            console.print(
                f"[yellow]ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ: ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ '{module_name}' Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½.[/]"
            )
            console.print(
                f"ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ ĞµĞ³Ğ¾ Ñ‡ĞµÑ€ĞµĞ· `sdb module enable {module_name}` Ğ¿ĞµÑ€ĞµĞ´ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¾Ğ¹."
            )
            if not typer.confirm("ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº Ğ±Ğ¾Ñ‚Ğ°?", default=False):
                raise typer.Exit(code=0)

    console.print(
        Panel(
            f"[bold blue]ĞŸĞ•Ğ Ğ•Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ ĞœĞĞ”Ğ£Ğ›Ğ¯: {module_name}[/]\n"
            f"[dim]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ€ĞµÑÑ‚Ğ°Ñ€Ñ‚ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ±Ğ¾Ñ‚Ğ°...[/]",
            expand=False,
            border_style="blue",
        )
    )

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼Ğ¾Ğ¼Ñƒ Ñ„Ğ°Ğ¹Ğ»Ñƒ sdb
    project_root = Path(__file__).resolve().parent.parent.parent
    sdb_path = project_root / "sdb"
    sdb_py_path = project_root / "sdb.py"

    sdb_executable_str: Optional[str] = None
    if sdb_path.exists() and os.access(sdb_path, os.X_OK):
        sdb_executable_str = str(sdb_path)
    elif sdb_py_path.exists():
        sdb_executable_str = str(sdb_py_path)

    if not sdb_executable_str:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» SDB CLI.[/]"
        )
        raise typer.Exit(code=1)

    # Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ restart
    try:
        restart_args = [sdb_executable_str, "restart"]
        if background:
            restart_args.append("--background")
        if debug:
            restart_args.append("--debug")

        console.print(
            f"[dim]Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ: {' '.join(restart_args)}[/dim]"
        )

        # Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ restart Ñ‡ĞµÑ€ĞµĞ· subprocess
        result = subprocess.run(restart_args)

        if result.returncode == 0:
            console.print(
                f"[bold green]âœ… ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ (Ğ±Ğ¾Ñ‚ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½)![/]"
            )
        else:
            console.print(
                f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞµ Ğ±Ğ¾Ñ‚Ğ° (ĞºĞ¾Ğ´: {result.returncode}).[/]"
            )
            raise typer.Exit(code=result.returncode)

    except KeyboardInterrupt:
        console.print("\n[yellow]ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ğ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼.[/]")
        raise typer.Exit(code=130)
    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞµ Ğ±Ğ¾Ñ‚Ğ°: {e}[/]")
        import traceback
        console.print(f"[dim]{traceback.format_exc()}[/]")
        raise typer.Exit(code=1)


async def _clean_tables_module_async_internal(
    module_name: str, loader: Any, called_from_uninstall: bool = False
) -> bool:
    if not called_from_uninstall:
        console.print(
            Panel(
                f"[bold red]Ğ£Ğ”ĞĞ›Ğ•ĞĞ˜Ğ• Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦ ĞœĞĞ”Ğ£Ğ›Ğ¯: {module_name}[/]",
                expand=False,
                border_style="red",
            )
        )

    module_info = loader.get_module_info(module_name)
    if not module_info:  # ĞœĞ°Ğ½Ğ¸Ñ„ĞµÑÑ‚ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñƒ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.[/]")
        return False

    if not module_info.manifest:
        console.print(
            f"[yellow]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°. ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ.[/yellow]"
        )
        return True  # Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¼, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ½ĞµÑ‡ĞµĞ³Ğ¾ ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ

    model_definitions_paths = module_info.manifest.model_definitions
    if not model_definitions_paths:
        console.print(
            f"[yellow]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ´ĞµĞºĞ»Ğ°Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ ('model_definitions'). Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ.[/]"
        )
        return True

    if not called_from_uninstall:
        console.print(
            f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ´ĞµĞºĞ»Ğ°Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ Ğ¿ÑƒÑ‚Ğ¸ Ğº Ğ¼Ğ¾Ğ´ĞµĞ»ÑĞ¼ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†:"
        )
        for path_str in model_definitions_paths:
            console.print(f"  - {path_str}")
        if not confirm_action(
            f"Ğ’Ñ‹ ĞĞ‘Ğ¡ĞĞ›Ğ®Ğ¢ĞĞ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ£Ğ”ĞĞ›Ğ˜Ğ¢Ğ¬ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}'? Ğ­Ñ‚Ğ¾ [bold red]ĞĞ•ĞĞ‘Ğ ĞĞ¢Ğ˜ĞœĞ[/]!",
            default_choice=False,
            abort_on_false=True,
        ):
            return False

    models_to_drop: List[Type[SDBBaseAlchemyModel]] = []
    failed_imports: List[str] = []
    console.print(f"\nĞ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ ĞºĞ»Ğ°ÑÑĞ¾Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ '{module_name}'...")

    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿ÑƒÑ‚ÑŒ Ğ´Ğ»Ñ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ñ‚Ğ¸Ğ¿Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
    # Ğ­Ñ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾, Ñ‚Ğ°Ğº ĞºĞ°Ğº model_definitions Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ (Ñ…Ğ¾Ñ‚Ñ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğµ)
    # ĞĞ¾ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ñ‹, Ğ¿Ğ¾ĞºĞ° Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğµ Ğ¿ÑƒÑ‚Ğ¸ Ñ‚Ğ¸Ğ¿Ğ° "Modules.my_plugin.models.MyTable"
    # Ğ¸Ğ»Ğ¸ "core.sys_modules.my_sys_mod.models.SysTable"

    for import_path_str in model_definitions_paths:
        try:
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ² Ğ¿ÑƒÑ‚Ğ¸, Ğ¸Ğ½Ğ°Ñ‡Ğµ ÑÑ‚Ğ¾ Ğ½Ğµ Ğ¿ÑƒÑ‚ÑŒ Ğ´Ğ»Ñ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ°
            if "." not in import_path_str:
                failed_imports.append(import_path_str)
                console.print(
                    f"  [yellow]ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ:[/yellow] '{import_path_str}' Ğ½Ğµ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¼ Ğ¿ÑƒÑ‚ĞµĞ¼ Ğ´Ğ»Ñ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Python-Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸."
                )
                continue

            module_path_part, class_name = import_path_str.rsplit(".", 1)
            imported_py_module = importlib.import_module(module_path_part)
            model_class_obj = getattr(
                imported_py_module, class_name
            )  # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ°Ğ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚ ĞºĞ»Ğ°ÑÑĞ°

            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ĞºĞ»Ğ°ÑÑ Ğ¸ Ğ¾Ğ½ Ğ½Ğ°ÑĞ»ĞµĞ´ÑƒĞµÑ‚ÑÑ Ğ¾Ñ‚ SDBBaseAlchemyModel
            if (
                isinstance(model_class_obj, type)
                and issubclass(model_class_obj, SDBBaseAlchemyModel)
                and hasattr(model_class_obj, "__table__")
            ):
                models_to_drop.append(
                    model_class_obj
                )  # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ»Ğ°ÑÑ, Ğ° Ğ½Ğµ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€
                console.print(
                    f"  [green]Ğ£ÑĞ¿ĞµÑ…:[/green] {import_path_str} (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°: {model_class_obj.__tablename__})"
                )
            else:
                failed_imports.append(import_path_str)
                console.print(
                    f"  [yellow]ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ:[/yellow] '{import_path_str}' Ğ½Ğµ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒÑ SQLAlchemy, Ğ½Ğ°ÑĞ»ĞµĞ´ÑƒĞµĞ¼Ğ¾Ğ¹ Ğ¾Ñ‚ SDBBaseModel."
                )
        except Exception as e_import:
            failed_imports.append(import_path_str)
            console.print(
                f"  [red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ´Ğ»Ñ '{import_path_str}':[/red] {type(e_import).__name__} - {e_import}"
            )

    if failed_imports:
        console.print(
            f"\n[bold yellow]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ {len(failed_imports)} Ğ¸Ğ· {len(model_definitions_paths)} Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ '{module_name}'.[/]"
        )
        if not models_to_drop:  # Ğ•ÑĞ»Ğ¸ Ğ’ĞĞĞ‘Ğ©Ğ• Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
            console.print(
                "[bold red]ĞĞµÑ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹. ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ğ½Ğ°.[/]"
            )
            return False
        # Ğ•ÑĞ»Ğ¸ Ñ‡Ğ°ÑÑ‚ÑŒ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ°ÑÑŒ, Ğ° Ñ‡Ğ°ÑÑ‚ÑŒ Ğ½ĞµÑ‚ - ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµĞ¼, Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ñ‚ÑŒ Ğ»Ğ¸ Ñ Ñ‚ĞµĞ¼, Ñ‡Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ
        if not called_from_uninstall and not confirm_action(
            f"ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ´Ğ»Ñ {len(models_to_drop)} ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹?",
            default_choice=False,
            abort_on_false=True,
        ):
            return False
        elif (
            called_from_uninstall
        ):  # Ğ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ñ‡Ğ°ÑÑ‚ÑŒ Ğ´ĞµĞ¸Ğ½ÑÑ‚Ğ°Ğ»Ğ»ÑÑ†Ğ¸Ğ¸, Ñ‚Ğ¾ Ğ»ÑƒÑ‡ÑˆĞµ Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ñ‚ÑŒ Ñ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ñ‹Ğ¼ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸ĞµĞ¼
            console.print(
                "[bold yellow]Ğ˜Ğ·-Ğ·Ğ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹, Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ¿Ñ€Ğ¸ Ğ´ĞµĞ¸Ğ½ÑÑ‚Ğ°Ğ»Ğ»ÑÑ†Ğ¸Ğ¸ Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾. "
                "Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ, ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾.[/]"
            )
            return False  # Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼, Ñ‡Ñ‚Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¼/ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¼

    if not models_to_drop:  # Ğ•ÑĞ»Ğ¸ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿ÑƒÑÑ‚ Ğ¿Ğ¾ÑĞ»Ğµ Ğ²ÑĞµÑ… Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¾Ğº
        console.print(
            f"[bold yellow]ĞĞµÑ‚ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}'.[/]"
        )
        return True  # Ğ¡Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¼, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ½ĞµÑ‡ĞµĞ³Ğ¾ Ğ±Ñ‹Ğ»Ğ¾ ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ

    if (
        not called_from_uninstall
    ):  # Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ, ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ½Ğµ Ñ‡Ğ°ÑÑ‚ÑŒ uninstall
        console.print(
            "\n[bold blue]Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ SQLAlchemy Ğ±ÑƒĞ´ÑƒÑ‚ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ Ğ¸Ğ· Ğ‘Ğ”:[/]"
        )
        for model_cls_to_drop in models_to_drop:
            console.print(f"  - [cyan]{model_cls_to_drop.__tablename__}[/cyan]")
        if not confirm_action(
            f"ĞŸĞĞ¡Ğ›Ğ•Ğ”ĞĞ•Ğ• ĞŸĞĞ”Ğ¢Ğ’Ğ•Ğ Ğ–Ğ”Ğ•ĞĞ˜Ğ•: Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ {len(models_to_drop)} Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ´Ğ»Ñ '{module_name}'?",
            default_choice=False,
            abort_on_false=True,
        ):
            return False

    settings_obj, db_m, _ = await get_sdb_services_for_cli(init_db=True)
    if not (settings_obj and db_m):
        console.print(
            "[bold red]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ DBManager Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†.[/]"
        )
        return False
    try:
        console.print(f"\n[magenta]Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ´Ğ»Ñ '{module_name}'...[/magenta]")
        await db_m.drop_specific_module_tables(
            models_to_drop
        )  # ĞŸĞµÑ€ĞµĞ´Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞšĞ›ĞĞ¡Ğ¡ĞĞ’ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹
        console.print(f"[bold green]Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ´Ğ»Ñ '{module_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹.[/]")
        if not called_from_uninstall:
            console.print(
                "[yellow]ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ: Alembic Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¾Ğ± ÑÑ‚Ğ¾Ğ¼ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸. "
                "Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ğ¸Ñ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ² Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¼, "
                "Ğ²Ğ°Ğ¼ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ Ñ€ĞµĞ²Ğ¸Ğ·Ğ¸Ñ Ğ¸Ğ»Ğ¸ 'Ğ·Ğ°ÑˆÑ‚Ğ°Ğ¼Ğ¿Ğ¾Ğ²Ğ°Ñ‚ÑŒ' ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Alembic.[/yellow]"
            )
        return True
    except Exception as e_drop:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ´Ğ»Ñ '{module_name}': {e_drop}[/]"
        )
        return False
    finally:
        if db_m:
            await db_m.dispose()


@module_app.command(
    name="clean-tables",
    help="[ĞĞŸĞĞ¡ĞĞ] Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ¸Ğ· Ğ‘Ğ” (ÑĞ¾Ğ³Ğ»Ğ°ÑĞ½Ğ¾ manifest).",
)
def clean_tables_module_cmd_wrapper(
    module_name: str = typer.Argument(..., help="Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ, Ñ‡ÑŒĞ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ.")
):
    try:
        loader = asyncio.run(_get_module_loader_instance_async())
        if not loader:
            raise typer.Exit(code=1)
        if not asyncio.run(
            _clean_tables_module_async_internal(module_name=module_name, loader=loader)
        ):
            raise typer.Exit(code=1)
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² 'module clean-tables': {e}[/]")
        raise typer.Exit(code=1)


@module_app.command(
    name="uninstall", help="[ĞĞŸĞĞ¡ĞĞ] Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ (Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¸, Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, ĞµĞ³Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)."
)
def uninstall_module_cmd_wrapper(
    module_name: str = typer.Argument(..., help="Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ."),
    remove_data: bool = typer.Option(
        False,
        "--remove-data/--keep-data",
        help="Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ»Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ‘Ğ”). ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ”ĞĞĞĞ«Ğ• Ğ¡ĞĞ¥Ğ ĞĞĞ¯Ğ®Ğ¢Ğ¡Ğ¯.",
    ),
):
    try:
        asyncio.run(
            _uninstall_module_async(module_name=module_name, remove_data=remove_data)
        )
    except typer.Exit:
        raise
    except Exception as e:
        console.print(
            f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'module uninstall': {e}[/]"
        )
        raise typer.Exit(code=1)


async def _uninstall_module_async(module_name: str, remove_data: bool):
    console.print(
        Panel(
            f"[bold red]Ğ£Ğ”ĞĞ›Ğ•ĞĞ˜Ğ• ĞœĞĞ”Ğ£Ğ›Ğ¯: {module_name}[/]",
            expand=False,
            border_style="red",
        )
    )

    loader = await _get_module_loader_instance_async()
    if not loader:
        raise typer.Exit(code=1)

    module_info = loader.get_module_info(module_name)
    if not module_info:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ.[/]"
        )
        raise typer.Exit(code=1)

    if module_info.is_system_module:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ ('{module_name}') Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ ÑƒĞ´Ğ°Ğ»ĞµĞ½ Ñ‡ĞµÑ€ĞµĞ· ÑÑ‚Ñƒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ.[/]"
        )
        raise typer.Exit(code=1)

    console.print(
        f"ĞŸÑƒÑ‚ÑŒ Ğº Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ: [cyan]{module_info.path}[/]"
    )
    if not confirm_action(
        f"Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ£Ğ”ĞĞ›Ğ˜Ğ¢Ğ¬ Ğ¤ĞĞ™Ğ›Ğ« Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° '{module_name}'?",
        default_choice=False,
        abort_on_false=True,
    ):
        return

    data_cleaned_successfully = True  # ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ, ĞµÑĞ»Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ
    if remove_data:
        console.print(f"\nĞ—Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° '{module_name}'.")
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ñ‡Ñ‚Ğ¾ ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ (Ğ´ĞµĞºĞ»Ğ°Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ»Ğ¸ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸)
        if module_info.manifest and module_info.manifest.model_definitions:
            if confirm_action(
                f"Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° '{module_name}' Ğ¿Ñ€Ğ¸Ğ²ĞµĞ´ĞµÑ‚ Ğº [bold red]ĞŸĞĞ¢Ğ•Ğ Ğ• Ğ’Ğ¡Ğ•Ğ¥ Ğ•Ğ“Ğ Ğ¢ĞĞ‘Ğ›Ğ˜Ğ¦ Ğ’ Ğ‘Ğ”[/]. ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ?",
                default_choice=False,
                abort_on_false=True,
            ):
                data_cleaned_successfully = await _clean_tables_module_async_internal(
                    module_name, loader, called_from_uninstall=True
                )
                if not data_cleaned_successfully:
                    console.print(
                        f"[bold red]ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° '{module_name}'.[/]"
                    )
                    if not confirm_action(
                        "ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ°, Ğ½ĞµÑĞ¼Ğ¾Ñ‚Ñ€Ñ Ğ½Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…?",
                        default_choice=False,
                        abort_on_false=True,
                    ):
                        console.print(
                            "[bold yellow]Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾.[/bold yellow]"
                        )
                        raise typer.Exit(code=1)
            else:  # ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚ĞºĞ°Ğ·Ğ°Ğ»ÑÑ ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
                data_cleaned_successfully = (
                    False  # Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ Ğ¿Ğ¾ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
                )
                console.print(
                    "[yellow]Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾. Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° Ğ²ÑĞµ ĞµÑ‰Ğµ Ğ±ÑƒĞ´ÑƒÑ‚ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ (ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¾).[/yellow]"
                )
        else:  # ĞĞµÑ‚ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ
            console.print(
                f"[dim]ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ '{module_name}' Ğ½Ğµ Ğ´ĞµĞºĞ»Ğ°Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ² Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğµ. Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†) Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ.[/dim]"
            )
            # data_cleaned_successfully Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ True
    else:
        console.print(
            f"\n[yellow]Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° '{module_name}' (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ‘Ğ”) Ğ½Ğµ Ğ±ÑƒĞ´ÑƒÑ‚ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ (Ğ¾Ğ¿Ñ†Ğ¸Ñ --keep-data).[/yellow]"
        )
        data_cleaned_successfully = False  # Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑĞ»Ğ¸ÑÑŒ

    console.print(
        f"\nĞ”ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° '{module_name}' (ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· enabled_modules.json)..."
    )
    enabled_modules_file_path = loader._settings.core.enabled_modules_config_path
    if module_name in loader.enabled_plugin_names:
        new_enabled_list = [m for m in loader.enabled_plugin_names if m != module_name]
        if _save_enabled_modules(new_enabled_list, enabled_modules_file_path):
            console.print(f"[green]ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ '{module_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.[/]")
        else:
            console.print(
                f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° '{module_name}' (Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ enabled_modules.json).[/]"
            )
            if not confirm_action(
                "ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ°, Ğ½ĞµÑĞ¼Ğ¾Ñ‚Ñ€Ñ Ğ½Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸?",
                default_choice=False,
                abort_on_false=True,
            ):
                console.print(
                    "[bold yellow]Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾.[/bold yellow]"
                )
                raise typer.Exit(code=1)
    else:
        console.print(f"[dim]ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ '{module_name}' Ğ½Ğµ Ğ±Ñ‹Ğ» Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½.[/dim]")

    module_dir_path = module_info.path
    console.print(f"\nĞ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ°: [cyan]{module_dir_path}[/]")
    if not confirm_action(
        f"[bold red]ĞŸĞĞ¡Ğ›Ğ•Ğ”ĞĞ•Ğ• ĞŸĞ Ğ•Ğ”Ğ£ĞŸĞ Ğ•Ğ–Ğ”Ğ•ĞĞ˜Ğ•: Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ '{module_dir_path}'? Ğ­Ñ‚Ğ¾ ĞĞ•ĞĞ‘Ğ ĞĞ¢Ğ˜ĞœĞ.[/bold red]",
        default_choice=False,
        abort_on_false=True,
    ):
        return

    try:
        shutil.rmtree(module_dir_path)
        console.print(
            f"[bold green]Ğ”Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° '{module_dir_path}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ°.[/]"
        )
    except Exception as e_rmtree:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ '{module_dir_path}': {e_rmtree}[/]"
        )
        raise typer.Exit(code=1)

    console.print(f"\n[bold green]ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ '{module_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½.[/]")
    if (
        remove_data and not data_cleaned_successfully
    ):  # Ğ•ÑĞ»Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ»Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, Ğ½Ğ¾ Ğ¾Ğ½Ğ¾ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ
        console.print(
            "[bold yellow]ĞĞ´Ğ½Ğ°ĞºĞ¾, Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†) Ğ²Ğ¾Ğ·Ğ½Ğ¸ĞºĞ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ğ¸Ğ»Ğ¸ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ±Ñ‹Ğ»Ğ° Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°.[/bold yellow]"
        )
    elif not remove_data:  # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ»Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        console.print("[dim](Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑĞ»Ğ¸ÑÑŒ).[/dim]")
    console.print("ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ±Ğ¾Ñ‚Ğ°, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²ÑÑ‚ÑƒĞ¿Ğ¸Ğ»Ğ¸ Ğ² ÑĞ¸Ğ»Ñƒ.")


@module_app.command(
    name="list-available", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸, Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¸ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾."
)
def list_available_modules_cmd(
    local_only: bool = typer.Option(
        False, "--local-only", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸"
    ),
    show_details: bool = typer.Option(
        False, "--details", "-d", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ…"
    ),
    format: str = typer.Option(
        "table", "--format", "-f", help="Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°: table, json, yaml"
    ),
):
    try:
        asyncio.run(_list_available_modules_async(local_only, show_details, format))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(
            f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'module list-available': {e}[/]"
        )
        raise typer.Exit(code=1)


async def _list_available_modules_async(
    local_only: bool, show_details: bool, format: str
):
    """ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸"""
    console.print(
        Panel(
            "[bold blue]ĞŸĞĞ˜Ğ¡Ğš Ğ”ĞĞ¡Ğ¢Ğ£ĞŸĞĞ«Ğ¥ ĞœĞĞ”Ğ£Ğ›Ğ•Ğ™[/]", expand=False, border_style="blue"
        )
    )

    loader = await _get_module_loader_instance_async()
    if not loader:
        raise typer.Exit(code=1)

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
    local_modules = loader.get_all_modules_info()

    if local_only:
        console.print("[yellow]ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸...[/]")
        await _display_modules(local_modules, "Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸", show_details, format)
        return

    # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
    console.print("[cyan]Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸:[/]")
    await _display_modules(local_modules, "Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸", show_details, format)

    # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸
    console.print("\n[cyan]ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ¸Ğ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ:[/]")

    # ĞŸĞ¾ĞºĞ° ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ - Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹
    repo_modules = [
        {
            "name": "example-module",
            "version": "1.0.0",
            "description": "ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ¸Ğ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ",
        },
        {"name": "test-plugin", "version": "2.1.0", "description": "Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½"},
    ]

    if repo_modules:
        for module in repo_modules:
            console.print(
                f"  ğŸ“¦ {module['name']} v{module['version']} - {module['description']}"
            )
    else:
        console.print("[dim]ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸.[/]")

    console.print(
        "[dim]Ğ’ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¼ Ğ·Ğ´ĞµÑÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸ĞµĞ¼.[/]"
    )

    # ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ
    enabled_count = sum(1 for m in local_modules if m.is_enabled)
    total_count = len(local_modules)

    console.print(f"\n[bold green]Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:[/]")
    console.print(f"  ğŸ“¦ Ğ’ÑĞµĞ³Ğ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹: {total_count}")
    console.print(f"  âœ… Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾: {enabled_count}")
    console.print(f"  âŒ ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾: {total_count - enabled_count}")


async def _display_modules(
    modules: List[Any], title: str, show_details: bool, format: str
):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    if not modules:
        console.print(f"[dim]ĞĞµÑ‚ {title.lower()}[/]")
        return

    if format == "json":
        await _display_modules_json(modules, show_details)
    elif format == "yaml":
        await _display_modules_yaml(modules, show_details)
    else:
        await _display_modules_table(modules, show_details)


async def _display_modules_table(modules: List[Any], show_details: bool):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ² Ğ²Ğ¸Ğ´Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹"""
    from rich.table import Table

    table = Table(title="Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸")
    table.add_column("Ğ˜Ğ¼Ñ", style="cyan", no_wrap=True)
    table.add_column("Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ", style="green")
    table.add_column("Ğ’ĞµÑ€ÑĞ¸Ñ", style="yellow")
    table.add_column("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ", style="white")

    if show_details:
        table.add_column("ĞĞ²Ñ‚Ğ¾Ñ€", style="blue")
        table.add_column("Ğ¢Ğ¸Ğ¿", style="magenta")

    for module in modules:
        status = "âœ… Ğ’ĞºĞ»ÑÑ‡ĞµĞ½" if module.is_enabled else "âŒ ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½"
        if module.error:
            status = f"âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ°: {module.error}"

        version = module.manifest.version if module.manifest else "ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ°"
        description = module.manifest.description if module.manifest else "ĞĞµÑ‚ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ"

        row = [module.name, status, version, description]

        if show_details:
            author = module.manifest.author if module.manifest else "ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½"
            module_type = "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹" if module.is_system_module else "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹"
            row.extend([author, module_type])

        table.add_row(*row)

    console.print(table)


async def _display_modules_json(modules: List[Any], show_details: bool):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ JSON"""
    import json

    modules_data = []
    for module in modules:
        module_data = {
            "name": module.name,
            "enabled": module.is_enabled,
            "error": module.error,
            "is_system_module": module.is_system_module,
        }

        if module.manifest:
            module_data.update(
                {
                    "version": module.manifest.version,
                    "description": module.manifest.description,
                    "author": module.manifest.author,
                    "website": module.manifest.website,
                    "email": module.manifest.email,
                    "license": module.manifest.license,
                }
            )

        modules_data.append(module_data)

    console.print(json.dumps(modules_data, indent=2, ensure_ascii=False))


async def _display_modules_yaml(modules: List[Any], show_details: bool):
    """ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ YAML"""
    import yaml

    modules_data = []
    for module in modules:
        module_data = {
            "name": module.name,
            "enabled": module.is_enabled,
            "error": module.error,
            "is_system_module": module.is_system_module,
        }

        if module.manifest:
            module_data.update(
                {
                    "version": module.manifest.version,
                    "description": module.manifest.description,
                    "author": module.manifest.author,
                    "website": module.manifest.website,
                    "email": module.manifest.email,
                    "license": module.manifest.license,
                }
            )

        modules_data.append(module_data)

    console.print(yaml.dump(modules_data, default_flow_style=False, allow_unicode=True))


@module_app.command(
    name="install", help="Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¸Ğ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ»Ğ¸ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°."
)
def install_module_cmd(
    module_name: str = typer.Argument(..., help="Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ´Ğ»Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸."),
    source: str = typer.Option(
        "local", "--source", "-s", help="Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: local, repo, url"
    ),
    url: Optional[str] = typer.Option(
        None, "--url", help="URL Ğ´Ğ»Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ¸Ğ· Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ğ°"
    ),
):
    try:
        asyncio.run(_install_module_async(module_name, source, url))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(
            f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'module install': {e}[/]"
        )
        raise typer.Exit(code=1)


async def _install_module_async(module_name: str, source: str, url: Optional[str]):
    """Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ"""
    console.print(
        Panel(
            f"[bold blue]Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ ĞœĞĞ”Ğ£Ğ›Ğ¯: {module_name}[/]",
            expand=False,
            border_style="blue",
        )
    )

    if source == "local":
        await _install_local_module(module_name)
    elif source == "repo":
        console.print("[cyan]Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ¸Ğ· Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ...[/]")

        # ĞŸĞ¾ĞºĞ° ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ - Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
        repo_modules = [
            {
                "name": "example-module",
                "version": "1.0.0",
                "description": "ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ",
            },
            {
                "name": "test-plugin",
                "version": "2.1.0",
                "description": "Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½",
            },
        ]

        # Ğ˜Ñ‰ĞµĞ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸
        module_found = None
        for repo_module in repo_modules:
            if repo_module["name"] == module_name:
                module_found = repo_module
                break

        if module_found:
            console.print(
                f"[green]ĞĞ°Ğ¹Ğ´ĞµĞ½ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸: {module_found['name']} v{module_found['version']}[/]"
            )
            console.print(f"[cyan]ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ: {module_found['description']}[/]")

            if confirm_action(f"Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ¸Ğ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ?"):
                # Ğ—Ğ´ĞµÑÑŒ Ğ±Ñ‹Ğ»Ğ° Ğ±Ñ‹ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
                console.print(
                    f"[green]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ¸Ğ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ![/]"
                )
                console.print(
                    "[dim]Ğ’ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¼ Ğ·Ğ´ĞµÑÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ· Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ.[/]"
                )
            else:
                console.print("[yellow]Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°.[/]")
        else:
            console.print(f"[yellow]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸.[/]")
            console.print("[cyan]Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸:[/]")
            for repo_module in repo_modules:
                console.print(
                    f"  ğŸ“¦ {repo_module['name']} v{repo_module['version']} - {repo_module['description']}"
                )
    elif source == "url" and url:
        await _install_module_from_url(module_name, url)
    else:
        console.print("[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ URL.[/]")
        raise typer.Exit(code=1)


async def _install_local_module(module_name: str):
    """Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ (ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ· Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸)"""
    console.print(f"[cyan]ĞŸĞ¾Ğ¸ÑĞº Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}'...[/]")

    # ĞŸĞ¾Ğ¸ÑĞº Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ² ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸ÑÑ…
    search_dirs = [
        Path.home() / "modules",
        Path.home() / ".local" / "modules",
        Path.cwd() / "external_modules",
        Path.cwd() / "modules_backup",
    ]

    module_found = False
    for search_dir in search_dirs:
        if search_dir.exists():
            module_path = search_dir / module_name
            if module_path.exists() and module_path.is_dir():
                console.print(f"[green]ĞĞ°Ğ¹Ğ´ĞµĞ½ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ²: {module_path}[/]")

                # ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
                target_path = PROJECT_ROOT / "Modules" / module_name
                if target_path.exists():
                    if not confirm_action(
                        f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚. ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ?"
                    ):
                        console.print("[yellow]Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°.[/]")
                        return
                    import shutil

                    shutil.rmtree(target_path)

                try:
                    import shutil

                    shutil.copytree(module_path, target_path)
                    console.print(
                        f"[bold green]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½![/]"
                    )
                    module_found = True
                    break
                except Exception as e:
                    console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: {e}[/]")
                    return

    if not module_found:
        console.print(
            f"[yellow]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ñ… Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸ÑÑ….[/]"
        )
        console.print("[dim]Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ² Ğ¾Ğ´Ğ½Ñƒ Ğ¸Ğ· Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹:[/]")
        for search_dir in search_dirs:
            console.print(f"  - {search_dir}")


async def _install_module_from_url(module_name: str, url: str):
    """Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¸Ğ· URL"""
    console.print(f"[cyan]Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}' Ğ¸Ğ· URL: {url}[/]")

    try:
        import shutil
        import tempfile
        import zipfile

        import requests

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ
        with tempfile.TemporaryDirectory() as temp_dir:
            temp_path = Path(temp_dir)

            # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»
            console.print("[cyan]Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ...[/]")
            response = requests.get(url, timeout=30)
            response.raise_for_status()

            # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»
            zip_path = temp_path / f"{module_name}.zip"
            with open(zip_path, "wb") as f:
                f.write(response.content)

            # Ğ Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ°Ñ€Ñ…Ğ¸Ğ²
            console.print("[cyan]Ğ Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²ĞºĞ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ...[/]")
            with zipfile.ZipFile(zip_path, "r") as zip_ref:
                zip_ref.extractall(temp_path)

            # Ğ˜Ñ‰ĞµĞ¼ Ğ¿Ğ°Ğ¿ĞºÑƒ Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¼
            module_dir = None
            for item in temp_path.iterdir():
                if item.is_dir() and (
                    item.name == module_name or item.name.endswith(f"-{module_name}")
                ):
                    module_dir = item
                    break

            if not module_dir:
                # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°ÑˆĞ»Ğ¸ Ğ¿Ğ°Ğ¿ĞºÑƒ Ñ Ğ¸Ğ¼ĞµĞ½ĞµĞ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ, Ğ±ĞµÑ€ĞµĞ¼ Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ
                for item in temp_path.iterdir():
                    if item.is_dir():
                        module_dir = item
                        break

            if not module_dir:
                console.print(
                    "[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¿Ğ°Ğ¿ĞºÑƒ Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¼ Ğ² Ğ°Ñ€Ñ…Ğ¸Ğ²Ğµ.[/]"
                )
                return

            # ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
            target_path = PROJECT_ROOT / "Modules" / module_name
            if target_path.exists():
                if not confirm_action(
                    f"ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚. ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ?"
                ):
                    console.print("[yellow]Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°.[/]")
                    return
                shutil.rmtree(target_path)

            shutil.copytree(module_dir, target_path)
            console.print(
                f"[bold green]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸Ğ· URL![/]"
            )

    except requests.RequestException as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: {e}[/]")
    except zipfile.BadZipFile:
        console.print(
            "[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ğ½Ğµ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¼ ZIP Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ¾Ğ¼.[/]"
        )
    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: {e}[/]")


@module_app.command(
    name="update", help="ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¸Ğ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ»Ğ¸ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°."
)
def update_module_cmd(
    module_name: str = typer.Argument(
        ..., help="Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ, Ğ¸Ğ»Ğ¸ '--all'."
    ),
    force: bool = typer.Option(False, "--force", help="ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ."),
):
    try:
        asyncio.run(_update_module_async(module_name, force))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'module update': {e}[/]")
        raise typer.Exit(code=1)


async def _update_module_async(module_name: str, force: bool):
    """ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ"""
    console.print(
        Panel(
            f"[bold blue]ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞœĞĞ”Ğ£Ğ›Ğ¯: {module_name}[/]",
            expand=False,
            border_style="blue",
        )
    )

    loader = await _get_module_loader_instance_async()
    if not loader:
        raise typer.Exit(code=1)

    if module_name == "--all":
        console.print("[cyan]ĞœĞ°ÑÑĞ¾Ğ²Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹...[/]")

        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ²ÑĞµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
        active_modules = [m for m in loader.get_all_modules_info() if m.is_enabled]

        if not active_modules:
            console.print("[yellow]ĞĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ.[/]")
            return

        updated_count = 0
        for module in active_modules:
            try:
                if await _update_single_module(module.name, force):
                    updated_count += 1
            except Exception as e:
                console.print(
                    f"[red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module.name}': {e}[/]"
                )

        console.print(
            f"[bold green]ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹: {updated_count}/{len(active_modules)}[/]"
        )
        return

    # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
    await _update_single_module(module_name, force)


async def _update_single_module(module_name: str, force: bool):
    """ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ´Ğ¸Ğ½ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ"""
    console.print(f"[cyan]ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}'...[/]")

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
    module_path = PROJECT_ROOT / "Modules" / module_name
    if not module_path.exists():
        console.print(f"[bold red]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.[/]")
        return False

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
    if not force:
        console.print("[cyan]ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ...[/]")

        # ĞŸĞ¾ĞºĞ° ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° - Ğ² Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¼ Ğ·Ğ´ĞµÑÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²ĞµÑ€ÑĞ¸Ğ¹
        console.print(
            "[yellow]ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾ĞºĞ° Ğ½Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ°.[/]"
        )
        console.print("[dim]Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ --force Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ.[/]")
        console.print("[cyan]Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ:[/]")
        console.print("  - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ --force Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ")
        console.print("  - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ")
        return False

    # Ğ”Ğ»Ñ Ğ´ĞµĞ¼Ğ¾Ğ½ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
    console.print(f"[cyan]ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}'...[/]")

    # Ğ—Ğ´ĞµÑÑŒ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ¸Ğ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
    # ĞŸĞ¾ĞºĞ° Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼, Ñ‡Ñ‚Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾
    console.print(f"[green]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ.[/]")
    console.print("[dim]Ğ’ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¼ Ğ·Ğ´ĞµÑÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ¸Ğ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ.[/]")

    return True


@module_app.command(
    name="visibility",
    help="Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒÑ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹."
)
def module_visibility_cmd(
    module_name: str = typer.Argument(..., help="Ğ˜Ğ¼Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"),
    public: Optional[bool] = typer.Option(
        None, "--public/--private", help="Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ñ‹Ğ¼ Ğ²ÑĞµĞ¼ (--public) Ğ¸Ğ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸ (--private)"
    ),
    show: bool = typer.Option(
        False, "--show", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºÑƒ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸"
    ),
):
    """
    Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒÑ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.
    
    Ğ•ÑĞ»Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ --public, Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ğ¸Ğ´ĞµĞ½ Ğ²ÑĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼ (assign_default_access_to_user_role: true).
    Ğ•ÑĞ»Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ --private, Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ğ¸Ğ´ĞµĞ½ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼ Ñ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¼Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸.
    """
    loader = _get_module_loader_sync()
    if not loader:
        raise typer.Exit(code=1)
    
    module_info = loader.get_module_info(module_name)
    if not module_info:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.[/]")
        raise typer.Exit(code=1)
    
    manifest_path = module_info.path / "manifest.yaml"
    if not manifest_path.exists():
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ¤Ğ°Ğ¹Ğ» manifest.yaml Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ '{module_name}'.[/]")
        console.print(f"  ĞŸÑƒÑ‚ÑŒ: {manifest_path}")
        raise typer.Exit(code=1)
    
    try:
        import yaml
        
        # Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚
        manifest_data = yaml.safe_load(manifest_path.read_text(encoding="utf-8")) or {}
        
        # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ metadata, ĞµÑĞ»Ğ¸ ĞµĞ³Ğ¾ Ğ½ĞµÑ‚
        if "metadata" not in manifest_data:
            manifest_data["metadata"] = {}
        
        # ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¾Ğ±Ğ° Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ°: Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğµ Ğ¸Ğ¼Ñ Ğ¸ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ Ğ°Ğ»Ğ¸Ğ°Ñ
        current_value = manifest_data["metadata"].get("public_access") or manifest_data["metadata"].get("assign_default_access_to_user_role", False)
        
        # Ğ•ÑĞ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼
        if show or public is None:
            status = "âœ… Ğ’Ğ¸Ğ´Ğ¸Ğ¼ Ğ²ÑĞµĞ¼" if current_value else "ğŸ”’ Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸"
            console.print(f"\n[bold cyan]ĞœĞ¾Ğ´ÑƒĞ»ÑŒ:[/] {module_name}")
            console.print(f"[bold cyan]Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ:[/] {status}")
            console.print(f"[bold cyan]public_access:[/] {current_value}")
            console.print(f"[dim](Ğ¸Ğ»Ğ¸ assign_default_access_to_user_role Ğ² ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚Ğ°Ñ…)[/]")
            console.print(f"\n[dim]Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ --public Ğ¸Ğ»Ğ¸ --private Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ[/]")
            return
        
        # Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ Ğ°Ğ»Ğ¸Ğ°Ñ Ğ´Ğ»Ñ ÑƒĞ´Ğ¾Ğ±ÑÑ‚Ğ²Ğ°)
        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ€Ğ¾Ğµ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğµ Ğ¸Ğ¼Ñ, ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¾ Ğ±Ñ‹Ğ»Ğ¾
        if "assign_default_access_to_user_role" in manifest_data["metadata"]:
            del manifest_data["metadata"]["assign_default_access_to_user_role"]
        manifest_data["metadata"]["public_access"] = public
        
        # Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾
        manifest_path.write_text(
            yaml.safe_dump(manifest_data, allow_unicode=True, sort_keys=False, default_flow_style=False),
            encoding="utf-8"
        )
        
        if public:
            console.print(f"[green]âœ“[/] ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ñ‚ĞµĞ¿ĞµÑ€ÑŒ [bold green]Ğ²Ğ¸Ğ´Ğ¸Ğ¼ Ğ²ÑĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼[/]")
            console.print("[yellow]âš [/] ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸ Ğ±Ğ¾Ñ‚Ğ°, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²ÑÑ‚ÑƒĞ¿Ğ¸Ğ»Ğ¸ Ğ² ÑĞ¸Ğ»Ñƒ.")
        else:
            console.print(f"[green]âœ“[/] ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' Ñ‚ĞµĞ¿ĞµÑ€ÑŒ [bold yellow]Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ[/] Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°")
            console.print("[yellow]âš [/] ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸ Ğ±Ğ¾Ñ‚Ğ°, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ²ÑÑ‚ÑƒĞ¿Ğ¸Ğ»Ğ¸ Ğ² ÑĞ¸Ğ»Ñƒ.")
            
    except ImportError:
        console.print("[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ 'yaml'. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ: pip install pyyaml[/]")
        raise typer.Exit(code=1)
    except Exception as e:
        console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ: {e}[/]")
        console.print_exception(show_locals=False)
        raise typer.Exit(code=1)


@module_app.command(name="sync-deps", help="Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Python-Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹.")
def sync_deps_cmd(
    output_file: Optional[str] = typer.Option(
        None, "--output", "-o", help="Ğ¤Ğ°Ğ¹Ğ» Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹"
    ),
    format: str = typer.Option(
        "requirements", "--format", "-f", help="Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: requirements, pip-tools"
    ),
):
    try:
        asyncio.run(_sync_deps_async(output_file, format))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(
            f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ 'module sync-deps': {e}[/]"
        )
        raise typer.Exit(code=1)


async def _sync_deps_async(output_file: Optional[str], format: str):
    """Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"""
    console.print(
        Panel(
            "[bold blue]Ğ¡Ğ˜ĞĞ¥Ğ ĞĞĞ˜Ğ—ĞĞ¦Ğ˜Ğ¯ Ğ—ĞĞ’Ğ˜Ğ¡Ğ˜ĞœĞĞ¡Ğ¢Ğ•Ğ™ ĞœĞĞ”Ğ£Ğ›Ğ•Ğ™[/]",
            expand=False,
            border_style="blue",
        )
    )

    loader = await _get_module_loader_instance_async()
    if not loader:
        raise typer.Exit(code=1)

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ²ÑĞµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸
    active_modules = [m for m in loader.get_all_modules_info() if m.is_enabled]

    if not active_modules:
        console.print("[yellow]ĞĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹.[/]")
        return

    console.print(
        f"[cyan]ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ´Ğ»Ñ {len(active_modules)} Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹...[/]"
    )

    # Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ²ÑĞµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
    all_dependencies = set()
    module_deps = {}

    for module in active_modules:
        python_deps = []
        sdb_deps = []

        if module.manifest:
            # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Python Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
            if (
                hasattr(module.manifest, "python_requirements")
                and module.manifest.python_requirements
            ):
                python_deps = module.manifest.python_requirements
            elif (
                hasattr(module.manifest, "dependencies")
                and module.manifest.dependencies
            ):
                python_deps = module.manifest.dependencies

            # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ SDB Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
            if (
                hasattr(module.manifest, "sdb_module_dependencies")
                and module.manifest.sdb_module_dependencies
            ):
                sdb_deps = module.manifest.sdb_module_dependencies

            # ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ÑĞµĞ¼ Ğ²ÑĞµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
            all_module_deps = python_deps + sdb_deps

            if all_module_deps:
                all_dependencies.update(all_module_deps)
                module_deps[module.name] = all_module_deps
                console.print(f"  ğŸ“¦ {module.name}: {', '.join(all_module_deps)}")
            else:
                console.print(f"  ğŸ“¦ {module.name}: Ğ½ĞµÑ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹")
        else:
            console.print(f"  ğŸ“¦ {module.name}: Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½")

    if not all_dependencies:
        console.print("[yellow]ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ² Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ….[/]")
        return

    # Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    if format == "requirements":
        result = "\n".join(sorted(all_dependencies))
    elif format == "pip-tools":
        result = "# requirements.txt Ğ´Ğ»Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹\n"
        result += "\n".join(sorted(all_dependencies))
    else:
        console.print(f"[bold red]ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚: {format}[/]")
        raise typer.Exit(code=1)

    # Ğ’Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ğ¼ Ğ¸Ğ»Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    if output_file:
        try:
            with open(output_file, "w", encoding="utf-8") as f:
                f.write(result)
            console.print(f"[green]Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ² Ñ„Ğ°Ğ¹Ğ»: {output_file}[/]")
        except Exception as e:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğ¸ Ğ² Ñ„Ğ°Ğ¹Ğ»: {e}[/]")
            raise typer.Exit(code=1)
    else:
        console.print(f"\n[bold green]Ğ¡Ğ¾Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸:[/]")
        console.print(result)

    console.print(f"\n[cyan]Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:[/]")
    console.print(f"  ğŸ“¦ ĞœĞ¾Ğ´ÑƒĞ»ĞµĞ¹ Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑĞ¼Ğ¸: {len(module_deps)}")
    console.print(f"  ğŸ“‹ Ğ’ÑĞµĞ³Ğ¾ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹: {len(all_dependencies)}")


if __name__ == "__main__":
    module_app()



======================================================================

------------------------------ FILE: Systems/cli/bot.py ------------------------------
# cli_commands/bot_cmd.py
import asyncio
from pathlib import Path

import typer
from aiogram import Bot
from aiogram.types import BotCommand
from loguru import logger
from rich.console import Console
from rich.panel import Panel
from rich.table import Table

from Systems.core.module_loader import ModuleLoader
from Systems.core.services_provider import BotServicesProvider

from .utils import get_sdb_services_for_cli

console = Console()
bot_app = typer.Typer(
    name="bot", help="ğŸ¤– Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸ Telegram-Ğ±Ğ¾Ñ‚Ğ°.", rich_markup_mode="rich"
)


@bot_app.command(
    name="delete-commands", help="Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¸Ğ· Ğ¼ĞµĞ½Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Telegram."
)
def delete_commands():
    """Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ Ğ²ÑĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¸Ğ· Ğ¼ĞµĞ½Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Telegram."""

    async def _delete_commands_async():
        settings_obj, _, _ = await get_sdb_services_for_cli(
            init_db=False, init_rbac=False
        )
        if not settings_obj:
            console.print("[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ±Ğ¾Ñ‚Ğ°.[/]")
            logger.error("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ delete-commands")
            raise typer.Exit(code=1)

        try:
            bot_token = settings_obj.telegram.token
            # <-- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ½Ğ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
            if not bot_token:
                console.print(
                    "[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ¢Ğ¾ĞºĞµĞ½ Ğ±Ğ¾Ñ‚Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ.[/bold red]"
                )
                console.print("ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ Ñ‚Ğ¾ĞºĞµĞ½ Ğ² .env Ñ„Ğ°Ğ¹Ğ»Ğµ.")
                raise typer.Exit(code=1)

            bot = Bot(token=bot_token)
            await bot.delete_my_commands()
            await bot.session.close()
            console.print(
                Panel(
                    "[bold green]Ğ’ÑĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ Ğ¸Ğ· Ğ¼ĞµĞ½Ñ Telegram![/]",
                    expand=False,
                    border_style="green",
                )
            )
            logger.success("Ğ’ÑĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹ Ğ¸Ğ· Ğ¼ĞµĞ½Ñ Telegram")
        except AttributeError as e:
            console.print(
                f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº CoreAppSettings: {e}[/]"
            )
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº CoreAppSettings: {e}")
            raise typer.Exit(code=1)
        except Exception as e:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´: {e}[/]")
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´: {e}")
            raise typer.Exit(code=1)

    try:
        asyncio.run(_delete_commands_async())
    except (
        typer.Exit
    ):  # <-- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•: ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ typer.Exit, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ»Ğ¸ÑˆĞ½Ğ¸Ğ¹ traceback
        pass
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: {e}[/]")
        logger.error(f"ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² delete-commands: {e}")
        raise typer.Exit(code=1)


@bot_app.command(
    name="set-commands",
    help="Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ² Ğ¼ĞµĞ½Ñ Telegram Ğ¸Ğ· Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº.",
)
def set_commands():
    """Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ² Ğ¼ĞµĞ½Ñ Telegram."""

    async def _set_commands_async():
        settings_obj, _, _ = await get_sdb_services_for_cli(
            init_db=False, init_rbac=False
        )
        if not settings_obj:
            console.print("[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ±Ğ¾Ñ‚Ğ°.[/]")
            logger.error("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ set-commands")
            raise typer.Exit(code=1)

        try:
            bot_token = settings_obj.telegram.token
            # <-- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ½Ğ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
            if not bot_token:
                console.print(
                    "[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ¢Ğ¾ĞºĞµĞ½ Ğ±Ğ¾Ñ‚Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ.[/bold red]"
                )
                console.print("ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ Ñ‚Ğ¾ĞºĞµĞ½ Ğ² .env Ñ„Ğ°Ğ¹Ğ»Ğµ.")
                raise typer.Exit(code=1)

            # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ ModuleLoader
            temp_bsp = BotServicesProvider(settings=settings_obj)
            loader = ModuleLoader(settings=settings_obj, services_provider=temp_bsp)
            loader.scan_all_available_modules()
            if hasattr(loader, "_load_enabled_plugin_names"):
                loader._load_enabled_plugin_names()

            # Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¸Ğ· Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
            commands = []
            for module_info in loader.available_modules.values():
                if (
                    module_info.manifest
                    and module_info.name in loader.enabled_plugin_names
                ):
                    for cmd in module_info.manifest.commands or []:
                        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ñ‡Ñ‚Ğ¾ cmd - ÑÑ‚Ğ¾ ÑĞ»Ğ¾Ğ²Ğ°Ñ€ÑŒ
                        if (
                            isinstance(cmd, dict)
                            and cmd.get("command")
                            and cmd.get("description")
                        ):
                            commands.append(
                                BotCommand(
                                    command=cmd["command"].lstrip("/"),
                                    description=cmd["description"],
                                )
                            )

            # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¸Ğ· bot_commands.yaml (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)
            core_commands_path = (
                settings_obj.core.project_data_path / "Config" / "bot_commands.yaml"
            )
            if core_commands_path.exists():
                import yaml

                with core_commands_path.open("r", encoding="utf-8") as f:
                    core_commands = yaml.safe_load(f) or []
                for cmd in core_commands:
                    if (
                        isinstance(cmd, dict)
                        and cmd.get("command")
                        and cmd.get("description")
                    ):
                        commands.append(
                            BotCommand(
                                command=cmd["command"].lstrip("/"),
                                description=cmd["description"],
                            )
                        )

            if not commands:
                console.print("[yellow]ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ´Ğ»Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸.[/]")
                logger.warning("ĞĞµÑ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ´Ğ»Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ğ² Ğ¼ĞµĞ½Ñ Telegram")
                return

            # Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
            bot = Bot(token=bot_token)
            await bot.set_my_commands(commands)
            await bot.session.close()

            # Ğ’Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ğ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
            table = Table(
                title="[bold cyan]Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹[/]",
                show_header=True,
                header_style="bold magenta",
            )
            table.add_column("ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°", style="cyan")
            table.add_column("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ", style="green")
            for cmd in commands:
                table.add_row(f"/{cmd.command}", cmd.description)
            console.print(table)
            console.print(
                Panel(
                    "[bold green]ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ² Ğ¼ĞµĞ½Ñ Telegram![/]",
                    expand=False,
                    border_style="green",
                )
            )
            logger.success(f"Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ {len(commands)} ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ² Ğ¼ĞµĞ½Ñ Telegram")
        except AttributeError as e:
            console.print(
                f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº CoreAppSettings: {e}[/]"
            )
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº CoreAppSettings: {e}")
            raise typer.Exit(code=1)
        except Exception as e:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´: {e}[/]")
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´: {e}")
            raise typer.Exit(code=1)

    try:
        asyncio.run(_set_commands_async())
    except typer.Exit:  # <-- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•: ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ typer.Exit
        pass
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: {e}[/]")
        logger.error(f"ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² set-commands: {e}")
        raise typer.Exit(code=1)


@bot_app.command(name="status", help="ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ¾Ñ‚Ğ°.")
def status():
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ»Ğ¸ Ğ±Ğ¾Ñ‚."""

    async def _status_async():
        settings_obj, _, _ = await get_sdb_services_for_cli(
            init_db=False, init_rbac=False
        )
        if not settings_obj:
            console.print("[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ±Ğ¾Ñ‚Ğ°.[/]")
            logger.error("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ status")
            raise typer.Exit(code=1)

        try:
            bot_token = settings_obj.telegram.token
            # <-- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ½Ğ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
            if not bot_token:
                console.print(
                    "[bold yellow]ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ°: Ñ‚Ğ¾ĞºĞµĞ½ Ğ±Ğ¾Ñ‚Ğ° Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½.[/bold yellow]"
                )
                console.print(
                    "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ Ñ‚Ğ¾ĞºĞµĞ½ Ğ² .env Ñ„Ğ°Ğ¹Ğ»Ğµ Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºÑƒ."
                )
                raise typer.Exit()  # Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ°ĞµĞ¼ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ Ğ±ĞµĞ· Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸

            bot = Bot(token=bot_token)
            bot_info = await bot.get_me()
            await bot.session.close()
            console.print(
                Panel(
                    f"[bold green]Ğ‘Ğ¾Ñ‚ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½! ID: {bot_info.id}, Ğ˜Ğ¼Ñ: @{bot_info.username}[/]",
                    expand=False,
                    border_style="green",
                )
            )
            logger.success(f"Ğ‘Ğ¾Ñ‚ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½: @{bot_info.username}")
        except AttributeError as e:
            console.print(
                f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº CoreAppSettings: {e}[/]"
            )
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº CoreAppSettings: {e}")
            raise typer.Exit(code=1)
        except Exception as e:
            console.print(f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°: {e}[/]")
            logger.error(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°: {e}")
            raise typer.Exit(code=1)

    try:
        asyncio.run(_status_async())
    except typer.Exit:  # <-- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•: ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ typer.Exit
        pass
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: {e}[/]")
        logger.error(f"ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ² status: {e}")
        raise typer.Exit(code=1)


if __name__ == "__main__":
    bot_app()



======================================================================

------------------------------ FILE: Systems/cli/user.py ------------------------------
# cli_commands/user_cmd.py

import asyncio
from typing import Any, List, Optional, Tuple

import typer
from rich.console import Console
from rich.panel import Panel
from rich.table import Table
from rich.text import Text  # Ğ”Ğ»Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ğ³Ğ¸Ğ±ĞºĞ¾Ğ³Ğ¾ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚Ğ°

from .utils import get_sdb_services_for_cli  # ĞĞ°ÑˆĞ° ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ°

console = Console()
user_app = typer.Typer(
    name="user",
    help="ğŸ‘¤ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸ SDB Ğ¸ Ğ¸Ñ… Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸ (RBAC).",
    rich_markup_mode="rich",
)

# --- ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ ---


async def _list_users_cmd_async(limit: int, offset: int, sort_by: str, sort_desc: bool):
    panel_title = "[bold blue]Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ SwiftDevBot[/]"
    db_m = None
    try:
        # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ‘Ğ”, Ğ±ĞµĞ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
        from .utils import get_db_only_for_cli

        db_m = await get_db_only_for_cli()

        async with db_m.get_session() as session:
            from sqlalchemy import asc, desc
            from sqlalchemy import func as sql_func
            from sqlalchemy import select
            from sqlalchemy.orm import selectinload

            from Systems.core.database.core_models import User

            count_stmt = select(sql_func.count(User.id))
            total_users_result = await session.execute(count_stmt)
            total_users = total_users_result.scalar_one_or_none() or 0

            if total_users == 0:
                console.print(
                    Panel(
                        "[yellow]Ğ’ Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½ĞµÑ‚ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.[/yellow]",
                        title=panel_title,
                    )
                )
                return

            # Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸
            order_column = getattr(
                User, sort_by, User.id
            )  # Ğ”ĞµÑ„Ğ¾Ğ»Ñ‚ Ğ¿Ğ¾ id, ĞµÑĞ»Ğ¸ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½
            order_expression = desc(order_column) if sort_desc else asc(order_column)

            stmt = (
                select(User)
                .options(selectinload(User.roles))
                .order_by(order_expression)
                .limit(limit)
                .offset(offset)
            )
            result = await session.execute(stmt)
            users: List[User] = list(result.scalars().all())

            if (
                not users and total_users > 0
            ):  # Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸, Ğ½Ğ¾ Ğ½Ğµ Ğ½Ğ° ÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ
                console.print(
                    Panel(
                        f"[yellow]ĞĞ° ÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ (ÑĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ {offset}, Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ {limit}) Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ½ĞµÑ‚, Ğ½Ğ¾ Ğ²ÑĞµĞ³Ğ¾ Ğ² Ğ‘Ğ”: {total_users}.[/yellow]",
                        title=panel_title,
                    )
                )
                return
            elif not users:  # Ğ­Ñ‚Ğ¾ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğµ ÑƒĞ¶Ğµ Ğ¿Ğ¾ĞºÑ€Ñ‹Ñ‚Ğ¾ Ğ²Ñ‹ÑˆĞµ, Ğ½Ğ¾ Ğ´Ğ»Ñ ÑÑĞ½Ğ¾ÑÑ‚Ğ¸
                console.print(
                    Panel(
                        "[yellow]Ğ’ Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½ĞµÑ‚ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.[/yellow]",
                        title=panel_title,
                    )
                )
                return

            table_title = f"ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ SDB (ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¾: {len(users)} Ğ¸Ğ· {total_users}, Ğ›Ğ¸Ğ¼Ğ¸Ñ‚: {limit}, Ğ¡Ğ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ: {offset}, Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°: {sort_by} {'DESC' if sort_desc else 'ASC'})"
            table = Table(
                title=table_title,
                show_header=True,
                header_style="bold magenta",
                expand=True,
            )
            table.add_column("DB ID", style="dim cyan", justify="right", no_wrap=True)
            table.add_column("TG ID", style="cyan", justify="right", no_wrap=True)
            table.add_column("ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ğ˜Ğ¼Ñ", min_width=20)
            table.add_column("Username", style="yellow", no_wrap=True)
            table.add_column("Ğ Ğ¾Ğ»Ğ¸", min_width=15)
            table.add_column("Ğ¯Ğ·Ñ‹Ğº", justify="center", no_wrap=True)
            table.add_column("ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½", justify="center", no_wrap=True)
            table.add_column("Ğ‘Ğ¾Ñ‚ Ğ±Ğ»Ğ¾Ğº.", justify="center", no_wrap=True)
            table.add_column("Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ", no_wrap=True)
            table.add_column("ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ", no_wrap=True)

            for user_obj in users:
                roles_str = (
                    ", ".join(sorted([role.name for role in user_obj.roles]))
                    if user_obj.roles
                    else "-"
                )
                active_str = "âœ…" if user_obj.is_active else "âŒ"
                blocked_str = "ğŸš«" if user_obj.is_bot_blocked else "âœ…"
                created_at_str = (
                    user_obj.created_at.strftime("%Y-%m-%d %H:%M")
                    if user_obj.created_at
                    else "-"
                )
                last_activity_str = (
                    user_obj.last_activity_at.strftime("%Y-%m-%d %H:%M")
                    if user_obj.last_activity_at
                    else "-"
                )

                table.add_row(
                    str(user_obj.id),
                    str(user_obj.telegram_id),
                    user_obj.full_name,
                    f"@{user_obj.username}" if user_obj.username else "-",
                    roles_str,
                    user_obj.preferred_language_code or "-",
                    active_str,
                    blocked_str,
                    created_at_str,
                    last_activity_str,
                )
            console.print(
                Panel(table, title=panel_title, border_style="blue", padding=(1, 1))
            )
    except Exception as e:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ 'user list': {type(e).__name__} - {e}[/]"
        )
        raise
    finally:
        if db_m:
            await db_m.dispose()


async def _find_user_interactive(
    session: Any, identifier: str
) -> Optional[Any]:  # User
    """Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ğ¾ ID Ğ¸Ğ»Ğ¸ username."""
    from sqlalchemy import select
    from sqlalchemy.orm import selectinload

    from Systems.core.database.core_models import User

    user: Optional[User] = None
    if identifier.isdigit():
        user_id_int = int(identifier)
        stmt = (
            select(User)
            .options(selectinload(User.roles))
            .where(User.telegram_id == user_id_int)
        )
        result = await session.execute(stmt)
        user = result.scalars().first()
        if user:
            return user
        # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°ÑˆĞ»Ğ¸ Ğ¿Ğ¾ TG ID, Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ¿Ğ¾ DB ID
        stmt_db_id = (
            select(User).options(selectinload(User.roles)).where(User.id == user_id_int)
        )
        result_db_id = await session.execute(stmt_db_id)
        user = result_db_id.scalars().first()
        if user:
            return user

    # Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾ Ğ¸Ğ»Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ¿Ğ¾ ID, Ğ¸Ñ‰ĞµĞ¼ Ğ¿Ğ¾ username (Ğ±ĞµĞ· @)
    username_to_search = identifier.lstrip("@")
    stmt_uname = (
        select(User)
        .options(selectinload(User.roles))
        .where(User.username_lower == username_to_search.lower())
    )
    # ĞŸÑ€ĞµĞ´Ğ¿Ğ¾Ğ»Ğ°Ğ³Ğ°Ñ, Ñ‡Ñ‚Ğ¾ Ñƒ Ñ‚ĞµĞ±Ñ ĞµÑÑ‚ÑŒ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ° username_lower Ğ¸Ğ»Ğ¸ Ñ‚Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑˆÑŒ ILIKE Ğ´Ğ»Ñ PostgreSQL/Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ‘Ğ”
    # Ğ”Ğ»Ñ SQLite ÑÑ‚Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ WHERE lower(username) = lower(:username_to_search)
    # Ğ§Ñ‚Ğ¾Ğ±Ñ‹ ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»Ğ¾ ĞºÑ€Ğ¾ÑÑ-Ğ¡Ğ£Ğ‘Ğ” Ğ±ĞµĞ· ILIKE, Ğ»ÑƒÑ‡ÑˆĞµ Ğ¸Ğ¼ĞµÑ‚ÑŒ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ username_lower Ğ¸Ğ»Ğ¸ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ lower() Ğ² Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ
    # stmt_uname = select(User).options(selectinload(User.roles)).where(func.lower(User.username) == username_to_search.lower())
    result_uname = await session.execute(stmt_uname)
    user = result_uname.scalars().first()
    return user


async def _info_user_cmd_async(user_identifier: str):
    db_m = None
    try:
        # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ‘Ğ”, Ğ±ĞµĞ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
        from .utils import get_db_only_for_cli

        db_m = await get_db_only_for_cli()

        async with db_m.get_session() as session:
            user = await _find_user_interactive(session, user_identifier)

            if not user:
                console.print(
                    f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ '{user_identifier}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….[/]"
                )
                raise typer.Exit(code=1)

            panel_title = f"[bold blue]Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ: {user.full_name} (TG ID: {user.telegram_id})[/]"
            info_text = Text()
            info_text.append(f"DB ID: {user.id}\n", style="bold")
            info_text.append(f"Telegram ID: {user.telegram_id}\n", style="bold")
            info_text.append(f"ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ğ¸Ğ¼Ñ: {user.full_name}\n")
            info_text.append(
                f"Username: @{user.username}\n" if user.username else "Username: -\n"
            )
            info_text.append(
                f"Ğ¯Ğ·Ñ‹Ğº Ğ±Ğ¾Ñ‚Ğ°: {user.preferred_language_code or '(Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½)'}\n"
            )
            info_text.append(
                f"ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ: {'Ğ”Ğ° âœ…' if user.is_active else 'ĞĞµÑ‚ âŒ'}\n"
            )
            info_text.append(
                f"Ğ‘Ğ¾Ñ‚ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½: {'Ğ”Ğ° ğŸš«' if user.is_bot_blocked else 'ĞĞµÑ‚ âœ…'}\n"
            )
            created_at_str = (
                user.created_at.strftime("%Y-%m-%d %H:%M:%S %Z")
                if user.created_at and user.created_at.tzinfo
                else (
                    user.created_at.strftime("%Y-%m-%d %H:%M:%S")
                    if user.created_at
                    else "-"
                )
            )
            updated_at_str = (
                user.updated_at.strftime("%Y-%m-%d %H:%M:%S %Z")
                if user.updated_at and user.updated_at.tzinfo
                else (
                    user.updated_at.strftime("%Y-%m-%d %H:%M:%S")
                    if user.updated_at
                    else "-"
                )
            )
            last_activity_str = (
                user.last_activity_at.strftime("%Y-%m-%d %H:%M:%S %Z")
                if user.last_activity_at and user.last_activity_at.tzinfo
                else (
                    user.last_activity_at.strftime("%Y-%m-%d %H:%M:%S")
                    if user.last_activity_at
                    else " (Ğ½ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)"
                )
            )
            info_text.append(f"Ğ”Ğ°Ñ‚Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸: {created_at_str}\n")
            info_text.append(f"ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: {updated_at_str}\n")
            info_text.append(f"ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ: {last_activity_str}\n")
            roles_str = (
                ", ".join(sorted([role.name for role in user.roles]))
                if user.roles
                else " (Ğ½ĞµÑ‚ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ‹Ñ… Ñ€Ğ¾Ğ»ĞµĞ¹)"
            )
            info_text.append(f"Ğ Ğ¾Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ: {roles_str}\n", style="bold")

            console.print(
                Panel(info_text, title=panel_title, border_style="blue", padding=1)
            )
    finally:
        if db_m:
            await db_m.dispose()


async def _list_roles_cmd_async():
    panel_title = "[bold blue]Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ SDB[/]"
    db_m, rbac_s = None, None
    try:
        # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ‘Ğ”, Ğ±ĞµĞ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
        from .utils import get_db_only_for_cli

        db_m = await get_db_only_for_cli()

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ RBACService Ñ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸
        from Systems.core.rbac.service import RBACService

        rbac_s = RBACService(services=None, db_manager=db_m)

        async with db_m.get_session() as session:
            from Systems.core.database.core_models import \
                Role  # Role ÑƒĞ¶Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ² RBACService

            all_roles: List[Role] = await rbac_s.get_all_roles(session)

            if not all_roles:
                console.print(
                    Panel(
                        "[yellow]Ğ’ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ Ğ½ĞµÑ‚ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ½Ñ‹Ñ… Ñ€Ğ¾Ğ»ĞµĞ¹.[/yellow]",
                        title=panel_title,
                    )
                )
                return

            table = Table(
                title="Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ñ€Ğ¾Ğ»Ğ¸ SDB",
                show_header=True,
                header_style="bold magenta",
                expand=True,
            )
            table.add_column("DB ID", style="dim cyan", justify="right", no_wrap=True)
            table.add_column("Ğ˜Ğ¼Ñ Ğ Ğ¾Ğ»Ğ¸", style="cyan", min_width=15)
            table.add_column("ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ", min_width=30, max_width=70, overflow="fold")

            for role_obj in all_roles:
                table.add_row(
                    str(role_obj.id),
                    role_obj.name,
                    role_obj.description if role_obj.description else "-",
                )
            console.print(
                Panel(table, title=panel_title, border_style="blue", padding=(1, 1))
            )
    finally:
        if db_m:
            await db_m.dispose()


async def _assign_role_cmd_async(user_identifier: str, role_name: str):
    console.print(
        f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ [cyan]'{role_name}'[/] Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ [cyan]'{user_identifier}'[/]..."
    )
    db_m, rbac_s = None, None
    try:
        # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ‘Ğ”, Ğ±ĞµĞ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
        from .utils import get_db_only_for_cli

        db_m = await get_db_only_for_cli()

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ RBACService Ñ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸
        from Systems.core.rbac.service import RBACService

        rbac_s = RBACService(services=None, db_manager=db_m)

        async with db_m.get_session() as session:
            user_obj = await _find_user_interactive(session, user_identifier)
            if not user_obj:
                console.print(
                    f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ '{user_identifier}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.[/]"
                )
                raise typer.Exit(code=1)

            if await rbac_s.assign_role_to_user(session, user_obj, role_name):
                await session.commit()
                console.print(
                    f"[bold green]Ğ Ğ¾Ğ»ÑŒ '{role_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_obj.telegram_id} (@{user_obj.username}).[/]"
                )
            else:
                # RBACService Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ğ» Ğ·Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸
                console.print(
                    f"[bold red]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ '{role_name}' Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_obj.telegram_id}. "
                    "Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ñ€Ğ¾Ğ»ÑŒ Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¸Ğ»Ğ¸ ÑƒĞ¶Ğµ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ° (ÑĞ¼. Ğ»Ğ¾Ğ³Ğ¸).[/]"
                )
                # ĞĞµ Ğ±ÑƒĞ´ĞµĞ¼ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ rollback Ğ·Ğ´ĞµÑÑŒ, Ñ‚Ğ°Ğº ĞºĞ°Ğº assign_role_to_user Ğ¼Ğ¾Ğ³ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ Ğ² ÑĞµÑÑĞ¸Ñ, Ğ½Ğ¾ Ğ½Ğµ UserRole
                raise typer.Exit(code=1)
    finally:
        if db_m:
            await db_m.dispose()


async def _remove_role_cmd_async(user_identifier: str, role_name: str):
    console.print(
        f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑĞ½ÑÑ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ [cyan]'{role_name}'[/] Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ [cyan]'{user_identifier}'[/]..."
    )
    db_m, rbac_s = None, None
    try:
        # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ‘Ğ”, Ğ±ĞµĞ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
        from .utils import get_db_only_for_cli

        db_m = await get_db_only_for_cli()

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ RBACService Ñ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸
        from Systems.core.rbac.service import RBACService

        rbac_s = RBACService(services=None, db_manager=db_m)

        async with db_m.get_session() as session:
            user_obj = await _find_user_interactive(session, user_identifier)
            if not user_obj:
                console.print(
                    f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ '{user_identifier}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.[/]"
                )
                raise typer.Exit(code=1)

            if await rbac_s.remove_role_from_user(session, user_obj, role_name):
                await session.commit()
                console.print(
                    f"[bold green]Ğ Ğ¾Ğ»ÑŒ '{role_name}' ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ½ÑÑ‚Ğ° Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_obj.telegram_id} (@{user_obj.username}).[/]"
                )
            else:
                console.print(
                    f"[bold red]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ½ÑÑ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ '{role_name}' Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_obj.telegram_id}. "
                    "Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ñ€Ğ¾Ğ»ÑŒ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ° Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ° (ÑĞ¼. Ğ»Ğ¾Ğ³Ğ¸).[/]"
                )
                raise typer.Exit(code=1)
    finally:
        if db_m:
            await db_m.dispose()


async def _block_user_cmd_async(user_identifier: str, reason: str):
    console.print(f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ [cyan]'{user_identifier}'[/]...")
    if reason:
        console.print(f"ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸: [yellow]{reason}[/]")

    db_m, core_settings = None, None
    try:
        # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ‘Ğ” + Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ core Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ super_admins
        from .utils import get_db_with_core_config_for_cli

        db_m, core_settings = await get_db_with_core_config_for_cli()

        async with db_m.get_session() as session:
            user_obj = await _find_user_interactive(session, user_identifier)
            if not user_obj:
                console.print(
                    f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ '{user_identifier}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.[/]"
                )
                raise typer.Exit(code=1)

            if user_obj.telegram_id in core_settings.super_admins:
                console.print(
                    f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµĞ»ÑŒĞ·Ñ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹![/]"
                )
                raise typer.Exit(code=1)

            if user_obj.is_bot_blocked:
                console.print(
                    f"[bold yellow]ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_obj.telegram_id} ÑƒĞ¶Ğµ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.[/]"
                )
                return

            from Systems.core.users.service import UserService

            user_service = UserService(
                services_provider=None
            )  # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ±ĞµĞ· services_provider Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ñ‹

            if await user_service.set_user_bot_blocked_status(user_obj, True, session):
                await session.commit()
                console.print(
                    f"[bold green]ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_obj.telegram_id} (@{user_obj.username or 'Ğ±ĞµĞ· username'}) ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.[/]"
                )
                if reason:
                    console.print(f"ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: [yellow]{reason}[/]")
            else:
                console.print(
                    f"[bold red]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_obj.telegram_id}.[/]"
                )
                raise typer.Exit(code=1)
    finally:
        if db_m:
            await db_m.dispose()


async def _unblock_user_cmd_async(user_identifier: str):
    console.print(
        f"ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ [cyan]'{user_identifier}'[/]..."
    )
    db_m = None
    try:
        # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ‘Ğ”, Ğ±ĞµĞ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
        from .utils import get_db_only_for_cli

        db_m = await get_db_only_for_cli()

        async with db_m.get_session() as session:
            user_obj = await _find_user_interactive(session, user_identifier)
            if not user_obj:
                console.print(
                    f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ '{user_identifier}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.[/]"
                )
                raise typer.Exit(code=1)

            if not user_obj.is_bot_blocked:
                console.print(
                    f"[bold yellow]ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_obj.telegram_id} Ğ½Ğµ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.[/]"
                )
                return

            from Systems.core.users.service import UserService

            user_service = UserService(
                services_provider=None
            )  # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ±ĞµĞ· services_provider Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ñ‹

            if await user_service.set_user_bot_blocked_status(user_obj, False, session):
                await session.commit()
                console.print(
                    f"[bold green]ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {user_obj.telegram_id} (@{user_obj.username or 'Ğ±ĞµĞ· username'}) ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.[/]"
                )
            else:
                console.print(
                    f"[bold red]ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ {user_obj.telegram_id}.[/]"
                )
                raise typer.Exit(code=1)
    finally:
        if db_m:
            await db_m.dispose()


# --- Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ¾Ğ±ĞµÑ€Ñ‚ĞºĞ¸ Ğ´Ğ»Ñ Typer ---


@user_app.command(
    name="list", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ SDB Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…."
)
def list_users_cmd_wrapper(
    limit: int = typer.Option(
        20,
        "--limit",
        "-l",
        help="ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ.",
        min=1,
        max=200,
    ),
    offset: int = typer.Option(
        0, "--offset", "-o", help="Ğ¡Ğ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.", min=0
    ),
    sort_by: str = typer.Option(
        "id",
        "--sort-by",
        help="ĞŸĞ¾Ğ»Ğµ Ğ´Ğ»Ñ ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ (id, telegram_id, username, first_name, last_name, created_at, last_activity_at).",
        case_sensitive=False,
    ),
    desc: bool = typer.Option(False, "--desc", help="Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ ÑƒĞ±Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ."),
):
    valid_sort_fields = [
        "id",
        "telegram_id",
        "username",
        "first_name",
        "last_name",
        "created_at",
        "last_activity_at",
    ]
    if sort_by.lower() not in valid_sort_fields:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ°: ĞĞµĞ´Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ --sort-by: '{sort_by}'.[/]"
        )
        console.print(f"Ğ”Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼Ñ‹Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ: {', '.join(valid_sort_fields)}")
        raise typer.Exit(code=1)
    try:
        asyncio.run(
            _list_users_cmd_async(
                limit=limit, offset=offset, sort_by=sort_by.lower(), sort_desc=desc
            )
        )
    except Exception as e:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ 'user list': {type(e).__name__} - {e}[/]"
        )
        # console.print_exception(show_locals=True) # Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸
        raise typer.Exit(code=1)


@user_app.command(
    name="info",
    help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ Ğ¿Ğ¾ ĞµĞ³Ğ¾ Telegram ID, DB ID Ğ¸Ğ»Ğ¸ Username.",
)
def info_user_cmd_wrapper(
    user_identifier: str = typer.Argument(
        ..., help="Telegram ID, DB ID Ğ¸Ğ»Ğ¸ Username (@Ğ½Ğ¸Ğº) Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ."
    )
):
    try:
        asyncio.run(_info_user_cmd_async(user_identifier=user_identifier))
    except typer.Exit:  # ĞŸÑ€Ğ¾Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼ Exit, ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½
        raise
    except Exception as e:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ 'user info': {type(e).__name__} - {e}[/]"
        )
        raise typer.Exit(code=1)


@user_app.command(name="roles", help="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ.")
def list_roles_cmd_wrapper():
    try:
        asyncio.run(_list_roles_cmd_async())
    except Exception as e:
        console.print(
            f"[bold red]ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ 'user roles': {type(e).__name__} - {e}[/]"
        )
        raise typer.Exit(code=1)


@user_app.command(name="assign-role", help="ĞĞ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.")
def assign_role_cmd_wrapper(
    user_identifier: str = typer.Argument(
        ..., help="Telegram ID, DB ID Ğ¸Ğ»Ğ¸ Username (@Ğ½Ğ¸Ğº) Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ."
    ),
    role_name: str = typer.Argument(
        ..., help="Ğ˜Ğ¼Ñ Ñ€Ğ¾Ğ»Ğ¸ Ğ´Ğ»Ñ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 'Admin', 'User')."
    ),
):
    try:
        asyncio.run(
            _assign_role_cmd_async(user_identifier=user_identifier, role_name=role_name)
        )
    except typer.Exit:
        raise
    except Exception as e:
        # Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ ÑƒĞ¶Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ² _assign_role_cmd_async
        raise typer.Exit(code=1)


@user_app.command(name="remove-role", help="Ğ¡Ğ½ÑÑ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.")
@user_app.command(name="block", help="Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ.")
@user_app.command(name="unblock", help="Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ.")
def remove_role_cmd_wrapper(
    user_identifier: str = typer.Argument(
        ..., help="Telegram ID, DB ID Ğ¸Ğ»Ğ¸ Username (@Ğ½Ğ¸Ğº) Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ."
    ),
    role_name: str = typer.Argument(..., help="Ğ˜Ğ¼Ñ Ñ€Ğ¾Ğ»Ğ¸ Ğ´Ğ»Ñ ÑĞ½ÑÑ‚Ğ¸Ñ."),
):
    try:
        asyncio.run(
            _remove_role_cmd_async(user_identifier=user_identifier, role_name=role_name)
        )
    except typer.Exit:
        raise
    except Exception as e:
        raise typer.Exit(code=1)


@user_app.command(name="block", help="Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ.")
def block_user_cmd_wrapper(
    user_identifier: str = typer.Argument(
        ..., help="Telegram ID, DB ID Ğ¸Ğ»Ğ¸ Username (@Ğ½Ğ¸Ğº) Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ."
    ),
    reason: str = typer.Option(
        "", "--reason", "-r", help="ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)."
    ),
):
    try:
        asyncio.run(
            _block_user_cmd_async(user_identifier=user_identifier, reason=reason)
        )
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: {e}[/bold red]")
        raise typer.Exit(code=1)


@user_app.command(name="unblock", help="Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ.")
def unblock_user_cmd_wrapper(
    user_identifier: str = typer.Argument(
        ..., help="Telegram ID, DB ID Ğ¸Ğ»Ğ¸ Username (@Ğ½Ğ¸Ğº) Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ."
    )
):
    try:
        asyncio.run(_unblock_user_cmd_async(user_identifier=user_identifier))
    except typer.Exit:
        raise
    except Exception as e:
        console.print(f"[bold red]ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: {e}[/bold red]")
        raise typer.Exit(code=1)



======================================================================

------------------------------ FILE: Systems/cli/__init__.py ------------------------------
# cli_commands/__init__.py
# Ğ”ĞµĞ»Ğ°ĞµÑ‚ cli_commands Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ¼



======================================================================

------------------------------ FILE: Systems/migration/script.py.mako ------------------------------
# alembic_migrations/script.py.mako
"""${message}

Revision ID: ${up_revision}
Revises: ${down_revision | comma,n}
Create Date: ${create_date}

"""
from typing import Sequence, Union

from alembic import op # type: ignore
import sqlalchemy as sa
${imports if imports else ""}

# revision identifiers, used by Alembic.
revision: str = ${repr(up_revision)}
down_revision: Union[str, None] = ${repr(down_revision)}
branch_labels: Union[str, Sequence[str], None] = ${repr(branch_labels)}
depends_on: Union[str, Sequence[str], None] = ${repr(depends_on)}


def upgrade() -> None:
    ${upgrades if upgrades else "    pass"}


def downgrade() -> None:
    ${downgrades if downgrades else "    pass"}


======================================================================

------------------------------ FILE: Systems/migration/env.py ------------------------------
# alembic_migrations/env.py

import asyncio
from logging.config import fileConfig
import os
import sys
from pathlib import Path
import importlib
from typing import List, Optional

# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿ÑƒÑ‚ĞµĞ¹ ---
ALEMBIC_DIR = Path(__file__).resolve().parent
SDB_PROJECT_ROOT = ALEMBIC_DIR.parent.parent
SDB_SYSTEMS_PATH = ALEMBIC_DIR.parent

if str(SDB_PROJECT_ROOT) not in sys.path:
    sys.path.insert(0, str(SDB_PROJECT_ROOT))
    print(f"[Alembic Env] ĞšĞ¾Ñ€ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° SDB ({SDB_PROJECT_ROOT}) Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² sys.path.")
else:
    sys.path.remove(str(SDB_PROJECT_ROOT))
    sys.path.insert(0, str(SDB_PROJECT_ROOT))
    print(f"[Alembic Env] ĞšĞ¾Ñ€ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° SDB ({SDB_PROJECT_ROOT}) ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ½Ğ° Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ² sys.path.")

if str(SDB_SYSTEMS_PATH) not in sys.path:
    sys.path.insert(0, str(SDB_SYSTEMS_PATH))
    print(f"[Alembic Env] ĞŸÑƒÑ‚ÑŒ Systems ({SDB_SYSTEMS_PATH}) Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² sys.path.")


from sqlalchemy import pool
from sqlalchemy.engine import Connection
from sqlalchemy.ext.asyncio import create_async_engine, AsyncEngine

from alembic import context # type: ignore

try:
    from Systems.core.app_settings import settings as sdb_settings
    from Systems.core.database.base import SDBBaseModel
    from Systems.core.database.manager import DBManager
    from Systems.core.module_loader import ModuleLoader, ModuleInfo
    from Systems.core.services_provider import BotServicesProvider
    from Systems.core.database import core_models # noqa: F401
    print("[Alembic Env] ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ SDB ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹.")
except ImportError as e_imp:
    print(f"[ALEMBIC ENV ERROR] ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² SDB: {e_imp}")
    print(f"Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ sys.path Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ: {sys.path}")
    sys.exit(1)

target_metadata = SDBBaseModel.metadata

try:
    print("[Alembic Env] ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹...")
    temp_bsp_for_alembic = BotServicesProvider(settings=sdb_settings)
    module_loader_for_alembic = ModuleLoader(
        settings=sdb_settings,
        services_provider=temp_bsp_for_alembic # ĞŸĞµÑ€ĞµĞ´Ğ°ĞµĞ¼ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ BSP
    )
    module_loader_for_alembic.scan_all_available_modules()
    module_loader_for_alembic._load_enabled_plugin_names() # Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ _load_enabled_plugin_names

    # Ğ”Ğ»Ñ Alembic Ğ½Ğ°Ğ¼ Ğ½ÑƒĞ¶Ğ½Ñ‹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ²ÑĞµÑ… ĞĞšĞ¢Ğ˜Ğ’ĞĞ«Ğ¥ ĞŸĞ›ĞĞ“Ğ˜ĞĞĞ’
    active_plugin_module_infos: List[ModuleInfo] = [
        info for name, info in module_loader_for_alembic.available_modules.items()
        # Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ• Ğ—Ğ”Ğ•Ğ¡Ğ¬: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ enabled_plugin_names
        if not info.is_system_module and name in module_loader_for_alembic.enabled_plugin_names and info.manifest and info.path
    ]

    # Ğ¡Ñ‡ĞµÑ‚Ñ‡Ğ¸ĞºĞ¸ Ğ¸ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
    import_errors: List[tuple[str, str, Exception]] = []  # (module_name, import_target, error)
    successful_imports = 0
    failed_imports = 0
    skipped_modules = 0  # ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ±ĞµĞ· models.py/models/
    
    if active_plugin_module_infos:
        print(f"[Alembic Env] ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ {len(active_plugin_module_infos)} Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹.")
        for module_info in active_plugin_module_infos:
            print(f"[Alembic Env] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ°: {module_info.name}")
            module_models_file = module_info.path / "models.py"
            module_models_pkg_init = module_info.path / "models" / "__init__.py"
            
            imported_this_module = False
            import_target = f"Modules.{module_info.path.name}.models"
            
            # ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ° models.py
            if module_models_file.is_file():
                print(f"[Alembic Env] ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ°: {import_target}")
                try:
                    importlib.import_module(import_target)
                    print(f"[Alembic Env] > âœ… Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ°: {import_target}")
                    imported_this_module = True
                    successful_imports += 1
                except SyntaxError as e_syntax:
                    error_msg = f"SyntaxError Ğ² {import_target}: {e_syntax}"
                    print(f"[Alembic Env] > âŒ {error_msg}")
                    import_errors.append((module_info.name, import_target, e_syntax))
                    failed_imports += 1
                except ImportError as e_imp_f:
                    error_msg = f"ImportError Ğ² {import_target}: {e_imp_f}"
                    print(f"[Alembic Env] > âŒ {error_msg}")
                    import_errors.append((module_info.name, import_target, e_imp_f))
                    failed_imports += 1
                except Exception as e_f:
                    error_msg = f"ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğµ {import_target}: {type(e_f).__name__} - {e_f}"
                    print(f"[Alembic Env] > âš ï¸ {error_msg}")
                    import_errors.append((module_info.name, import_target, e_f))
                    failed_imports += 1
            
            # ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¸Ğ· Ğ¿Ğ°ĞºĞµÑ‚Ğ° models/__init__.py
            if not imported_this_module and module_models_pkg_init.is_file():
                print(f"[Alembic Env] ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ¸Ğ· Ğ¿Ğ°ĞºĞµÑ‚Ğ°: {import_target}")
                try:
                    importlib.import_module(import_target)
                    print(f"[Alembic Env] > âœ… Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ¿Ğ°ĞºĞµÑ‚ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹: {import_target}")
                    imported_this_module = True
                    successful_imports += 1
                except SyntaxError as e_syntax:
                    error_msg = f"SyntaxError Ğ² {import_target}: {e_syntax}"
                    print(f"[Alembic Env] > âŒ {error_msg}")
                    import_errors.append((module_info.name, import_target, e_syntax))
                    failed_imports += 1
                except ImportError as e_imp_p:
                    error_msg = f"ImportError Ğ² {import_target}: {e_imp_p}"
                    print(f"[Alembic Env] > âŒ {error_msg}")
                    import_errors.append((module_info.name, import_target, e_imp_p))
                    failed_imports += 1
                except Exception as e_p:
                    error_msg = f"ĞĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğµ {import_target}: {type(e_p).__name__} - {e_p}"
                    print(f"[Alembic Env] > âš ï¸ {error_msg}")
                    import_errors.append((module_info.name, import_target, e_p))
                    failed_imports += 1
            
            # ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ±ĞµĞ· models.py/models/
            if not imported_this_module and not module_models_file.is_file() and not module_models_pkg_init.is_file():
                print(f"[Alembic Env] > âš ï¸ Ğ”Ğ»Ñ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ° '{module_info.name}' Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ½Ğ¸ Ñ„Ğ°Ğ¹Ğ» models.py, Ğ½Ğ¸ Ğ¿Ğ°ĞºĞµÑ‚ models/__init__.py (Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½).")
                skipped_modules += 1
    else:
        print("[Alembic Env] ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾.")
    
    # Ğ’Ñ‹Ğ²Ğ¾Ğ´ Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
    print(f"\n[Alembic Env] ===== Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ =====")
    print(f"[Alembic Env] Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾: {successful_imports}")
    print(f"[Alembic Env] ĞÑˆĞ¸Ğ±Ğ¾Ğº Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ°: {failed_imports}")
    print(f"[Alembic Env] ĞŸÑ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾ (Ğ±ĞµĞ· models): {skipped_modules}")
    
    # Ğ•ÑĞ»Ğ¸ Ğ±Ñ‹Ğ»Ğ¸ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ (SyntaxError, ImportError), Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ°ĞµĞ¼ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹
    if import_errors:
        print(f"\n[ALEMBIC ENV ERROR] ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¿Ñ€Ğ¸ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ {len(import_errors)} Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹:")
        for module_name, import_target, error in import_errors:
            print(f"  - ĞœĞ¾Ğ´ÑƒĞ»ÑŒ '{module_name}' ({import_target}): {type(error).__name__} - {error}")
        print("\n[ALEMBIC ENV ERROR] ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¸ÑĞ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»ÑÑ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸ĞµĞ¼ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹.")
        print("[ALEMBIC ENV ERROR] Alembic Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ Ñ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¼Ğ¸ Ğ¼Ğ¾Ğ´ĞµĞ»ÑĞ¼Ğ¸.")
        sys.exit(1)
    
    # Ğ•ÑĞ»Ğ¸ Ñƒ Ğ²Ğ°Ñ ĞµÑÑ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ Ğ² Systems/core/sys_modules/ Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑĞ¼Ğ¸,
    # Ğ¸ Ğ¾Ğ½Ğ¸ Ğ½Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ñ‡ĞµÑ€ĞµĞ· Systems.core.database.core_models),
    # Ğ¸Ñ… Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ´ĞµÑÑŒ ÑĞ²Ğ½Ğ¾ Ğ¸Ğ»Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ğ¸Ñ… Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ.
    # ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:
    # print("[Alembic Env] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ ÑĞ´Ñ€Ğ°...")
    # sys_module_path = SDB_PROJECT_ROOT / "Systems" / "core" / "sys_modules" / "my_sys_module_with_models"
    # if (sys_module_path / "models.py").is_file():
    #    importlib.import_module("Systems.core.sys_modules.my_sys_module_with_models.models")
    #    print("[Alembic Env] ĞœĞ¾Ğ´ĞµĞ»Ğ¸ Ğ¸Ğ· 'my_sys_module_with_models' Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹.")

    print(f"[Alembic Env] Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½. ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ² target_metadata: {len(target_metadata.tables)}")

except Exception as e_load_mod_env:
    print(f"[ALEMBIC ENV ERROR] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ Ğ¸Ğ»Ğ¸ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ² env.py: {e_load_mod_env}")
    import traceback
    traceback.print_exc()
    print("[ALEMBIC ENV WARNING] Ğ˜Ğ·-Ğ·Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ²Ñ‹ÑˆĞµ, Alembic Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ½Ğµ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ½ĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ¸Ğ»Ğ¸ Ğ²ÑĞµÑ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹.")

config = context.config
try:
    temp_db_manager_for_url = DBManager(db_settings=sdb_settings.db, app_settings=sdb_settings)
    db_connection_url = temp_db_manager_for_url._build_db_url()
    config.set_main_option("sqlalchemy.url", db_connection_url)
    print(f"[Alembic Env] sqlalchemy.url ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸Ğ· Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº SDB: {db_connection_url[:db_connection_url.find('://')+3]}...")
except Exception as e_db_url_env:
    print(f"[ALEMBIC ENV ERROR] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ URL Ğ‘Ğ” Ğ¸Ğ· Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº SDB: {e_db_url_env}")
    sys.exit(1)

if config.config_file_name is not None:
    fileConfig(config.config_file_name)

def _get_dialect_name_from_configured_context() -> Optional[str]:
    try:
        migration_context = context.get_context()
        if migration_context and migration_context.dialect:
            return migration_context.dialect.name.lower()
    except Exception: pass
    return None

def include_object(object, name, type_, reflected, compare_to):
    if type_ == "table" and object.metadata != target_metadata:
        return False
    return True

def compare_type(alem_context, inspected_column, metadata_column, inspected_type, metadata_type):
    dialect_name = _get_dialect_name_from_configured_context()
    if not dialect_name and alem_context.dialect:
        dialect_name = alem_context.dialect.name.lower()

    if dialect_name == 'sqlite':
        inspected_type_str = str(inspected_type).upper()
        metadata_type_str = str(metadata_type).upper()
        if metadata_type_str == 'BIGINTEGER' and inspected_type_str == 'INTEGER': return False
        if metadata_type_str == 'BOOLEAN' and inspected_type_str == 'INTEGER': return False
        if 'DATETIME' in metadata_type_str and 'TIMESTAMP' in inspected_type_str: return False
        if 'TIMESTAMP' in metadata_type_str and 'DATETIME' in inspected_type_str: return False
    elif dialect_name == 'mysql':
        if str(metadata_type).upper() == 'BOOLEAN' and str(inspected_type).upper() == 'TINYINT(1)': return False
    return None

def render_item(type_, obj, autogen_context):
    dialect_name = _get_dialect_name_from_configured_context()
    if not dialect_name and autogen_context.dialect:
         dialect_name = autogen_context.dialect.name.lower()
         
    if dialect_name == 'sqlite':
        if type_ == "table_comment" or type_ == "column_comment":
            return None 
    return False

def run_migrations_offline() -> None:
    url = config.get_main_option("sqlalchemy.url")
    context.configure(
        url=url, target_metadata=target_metadata, literal_binds=True,
        dialect_opts={"paramstyle": "named"},
        include_object=include_object,
        compare_type=compare_type,
        compare_server_default=True,
        render_item=render_item
    )
    with context.begin_transaction():
        context.run_migrations()

def do_run_migrations(connection: Connection) -> None:
    context.configure(
        connection=connection, target_metadata=target_metadata,
        include_object=include_object,
        compare_type=compare_type,
        compare_server_default=True,
        render_item=render_item
    )
    with context.begin_transaction():
        context.run_migrations()

async def run_migrations_online() -> None:
    db_url_for_engine = config.get_main_option("sqlalchemy.url")
    if not db_url_for_engine:
        raise RuntimeError("sqlalchemy.url Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Alembic Ğ´Ğ»Ñ online Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°!")

    connectable_engine: AsyncEngine = create_async_engine(
        db_url_for_engine,
        poolclass=pool.NullPool,
    )
    
    async with connectable_engine.connect() as connection:
        await connection.run_sync(do_run_migrations)
    await connectable_engine.dispose()

if context.is_offline_mode():
    print("[Alembic Env] Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ² offline Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ...")
    run_migrations_offline()
else:
    print("[Alembic Env] Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ² online Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ...")
    asyncio.run(run_migrations_online())


======================================================================

------------------------------ FILE: Systems/migration/versions/d10040ec2cb7_initial_migration_for_core_tables.py ------------------------------
# alembic_migrations/script.py.mako
"""Initial migration for core tables

Revision ID: d10040ec2cb7
Revises: 
Create Date: 2025-06-14 08:36:19.434958

"""
from typing import Sequence, Union

from alembic import op # type: ignore
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = 'd10040ec2cb7'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('mod_example_table_one',
    sa.Column('name', sa.String(length=100), nullable=False, comment='ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»Ñ'),
    sa.Column('description', sa.String(length=255), nullable=True, comment='ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ°'),
    sa.Column('is_active', sa.Boolean(), server_default='1', nullable=False),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_mod_example_table_one'))
    )
    op.create_index(op.f('ix_mod_example_table_one_id'), 'mod_example_table_one', ['id'], unique=False)
    op.create_table('mod_example_user_notes',
    sa.Column('user_telegram_id', sa.BigInteger(), nullable=False, comment='Telegram ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ-Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸'),
    sa.Column('note_text', sa.Text(), nullable=False, comment='Ğ¢ĞµĞºÑÑ‚ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸'),
    sa.Column('is_done', sa.Boolean(), nullable=False, comment='ĞÑ‚Ğ¼ĞµÑ‡ĞµĞ½Ğ° Ğ»Ğ¸ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ° ĞºĞ°Ğº Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ğ°Ñ'),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_mod_example_user_notes'))
    )
    op.create_index(op.f('ix_mod_example_user_notes_id'), 'mod_example_user_notes', ['id'], unique=False)
    op.create_index(op.f('ix_mod_example_user_notes_user_telegram_id'), 'mod_example_user_notes', ['user_telegram_id'], unique=False)
    op.create_table('sdb_permissions',
    sa.Column('name', sa.String(length=100), nullable=False, comment="Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ¼Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 'view_users', 'manage_modules')"),
    sa.Column('description', sa.Text(), nullable=True, comment='ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ'),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_sdb_permissions'))
    )
    op.create_index(op.f('ix_sdb_permissions_id'), 'sdb_permissions', ['id'], unique=False)
    op.create_index(op.f('ix_sdb_permissions_name'), 'sdb_permissions', ['name'], unique=True)
    op.create_table('sdb_roles',
    sa.Column('name', sa.String(length=50), nullable=False, comment='Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ¼Ñ Ñ€Ğ¾Ğ»Ğ¸'),
    sa.Column('description', sa.Text(), nullable=True, comment='ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸'),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_sdb_roles'))
    )
    op.create_index(op.f('ix_sdb_roles_id'), 'sdb_roles', ['id'], unique=False)
    op.create_index(op.f('ix_sdb_roles_name'), 'sdb_roles', ['name'], unique=True)
    op.create_table('sdb_users',
    sa.Column('username_lower', sa.String(length=32), nullable=True, comment='Telegram username Ğ² Ğ½Ğ¸Ğ¶Ğ½ĞµĞ¼ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğµ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ°'),
    sa.Column('telegram_id', sa.BigInteger(), nullable=False, comment='Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Telegram ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ'),
    sa.Column('username', sa.String(length=32), nullable=True, comment='Telegram username (Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€)'),
    sa.Column('first_name', sa.String(length=255), nullable=True, comment='Ğ˜Ğ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ'),
    sa.Column('last_name', sa.String(length=255), nullable=True, comment='Ğ¤Ğ°Ğ¼Ğ¸Ğ»Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ'),
    sa.Column('preferred_language_code', sa.String(length=10), nullable=True, comment='ĞšĞ¾Ğ´ ÑĞ·Ñ‹ĞºĞ° Ğ±Ğ¾Ñ‚Ğ°'),
    sa.Column('is_active', sa.Boolean(), nullable=False, comment='ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½ Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ'),
    sa.Column('is_bot_blocked', sa.Boolean(), nullable=False, comment='Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ» Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ±Ğ¾Ñ‚Ğ°'),
    sa.Column('last_activity_at', sa.DateTime(), nullable=True, comment='Ğ’Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸'),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_sdb_users'))
    )
    op.create_index(op.f('ix_sdb_users_id'), 'sdb_users', ['id'], unique=False)
    op.create_index(op.f('ix_sdb_users_telegram_id'), 'sdb_users', ['telegram_id'], unique=True)
    op.create_index(op.f('ix_sdb_users_username'), 'sdb_users', ['username'], unique=False)
    op.create_index(op.f('ix_sdb_users_username_lower'), 'sdb_users', ['username_lower'], unique=False)
    op.create_table('mod_another_example_table',
    sa.Column('example_one_id', sa.Integer(), nullable=True),
    sa.Column('value', sa.String(length=200), nullable=False, comment='ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ ÑÑ‚Ñ€Ğ¾ĞºĞ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ'),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['example_one_id'], ['mod_example_table_one.id'], name=op.f('fk_mod_another_example_table_example_one_id_mod_example_table_one'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_mod_another_example_table'))
    )
    op.create_index(op.f('ix_mod_another_example_table_id'), 'mod_another_example_table', ['id'], unique=False)
    op.create_table('sdb_role_permissions',
    sa.Column('role_id', sa.Integer(), nullable=False, comment='ID Ñ€Ğ¾Ğ»Ğ¸'),
    sa.Column('permission_id', sa.Integer(), nullable=False, comment='ID Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ'),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['permission_id'], ['sdb_permissions.id'], name=op.f('fk_sdb_role_permissions_permission_id_sdb_permissions'), ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['role_id'], ['sdb_roles.id'], name=op.f('fk_sdb_role_permissions_role_id_sdb_roles'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_sdb_role_permissions')),
    sa.UniqueConstraint('role_id', 'permission_id', name='uq_sdb_role_permissions_role_id_permission_id')
    )
    op.create_index(op.f('ix_sdb_role_permissions_id'), 'sdb_role_permissions', ['id'], unique=False)
    op.create_index(op.f('ix_sdb_role_permissions_permission_id'), 'sdb_role_permissions', ['permission_id'], unique=False)
    op.create_index(op.f('ix_sdb_role_permissions_role_id'), 'sdb_role_permissions', ['role_id'], unique=False)
    op.create_table('sdb_user_permissions',
    sa.Column('user_id', sa.Integer(), nullable=False, comment='ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ'),
    sa.Column('permission_id', sa.Integer(), nullable=False, comment='ID Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ'),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['permission_id'], ['sdb_permissions.id'], name=op.f('fk_sdb_user_permissions_permission_id_sdb_permissions'), ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['sdb_users.id'], name=op.f('fk_sdb_user_permissions_user_id_sdb_users'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_sdb_user_permissions')),
    sa.UniqueConstraint('user_id', 'permission_id', name='uq_sdb_user_permissions_user_id_permission_id')
    )
    op.create_index(op.f('ix_sdb_user_permissions_id'), 'sdb_user_permissions', ['id'], unique=False)
    op.create_index(op.f('ix_sdb_user_permissions_permission_id'), 'sdb_user_permissions', ['permission_id'], unique=False)
    op.create_index(op.f('ix_sdb_user_permissions_user_id'), 'sdb_user_permissions', ['user_id'], unique=False)
    op.create_table('sdb_user_roles',
    sa.Column('user_id', sa.Integer(), nullable=False, comment='ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ'),
    sa.Column('role_id', sa.Integer(), nullable=False, comment='ID Ñ€Ğ¾Ğ»Ğ¸'),
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('created_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DateTime(), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['role_id'], ['sdb_roles.id'], name=op.f('fk_sdb_user_roles_role_id_sdb_roles'), ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['user_id'], ['sdb_users.id'], name=op.f('fk_sdb_user_roles_user_id_sdb_users'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_sdb_user_roles')),
    sa.UniqueConstraint('user_id', 'role_id', name='uq_sdb_user_roles_user_id_role_id')
    )
    op.create_index(op.f('ix_sdb_user_roles_id'), 'sdb_user_roles', ['id'], unique=False)
    op.create_index(op.f('ix_sdb_user_roles_role_id'), 'sdb_user_roles', ['role_id'], unique=False)
    op.create_index(op.f('ix_sdb_user_roles_user_id'), 'sdb_user_roles', ['user_id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_sdb_user_roles_user_id'), table_name='sdb_user_roles')
    op.drop_index(op.f('ix_sdb_user_roles_role_id'), table_name='sdb_user_roles')
    op.drop_index(op.f('ix_sdb_user_roles_id'), table_name='sdb_user_roles')
    op.drop_table('sdb_user_roles')
    op.drop_index(op.f('ix_sdb_user_permissions_user_id'), table_name='sdb_user_permissions')
    op.drop_index(op.f('ix_sdb_user_permissions_permission_id'), table_name='sdb_user_permissions')
    op.drop_index(op.f('ix_sdb_user_permissions_id'), table_name='sdb_user_permissions')
    op.drop_table('sdb_user_permissions')
    op.drop_index(op.f('ix_sdb_role_permissions_role_id'), table_name='sdb_role_permissions')
    op.drop_index(op.f('ix_sdb_role_permissions_permission_id'), table_name='sdb_role_permissions')
    op.drop_index(op.f('ix_sdb_role_permissions_id'), table_name='sdb_role_permissions')
    op.drop_table('sdb_role_permissions')
    op.drop_index(op.f('ix_mod_another_example_table_id'), table_name='mod_another_example_table')
    op.drop_table('mod_another_example_table')
    op.drop_index(op.f('ix_sdb_users_username_lower'), table_name='sdb_users')
    op.drop_index(op.f('ix_sdb_users_username'), table_name='sdb_users')
    op.drop_index(op.f('ix_sdb_users_telegram_id'), table_name='sdb_users')
    op.drop_index(op.f('ix_sdb_users_id'), table_name='sdb_users')
    op.drop_table('sdb_users')
    op.drop_index(op.f('ix_sdb_roles_name'), table_name='sdb_roles')
    op.drop_index(op.f('ix_sdb_roles_id'), table_name='sdb_roles')
    op.drop_table('sdb_roles')
    op.drop_index(op.f('ix_sdb_permissions_name'), table_name='sdb_permissions')
    op.drop_index(op.f('ix_sdb_permissions_id'), table_name='sdb_permissions')
    op.drop_table('sdb_permissions')
    op.drop_index(op.f('ix_mod_example_user_notes_user_telegram_id'), table_name='mod_example_user_notes')
    op.drop_index(op.f('ix_mod_example_user_notes_id'), table_name='mod_example_user_notes')
    op.drop_table('mod_example_user_notes')
    op.drop_index(op.f('ix_mod_example_table_one_id'), table_name='mod_example_table_one')
    op.drop_table('mod_example_table_one')
    # ### end Alembic commands ###


======================================================================

------------------------------ FILE: Systems/migration/versions/.gitkeep ------------------------------



======================================================================

------------------------------ FILE: Systems/web/.gitignore ------------------------------
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
.env



======================================================================

------------------------------ FILE: Systems/web/postcss.config.js ------------------------------
export default {
    plugins: {
      tailwindcss: {},
      autoprefixer: {},
    },
  };
  


======================================================================

------------------------------ FILE: Systems/web/vite.config.ts ------------------------------
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  optimizeDeps: {
    exclude: ['lucide-react'],
  },
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    // Vite Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¸Ğ· public Ğ² dist
  },
  publicDir: 'public',
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
      },
    },
  },
});



======================================================================

------------------------------ FILE: Systems/web/package-lock.json ------------------------------
{
    "name": "vite-react-typescript-starter",
    "version": "0.0.0",
    "lockfileVersion": 3,
    "requires": true,
    "packages": {
        "": {
            "name": "vite-react-typescript-starter",
            "version": "0.0.0",
            "dependencies": {
                "@monaco-editor/react": "^4.7.0",
                "@types/react-router-dom": "^5.3.3",
                "@xterm/addon-fit": "^0.10.0",
                "@xterm/addon-web-links": "^0.11.0",
                "@xterm/xterm": "^5.5.0",
                "lucide-react": "^0.344.0",
                "react": "^18.3.1",
                "react-dom": "^18.3.1",
                "react-router-dom": "^7.9.6",
                "recharts": "^3.4.1",
                "xterm": "^5.3.0",
                "xterm-addon-fit": "^0.8.0",
                "xterm-addon-web-links": "^0.9.0"
            },
            "devDependencies": {
                "@eslint/js": "^9.9.1",
                "@types/react": "^18.3.5",
                "@types/react-dom": "^18.3.0",
                "@vitejs/plugin-react": "^4.3.1",
                "autoprefixer": "^10.4.18",
                "eslint": "^9.9.1",
                "eslint-plugin-react-hooks": "^5.1.0-rc.0",
                "eslint-plugin-react-refresh": "^0.4.11",
                "globals": "^15.9.0",
                "postcss": "^8.4.35",
                "tailwindcss": "^3.4.1",
                "typescript": "^5.5.3",
                "typescript-eslint": "^8.3.0",
                "vite": "^5.4.2"
            }
        },
        "node_modules/@alloc/quick-lru": {
            "version": "5.2.0",
            "resolved": "https://registry.npmjs.org/@alloc/quick-lru/-/quick-lru-5.2.0.tgz",
            "integrity": "sha512-UrcABB+4bUrFABwbluTIBErXwvbsU/V7TZWfmbgJfbkwiBuziS9gxdODUyuiecfdGQ85jglMW6juS3+z5TsKLw==",
            "dev": true,
            "engines": {
                "node": ">=10"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        },
        "node_modules/@ampproject/remapping": {
            "version": "2.3.0",
            "resolved": "https://registry.npmjs.org/@ampproject/remapping/-/remapping-2.3.0.tgz",
            "integrity": "sha512-30iZtAPgz+LTIYoeivqYo853f02jBYSd5uGnGpkFV0M3xOt9aN73erkgYAmZU43x4VfqcnLxW9Kpg3R5LC4YYw==",
            "dev": true,
            "dependencies": {
                "@jridgewell/gen-mapping": "^0.3.5",
                "@jridgewell/trace-mapping": "^0.3.24"
            },
            "engines": {
                "node": ">=6.0.0"
            }
        },
        "node_modules/@babel/code-frame": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/code-frame/-/code-frame-7.25.7.tgz",
            "integrity": "sha512-0xZJFNE5XMpENsgfHYTw8FbX4kv53mFLn2i3XPoq69LyhYSCBJtitaHx9QnsVTrsogI4Z3+HtEfZ2/GFPOtf5g==",
            "dev": true,
            "dependencies": {
                "@babel/highlight": "^7.25.7",
                "picocolors": "^1.0.0"
            },
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/compat-data": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/compat-data/-/compat-data-7.25.7.tgz",
            "integrity": "sha512-9ickoLz+hcXCeh7jrcin+/SLWm+GkxE2kTvoYyp38p4WkdFXfQJxDFGWp/YHjiKLPx06z2A7W8XKuqbReXDzsw==",
            "dev": true,
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/core": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/core/-/core-7.25.7.tgz",
            "integrity": "sha512-yJ474Zv3cwiSOO9nXJuqzvwEeM+chDuQ8GJirw+pZ91sCGCyOZ3dJkVE09fTV0VEVzXyLWhh3G/AolYTPX7Mow==",
            "dev": true,
            "dependencies": {
                "@ampproject/remapping": "^2.2.0",
                "@babel/code-frame": "^7.25.7",
                "@babel/generator": "^7.25.7",
                "@babel/helper-compilation-targets": "^7.25.7",
                "@babel/helper-module-transforms": "^7.25.7",
                "@babel/helpers": "^7.25.7",
                "@babel/parser": "^7.25.7",
                "@babel/template": "^7.25.7",
                "@babel/traverse": "^7.25.7",
                "@babel/types": "^7.25.7",
                "convert-source-map": "^2.0.0",
                "debug": "^4.1.0",
                "gensync": "^1.0.0-beta.2",
                "json5": "^2.2.3",
                "semver": "^6.3.1"
            },
            "engines": {
                "node": ">=6.9.0"
            },
            "funding": {
                "type": "opencollective",
                "url": "https://opencollective.com/babel"
            }
        },
        "node_modules/@babel/generator": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/generator/-/generator-7.25.7.tgz",
            "integrity": "sha512-5Dqpl5fyV9pIAD62yK9P7fcA768uVPUyrQmqpqstHWgMma4feF1x/oFysBCVZLY5wJ2GkMUCdsNDnGZrPoR6rA==",
            "dev": true,
            "dependencies": {
                "@babel/types": "^7.25.7",
                "@jridgewell/gen-mapping": "^0.3.5",
                "@jridgewell/trace-mapping": "^0.3.25",
                "jsesc": "^3.0.2"
            },
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/helper-compilation-targets": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/helper-compilation-targets/-/helper-compilation-targets-7.25.7.tgz",
            "integrity": "sha512-DniTEax0sv6isaw6qSQSfV4gVRNtw2rte8HHM45t9ZR0xILaufBRNkpMifCRiAPyvL4ACD6v0gfCwCmtOQaV4A==",
            "dev": true,
            "dependencies": {
                "@babel/compat-data": "^7.25.7",
                "@babel/helper-validator-option": "^7.25.7",
                "browserslist": "^4.24.0",
                "lru-cache": "^5.1.1",
                "semver": "^6.3.1"
            },
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/helper-module-imports": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/helper-module-imports/-/helper-module-imports-7.25.7.tgz",
            "integrity": "sha512-o0xCgpNmRohmnoWKQ0Ij8IdddjyBFE4T2kagL/x6M3+4zUgc+4qTOUBoNe4XxDskt1HPKO007ZPiMgLDq2s7Kw==",
            "dev": true,
            "dependencies": {
                "@babel/traverse": "^7.25.7",
                "@babel/types": "^7.25.7"
            },
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/helper-module-transforms": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/helper-module-transforms/-/helper-module-transforms-7.25.7.tgz",
            "integrity": "sha512-k/6f8dKG3yDz/qCwSM+RKovjMix563SLxQFo0UhRNo239SP6n9u5/eLtKD6EAjwta2JHJ49CsD8pms2HdNiMMQ==",
            "dev": true,
            "dependencies": {
                "@babel/helper-module-imports": "^7.25.7",
                "@babel/helper-simple-access": "^7.25.7",
                "@babel/helper-validator-identifier": "^7.25.7",
                "@babel/traverse": "^7.25.7"
            },
            "engines": {
                "node": ">=6.9.0"
            },
            "peerDependencies": {
                "@babel/core": "^7.0.0"
            }
        },
        "node_modules/@babel/helper-plugin-utils": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/helper-plugin-utils/-/helper-plugin-utils-7.25.7.tgz",
            "integrity": "sha512-eaPZai0PiqCi09pPs3pAFfl/zYgGaE6IdXtYvmf0qlcDTd3WCtO7JWCcRd64e0EQrcYgiHibEZnOGsSY4QSgaw==",
            "dev": true,
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/helper-simple-access": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/helper-simple-access/-/helper-simple-access-7.25.7.tgz",
            "integrity": "sha512-FPGAkJmyoChQeM+ruBGIDyrT2tKfZJO8NcxdC+CWNJi7N8/rZpSxK7yvBJ5O/nF1gfu5KzN7VKG3YVSLFfRSxQ==",
            "dev": true,
            "dependencies": {
                "@babel/traverse": "^7.25.7",
                "@babel/types": "^7.25.7"
            },
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/helper-string-parser": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/helper-string-parser/-/helper-string-parser-7.25.7.tgz",
            "integrity": "sha512-CbkjYdsJNHFk8uqpEkpCvRs3YRp9tY6FmFY7wLMSYuGYkrdUi7r2lc4/wqsvlHoMznX3WJ9IP8giGPq68T/Y6g==",
            "dev": true,
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/helper-validator-identifier": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/helper-validator-identifier/-/helper-validator-identifier-7.25.7.tgz",
            "integrity": "sha512-AM6TzwYqGChO45oiuPqwL2t20/HdMC1rTPAesnBCgPCSF1x3oN9MVUwQV2iyz4xqWrctwK5RNC8LV22kaQCNYg==",
            "dev": true,
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/helper-validator-option": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/helper-validator-option/-/helper-validator-option-7.25.7.tgz",
            "integrity": "sha512-ytbPLsm+GjArDYXJ8Ydr1c/KJuutjF2besPNbIZnZ6MKUxi/uTA22t2ymmA4WFjZFpjiAMO0xuuJPqK2nvDVfQ==",
            "dev": true,
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/helpers": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/helpers/-/helpers-7.25.7.tgz",
            "integrity": "sha512-Sv6pASx7Esm38KQpF/U/OXLwPPrdGHNKoeblRxgZRLXnAtnkEe4ptJPDtAZM7fBLadbc1Q07kQpSiGQ0Jg6tRA==",
            "dev": true,
            "dependencies": {
                "@babel/template": "^7.25.7",
                "@babel/types": "^7.25.7"
            },
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/highlight": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/highlight/-/highlight-7.25.7.tgz",
            "integrity": "sha512-iYyACpW3iW8Fw+ZybQK+drQre+ns/tKpXbNESfrhNnPLIklLbXr7MYJ6gPEd0iETGLOK+SxMjVvKb/ffmk+FEw==",
            "dev": true,
            "dependencies": {
                "@babel/helper-validator-identifier": "^7.25.7",
                "chalk": "^2.4.2",
                "js-tokens": "^4.0.0",
                "picocolors": "^1.0.0"
            },
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/parser": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/parser/-/parser-7.25.7.tgz",
            "integrity": "sha512-aZn7ETtQsjjGG5HruveUK06cU3Hljuhd9Iojm4M8WWv3wLE6OkE5PWbDUkItmMgegmccaITudyuW5RPYrYlgWw==",
            "dev": true,
            "dependencies": {
                "@babel/types": "^7.25.7"
            },
            "bin": {
                "parser": "bin/babel-parser.js"
            },
            "engines": {
                "node": ">=6.0.0"
            }
        },
        "node_modules/@babel/plugin-transform-react-jsx-self": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/plugin-transform-react-jsx-self/-/plugin-transform-react-jsx-self-7.25.7.tgz",
            "integrity": "sha512-JD9MUnLbPL0WdVK8AWC7F7tTG2OS6u/AKKnsK+NdRhUiVdnzyR1S3kKQCaRLOiaULvUiqK6Z4JQE635VgtCFeg==",
            "dev": true,
            "dependencies": {
                "@babel/helper-plugin-utils": "^7.25.7"
            },
            "engines": {
                "node": ">=6.9.0"
            },
            "peerDependencies": {
                "@babel/core": "^7.0.0-0"
            }
        },
        "node_modules/@babel/plugin-transform-react-jsx-source": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/plugin-transform-react-jsx-source/-/plugin-transform-react-jsx-source-7.25.7.tgz",
            "integrity": "sha512-S/JXG/KrbIY06iyJPKfxr0qRxnhNOdkNXYBl/rmwgDd72cQLH9tEGkDm/yJPGvcSIUoikzfjMios9i+xT/uv9w==",
            "dev": true,
            "dependencies": {
                "@babel/helper-plugin-utils": "^7.25.7"
            },
            "engines": {
                "node": ">=6.9.0"
            },
            "peerDependencies": {
                "@babel/core": "^7.0.0-0"
            }
        },
        "node_modules/@babel/template": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/template/-/template-7.25.7.tgz",
            "integrity": "sha512-wRwtAgI3bAS+JGU2upWNL9lSlDcRCqD05BZ1n3X2ONLH1WilFP6O1otQjeMK/1g0pvYcXC7b/qVUB1keofjtZA==",
            "dev": true,
            "dependencies": {
                "@babel/code-frame": "^7.25.7",
                "@babel/parser": "^7.25.7",
                "@babel/types": "^7.25.7"
            },
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/traverse": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/traverse/-/traverse-7.25.7.tgz",
            "integrity": "sha512-jatJPT1Zjqvh/1FyJs6qAHL+Dzb7sTb+xr7Q+gM1b+1oBsMsQQ4FkVKb6dFlJvLlVssqkRzV05Jzervt9yhnzg==",
            "dev": true,
            "dependencies": {
                "@babel/code-frame": "^7.25.7",
                "@babel/generator": "^7.25.7",
                "@babel/parser": "^7.25.7",
                "@babel/template": "^7.25.7",
                "@babel/types": "^7.25.7",
                "debug": "^4.3.1",
                "globals": "^11.1.0"
            },
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@babel/traverse/node_modules/globals": {
            "version": "11.12.0",
            "resolved": "https://registry.npmjs.org/globals/-/globals-11.12.0.tgz",
            "integrity": "sha512-WOBp/EEGUiIsJSp7wcv/y6MO+lV9UoncWqxuFfm8eBwzWNgyfBd6Gz+IeKQ9jCmyhoH99g15M3T+QaVHFjizVA==",
            "dev": true,
            "engines": {
                "node": ">=4"
            }
        },
        "node_modules/@babel/types": {
            "version": "7.25.7",
            "resolved": "https://registry.npmjs.org/@babel/types/-/types-7.25.7.tgz",
            "integrity": "sha512-vwIVdXG+j+FOpkwqHRcBgHLYNL7XMkufrlaFvL9o6Ai9sJn9+PdyIL5qa0XzTZw084c+u9LOls53eoZWP/W5WQ==",
            "dev": true,
            "dependencies": {
                "@babel/helper-string-parser": "^7.25.7",
                "@babel/helper-validator-identifier": "^7.25.7",
                "to-fast-properties": "^2.0.0"
            },
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/@esbuild/aix-ppc64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/aix-ppc64/-/aix-ppc64-0.21.5.tgz",
            "integrity": "sha512-1SDgH6ZSPTlggy1yI6+Dbkiz8xzpHJEVAlF/AM1tHPLsf5STom9rwtjE4hKAF20FfXXNTFqEYXyJNWh1GiZedQ==",
            "cpu": [
                "ppc64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "aix"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/android-arm": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/android-arm/-/android-arm-0.21.5.tgz",
            "integrity": "sha512-vCPvzSjpPHEi1siZdlvAlsPxXl7WbOVUBBAowWug4rJHb68Ox8KualB+1ocNvT5fjv6wpkX6o/iEpbDrf68zcg==",
            "cpu": [
                "arm"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "android"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/android-arm64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/android-arm64/-/android-arm64-0.21.5.tgz",
            "integrity": "sha512-c0uX9VAUBQ7dTDCjq+wdyGLowMdtR/GoC2U5IYk/7D1H1JYC0qseD7+11iMP2mRLN9RcCMRcjC4YMclCzGwS/A==",
            "cpu": [
                "arm64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "android"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/android-x64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/android-x64/-/android-x64-0.21.5.tgz",
            "integrity": "sha512-D7aPRUUNHRBwHxzxRvp856rjUHRFW1SdQATKXH2hqA0kAZb1hKmi02OpYRacl0TxIGz/ZmXWlbZgjwWYaCakTA==",
            "cpu": [
                "x64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "android"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/darwin-arm64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/darwin-arm64/-/darwin-arm64-0.21.5.tgz",
            "integrity": "sha512-DwqXqZyuk5AiWWf3UfLiRDJ5EDd49zg6O9wclZ7kUMv2WRFr4HKjXp/5t8JZ11QbQfUS6/cRCKGwYhtNAY88kQ==",
            "cpu": [
                "arm64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "darwin"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/darwin-x64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/darwin-x64/-/darwin-x64-0.21.5.tgz",
            "integrity": "sha512-se/JjF8NlmKVG4kNIuyWMV/22ZaerB+qaSi5MdrXtd6R08kvs2qCN4C09miupktDitvh8jRFflwGFBQcxZRjbw==",
            "cpu": [
                "x64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "darwin"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/freebsd-arm64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/freebsd-arm64/-/freebsd-arm64-0.21.5.tgz",
            "integrity": "sha512-5JcRxxRDUJLX8JXp/wcBCy3pENnCgBR9bN6JsY4OmhfUtIHe3ZW0mawA7+RDAcMLrMIZaf03NlQiX9DGyB8h4g==",
            "cpu": [
                "arm64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "freebsd"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/freebsd-x64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/freebsd-x64/-/freebsd-x64-0.21.5.tgz",
            "integrity": "sha512-J95kNBj1zkbMXtHVH29bBriQygMXqoVQOQYA+ISs0/2l3T9/kj42ow2mpqerRBxDJnmkUDCaQT/dfNXWX/ZZCQ==",
            "cpu": [
                "x64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "freebsd"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/linux-arm": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/linux-arm/-/linux-arm-0.21.5.tgz",
            "integrity": "sha512-bPb5AHZtbeNGjCKVZ9UGqGwo8EUu4cLq68E95A53KlxAPRmUyYv2D6F0uUI65XisGOL1hBP5mTronbgo+0bFcA==",
            "cpu": [
                "arm"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/linux-arm64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/linux-arm64/-/linux-arm64-0.21.5.tgz",
            "integrity": "sha512-ibKvmyYzKsBeX8d8I7MH/TMfWDXBF3db4qM6sy+7re0YXya+K1cem3on9XgdT2EQGMu4hQyZhan7TeQ8XkGp4Q==",
            "cpu": [
                "arm64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/linux-ia32": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/linux-ia32/-/linux-ia32-0.21.5.tgz",
            "integrity": "sha512-YvjXDqLRqPDl2dvRODYmmhz4rPeVKYvppfGYKSNGdyZkA01046pLWyRKKI3ax8fbJoK5QbxblURkwK/MWY18Tg==",
            "cpu": [
                "ia32"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/linux-loong64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/linux-loong64/-/linux-loong64-0.21.5.tgz",
            "integrity": "sha512-uHf1BmMG8qEvzdrzAqg2SIG/02+4/DHB6a9Kbya0XDvwDEKCoC8ZRWI5JJvNdUjtciBGFQ5PuBlpEOXQj+JQSg==",
            "cpu": [
                "loong64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/linux-mips64el": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/linux-mips64el/-/linux-mips64el-0.21.5.tgz",
            "integrity": "sha512-IajOmO+KJK23bj52dFSNCMsz1QP1DqM6cwLUv3W1QwyxkyIWecfafnI555fvSGqEKwjMXVLokcV5ygHW5b3Jbg==",
            "cpu": [
                "mips64el"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/linux-ppc64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/linux-ppc64/-/linux-ppc64-0.21.5.tgz",
            "integrity": "sha512-1hHV/Z4OEfMwpLO8rp7CvlhBDnjsC3CttJXIhBi+5Aj5r+MBvy4egg7wCbe//hSsT+RvDAG7s81tAvpL2XAE4w==",
            "cpu": [
                "ppc64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/linux-riscv64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/linux-riscv64/-/linux-riscv64-0.21.5.tgz",
            "integrity": "sha512-2HdXDMd9GMgTGrPWnJzP2ALSokE/0O5HhTUvWIbD3YdjME8JwvSCnNGBnTThKGEB91OZhzrJ4qIIxk/SBmyDDA==",
            "cpu": [
                "riscv64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/linux-s390x": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/linux-s390x/-/linux-s390x-0.21.5.tgz",
            "integrity": "sha512-zus5sxzqBJD3eXxwvjN1yQkRepANgxE9lgOW2qLnmr8ikMTphkjgXu1HR01K4FJg8h1kEEDAqDcZQtbrRnB41A==",
            "cpu": [
                "s390x"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/linux-x64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/linux-x64/-/linux-x64-0.21.5.tgz",
            "integrity": "sha512-1rYdTpyv03iycF1+BhzrzQJCdOuAOtaqHTWJZCWvijKD2N5Xu0TtVC8/+1faWqcP9iBCWOmjmhoH94dH82BxPQ==",
            "cpu": [
                "x64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/netbsd-x64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/netbsd-x64/-/netbsd-x64-0.21.5.tgz",
            "integrity": "sha512-Woi2MXzXjMULccIwMnLciyZH4nCIMpWQAs049KEeMvOcNADVxo0UBIQPfSmxB3CWKedngg7sWZdLvLczpe0tLg==",
            "cpu": [
                "x64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "netbsd"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/openbsd-x64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/openbsd-x64/-/openbsd-x64-0.21.5.tgz",
            "integrity": "sha512-HLNNw99xsvx12lFBUwoT8EVCsSvRNDVxNpjZ7bPn947b8gJPzeHWyNVhFsaerc0n3TsbOINvRP2byTZ5LKezow==",
            "cpu": [
                "x64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "openbsd"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/sunos-x64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/sunos-x64/-/sunos-x64-0.21.5.tgz",
            "integrity": "sha512-6+gjmFpfy0BHU5Tpptkuh8+uw3mnrvgs+dSPQXQOv3ekbordwnzTVEb4qnIvQcYXq6gzkyTnoZ9dZG+D4garKg==",
            "cpu": [
                "x64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "sunos"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/win32-arm64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/win32-arm64/-/win32-arm64-0.21.5.tgz",
            "integrity": "sha512-Z0gOTd75VvXqyq7nsl93zwahcTROgqvuAcYDUr+vOv8uHhNSKROyU961kgtCD1e95IqPKSQKH7tBTslnS3tA8A==",
            "cpu": [
                "arm64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "win32"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/win32-ia32": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/win32-ia32/-/win32-ia32-0.21.5.tgz",
            "integrity": "sha512-SWXFF1CL2RVNMaVs+BBClwtfZSvDgtL//G/smwAc5oVK/UPu2Gu9tIaRgFmYFFKrmg3SyAjSrElf0TiJ1v8fYA==",
            "cpu": [
                "ia32"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "win32"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@esbuild/win32-x64": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/@esbuild/win32-x64/-/win32-x64-0.21.5.tgz",
            "integrity": "sha512-tQd/1efJuzPC6rCFwEvLtci/xNFcTZknmXs98FYDfGE4wP9ClFV98nyKrzJKVPMhdDnjzLhdUyMX4PsQAPjwIw==",
            "cpu": [
                "x64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "win32"
            ],
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@eslint-community/eslint-utils": {
            "version": "4.4.0",
            "resolved": "https://registry.npmjs.org/@eslint-community/eslint-utils/-/eslint-utils-4.4.0.tgz",
            "integrity": "sha512-1/sA4dwrzBAyeUoQ6oxahHKmrZvsnLCg4RfxW3ZFGGmQkSNQPFNLV9CUEFQP1x9EYXHTo5p6xdhZM1Ne9p/AfA==",
            "dev": true,
            "dependencies": {
                "eslint-visitor-keys": "^3.3.0"
            },
            "engines": {
                "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
            },
            "peerDependencies": {
                "eslint": "^6.0.0 || ^7.0.0 || >=8.0.0"
            }
        },
        "node_modules/@eslint-community/eslint-utils/node_modules/eslint-visitor-keys": {
            "version": "3.4.3",
            "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-3.4.3.tgz",
            "integrity": "sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==",
            "dev": true,
            "engines": {
                "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
            },
            "funding": {
                "url": "https://opencollective.com/eslint"
            }
        },
        "node_modules/@eslint-community/regexpp": {
            "version": "4.11.1",
            "resolved": "https://registry.npmjs.org/@eslint-community/regexpp/-/regexpp-4.11.1.tgz",
            "integrity": "sha512-m4DVN9ZqskZoLU5GlWZadwDnYo3vAEydiUayB9widCl9ffWx2IvPnp6n3on5rJmziJSw9Bv+Z3ChDVdMwXCY8Q==",
            "dev": true,
            "engines": {
                "node": "^12.0.0 || ^14.0.0 || >=16.0.0"
            }
        },
        "node_modules/@eslint/config-array": {
            "version": "0.18.0",
            "resolved": "https://registry.npmjs.org/@eslint/config-array/-/config-array-0.18.0.tgz",
            "integrity": "sha512-fTxvnS1sRMu3+JjXwJG0j/i4RT9u4qJ+lqS/yCGap4lH4zZGzQ7tu+xZqQmcMZq5OBZDL4QRxQzRjkWcGt8IVw==",
            "dev": true,
            "dependencies": {
                "@eslint/object-schema": "^2.1.4",
                "debug": "^4.3.1",
                "minimatch": "^3.1.2"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            }
        },
        "node_modules/@eslint/core": {
            "version": "0.6.0",
            "resolved": "https://registry.npmjs.org/@eslint/core/-/core-0.6.0.tgz",
            "integrity": "sha512-8I2Q8ykA4J0x0o7cg67FPVnehcqWTBehu/lmY+bolPFHGjh49YzGBMXTvpqVgEbBdvNCSxj6iFgiIyHzf03lzg==",
            "dev": true,
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            }
        },
        "node_modules/@eslint/eslintrc": {
            "version": "3.1.0",
            "resolved": "https://registry.npmjs.org/@eslint/eslintrc/-/eslintrc-3.1.0.tgz",
            "integrity": "sha512-4Bfj15dVJdoy3RfZmmo86RK1Fwzn6SstsvK9JS+BaVKqC6QQQQyXekNaC+g+LKNgkQ+2VhGAzm6hO40AhMR3zQ==",
            "dev": true,
            "dependencies": {
                "ajv": "^6.12.4",
                "debug": "^4.3.2",
                "espree": "^10.0.1",
                "globals": "^14.0.0",
                "ignore": "^5.2.0",
                "import-fresh": "^3.2.1",
                "js-yaml": "^4.1.0",
                "minimatch": "^3.1.2",
                "strip-json-comments": "^3.1.1"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "url": "https://opencollective.com/eslint"
            }
        },
        "node_modules/@eslint/eslintrc/node_modules/globals": {
            "version": "14.0.0",
            "resolved": "https://registry.npmjs.org/globals/-/globals-14.0.0.tgz",
            "integrity": "sha512-oahGvuMGQlPw/ivIYBjVSrWAfWLBeku5tpPE2fOPLi+WHffIWbuh2tCjhyQhTBPMf5E9jDEH4FOmTYgYwbKwtQ==",
            "dev": true,
            "engines": {
                "node": ">=18"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        },
        "node_modules/@eslint/js": {
            "version": "9.12.0",
            "resolved": "https://registry.npmjs.org/@eslint/js/-/js-9.12.0.tgz",
            "integrity": "sha512-eohesHH8WFRUprDNyEREgqP6beG6htMeUYeCpkEgBCieCMme5r9zFWjzAJp//9S+Kub4rqE+jXe9Cp1a7IYIIA==",
            "dev": true,
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            }
        },
        "node_modules/@eslint/object-schema": {
            "version": "2.1.4",
            "resolved": "https://registry.npmjs.org/@eslint/object-schema/-/object-schema-2.1.4.tgz",
            "integrity": "sha512-BsWiH1yFGjXXS2yvrf5LyuoSIIbPrGUWob917o+BTKuZ7qJdxX8aJLRxs1fS9n6r7vESrq1OUqb68dANcFXuQQ==",
            "dev": true,
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            }
        },
        "node_modules/@eslint/plugin-kit": {
            "version": "0.2.0",
            "resolved": "https://registry.npmjs.org/@eslint/plugin-kit/-/plugin-kit-0.2.0.tgz",
            "integrity": "sha512-vH9PiIMMwvhCx31Af3HiGzsVNULDbyVkHXwlemn/B0TFj/00ho3y55efXrUZTfQipxoHC5u4xq6zblww1zm1Ig==",
            "dev": true,
            "dependencies": {
                "levn": "^0.4.1"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            }
        },
        "node_modules/@humanfs/core": {
            "version": "0.19.0",
            "resolved": "https://registry.npmjs.org/@humanfs/core/-/core-0.19.0.tgz",
            "integrity": "sha512-2cbWIHbZVEweE853g8jymffCA+NCMiuqeECeBBLm8dg2oFdjuGJhgN4UAbI+6v0CKbbhvtXA4qV8YR5Ji86nmw==",
            "dev": true,
            "engines": {
                "node": ">=18.18.0"
            }
        },
        "node_modules/@humanfs/node": {
            "version": "0.16.5",
            "resolved": "https://registry.npmjs.org/@humanfs/node/-/node-0.16.5.tgz",
            "integrity": "sha512-KSPA4umqSG4LHYRodq31VDwKAvaTF4xmVlzM8Aeh4PlU1JQ3IG0wiA8C25d3RQ9nJyM3mBHyI53K06VVL/oFFg==",
            "dev": true,
            "dependencies": {
                "@humanfs/core": "^0.19.0",
                "@humanwhocodes/retry": "^0.3.0"
            },
            "engines": {
                "node": ">=18.18.0"
            }
        },
        "node_modules/@humanwhocodes/module-importer": {
            "version": "1.0.1",
            "resolved": "https://registry.npmjs.org/@humanwhocodes/module-importer/-/module-importer-1.0.1.tgz",
            "integrity": "sha512-bxveV4V8v5Yb4ncFTT3rPSgZBOpCkjfK0y4oVVVJwIuDVBRMDXrPyXRL988i5ap9m9bnyEEjWfm5WkBmtffLfA==",
            "dev": true,
            "engines": {
                "node": ">=12.22"
            },
            "funding": {
                "type": "github",
                "url": "https://github.com/sponsors/nzakas"
            }
        },
        "node_modules/@humanwhocodes/retry": {
            "version": "0.3.1",
            "resolved": "https://registry.npmjs.org/@humanwhocodes/retry/-/retry-0.3.1.tgz",
            "integrity": "sha512-JBxkERygn7Bv/GbN5Rv8Ul6LVknS+5Bp6RgDC/O8gEBU/yeH5Ui5C/OlWrTb6qct7LjjfT6Re2NxB0ln0yYybA==",
            "dev": true,
            "engines": {
                "node": ">=18.18"
            },
            "funding": {
                "type": "github",
                "url": "https://github.com/sponsors/nzakas"
            }
        },
        "node_modules/@isaacs/cliui": {
            "version": "8.0.2",
            "resolved": "https://registry.npmjs.org/@isaacs/cliui/-/cliui-8.0.2.tgz",
            "integrity": "sha512-O8jcjabXaleOG9DQ0+ARXWZBTfnP4WNAqzuiJK7ll44AmxGKv/J2M4TPjxjY3znBCfvBXFzucm1twdyFybFqEA==",
            "dev": true,
            "dependencies": {
                "string-width": "^5.1.2",
                "string-width-cjs": "npm:string-width@^4.2.0",
                "strip-ansi": "^7.0.1",
                "strip-ansi-cjs": "npm:strip-ansi@^6.0.1",
                "wrap-ansi": "^8.1.0",
                "wrap-ansi-cjs": "npm:wrap-ansi@^7.0.0"
            },
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/@jridgewell/gen-mapping": {
            "version": "0.3.5",
            "resolved": "https://registry.npmjs.org/@jridgewell/gen-mapping/-/gen-mapping-0.3.5.tgz",
            "integrity": "sha512-IzL8ZoEDIBRWEzlCcRhOaCupYyN5gdIK+Q6fbFdPDg6HqX6jpkItn7DFIpW9LQzXG6Df9sA7+OKnq0qlz/GaQg==",
            "dev": true,
            "dependencies": {
                "@jridgewell/set-array": "^1.2.1",
                "@jridgewell/sourcemap-codec": "^1.4.10",
                "@jridgewell/trace-mapping": "^0.3.24"
            },
            "engines": {
                "node": ">=6.0.0"
            }
        },
        "node_modules/@jridgewell/resolve-uri": {
            "version": "3.1.2",
            "resolved": "https://registry.npmjs.org/@jridgewell/resolve-uri/-/resolve-uri-3.1.2.tgz",
            "integrity": "sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==",
            "dev": true,
            "engines": {
                "node": ">=6.0.0"
            }
        },
        "node_modules/@jridgewell/set-array": {
            "version": "1.2.1",
            "resolved": "https://registry.npmjs.org/@jridgewell/set-array/-/set-array-1.2.1.tgz",
            "integrity": "sha512-R8gLRTZeyp03ymzP/6Lil/28tGeGEzhx1q2k703KGWRAI1VdvPIXdG70VJc2pAMw3NA6JKL5hhFu1sJX0Mnn/A==",
            "dev": true,
            "engines": {
                "node": ">=6.0.0"
            }
        },
        "node_modules/@jridgewell/sourcemap-codec": {
            "version": "1.5.0",
            "resolved": "https://registry.npmjs.org/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.5.0.tgz",
            "integrity": "sha512-gv3ZRaISU3fjPAgNsriBRqGWQL6quFx04YMPW/zD8XMLsU32mhCCbfbO6KZFLjvYpCZ8zyDEgqsgf+PwPaM7GQ==",
            "dev": true
        },
        "node_modules/@jridgewell/trace-mapping": {
            "version": "0.3.25",
            "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.25.tgz",
            "integrity": "sha512-vNk6aEwybGtawWmy/PzwnGDOjCkLWSD2wqvjGGAgOAwCGWySYXfYoxt00IJkTF+8Lb57DwOb3Aa0o9CApepiYQ==",
            "dev": true,
            "dependencies": {
                "@jridgewell/resolve-uri": "^3.1.0",
                "@jridgewell/sourcemap-codec": "^1.4.14"
            }
        },
        "node_modules/@monaco-editor/loader": {
            "version": "1.7.0",
            "resolved": "https://registry.npmjs.org/@monaco-editor/loader/-/loader-1.7.0.tgz",
            "integrity": "sha512-gIwR1HrJrrx+vfyOhYmCZ0/JcWqG5kbfG7+d3f/C1LXk2EvzAbHSg3MQ5lO2sMlo9izoAZ04shohfKLVT6crVA==",
            "dependencies": {
                "state-local": "^1.0.6"
            }
        },
        "node_modules/@monaco-editor/react": {
            "version": "4.7.0",
            "resolved": "https://registry.npmjs.org/@monaco-editor/react/-/react-4.7.0.tgz",
            "integrity": "sha512-cyzXQCtO47ydzxpQtCGSQGOC8Gk3ZUeBXFAxD+CWXYFo5OqZyZUonFl0DwUlTyAfRHntBfw2p3w4s9R6oe1eCA==",
            "dependencies": {
                "@monaco-editor/loader": "^1.5.0"
            },
            "peerDependencies": {
                "monaco-editor": ">= 0.25.0 < 1",
                "react": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0",
                "react-dom": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0"
            }
        },
        "node_modules/@nodelib/fs.scandir": {
            "version": "2.1.5",
            "resolved": "https://registry.npmjs.org/@nodelib/fs.scandir/-/fs.scandir-2.1.5.tgz",
            "integrity": "sha512-vq24Bq3ym5HEQm2NKCr3yXDwjc7vTsEThRDnkp2DK9p1uqLR+DHurm/NOTo0KG7HYHU7eppKZj3MyqYuMBf62g==",
            "dev": true,
            "dependencies": {
                "@nodelib/fs.stat": "2.0.5",
                "run-parallel": "^1.1.9"
            },
            "engines": {
                "node": ">= 8"
            }
        },
        "node_modules/@nodelib/fs.stat": {
            "version": "2.0.5",
            "resolved": "https://registry.npmjs.org/@nodelib/fs.stat/-/fs.stat-2.0.5.tgz",
            "integrity": "sha512-RkhPPp2zrqDAQA/2jNhnztcPAlv64XdhIp7a7454A5ovI7Bukxgt7MX7udwAu3zg1DcpPU0rz3VV1SeaqvY4+A==",
            "dev": true,
            "engines": {
                "node": ">= 8"
            }
        },
        "node_modules/@nodelib/fs.walk": {
            "version": "1.2.8",
            "resolved": "https://registry.npmjs.org/@nodelib/fs.walk/-/fs.walk-1.2.8.tgz",
            "integrity": "sha512-oGB+UxlgWcgQkgwo8GcEGwemoTFt3FIO9ababBmaGwXIoBKZ+GTy0pP185beGg7Llih/NSHSV2XAs1lnznocSg==",
            "dev": true,
            "dependencies": {
                "@nodelib/fs.scandir": "2.1.5",
                "fastq": "^1.6.0"
            },
            "engines": {
                "node": ">= 8"
            }
        },
        "node_modules/@pkgjs/parseargs": {
            "version": "0.11.0",
            "resolved": "https://registry.npmjs.org/@pkgjs/parseargs/-/parseargs-0.11.0.tgz",
            "integrity": "sha512-+1VkjdD0QBLPodGrJUeqarH8VAIvQODIbwh9XpP5Syisf7YoQgsJKPNFoqqLQlu+VQ/tVSshMR6loPMn8U+dPg==",
            "dev": true,
            "optional": true,
            "engines": {
                "node": ">=14"
            }
        },
        "node_modules/@reduxjs/toolkit": {
            "version": "2.10.1",
            "resolved": "https://registry.npmjs.org/@reduxjs/toolkit/-/toolkit-2.10.1.tgz",
            "integrity": "sha512-/U17EXQ9Do9Yx4DlNGU6eVNfZvFJfYpUtRRdLf19PbPjdWBxNlxGZXywQZ1p1Nz8nMkWplTI7iD/23m07nolDA==",
            "dependencies": {
                "@standard-schema/spec": "^1.0.0",
                "@standard-schema/utils": "^0.3.0",
                "immer": "^10.2.0",
                "redux": "^5.0.1",
                "redux-thunk": "^3.1.0",
                "reselect": "^5.1.0"
            },
            "peerDependencies": {
                "react": "^16.9.0 || ^17.0.0 || ^18 || ^19",
                "react-redux": "^7.2.1 || ^8.1.3 || ^9.0.0"
            },
            "peerDependenciesMeta": {
                "react": {
                    "optional": true
                },
                "react-redux": {
                    "optional": true
                }
            }
        },
        "node_modules/@rollup/rollup-android-arm-eabi": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-android-arm-eabi/-/rollup-android-arm-eabi-4.24.0.tgz",
            "integrity": "sha512-Q6HJd7Y6xdB48x8ZNVDOqsbh2uByBhgK8PiQgPhwkIw/HC/YX5Ghq2mQY5sRMZWHb3VsFkWooUVOZHKr7DmDIA==",
            "cpu": [
                "arm"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "android"
            ]
        },
        "node_modules/@rollup/rollup-android-arm64": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-android-arm64/-/rollup-android-arm64-4.24.0.tgz",
            "integrity": "sha512-ijLnS1qFId8xhKjT81uBHuuJp2lU4x2yxa4ctFPtG+MqEE6+C5f/+X/bStmxapgmwLwiL3ih122xv8kVARNAZA==",
            "cpu": [
                "arm64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "android"
            ]
        },
        "node_modules/@rollup/rollup-darwin-arm64": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-darwin-arm64/-/rollup-darwin-arm64-4.24.0.tgz",
            "integrity": "sha512-bIv+X9xeSs1XCk6DVvkO+S/z8/2AMt/2lMqdQbMrmVpgFvXlmde9mLcbQpztXm1tajC3raFDqegsH18HQPMYtA==",
            "cpu": [
                "arm64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "darwin"
            ]
        },
        "node_modules/@rollup/rollup-darwin-x64": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-darwin-x64/-/rollup-darwin-x64-4.24.0.tgz",
            "integrity": "sha512-X6/nOwoFN7RT2svEQWUsW/5C/fYMBe4fnLK9DQk4SX4mgVBiTA9h64kjUYPvGQ0F/9xwJ5U5UfTbl6BEjaQdBQ==",
            "cpu": [
                "x64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "darwin"
            ]
        },
        "node_modules/@rollup/rollup-linux-arm-gnueabihf": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm-gnueabihf/-/rollup-linux-arm-gnueabihf-4.24.0.tgz",
            "integrity": "sha512-0KXvIJQMOImLCVCz9uvvdPgfyWo93aHHp8ui3FrtOP57svqrF/roSSR5pjqL2hcMp0ljeGlU4q9o/rQaAQ3AYA==",
            "cpu": [
                "arm"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ]
        },
        "node_modules/@rollup/rollup-linux-arm-musleabihf": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm-musleabihf/-/rollup-linux-arm-musleabihf-4.24.0.tgz",
            "integrity": "sha512-it2BW6kKFVh8xk/BnHfakEeoLPv8STIISekpoF+nBgWM4d55CZKc7T4Dx1pEbTnYm/xEKMgy1MNtYuoA8RFIWw==",
            "cpu": [
                "arm"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ]
        },
        "node_modules/@rollup/rollup-linux-arm64-gnu": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm64-gnu/-/rollup-linux-arm64-gnu-4.24.0.tgz",
            "integrity": "sha512-i0xTLXjqap2eRfulFVlSnM5dEbTVque/3Pi4g2y7cxrs7+a9De42z4XxKLYJ7+OhE3IgxvfQM7vQc43bwTgPwA==",
            "cpu": [
                "arm64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ]
        },
        "node_modules/@rollup/rollup-linux-arm64-musl": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm64-musl/-/rollup-linux-arm64-musl-4.24.0.tgz",
            "integrity": "sha512-9E6MKUJhDuDh604Qco5yP/3qn3y7SLXYuiC0Rpr89aMScS2UAmK1wHP2b7KAa1nSjWJc/f/Lc0Wl1L47qjiyQw==",
            "cpu": [
                "arm64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ]
        },
        "node_modules/@rollup/rollup-linux-powerpc64le-gnu": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-powerpc64le-gnu/-/rollup-linux-powerpc64le-gnu-4.24.0.tgz",
            "integrity": "sha512-2XFFPJ2XMEiF5Zi2EBf4h73oR1V/lycirxZxHZNc93SqDN/IWhYYSYj8I9381ikUFXZrz2v7r2tOVk2NBwxrWw==",
            "cpu": [
                "ppc64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ]
        },
        "node_modules/@rollup/rollup-linux-riscv64-gnu": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-riscv64-gnu/-/rollup-linux-riscv64-gnu-4.24.0.tgz",
            "integrity": "sha512-M3Dg4hlwuntUCdzU7KjYqbbd+BLq3JMAOhCKdBE3TcMGMZbKkDdJ5ivNdehOssMCIokNHFOsv7DO4rlEOfyKpg==",
            "cpu": [
                "riscv64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ]
        },
        "node_modules/@rollup/rollup-linux-s390x-gnu": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-s390x-gnu/-/rollup-linux-s390x-gnu-4.24.0.tgz",
            "integrity": "sha512-mjBaoo4ocxJppTorZVKWFpy1bfFj9FeCMJqzlMQGjpNPY9JwQi7OuS1axzNIk0nMX6jSgy6ZURDZ2w0QW6D56g==",
            "cpu": [
                "s390x"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ]
        },
        "node_modules/@rollup/rollup-linux-x64-gnu": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-x64-gnu/-/rollup-linux-x64-gnu-4.24.0.tgz",
            "integrity": "sha512-ZXFk7M72R0YYFN5q13niV0B7G8/5dcQ9JDp8keJSfr3GoZeXEoMHP/HlvqROA3OMbMdfr19IjCeNAnPUG93b6A==",
            "cpu": [
                "x64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ]
        },
        "node_modules/@rollup/rollup-linux-x64-musl": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-x64-musl/-/rollup-linux-x64-musl-4.24.0.tgz",
            "integrity": "sha512-w1i+L7kAXZNdYl+vFvzSZy8Y1arS7vMgIy8wusXJzRrPyof5LAb02KGr1PD2EkRcl73kHulIID0M501lN+vobQ==",
            "cpu": [
                "x64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "linux"
            ]
        },
        "node_modules/@rollup/rollup-win32-arm64-msvc": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-arm64-msvc/-/rollup-win32-arm64-msvc-4.24.0.tgz",
            "integrity": "sha512-VXBrnPWgBpVDCVY6XF3LEW0pOU51KbaHhccHw6AS6vBWIC60eqsH19DAeeObl+g8nKAz04QFdl/Cefta0xQtUQ==",
            "cpu": [
                "arm64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "win32"
            ]
        },
        "node_modules/@rollup/rollup-win32-ia32-msvc": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-ia32-msvc/-/rollup-win32-ia32-msvc-4.24.0.tgz",
            "integrity": "sha512-xrNcGDU0OxVcPTH/8n/ShH4UevZxKIO6HJFK0e15XItZP2UcaiLFd5kiX7hJnqCbSztUF8Qot+JWBC/QXRPYWQ==",
            "cpu": [
                "ia32"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "win32"
            ]
        },
        "node_modules/@rollup/rollup-win32-x64-msvc": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-x64-msvc/-/rollup-win32-x64-msvc-4.24.0.tgz",
            "integrity": "sha512-fbMkAF7fufku0N2dE5TBXcNlg0pt0cJue4xBRE2Qc5Vqikxr4VCgKj/ht6SMdFcOacVA9rqF70APJ8RN/4vMJw==",
            "cpu": [
                "x64"
            ],
            "dev": true,
            "optional": true,
            "os": [
                "win32"
            ]
        },
        "node_modules/@standard-schema/spec": {
            "version": "1.0.0",
            "resolved": "https://registry.npmjs.org/@standard-schema/spec/-/spec-1.0.0.tgz",
            "integrity": "sha512-m2bOd0f2RT9k8QJx1JN85cZYyH1RqFBdlwtkSlf4tBDYLCiiZnv1fIIwacK6cqwXavOydf0NPToMQgpKq+dVlA=="
        },
        "node_modules/@standard-schema/utils": {
            "version": "0.3.0",
            "resolved": "https://registry.npmjs.org/@standard-schema/utils/-/utils-0.3.0.tgz",
            "integrity": "sha512-e7Mew686owMaPJVNNLs55PUvgz371nKgwsc4vxE49zsODpJEnxgxRo2y/OKrqueavXgZNMDVj3DdHFlaSAeU8g=="
        },
        "node_modules/@types/babel__core": {
            "version": "7.20.5",
            "resolved": "https://registry.npmjs.org/@types/babel__core/-/babel__core-7.20.5.tgz",
            "integrity": "sha512-qoQprZvz5wQFJwMDqeseRXWv3rqMvhgpbXFfVyWhbx9X47POIA6i/+dXefEmZKoAgOaTdaIgNSMqMIU61yRyzA==",
            "dev": true,
            "dependencies": {
                "@babel/parser": "^7.20.7",
                "@babel/types": "^7.20.7",
                "@types/babel__generator": "*",
                "@types/babel__template": "*",
                "@types/babel__traverse": "*"
            }
        },
        "node_modules/@types/babel__generator": {
            "version": "7.6.8",
            "resolved": "https://registry.npmjs.org/@types/babel__generator/-/babel__generator-7.6.8.tgz",
            "integrity": "sha512-ASsj+tpEDsEiFr1arWrlN6V3mdfjRMZt6LtK/Vp/kreFLnr5QH5+DhvD5nINYZXzwJvXeGq+05iUXcAzVrqWtw==",
            "dev": true,
            "dependencies": {
                "@babel/types": "^7.0.0"
            }
        },
        "node_modules/@types/babel__template": {
            "version": "7.4.4",
            "resolved": "https://registry.npmjs.org/@types/babel__template/-/babel__template-7.4.4.tgz",
            "integrity": "sha512-h/NUaSyG5EyxBIp8YRxo4RMe2/qQgvyowRwVMzhYhBCONbW8PUsg4lkFMrhgZhUe5z3L3MiLDuvyJ/CaPa2A8A==",
            "dev": true,
            "dependencies": {
                "@babel/parser": "^7.1.0",
                "@babel/types": "^7.0.0"
            }
        },
        "node_modules/@types/babel__traverse": {
            "version": "7.20.6",
            "resolved": "https://registry.npmjs.org/@types/babel__traverse/-/babel__traverse-7.20.6.tgz",
            "integrity": "sha512-r1bzfrm0tomOI8g1SzvCaQHo6Lcv6zu0EA+W2kHrt8dyrHQxGzBBL4kdkzIS+jBMV+EYcMAEAqXqYaLJq5rOZg==",
            "dev": true,
            "dependencies": {
                "@babel/types": "^7.20.7"
            }
        },
        "node_modules/@types/d3-array": {
            "version": "3.2.2",
            "resolved": "https://registry.npmjs.org/@types/d3-array/-/d3-array-3.2.2.tgz",
            "integrity": "sha512-hOLWVbm7uRza0BYXpIIW5pxfrKe0W+D5lrFiAEYR+pb6w3N2SwSMaJbXdUfSEv+dT4MfHBLtn5js0LAWaO6otw=="
        },
        "node_modules/@types/d3-color": {
            "version": "3.1.3",
            "resolved": "https://registry.npmjs.org/@types/d3-color/-/d3-color-3.1.3.tgz",
            "integrity": "sha512-iO90scth9WAbmgv7ogoq57O9YpKmFBbmoEoCHDB2xMBY0+/KVrqAaCDyCE16dUspeOvIxFFRI+0sEtqDqy2b4A=="
        },
        "node_modules/@types/d3-ease": {
            "version": "3.0.2",
            "resolved": "https://registry.npmjs.org/@types/d3-ease/-/d3-ease-3.0.2.tgz",
            "integrity": "sha512-NcV1JjO5oDzoK26oMzbILE6HW7uVXOHLQvHshBUW4UMdZGfiY6v5BeQwh9a9tCzv+CeefZQHJt5SRgK154RtiA=="
        },
        "node_modules/@types/d3-interpolate": {
            "version": "3.0.4",
            "resolved": "https://registry.npmjs.org/@types/d3-interpolate/-/d3-interpolate-3.0.4.tgz",
            "integrity": "sha512-mgLPETlrpVV1YRJIglr4Ez47g7Yxjl1lj7YKsiMCb27VJH9W8NVM6Bb9d8kkpG/uAQS5AmbA48q2IAolKKo1MA==",
            "dependencies": {
                "@types/d3-color": "*"
            }
        },
        "node_modules/@types/d3-path": {
            "version": "3.1.1",
            "resolved": "https://registry.npmjs.org/@types/d3-path/-/d3-path-3.1.1.tgz",
            "integrity": "sha512-VMZBYyQvbGmWyWVea0EHs/BwLgxc+MKi1zLDCONksozI4YJMcTt8ZEuIR4Sb1MMTE8MMW49v0IwI5+b7RmfWlg=="
        },
        "node_modules/@types/d3-scale": {
            "version": "4.0.9",
            "resolved": "https://registry.npmjs.org/@types/d3-scale/-/d3-scale-4.0.9.tgz",
            "integrity": "sha512-dLmtwB8zkAeO/juAMfnV+sItKjlsw2lKdZVVy6LRr0cBmegxSABiLEpGVmSJJ8O08i4+sGR6qQtb6WtuwJdvVw==",
            "dependencies": {
                "@types/d3-time": "*"
            }
        },
        "node_modules/@types/d3-shape": {
            "version": "3.1.7",
            "resolved": "https://registry.npmjs.org/@types/d3-shape/-/d3-shape-3.1.7.tgz",
            "integrity": "sha512-VLvUQ33C+3J+8p+Daf+nYSOsjB4GXp19/S/aGo60m9h1v6XaxjiT82lKVWJCfzhtuZ3yD7i/TPeC/fuKLLOSmg==",
            "dependencies": {
                "@types/d3-path": "*"
            }
        },
        "node_modules/@types/d3-time": {
            "version": "3.0.4",
            "resolved": "https://registry.npmjs.org/@types/d3-time/-/d3-time-3.0.4.tgz",
            "integrity": "sha512-yuzZug1nkAAaBlBBikKZTgzCeA+k1uy4ZFwWANOfKw5z5LRhV0gNA7gNkKm7HoK+HRN0wX3EkxGk0fpbWhmB7g=="
        },
        "node_modules/@types/d3-timer": {
            "version": "3.0.2",
            "resolved": "https://registry.npmjs.org/@types/d3-timer/-/d3-timer-3.0.2.tgz",
            "integrity": "sha512-Ps3T8E8dZDam6fUyNiMkekK3XUsaUEik+idO9/YjPtfj2qruF8tFBXS7XhtE4iIXBLxhmLjP3SXpLhVf21I9Lw=="
        },
        "node_modules/@types/estree": {
            "version": "1.0.6",
            "resolved": "https://registry.npmjs.org/@types/estree/-/estree-1.0.6.tgz",
            "integrity": "sha512-AYnb1nQyY49te+VRAVgmzfcgjYS91mY5P0TKUDCLEM+gNnA+3T6rWITXRLYCpahpqSQbN5cE+gHpnPyXjHWxcw==",
            "dev": true
        },
        "node_modules/@types/history": {
            "version": "4.7.11",
            "resolved": "https://registry.npmjs.org/@types/history/-/history-4.7.11.tgz",
            "integrity": "sha512-qjDJRrmvBMiTx+jyLxvLfJU7UznFuokDv4f3WRuriHKERccVpFU+8XMQUAbDzoiJCsmexxRExQeMwwCdamSKDA=="
        },
        "node_modules/@types/json-schema": {
            "version": "7.0.15",
            "resolved": "https://registry.npmjs.org/@types/json-schema/-/json-schema-7.0.15.tgz",
            "integrity": "sha512-5+fP8P8MFNC+AyZCDxrB2pkZFPGzqQWUzpSeuuVLvm8VMcorNYavBqoFcxK8bQz4Qsbn4oUEEem4wDLfcysGHA==",
            "dev": true
        },
        "node_modules/@types/prop-types": {
            "version": "15.7.13",
            "resolved": "https://registry.npmjs.org/@types/prop-types/-/prop-types-15.7.13.tgz",
            "integrity": "sha512-hCZTSvwbzWGvhqxp/RqVqwU999pBf2vp7hzIjiYOsl8wqOmUxkQ6ddw1cV3l8811+kdUFus/q4d1Y3E3SyEifA=="
        },
        "node_modules/@types/react": {
            "version": "18.3.11",
            "resolved": "https://registry.npmjs.org/@types/react/-/react-18.3.11.tgz",
            "integrity": "sha512-r6QZ069rFTjrEYgFdOck1gK7FLVsgJE7tTz0pQBczlBNUhBNk0MQH4UbnFSwjpQLMkLzgqvBBa+qGpLje16eTQ==",
            "dependencies": {
                "@types/prop-types": "*",
                "csstype": "^3.0.2"
            }
        },
        "node_modules/@types/react-dom": {
            "version": "18.3.0",
            "resolved": "https://registry.npmjs.org/@types/react-dom/-/react-dom-18.3.0.tgz",
            "integrity": "sha512-EhwApuTmMBmXuFOikhQLIBUn6uFg81SwLMOAUgodJF14SOBOCMdU04gDoYi0WOJJHD144TL32z4yDqCW3dnkQg==",
            "dev": true,
            "dependencies": {
                "@types/react": "*"
            }
        },
        "node_modules/@types/react-router": {
            "version": "5.1.20",
            "resolved": "https://registry.npmjs.org/@types/react-router/-/react-router-5.1.20.tgz",
            "integrity": "sha512-jGjmu/ZqS7FjSH6owMcD5qpq19+1RS9DeVRqfl1FeBMxTDQAGwlMWOcs52NDoXaNKyG3d1cYQFMs9rCrb88o9Q==",
            "dependencies": {
                "@types/history": "^4.7.11",
                "@types/react": "*"
            }
        },
        "node_modules/@types/react-router-dom": {
            "version": "5.3.3",
            "resolved": "https://registry.npmjs.org/@types/react-router-dom/-/react-router-dom-5.3.3.tgz",
            "integrity": "sha512-kpqnYK4wcdm5UaWI3fLcELopqLrHgLqNsdpHauzlQktfkHL3npOSwtj1Uz9oKBAzs7lFtVkV8j83voAz2D8fhw==",
            "dependencies": {
                "@types/history": "^4.7.11",
                "@types/react": "*",
                "@types/react-router": "*"
            }
        },
        "node_modules/@types/trusted-types": {
            "version": "2.0.7",
            "resolved": "https://registry.npmjs.org/@types/trusted-types/-/trusted-types-2.0.7.tgz",
            "integrity": "sha512-ScaPdn1dQczgbl0QFTeTOmVHFULt394XJgOQNoyVhZ6r2vLnMLJfBPd53SB52T/3G36VI1/g2MZaX0cwDuXsfw==",
            "optional": true,
            "peer": true
        },
        "node_modules/@types/use-sync-external-store": {
            "version": "0.0.6",
            "resolved": "https://registry.npmjs.org/@types/use-sync-external-store/-/use-sync-external-store-0.0.6.tgz",
            "integrity": "sha512-zFDAD+tlpf2r4asuHEj0XH6pY6i0g5NeAHPn+15wk3BV6JA69eERFXC1gyGThDkVa1zCyKr5jox1+2LbV/AMLg=="
        },
        "node_modules/@typescript-eslint/eslint-plugin": {
            "version": "8.8.1",
            "resolved": "https://registry.npmjs.org/@typescript-eslint/eslint-plugin/-/eslint-plugin-8.8.1.tgz",
            "integrity": "sha512-xfvdgA8AP/vxHgtgU310+WBnLB4uJQ9XdyP17RebG26rLtDrQJV3ZYrcopX91GrHmMoH8bdSwMRh2a//TiJ1jQ==",
            "dev": true,
            "dependencies": {
                "@eslint-community/regexpp": "^4.10.0",
                "@typescript-eslint/scope-manager": "8.8.1",
                "@typescript-eslint/type-utils": "8.8.1",
                "@typescript-eslint/utils": "8.8.1",
                "@typescript-eslint/visitor-keys": "8.8.1",
                "graphemer": "^1.4.0",
                "ignore": "^5.3.1",
                "natural-compare": "^1.4.0",
                "ts-api-utils": "^1.3.0"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "type": "opencollective",
                "url": "https://opencollective.com/typescript-eslint"
            },
            "peerDependencies": {
                "@typescript-eslint/parser": "^8.0.0 || ^8.0.0-alpha.0",
                "eslint": "^8.57.0 || ^9.0.0"
            },
            "peerDependenciesMeta": {
                "typescript": {
                    "optional": true
                }
            }
        },
        "node_modules/@typescript-eslint/parser": {
            "version": "8.8.1",
            "resolved": "https://registry.npmjs.org/@typescript-eslint/parser/-/parser-8.8.1.tgz",
            "integrity": "sha512-hQUVn2Lij2NAxVFEdvIGxT9gP1tq2yM83m+by3whWFsWC+1y8pxxxHUFE1UqDu2VsGi2i6RLcv4QvouM84U+ow==",
            "dev": true,
            "dependencies": {
                "@typescript-eslint/scope-manager": "8.8.1",
                "@typescript-eslint/types": "8.8.1",
                "@typescript-eslint/typescript-estree": "8.8.1",
                "@typescript-eslint/visitor-keys": "8.8.1",
                "debug": "^4.3.4"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "type": "opencollective",
                "url": "https://opencollective.com/typescript-eslint"
            },
            "peerDependencies": {
                "eslint": "^8.57.0 || ^9.0.0"
            },
            "peerDependenciesMeta": {
                "typescript": {
                    "optional": true
                }
            }
        },
        "node_modules/@typescript-eslint/scope-manager": {
            "version": "8.8.1",
            "resolved": "https://registry.npmjs.org/@typescript-eslint/scope-manager/-/scope-manager-8.8.1.tgz",
            "integrity": "sha512-X4JdU+66Mazev/J0gfXlcC/dV6JI37h+93W9BRYXrSn0hrE64IoWgVkO9MSJgEzoWkxONgaQpICWg8vAN74wlA==",
            "dev": true,
            "dependencies": {
                "@typescript-eslint/types": "8.8.1",
                "@typescript-eslint/visitor-keys": "8.8.1"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "type": "opencollective",
                "url": "https://opencollective.com/typescript-eslint"
            }
        },
        "node_modules/@typescript-eslint/type-utils": {
            "version": "8.8.1",
            "resolved": "https://registry.npmjs.org/@typescript-eslint/type-utils/-/type-utils-8.8.1.tgz",
            "integrity": "sha512-qSVnpcbLP8CALORf0za+vjLYj1Wp8HSoiI8zYU5tHxRVj30702Z1Yw4cLwfNKhTPWp5+P+k1pjmD5Zd1nhxiZA==",
            "dev": true,
            "dependencies": {
                "@typescript-eslint/typescript-estree": "8.8.1",
                "@typescript-eslint/utils": "8.8.1",
                "debug": "^4.3.4",
                "ts-api-utils": "^1.3.0"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "type": "opencollective",
                "url": "https://opencollective.com/typescript-eslint"
            },
            "peerDependenciesMeta": {
                "typescript": {
                    "optional": true
                }
            }
        },
        "node_modules/@typescript-eslint/types": {
            "version": "8.8.1",
            "resolved": "https://registry.npmjs.org/@typescript-eslint/types/-/types-8.8.1.tgz",
            "integrity": "sha512-WCcTP4SDXzMd23N27u66zTKMuEevH4uzU8C9jf0RO4E04yVHgQgW+r+TeVTNnO1KIfrL8ebgVVYYMMO3+jC55Q==",
            "dev": true,
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "type": "opencollective",
                "url": "https://opencollective.com/typescript-eslint"
            }
        },
        "node_modules/@typescript-eslint/typescript-estree": {
            "version": "8.8.1",
            "resolved": "https://registry.npmjs.org/@typescript-eslint/typescript-estree/-/typescript-estree-8.8.1.tgz",
            "integrity": "sha512-A5d1R9p+X+1js4JogdNilDuuq+EHZdsH9MjTVxXOdVFfTJXunKJR/v+fNNyO4TnoOn5HqobzfRlc70NC6HTcdg==",
            "dev": true,
            "dependencies": {
                "@typescript-eslint/types": "8.8.1",
                "@typescript-eslint/visitor-keys": "8.8.1",
                "debug": "^4.3.4",
                "fast-glob": "^3.3.2",
                "is-glob": "^4.0.3",
                "minimatch": "^9.0.4",
                "semver": "^7.6.0",
                "ts-api-utils": "^1.3.0"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "type": "opencollective",
                "url": "https://opencollective.com/typescript-eslint"
            },
            "peerDependenciesMeta": {
                "typescript": {
                    "optional": true
                }
            }
        },
        "node_modules/@typescript-eslint/typescript-estree/node_modules/brace-expansion": {
            "version": "2.0.1",
            "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-2.0.1.tgz",
            "integrity": "sha512-XnAIvQ8eM+kC6aULx6wuQiwVsnzsi9d3WxzV3FpWTGA19F621kwdbsAcFKXgKUHZWsy+mY6iL1sHTxWEFCytDA==",
            "dev": true,
            "dependencies": {
                "balanced-match": "^1.0.0"
            }
        },
        "node_modules/@typescript-eslint/typescript-estree/node_modules/minimatch": {
            "version": "9.0.5",
            "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-9.0.5.tgz",
            "integrity": "sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==",
            "dev": true,
            "dependencies": {
                "brace-expansion": "^2.0.1"
            },
            "engines": {
                "node": ">=16 || 14 >=14.17"
            },
            "funding": {
                "url": "https://github.com/sponsors/isaacs"
            }
        },
        "node_modules/@typescript-eslint/typescript-estree/node_modules/semver": {
            "version": "7.6.3",
            "resolved": "https://registry.npmjs.org/semver/-/semver-7.6.3.tgz",
            "integrity": "sha512-oVekP1cKtI+CTDvHWYFUcMtsK/00wmAEfyqKfNdARm8u1wNVhSgaX7A8d4UuIlUI5e84iEwOhs7ZPYRmzU9U6A==",
            "dev": true,
            "bin": {
                "semver": "bin/semver.js"
            },
            "engines": {
                "node": ">=10"
            }
        },
        "node_modules/@typescript-eslint/utils": {
            "version": "8.8.1",
            "resolved": "https://registry.npmjs.org/@typescript-eslint/utils/-/utils-8.8.1.tgz",
            "integrity": "sha512-/QkNJDbV0bdL7H7d0/y0qBbV2HTtf0TIyjSDTvvmQEzeVx8jEImEbLuOA4EsvE8gIgqMitns0ifb5uQhMj8d9w==",
            "dev": true,
            "dependencies": {
                "@eslint-community/eslint-utils": "^4.4.0",
                "@typescript-eslint/scope-manager": "8.8.1",
                "@typescript-eslint/types": "8.8.1",
                "@typescript-eslint/typescript-estree": "8.8.1"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "type": "opencollective",
                "url": "https://opencollective.com/typescript-eslint"
            },
            "peerDependencies": {
                "eslint": "^8.57.0 || ^9.0.0"
            }
        },
        "node_modules/@typescript-eslint/visitor-keys": {
            "version": "8.8.1",
            "resolved": "https://registry.npmjs.org/@typescript-eslint/visitor-keys/-/visitor-keys-8.8.1.tgz",
            "integrity": "sha512-0/TdC3aeRAsW7MDvYRwEc1Uwm0TIBfzjPFgg60UU2Haj5qsCs9cc3zNgY71edqE3LbWfF/WoZQd3lJoDXFQpag==",
            "dev": true,
            "dependencies": {
                "@typescript-eslint/types": "8.8.1",
                "eslint-visitor-keys": "^3.4.3"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "type": "opencollective",
                "url": "https://opencollective.com/typescript-eslint"
            }
        },
        "node_modules/@typescript-eslint/visitor-keys/node_modules/eslint-visitor-keys": {
            "version": "3.4.3",
            "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-3.4.3.tgz",
            "integrity": "sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==",
            "dev": true,
            "engines": {
                "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
            },
            "funding": {
                "url": "https://opencollective.com/eslint"
            }
        },
        "node_modules/@vitejs/plugin-react": {
            "version": "4.3.2",
            "resolved": "https://registry.npmjs.org/@vitejs/plugin-react/-/plugin-react-4.3.2.tgz",
            "integrity": "sha512-hieu+o05v4glEBucTcKMK3dlES0OeJlD9YVOAPraVMOInBCwzumaIFiUjr4bHK7NPgnAHgiskUoceKercrN8vg==",
            "dev": true,
            "dependencies": {
                "@babel/core": "^7.25.2",
                "@babel/plugin-transform-react-jsx-self": "^7.24.7",
                "@babel/plugin-transform-react-jsx-source": "^7.24.7",
                "@types/babel__core": "^7.20.5",
                "react-refresh": "^0.14.2"
            },
            "engines": {
                "node": "^14.18.0 || >=16.0.0"
            },
            "peerDependencies": {
                "vite": "^4.2.0 || ^5.0.0"
            }
        },
        "node_modules/@xterm/addon-fit": {
            "version": "0.10.0",
            "resolved": "https://registry.npmjs.org/@xterm/addon-fit/-/addon-fit-0.10.0.tgz",
            "integrity": "sha512-UFYkDm4HUahf2lnEyHvio51TNGiLK66mqP2JoATy7hRZeXaGMRDr00JiSF7m63vR5WKATF605yEggJKsw0JpMQ==",
            "peerDependencies": {
                "@xterm/xterm": "^5.0.0"
            }
        },
        "node_modules/@xterm/addon-web-links": {
            "version": "0.11.0",
            "resolved": "https://registry.npmjs.org/@xterm/addon-web-links/-/addon-web-links-0.11.0.tgz",
            "integrity": "sha512-nIHQ38pQI+a5kXnRaTgwqSHnX7KE6+4SVoceompgHL26unAxdfP6IPqUTSYPQgSwM56hsElfoNrrW5V7BUED/Q==",
            "peerDependencies": {
                "@xterm/xterm": "^5.0.0"
            }
        },
        "node_modules/@xterm/xterm": {
            "version": "5.5.0",
            "resolved": "https://registry.npmjs.org/@xterm/xterm/-/xterm-5.5.0.tgz",
            "integrity": "sha512-hqJHYaQb5OptNunnyAnkHyM8aCjZ1MEIDTQu1iIbbTD/xops91NB5yq1ZK/dC2JDbVWtF23zUtl9JE2NqwT87A=="
        },
        "node_modules/acorn": {
            "version": "8.12.1",
            "resolved": "https://registry.npmjs.org/acorn/-/acorn-8.12.1.tgz",
            "integrity": "sha512-tcpGyI9zbizT9JbV6oYE477V6mTlXvvi0T0G3SNIYE2apm/G5huBa1+K89VGeovbg+jycCrfhl3ADxErOuO6Jg==",
            "dev": true,
            "bin": {
                "acorn": "bin/acorn"
            },
            "engines": {
                "node": ">=0.4.0"
            }
        },
        "node_modules/acorn-jsx": {
            "version": "5.3.2",
            "resolved": "https://registry.npmjs.org/acorn-jsx/-/acorn-jsx-5.3.2.tgz",
            "integrity": "sha512-rq9s+JNhf0IChjtDXxllJ7g41oZk5SlXtp0LHwyA5cejwn7vKmKp4pPri6YEePv2PU65sAsegbXtIinmDFDXgQ==",
            "dev": true,
            "peerDependencies": {
                "acorn": "^6.0.0 || ^7.0.0 || ^8.0.0"
            }
        },
        "node_modules/ajv": {
            "version": "6.12.6",
            "resolved": "https://registry.npmjs.org/ajv/-/ajv-6.12.6.tgz",
            "integrity": "sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g==",
            "dev": true,
            "dependencies": {
                "fast-deep-equal": "^3.1.1",
                "fast-json-stable-stringify": "^2.0.0",
                "json-schema-traverse": "^0.4.1",
                "uri-js": "^4.2.2"
            },
            "funding": {
                "type": "github",
                "url": "https://github.com/sponsors/epoberezkin"
            }
        },
        "node_modules/ansi-regex": {
            "version": "6.1.0",
            "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-6.1.0.tgz",
            "integrity": "sha512-7HSX4QQb4CspciLpVFwyRe79O3xsIZDDLER21kERQ71oaPodF8jL725AgJMFAYbooIqolJoRLuM81SpeUkpkvA==",
            "dev": true,
            "engines": {
                "node": ">=12"
            },
            "funding": {
                "url": "https://github.com/chalk/ansi-regex?sponsor=1"
            }
        },
        "node_modules/ansi-styles": {
            "version": "3.2.1",
            "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-3.2.1.tgz",
            "integrity": "sha512-VT0ZI6kZRdTh8YyJw3SMbYm/u+NqfsAxEpWO0Pf9sq8/e94WxxOpPKx9FR1FlyCtOVDNOQ+8ntlqFxiRc+r5qA==",
            "dev": true,
            "dependencies": {
                "color-convert": "^1.9.0"
            },
            "engines": {
                "node": ">=4"
            }
        },
        "node_modules/any-promise": {
            "version": "1.3.0",
            "resolved": "https://registry.npmjs.org/any-promise/-/any-promise-1.3.0.tgz",
            "integrity": "sha512-7UvmKalWRt1wgjL1RrGxoSJW/0QZFIegpeGvZG9kjp8vrRu55XTHbwnqq2GpXm9uLbcuhxm3IqX9OB4MZR1b2A==",
            "dev": true
        },
        "node_modules/anymatch": {
            "version": "3.1.3",
            "resolved": "https://registry.npmjs.org/anymatch/-/anymatch-3.1.3.tgz",
            "integrity": "sha512-KMReFUr0B4t+D+OBkjR3KYqvocp2XaSzO55UcB6mgQMd3KbcE+mWTyvVV7D/zsdEbNnV6acZUutkiHQXvTr1Rw==",
            "dev": true,
            "dependencies": {
                "normalize-path": "^3.0.0",
                "picomatch": "^2.0.4"
            },
            "engines": {
                "node": ">= 8"
            }
        },
        "node_modules/arg": {
            "version": "5.0.2",
            "resolved": "https://registry.npmjs.org/arg/-/arg-5.0.2.tgz",
            "integrity": "sha512-PYjyFOLKQ9y57JvQ6QLo8dAgNqswh8M1RMJYdQduT6xbWSgK36P/Z/v+p888pM69jMMfS8Xd8F6I1kQ/I9HUGg==",
            "dev": true
        },
        "node_modules/argparse": {
            "version": "2.0.1",
            "resolved": "https://registry.npmjs.org/argparse/-/argparse-2.0.1.tgz",
            "integrity": "sha512-8+9WqebbFzpX9OR+Wa6O29asIogeRMzcGtAINdpMHHyAg10f05aSFVBbcEqGf/PXw1EjAZ+q2/bEBg3DvurK3Q==",
            "dev": true
        },
        "node_modules/autoprefixer": {
            "version": "10.4.20",
            "resolved": "https://registry.npmjs.org/autoprefixer/-/autoprefixer-10.4.20.tgz",
            "integrity": "sha512-XY25y5xSv/wEoqzDyXXME4AFfkZI0P23z6Fs3YgymDnKJkCGOnkL0iTxCa85UTqaSgfcqyf3UA6+c7wUvx/16g==",
            "dev": true,
            "funding": [
                {
                    "type": "opencollective",
                    "url": "https://opencollective.com/postcss/"
                },
                {
                    "type": "tidelift",
                    "url": "https://tidelift.com/funding/github/npm/autoprefixer"
                },
                {
                    "type": "github",
                    "url": "https://github.com/sponsors/ai"
                }
            ],
            "dependencies": {
                "browserslist": "^4.23.3",
                "caniuse-lite": "^1.0.30001646",
                "fraction.js": "^4.3.7",
                "normalize-range": "^0.1.2",
                "picocolors": "^1.0.1",
                "postcss-value-parser": "^4.2.0"
            },
            "bin": {
                "autoprefixer": "bin/autoprefixer"
            },
            "engines": {
                "node": "^10 || ^12 || >=14"
            },
            "peerDependencies": {
                "postcss": "^8.1.0"
            }
        },
        "node_modules/balanced-match": {
            "version": "1.0.2",
            "resolved": "https://registry.npmjs.org/balanced-match/-/balanced-match-1.0.2.tgz",
            "integrity": "sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==",
            "dev": true
        },
        "node_modules/binary-extensions": {
            "version": "2.3.0",
            "resolved": "https://registry.npmjs.org/binary-extensions/-/binary-extensions-2.3.0.tgz",
            "integrity": "sha512-Ceh+7ox5qe7LJuLHoY0feh3pHuUDHAcRUeyL2VYghZwfpkNIy/+8Ocg0a3UuSoYzavmylwuLWQOf3hl0jjMMIw==",
            "dev": true,
            "engines": {
                "node": ">=8"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        },
        "node_modules/brace-expansion": {
            "version": "1.1.11",
            "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.11.tgz",
            "integrity": "sha512-iCuPHDFgrHX7H2vEI/5xpz07zSHB00TpugqhmYtVmMO6518mCuRMoOYFldEBl0g187ufozdaHgWKcYFb61qGiA==",
            "dev": true,
            "dependencies": {
                "balanced-match": "^1.0.0",
                "concat-map": "0.0.1"
            }
        },
        "node_modules/braces": {
            "version": "3.0.3",
            "resolved": "https://registry.npmjs.org/braces/-/braces-3.0.3.tgz",
            "integrity": "sha512-yQbXgO/OSZVD2IsiLlro+7Hf6Q18EJrKSEsdoMzKePKXct3gvD8oLcOQdIzGupr5Fj+EDe8gO/lxc1BzfMpxvA==",
            "dev": true,
            "dependencies": {
                "fill-range": "^7.1.1"
            },
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/browserslist": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/browserslist/-/browserslist-4.24.0.tgz",
            "integrity": "sha512-Rmb62sR1Zpjql25eSanFGEhAxcFwfA1K0GuQcLoaJBAcENegrQut3hYdhXFF1obQfiDyqIW/cLM5HSJ/9k884A==",
            "dev": true,
            "funding": [
                {
                    "type": "opencollective",
                    "url": "https://opencollective.com/browserslist"
                },
                {
                    "type": "tidelift",
                    "url": "https://tidelift.com/funding/github/npm/browserslist"
                },
                {
                    "type": "github",
                    "url": "https://github.com/sponsors/ai"
                }
            ],
            "dependencies": {
                "caniuse-lite": "^1.0.30001663",
                "electron-to-chromium": "^1.5.28",
                "node-releases": "^2.0.18",
                "update-browserslist-db": "^1.1.0"
            },
            "bin": {
                "browserslist": "cli.js"
            },
            "engines": {
                "node": "^6 || ^7 || ^8 || ^9 || ^10 || ^11 || ^12 || >=13.7"
            }
        },
        "node_modules/callsites": {
            "version": "3.1.0",
            "resolved": "https://registry.npmjs.org/callsites/-/callsites-3.1.0.tgz",
            "integrity": "sha512-P8BjAsXvZS+VIDUI11hHCQEv74YT67YUi5JJFNWIqL235sBmjX4+qx9Muvls5ivyNENctx46xQLQ3aTuE7ssaQ==",
            "dev": true,
            "engines": {
                "node": ">=6"
            }
        },
        "node_modules/camelcase-css": {
            "version": "2.0.1",
            "resolved": "https://registry.npmjs.org/camelcase-css/-/camelcase-css-2.0.1.tgz",
            "integrity": "sha512-QOSvevhslijgYwRx6Rv7zKdMF8lbRmx+uQGx2+vDc+KI/eBnsy9kit5aj23AgGu3pa4t9AgwbnXWqS+iOY+2aA==",
            "dev": true,
            "engines": {
                "node": ">= 6"
            }
        },
        "node_modules/caniuse-lite": {
            "version": "1.0.30001667",
            "resolved": "https://registry.npmjs.org/caniuse-lite/-/caniuse-lite-1.0.30001667.tgz",
            "integrity": "sha512-7LTwJjcRkzKFmtqGsibMeuXmvFDfZq/nzIjnmgCGzKKRVzjD72selLDK1oPF/Oxzmt4fNcPvTDvGqSDG4tCALw==",
            "dev": true,
            "funding": [
                {
                    "type": "opencollective",
                    "url": "https://opencollective.com/browserslist"
                },
                {
                    "type": "tidelift",
                    "url": "https://tidelift.com/funding/github/npm/caniuse-lite"
                },
                {
                    "type": "github",
                    "url": "https://github.com/sponsors/ai"
                }
            ]
        },
        "node_modules/chalk": {
            "version": "2.4.2",
            "resolved": "https://registry.npmjs.org/chalk/-/chalk-2.4.2.tgz",
            "integrity": "sha512-Mti+f9lpJNcwF4tWV8/OrTTtF1gZi+f8FqlyAdouralcFWFQWF2+NgCHShjkCb+IFBLq9buZwE1xckQU4peSuQ==",
            "dev": true,
            "dependencies": {
                "ansi-styles": "^3.2.1",
                "escape-string-regexp": "^1.0.5",
                "supports-color": "^5.3.0"
            },
            "engines": {
                "node": ">=4"
            }
        },
        "node_modules/chokidar": {
            "version": "3.6.0",
            "resolved": "https://registry.npmjs.org/chokidar/-/chokidar-3.6.0.tgz",
            "integrity": "sha512-7VT13fmjotKpGipCW9JEQAusEPE+Ei8nl6/g4FBAmIm0GOOLMua9NDDo/DWp0ZAxCr3cPq5ZpBqmPAQgDda2Pw==",
            "dev": true,
            "dependencies": {
                "anymatch": "~3.1.2",
                "braces": "~3.0.2",
                "glob-parent": "~5.1.2",
                "is-binary-path": "~2.1.0",
                "is-glob": "~4.0.1",
                "normalize-path": "~3.0.0",
                "readdirp": "~3.6.0"
            },
            "engines": {
                "node": ">= 8.10.0"
            },
            "funding": {
                "url": "https://paulmillr.com/funding/"
            },
            "optionalDependencies": {
                "fsevents": "~2.3.2"
            }
        },
        "node_modules/chokidar/node_modules/glob-parent": {
            "version": "5.1.2",
            "resolved": "https://registry.npmjs.org/glob-parent/-/glob-parent-5.1.2.tgz",
            "integrity": "sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==",
            "dev": true,
            "dependencies": {
                "is-glob": "^4.0.1"
            },
            "engines": {
                "node": ">= 6"
            }
        },
        "node_modules/clsx": {
            "version": "2.1.1",
            "resolved": "https://registry.npmjs.org/clsx/-/clsx-2.1.1.tgz",
            "integrity": "sha512-eYm0QWBtUrBWZWG0d386OGAw16Z995PiOVo2B7bjWSbHedGl5e0ZWaq65kOGgUSNesEIDkB9ISbTg/JK9dhCZA==",
            "engines": {
                "node": ">=6"
            }
        },
        "node_modules/color-convert": {
            "version": "1.9.3",
            "resolved": "https://registry.npmjs.org/color-convert/-/color-convert-1.9.3.tgz",
            "integrity": "sha512-QfAUtd+vFdAtFQcC8CCyYt1fYWxSqAiK2cSD6zDB8N3cpsEBAvRxp9zOGg6G/SHHJYAT88/az/IuDGALsNVbGg==",
            "dev": true,
            "dependencies": {
                "color-name": "1.1.3"
            }
        },
        "node_modules/color-name": {
            "version": "1.1.3",
            "resolved": "https://registry.npmjs.org/color-name/-/color-name-1.1.3.tgz",
            "integrity": "sha512-72fSenhMw2HZMTVHeCA9KCmpEIbzWiQsjN+BHcBbS9vr1mtt+vJjPdksIBNUmKAW8TFUDPJK5SUU3QhE9NEXDw==",
            "dev": true
        },
        "node_modules/commander": {
            "version": "4.1.1",
            "resolved": "https://registry.npmjs.org/commander/-/commander-4.1.1.tgz",
            "integrity": "sha512-NOKm8xhkzAjzFx8B2v5OAHT+u5pRQc2UCa2Vq9jYL/31o2wi9mxBA7LIFs3sV5VSC49z6pEhfbMULvShKj26WA==",
            "dev": true,
            "engines": {
                "node": ">= 6"
            }
        },
        "node_modules/concat-map": {
            "version": "0.0.1",
            "resolved": "https://registry.npmjs.org/concat-map/-/concat-map-0.0.1.tgz",
            "integrity": "sha512-/Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg==",
            "dev": true
        },
        "node_modules/convert-source-map": {
            "version": "2.0.0",
            "resolved": "https://registry.npmjs.org/convert-source-map/-/convert-source-map-2.0.0.tgz",
            "integrity": "sha512-Kvp459HrV2FEJ1CAsi1Ku+MY3kasH19TFykTz2xWmMeq6bk2NU3XXvfJ+Q61m0xktWwt+1HSYf3JZsTms3aRJg==",
            "dev": true
        },
        "node_modules/cookie": {
            "version": "1.0.2",
            "resolved": "https://registry.npmjs.org/cookie/-/cookie-1.0.2.tgz",
            "integrity": "sha512-9Kr/j4O16ISv8zBBhJoi4bXOYNTkFLOqSL3UDB0njXxCXNezjeyVrJyGOWtgfs/q2km1gwBcfH8q1yEGoMYunA==",
            "engines": {
                "node": ">=18"
            }
        },
        "node_modules/cross-spawn": {
            "version": "7.0.3",
            "resolved": "https://registry.npmjs.org/cross-spawn/-/cross-spawn-7.0.3.tgz",
            "integrity": "sha512-iRDPJKUPVEND7dHPO8rkbOnPpyDygcDFtWjpeWNCgy8WP2rXcxXL8TskReQl6OrB2G7+UJrags1q15Fudc7G6w==",
            "dev": true,
            "dependencies": {
                "path-key": "^3.1.0",
                "shebang-command": "^2.0.0",
                "which": "^2.0.1"
            },
            "engines": {
                "node": ">= 8"
            }
        },
        "node_modules/cssesc": {
            "version": "3.0.0",
            "resolved": "https://registry.npmjs.org/cssesc/-/cssesc-3.0.0.tgz",
            "integrity": "sha512-/Tb/JcjK111nNScGob5MNtsntNM1aCNUDipB/TkwZFhyDrrE47SOx/18wF2bbjgc3ZzCSKW1T5nt5EbFoAz/Vg==",
            "dev": true,
            "bin": {
                "cssesc": "bin/cssesc"
            },
            "engines": {
                "node": ">=4"
            }
        },
        "node_modules/csstype": {
            "version": "3.1.3",
            "resolved": "https://registry.npmjs.org/csstype/-/csstype-3.1.3.tgz",
            "integrity": "sha512-M1uQkMl8rQK/szD0LNhtqxIPLpimGm8sOBwU7lLnCpSbTyY3yeU1Vc7l4KT5zT4s/yOxHH5O7tIuuLOCnLADRw=="
        },
        "node_modules/d3-array": {
            "version": "3.2.4",
            "resolved": "https://registry.npmjs.org/d3-array/-/d3-array-3.2.4.tgz",
            "integrity": "sha512-tdQAmyA18i4J7wprpYq8ClcxZy3SC31QMeByyCFyRt7BVHdREQZ5lpzoe5mFEYZUWe+oq8HBvk9JjpibyEV4Jg==",
            "dependencies": {
                "internmap": "1 - 2"
            },
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/d3-color": {
            "version": "3.1.0",
            "resolved": "https://registry.npmjs.org/d3-color/-/d3-color-3.1.0.tgz",
            "integrity": "sha512-zg/chbXyeBtMQ1LbD/WSoW2DpC3I0mpmPdW+ynRTj/x2DAWYrIY7qeZIHidozwV24m4iavr15lNwIwLxRmOxhA==",
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/d3-ease": {
            "version": "3.0.1",
            "resolved": "https://registry.npmjs.org/d3-ease/-/d3-ease-3.0.1.tgz",
            "integrity": "sha512-wR/XK3D3XcLIZwpbvQwQ5fK+8Ykds1ip7A2Txe0yxncXSdq1L9skcG7blcedkOX+ZcgxGAmLX1FrRGbADwzi0w==",
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/d3-format": {
            "version": "3.1.0",
            "resolved": "https://registry.npmjs.org/d3-format/-/d3-format-3.1.0.tgz",
            "integrity": "sha512-YyUI6AEuY/Wpt8KWLgZHsIU86atmikuoOmCfommt0LYHiQSPjvX2AcFc38PX0CBpr2RCyZhjex+NS/LPOv6YqA==",
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/d3-interpolate": {
            "version": "3.0.1",
            "resolved": "https://registry.npmjs.org/d3-interpolate/-/d3-interpolate-3.0.1.tgz",
            "integrity": "sha512-3bYs1rOD33uo8aqJfKP3JWPAibgw8Zm2+L9vBKEHJ2Rg+viTR7o5Mmv5mZcieN+FRYaAOWX5SJATX6k1PWz72g==",
            "dependencies": {
                "d3-color": "1 - 3"
            },
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/d3-path": {
            "version": "3.1.0",
            "resolved": "https://registry.npmjs.org/d3-path/-/d3-path-3.1.0.tgz",
            "integrity": "sha512-p3KP5HCf/bvjBSSKuXid6Zqijx7wIfNW+J/maPs+iwR35at5JCbLUT0LzF1cnjbCHWhqzQTIN2Jpe8pRebIEFQ==",
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/d3-scale": {
            "version": "4.0.2",
            "resolved": "https://registry.npmjs.org/d3-scale/-/d3-scale-4.0.2.tgz",
            "integrity": "sha512-GZW464g1SH7ag3Y7hXjf8RoUuAFIqklOAq3MRl4OaWabTFJY9PN/E1YklhXLh+OQ3fM9yS2nOkCoS+WLZ6kvxQ==",
            "dependencies": {
                "d3-array": "2.10.0 - 3",
                "d3-format": "1 - 3",
                "d3-interpolate": "1.2.0 - 3",
                "d3-time": "2.1.1 - 3",
                "d3-time-format": "2 - 4"
            },
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/d3-shape": {
            "version": "3.2.0",
            "resolved": "https://registry.npmjs.org/d3-shape/-/d3-shape-3.2.0.tgz",
            "integrity": "sha512-SaLBuwGm3MOViRq2ABk3eLoxwZELpH6zhl3FbAoJ7Vm1gofKx6El1Ib5z23NUEhF9AsGl7y+dzLe5Cw2AArGTA==",
            "dependencies": {
                "d3-path": "^3.1.0"
            },
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/d3-time": {
            "version": "3.1.0",
            "resolved": "https://registry.npmjs.org/d3-time/-/d3-time-3.1.0.tgz",
            "integrity": "sha512-VqKjzBLejbSMT4IgbmVgDjpkYrNWUYJnbCGo874u7MMKIWsILRX+OpX/gTk8MqjpT1A/c6HY2dCA77ZN0lkQ2Q==",
            "dependencies": {
                "d3-array": "2 - 3"
            },
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/d3-time-format": {
            "version": "4.1.0",
            "resolved": "https://registry.npmjs.org/d3-time-format/-/d3-time-format-4.1.0.tgz",
            "integrity": "sha512-dJxPBlzC7NugB2PDLwo9Q8JiTR3M3e4/XANkreKSUxF8vvXKqm1Yfq4Q5dl8budlunRVlUUaDUgFt7eA8D6NLg==",
            "dependencies": {
                "d3-time": "1 - 3"
            },
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/d3-timer": {
            "version": "3.0.1",
            "resolved": "https://registry.npmjs.org/d3-timer/-/d3-timer-3.0.1.tgz",
            "integrity": "sha512-ndfJ/JxxMd3nw31uyKoY2naivF+r29V+Lc0svZxe1JvvIRmi8hUsrMvdOwgS1o6uBHmiz91geQ0ylPP0aj1VUA==",
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/debug": {
            "version": "4.3.7",
            "resolved": "https://registry.npmjs.org/debug/-/debug-4.3.7.tgz",
            "integrity": "sha512-Er2nc/H7RrMXZBFCEim6TCmMk02Z8vLC2Rbi1KEBggpo0fS6l0S1nnapwmIi3yW/+GOJap1Krg4w0Hg80oCqgQ==",
            "dev": true,
            "dependencies": {
                "ms": "^2.1.3"
            },
            "engines": {
                "node": ">=6.0"
            },
            "peerDependenciesMeta": {
                "supports-color": {
                    "optional": true
                }
            }
        },
        "node_modules/decimal.js-light": {
            "version": "2.5.1",
            "resolved": "https://registry.npmjs.org/decimal.js-light/-/decimal.js-light-2.5.1.tgz",
            "integrity": "sha512-qIMFpTMZmny+MMIitAB6D7iVPEorVw6YQRWkvarTkT4tBeSLLiHzcwj6q0MmYSFCiVpiqPJTJEYIrpcPzVEIvg=="
        },
        "node_modules/deep-is": {
            "version": "0.1.4",
            "resolved": "https://registry.npmjs.org/deep-is/-/deep-is-0.1.4.tgz",
            "integrity": "sha512-oIPzksmTg4/MriiaYGO+okXDT7ztn/w3Eptv/+gSIdMdKsJo0u4CfYNFJPy+4SKMuCqGw2wxnA+URMg3t8a/bQ==",
            "dev": true
        },
        "node_modules/didyoumean": {
            "version": "1.2.2",
            "resolved": "https://registry.npmjs.org/didyoumean/-/didyoumean-1.2.2.tgz",
            "integrity": "sha512-gxtyfqMg7GKyhQmb056K7M3xszy/myH8w+B4RT+QXBQsvAOdc3XymqDDPHx1BgPgsdAA5SIifona89YtRATDzw==",
            "dev": true
        },
        "node_modules/dlv": {
            "version": "1.1.3",
            "resolved": "https://registry.npmjs.org/dlv/-/dlv-1.1.3.tgz",
            "integrity": "sha512-+HlytyjlPKnIG8XuRG8WvmBP8xs8P71y+SKKS6ZXWoEgLuePxtDoUEiH7WkdePWrQ5JBpE6aoVqfZfJUQkjXwA==",
            "dev": true
        },
        "node_modules/dompurify": {
            "version": "3.2.7",
            "resolved": "https://registry.npmjs.org/dompurify/-/dompurify-3.2.7.tgz",
            "integrity": "sha512-WhL/YuveyGXJaerVlMYGWhvQswa7myDG17P7Vu65EWC05o8vfeNbvNf4d/BOvH99+ZW+LlQsc1GDKMa1vNK6dw==",
            "peer": true,
            "optionalDependencies": {
                "@types/trusted-types": "^2.0.7"
            }
        },
        "node_modules/eastasianwidth": {
            "version": "0.2.0",
            "resolved": "https://registry.npmjs.org/eastasianwidth/-/eastasianwidth-0.2.0.tgz",
            "integrity": "sha512-I88TYZWc9XiYHRQ4/3c5rjjfgkjhLyW2luGIheGERbNQ6OY7yTybanSpDXZa8y7VUP9YmDcYa+eyq4ca7iLqWA==",
            "dev": true
        },
        "node_modules/electron-to-chromium": {
            "version": "1.5.33",
            "resolved": "https://registry.npmjs.org/electron-to-chromium/-/electron-to-chromium-1.5.33.tgz",
            "integrity": "sha512-+cYTcFB1QqD4j4LegwLfpCNxifb6dDFUAwk6RsLusCwIaZI6or2f+q8rs5tTB2YC53HhOlIbEaqHMAAC8IOIwA==",
            "dev": true
        },
        "node_modules/emoji-regex": {
            "version": "9.2.2",
            "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-9.2.2.tgz",
            "integrity": "sha512-L18DaJsXSUk2+42pv8mLs5jJT2hqFkFE4j21wOmgbUqsZ2hL72NsUU785g9RXgo3s0ZNgVl42TiHp3ZtOv/Vyg==",
            "dev": true
        },
        "node_modules/es-toolkit": {
            "version": "1.42.0",
            "resolved": "https://registry.npmjs.org/es-toolkit/-/es-toolkit-1.42.0.tgz",
            "integrity": "sha512-SLHIyY7VfDJBM8clz4+T2oquwTQxEzu263AyhVK4jREOAwJ+8eebaa4wM3nlvnAqhDrMm2EsA6hWHaQsMPQ1nA=="
        },
        "node_modules/esbuild": {
            "version": "0.21.5",
            "resolved": "https://registry.npmjs.org/esbuild/-/esbuild-0.21.5.tgz",
            "integrity": "sha512-mg3OPMV4hXywwpoDxu3Qda5xCKQi+vCTZq8S9J/EpkhB2HzKXq4SNFZE3+NK93JYxc8VMSep+lOUSC/RVKaBqw==",
            "dev": true,
            "hasInstallScript": true,
            "bin": {
                "esbuild": "bin/esbuild"
            },
            "engines": {
                "node": ">=12"
            },
            "optionalDependencies": {
                "@esbuild/aix-ppc64": "0.21.5",
                "@esbuild/android-arm": "0.21.5",
                "@esbuild/android-arm64": "0.21.5",
                "@esbuild/android-x64": "0.21.5",
                "@esbuild/darwin-arm64": "0.21.5",
                "@esbuild/darwin-x64": "0.21.5",
                "@esbuild/freebsd-arm64": "0.21.5",
                "@esbuild/freebsd-x64": "0.21.5",
                "@esbuild/linux-arm": "0.21.5",
                "@esbuild/linux-arm64": "0.21.5",
                "@esbuild/linux-ia32": "0.21.5",
                "@esbuild/linux-loong64": "0.21.5",
                "@esbuild/linux-mips64el": "0.21.5",
                "@esbuild/linux-ppc64": "0.21.5",
                "@esbuild/linux-riscv64": "0.21.5",
                "@esbuild/linux-s390x": "0.21.5",
                "@esbuild/linux-x64": "0.21.5",
                "@esbuild/netbsd-x64": "0.21.5",
                "@esbuild/openbsd-x64": "0.21.5",
                "@esbuild/sunos-x64": "0.21.5",
                "@esbuild/win32-arm64": "0.21.5",
                "@esbuild/win32-ia32": "0.21.5",
                "@esbuild/win32-x64": "0.21.5"
            }
        },
        "node_modules/escalade": {
            "version": "3.2.0",
            "resolved": "https://registry.npmjs.org/escalade/-/escalade-3.2.0.tgz",
            "integrity": "sha512-WUj2qlxaQtO4g6Pq5c29GTcWGDyd8itL8zTlipgECz3JesAiiOKotd8JU6otB3PACgG6xkJUyVhboMS+bje/jA==",
            "dev": true,
            "engines": {
                "node": ">=6"
            }
        },
        "node_modules/escape-string-regexp": {
            "version": "1.0.5",
            "resolved": "https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-1.0.5.tgz",
            "integrity": "sha512-vbRorB5FUQWvla16U8R/qgaFIya2qGzwDrNmCZuYKrbdSUMG6I1ZCGQRefkRVhuOkIGVne7BQ35DSfo1qvJqFg==",
            "dev": true,
            "engines": {
                "node": ">=0.8.0"
            }
        },
        "node_modules/eslint": {
            "version": "9.12.0",
            "resolved": "https://registry.npmjs.org/eslint/-/eslint-9.12.0.tgz",
            "integrity": "sha512-UVIOlTEWxwIopRL1wgSQYdnVDcEvs2wyaO6DGo5mXqe3r16IoCNWkR29iHhyaP4cICWjbgbmFUGAhh0GJRuGZw==",
            "dev": true,
            "dependencies": {
                "@eslint-community/eslint-utils": "^4.2.0",
                "@eslint-community/regexpp": "^4.11.0",
                "@eslint/config-array": "^0.18.0",
                "@eslint/core": "^0.6.0",
                "@eslint/eslintrc": "^3.1.0",
                "@eslint/js": "9.12.0",
                "@eslint/plugin-kit": "^0.2.0",
                "@humanfs/node": "^0.16.5",
                "@humanwhocodes/module-importer": "^1.0.1",
                "@humanwhocodes/retry": "^0.3.1",
                "@types/estree": "^1.0.6",
                "@types/json-schema": "^7.0.15",
                "ajv": "^6.12.4",
                "chalk": "^4.0.0",
                "cross-spawn": "^7.0.2",
                "debug": "^4.3.2",
                "escape-string-regexp": "^4.0.0",
                "eslint-scope": "^8.1.0",
                "eslint-visitor-keys": "^4.1.0",
                "espree": "^10.2.0",
                "esquery": "^1.5.0",
                "esutils": "^2.0.2",
                "fast-deep-equal": "^3.1.3",
                "file-entry-cache": "^8.0.0",
                "find-up": "^5.0.0",
                "glob-parent": "^6.0.2",
                "ignore": "^5.2.0",
                "imurmurhash": "^0.1.4",
                "is-glob": "^4.0.0",
                "json-stable-stringify-without-jsonify": "^1.0.1",
                "lodash.merge": "^4.6.2",
                "minimatch": "^3.1.2",
                "natural-compare": "^1.4.0",
                "optionator": "^0.9.3",
                "text-table": "^0.2.0"
            },
            "bin": {
                "eslint": "bin/eslint.js"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "url": "https://eslint.org/donate"
            },
            "peerDependencies": {
                "jiti": "*"
            },
            "peerDependenciesMeta": {
                "jiti": {
                    "optional": true
                }
            }
        },
        "node_modules/eslint-plugin-react-hooks": {
            "version": "5.1.0-rc-fb9a90fa48-20240614",
            "resolved": "https://registry.npmjs.org/eslint-plugin-react-hooks/-/eslint-plugin-react-hooks-5.1.0-rc-fb9a90fa48-20240614.tgz",
            "integrity": "sha512-xsiRwaDNF5wWNC4ZHLut+x/YcAxksUd9Rizt7LaEn3bV8VyYRpXnRJQlLOfYaVy9esk4DFP4zPPnoNVjq5Gc0w==",
            "dev": true,
            "engines": {
                "node": ">=10"
            },
            "peerDependencies": {
                "eslint": "^3.0.0 || ^4.0.0 || ^5.0.0 || ^6.0.0 || ^7.0.0 || ^8.0.0-0 || ^9.0.0"
            }
        },
        "node_modules/eslint-plugin-react-refresh": {
            "version": "0.4.12",
            "resolved": "https://registry.npmjs.org/eslint-plugin-react-refresh/-/eslint-plugin-react-refresh-0.4.12.tgz",
            "integrity": "sha512-9neVjoGv20FwYtCP6CB1dzR1vr57ZDNOXst21wd2xJ/cTlM2xLq0GWVlSNTdMn/4BtP6cHYBMCSp1wFBJ9jBsg==",
            "dev": true,
            "peerDependencies": {
                "eslint": ">=7"
            }
        },
        "node_modules/eslint-scope": {
            "version": "8.1.0",
            "resolved": "https://registry.npmjs.org/eslint-scope/-/eslint-scope-8.1.0.tgz",
            "integrity": "sha512-14dSvlhaVhKKsa9Fx1l8A17s7ah7Ef7wCakJ10LYk6+GYmP9yDti2oq2SEwcyndt6knfcZyhyxwY3i9yL78EQw==",
            "dev": true,
            "dependencies": {
                "esrecurse": "^4.3.0",
                "estraverse": "^5.2.0"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "url": "https://opencollective.com/eslint"
            }
        },
        "node_modules/eslint-visitor-keys": {
            "version": "4.1.0",
            "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-4.1.0.tgz",
            "integrity": "sha512-Q7lok0mqMUSf5a/AdAZkA5a/gHcO6snwQClVNNvFKCAVlxXucdU8pKydU5ZVZjBx5xr37vGbFFWtLQYreLzrZg==",
            "dev": true,
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "url": "https://opencollective.com/eslint"
            }
        },
        "node_modules/eslint/node_modules/ansi-styles": {
            "version": "4.3.0",
            "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz",
            "integrity": "sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==",
            "dev": true,
            "dependencies": {
                "color-convert": "^2.0.1"
            },
            "engines": {
                "node": ">=8"
            },
            "funding": {
                "url": "https://github.com/chalk/ansi-styles?sponsor=1"
            }
        },
        "node_modules/eslint/node_modules/chalk": {
            "version": "4.1.2",
            "resolved": "https://registry.npmjs.org/chalk/-/chalk-4.1.2.tgz",
            "integrity": "sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==",
            "dev": true,
            "dependencies": {
                "ansi-styles": "^4.1.0",
                "supports-color": "^7.1.0"
            },
            "engines": {
                "node": ">=10"
            },
            "funding": {
                "url": "https://github.com/chalk/chalk?sponsor=1"
            }
        },
        "node_modules/eslint/node_modules/color-convert": {
            "version": "2.0.1",
            "resolved": "https://registry.npmjs.org/color-convert/-/color-convert-2.0.1.tgz",
            "integrity": "sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==",
            "dev": true,
            "dependencies": {
                "color-name": "~1.1.4"
            },
            "engines": {
                "node": ">=7.0.0"
            }
        },
        "node_modules/eslint/node_modules/color-name": {
            "version": "1.1.4",
            "resolved": "https://registry.npmjs.org/color-name/-/color-name-1.1.4.tgz",
            "integrity": "sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==",
            "dev": true
        },
        "node_modules/eslint/node_modules/escape-string-regexp": {
            "version": "4.0.0",
            "resolved": "https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-4.0.0.tgz",
            "integrity": "sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA==",
            "dev": true,
            "engines": {
                "node": ">=10"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        },
        "node_modules/eslint/node_modules/has-flag": {
            "version": "4.0.0",
            "resolved": "https://registry.npmjs.org/has-flag/-/has-flag-4.0.0.tgz",
            "integrity": "sha512-EykJT/Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG/ZxU3EvlMPQ==",
            "dev": true,
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/eslint/node_modules/supports-color": {
            "version": "7.2.0",
            "resolved": "https://registry.npmjs.org/supports-color/-/supports-color-7.2.0.tgz",
            "integrity": "sha512-qpCAvRl9stuOHveKsn7HncJRvv501qIacKzQlO/+Lwxc9+0q2wLyv4Dfvt80/DPn2pqOBsJdDiogXGR9+OvwRw==",
            "dev": true,
            "dependencies": {
                "has-flag": "^4.0.0"
            },
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/espree": {
            "version": "10.2.0",
            "resolved": "https://registry.npmjs.org/espree/-/espree-10.2.0.tgz",
            "integrity": "sha512-upbkBJbckcCNBDBDXEbuhjbP68n+scUd3k/U2EkyM9nw+I/jPiL4cLF/Al06CF96wRltFda16sxDFrxsI1v0/g==",
            "dev": true,
            "dependencies": {
                "acorn": "^8.12.0",
                "acorn-jsx": "^5.3.2",
                "eslint-visitor-keys": "^4.1.0"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "url": "https://opencollective.com/eslint"
            }
        },
        "node_modules/esquery": {
            "version": "1.6.0",
            "resolved": "https://registry.npmjs.org/esquery/-/esquery-1.6.0.tgz",
            "integrity": "sha512-ca9pw9fomFcKPvFLXhBKUK90ZvGibiGOvRJNbjljY7s7uq/5YO4BOzcYtJqExdx99rF6aAcnRxHmcUHcz6sQsg==",
            "dev": true,
            "dependencies": {
                "estraverse": "^5.1.0"
            },
            "engines": {
                "node": ">=0.10"
            }
        },
        "node_modules/esrecurse": {
            "version": "4.3.0",
            "resolved": "https://registry.npmjs.org/esrecurse/-/esrecurse-4.3.0.tgz",
            "integrity": "sha512-KmfKL3b6G+RXvP8N1vr3Tq1kL/oCFgn2NYXEtqP8/L3pKapUA4G8cFVaoF3SU323CD4XypR/ffioHmkti6/Tag==",
            "dev": true,
            "dependencies": {
                "estraverse": "^5.2.0"
            },
            "engines": {
                "node": ">=4.0"
            }
        },
        "node_modules/estraverse": {
            "version": "5.3.0",
            "resolved": "https://registry.npmjs.org/estraverse/-/estraverse-5.3.0.tgz",
            "integrity": "sha512-MMdARuVEQziNTeJD8DgMqmhwR11BRQ/cBP+pLtYdSTnf3MIO8fFeiINEbX36ZdNlfU/7A9f3gUw49B3oQsvwBA==",
            "dev": true,
            "engines": {
                "node": ">=4.0"
            }
        },
        "node_modules/esutils": {
            "version": "2.0.3",
            "resolved": "https://registry.npmjs.org/esutils/-/esutils-2.0.3.tgz",
            "integrity": "sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==",
            "dev": true,
            "engines": {
                "node": ">=0.10.0"
            }
        },
        "node_modules/eventemitter3": {
            "version": "5.0.1",
            "resolved": "https://registry.npmjs.org/eventemitter3/-/eventemitter3-5.0.1.tgz",
            "integrity": "sha512-GWkBvjiSZK87ELrYOSESUYeVIc9mvLLf/nXalMOS5dYrgZq9o5OVkbZAVM06CVxYsCwH9BDZFPlQTlPA1j4ahA=="
        },
        "node_modules/fast-deep-equal": {
            "version": "3.1.3",
            "resolved": "https://registry.npmjs.org/fast-deep-equal/-/fast-deep-equal-3.1.3.tgz",
            "integrity": "sha512-f3qQ9oQy9j2AhBe/H9VC91wLmKBCCU/gDOnKNAYG5hswO7BLKj09Hc5HYNz9cGI++xlpDCIgDaitVs03ATR84Q==",
            "dev": true
        },
        "node_modules/fast-glob": {
            "version": "3.3.2",
            "resolved": "https://registry.npmjs.org/fast-glob/-/fast-glob-3.3.2.tgz",
            "integrity": "sha512-oX2ruAFQwf/Orj8m737Y5adxDQO0LAB7/S5MnxCdTNDd4p6BsyIVsv9JQsATbTSq8KHRpLwIHbVlUNatxd+1Ow==",
            "dev": true,
            "dependencies": {
                "@nodelib/fs.stat": "^2.0.2",
                "@nodelib/fs.walk": "^1.2.3",
                "glob-parent": "^5.1.2",
                "merge2": "^1.3.0",
                "micromatch": "^4.0.4"
            },
            "engines": {
                "node": ">=8.6.0"
            }
        },
        "node_modules/fast-glob/node_modules/glob-parent": {
            "version": "5.1.2",
            "resolved": "https://registry.npmjs.org/glob-parent/-/glob-parent-5.1.2.tgz",
            "integrity": "sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==",
            "dev": true,
            "dependencies": {
                "is-glob": "^4.0.1"
            },
            "engines": {
                "node": ">= 6"
            }
        },
        "node_modules/fast-json-stable-stringify": {
            "version": "2.1.0",
            "resolved": "https://registry.npmjs.org/fast-json-stable-stringify/-/fast-json-stable-stringify-2.1.0.tgz",
            "integrity": "sha512-lhd/wF+Lk98HZoTCtlVraHtfh5XYijIjalXck7saUtuanSDyLMxnHhSXEDJqHxD7msR8D0uCmqlkwjCV8xvwHw==",
            "dev": true
        },
        "node_modules/fast-levenshtein": {
            "version": "2.0.6",
            "resolved": "https://registry.npmjs.org/fast-levenshtein/-/fast-levenshtein-2.0.6.tgz",
            "integrity": "sha512-DCXu6Ifhqcks7TZKY3Hxp3y6qphY5SJZmrWMDrKcERSOXWQdMhU9Ig/PYrzyw/ul9jOIyh0N4M0tbC5hodg8dw==",
            "dev": true
        },
        "node_modules/fastq": {
            "version": "1.17.1",
            "resolved": "https://registry.npmjs.org/fastq/-/fastq-1.17.1.tgz",
            "integrity": "sha512-sRVD3lWVIXWg6By68ZN7vho9a1pQcN/WBFaAAsDDFzlJjvoGx0P8z7V1t72grFJfJhu3YPZBuu25f7Kaw2jN1w==",
            "dev": true,
            "dependencies": {
                "reusify": "^1.0.4"
            }
        },
        "node_modules/file-entry-cache": {
            "version": "8.0.0",
            "resolved": "https://registry.npmjs.org/file-entry-cache/-/file-entry-cache-8.0.0.tgz",
            "integrity": "sha512-XXTUwCvisa5oacNGRP9SfNtYBNAMi+RPwBFmblZEF7N7swHYQS6/Zfk7SRwx4D5j3CH211YNRco1DEMNVfZCnQ==",
            "dev": true,
            "dependencies": {
                "flat-cache": "^4.0.0"
            },
            "engines": {
                "node": ">=16.0.0"
            }
        },
        "node_modules/fill-range": {
            "version": "7.1.1",
            "resolved": "https://registry.npmjs.org/fill-range/-/fill-range-7.1.1.tgz",
            "integrity": "sha512-YsGpe3WHLK8ZYi4tWDg2Jy3ebRz2rXowDxnld4bkQB00cc/1Zw9AWnC0i9ztDJitivtQvaI9KaLyKrc+hBW0yg==",
            "dev": true,
            "dependencies": {
                "to-regex-range": "^5.0.1"
            },
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/find-up": {
            "version": "5.0.0",
            "resolved": "https://registry.npmjs.org/find-up/-/find-up-5.0.0.tgz",
            "integrity": "sha512-78/PXT1wlLLDgTzDs7sjq9hzz0vXD+zn+7wypEe4fXQxCmdmqfGsEPQxmiCSQI3ajFV91bVSsvNtrJRiW6nGng==",
            "dev": true,
            "dependencies": {
                "locate-path": "^6.0.0",
                "path-exists": "^4.0.0"
            },
            "engines": {
                "node": ">=10"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        },
        "node_modules/flat-cache": {
            "version": "4.0.1",
            "resolved": "https://registry.npmjs.org/flat-cache/-/flat-cache-4.0.1.tgz",
            "integrity": "sha512-f7ccFPK3SXFHpx15UIGyRJ/FJQctuKZ0zVuN3frBo4HnK3cay9VEW0R6yPYFHC0AgqhukPzKjq22t5DmAyqGyw==",
            "dev": true,
            "dependencies": {
                "flatted": "^3.2.9",
                "keyv": "^4.5.4"
            },
            "engines": {
                "node": ">=16"
            }
        },
        "node_modules/flatted": {
            "version": "3.3.1",
            "resolved": "https://registry.npmjs.org/flatted/-/flatted-3.3.1.tgz",
            "integrity": "sha512-X8cqMLLie7KsNUDSdzeN8FYK9rEt4Dt67OsG/DNGnYTSDBG4uFAJFBnUeiV+zCVAvwFy56IjM9sH51jVaEhNxw==",
            "dev": true
        },
        "node_modules/foreground-child": {
            "version": "3.3.0",
            "resolved": "https://registry.npmjs.org/foreground-child/-/foreground-child-3.3.0.tgz",
            "integrity": "sha512-Ld2g8rrAyMYFXBhEqMz8ZAHBi4J4uS1i/CxGMDnjyFWddMXLVcDp051DZfu+t7+ab7Wv6SMqpWmyFIj5UbfFvg==",
            "dev": true,
            "dependencies": {
                "cross-spawn": "^7.0.0",
                "signal-exit": "^4.0.1"
            },
            "engines": {
                "node": ">=14"
            },
            "funding": {
                "url": "https://github.com/sponsors/isaacs"
            }
        },
        "node_modules/fraction.js": {
            "version": "4.3.7",
            "resolved": "https://registry.npmjs.org/fraction.js/-/fraction.js-4.3.7.tgz",
            "integrity": "sha512-ZsDfxO51wGAXREY55a7la9LScWpwv9RxIrYABrlvOFBlH/ShPnrtsXeuUIfXKKOVicNxQ+o8JTbJvjS4M89yew==",
            "dev": true,
            "engines": {
                "node": "*"
            },
            "funding": {
                "type": "patreon",
                "url": "https://github.com/sponsors/rawify"
            }
        },
        "node_modules/fsevents": {
            "version": "2.3.3",
            "resolved": "https://registry.npmjs.org/fsevents/-/fsevents-2.3.3.tgz",
            "integrity": "sha512-5xoDfX+fL7faATnagmWPpbFtwh/R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==",
            "dev": true,
            "hasInstallScript": true,
            "optional": true,
            "os": [
                "darwin"
            ],
            "engines": {
                "node": "^8.16.0 || ^10.6.0 || >=11.0.0"
            }
        },
        "node_modules/function-bind": {
            "version": "1.1.2",
            "resolved": "https://registry.npmjs.org/function-bind/-/function-bind-1.1.2.tgz",
            "integrity": "sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==",
            "dev": true,
            "funding": {
                "url": "https://github.com/sponsors/ljharb"
            }
        },
        "node_modules/gensync": {
            "version": "1.0.0-beta.2",
            "resolved": "https://registry.npmjs.org/gensync/-/gensync-1.0.0-beta.2.tgz",
            "integrity": "sha512-3hN7NaskYvMDLQY55gnW3NQ+mesEAepTqlg+VEbj7zzqEMBVNhzcGYYeqFo/TlYz6eQiFcp1HcsCZO+nGgS8zg==",
            "dev": true,
            "engines": {
                "node": ">=6.9.0"
            }
        },
        "node_modules/glob": {
            "version": "10.4.5",
            "resolved": "https://registry.npmjs.org/glob/-/glob-10.4.5.tgz",
            "integrity": "sha512-7Bv8RF0k6xjo7d4A/PxYLbUCfb6c+Vpd2/mB2yRDlew7Jb5hEXiCD9ibfO7wpk8i4sevK6DFny9h7EYbM3/sHg==",
            "dev": true,
            "dependencies": {
                "foreground-child": "^3.1.0",
                "jackspeak": "^3.1.2",
                "minimatch": "^9.0.4",
                "minipass": "^7.1.2",
                "package-json-from-dist": "^1.0.0",
                "path-scurry": "^1.11.1"
            },
            "bin": {
                "glob": "dist/esm/bin.mjs"
            },
            "funding": {
                "url": "https://github.com/sponsors/isaacs"
            }
        },
        "node_modules/glob-parent": {
            "version": "6.0.2",
            "resolved": "https://registry.npmjs.org/glob-parent/-/glob-parent-6.0.2.tgz",
            "integrity": "sha512-XxwI8EOhVQgWp6iDL+3b0r86f4d6AX6zSU55HfB4ydCEuXLXc5FcYeOu+nnGftS4TEju/11rt4KJPTMgbfmv4A==",
            "dev": true,
            "dependencies": {
                "is-glob": "^4.0.3"
            },
            "engines": {
                "node": ">=10.13.0"
            }
        },
        "node_modules/glob/node_modules/brace-expansion": {
            "version": "2.0.1",
            "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-2.0.1.tgz",
            "integrity": "sha512-XnAIvQ8eM+kC6aULx6wuQiwVsnzsi9d3WxzV3FpWTGA19F621kwdbsAcFKXgKUHZWsy+mY6iL1sHTxWEFCytDA==",
            "dev": true,
            "dependencies": {
                "balanced-match": "^1.0.0"
            }
        },
        "node_modules/glob/node_modules/minimatch": {
            "version": "9.0.5",
            "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-9.0.5.tgz",
            "integrity": "sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==",
            "dev": true,
            "dependencies": {
                "brace-expansion": "^2.0.1"
            },
            "engines": {
                "node": ">=16 || 14 >=14.17"
            },
            "funding": {
                "url": "https://github.com/sponsors/isaacs"
            }
        },
        "node_modules/globals": {
            "version": "15.11.0",
            "resolved": "https://registry.npmjs.org/globals/-/globals-15.11.0.tgz",
            "integrity": "sha512-yeyNSjdbyVaWurlwCpcA6XNBrHTMIeDdj0/hnvX/OLJ9ekOXYbLsLinH/MucQyGvNnXhidTdNhTtJaffL2sMfw==",
            "dev": true,
            "engines": {
                "node": ">=18"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        },
        "node_modules/graphemer": {
            "version": "1.4.0",
            "resolved": "https://registry.npmjs.org/graphemer/-/graphemer-1.4.0.tgz",
            "integrity": "sha512-EtKwoO6kxCL9WO5xipiHTZlSzBm7WLT627TqC/uVRd0HKmq8NXyebnNYxDoBi7wt8eTWrUrKXCOVaFq9x1kgag==",
            "dev": true
        },
        "node_modules/has-flag": {
            "version": "3.0.0",
            "resolved": "https://registry.npmjs.org/has-flag/-/has-flag-3.0.0.tgz",
            "integrity": "sha512-sKJf1+ceQBr4SMkvQnBDNDtf4TXpVhVGateu0t918bl30FnbE2m4vNLX+VWe/dpjlb+HugGYzW7uQXH98HPEYw==",
            "dev": true,
            "engines": {
                "node": ">=4"
            }
        },
        "node_modules/hasown": {
            "version": "2.0.2",
            "resolved": "https://registry.npmjs.org/hasown/-/hasown-2.0.2.tgz",
            "integrity": "sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==",
            "dev": true,
            "dependencies": {
                "function-bind": "^1.1.2"
            },
            "engines": {
                "node": ">= 0.4"
            }
        },
        "node_modules/ignore": {
            "version": "5.3.2",
            "resolved": "https://registry.npmjs.org/ignore/-/ignore-5.3.2.tgz",
            "integrity": "sha512-hsBTNUqQTDwkWtcdYI2i06Y/nUBEsNEDJKjWdigLvegy8kDuJAS8uRlpkkcQpyEXL0Z/pjDy5HBmMjRCJ2gq+g==",
            "dev": true,
            "engines": {
                "node": ">= 4"
            }
        },
        "node_modules/immer": {
            "version": "10.2.0",
            "resolved": "https://registry.npmjs.org/immer/-/immer-10.2.0.tgz",
            "integrity": "sha512-d/+XTN3zfODyjr89gM3mPq1WNX2B8pYsu7eORitdwyA2sBubnTl3laYlBk4sXY5FUa5qTZGBDPJICVbvqzjlbw==",
            "funding": {
                "type": "opencollective",
                "url": "https://opencollective.com/immer"
            }
        },
        "node_modules/import-fresh": {
            "version": "3.3.0",
            "resolved": "https://registry.npmjs.org/import-fresh/-/import-fresh-3.3.0.tgz",
            "integrity": "sha512-veYYhQa+D1QBKznvhUHxb8faxlrwUnxseDAbAp457E0wLNio2bOSKnjYDhMj+YiAq61xrMGhQk9iXVk5FzgQMw==",
            "dev": true,
            "dependencies": {
                "parent-module": "^1.0.0",
                "resolve-from": "^4.0.0"
            },
            "engines": {
                "node": ">=6"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        },
        "node_modules/imurmurhash": {
            "version": "0.1.4",
            "resolved": "https://registry.npmjs.org/imurmurhash/-/imurmurhash-0.1.4.tgz",
            "integrity": "sha512-JmXMZ6wuvDmLiHEml9ykzqO6lwFbof0GG4IkcGaENdCRDDmMVnny7s5HsIgHCbaq0w2MyPhDqkhTUgS2LU2PHA==",
            "dev": true,
            "engines": {
                "node": ">=0.8.19"
            }
        },
        "node_modules/internmap": {
            "version": "2.0.3",
            "resolved": "https://registry.npmjs.org/internmap/-/internmap-2.0.3.tgz",
            "integrity": "sha512-5Hh7Y1wQbvY5ooGgPbDaL5iYLAPzMTUrjMulskHLH6wnv/A+1q5rgEaiuqEjB+oxGXIVZs1FF+R/KPN3ZSQYYg==",
            "engines": {
                "node": ">=12"
            }
        },
        "node_modules/is-binary-path": {
            "version": "2.1.0",
            "resolved": "https://registry.npmjs.org/is-binary-path/-/is-binary-path-2.1.0.tgz",
            "integrity": "sha512-ZMERYes6pDydyuGidse7OsHxtbI7WVeUEozgR/g7rd0xUimYNlvZRE/K2MgZTjWy725IfelLeVcEM97mmtRGXw==",
            "dev": true,
            "dependencies": {
                "binary-extensions": "^2.0.0"
            },
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/is-core-module": {
            "version": "2.15.1",
            "resolved": "https://registry.npmjs.org/is-core-module/-/is-core-module-2.15.1.tgz",
            "integrity": "sha512-z0vtXSwucUJtANQWldhbtbt7BnL0vxiFjIdDLAatwhDYty2bad6s+rijD6Ri4YuYJubLzIJLUidCh09e1djEVQ==",
            "dev": true,
            "dependencies": {
                "hasown": "^2.0.2"
            },
            "engines": {
                "node": ">= 0.4"
            },
            "funding": {
                "url": "https://github.com/sponsors/ljharb"
            }
        },
        "node_modules/is-extglob": {
            "version": "2.1.1",
            "resolved": "https://registry.npmjs.org/is-extglob/-/is-extglob-2.1.1.tgz",
            "integrity": "sha512-SbKbANkN603Vi4jEZv49LeVJMn4yGwsbzZworEoyEiutsN3nJYdbO36zfhGJ6QEDpOZIFkDtnq5JRxmvl3jsoQ==",
            "dev": true,
            "engines": {
                "node": ">=0.10.0"
            }
        },
        "node_modules/is-fullwidth-code-point": {
            "version": "3.0.0",
            "resolved": "https://registry.npmjs.org/is-fullwidth-code-point/-/is-fullwidth-code-point-3.0.0.tgz",
            "integrity": "sha512-zymm5+u+sCsSWyD9qNaejV3DFvhCKclKdizYaJUuHA83RLjb7nSuGnddCHGv0hk+KY7BMAlsWeK4Ueg6EV6XQg==",
            "dev": true,
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/is-glob": {
            "version": "4.0.3",
            "resolved": "https://registry.npmjs.org/is-glob/-/is-glob-4.0.3.tgz",
            "integrity": "sha512-xelSayHH36ZgE7ZWhli7pW34hNbNl8Ojv5KVmkJD4hBdD3th8Tfk9vYasLM+mXWOZhFkgZfxhLSnrwRr4elSSg==",
            "dev": true,
            "dependencies": {
                "is-extglob": "^2.1.1"
            },
            "engines": {
                "node": ">=0.10.0"
            }
        },
        "node_modules/is-number": {
            "version": "7.0.0",
            "resolved": "https://registry.npmjs.org/is-number/-/is-number-7.0.0.tgz",
            "integrity": "sha512-41Cifkg6e8TylSpdtTpeLVMqvSBEVzTttHvERD741+pnZ8ANv0004MRL43QKPDlK9cGvNp6NZWZUBlbGXYxxng==",
            "dev": true,
            "engines": {
                "node": ">=0.12.0"
            }
        },
        "node_modules/isexe": {
            "version": "2.0.0",
            "resolved": "https://registry.npmjs.org/isexe/-/isexe-2.0.0.tgz",
            "integrity": "sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==",
            "dev": true
        },
        "node_modules/jackspeak": {
            "version": "3.4.3",
            "resolved": "https://registry.npmjs.org/jackspeak/-/jackspeak-3.4.3.tgz",
            "integrity": "sha512-OGlZQpz2yfahA/Rd1Y8Cd9SIEsqvXkLVoSw/cgwhnhFMDbsQFeZYoJJ7bIZBS9BcamUW96asq/npPWugM+RQBw==",
            "dev": true,
            "dependencies": {
                "@isaacs/cliui": "^8.0.2"
            },
            "funding": {
                "url": "https://github.com/sponsors/isaacs"
            },
            "optionalDependencies": {
                "@pkgjs/parseargs": "^0.11.0"
            }
        },
        "node_modules/jiti": {
            "version": "1.21.6",
            "resolved": "https://registry.npmjs.org/jiti/-/jiti-1.21.6.tgz",
            "integrity": "sha512-2yTgeWTWzMWkHu6Jp9NKgePDaYHbntiwvYuuJLbbN9vl7DC9DvXKOB2BC3ZZ92D3cvV/aflH0osDfwpHepQ53w==",
            "dev": true,
            "bin": {
                "jiti": "bin/jiti.js"
            }
        },
        "node_modules/js-tokens": {
            "version": "4.0.0",
            "resolved": "https://registry.npmjs.org/js-tokens/-/js-tokens-4.0.0.tgz",
            "integrity": "sha512-RdJUflcE3cUzKiMqQgsCu06FPu9UdIJO0beYbPhHN4k6apgJtifcoCtT9bcxOpYBtpD2kCM6Sbzg4CausW/PKQ=="
        },
        "node_modules/js-yaml": {
            "version": "4.1.0",
            "resolved": "https://registry.npmjs.org/js-yaml/-/js-yaml-4.1.0.tgz",
            "integrity": "sha512-wpxZs9NoxZaJESJGIZTyDEaYpl0FKSA+FB9aJiyemKhMwkxQg63h4T1KJgUGHpTqPDNRcmmYLugrRjJlBtWvRA==",
            "dev": true,
            "dependencies": {
                "argparse": "^2.0.1"
            },
            "bin": {
                "js-yaml": "bin/js-yaml.js"
            }
        },
        "node_modules/jsesc": {
            "version": "3.0.2",
            "resolved": "https://registry.npmjs.org/jsesc/-/jsesc-3.0.2.tgz",
            "integrity": "sha512-xKqzzWXDttJuOcawBt4KnKHHIf5oQ/Cxax+0PWFG+DFDgHNAdi+TXECADI+RYiFUMmx8792xsMbbgXj4CwnP4g==",
            "dev": true,
            "bin": {
                "jsesc": "bin/jsesc"
            },
            "engines": {
                "node": ">=6"
            }
        },
        "node_modules/json-buffer": {
            "version": "3.0.1",
            "resolved": "https://registry.npmjs.org/json-buffer/-/json-buffer-3.0.1.tgz",
            "integrity": "sha512-4bV5BfR2mqfQTJm+V5tPPdf+ZpuhiIvTuAB5g8kcrXOZpTT/QwwVRWBywX1ozr6lEuPdbHxwaJlm9G6mI2sfSQ==",
            "dev": true
        },
        "node_modules/json-schema-traverse": {
            "version": "0.4.1",
            "resolved": "https://registry.npmjs.org/json-schema-traverse/-/json-schema-traverse-0.4.1.tgz",
            "integrity": "sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg==",
            "dev": true
        },
        "node_modules/json-stable-stringify-without-jsonify": {
            "version": "1.0.1",
            "resolved": "https://registry.npmjs.org/json-stable-stringify-without-jsonify/-/json-stable-stringify-without-jsonify-1.0.1.tgz",
            "integrity": "sha512-Bdboy+l7tA3OGW6FjyFHWkP5LuByj1Tk33Ljyq0axyzdk9//JSi2u3fP1QSmd1KNwq6VOKYGlAu87CisVir6Pw==",
            "dev": true
        },
        "node_modules/json5": {
            "version": "2.2.3",
            "resolved": "https://registry.npmjs.org/json5/-/json5-2.2.3.tgz",
            "integrity": "sha512-XmOWe7eyHYH14cLdVPoyg+GOH3rYX++KpzrylJwSW98t3Nk+U8XOl8FWKOgwtzdb8lXGf6zYwDUzeHMWfxasyg==",
            "dev": true,
            "bin": {
                "json5": "lib/cli.js"
            },
            "engines": {
                "node": ">=6"
            }
        },
        "node_modules/keyv": {
            "version": "4.5.4",
            "resolved": "https://registry.npmjs.org/keyv/-/keyv-4.5.4.tgz",
            "integrity": "sha512-oxVHkHR/EJf2CNXnWxRLW6mg7JyCCUcG0DtEGmL2ctUo1PNTin1PUil+r/+4r5MpVgC/fn1kjsx7mjSujKqIpw==",
            "dev": true,
            "dependencies": {
                "json-buffer": "3.0.1"
            }
        },
        "node_modules/levn": {
            "version": "0.4.1",
            "resolved": "https://registry.npmjs.org/levn/-/levn-0.4.1.tgz",
            "integrity": "sha512-+bT2uH4E5LGE7h/n3evcS/sQlJXCpIp6ym8OWJ5eV6+67Dsql/LaaT7qJBAt2rzfoa/5QBGBhxDix1dMt2kQKQ==",
            "dev": true,
            "dependencies": {
                "prelude-ls": "^1.2.1",
                "type-check": "~0.4.0"
            },
            "engines": {
                "node": ">= 0.8.0"
            }
        },
        "node_modules/lilconfig": {
            "version": "3.1.3",
            "resolved": "https://registry.npmjs.org/lilconfig/-/lilconfig-3.1.3.tgz",
            "integrity": "sha512-/vlFKAoH5Cgt3Ie+JLhRbwOsCQePABiU3tJ1egGvyQ+33R/vcwM2Zl2QR/LzjsBeItPt3oSVXapn+m4nQDvpzw==",
            "dev": true,
            "engines": {
                "node": ">=14"
            },
            "funding": {
                "url": "https://github.com/sponsors/antonk52"
            }
        },
        "node_modules/lines-and-columns": {
            "version": "1.2.4",
            "resolved": "https://registry.npmjs.org/lines-and-columns/-/lines-and-columns-1.2.4.tgz",
            "integrity": "sha512-7ylylesZQ/PV29jhEDl3Ufjo6ZX7gCqJr5F7PKrqc93v7fzSymt1BpwEU8nAUXs8qzzvqhbjhK5QZg6Mt/HkBg==",
            "dev": true
        },
        "node_modules/locate-path": {
            "version": "6.0.0",
            "resolved": "https://registry.npmjs.org/locate-path/-/locate-path-6.0.0.tgz",
            "integrity": "sha512-iPZK6eYjbxRu3uB4/WZ3EsEIMJFMqAoopl3R+zuq0UjcAm/MO6KCweDgPfP3elTztoKP3KtnVHxTn2NHBSDVUw==",
            "dev": true,
            "dependencies": {
                "p-locate": "^5.0.0"
            },
            "engines": {
                "node": ">=10"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        },
        "node_modules/lodash.merge": {
            "version": "4.6.2",
            "resolved": "https://registry.npmjs.org/lodash.merge/-/lodash.merge-4.6.2.tgz",
            "integrity": "sha512-0KpjqXRVvrYyCsX1swR/XTK0va6VQkQM6MNo7PqW77ByjAhoARA8EfrP1N4+KlKj8YS0ZUCtRT/YUuhyYDujIQ==",
            "dev": true
        },
        "node_modules/loose-envify": {
            "version": "1.4.0",
            "resolved": "https://registry.npmjs.org/loose-envify/-/loose-envify-1.4.0.tgz",
            "integrity": "sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==",
            "dependencies": {
                "js-tokens": "^3.0.0 || ^4.0.0"
            },
            "bin": {
                "loose-envify": "cli.js"
            }
        },
        "node_modules/lru-cache": {
            "version": "5.1.1",
            "resolved": "https://registry.npmjs.org/lru-cache/-/lru-cache-5.1.1.tgz",
            "integrity": "sha512-KpNARQA3Iwv+jTA0utUVVbrh+Jlrr1Fv0e56GGzAFOXN7dk/FviaDW8LHmK52DlcH4WP2n6gI8vN1aesBFgo9w==",
            "dev": true,
            "dependencies": {
                "yallist": "^3.0.2"
            }
        },
        "node_modules/lucide-react": {
            "version": "0.344.0",
            "resolved": "https://registry.npmjs.org/lucide-react/-/lucide-react-0.344.0.tgz",
            "integrity": "sha512-6YyBnn91GB45VuVT96bYCOKElbJzUHqp65vX8cDcu55MQL9T969v4dhGClpljamuI/+KMO9P6w9Acq1CVQGvIQ==",
            "peerDependencies": {
                "react": "^16.5.1 || ^17.0.0 || ^18.0.0"
            }
        },
        "node_modules/marked": {
            "version": "14.0.0",
            "resolved": "https://registry.npmjs.org/marked/-/marked-14.0.0.tgz",
            "integrity": "sha512-uIj4+faQ+MgHgwUW1l2PsPglZLOLOT1uErt06dAPtx2kjteLAkbsd/0FiYg/MGS+i7ZKLb7w2WClxHkzOOuryQ==",
            "peer": true,
            "bin": {
                "marked": "bin/marked.js"
            },
            "engines": {
                "node": ">= 18"
            }
        },
        "node_modules/merge2": {
            "version": "1.4.1",
            "resolved": "https://registry.npmjs.org/merge2/-/merge2-1.4.1.tgz",
            "integrity": "sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg==",
            "dev": true,
            "engines": {
                "node": ">= 8"
            }
        },
        "node_modules/micromatch": {
            "version": "4.0.8",
            "resolved": "https://registry.npmjs.org/micromatch/-/micromatch-4.0.8.tgz",
            "integrity": "sha512-PXwfBhYu0hBCPw8Dn0E+WDYb7af3dSLVWKi3HGv84IdF4TyFoC0ysxFd0Goxw7nSv4T/PzEJQxsYsEiFCKo2BA==",
            "dev": true,
            "dependencies": {
                "braces": "^3.0.3",
                "picomatch": "^2.3.1"
            },
            "engines": {
                "node": ">=8.6"
            }
        },
        "node_modules/minimatch": {
            "version": "3.1.2",
            "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz",
            "integrity": "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==",
            "dev": true,
            "dependencies": {
                "brace-expansion": "^1.1.7"
            },
            "engines": {
                "node": "*"
            }
        },
        "node_modules/minipass": {
            "version": "7.1.2",
            "resolved": "https://registry.npmjs.org/minipass/-/minipass-7.1.2.tgz",
            "integrity": "sha512-qOOzS1cBTWYF4BH8fVePDBOO9iptMnGUEZwNc/cMWnTV2nVLZ7VoNWEPHkYczZA0pdoA7dl6e7FL659nX9S2aw==",
            "dev": true,
            "engines": {
                "node": ">=16 || 14 >=14.17"
            }
        },
        "node_modules/monaco-editor": {
            "version": "0.55.1",
            "resolved": "https://registry.npmjs.org/monaco-editor/-/monaco-editor-0.55.1.tgz",
            "integrity": "sha512-jz4x+TJNFHwHtwuV9vA9rMujcZRb0CEilTEwG2rRSpe/A7Jdkuj8xPKttCgOh+v/lkHy7HsZ64oj+q3xoAFl9A==",
            "peer": true,
            "dependencies": {
                "dompurify": "3.2.7",
                "marked": "14.0.0"
            }
        },
        "node_modules/ms": {
            "version": "2.1.3",
            "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
            "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
            "dev": true
        },
        "node_modules/mz": {
            "version": "2.7.0",
            "resolved": "https://registry.npmjs.org/mz/-/mz-2.7.0.tgz",
            "integrity": "sha512-z81GNO7nnYMEhrGh9LeymoE4+Yr0Wn5McHIZMK5cfQCl+NDX08sCZgUc9/6MHni9IWuFLm1Z3HTCXu2z9fN62Q==",
            "dev": true,
            "dependencies": {
                "any-promise": "^1.0.0",
                "object-assign": "^4.0.1",
                "thenify-all": "^1.0.0"
            }
        },
        "node_modules/nanoid": {
            "version": "3.3.7",
            "resolved": "https://registry.npmjs.org/nanoid/-/nanoid-3.3.7.tgz",
            "integrity": "sha512-eSRppjcPIatRIMC1U6UngP8XFcz8MQWGQdt1MTBQ7NaAmvXDfvNxbvWV3x2y6CdEUciCSsDHDQZbhYaB8QEo2g==",
            "dev": true,
            "funding": [
                {
                    "type": "github",
                    "url": "https://github.com/sponsors/ai"
                }
            ],
            "bin": {
                "nanoid": "bin/nanoid.cjs"
            },
            "engines": {
                "node": "^10 || ^12 || ^13.7 || ^14 || >=15.0.1"
            }
        },
        "node_modules/natural-compare": {
            "version": "1.4.0",
            "resolved": "https://registry.npmjs.org/natural-compare/-/natural-compare-1.4.0.tgz",
            "integrity": "sha512-OWND8ei3VtNC9h7V60qff3SVobHr996CTwgxubgyQYEpg290h9J0buyECNNJexkFm5sOajh5G116RYA1c8ZMSw==",
            "dev": true
        },
        "node_modules/node-releases": {
            "version": "2.0.18",
            "resolved": "https://registry.npmjs.org/node-releases/-/node-releases-2.0.18.tgz",
            "integrity": "sha512-d9VeXT4SJ7ZeOqGX6R5EM022wpL+eWPooLI+5UpWn2jCT1aosUQEhQP214x33Wkwx3JQMvIm+tIoVOdodFS40g==",
            "dev": true
        },
        "node_modules/normalize-path": {
            "version": "3.0.0",
            "resolved": "https://registry.npmjs.org/normalize-path/-/normalize-path-3.0.0.tgz",
            "integrity": "sha512-6eZs5Ls3WtCisHWp9S2GUy8dqkpGi4BVSz3GaqiE6ezub0512ESztXUwUB6C6IKbQkY2Pnb/mD4WYojCRwcwLA==",
            "dev": true,
            "engines": {
                "node": ">=0.10.0"
            }
        },
        "node_modules/normalize-range": {
            "version": "0.1.2",
            "resolved": "https://registry.npmjs.org/normalize-range/-/normalize-range-0.1.2.tgz",
            "integrity": "sha512-bdok/XvKII3nUpklnV6P2hxtMNrCboOjAcyBuQnWEhO665FwrSNRxU+AqpsyvO6LgGYPspN+lu5CLtw4jPRKNA==",
            "dev": true,
            "engines": {
                "node": ">=0.10.0"
            }
        },
        "node_modules/object-assign": {
            "version": "4.1.1",
            "resolved": "https://registry.npmjs.org/object-assign/-/object-assign-4.1.1.tgz",
            "integrity": "sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==",
            "dev": true,
            "engines": {
                "node": ">=0.10.0"
            }
        },
        "node_modules/object-hash": {
            "version": "3.0.0",
            "resolved": "https://registry.npmjs.org/object-hash/-/object-hash-3.0.0.tgz",
            "integrity": "sha512-RSn9F68PjH9HqtltsSnqYC1XXoWe9Bju5+213R98cNGttag9q9yAOTzdbsqvIa7aNm5WffBZFpWYr2aWrklWAw==",
            "dev": true,
            "engines": {
                "node": ">= 6"
            }
        },
        "node_modules/optionator": {
            "version": "0.9.4",
            "resolved": "https://registry.npmjs.org/optionator/-/optionator-0.9.4.tgz",
            "integrity": "sha512-6IpQ7mKUxRcZNLIObR0hz7lxsapSSIYNZJwXPGeF0mTVqGKFIXj1DQcMoT22S3ROcLyY/rz0PWaWZ9ayWmad9g==",
            "dev": true,
            "dependencies": {
                "deep-is": "^0.1.3",
                "fast-levenshtein": "^2.0.6",
                "levn": "^0.4.1",
                "prelude-ls": "^1.2.1",
                "type-check": "^0.4.0",
                "word-wrap": "^1.2.5"
            },
            "engines": {
                "node": ">= 0.8.0"
            }
        },
        "node_modules/p-limit": {
            "version": "3.1.0",
            "resolved": "https://registry.npmjs.org/p-limit/-/p-limit-3.1.0.tgz",
            "integrity": "sha512-TYOanM3wGwNGsZN2cVTYPArw454xnXj5qmWF1bEoAc4+cU/ol7GVh7odevjp1FNHduHc3KZMcFduxU5Xc6uJRQ==",
            "dev": true,
            "dependencies": {
                "yocto-queue": "^0.1.0"
            },
            "engines": {
                "node": ">=10"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        },
        "node_modules/p-locate": {
            "version": "5.0.0",
            "resolved": "https://registry.npmjs.org/p-locate/-/p-locate-5.0.0.tgz",
            "integrity": "sha512-LaNjtRWUBY++zB5nE/NwcaoMylSPk+S+ZHNB1TzdbMJMny6dynpAGt7X/tl/QYq3TIeE6nxHppbo2LGymrG5Pw==",
            "dev": true,
            "dependencies": {
                "p-limit": "^3.0.2"
            },
            "engines": {
                "node": ">=10"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        },
        "node_modules/package-json-from-dist": {
            "version": "1.0.1",
            "resolved": "https://registry.npmjs.org/package-json-from-dist/-/package-json-from-dist-1.0.1.tgz",
            "integrity": "sha512-UEZIS3/by4OC8vL3P2dTXRETpebLI2NiI5vIrjaD/5UtrkFX/tNbwjTSRAGC/+7CAo2pIcBaRgWmcBBHcsaCIw==",
            "dev": true
        },
        "node_modules/parent-module": {
            "version": "1.0.1",
            "resolved": "https://registry.npmjs.org/parent-module/-/parent-module-1.0.1.tgz",
            "integrity": "sha512-GQ2EWRpQV8/o+Aw8YqtfZZPfNRWZYkbidE9k5rpl/hC3vtHHBfGm2Ifi6qWV+coDGkrUKZAxE3Lot5kcsRlh+g==",
            "dev": true,
            "dependencies": {
                "callsites": "^3.0.0"
            },
            "engines": {
                "node": ">=6"
            }
        },
        "node_modules/path-exists": {
            "version": "4.0.0",
            "resolved": "https://registry.npmjs.org/path-exists/-/path-exists-4.0.0.tgz",
            "integrity": "sha512-ak9Qy5Q7jYb2Wwcey5Fpvg2KoAc/ZIhLSLOSBmRmygPsGwkVVt0fZa0qrtMz+m6tJTAHfZQ8FnmB4MG4LWy7/w==",
            "dev": true,
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/path-key": {
            "version": "3.1.1",
            "resolved": "https://registry.npmjs.org/path-key/-/path-key-3.1.1.tgz",
            "integrity": "sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==",
            "dev": true,
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/path-parse": {
            "version": "1.0.7",
            "resolved": "https://registry.npmjs.org/path-parse/-/path-parse-1.0.7.tgz",
            "integrity": "sha512-LDJzPVEEEPR+y48z93A0Ed0yXb8pAByGWo/k5YYdYgpY2/2EsOsksJrq7lOHxryrVOn1ejG6oAp8ahvOIQD8sw==",
            "dev": true
        },
        "node_modules/path-scurry": {
            "version": "1.11.1",
            "resolved": "https://registry.npmjs.org/path-scurry/-/path-scurry-1.11.1.tgz",
            "integrity": "sha512-Xa4Nw17FS9ApQFJ9umLiJS4orGjm7ZzwUrwamcGQuHSzDyth9boKDaycYdDcZDuqYATXw4HFXgaqWTctW/v1HA==",
            "dev": true,
            "dependencies": {
                "lru-cache": "^10.2.0",
                "minipass": "^5.0.0 || ^6.0.2 || ^7.0.0"
            },
            "engines": {
                "node": ">=16 || 14 >=14.18"
            },
            "funding": {
                "url": "https://github.com/sponsors/isaacs"
            }
        },
        "node_modules/path-scurry/node_modules/lru-cache": {
            "version": "10.4.3",
            "resolved": "https://registry.npmjs.org/lru-cache/-/lru-cache-10.4.3.tgz",
            "integrity": "sha512-JNAzZcXrCt42VGLuYz0zfAzDfAvJWW6AfYlDBQyDV5DClI2m5sAmK+OIO7s59XfsRsWHp02jAJrRadPRGTt6SQ==",
            "dev": true
        },
        "node_modules/picocolors": {
            "version": "1.1.1",
            "resolved": "https://registry.npmjs.org/picocolors/-/picocolors-1.1.1.tgz",
            "integrity": "sha512-xceH2snhtb5M9liqDsmEw56le376mTZkEX/jEb/RxNFyegNul7eNslCXP9FDj/Lcu0X8KEyMceP2ntpaHrDEVA==",
            "dev": true
        },
        "node_modules/picomatch": {
            "version": "2.3.1",
            "resolved": "https://registry.npmjs.org/picomatch/-/picomatch-2.3.1.tgz",
            "integrity": "sha512-JU3teHTNjmE2VCGFzuY8EXzCDVwEqB2a8fsIvwaStHhAWJEeVd1o1QD80CU6+ZdEXXSLbSsuLwJjkCBWqRQUVA==",
            "dev": true,
            "engines": {
                "node": ">=8.6"
            },
            "funding": {
                "url": "https://github.com/sponsors/jonschlinkert"
            }
        },
        "node_modules/pify": {
            "version": "2.3.0",
            "resolved": "https://registry.npmjs.org/pify/-/pify-2.3.0.tgz",
            "integrity": "sha512-udgsAY+fTnvv7kI7aaxbqwWNb0AHiB0qBO89PZKPkoTmGOgdbrHDKD+0B2X4uTfJ/FT1R09r9gTsjUjNJotuog==",
            "dev": true,
            "engines": {
                "node": ">=0.10.0"
            }
        },
        "node_modules/pirates": {
            "version": "4.0.6",
            "resolved": "https://registry.npmjs.org/pirates/-/pirates-4.0.6.tgz",
            "integrity": "sha512-saLsH7WeYYPiD25LDuLRRY/i+6HaPYr6G1OUlN39otzkSTxKnubR9RTxS3/Kk50s1g2JTgFwWQDQyplC5/SHZg==",
            "dev": true,
            "engines": {
                "node": ">= 6"
            }
        },
        "node_modules/postcss": {
            "version": "8.4.47",
            "resolved": "https://registry.npmjs.org/postcss/-/postcss-8.4.47.tgz",
            "integrity": "sha512-56rxCq7G/XfB4EkXq9Egn5GCqugWvDFjafDOThIdMBsI15iqPqR5r15TfSr1YPYeEI19YeaXMCbY6u88Y76GLQ==",
            "dev": true,
            "funding": [
                {
                    "type": "opencollective",
                    "url": "https://opencollective.com/postcss/"
                },
                {
                    "type": "tidelift",
                    "url": "https://tidelift.com/funding/github/npm/postcss"
                },
                {
                    "type": "github",
                    "url": "https://github.com/sponsors/ai"
                }
            ],
            "dependencies": {
                "nanoid": "^3.3.7",
                "picocolors": "^1.1.0",
                "source-map-js": "^1.2.1"
            },
            "engines": {
                "node": "^10 || ^12 || >=14"
            }
        },
        "node_modules/postcss-import": {
            "version": "15.1.0",
            "resolved": "https://registry.npmjs.org/postcss-import/-/postcss-import-15.1.0.tgz",
            "integrity": "sha512-hpr+J05B2FVYUAXHeK1YyI267J/dDDhMU6B6civm8hSY1jYJnBXxzKDKDswzJmtLHryrjhnDjqqp/49t8FALew==",
            "dev": true,
            "dependencies": {
                "postcss-value-parser": "^4.0.0",
                "read-cache": "^1.0.0",
                "resolve": "^1.1.7"
            },
            "engines": {
                "node": ">=14.0.0"
            },
            "peerDependencies": {
                "postcss": "^8.0.0"
            }
        },
        "node_modules/postcss-js": {
            "version": "4.0.1",
            "resolved": "https://registry.npmjs.org/postcss-js/-/postcss-js-4.0.1.tgz",
            "integrity": "sha512-dDLF8pEO191hJMtlHFPRa8xsizHaM82MLfNkUHdUtVEV3tgTp5oj+8qbEqYM57SLfc74KSbw//4SeJma2LRVIw==",
            "dev": true,
            "dependencies": {
                "camelcase-css": "^2.0.1"
            },
            "engines": {
                "node": "^12 || ^14 || >= 16"
            },
            "funding": {
                "type": "opencollective",
                "url": "https://opencollective.com/postcss/"
            },
            "peerDependencies": {
                "postcss": "^8.4.21"
            }
        },
        "node_modules/postcss-load-config": {
            "version": "4.0.2",
            "resolved": "https://registry.npmjs.org/postcss-load-config/-/postcss-load-config-4.0.2.tgz",
            "integrity": "sha512-bSVhyJGL00wMVoPUzAVAnbEoWyqRxkjv64tUl427SKnPrENtq6hJwUojroMz2VB+Q1edmi4IfrAPpami5VVgMQ==",
            "dev": true,
            "funding": [
                {
                    "type": "opencollective",
                    "url": "https://opencollective.com/postcss/"
                },
                {
                    "type": "github",
                    "url": "https://github.com/sponsors/ai"
                }
            ],
            "dependencies": {
                "lilconfig": "^3.0.0",
                "yaml": "^2.3.4"
            },
            "engines": {
                "node": ">= 14"
            },
            "peerDependencies": {
                "postcss": ">=8.0.9",
                "ts-node": ">=9.0.0"
            },
            "peerDependenciesMeta": {
                "postcss": {
                    "optional": true
                },
                "ts-node": {
                    "optional": true
                }
            }
        },
        "node_modules/postcss-nested": {
            "version": "6.2.0",
            "resolved": "https://registry.npmjs.org/postcss-nested/-/postcss-nested-6.2.0.tgz",
            "integrity": "sha512-HQbt28KulC5AJzG+cZtj9kvKB93CFCdLvog1WFLf1D+xmMvPGlBstkpTEZfK5+AN9hfJocyBFCNiqyS48bpgzQ==",
            "dev": true,
            "funding": [
                {
                    "type": "opencollective",
                    "url": "https://opencollective.com/postcss/"
                },
                {
                    "type": "github",
                    "url": "https://github.com/sponsors/ai"
                }
            ],
            "dependencies": {
                "postcss-selector-parser": "^6.1.1"
            },
            "engines": {
                "node": ">=12.0"
            },
            "peerDependencies": {
                "postcss": "^8.2.14"
            }
        },
        "node_modules/postcss-selector-parser": {
            "version": "6.1.2",
            "resolved": "https://registry.npmjs.org/postcss-selector-parser/-/postcss-selector-parser-6.1.2.tgz",
            "integrity": "sha512-Q8qQfPiZ+THO/3ZrOrO0cJJKfpYCagtMUkXbnEfmgUjwXg6z/WBeOyS9APBBPCTSiDV+s4SwQGu8yFsiMRIudg==",
            "dev": true,
            "dependencies": {
                "cssesc": "^3.0.0",
                "util-deprecate": "^1.0.2"
            },
            "engines": {
                "node": ">=4"
            }
        },
        "node_modules/postcss-value-parser": {
            "version": "4.2.0",
            "resolved": "https://registry.npmjs.org/postcss-value-parser/-/postcss-value-parser-4.2.0.tgz",
            "integrity": "sha512-1NNCs6uurfkVbeXG4S8JFT9t19m45ICnif8zWLd5oPSZ50QnwMfK+H3jv408d4jw/7Bttv5axS5IiHoLaVNHeQ==",
            "dev": true
        },
        "node_modules/prelude-ls": {
            "version": "1.2.1",
            "resolved": "https://registry.npmjs.org/prelude-ls/-/prelude-ls-1.2.1.tgz",
            "integrity": "sha512-vkcDPrRZo1QZLbn5RLGPpg/WmIQ65qoWWhcGKf/b5eplkkarX0m9z8ppCat4mlOqUsWpyNuYgO3VRyrYHSzX5g==",
            "dev": true,
            "engines": {
                "node": ">= 0.8.0"
            }
        },
        "node_modules/punycode": {
            "version": "2.3.1",
            "resolved": "https://registry.npmjs.org/punycode/-/punycode-2.3.1.tgz",
            "integrity": "sha512-vYt7UD1U9Wg6138shLtLOvdAu+8DsC/ilFtEVHcH+wydcSpNE20AfSOduf6MkRFahL5FY7X1oU7nKVZFtfq8Fg==",
            "dev": true,
            "engines": {
                "node": ">=6"
            }
        },
        "node_modules/queue-microtask": {
            "version": "1.2.3",
            "resolved": "https://registry.npmjs.org/queue-microtask/-/queue-microtask-1.2.3.tgz",
            "integrity": "sha512-NuaNSa6flKT5JaSYQzJok04JzTL1CA6aGhv5rfLW3PgqA+M2ChpZQnAC8h8i4ZFkBS8X5RqkDBHA7r4hej3K9A==",
            "dev": true,
            "funding": [
                {
                    "type": "github",
                    "url": "https://github.com/sponsors/feross"
                },
                {
                    "type": "patreon",
                    "url": "https://www.patreon.com/feross"
                },
                {
                    "type": "consulting",
                    "url": "https://feross.org/support"
                }
            ]
        },
        "node_modules/react": {
            "version": "18.3.1",
            "resolved": "https://registry.npmjs.org/react/-/react-18.3.1.tgz",
            "integrity": "sha512-wS+hAgJShR0KhEvPJArfuPVN1+Hz1t0Y6n5jLrGQbkb4urgPE/0Rve+1kMB1v/oWgHgm4WIcV+i7F2pTVj+2iQ==",
            "dependencies": {
                "loose-envify": "^1.1.0"
            },
            "engines": {
                "node": ">=0.10.0"
            }
        },
        "node_modules/react-dom": {
            "version": "18.3.1",
            "resolved": "https://registry.npmjs.org/react-dom/-/react-dom-18.3.1.tgz",
            "integrity": "sha512-5m4nQKp+rZRb09LNH59GM4BxTh9251/ylbKIbpe7TpGxfJ+9kv6BLkLBXIjjspbgbnIBNqlI23tRnTWT0snUIw==",
            "dependencies": {
                "loose-envify": "^1.1.0",
                "scheduler": "^0.23.2"
            },
            "peerDependencies": {
                "react": "^18.3.1"
            }
        },
        "node_modules/react-is": {
            "version": "19.2.0",
            "resolved": "https://registry.npmjs.org/react-is/-/react-is-19.2.0.tgz",
            "integrity": "sha512-x3Ax3kNSMIIkyVYhWPyO09bu0uttcAIoecO/um/rKGQ4EltYWVYtyiGkS/3xMynrbVQdS69Jhlv8FXUEZehlzA==",
            "peer": true
        },
        "node_modules/react-redux": {
            "version": "9.2.0",
            "resolved": "https://registry.npmjs.org/react-redux/-/react-redux-9.2.0.tgz",
            "integrity": "sha512-ROY9fvHhwOD9ySfrF0wmvu//bKCQ6AeZZq1nJNtbDC+kk5DuSuNX/n6YWYF/SYy7bSba4D4FSz8DJeKY/S/r+g==",
            "dependencies": {
                "@types/use-sync-external-store": "^0.0.6",
                "use-sync-external-store": "^1.4.0"
            },
            "peerDependencies": {
                "@types/react": "^18.2.25 || ^19",
                "react": "^18.0 || ^19",
                "redux": "^5.0.0"
            },
            "peerDependenciesMeta": {
                "@types/react": {
                    "optional": true
                },
                "redux": {
                    "optional": true
                }
            }
        },
        "node_modules/react-refresh": {
            "version": "0.14.2",
            "resolved": "https://registry.npmjs.org/react-refresh/-/react-refresh-0.14.2.tgz",
            "integrity": "sha512-jCvmsr+1IUSMUyzOkRcvnVbX3ZYC6g9TDrDbFuFmRDq7PD4yaGbLKNQL6k2jnArV8hjYxh7hVhAZB6s9HDGpZA==",
            "dev": true,
            "engines": {
                "node": ">=0.10.0"
            }
        },
        "node_modules/react-router": {
            "version": "7.9.6",
            "resolved": "https://registry.npmjs.org/react-router/-/react-router-7.9.6.tgz",
            "integrity": "sha512-Y1tUp8clYRXpfPITyuifmSoE2vncSME18uVLgaqyxh9H35JWpIfzHo+9y3Fzh5odk/jxPW29IgLgzcdwxGqyNA==",
            "dependencies": {
                "cookie": "^1.0.1",
                "set-cookie-parser": "^2.6.0"
            },
            "engines": {
                "node": ">=20.0.0"
            },
            "peerDependencies": {
                "react": ">=18",
                "react-dom": ">=18"
            },
            "peerDependenciesMeta": {
                "react-dom": {
                    "optional": true
                }
            }
        },
        "node_modules/react-router-dom": {
            "version": "7.9.6",
            "resolved": "https://registry.npmjs.org/react-router-dom/-/react-router-dom-7.9.6.tgz",
            "integrity": "sha512-2MkC2XSXq6HjGcihnx1s0DBWQETI4mlis4Ux7YTLvP67xnGxCvq+BcCQSO81qQHVUTM1V53tl4iVVaY5sReCOA==",
            "dependencies": {
                "react-router": "7.9.6"
            },
            "engines": {
                "node": ">=20.0.0"
            },
            "peerDependencies": {
                "react": ">=18",
                "react-dom": ">=18"
            }
        },
        "node_modules/read-cache": {
            "version": "1.0.0",
            "resolved": "https://registry.npmjs.org/read-cache/-/read-cache-1.0.0.tgz",
            "integrity": "sha512-Owdv/Ft7IjOgm/i0xvNDZ1LrRANRfew4b2prF3OWMQLxLfu3bS8FVhCsrSCMK4lR56Y9ya+AThoTpDCTxCmpRA==",
            "dev": true,
            "dependencies": {
                "pify": "^2.3.0"
            }
        },
        "node_modules/readdirp": {
            "version": "3.6.0",
            "resolved": "https://registry.npmjs.org/readdirp/-/readdirp-3.6.0.tgz",
            "integrity": "sha512-hOS089on8RduqdbhvQ5Z37A0ESjsqz6qnRcffsMU3495FuTdqSm+7bhJ29JvIOsBDEEnan5DPu9t3To9VRlMzA==",
            "dev": true,
            "dependencies": {
                "picomatch": "^2.2.1"
            },
            "engines": {
                "node": ">=8.10.0"
            }
        },
        "node_modules/recharts": {
            "version": "3.4.1",
            "resolved": "https://registry.npmjs.org/recharts/-/recharts-3.4.1.tgz",
            "integrity": "sha512-35kYg6JoOgwq8sE4rhYkVWwa6aAIgOtT+Ob0gitnShjwUwZmhrmy7Jco/5kJNF4PnLXgt9Hwq+geEMS+WrjU1g==",
            "dependencies": {
                "@reduxjs/toolkit": "1.x.x || 2.x.x",
                "clsx": "^2.1.1",
                "decimal.js-light": "^2.5.1",
                "es-toolkit": "^1.39.3",
                "eventemitter3": "^5.0.1",
                "immer": "^10.1.1",
                "react-redux": "8.x.x || 9.x.x",
                "reselect": "5.1.1",
                "tiny-invariant": "^1.3.3",
                "use-sync-external-store": "^1.2.2",
                "victory-vendor": "^37.0.2"
            },
            "engines": {
                "node": ">=18"
            },
            "peerDependencies": {
                "react": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0",
                "react-dom": "^16.0.0 || ^17.0.0 || ^18.0.0 || ^19.0.0",
                "react-is": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0"
            }
        },
        "node_modules/redux": {
            "version": "5.0.1",
            "resolved": "https://registry.npmjs.org/redux/-/redux-5.0.1.tgz",
            "integrity": "sha512-M9/ELqF6fy8FwmkpnF0S3YKOqMyoWJ4+CS5Efg2ct3oY9daQvd/Pc71FpGZsVsbl3Cpb+IIcjBDUnnyBdQbq4w=="
        },
        "node_modules/redux-thunk": {
            "version": "3.1.0",
            "resolved": "https://registry.npmjs.org/redux-thunk/-/redux-thunk-3.1.0.tgz",
            "integrity": "sha512-NW2r5T6ksUKXCabzhL9z+h206HQw/NJkcLm1GPImRQ8IzfXwRGqjVhKJGauHirT0DAuyy6hjdnMZaRoAcy0Klw==",
            "peerDependencies": {
                "redux": "^5.0.0"
            }
        },
        "node_modules/reselect": {
            "version": "5.1.1",
            "resolved": "https://registry.npmjs.org/reselect/-/reselect-5.1.1.tgz",
            "integrity": "sha512-K/BG6eIky/SBpzfHZv/dd+9JBFiS4SWV7FIujVyJRux6e45+73RaUHXLmIR1f7WOMaQ0U1km6qwklRQxpJJY0w=="
        },
        "node_modules/resolve": {
            "version": "1.22.8",
            "resolved": "https://registry.npmjs.org/resolve/-/resolve-1.22.8.tgz",
            "integrity": "sha512-oKWePCxqpd6FlLvGV1VU0x7bkPmmCNolxzjMf4NczoDnQcIWrAF+cPtZn5i6n+RfD2d9i0tzpKnG6Yk168yIyw==",
            "dev": true,
            "dependencies": {
                "is-core-module": "^2.13.0",
                "path-parse": "^1.0.7",
                "supports-preserve-symlinks-flag": "^1.0.0"
            },
            "bin": {
                "resolve": "bin/resolve"
            },
            "funding": {
                "url": "https://github.com/sponsors/ljharb"
            }
        },
        "node_modules/resolve-from": {
            "version": "4.0.0",
            "resolved": "https://registry.npmjs.org/resolve-from/-/resolve-from-4.0.0.tgz",
            "integrity": "sha512-pb/MYmXstAkysRFx8piNI1tGFNQIFA3vkE3Gq4EuA1dF6gHp/+vgZqsCGJapvy8N3Q+4o7FwvquPJcnZ7RYy4g==",
            "dev": true,
            "engines": {
                "node": ">=4"
            }
        },
        "node_modules/reusify": {
            "version": "1.0.4",
            "resolved": "https://registry.npmjs.org/reusify/-/reusify-1.0.4.tgz",
            "integrity": "sha512-U9nH88a3fc/ekCF1l0/UP1IosiuIjyTh7hBvXVMHYgVcfGvt897Xguj2UOLDeI5BG2m7/uwyaLVT6fbtCwTyzw==",
            "dev": true,
            "engines": {
                "iojs": ">=1.0.0",
                "node": ">=0.10.0"
            }
        },
        "node_modules/rollup": {
            "version": "4.24.0",
            "resolved": "https://registry.npmjs.org/rollup/-/rollup-4.24.0.tgz",
            "integrity": "sha512-DOmrlGSXNk1DM0ljiQA+i+o0rSLhtii1je5wgk60j49d1jHT5YYttBv1iWOnYSTG+fZZESUOSNiAl89SIet+Cg==",
            "dev": true,
            "dependencies": {
                "@types/estree": "1.0.6"
            },
            "bin": {
                "rollup": "dist/bin/rollup"
            },
            "engines": {
                "node": ">=18.0.0",
                "npm": ">=8.0.0"
            },
            "optionalDependencies": {
                "@rollup/rollup-android-arm-eabi": "4.24.0",
                "@rollup/rollup-android-arm64": "4.24.0",
                "@rollup/rollup-darwin-arm64": "4.24.0",
                "@rollup/rollup-darwin-x64": "4.24.0",
                "@rollup/rollup-linux-arm-gnueabihf": "4.24.0",
                "@rollup/rollup-linux-arm-musleabihf": "4.24.0",
                "@rollup/rollup-linux-arm64-gnu": "4.24.0",
                "@rollup/rollup-linux-arm64-musl": "4.24.0",
                "@rollup/rollup-linux-powerpc64le-gnu": "4.24.0",
                "@rollup/rollup-linux-riscv64-gnu": "4.24.0",
                "@rollup/rollup-linux-s390x-gnu": "4.24.0",
                "@rollup/rollup-linux-x64-gnu": "4.24.0",
                "@rollup/rollup-linux-x64-musl": "4.24.0",
                "@rollup/rollup-win32-arm64-msvc": "4.24.0",
                "@rollup/rollup-win32-ia32-msvc": "4.24.0",
                "@rollup/rollup-win32-x64-msvc": "4.24.0",
                "fsevents": "~2.3.2"
            }
        },
        "node_modules/run-parallel": {
            "version": "1.2.0",
            "resolved": "https://registry.npmjs.org/run-parallel/-/run-parallel-1.2.0.tgz",
            "integrity": "sha512-5l4VyZR86LZ/lDxZTR6jqL8AFE2S0IFLMP26AbjsLVADxHdhB/c0GUsH+y39UfCi3dzz8OlQuPmnaJOMoDHQBA==",
            "dev": true,
            "funding": [
                {
                    "type": "github",
                    "url": "https://github.com/sponsors/feross"
                },
                {
                    "type": "patreon",
                    "url": "https://www.patreon.com/feross"
                },
                {
                    "type": "consulting",
                    "url": "https://feross.org/support"
                }
            ],
            "dependencies": {
                "queue-microtask": "^1.2.2"
            }
        },
        "node_modules/scheduler": {
            "version": "0.23.2",
            "resolved": "https://registry.npmjs.org/scheduler/-/scheduler-0.23.2.tgz",
            "integrity": "sha512-UOShsPwz7NrMUqhR6t0hWjFduvOzbtv7toDH1/hIrfRNIDBnnBWd0CwJTGvTpngVlmwGCdP9/Zl/tVrDqcuYzQ==",
            "dependencies": {
                "loose-envify": "^1.1.0"
            }
        },
        "node_modules/semver": {
            "version": "6.3.1",
            "resolved": "https://registry.npmjs.org/semver/-/semver-6.3.1.tgz",
            "integrity": "sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==",
            "dev": true,
            "bin": {
                "semver": "bin/semver.js"
            }
        },
        "node_modules/set-cookie-parser": {
            "version": "2.7.2",
            "resolved": "https://registry.npmjs.org/set-cookie-parser/-/set-cookie-parser-2.7.2.tgz",
            "integrity": "sha512-oeM1lpU/UvhTxw+g3cIfxXHyJRc/uidd3yK1P242gzHds0udQBYzs3y8j4gCCW+ZJ7ad0yctld8RYO+bdurlvw=="
        },
        "node_modules/shebang-command": {
            "version": "2.0.0",
            "resolved": "https://registry.npmjs.org/shebang-command/-/shebang-command-2.0.0.tgz",
            "integrity": "sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==",
            "dev": true,
            "dependencies": {
                "shebang-regex": "^3.0.0"
            },
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/shebang-regex": {
            "version": "3.0.0",
            "resolved": "https://registry.npmjs.org/shebang-regex/-/shebang-regex-3.0.0.tgz",
            "integrity": "sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==",
            "dev": true,
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/signal-exit": {
            "version": "4.1.0",
            "resolved": "https://registry.npmjs.org/signal-exit/-/signal-exit-4.1.0.tgz",
            "integrity": "sha512-bzyZ1e88w9O1iNJbKnOlvYTrWPDl46O1bG0D3XInv+9tkPrxrN8jUUTiFlDkkmKWgn1M6CfIA13SuGqOa9Korw==",
            "dev": true,
            "engines": {
                "node": ">=14"
            },
            "funding": {
                "url": "https://github.com/sponsors/isaacs"
            }
        },
        "node_modules/source-map-js": {
            "version": "1.2.1",
            "resolved": "https://registry.npmjs.org/source-map-js/-/source-map-js-1.2.1.tgz",
            "integrity": "sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==",
            "dev": true,
            "engines": {
                "node": ">=0.10.0"
            }
        },
        "node_modules/state-local": {
            "version": "1.0.7",
            "resolved": "https://registry.npmjs.org/state-local/-/state-local-1.0.7.tgz",
            "integrity": "sha512-HTEHMNieakEnoe33shBYcZ7NX83ACUjCu8c40iOGEZsngj9zRnkqS9j1pqQPXwobB0ZcVTk27REb7COQ0UR59w=="
        },
        "node_modules/string-width": {
            "version": "5.1.2",
            "resolved": "https://registry.npmjs.org/string-width/-/string-width-5.1.2.tgz",
            "integrity": "sha512-HnLOCR3vjcY8beoNLtcjZ5/nxn2afmME6lhrDrebokqMap+XbeW8n9TXpPDOqdGK5qcI3oT0GKTW6wC7EMiVqA==",
            "dev": true,
            "dependencies": {
                "eastasianwidth": "^0.2.0",
                "emoji-regex": "^9.2.2",
                "strip-ansi": "^7.0.1"
            },
            "engines": {
                "node": ">=12"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        },
        "node_modules/string-width-cjs": {
            "name": "string-width",
            "version": "4.2.3",
            "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
            "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
            "dev": true,
            "dependencies": {
                "emoji-regex": "^8.0.0",
                "is-fullwidth-code-point": "^3.0.0",
                "strip-ansi": "^6.0.1"
            },
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/string-width-cjs/node_modules/ansi-regex": {
            "version": "5.0.1",
            "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz",
            "integrity": "sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==",
            "dev": true,
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/string-width-cjs/node_modules/emoji-regex": {
            "version": "8.0.0",
            "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-8.0.0.tgz",
            "integrity": "sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==",
            "dev": true
        },
        "node_modules/string-width-cjs/node_modules/strip-ansi": {
            "version": "6.0.1",
            "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
            "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",
            "dev": true,
            "dependencies": {
                "ansi-regex": "^5.0.1"
            },
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/strip-ansi": {
            "version": "7.1.0",
            "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-7.1.0.tgz",
            "integrity": "sha512-iq6eVVI64nQQTRYq2KtEg2d2uU7LElhTJwsH4YzIHZshxlgZms/wIc4VoDQTlG/IvVIrBKG06CrZnp0qv7hkcQ==",
            "dev": true,
            "dependencies": {
                "ansi-regex": "^6.0.1"
            },
            "engines": {
                "node": ">=12"
            },
            "funding": {
                "url": "https://github.com/chalk/strip-ansi?sponsor=1"
            }
        },
        "node_modules/strip-ansi-cjs": {
            "name": "strip-ansi",
            "version": "6.0.1",
            "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
            "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",
            "dev": true,
            "dependencies": {
                "ansi-regex": "^5.0.1"
            },
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/strip-ansi-cjs/node_modules/ansi-regex": {
            "version": "5.0.1",
            "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz",
            "integrity": "sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==",
            "dev": true,
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/strip-json-comments": {
            "version": "3.1.1",
            "resolved": "https://registry.npmjs.org/strip-json-comments/-/strip-json-comments-3.1.1.tgz",
            "integrity": "sha512-6fPc+R4ihwqP6N/aIv2f1gMH8lOVtWQHoqC4yK6oSDVVocumAsfCqjkXnqiYMhmMwS/mEHLp7Vehlt3ql6lEig==",
            "dev": true,
            "engines": {
                "node": ">=8"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        },
        "node_modules/sucrase": {
            "version": "3.35.0",
            "resolved": "https://registry.npmjs.org/sucrase/-/sucrase-3.35.0.tgz",
            "integrity": "sha512-8EbVDiu9iN/nESwxeSxDKe0dunta1GOlHufmSSXxMD2z2/tMZpDMpvXQGsc+ajGo8y2uYUmixaSRUc/QPoQ0GA==",
            "dev": true,
            "dependencies": {
                "@jridgewell/gen-mapping": "^0.3.2",
                "commander": "^4.0.0",
                "glob": "^10.3.10",
                "lines-and-columns": "^1.1.6",
                "mz": "^2.7.0",
                "pirates": "^4.0.1",
                "ts-interface-checker": "^0.1.9"
            },
            "bin": {
                "sucrase": "bin/sucrase",
                "sucrase-node": "bin/sucrase-node"
            },
            "engines": {
                "node": ">=16 || 14 >=14.17"
            }
        },
        "node_modules/supports-color": {
            "version": "5.5.0",
            "resolved": "https://registry.npmjs.org/supports-color/-/supports-color-5.5.0.tgz",
            "integrity": "sha512-QjVjwdXIt408MIiAqCX4oUKsgU2EqAGzs2Ppkm4aQYbjm+ZEWEcW4SfFNTr4uMNZma0ey4f5lgLrkB0aX0QMow==",
            "dev": true,
            "dependencies": {
                "has-flag": "^3.0.0"
            },
            "engines": {
                "node": ">=4"
            }
        },
        "node_modules/supports-preserve-symlinks-flag": {
            "version": "1.0.0",
            "resolved": "https://registry.npmjs.org/supports-preserve-symlinks-flag/-/supports-preserve-symlinks-flag-1.0.0.tgz",
            "integrity": "sha512-ot0WnXS9fgdkgIcePe6RHNk1WA8+muPa6cSjeR3V8K27q9BB1rTE3R1p7Hv0z1ZyAc8s6Vvv8DIyWf681MAt0w==",
            "dev": true,
            "engines": {
                "node": ">= 0.4"
            },
            "funding": {
                "url": "https://github.com/sponsors/ljharb"
            }
        },
        "node_modules/tailwindcss": {
            "version": "3.4.17",
            "resolved": "https://registry.npmjs.org/tailwindcss/-/tailwindcss-3.4.17.tgz",
            "integrity": "sha512-w33E2aCvSDP0tW9RZuNXadXlkHXqFzSkQew/aIa2i/Sj8fThxwovwlXHSPXTbAHwEIhBFXAedUhP2tueAKP8Og==",
            "dev": true,
            "dependencies": {
                "@alloc/quick-lru": "^5.2.0",
                "arg": "^5.0.2",
                "chokidar": "^3.6.0",
                "didyoumean": "^1.2.2",
                "dlv": "^1.1.3",
                "fast-glob": "^3.3.2",
                "glob-parent": "^6.0.2",
                "is-glob": "^4.0.3",
                "jiti": "^1.21.6",
                "lilconfig": "^3.1.3",
                "micromatch": "^4.0.8",
                "normalize-path": "^3.0.0",
                "object-hash": "^3.0.0",
                "picocolors": "^1.1.1",
                "postcss": "^8.4.47",
                "postcss-import": "^15.1.0",
                "postcss-js": "^4.0.1",
                "postcss-load-config": "^4.0.2",
                "postcss-nested": "^6.2.0",
                "postcss-selector-parser": "^6.1.2",
                "resolve": "^1.22.8",
                "sucrase": "^3.35.0"
            },
            "bin": {
                "tailwind": "lib/cli.js",
                "tailwindcss": "lib/cli.js"
            },
            "engines": {
                "node": ">=14.0.0"
            }
        },
        "node_modules/text-table": {
            "version": "0.2.0",
            "resolved": "https://registry.npmjs.org/text-table/-/text-table-0.2.0.tgz",
            "integrity": "sha512-N+8UisAXDGk8PFXP4HAzVR9nbfmVJ3zYLAWiTIoqC5v5isinhr+r5uaO8+7r3BMfuNIufIsA7RdpVgacC2cSpw==",
            "dev": true
        },
        "node_modules/thenify": {
            "version": "3.3.1",
            "resolved": "https://registry.npmjs.org/thenify/-/thenify-3.3.1.tgz",
            "integrity": "sha512-RVZSIV5IG10Hk3enotrhvz0T9em6cyHBLkH/YAZuKqd8hRkKhSfCGIcP2KUY0EPxndzANBmNllzWPwak+bheSw==",
            "dev": true,
            "dependencies": {
                "any-promise": "^1.0.0"
            }
        },
        "node_modules/thenify-all": {
            "version": "1.6.0",
            "resolved": "https://registry.npmjs.org/thenify-all/-/thenify-all-1.6.0.tgz",
            "integrity": "sha512-RNxQH/qI8/t3thXJDwcstUO4zeqo64+Uy/+sNVRBx4Xn2OX+OZ9oP+iJnNFqplFra2ZUVeKCSa2oVWi3T4uVmA==",
            "dev": true,
            "dependencies": {
                "thenify": ">= 3.1.0 < 4"
            },
            "engines": {
                "node": ">=0.8"
            }
        },
        "node_modules/tiny-invariant": {
            "version": "1.3.3",
            "resolved": "https://registry.npmjs.org/tiny-invariant/-/tiny-invariant-1.3.3.tgz",
            "integrity": "sha512-+FbBPE1o9QAYvviau/qC5SE3caw21q3xkvWKBtja5vgqOWIHHJ3ioaq1VPfn/Szqctz2bU/oYeKd9/z5BL+PVg=="
        },
        "node_modules/to-fast-properties": {
            "version": "2.0.0",
            "resolved": "https://registry.npmjs.org/to-fast-properties/-/to-fast-properties-2.0.0.tgz",
            "integrity": "sha512-/OaKK0xYrs3DmxRYqL/yDc+FxFUVYhDlXMhRmv3z915w2HF1tnN1omB354j8VUGO/hbRzyD6Y3sA7v7GS/ceog==",
            "dev": true,
            "engines": {
                "node": ">=4"
            }
        },
        "node_modules/to-regex-range": {
            "version": "5.0.1",
            "resolved": "https://registry.npmjs.org/to-regex-range/-/to-regex-range-5.0.1.tgz",
            "integrity": "sha512-65P7iz6X5yEr1cwcgvQxbbIw7Uk3gOy5dIdtZ4rDveLqhrdJP+Li/Hx6tyK0NEb+2GCyneCMJiGqrADCSNk8sQ==",
            "dev": true,
            "dependencies": {
                "is-number": "^7.0.0"
            },
            "engines": {
                "node": ">=8.0"
            }
        },
        "node_modules/ts-api-utils": {
            "version": "1.3.0",
            "resolved": "https://registry.npmjs.org/ts-api-utils/-/ts-api-utils-1.3.0.tgz",
            "integrity": "sha512-UQMIo7pb8WRomKR1/+MFVLTroIvDVtMX3K6OUir8ynLyzB8Jeriont2bTAtmNPa1ekAgN7YPDyf6V+ygrdU+eQ==",
            "dev": true,
            "engines": {
                "node": ">=16"
            },
            "peerDependencies": {
                "typescript": ">=4.2.0"
            }
        },
        "node_modules/ts-interface-checker": {
            "version": "0.1.13",
            "resolved": "https://registry.npmjs.org/ts-interface-checker/-/ts-interface-checker-0.1.13.tgz",
            "integrity": "sha512-Y/arvbn+rrz3JCKl9C4kVNfTfSm2/mEp5FSz5EsZSANGPSlQrpRI5M4PKF+mJnE52jOO90PnPSc3Ur3bTQw0gA==",
            "dev": true
        },
        "node_modules/type-check": {
            "version": "0.4.0",
            "resolved": "https://registry.npmjs.org/type-check/-/type-check-0.4.0.tgz",
            "integrity": "sha512-XleUoc9uwGXqjWwXaUTZAmzMcFZ5858QA2vvx1Ur5xIcixXIP+8LnFDgRplU30us6teqdlskFfu+ae4K79Ooew==",
            "dev": true,
            "dependencies": {
                "prelude-ls": "^1.2.1"
            },
            "engines": {
                "node": ">= 0.8.0"
            }
        },
        "node_modules/typescript": {
            "version": "5.6.3",
            "resolved": "https://registry.npmjs.org/typescript/-/typescript-5.6.3.tgz",
            "integrity": "sha512-hjcS1mhfuyi4WW8IWtjP7brDrG2cuDZukyrYrSauoXGNgx0S7zceP07adYkJycEr56BOUTNPzbInooiN3fn1qw==",
            "dev": true,
            "bin": {
                "tsc": "bin/tsc",
                "tsserver": "bin/tsserver"
            },
            "engines": {
                "node": ">=14.17"
            }
        },
        "node_modules/typescript-eslint": {
            "version": "8.8.1",
            "resolved": "https://registry.npmjs.org/typescript-eslint/-/typescript-eslint-8.8.1.tgz",
            "integrity": "sha512-R0dsXFt6t4SAFjUSKFjMh4pXDtq04SsFKCVGDP3ZOzNP7itF0jBcZYU4fMsZr4y7O7V7Nc751dDeESbe4PbQMQ==",
            "dev": true,
            "dependencies": {
                "@typescript-eslint/eslint-plugin": "8.8.1",
                "@typescript-eslint/parser": "8.8.1",
                "@typescript-eslint/utils": "8.8.1"
            },
            "engines": {
                "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
            },
            "funding": {
                "type": "opencollective",
                "url": "https://opencollective.com/typescript-eslint"
            },
            "peerDependenciesMeta": {
                "typescript": {
                    "optional": true
                }
            }
        },
        "node_modules/update-browserslist-db": {
            "version": "1.1.1",
            "resolved": "https://registry.npmjs.org/update-browserslist-db/-/update-browserslist-db-1.1.1.tgz",
            "integrity": "sha512-R8UzCaa9Az+38REPiJ1tXlImTJXlVfgHZsglwBD/k6nj76ctsH1E3q4doGrukiLQd3sGQYu56r5+lo5r94l29A==",
            "dev": true,
            "funding": [
                {
                    "type": "opencollective",
                    "url": "https://opencollective.com/browserslist"
                },
                {
                    "type": "tidelift",
                    "url": "https://tidelift.com/funding/github/npm/browserslist"
                },
                {
                    "type": "github",
                    "url": "https://github.com/sponsors/ai"
                }
            ],
            "dependencies": {
                "escalade": "^3.2.0",
                "picocolors": "^1.1.0"
            },
            "bin": {
                "update-browserslist-db": "cli.js"
            },
            "peerDependencies": {
                "browserslist": ">= 4.21.0"
            }
        },
        "node_modules/uri-js": {
            "version": "4.4.1",
            "resolved": "https://registry.npmjs.org/uri-js/-/uri-js-4.4.1.tgz",
            "integrity": "sha512-7rKUyy33Q1yc98pQ1DAmLtwX109F7TIfWlW1Ydo8Wl1ii1SeHieeh0HHfPeL2fMXK6z0s8ecKs9frCuLJvndBg==",
            "dev": true,
            "dependencies": {
                "punycode": "^2.1.0"
            }
        },
        "node_modules/use-sync-external-store": {
            "version": "1.6.0",
            "resolved": "https://registry.npmjs.org/use-sync-external-store/-/use-sync-external-store-1.6.0.tgz",
            "integrity": "sha512-Pp6GSwGP/NrPIrxVFAIkOQeyw8lFenOHijQWkUTrDvrF4ALqylP2C/KCkeS9dpUM3KvYRQhna5vt7IL95+ZQ9w==",
            "peerDependencies": {
                "react": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0"
            }
        },
        "node_modules/util-deprecate": {
            "version": "1.0.2",
            "resolved": "https://registry.npmjs.org/util-deprecate/-/util-deprecate-1.0.2.tgz",
            "integrity": "sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==",
            "dev": true
        },
        "node_modules/victory-vendor": {
            "version": "37.3.6",
            "resolved": "https://registry.npmjs.org/victory-vendor/-/victory-vendor-37.3.6.tgz",
            "integrity": "sha512-SbPDPdDBYp+5MJHhBCAyI7wKM3d5ivekigc2Dk2s7pgbZ9wIgIBYGVw4zGHBml/qTFbexrofXW6Gu4noGxrOwQ==",
            "dependencies": {
                "@types/d3-array": "^3.0.3",
                "@types/d3-ease": "^3.0.0",
                "@types/d3-interpolate": "^3.0.1",
                "@types/d3-scale": "^4.0.2",
                "@types/d3-shape": "^3.1.0",
                "@types/d3-time": "^3.0.0",
                "@types/d3-timer": "^3.0.0",
                "d3-array": "^3.1.6",
                "d3-ease": "^3.0.1",
                "d3-interpolate": "^3.0.1",
                "d3-scale": "^4.0.2",
                "d3-shape": "^3.1.0",
                "d3-time": "^3.0.0",
                "d3-timer": "^3.0.1"
            }
        },
        "node_modules/vite": {
            "version": "5.4.8",
            "resolved": "https://registry.npmjs.org/vite/-/vite-5.4.8.tgz",
            "integrity": "sha512-FqrItQ4DT1NC4zCUqMB4c4AZORMKIa0m8/URVCZ77OZ/QSNeJ54bU1vrFADbDsuwfIPcgknRkmqakQcgnL4GiQ==",
            "dev": true,
            "dependencies": {
                "esbuild": "^0.21.3",
                "postcss": "^8.4.43",
                "rollup": "^4.20.0"
            },
            "bin": {
                "vite": "bin/vite.js"
            },
            "engines": {
                "node": "^18.0.0 || >=20.0.0"
            },
            "funding": {
                "url": "https://github.com/vitejs/vite?sponsor=1"
            },
            "optionalDependencies": {
                "fsevents": "~2.3.3"
            },
            "peerDependencies": {
                "@types/node": "^18.0.0 || >=20.0.0",
                "less": "*",
                "lightningcss": "^1.21.0",
                "sass": "*",
                "sass-embedded": "*",
                "stylus": "*",
                "sugarss": "*",
                "terser": "^5.4.0"
            },
            "peerDependenciesMeta": {
                "@types/node": {
                    "optional": true
                },
                "less": {
                    "optional": true
                },
                "lightningcss": {
                    "optional": true
                },
                "sass": {
                    "optional": true
                },
                "sass-embedded": {
                    "optional": true
                },
                "stylus": {
                    "optional": true
                },
                "sugarss": {
                    "optional": true
                },
                "terser": {
                    "optional": true
                }
            }
        },
        "node_modules/which": {
            "version": "2.0.2",
            "resolved": "https://registry.npmjs.org/which/-/which-2.0.2.tgz",
            "integrity": "sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==",
            "dev": true,
            "dependencies": {
                "isexe": "^2.0.0"
            },
            "bin": {
                "node-which": "bin/node-which"
            },
            "engines": {
                "node": ">= 8"
            }
        },
        "node_modules/word-wrap": {
            "version": "1.2.5",
            "resolved": "https://registry.npmjs.org/word-wrap/-/word-wrap-1.2.5.tgz",
            "integrity": "sha512-BN22B5eaMMI9UMtjrGd5g5eCYPpCPDUy0FJXbYsaT5zYxjFOckS53SQDE3pWkVoWpHXVb3BrYcEN4Twa55B5cA==",
            "dev": true,
            "engines": {
                "node": ">=0.10.0"
            }
        },
        "node_modules/wrap-ansi": {
            "version": "8.1.0",
            "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-8.1.0.tgz",
            "integrity": "sha512-si7QWI6zUMq56bESFvagtmzMdGOtoxfR+Sez11Mobfc7tm+VkUckk9bW2UeffTGVUbOksxmSw0AA2gs8g71NCQ==",
            "dev": true,
            "dependencies": {
                "ansi-styles": "^6.1.0",
                "string-width": "^5.0.1",
                "strip-ansi": "^7.0.1"
            },
            "engines": {
                "node": ">=12"
            },
            "funding": {
                "url": "https://github.com/chalk/wrap-ansi?sponsor=1"
            }
        },
        "node_modules/wrap-ansi-cjs": {
            "name": "wrap-ansi",
            "version": "7.0.0",
            "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-7.0.0.tgz",
            "integrity": "sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==",
            "dev": true,
            "dependencies": {
                "ansi-styles": "^4.0.0",
                "string-width": "^4.1.0",
                "strip-ansi": "^6.0.0"
            },
            "engines": {
                "node": ">=10"
            },
            "funding": {
                "url": "https://github.com/chalk/wrap-ansi?sponsor=1"
            }
        },
        "node_modules/wrap-ansi-cjs/node_modules/ansi-regex": {
            "version": "5.0.1",
            "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz",
            "integrity": "sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==",
            "dev": true,
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/wrap-ansi-cjs/node_modules/ansi-styles": {
            "version": "4.3.0",
            "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz",
            "integrity": "sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==",
            "dev": true,
            "dependencies": {
                "color-convert": "^2.0.1"
            },
            "engines": {
                "node": ">=8"
            },
            "funding": {
                "url": "https://github.com/chalk/ansi-styles?sponsor=1"
            }
        },
        "node_modules/wrap-ansi-cjs/node_modules/color-convert": {
            "version": "2.0.1",
            "resolved": "https://registry.npmjs.org/color-convert/-/color-convert-2.0.1.tgz",
            "integrity": "sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==",
            "dev": true,
            "dependencies": {
                "color-name": "~1.1.4"
            },
            "engines": {
                "node": ">=7.0.0"
            }
        },
        "node_modules/wrap-ansi-cjs/node_modules/color-name": {
            "version": "1.1.4",
            "resolved": "https://registry.npmjs.org/color-name/-/color-name-1.1.4.tgz",
            "integrity": "sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==",
            "dev": true
        },
        "node_modules/wrap-ansi-cjs/node_modules/emoji-regex": {
            "version": "8.0.0",
            "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-8.0.0.tgz",
            "integrity": "sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==",
            "dev": true
        },
        "node_modules/wrap-ansi-cjs/node_modules/string-width": {
            "version": "4.2.3",
            "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
            "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
            "dev": true,
            "dependencies": {
                "emoji-regex": "^8.0.0",
                "is-fullwidth-code-point": "^3.0.0",
                "strip-ansi": "^6.0.1"
            },
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/wrap-ansi-cjs/node_modules/strip-ansi": {
            "version": "6.0.1",
            "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
            "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",
            "dev": true,
            "dependencies": {
                "ansi-regex": "^5.0.1"
            },
            "engines": {
                "node": ">=8"
            }
        },
        "node_modules/wrap-ansi/node_modules/ansi-styles": {
            "version": "6.2.1",
            "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-6.2.1.tgz",
            "integrity": "sha512-bN798gFfQX+viw3R7yrGWRqnrN2oRkEkUjjl4JNn4E8GxxbjtG3FbrEIIY3l8/hrwUwIeCZvi4QuOTP4MErVug==",
            "dev": true,
            "engines": {
                "node": ">=12"
            },
            "funding": {
                "url": "https://github.com/chalk/ansi-styles?sponsor=1"
            }
        },
        "node_modules/xterm": {
            "version": "5.3.0",
            "resolved": "https://registry.npmjs.org/xterm/-/xterm-5.3.0.tgz",
            "integrity": "sha512-8QqjlekLUFTrU6x7xck1MsPzPA571K5zNqWm0M0oroYEWVOptZ0+ubQSkQ3uxIEhcIHRujJy6emDWX4A7qyFzg==",
            "deprecated": "This package is now deprecated. Move to @xterm/xterm instead."
        },
        "node_modules/xterm-addon-fit": {
            "version": "0.8.0",
            "resolved": "https://registry.npmjs.org/xterm-addon-fit/-/xterm-addon-fit-0.8.0.tgz",
            "integrity": "sha512-yj3Np7XlvxxhYF/EJ7p3KHaMt6OdwQ+HDu573Vx1lRXsVxOcnVJs51RgjZOouIZOczTsskaS+CpXspK81/DLqw==",
            "deprecated": "This package is now deprecated. Move to @xterm/addon-fit instead.",
            "peerDependencies": {
                "xterm": "^5.0.0"
            }
        },
        "node_modules/xterm-addon-web-links": {
            "version": "0.9.0",
            "resolved": "https://registry.npmjs.org/xterm-addon-web-links/-/xterm-addon-web-links-0.9.0.tgz",
            "integrity": "sha512-LIzi4jBbPlrKMZF3ihoyqayWyTXAwGfu4yprz1aK2p71e9UKXN6RRzVONR0L+Zd+Ik5tPVI9bwp9e8fDTQh49Q==",
            "deprecated": "This package is now deprecated. Move to @xterm/addon-web-links instead.",
            "peerDependencies": {
                "xterm": "^5.0.0"
            }
        },
        "node_modules/yallist": {
            "version": "3.1.1",
            "resolved": "https://registry.npmjs.org/yallist/-/yallist-3.1.1.tgz",
            "integrity": "sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g==",
            "dev": true
        },
        "node_modules/yaml": {
            "version": "2.5.1",
            "resolved": "https://registry.npmjs.org/yaml/-/yaml-2.5.1.tgz",
            "integrity": "sha512-bLQOjaX/ADgQ20isPJRvF0iRUHIxVhYvr53Of7wGcWlO2jvtUlH5m87DsmulFVxRpNLOnI4tB6p/oh8D7kpn9Q==",
            "dev": true,
            "bin": {
                "yaml": "bin.mjs"
            },
            "engines": {
                "node": ">= 14"
            }
        },
        "node_modules/yocto-queue": {
            "version": "0.1.0",
            "resolved": "https://registry.npmjs.org/yocto-queue/-/yocto-queue-0.1.0.tgz",
            "integrity": "sha512-rVksvsnNCdJ/ohGc6xgPwyN8eheCxsiLM8mxuE/t/mOVqJewPuO1miLpTHQiRgTKCLexL4MeAFVagts7HmNZ2Q==",
            "dev": true,
            "engines": {
                "node": ">=10"
            },
            "funding": {
                "url": "https://github.com/sponsors/sindresorhus"
            }
        }
    }
}



======================================================================

------------------------------ FILE: Systems/web/README.md ------------------------------
# SwiftDevBot Web Dashboard

Ğ¤ÑƒÑ‚ÑƒÑ€Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Telegram-Ğ±Ğ¾Ñ‚Ğ¾Ğ¼ SwiftDevBot Ğ½Ğ° React + TypeScript + Vite Ğ² ÑÑ‚Ğ¸Ğ»Ğµ Liquid Glass Interface.

## ğŸ¨ ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸

- **React + TypeScript** - Ğ¡Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ ÑÑ‚ĞµĞº Ñ Ñ‚Ğ¸Ğ¿Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒÑ
- **Vite** - Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ ÑĞ±Ğ¾Ñ€ĞºĞ° Ğ¸ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°
- **Liquid Glass Design** - ĞŸÑ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ñ‹Ğµ ÑÑ‚ĞµĞºĞ»ÑĞ½Ğ½Ñ‹Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ñ ÑÑ„Ñ„ĞµĞºÑ‚Ğ°Ğ¼Ğ¸ Ñ€Ğ°Ğ·Ğ¼Ñ‹Ñ‚Ğ¸Ñ
- **Holographic UI** - ĞĞµĞ¾Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ°ĞºÑ†ĞµĞ½Ñ‚Ñ‹ Ğ¸ ÑĞ²ĞµÑ‚Ğ¾Ğ²Ñ‹Ğµ ÑÑ„Ñ„ĞµĞºÑ‚Ñ‹
- **Tailwind CSS** - Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ°Ñ€Ğ½Ñ‹Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
- **Ğ”Ğ²ÑƒÑ…Ñ‚ĞµĞ¼Ğ°** - Ğ¡Ğ²ĞµÑ‚Ğ»Ğ°Ñ Ğ¸ Ñ‚ĞµĞ¼Ğ½Ğ°Ñ Ñ‚ĞµĞ¼Ğ° Ñ Ğ¿Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ°Ğ¼Ğ¸
- **ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½** - ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²
- **RBAC ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°** - Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²

## ğŸš€ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

### Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹

```bash
cd Systems/web
npm install
```

### Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°

```bash
# Ğ—Ğ°Ğ¿ÑƒÑĞº dev ÑĞµÑ€Ğ²ĞµÑ€Ğ° (Vite)
npm run dev

# Ğ’ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¼ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»Ğµ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ FastAPI backend
python3 ../../sdb.py web start
```

Frontend Ğ±ÑƒĞ´ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ½Ğ° `http://localhost:5173` (Vite dev server)
Backend API Ğ½Ğ° `http://localhost:8000`

### Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ´Ğ»Ñ production

```bash
# Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´
npm run build

# Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ FastAPI (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ğ±ÑĞ»ÑƒĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ ÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´)
python3 ../../sdb.py web start
```

ĞŸĞ¾ÑĞ»Ğµ ÑĞ±Ğ¾Ñ€ĞºĞ¸ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´ Ğ±ÑƒĞ´ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ñ‡ĞµÑ€ĞµĞ· FastAPI Ğ½Ğ° `http://localhost:8000`

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
Systems/web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # React ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”‚   â”œâ”€â”€ ui/              # UI ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ (GlassCard, GlassButton, etc.)
â”‚   â”‚   â”œâ”€â”€ sections/        # Ğ¡ĞµĞºÑ†Ğ¸Ğ¸ dashboard (Home, Modules, Users, etc.)
â”‚   â”‚   â”œâ”€â”€ Header.tsx       # Ğ¨Ğ°Ğ¿ĞºĞ°
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx      # Ğ‘Ğ¾ĞºĞ¾Ğ²Ğ¾Ğµ Ğ¼ĞµĞ½Ñ
â”‚   â”‚   â””â”€â”€ AnimatedBackground.tsx
â”‚   â”œâ”€â”€ contexts/             # React Contexts
â”‚   â”‚   â”œâ”€â”€ AuthContext.tsx  # ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
â”‚   â”‚   â””â”€â”€ ThemeContext.tsx # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞ¼Ğ¾Ğ¹
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ api.ts           # FastAPI ĞºĞ»Ğ¸ĞµĞ½Ñ‚
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ Login.tsx        # Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ²Ñ…Ğ¾Ğ´Ğ°
â”‚   â”‚   â””â”€â”€ Dashboard.tsx    # Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
â”‚   â”œâ”€â”€ App.tsx              # Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚
â”‚   â”œâ”€â”€ main.tsx             # Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°
â”‚   â””â”€â”€ index.css            # Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
â”œâ”€â”€ app.py                   # FastAPI backend
â”œâ”€â”€ vite.config.ts           # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Vite
â”œâ”€â”€ tailwind.config.js       # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Tailwind
â”œâ”€â”€ tsconfig.json            # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ TypeScript
â””â”€â”€ package.json             # Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
```

## ğŸ” ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

### Ğ Ğ¾Ğ»Ğ¸

- **User** - Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ (Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸, Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ, ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°)
- **Admin** - ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿, Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ñ‹

### Ğ”ĞµĞ¼Ğ¾-Ñ€ĞµĞ¶Ğ¸Ğ¼

Ğ’ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸ Ğ´Ğ»Ñ Ğ´ĞµĞ¼Ğ¾Ğ½ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ»ÑĞ±Ğ°Ñ Ğ¿Ğ°Ñ€Ğ° Ğ»Ğ¾Ğ³Ğ¸Ğ½/Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ÑÑ. Ğ’ Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğµ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ°Ğ»ÑŒĞ½ÑƒÑ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· API.

## ğŸ“± Ğ Ğ°Ğ·Ğ´ĞµĞ»Ñ‹ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸

### Ğ”Ğ»Ñ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

1. **Home** - ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ±Ğ¾Ñ‚Ğ°
2. **Modules** - Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸ Ğ±Ğ¾Ñ‚Ğ°
3. **Users** - Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
4. **Statistics** - Ğ“Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸ Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
5. **Logs** - Ğ›Ğ¾Ğ³Ğ¸ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
6. **Settings** - ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
7. **Documentation** - Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ

### Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²

8. **Core Config** - ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑĞ´Ñ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
9. **Services** - Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¼Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸
10. **Monitoring** - Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸

## ğŸ¨ Ğ¦Ğ²ĞµÑ‚Ğ¾Ğ²Ñ‹Ğµ Ñ‚ĞµĞ¼Ñ‹

### Ğ¡Ğ²ĞµÑ‚Ğ»Ğ°Ñ Ñ‚ĞµĞ¼Ğ°
- Ğ‘ĞµĞ»Ñ‹Ğ¹ Ñ„Ğ¾Ğ½ Ñ Ğ»ĞµĞ³ĞºĞ¸Ğ¼ ÑĞ¸Ğ½Ğ¸Ğ¼ ÑĞ²ĞµÑ‡ĞµĞ½Ğ¸ĞµĞ¼
- ĞœÑĞ³ĞºĞ¸Ğµ Ñ‚ĞµĞ½Ğ¸ Ğ¸ Ğ¾Ñ‚Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
- Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ´ ÑÑ‚ĞµĞºĞ»Ğ¾Ğ¼

### Ğ¢ĞµĞ¼Ğ½Ğ°Ñ Ñ‚ĞµĞ¼Ğ°
- Ğ“Ñ€Ğ°Ğ´Ğ¸ĞµĞ½Ñ‚ Ğ¾Ñ‚ Ñ‚ĞµĞ¼Ğ½Ğ¾-ÑĞ¸Ğ½ĞµĞ³Ğ¾ Ğº Ğ»Ğ°Ğ·ÑƒÑ€Ğ½Ğ¾Ğ¼Ñƒ
- ĞĞµĞ¾Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ°ĞºÑ†ĞµĞ½Ñ‚Ñ‹ (Ğ±Ğ¸Ñ€ÑĞ·Ğ¾Ğ²Ñ‹Ğ¹, Ğ»Ğ°Ğ¹Ğ¼Ğ¾Ğ²Ñ‹Ğ¹, Ñ„Ğ¸Ğ¾Ğ»ĞµÑ‚Ğ¾Ğ²Ñ‹Ğ¹)
- ĞĞ½Ğ¸Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ²ĞµÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ±Ğ»Ğ¸ĞºĞ¸

## ğŸ”§ API Endpoints

### ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
- `POST /api/auth/login` - Ğ’Ñ…Ğ¾Ğ´
- `POST /api/auth/logout` - Ğ’Ñ‹Ñ…Ğ¾Ğ´

### Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ
- `GET /api/health` - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
- `GET /api/stats` - Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ±Ğ¾Ñ‚Ğ°
- `GET /api/modules` - Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
- `GET /api/users` - Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
- `GET /api/logs` - Ğ›Ğ¾Ğ³Ğ¸ (Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ¿Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ)

## âš™ï¸ ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

### ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» `.env` Ğ² `Systems/web/`:

```env
VITE_API_BASE_URL=http://localhost:8000
```

### Vite Proxy

Ğ’ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Vite Ğ¿Ñ€Ğ¾ĞºÑĞ¸Ñ€ÑƒĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğº `/api` Ğ½Ğ° FastAPI backend (`http://localhost:8000`).

## ğŸ“ Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸

- **Frontend**: React 18, TypeScript, Vite
- **Styling**: Tailwind CSS, Custom CSS (Liquid Glass)
- **Icons**: Lucide React
- **Backend**: FastAPI (Python)
- **Ğ¡Ñ‚Ğ¸Ğ»Ğ¸**: Liquid Glass, Glassmorphism, Neon Cyberpunk
- **Ğ¨Ñ€Ğ¸Ñ„Ñ‚Ñ‹**: System fonts (Inter fallback)
- **ĞĞ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸**: CSS Animations, Transitions

## ğŸ› ï¸ ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

```bash
# Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°
npm run dev          # Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ dev server
npm run build        # Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ´Ğ»Ñ production
npm run preview      # ĞŸÑ€ĞµĞ´Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ production build
npm run lint         # ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ´ Ğ»Ğ¸Ğ½Ñ‚ĞµÑ€Ğ¾Ğ¼
npm run typecheck    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿Ñ‹ TypeScript

# Backend
python3 ../../sdb.py web start    # Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ FastAPI ÑĞµÑ€Ğ²ĞµÑ€
```

## ğŸ¯ ĞŸĞ»Ğ°Ğ½Ñ‹ Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ñ

- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ±Ğ¾Ñ‚Ğ° Ñ‡ĞµÑ€ĞµĞ· sdb_services
- [ ] WebSocket Ğ´Ğ»Ñ real-time Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹
- [ ] Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¾Ğ² (Chart.js/Recharts)
- [ ] Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¸ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
- [ ] ĞœĞ½Ğ¾Ğ³Ğ¾ÑĞ·Ñ‹Ñ‡Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°
- [ ] JWT Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ Ğ´Ğ»Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ¹ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸

## ğŸ“š Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

- [React Docs](https://react.dev)
- [TypeScript Docs](https://www.typescriptlang.org)
- [Vite Docs](https://vitejs.dev)
- [Tailwind CSS Docs](https://tailwindcss.com)

---

**SwiftDevBot** â€” ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ñ â¤ï¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹ SoverX



======================================================================

------------------------------ FILE: Systems/web/tailwind.config.js ------------------------------
/** @type {import('tailwindcss').Config} */
export default {
    content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
    theme: {
      extend: {},
    },
    plugins: [],
  };
  


======================================================================

------------------------------ FILE: Systems/web/tsconfig.json ------------------------------
{
    "files": [],
    "references": [
      { "path": "./tsconfig.app.json" },
      { "path": "./tsconfig.node.json" }
    ]
  }
  


======================================================================

------------------------------ FILE: Systems/web/package.json ------------------------------
{
    "name": "vite-react-typescript-starter",
    "private": true,
    "version": "0.0.0",
    "type": "module",
    "scripts": {
        "dev": "vite",
        "build": "vite build",
        "lint": "eslint .",
        "preview": "vite preview",
        "typecheck": "tsc --noEmit -p tsconfig.app.json"
    },
    "dependencies": {
        "@monaco-editor/react": "^4.7.0",
        "@types/react-router-dom": "^5.3.3",
        "@xterm/addon-fit": "^0.10.0",
        "@xterm/addon-web-links": "^0.11.0",
        "@xterm/xterm": "^5.5.0",
        "lucide-react": "^0.344.0",
        "react": "^18.3.1",
        "react-dom": "^18.3.1",
        "react-router-dom": "^7.9.6",
        "recharts": "^3.4.1",
        "xterm": "^5.3.0",
        "xterm-addon-fit": "^0.8.0",
        "xterm-addon-web-links": "^0.9.0"
    },
    "devDependencies": {
        "@eslint/js": "^9.9.1",
        "@types/react": "^18.3.5",
        "@types/react-dom": "^18.3.0",
        "@vitejs/plugin-react": "^4.3.1",
        "autoprefixer": "^10.4.18",
        "eslint": "^9.9.1",
        "eslint-plugin-react-hooks": "^5.1.0-rc.0",
        "eslint-plugin-react-refresh": "^0.4.11",
        "globals": "^15.9.0",
        "postcss": "^8.4.35",
        "tailwindcss": "^3.4.1",
        "typescript": "^5.5.3",
        "typescript-eslint": "^8.3.0",
        "vite": "^5.4.2"
    }
}



======================================================================

------------------------------ FILE: Systems/web/app.py ------------------------------
"""
FastAPI application for SwiftDevBot web dashboard.
Serves React frontend and provides API endpoints.
"""

import os
import json
import hashlib
from pathlib import Path
from typing import Optional, Dict, List

from fastapi import FastAPI, Request, HTTPException
from fastapi.responses import HTMLResponse, FileResponse, Response
from fastapi.staticfiles import StaticFiles
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
from sqlalchemy import select, func, and_, or_
from sqlalchemy.orm import selectinload
from datetime import datetime, timedelta

from Systems.core.database.core_models import User as DBUser


class BlockUserRequest(BaseModel):
    block: bool


class ModuleToggleRequest(BaseModel):
    enable: bool


def _persist_enabled_modules(enabled_modules: List[str], config_path: Path) -> List[str]:
    unique_module_names = sorted({name.strip() for name in enabled_modules if name and name.strip()})
    data_to_save = {
        "active_modules": unique_module_names,
        "disabled_modules": [],
    }
    config_path.parent.mkdir(parents=True, exist_ok=True)
    with open(config_path, "w", encoding="utf-8") as f:
        json.dump(data_to_save, f, indent=2, ensure_ascii=False)
    return unique_module_names


def create_app(sdb_services=None, debug: bool = False) -> FastAPI:
    """
    Create and configure FastAPI application for SwiftDevBot web dashboard.
    
    Args:
        sdb_services: BotServicesProvider instance (optional)
        debug: Enable debug mode
        
    Returns:
        Configured FastAPI application
    """
    # Get web directory path
    web_dir = Path(__file__).parent
    dist_dir = web_dir / "dist"
    
    # Create FastAPI app
    app = FastAPI(
        title="SwiftDevBot Dashboard",
        description="Futuristic Liquid Glass Dashboard for SwiftDevBot",
        version="0.2.0",
        debug=debug,
        docs_url="/api/docs",
        redoc_url="/api/redoc",
        openapi_url="/api/openapi.json",
    )
    
    # CORS middleware
    app.add_middleware(
        CORSMiddleware,
        allow_origins=["*"] if debug else [],
        allow_credentials=True,
        allow_methods=["*"],
        allow_headers=["*"],
    )
    
    # Mount static files (Vite build output)
    if dist_dir.exists():
        app.mount("/assets", StaticFiles(directory=str(dist_dir / "assets")), name="assets")
        
        # Mount locales directory for translations (from dist, copied from public by Vite)
        dist_locales_dir = dist_dir / "locales"
        if dist_locales_dir.exists():
            app.mount("/locales", StaticFiles(directory=str(dist_locales_dir)), name="locales")
        
        # Serve index.html for root
        @app.get("/", response_class=HTMLResponse)
        async def read_root():
            """Serve the main dashboard page."""
            index_path = dist_dir / "index.html"
            if index_path.exists():
                return FileResponse(str(index_path))
            return HTMLResponse("<h1>SwiftDevBot Dashboard</h1><p>Please build the frontend: npm run build</p>")
    
    # API routes
    @app.get("/api/health")
    async def health_check():
        """Health check endpoint."""
        if sdb_services:
            from Systems.core.monitoring.health import HealthChecker
            health_checker = HealthChecker(sdb_services)
            return await health_checker.get_health_summary()
        return {
            "status": "healthy",
            "service": "SwiftDevBot Dashboard",
            "version": "0.2.0"
        }
    
    @app.get("/api/health/detailed")
    async def health_check_detailed():
        """Detailed health check endpoint."""
        if sdb_services:
            from Systems.core.monitoring.health import HealthChecker
            health_checker = HealthChecker(sdb_services)
            return await health_checker.check_all()
        return {
            "status": "healthy",
            "service": "SwiftDevBot Dashboard",
            "version": "0.2.0",
            "checks": {}
        }
    
    @app.get("/metrics")
    async def metrics():
        """Prometheus metrics endpoint."""
        if sdb_services:
            from Systems.core.monitoring.metrics import get_metrics_collector
            metrics_collector = get_metrics_collector()
            return Response(
                content=metrics_collector.get_prometheus_format(),
                media_type="text/plain"
            )
        return Response(content="# No metrics available\n", media_type="text/plain")
    
    @app.get("/api/metrics/system")
    async def get_system_metrics():
        """Get system metrics (CPU, RAM, Disk, Redis, DB connections)."""
        if sdb_services:
            try:
                metrics = {
                    "cpu": 0.0,
                    "ram": 0.0,
                    "ramUsed": 0,
                    "ramTotal": 0,
                    "disk": 0.0,
                    "diskUsed": 0,
                    "diskTotal": 0,
                    "redis": 0.0,
                    "redisUsed": 0,
                    "redisTotal": 0,
                    "dbConnections": 0
                }
                
                # Get CPU, RAM, Disk via psutil
                try:
                    import psutil
                    import os
                    process = psutil.Process(os.getpid())
                    
                    # CPU: use system-wide CPU if process CPU is 0
                    cpu_percent = process.cpu_percent(interval=0.1)
                    if cpu_percent == 0:
                        cpu_percent = psutil.cpu_percent(interval=0.1)
                    metrics["cpu"] = cpu_percent
                    
                    # RAM: use process memory info
                    mem_info = process.memory_info()
                    system_mem = psutil.virtual_memory()
                    metrics["ram"] = (mem_info.rss / system_mem.total) * 100
                    metrics["ramUsed"] = int(mem_info.rss)
                    metrics["ramTotal"] = int(system_mem.total)
                    
                    # Disk usage for project data path
                    disk_usage = psutil.disk_usage(sdb_services.config.core.project_data_path)
                    metrics["disk"] = (disk_usage.used / disk_usage.total) * 100
                    metrics["diskUsed"] = int(disk_usage.used)
                    metrics["diskTotal"] = int(disk_usage.total)
                except Exception as e:
                    # If psutil fails, try to get at least some info
                    try:
                        import psutil
                        metrics["cpu"] = psutil.cpu_percent(interval=0.1)
                        mem = psutil.virtual_memory()
                        metrics["ram"] = mem.percent
                        metrics["ramUsed"] = int(mem.used)
                        metrics["ramTotal"] = int(mem.total)
                    except:
                        pass
                
                # Get Redis memory if available
                try:
                    if sdb_services.cache and hasattr(sdb_services.cache, 'get_redis_client_instance'):
                        # Redis client is async, so we need to handle it differently
                        # For now, try to get info if it's available synchronously
                        # In a real async context, you'd await this
                        try:
                            # Try to access redis client directly if it's stored
                            if hasattr(sdb_services.cache, '_redis_client') and sdb_services.cache._redis_client:
                                # This is async redis, so we can't call info() directly
                                # For now, set a placeholder or skip
                                metrics["redis"] = 0.0  # Will be updated when async support is added
                                metrics["redisUsed"] = 0
                                metrics["redisTotal"] = 0
                        except:
                            pass
                except Exception:
                    pass
                
                # Get DB connections from pool
                try:
                    if sdb_services.db and hasattr(sdb_services.db, 'engine'):
                        pool = sdb_services.db.engine.pool
                        metrics["dbConnections"] = pool.size() if hasattr(pool, 'size') else 0
                except Exception:
                    pass
                
                return metrics
            except Exception as e:
                return {
                    "cpu": 0.0,
                    "ram": 0.0,
                    "ramUsed": 0,
                    "ramTotal": 0,
                    "disk": 0.0,
                    "diskUsed": 0,
                    "diskTotal": 0,
                    "redis": 0.0,
                    "redisUsed": 0,
                    "redisTotal": 0,
                    "dbConnections": 0
                }
        
        return {
            "cpu": 0.0,
            "ram": 0.0,
            "ramUsed": 0,
            "ramTotal": 0,
            "disk": 0.0,
            "diskUsed": 0,
            "diskTotal": 0,
            "redis": 0.0,
            "redisUsed": 0,
            "redisTotal": 0,
            "dbConnections": 0
        }
    
    @app.get("/api/metrics/live")
    async def get_live_metrics():
        """Get live metrics for Mission Control (RPS, Response Time, Error Rate, etc.)."""
        if sdb_services:
            try:
                from Systems.core.monitoring.metrics import get_metrics_collector
                from datetime import datetime, timedelta
                
                metrics_collector = get_metrics_collector()
                metrics_dict = metrics_collector.get_metrics_dict() if metrics_collector else {}
                
                # Calculate RPS from events_total
                rps = 0.0
                total_events = 0
                for key, value in metrics_dict.get("counters", {}).items():
                    if "sdb_events_total" in key:
                        # Sum all event types
                        total_events += value
                
                # Simple RPS calculation: if we have events, estimate based on time window
                # This is a simplified approach - in production, you'd track events over time windows
                if total_events > 0:
                    # Estimate: assume events accumulated over last minute
                    # In real implementation, you'd track events per second
                    rps = total_events / 60.0  # Rough estimate
                
                # Get response time from histograms
                response_time = 0.0
                response_times = []
                for key, hist_data in metrics_dict.get("histograms", {}).items():
                    if "sdb_event_duration_seconds" in key or "duration" in key.lower():
                        if isinstance(hist_data, dict) and "avg" in hist_data:
                            response_times.append(hist_data["avg"] * 1000)  # Convert to ms
                
                if response_times:
                    response_time = sum(response_times) / len(response_times)
                else:
                    # Fallback: if no histogram data, use a default or calculate from counters
                    # This is a placeholder - real implementation would track actual response times
                    response_time = 50.0  # Default 50ms if no data
                
                # Calculate error rate
                error_rate = 0.0
                error_events = 0
                for key, value in metrics_dict.get("counters", {}).items():
                    if "sdb_events_error_total" in key:
                        error_events += value
                
                if total_events > 0:
                    error_rate = (error_events / total_events) * 100
                
                # Get active users (24h) - users with last_activity_at in last 24 hours
                active_users = 0
                try:
                    async with sdb_services.db.get_session() as session:
                        from datetime import datetime, timedelta
                        cutoff_time = datetime.now() - timedelta(hours=24)
                        stmt = select(func.count(DBUser.id)).where(DBUser.last_activity_at >= cutoff_time)
                        result = await session.execute(stmt)
                        active_users = result.scalar_one_or_none() or 0
                except Exception:
                    pass
                
                # Get new users today
                new_users_today = 0
                try:
                    async with sdb_services.db.get_session() as session:
                        today_start = datetime.now().replace(hour=0, minute=0, second=0, microsecond=0)
                        # Assuming there's a created_at field, if not, use id as proxy
                        stmt = select(func.count(DBUser.id))
                        # If no created_at, we can't accurately count new users today
                        # For now, return 0
                        new_users_today = 0
                except Exception:
                    pass
                
                # Queue size (if using Redis queue)
                queue_size = 0
                try:
                    if sdb_services.cache and hasattr(sdb_services.cache, 'redis') and sdb_services.cache.redis:
                        # Try to get queue length if there's a queue
                        queue_size = 0  # Placeholder - would need queue implementation
                except Exception:
                    pass
                
                return {
                    "rps": float(rps),
                    "responseTime": float(response_time),
                    "errorRate": float(error_rate),
                    "activeUsers": active_users,
                    "newUsersToday": new_users_today,
                    "queueSize": queue_size
                }
            except Exception as e:
                return {
                    "rps": 0.0,
                    "responseTime": 0.0,
                    "errorRate": 0.0,
                    "activeUsers": 0,
                    "newUsersToday": 0,
                    "queueSize": 0
                }
        
        return {
            "rps": 0.0,
            "responseTime": 0.0,
            "errorRate": 0.0,
            "activeUsers": 0,
            "newUsersToday": 0,
            "queueSize": 0
        }
    
    @app.get("/api/stats")
    async def get_stats():
        """Get bot statistics."""
        if sdb_services:
            try:
                # Get total users from database
                total_users = 0
                async with sdb_services.db.get_session() as session:
                    count_stmt = select(func.count(DBUser.id))
                    total_users_result = await session.execute(count_stmt)
                    total_users = total_users_result.scalar_one_or_none() or 0
                
                # Get modules info
                active_modules = len(sdb_services.modules.enabled_plugin_names) if sdb_services.modules else 0
                total_modules = len(sdb_services.modules.get_all_modules_info()) if sdb_services.modules else 0
                
                # Get messages today from metrics
                messages_today = 0
                try:
                    from Systems.core.monitoring.metrics import get_metrics_collector
                    metrics_collector = get_metrics_collector()
                    if metrics_collector:
                        metrics_dict = metrics_collector.get_metrics_dict()
                        # Get message events from today
                        # Count events with type="message" from counters
                        message_key = "sdb_events_total{'type': 'message'}"
                        if message_key in metrics_dict.get("counters", {}):
                            messages_today = metrics_dict["counters"][message_key]
                        # If not found, try to get from all message-related counters
                        for key, value in metrics_dict.get("counters", {}).items():
                            if "message" in key.lower():
                                messages_today += value
                                break
                except Exception as e:
                    # If metrics not available, set to 0
                    messages_today = 0
                
                # Get uptime (if available from process start time)
                uptime = "N/A"
                try:
                    import psutil
                    import os
                    pid = os.getpid()
                    process = psutil.Process(pid)
                    create_time = datetime.fromtimestamp(process.create_time())
                    uptime_delta = datetime.now() - create_time
                    days = uptime_delta.days
                    hours = uptime_delta.seconds // 3600
                    minutes = (uptime_delta.seconds % 3600) // 60
                    if days > 0:
                        uptime = f"{days}d {hours}h {minutes}m"
                    elif hours > 0:
                        uptime = f"{hours}h {minutes}m"
                    else:
                        uptime = f"{minutes}m"
                except Exception:
                    # If psutil not available or error, try to get from bot start time if stored
                    uptime = "N/A"
                
                return {
                    "uptime": uptime,
                    "messages_today": messages_today,
                    "total_users": total_users,
                    "active_modules": active_modules,
                    "total_modules": total_modules
                }
            except Exception as e:
                # Fallback to empty data on error
                return {
                    "uptime": "N/A",
                    "messages_today": 0,
                    "total_users": 0,
                    "active_modules": 0,
                    "total_modules": 0
                }
        
        # Fallback: return empty data if services not available
        return {
            "uptime": "N/A",
            "messages_today": 0,
            "total_users": 0,
            "active_modules": 0,
            "total_modules": 0
        }
    
    @app.get("/api/modules")
    async def get_modules(include_system: bool = False):
        """Get modules list.
        
        Args:
            include_system: If True, include system modules. Default: False (only user plugins).
        """
        if sdb_services:
            modules_info = sdb_services.modules.get_all_modules_info()
            modules_payload = []
            for info in modules_info:
                # Filter system modules if not requested
                if not include_system and info.is_system_module:
                    continue
                    
                modules_payload.append({
                    "name": info.name,
                    "status": "active" if info.is_enabled else "inactive",
                    "description": info.manifest.description if info.manifest and info.manifest.description else "",
                    "display_name": info.manifest.display_name if info.manifest and info.manifest.display_name else info.name,
                    "is_system_module": info.is_system_module,
                    "version": info.manifest.version if info.manifest and info.manifest.version else None,
                })
            return modules_payload

        # Fallback: return empty list if no services (no modules installed)
        return []
    
    @app.get("/api/services")
    async def get_services():
        """Get services status."""
        if sdb_services:
            try:
                import psutil
                import os
                from datetime import datetime
                
                process = psutil.Process(os.getpid())
                create_time = datetime.fromtimestamp(process.create_time())
                uptime_delta = datetime.now() - create_time
                days = uptime_delta.days
                hours = uptime_delta.seconds // 3600
                minutes = (uptime_delta.seconds % 3600) // 60
                
                if days > 0:
                    uptime_str = f"{days}d {hours}h {minutes}m"
                elif hours > 0:
                    uptime_str = f"{hours}h {minutes}m"
                else:
                    uptime_str = f"{minutes}m"
                
                memory_mb = process.memory_info().rss / (1024 * 1024)
                memory_str = f"{int(memory_mb)} MB"
                
                services = []
                
                # Bot Core / Polling - always running if bot is initialized
                services.append({
                    "id": "polling",
                    "name": "Polling",
                    "description": "Telegram bot polling service",
                    "status": "running" if sdb_services.bot else "stopped",
                    "uptime": uptime_str if sdb_services.bot else "0m",
                    "memory": memory_str if sdb_services.bot else "0 MB"
                })
                
                # Scheduler - check if LoggingManager has scheduler
                try:
                    from Systems.core.logging_manager import LoggingManager
                    # Scheduler is part of LoggingManager, assume running if services are up
                    services.append({
                        "id": "scheduler",
                        "name": "Scheduler",
                        "description": "Background task scheduler",
                        "status": "running",
                        "uptime": uptime_str,
                        "memory": "0 MB"  # Part of main process
                    })
                except:
                    services.append({
                        "id": "scheduler",
                        "name": "Scheduler",
                        "description": "Background task scheduler",
                        "status": "stopped",
                        "uptime": "0m",
                        "memory": "0 MB"
                    })
                
                # WebServer - always running if we're here
                services.append({
                    "id": "webserver",
                    "name": "WebServer",
                    "description": "FastAPI web server",
                    "status": "running",
                    "uptime": uptime_str,
                    "memory": memory_str
                })
                
                # BackgroundTasks - part of asyncio, always running
                services.append({
                    "id": "backgroundtasks",
                    "name": "BackgroundTasks",
                    "description": "Async background tasks",
                    "status": "running",
                    "uptime": uptime_str,
                    "memory": "0 MB"  # Part of main process
                })
                
                return services
            except Exception as e:
                return []
        
        return []
    
    @app.post("/api/services/{service_id}/{action}")
    async def service_action(service_id: str, action: str):
        """Perform action on a service (start/stop/restart)."""
        if not sdb_services:
            raise HTTPException(status_code=503, detail="SwiftDevBot services are not initialized.")
        
        if action not in ['start', 'stop', 'restart']:
            raise HTTPException(status_code=400, detail="Invalid action. Must be 'start', 'stop', or 'restart'.")
        
        # For now, services are part of the main process, so we can't actually start/stop them
        # This is a placeholder for future implementation
        # In a real scenario, you might have separate processes or containers
        
        return {
            "success": True,
            "message": f"Service {service_id} {action} requested (note: services are part of main process, restart bot to apply changes)"
        }
    
    @app.get("/api/config")
    async def get_config():
        """Get core configuration as YAML."""
        if sdb_services:
            try:
                import yaml
                config_path = sdb_services.config.core.project_data_path / "Config" / "core_settings.yaml"
                if config_path.exists():
                    with open(config_path, 'r', encoding='utf-8') as f:
                        return {"content": f.read()}
                else:
                    # Return default structure if file doesn't exist
                    default_config = {
                        "core": {
                            "project_data_path": str(sdb_services.config.core.project_data_path),
                            "super_admins": sdb_services.config.core.super_admins,
                            "log_level": sdb_services.config.core.log_level,
                            "log_to_file": sdb_services.config.core.log_to_file,
                        },
                        "db": {
                            "type": sdb_services.config.db.type,
                        },
                        "cache": {
                            "type": sdb_services.config.cache.type,
                        },
                        "telegram": {
                            "polling_timeout": sdb_services.config.telegram.polling_timeout,
                        }
                    }
                    return {"content": yaml.dump(default_config, default_flow_style=False, allow_unicode=True)}
            except Exception as e:
                raise HTTPException(status_code=500, detail=f"Failed to read config: {str(e)}")
        
        raise HTTPException(status_code=503, detail="SwiftDevBot services are not initialized.")
    
    @app.put("/api/config")
    async def update_config(request: Request):
        """Update core configuration."""
        if not sdb_services:
            raise HTTPException(status_code=503, detail="SwiftDevBot services are not initialized.")
        
        try:
            body = await request.json()
            content = body.get("content", "")
            
            # Validate YAML
            import yaml
            try:
                yaml.safe_load(content)
            except yaml.YAMLError as e:
                raise HTTPException(status_code=400, detail=f"Invalid YAML: {str(e)}")
            
            # Write to file
            config_path = sdb_services.config.core.project_data_path / "Config" / "core_settings.yaml"
            config_path.parent.mkdir(parents=True, exist_ok=True)
            with open(config_path, 'w', encoding='utf-8') as f:
                f.write(content)
            
            return {"success": True, "message": "Configuration saved. Restart required to apply changes."}
        except HTTPException:
            raise
        except Exception as e:
            raise HTTPException(status_code=500, detail=f"Failed to save config: {str(e)}")
    
    @app.post("/api/config/reload")
    async def reload_config():
        """Hot reload configuration (placeholder - requires implementation)."""
        # Note: Full config reload would require reinitializing services
        # For now, return a message that restart is needed
        return {
            "success": False,
            "message": "Hot reload not fully implemented. Please restart the bot to apply configuration changes."
        }
    
    @app.get("/api/feature-flags")
    async def get_feature_flags():
        """Get feature flags."""
        # For now, return default feature flags
        # In the future, these could be stored in DB or config
        return [
            {
                "name": "maintenance_mode",
                "enabled": False,
                "description": "Enable maintenance mode (only admins can access)"
            },
            {
                "name": "disable_broadcasts",
                "enabled": False,
                "description": "Disable all broadcast messages"
            },
            {
                "name": "strict_rbac",
                "enabled": True,
                "description": "Enable strict RBAC enforcement"
            }
        ]
    
    @app.put("/api/feature-flags/{flag_name}")
    async def update_feature_flag(flag_name: str, request: Request):
        """Update a feature flag."""
        try:
            body = await request.json()
            enabled = body.get("enabled", False)
            
            # For now, just return success
            # In the future, this would persist to DB or config
            return {
                "success": True,
                "flag": {
                    "name": flag_name,
                    "enabled": enabled
                },
                "message": "Feature flag updated (restart may be required)"
            }
        except Exception as e:
            raise HTTPException(status_code=500, detail=f"Failed to update feature flag: {str(e)}")
    
    @app.get("/api/sessions")
    async def get_sessions(request: Request):
        """Get active sessions for current user."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return []
        token = auth_header.replace("Bearer ", "")
        if not token:
            return []
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                return []
            
            user_info = jwt_handler.get_user_info(payload)
            user_id = user_info.get("user_id")
            
            # For now, return current session only
            # In the future, track sessions in Redis or DB
            return [{
                "id": "current",
                "device": "Current Browser",
                "location": "Unknown",
                "lastActivity": "Just now",
                "current": True,
                "ip": request.client.host if request.client else "Unknown"
            }]
        except Exception:
            return []
    
    @app.post("/api/sessions/{session_id}/terminate")
    async def terminate_session(session_id: str, request: Request):
        """Terminate a session."""
        # For now, just return success
        # In the future, invalidate token in Redis or DB
        return {"success": True, "message": "Session terminated"}
    
    @app.get("/api/tokens")
    async def get_tokens(request: Request):
        """Get API tokens for current user."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return []
        token = auth_header.replace("Bearer ", "")
        if not token:
            return []
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                return []
            
            # For now, return empty list
            # In the future, store tokens in DB
            return []
        except Exception:
            return []
    
    @app.post("/api/tokens")
    async def create_token(request: Request):
        """Create a new API token."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            raise HTTPException(status_code=401, detail="Token required")
        token = auth_header.replace("Bearer ", "")
        if not token:
            raise HTTPException(status_code=401, detail="Token required")
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                raise HTTPException(status_code=401, detail="Invalid token")
            
            body = await request.json()
            token_name = body.get("name", "Unnamed Token")
            
            # Generate token
            import secrets
            token_value = f"sdb_{secrets.token_urlsafe(32)}"
            
            # For now, just return the token
            # In the future, store in DB with user_id, name, created_at, last_used_at
            return {
                "id": secrets.token_urlsafe(16),
                "name": token_name,
                "token": token_value,
                "created": datetime.now().isoformat(),
                "lastUsed": None
            }
        except HTTPException:
            raise
        except Exception as e:
            raise HTTPException(status_code=500, detail=f"Failed to create token: {str(e)}")
    
    @app.delete("/api/tokens/{token_id}")
    async def revoke_token(token_id: str, request: Request):
        """Revoke an API token."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            raise HTTPException(status_code=401, detail="Token required")
        token = auth_header.replace("Bearer ", "")
        if not token:
            raise HTTPException(status_code=401, detail="Token required")
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                raise HTTPException(status_code=401, detail="Invalid token")
            
            # For now, just return success
            # In the future, delete from DB
            return {"success": True, "message": "Token revoked"}
        except HTTPException:
            raise
        except Exception as e:
            raise HTTPException(status_code=500, detail=f"Failed to revoke token: {str(e)}")
    
    @app.get("/api/command-history")
    async def get_command_history(request: Request, limit: int = 50):
        """Get command history for current user."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return []
        token = auth_header.replace("Bearer ", "")
        if not token:
            return []
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                return []
            
            # For now, return empty list
            # In the future, parse logs or store commands in DB
            return []
        except Exception:
            return []
    
    @app.get("/api/files")
    async def get_files(request: Request):
        """Get files for current user."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return []
        token = auth_header.replace("Bearer ", "")
        if not token:
            return []
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                return []
            
            # For now, return empty list
            # In the future, get from file storage system
            return []
        except Exception:
            return []
    
    @app.get("/api/tickets")
    async def get_tickets(request: Request):
        """Get support tickets for current user."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return []
        token = auth_header.replace("Bearer ", "")
        if not token:
            return []
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                return []
            
            # For now, return empty list
            # In the future, get from DB (support_tickets table)
            return []
        except Exception:
            return []
    
    @app.post("/api/tickets")
    async def create_ticket(request: Request):
        """Create a support ticket."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            raise HTTPException(status_code=401, detail="Token required")
        token = auth_header.replace("Bearer ", "")
        if not token:
            raise HTTPException(status_code=401, detail="Token required")
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                raise HTTPException(status_code=401, detail="Invalid token")
            
            body = await request.json()
            subject = body.get("subject", "")
            message = body.get("message", "")
            
            # For now, just return success
            # In the future, store in DB
            return {
                "id": f"T-{datetime.now().strftime('%Y%m%d%H%M%S')}",
                "subject": subject,
                "status": "open",
                "created": datetime.now().isoformat(),
                "updated": datetime.now().isoformat()
            }
        except HTTPException:
            raise
        except Exception as e:
            raise HTTPException(status_code=500, detail=f"Failed to create ticket: {str(e)}")
    
    @app.post("/api/terminal/execute")
    async def execute_terminal_command(request: Request):
        """Execute a bot command via terminal."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            raise HTTPException(status_code=401, detail="Token required")
        token = auth_header.replace("Bearer ", "")
        if not token:
            raise HTTPException(status_code=401, detail="Token required")
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                raise HTTPException(status_code=401, detail="Invalid token")
            
            body = await request.json()
            command = body.get("command", "").strip()
            
            if not command:
                raise HTTPException(status_code=400, detail="Command is required")
            
            # Security: Only allow bot commands (starting with /)
            if not command.startswith("/"):
                raise HTTPException(status_code=400, detail="Only bot commands (starting with /) are allowed")
            
            # For now, return a simulated response
            # In the future, integrate with bot command handler
            # This would require accessing BotServicesProvider and executing commands
            return {
                "output": f"Command '{command}' executed successfully.\n[Note: Terminal execution is currently simulated. Full integration requires bot command handler access.]",
                "success": True,
                "timestamp": datetime.now().isoformat()
            }
        except HTTPException:
            raise
        except Exception as e:
            raise HTTPException(status_code=500, detail=f"Failed to execute command: {str(e)}")
    
    @app.get("/api/cron-jobs")
    async def get_cron_jobs(request: Request):
        """Get list of scheduled cron jobs from APScheduler."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return []
        token = auth_header.replace("Bearer ", "")
        if not token:
            return []
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                return []
            
            # Try to get scheduler from LoggingManager
            jobs = []
            if sdb_services:
                try:
                    # Access LoggingManager's scheduler
                    logging_manager = getattr(sdb_services, 'logging_manager', None)
                    if logging_manager and hasattr(logging_manager, '_scheduler') and logging_manager._scheduler:
                        scheduler = logging_manager._scheduler
                        for job in scheduler.get_jobs():
                            jobs.append({
                                "id": job.id,
                                "name": job.name or job.id,
                                "func": job.func.__name__ if hasattr(job.func, '__name__') else str(job.func),
                                "next_run_time": job.next_run_time.isoformat() if job.next_run_time else None,
                                "trigger": str(job.trigger) if job.trigger else None,
                            })
                except Exception as e:
                    # If scheduler is not available, return empty list
                    pass
            
            return jobs
        except Exception:
            return []
    
    @app.get("/api/logs/stream")
    async def stream_logs(request: Request, limit: int = 100, level: Optional[str] = None):
        """Stream logs (for live updates)."""
        # This endpoint can be used for polling-based live updates
        # For true streaming, WebSocket would be better, but polling is simpler
        return await get_logs(limit, level)
    
    @app.get("/api/audit-logs")
    async def get_audit_logs(
        request: Request,
        limit: int = 100,
        module_name: Optional[str] = None,
        event_type: Optional[str] = None,
        severity: Optional[str] = None,
        start_time: Optional[float] = None,
        end_time: Optional[float] = None
    ):
        """Get security audit logs."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return []
        token = auth_header.replace("Bearer ", "")
        if not token:
            return []
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                return []
            
            # Check if user is admin
            user_info = jwt_handler.get_user_info(payload)
            if user_info.get("role", "").lower() != "admin":
                raise HTTPException(status_code=403, detail="Admin access required")
            
            if sdb_services and hasattr(sdb_services, 'audit_logger') and sdb_services.audit_logger:
                from Systems.core.security.audit_logger import AuditEventType, AuditSeverity
                
                # Convert string filters to enums
                event_type_enum = None
                if event_type:
                    try:
                        event_type_enum = AuditEventType(event_type)
                    except:
                        pass
                
                severity_enum = None
                if severity:
                    try:
                        severity_enum = AuditSeverity(severity)
                    except:
                        pass
                
                events = sdb_services.audit_logger.get_events(
                    module_name=module_name,
                    event_type=event_type_enum,
                    severity=severity_enum,
                    start_time=start_time,
                    end_time=end_time,
                    limit=limit
                )
                
                # Convert to dict format
                result = []
                for event in events:
                    result.append({
                        "event_id": event.event_id,
                        "event_type": event.event_type.value,
                        "module_name": event.module_name,
                        "user_id": event.user_id,
                        "timestamp": event.timestamp,
                        "severity": event.severity.value,
                        "details": event.details,
                        "ip_address": event.ip_address,
                        "user_agent": event.user_agent,
                        "success": event.success,
                        "error_message": event.error_message,
                    })
                
                return result
            return []
        except HTTPException:
            raise
        except Exception as e:
            return []
    
    @app.get("/api/audit-stats")
    async def get_audit_stats(request: Request):
        """Get security audit statistics."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return {}
        token = auth_header.replace("Bearer ", "")
        if not token:
            return {}
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                return {}
            
            # Check if user is admin
            user_info = jwt_handler.get_user_info(payload)
            if user_info.get("role", "").lower() != "admin":
                raise HTTPException(status_code=403, detail="Admin access required")
            
            if sdb_services and hasattr(sdb_services, 'audit_logger') and sdb_services.audit_logger:
                stats = sdb_services.audit_logger.get_statistics()
                return stats
            return {}
        except HTTPException:
            raise
        except Exception:
            return {}
    
    @app.post("/api/database/query")
    async def execute_sql_query(request: Request):
        """Execute a safe SQL SELECT query (read-only)."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            raise HTTPException(status_code=401, detail="Token required")
        token = auth_header.replace("Bearer ", "")
        if not token:
            raise HTTPException(status_code=401, detail="Token required")
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                raise HTTPException(status_code=401, detail="Invalid token")
            
            # Check if user is admin
            user_info = jwt_handler.get_user_info(payload)
            if user_info.get("role", "").lower() != "admin":
                raise HTTPException(status_code=403, detail="Admin access required")
            
            body = await request.json()
            query = body.get("query", "").strip()
            
            if not query:
                raise HTTPException(status_code=400, detail="Query is required")
            
            # Security: Only allow SELECT queries
            query_upper = query.upper().strip()
            if not query_upper.startswith("SELECT"):
                raise HTTPException(status_code=400, detail="Only SELECT queries are allowed")
            
            # Additional security: Block dangerous keywords
            dangerous_keywords = ["DROP", "DELETE", "UPDATE", "INSERT", "ALTER", "CREATE", "TRUNCATE", "EXEC", "EXECUTE"]
            for keyword in dangerous_keywords:
                if keyword in query_upper:
                    raise HTTPException(status_code=400, detail=f"Query contains forbidden keyword: {keyword}")
            
            if sdb_services and sdb_services.db:
                from sqlalchemy import text
                async with sdb_services.db.get_session() as session:
                    result = await session.execute(text(query))
                    rows = result.fetchall()
                    
                    # Convert to list of dicts
                    columns = result.keys()
                    data = []
                    for row in rows:
                        row_dict = {}
                        for i, col in enumerate(columns):
                            value = row[i]
                            # Convert datetime and other types to string
                            if hasattr(value, 'isoformat'):
                                row_dict[col] = value.isoformat()
                            else:
                                row_dict[col] = str(value) if value is not None else None
                        data.append(row_dict)
                    
                    return {
                        "columns": list(columns),
                        "data": data,
                        "row_count": len(data)
                    }
            
            raise HTTPException(status_code=500, detail="Database not available")
        except HTTPException:
            raise
        except Exception as e:
            raise HTTPException(status_code=500, detail=f"Query execution failed: {str(e)}")
    
    @app.get("/api/migrations")
    async def get_migrations(request: Request):
        """Get Alembic migration history."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return []
        token = auth_header.replace("Bearer ", "")
        if not token:
            return []
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                return []
            
            # Check if user is admin
            user_info = jwt_handler.get_user_info(payload)
            if user_info.get("role", "").lower() != "admin":
                raise HTTPException(status_code=403, detail="Admin access required")
            
            # Get current revision and history from Alembic
            try:
                from alembic.config import Config
                from alembic.script import ScriptDirectory
                from alembic.runtime.migration import MigrationContext
                from alembic import command
                import os
                
                # Get migration directory
                migration_dir = Path(__file__).parent.parent / "migration"
                alembic_cfg = Config(str(migration_dir / "alembic.ini"))
                alembic_cfg.set_main_option("script_location", str(migration_dir))
                
                script = ScriptDirectory.from_config(alembic_cfg)
                revisions = list(script.walk_revisions())
                
                # Get current revision from database
                current_rev = None
                if sdb_services and sdb_services.db:
                    from sqlalchemy import text
                    async with sdb_services.db.get_session() as session:
                        try:
                            context = MigrationContext.configure(await session.connection())
                            current_rev = context.get_current_revision()
                        except:
                            pass
                
                migrations = []
                for rev in reversed(revisions):  # Most recent first
                    migrations.append({
                        "revision": rev.revision,
                        "down_revision": rev.down_revision,
                        "branch_labels": list(rev.branch_labels) if rev.branch_labels else [],
                        "is_current": rev.revision == current_rev,
                        "doc": rev.doc or "",
                    })
                
                return migrations
            except Exception as e:
                return []
        except HTTPException:
            raise
        except Exception:
            return []
    
    @app.post("/api/migrations/{action}")
    async def migration_action(action: str, request: Request):
        """Execute Alembic migration action (upgrade/downgrade)."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            raise HTTPException(status_code=401, detail="Token required")
        token = auth_header.replace("Bearer ", "")
        if not token:
            raise HTTPException(status_code=401, detail="Token required")
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                raise HTTPException(status_code=401, detail="Invalid token")
            
            # Check if user is admin
            user_info = jwt_handler.get_user_info(payload)
            if user_info.get("role", "").lower() != "admin":
                raise HTTPException(status_code=403, detail="Admin access required")
            
            # For now, return success (actual migration execution would require subprocess)
            # In production, this should be done via CLI command
            return {
                "success": True,
                "message": f"Migration {action} requested. Please use CLI command 'sdb db {action}' for safety."
            }
        except HTTPException:
            raise
        except Exception:
            raise HTTPException(status_code=500, detail="Migration action failed")
    
    @app.get("/api/cache/keys")
    async def get_cache_keys(request: Request, pattern: Optional[str] = None, limit: int = 100):
        """Get Redis cache keys."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return []
        token = auth_header.replace("Bearer ", "")
        if not token:
            return []
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                return []
            
            # Check if user is admin
            user_info = jwt_handler.get_user_info(payload)
            if user_info.get("role", "").lower() != "admin":
                raise HTTPException(status_code=403, detail="Admin access required")
            
            if sdb_services and sdb_services.cache:
                redis_client = sdb_services.cache.get_redis_client_instance()
                if redis_client:
                    try:
                        # Get keys matching pattern
                        if pattern:
                            keys = await redis_client.keys(pattern)
                        else:
                            keys = await redis_client.keys("*")
                        
                        # Limit results
                        keys = keys[:limit]
                        
                        # Get TTL for each key
                        result = []
                        for key in keys:
                            key_str = key.decode('utf-8') if isinstance(key, bytes) else key
                            ttl = await redis_client.ttl(key)
                            result.append({
                                "key": key_str,
                                "ttl": ttl if ttl > 0 else None,
                            })
                        
                        return result
                    except Exception as e:
                        return []
            return []
        except HTTPException:
            raise
        except Exception:
            return []
    
    @app.post("/api/cache/flush")
    async def flush_cache(request: Request):
        """Flush Redis cache."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            raise HTTPException(status_code=401, detail="Token required")
        token = auth_header.replace("Bearer ", "")
        if not token:
            raise HTTPException(status_code=401, detail="Token required")
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                raise HTTPException(status_code=401, detail="Invalid token")
            
            # Check if user is admin
            user_info = jwt_handler.get_user_info(payload)
            if user_info.get("role", "").lower() != "admin":
                raise HTTPException(status_code=403, detail="Admin access required")
            
            if sdb_services and sdb_services.cache:
                await sdb_services.cache.clear_all_cache()
                return {"success": True, "message": "Cache flushed successfully"}
            
            return {"success": False, "message": "Cache not available"}
        except HTTPException:
            raise
        except Exception:
            raise HTTPException(status_code=500, detail="Failed to flush cache")
    
    @app.get("/api/broadcasts")
    async def get_broadcasts(request: Request):
        """Get broadcast history."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return []
        token = auth_header.replace("Bearer ", "")
        if not token:
            return []
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                return []
            
            # Check if user is admin
            user_info = jwt_handler.get_user_info(payload)
            if user_info.get("role", "").lower() != "admin":
                raise HTTPException(status_code=403, detail="Admin access required")
            
            # For now, return empty list (in future, store broadcasts in DB)
            return []
        except HTTPException:
            raise
        except Exception:
            return []
    
    @app.post("/api/broadcasts")
    async def create_broadcast(request: Request):
        """Create and send a broadcast."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            raise HTTPException(status_code=401, detail="Token required")
        token = auth_header.replace("Bearer ", "")
        if not token:
            raise HTTPException(status_code=401, detail="Token required")
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                raise HTTPException(status_code=401, detail="Invalid token")
            
            # Check if user is admin
            user_info = jwt_handler.get_user_info(payload)
            if user_info.get("role", "").lower() != "admin":
                raise HTTPException(status_code=403, detail="Admin access required")
            
            body = await request.json()
            message = body.get("message", "")
            target_type = body.get("target_type", "all")  # all, admins, active, language
            target_value = body.get("target_value", None)  # language code if target_type is language
            schedule_time = body.get("schedule_time", None)  # ISO datetime string or null for immediate
            
            if not message:
                raise HTTPException(status_code=400, detail="Message is required")
            
            # Get target users
            target_users = []
            if sdb_services and sdb_services.db:
                from sqlalchemy import select, and_
                from Systems.core.database.core_models import User as DBUser
                
                async with sdb_services.db.get_session() as session:
                    from Systems.core.database.core_models import Role, UserRole
                    
                    if target_type == "all":
                        stmt = select(DBUser.telegram_id).where(DBUser.is_bot_blocked == False)
                    elif target_type == "admins":
                        # Get super admins and users with admin role
                        super_admins = sdb_services.config.core.super_admins if sdb_services.config else []
                        stmt = select(DBUser.telegram_id).where(
                            and_(
                                DBUser.is_bot_blocked == False,
                                DBUser.telegram_id.in_(super_admins) if super_admins else False
                            )
                        )
                    elif target_type == "role":
                        # Users with specific role
                        role_name = target_value or "User"
                        stmt = (
                            select(DBUser.telegram_id)
                            .join(UserRole, DBUser.id == UserRole.user_id)
                            .join(Role, UserRole.role_id == Role.id)
                            .where(
                                and_(
                                    DBUser.is_bot_blocked == False,
                                    Role.name == role_name
                                )
                            )
                        )
                    elif target_type == "active":
                        # Users active in last N days
                        days = int(target_value) if target_value else 7
                        cutoff = datetime.now() - timedelta(days=days)
                        stmt = select(DBUser.telegram_id).where(
                            and_(
                                DBUser.is_bot_blocked == False,
                                DBUser.last_activity_at >= cutoff
                            )
                        )
                    elif target_type == "inactive":
                        # Users not active for N days
                        days = int(target_value) if target_value else 30
                        cutoff = datetime.now() - timedelta(days=days)
                        stmt = select(DBUser.telegram_id).where(
                            and_(
                                DBUser.is_bot_blocked == False,
                                or_(
                                    DBUser.last_activity_at < cutoff,
                                    DBUser.last_activity_at.is_(None)
                                )
                            )
                        )
                    elif target_type == "new_users":
                        # Users registered in last N days
                        days = int(target_value) if target_value else 30
                        cutoff = datetime.now() - timedelta(days=days)
                        stmt = select(DBUser.telegram_id).where(
                            and_(
                                DBUser.is_bot_blocked == False,
                                DBUser.created_at >= cutoff
                            )
                        )
                    elif target_type == "language":
                        # Users with specific language
                        lang_code = target_value or "ru"
                        stmt = select(DBUser.telegram_id).where(
                            and_(
                                DBUser.is_bot_blocked == False,
                                DBUser.preferred_language_code == lang_code
                            )
                        )
                    elif target_type == "active_status":
                        # Users by active status
                        status = target_value or "active"
                        if status == "active":
                            stmt = select(DBUser.telegram_id).where(
                                and_(
                                    DBUser.is_bot_blocked == False,
                                    DBUser.is_active == True
                                )
                            )
                        else:  # inactive
                            stmt = select(DBUser.telegram_id).where(
                                and_(
                                    DBUser.is_bot_blocked == False,
                                    DBUser.is_active == False
                                )
                            )
                    else:
                        stmt = select(DBUser.telegram_id).where(DBUser.is_bot_blocked == False)
                    
                    result = await session.execute(stmt)
                    target_users = [row[0] for row in result.fetchall()]
            
            # Create broadcast ID
            broadcast_id = f"BC_{datetime.now().strftime('%Y%m%d%H%M%S')}"
            
            # If scheduled, just return queued status
            if schedule_time:
                return {
                    "id": broadcast_id,
                    "message": message,
                    "target_type": target_type,
                    "target_count": len(target_users),
                    "status": "queued",
                    "created_at": datetime.now().isoformat(),
                    "schedule_time": schedule_time,
                    "note": "Broadcast scheduled. Sending will start at scheduled time."
                }
            
            # Send messages immediately
            # Try to get bot token from multiple sources
            bot_token = None
            if sdb_services and sdb_services.config:
                # Try from config.telegram.token
                try:
                    if hasattr(sdb_services.config, 'telegram') and hasattr(sdb_services.config.telegram, 'token'):
                        bot_token = sdb_services.config.telegram.token
                except:
                    pass
            
            # Fallback to environment variable
            if not bot_token:
                import os
                bot_token = os.getenv("BOT_TOKEN") or os.getenv("TELEGRAM_BOT_TOKEN")
            
            if bot_token:
                import asyncio
                import aiohttp
                api_url = f"https://api.telegram.org/bot{bot_token}/sendMessage"
                
                sent_count = 0
                error_count = 0
                
                # Send messages with rate limiting (max 30 messages per second for Telegram)
                async def send_to_user(telegram_id: int):
                    nonlocal sent_count, error_count
                    try:
                        async with aiohttp.ClientSession() as session:
                            async with session.post(
                                api_url,
                                json={
                                    "chat_id": telegram_id,
                                    "text": message,
                                    "parse_mode": "HTML",
                                    "disable_web_page_preview": True
                                },
                                timeout=aiohttp.ClientTimeout(total=10)
                            ) as response:
                                if response.status == 200:
                                    result = await response.json()
                                    if result.get("ok"):
                                        sent_count += 1
                                    else:
                                        error_count += 1
                                else:
                                    error_count += 1
                    except asyncio.TimeoutError:
                        error_count += 1
                    except Exception as e:
                        error_count += 1
                
                # Send messages in batches to respect rate limits
                batch_size = 20  # Send 20 messages at a time
                delay_between_batches = 1.0  # Wait 1 second between batches
                
                for i in range(0, len(target_users), batch_size):
                    batch = target_users[i:i + batch_size]
                    tasks = [send_to_user(tg_id) for tg_id in batch]
                    await asyncio.gather(*tasks, return_exceptions=True)
                    
                    # Wait before next batch (except for last batch)
                    if i + batch_size < len(target_users):
                        await asyncio.sleep(delay_between_batches)
                
                return {
                    "id": broadcast_id,
                    "message": message,
                    "target_type": target_type,
                    "target_count": len(target_users),
                    "sent_count": sent_count,
                    "error_count": error_count,
                    "status": "completed" if error_count == 0 else "completed_with_errors",
                    "created_at": datetime.now().isoformat(),
                    "schedule_time": schedule_time,
                    "note": f"Broadcast sent. {sent_count} successful, {error_count} errors."
                }
            else:
                # No bot token available - provide helpful error message
                debug_info = []
                if not sdb_services:
                    debug_info.append("sdb_services is None")
                elif not sdb_services.config:
                    debug_info.append("sdb_services.config is None")
                else:
                    debug_info.append("sdb_services.config exists")
                    try:
                        if hasattr(sdb_services.config, 'telegram'):
                            debug_info.append("config.telegram exists")
                            if hasattr(sdb_services.config.telegram, 'token'):
                                token_value = sdb_services.config.telegram.token
                                debug_info.append(f"config.telegram.token exists: {bool(token_value)} (length: {len(token_value) if token_value else 0})")
                            else:
                                debug_info.append("config.telegram.token attribute not found")
                        else:
                            debug_info.append("config.telegram attribute not found")
                    except Exception as e:
                        debug_info.append(f"Error checking config: {str(e)}")
                
                import os
                env_token = os.getenv("BOT_TOKEN") or os.getenv("TELEGRAM_BOT_TOKEN")
                if env_token:
                    debug_info.append(f"BOT_TOKEN found in environment (length: {len(env_token)})")
                else:
                    debug_info.append("BOT_TOKEN not found in environment")
                
                return {
                    "id": broadcast_id,
                    "message": message,
                    "target_type": target_type,
                    "target_count": len(target_users),
                    "status": "failed",
                    "created_at": datetime.now().isoformat(),
                    "schedule_time": schedule_time,
                    "note": f"Bot token not available. Debug info: {'; '.join(debug_info)}. Please ensure BOT_TOKEN is set in .env file or config.telegram.token is configured."
                }
        except HTTPException:
            raise
        except Exception as e:
            raise HTTPException(status_code=500, detail=f"Failed to create broadcast: {str(e)}")
    
    @app.get("/api/broadcasts/{broadcast_id}/progress")
    async def get_broadcast_progress(broadcast_id: str, request: Request):
        """Get broadcast progress."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return {"sent": 0, "total": 0, "errors": 0, "status": "unknown"}
        token = auth_header.replace("Bearer ", "")
        if not token:
            return {"sent": 0, "total": 0, "errors": 0, "status": "unknown"}
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                return {"sent": 0, "total": 0, "errors": 0, "status": "unknown"}
            
            # Check if user is admin
            user_info = jwt_handler.get_user_info(payload)
            if user_info.get("role", "").lower() != "admin":
                raise HTTPException(status_code=403, detail="Admin access required")
            
            # For now, return mock progress (in future, track in DB or Redis)
            return {
                "sent": 0,
                "total": 0,
                "errors": 0,
                "status": "completed"
            }
        except HTTPException:
            raise
        except Exception:
            return {"sent": 0, "total": 0, "errors": 0, "status": "unknown"}
    
    @app.get("/api/api-keys")
    async def get_api_keys(request: Request):
        """Get API keys list (admin only)."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            raise HTTPException(status_code=401, detail="Token required")
        token = auth_header.replace("Bearer ", "")
        if not token:
            raise HTTPException(status_code=401, detail="Token required")
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            if not payload:
                raise HTTPException(status_code=401, detail="Invalid token")
            
            # Check if user is admin
            user_info = jwt_handler.get_user_info(payload)
            if user_info.get("role", "").lower() != "admin":
                raise HTTPException(status_code=403, detail="Admin access required")
            
            # Load API keys from CLI storage
            try:
                from Systems.cli.api import _load_api_keys, API_KEYS_FILE
                keys_data = _load_api_keys()
                keys = keys_data.get("keys", {})
                
                # Convert to list format (hide actual keys for security)
                result = []
                for key_name, key_info in keys.items():
                    result.append({
                        "name": key_name,
                        "permissions": key_info.get("permissions", "read"),
                        "created_at": key_info.get("created_at"),
                        "expires_at": key_info.get("expires_at"),
                        "last_used": key_info.get("last_used"),
                        "usage_count": key_info.get("usage_count", 0),
                    })
                
                return result
            except Exception as e:
                return []
        except HTTPException:
            raise
        except Exception:
            return []
    
    @app.get("/api/users")
    async def get_users():
        """Get users list."""
        if sdb_services:
            async with sdb_services.db.get_session() as session:
                stmt = select(DBUser).options(selectinload(DBUser.roles)).order_by(DBUser.id)
                result = await session.execute(stmt)
                db_users = result.scalars().all()
                payload = []
                for user in db_users:
                    primary_role = user.roles[0].name if user.roles else "user"
                    avatar = user.username[:1].upper() if user.username else "U"
                    payload.append({
                        "id": user.id,
                        "username": user.username or "",
                        "first_name": user.first_name or "",
                        "last_name": user.last_name or "",
                        "role": primary_role,
                        "avatar": avatar,
                        "is_blocked": user.is_bot_blocked
                    })
                return payload

        # Fallback mock data
        return [
            {
                "id": 1,
                "username": "user1",
                "role": "user",
                "avatar": "U"
            },
            {
                "id": 2,
                "username": "admin",
                "role": "admin",
                "avatar": "A"
            },
            {
                "id": 3,
                "username": "user2",
                "role": "user",
                "avatar": "U"
            }
        ]

    @app.post("/api/users/{user_db_id}/block")
    async def block_user(user_db_id: int, payload: BlockUserRequest):
        """Block or unblock a user."""
        if not sdb_services:
            raise HTTPException(status_code=503, detail="SwiftDevBot services are not initialized.")

        async with sdb_services.db.get_session() as session:
            user = await session.get(DBUser, user_db_id)
            if not user:
                raise HTTPException(status_code=404, detail="User not found.")

            if user.telegram_id in sdb_services.config.core.super_admins:
                raise HTTPException(status_code=403, detail="Cannot change block status of super administrators.")

            changed = await sdb_services.user_service.set_user_bot_blocked_status(user, payload.block, session)

            if changed:
                await session.commit()
            else:
                await session.rollback()

            return {"success": changed, "is_blocked": user.is_bot_blocked}

    @app.post("/api/modules/{module_name}/toggle")
    async def toggle_module(module_name: str, payload: ModuleToggleRequest):
        """Enable or disable a plugin from the dashboard."""
        if not sdb_services:
            raise HTTPException(status_code=503, detail="SwiftDevBot services are not initialized.")

        module_info = sdb_services.modules.get_module_info(module_name)
        if not module_info:
            raise HTTPException(status_code=404, detail="Module not found.")

        if module_info.is_system_module:
            raise HTTPException(status_code=400, detail="System modules cannot be toggled via dashboard.")

        desired_status = payload.enable
        current_enabled = list(sdb_services.modules.enabled_plugin_names)

        if desired_status and module_name not in current_enabled:
            current_enabled.append(module_name)
        elif not desired_status and module_name in current_enabled:
            current_enabled.remove(module_name)

        try:
            saved_list = _persist_enabled_modules(current_enabled, sdb_services.config.core.enabled_modules_config_path)
        except Exception as exc:
            raise HTTPException(status_code=500, detail=f"Failed to persist enabled modules: {exc}")

        sdb_services.modules.enabled_plugin_names = saved_list
        if module_info:
            module_info.is_enabled = desired_status

        outcome = "active" if desired_status else "inactive"
        return {
            "success": True,
            "module": {
                "name": module_name,
                "status": outcome,
                "description": module_info.manifest.description if module_info.manifest and module_info.manifest.description else "",
                "display_name": module_info.manifest.display_name if module_info.manifest and module_info.manifest.display_name else module_name,
            },
            "enabled_modules": saved_list,
        }
    
    
    @app.get("/api/logs")
    async def get_logs(limit: int = 100, level: Optional[str] = None):
        """Get logs from log files."""
        if sdb_services:
            try:
                import re
                from datetime import datetime
                
                log_dir = sdb_services.config.core.project_data_path / sdb_services.config.core.log_structured_dir
                if not log_dir.exists():
                    return []
                
                # Get current hour log file and recent files
                now = datetime.now()
                current_log_file = log_dir / now.strftime("%Y") / f"{now.strftime('%m')}-{now.strftime('%B')}" / now.strftime("%d") / f"{now.strftime('%H')}_sdb.log"
                
                log_files = []
                if current_log_file.exists():
                    log_files.append(current_log_file)
                
                # Also check previous hour
                prev_hour = now.replace(minute=0, second=0, microsecond=0) - timedelta(hours=1)
                prev_log_file = log_dir / prev_hour.strftime("%Y") / f"{prev_hour.strftime('%m')}-{prev_hour.strftime('%B')}" / prev_hour.strftime("%d") / f"{prev_hour.strftime('%H')}_sdb.log"
                if prev_log_file.exists() and prev_log_file != current_log_file:
                    log_files.append(prev_log_file)
                
                all_logs = []
                for log_file in log_files:
                    try:
                        with open(log_file, 'r', encoding='utf-8') as f:
                            lines = f.readlines()
                            for line in lines[-500:]:  # Read last 500 lines from each file
                                # Parse loguru format: 2025-01-15 10:30:45.123 | LEVEL    | module:message
                                match = re.match(r'(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d+)\s+\|\s+(\w+)\s+\|\s+(.+)', line)
                                if match:
                                    timestamp_str, log_level, message = match.groups()
                                    try:
                                        timestamp = datetime.strptime(timestamp_str, '%Y-%m-%d %H:%M:%S.%f')
                                    except:
                                        timestamp = datetime.now()
                                    
                                    # Map loguru levels to our levels
                                    level_map = {
                                        'TRACE': 'info',
                                        'DEBUG': 'info',
                                        'INFO': 'info',
                                        'SUCCESS': 'success',
                                        'WARNING': 'warning',
                                        'ERROR': 'error',
                                        'CRITICAL': 'error'
                                    }
                                    mapped_level = level_map.get(log_level.upper(), 'info')
                                    
                                    if level and level != "all" and mapped_level != level:
                                        continue
                                    
                                    all_logs.append({
                                        "level": mapped_level,
                                        "message": message.strip(),
                                        "timestamp": timestamp.isoformat()
                                    })
                    except Exception as e:
                        continue
                
                # Sort by timestamp descending and limit
                all_logs.sort(key=lambda x: x["timestamp"], reverse=True)
                return all_logs[:limit]
            except Exception as e:
                # Fallback to empty on error
                return []
        
        # Fallback: return empty list
        return []
    
    # Authentication routes
    @app.post("/api/auth/login")
    async def login(request: Request):
        """Login endpoint - supports both username/password and token-based auth."""
        try:
            data = await request.json()
            
            # Token-based authentication (from Telegram bot)
            token = data.get("token")
            if token:
                try:
                    from Systems.web.auth.jwt_handler import get_jwt_handler
                    jwt_handler = get_jwt_handler()
                    payload = await jwt_handler.verify_token(token)
                    
                    if payload:
                        user_info = jwt_handler.get_user_info(payload)
                        # Ğ Ğ¾Ğ»ÑŒ ÑƒĞ¶Ğµ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ² lowercase Ğ² jwt_handler
                        role = user_info["role"].lower() if user_info.get("role") else "user"
                        # Get user from database to get first_name and last_name
                        user_id = user_info.get("user_id")
                        first_name = None
                        last_name = None
                        if user_id and sdb_services:
                            try:
                                async with sdb_services.db.get_session() as session:
                                    db_user = await session.get(DBUser, user_id)
                                    if db_user:
                                        first_name = db_user.first_name
                                        last_name = db_user.last_name
                            except:
                                pass
                        
                        return {
                            "user": {
                                "username": user_info["username"],
                                "role": role,
                                "first_name": first_name,
                                "last_name": last_name
                            },
                            "token": token
                        }
                    else:
                        raise HTTPException(status_code=401, detail="Invalid or expired token")
                except Exception as e:
                    raise HTTPException(status_code=401, detail=f"Token verification failed: {str(e)}")
            
            # Username/password authentication removed - only token-based auth is supported
            raise HTTPException(status_code=400, detail="Username/password authentication is disabled. Please use token-based authentication via Telegram bot.")
        except HTTPException:
            raise
        except Exception as e:
            raise HTTPException(status_code=400, detail=str(e))
    
    @app.get("/api/auth/verify")
    async def verify_token(token: Optional[str] = None):
        """Verify JWT token from query parameter."""
        if not token:
            raise HTTPException(status_code=400, detail="Token parameter is required")
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            
            if payload:
                user_info = jwt_handler.get_user_info(payload)
                return {
                    "valid": True,
                    "user": {
                        "username": user_info["username"],
                        "role": user_info["role"]
                    }
                }
            else:
                return {"valid": False, "error": "Invalid or expired token"}
        except Exception as e:
            return {"valid": False, "error": str(e)}
    
    @app.post("/api/auth/logout")
    async def logout():
        """Logout endpoint."""
        return {"success": True}
    
    # Cloud password endpoints
    @app.get("/api/auth/cloud-password/check")
    async def check_cloud_password_setup(request: Request):
        """Check if cloud password is setup for current user."""
        # Get user from token
        auth_header = request.headers.get("Authorization", "")
        if not auth_header:
            return {"isSetup": False}
        token = auth_header.replace("Bearer ", "")
        if not token:
            return {"isSetup": False}
        
        try:
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            
            if payload:
                user_info = jwt_handler.get_user_info(payload)
                user_id = user_info.get("user_id")
                
                # Check if cloud password exists (in real app, check database)
                # For demo, use localStorage-like approach
                cloud_password_file = Path(__file__).parent.parent.parent / "config" / f"cloud_password_{user_id}.txt"
                return {"isSetup": cloud_password_file.exists()}
        except Exception:
            pass
        
        return {"isSetup": False}
    
    @app.post("/api/auth/cloud-password/setup")
    async def setup_cloud_password(request: Request):
        """Setup cloud password for current user."""
        try:
            data = await request.json()
            password = data.get("password")
            
            if not password or len(password) < 8:
                raise HTTPException(status_code=400, detail="Password must be at least 8 characters")
            
            # Get user from token
            auth_header = request.headers.get("Authorization", "")
            if not auth_header:
                raise HTTPException(status_code=401, detail="Token required")
            token = auth_header.replace("Bearer ", "")
            if not token:
                raise HTTPException(status_code=401, detail="Token required")
            
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            
            if not payload:
                raise HTTPException(status_code=401, detail="Invalid token")
            
            user_info = jwt_handler.get_user_info(payload)
            user_id = user_info.get("user_id")
            
            # Hash password (in real app, use proper hashing like bcrypt)
            password_hash = hashlib.sha256(password.encode()).hexdigest()
            
            # Save cloud password (in real app, save to database)
            config_dir = Path(__file__).parent.parent.parent / "config"
            config_dir.mkdir(parents=True, exist_ok=True)
            cloud_password_file = config_dir / f"cloud_password_{user_id}.txt"
            
            with open(cloud_password_file, 'w') as f:
                f.write(password_hash)
            
            # Set secure permissions
            os.chmod(cloud_password_file, 0o600)
            
            return {"success": True}
        except HTTPException:
            raise
        except Exception as e:
            raise HTTPException(status_code=400, detail=str(e))
    
    @app.post("/api/auth/cloud-password/verify")
    async def verify_cloud_password(request: Request):
        """Verify cloud password for current user."""
        try:
            data = await request.json()
            password = data.get("password")
            
            if not password:
                raise HTTPException(status_code=400, detail="Password required")
            
            # Get user from token
            auth_header = request.headers.get("Authorization", "")
            if not auth_header:
                raise HTTPException(status_code=401, detail="Token required")
            token = auth_header.replace("Bearer ", "")
            if not token:
                raise HTTPException(status_code=401, detail="Token required")
            
            from Systems.web.auth.jwt_handler import get_jwt_handler
            jwt_handler = get_jwt_handler()
            payload = await jwt_handler.verify_token(token)
            
            if not payload:
                raise HTTPException(status_code=401, detail="Invalid token")
            
            user_info = jwt_handler.get_user_info(payload)
            user_id = user_info.get("user_id")
            
            # Load cloud password hash
            cloud_password_file = Path(__file__).parent.parent.parent / "config" / f"cloud_password_{user_id}.txt"
            
            if not cloud_password_file.exists():
                raise HTTPException(status_code=404, detail="Cloud password not setup")
            
            with open(cloud_password_file, 'r') as f:
                saved_hash = f.read().strip()
            
            # Verify password
            password_hash = hashlib.sha256(password.encode()).hexdigest()
            
            if password_hash != saved_hash:
                raise HTTPException(status_code=401, detail="Invalid password")
            
            return {"success": True}
        except HTTPException:
            raise
        except Exception as e:
            raise HTTPException(status_code=400, detail=str(e))
    
    # Catch-all route for SPA - must be last
    @app.get("/{path:path}", response_class=HTMLResponse)
    async def catch_all(path: str):
        """Catch-all route for SPA routing."""
        # Don't catch API routes or static files
        if path.startswith("api/") or path.startswith("assets/"):
            raise HTTPException(status_code=404, detail="Not found")
        
        # Serve index.html for all other routes
        if dist_dir.exists():
            index_path = dist_dir / "index.html"
            if index_path.exists():
                return FileResponse(str(index_path))
        
        return HTMLResponse("<h1>SwiftDevBot Dashboard</h1><p>Please build the frontend: npm run build</p>")
    
    return app



======================================================================

------------------------------ FILE: Systems/web/tsconfig.app.json ------------------------------
{
    "compilerOptions": {
      "target": "ES2020",
      "useDefineForClassFields": true,
      "lib": ["ES2020", "DOM", "DOM.Iterable"],
      "module": "ESNext",
      "skipLibCheck": true,
  
      /* Bundler mode */
      "moduleResolution": "bundler",
      "allowImportingTsExtensions": true,
      "isolatedModules": true,
      "moduleDetection": "force",
      "noEmit": true,
      "jsx": "react-jsx",
  
      /* Linting */
      "strict": true,
      "noUnusedLocals": true,
      "noUnusedParameters": true,
      "noFallthroughCasesInSwitch": true
    },
    "include": ["src"]
  }
  


======================================================================

------------------------------ FILE: Systems/web/index.html ------------------------------
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SwiftDevBot Futuristic Glass Dashboard</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>



======================================================================

------------------------------ FILE: Systems/web/eslint.config.js ------------------------------
import js from '@eslint/js';
import globals from 'globals';
import reactHooks from 'eslint-plugin-react-hooks';
import reactRefresh from 'eslint-plugin-react-refresh';
import tseslint from 'typescript-eslint';

export default tseslint.config(
  { ignores: ['dist'] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ['**/*.{ts,tsx}'],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      'react-hooks': reactHooks,
      'react-refresh': reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true },
      ],
    },
  }
);



======================================================================

------------------------------ FILE: Systems/web/__init__.py ------------------------------
# Systems/web/__init__.py
"""
Web interface for SwiftDevBot dashboard (React + TypeScript + Vite).
"""



======================================================================

------------------------------ FILE: Systems/web/tsconfig.node.json ------------------------------
{
    "compilerOptions": {
      "target": "ES2022",
      "lib": ["ES2023"],
      "module": "ESNext",
      "skipLibCheck": true,
  
      /* Bundler mode */
      "moduleResolution": "bundler",
      "allowImportingTsExtensions": true,
      "isolatedModules": true,
      "moduleDetection": "force",
      "noEmit": true,
  
      /* Linting */
      "strict": true,
      "noUnusedLocals": true,
      "noUnusedParameters": true,
      "noFallthroughCasesInSwitch": true
    },
    "include": ["vite.config.ts"]
  }
  


======================================================================

------------------------------ FILE: Systems/web/supabasex/migrations/20251104203347_create_swiftdevbot_schema.sql ------------------------------
/*
  # SwiftDevBot Database Schema

  ## Overview
  Complete database schema for SwiftDevBot admin dashboard with authentication,
  user management, module tracking, logs, and statistics.

  ## New Tables
  
  ### 1. `profiles`
  - `id` (uuid, FK to auth.users) - User profile ID
  - `email` (text) - User email
  - `full_name` (text) - User's full name
  - `role` (text) - User role: 'user' or 'admin'
  - `avatar_url` (text) - Profile avatar URL
  - `created_at` (timestamptz) - Account creation timestamp
  - `updated_at` (timestamptz) - Last update timestamp

  ### 2. `bot_modules`
  - `id` (uuid, PK) - Module ID
  - `name` (text) - Module name
  - `description` (text) - Module description
  - `status` (text) - Module status: 'active' or 'inactive'
  - `icon` (text) - Lucide icon name
  - `color` (text) - Theme color for UI
  - `config` (jsonb) - Module configuration
  - `created_at` (timestamptz) - Creation timestamp
  - `updated_at` (timestamptz) - Last update timestamp

  ### 3. `bot_logs`
  - `id` (uuid, PK) - Log entry ID
  - `level` (text) - Log level: 'info', 'warning', 'error', 'success'
  - `message` (text) - Log message
  - `module` (text) - Related module name
  - `metadata` (jsonb) - Additional log data
  - `created_at` (timestamptz) - Log timestamp

  ### 4. `bot_statistics`
  - `id` (uuid, PK) - Statistics ID
  - `metric_name` (text) - Metric name
  - `value` (numeric) - Metric value
  - `timestamp` (timestamptz) - Measurement timestamp
  - `metadata` (jsonb) - Additional metric data

  ### 5. `bot_users`
  - `id` (uuid, PK) - Bot user ID
  - `telegram_id` (bigint) - Telegram user ID
  - `username` (text) - Telegram username
  - `full_name` (text) - User's full name
  - `is_blocked` (boolean) - Block status
  - `interaction_count` (int) - Total interactions
  - `last_active` (timestamptz) - Last activity timestamp
  - `created_at` (timestamptz) - Registration timestamp

  ## Security
  - RLS enabled on all tables
  - Policies for authenticated users based on roles
  - Admin-only access for sensitive operations
*/

-- Create profiles table
CREATE TABLE IF NOT EXISTS profiles (
  id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  email text UNIQUE NOT NULL,
  full_name text NOT NULL,
  role text NOT NULL DEFAULT 'user' CHECK (role IN ('user', 'admin')),
  avatar_url text,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);

ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own profile"
  ON profiles FOR SELECT
  TO authenticated
  USING (auth.uid() = id);

CREATE POLICY "Users can update own profile"
  ON profiles FOR UPDATE
  TO authenticated
  USING (auth.uid() = id)
  WITH CHECK (auth.uid() = id);

-- Create bot_modules table
CREATE TABLE IF NOT EXISTS bot_modules (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text UNIQUE NOT NULL,
  description text NOT NULL,
  status text NOT NULL DEFAULT 'inactive' CHECK (status IN ('active', 'inactive')),
  icon text NOT NULL DEFAULT 'Box',
  color text NOT NULL DEFAULT '#3B82F6',
  config jsonb DEFAULT '{}'::jsonb,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);

ALTER TABLE bot_modules ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can view modules"
  ON bot_modules FOR SELECT
  TO authenticated
  USING (true);

CREATE POLICY "Only admins can modify modules"
  ON bot_modules FOR ALL
  TO authenticated
  USING (
    EXISTS (
      SELECT 1 FROM profiles
      WHERE profiles.id = auth.uid()
      AND profiles.role = 'admin'
    )
  )
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM profiles
      WHERE profiles.id = auth.uid()
      AND profiles.role = 'admin'
    )
  );

-- Create bot_logs table
CREATE TABLE IF NOT EXISTS bot_logs (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  level text NOT NULL CHECK (level IN ('info', 'warning', 'error', 'success')),
  message text NOT NULL,
  module text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamptz DEFAULT now()
);

ALTER TABLE bot_logs ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can view logs"
  ON bot_logs FOR SELECT
  TO authenticated
  USING (true);

CREATE POLICY "Only admins can insert logs"
  ON bot_logs FOR INSERT
  TO authenticated
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM profiles
      WHERE profiles.id = auth.uid()
      AND profiles.role = 'admin'
    )
  );

-- Create bot_statistics table
CREATE TABLE IF NOT EXISTS bot_statistics (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  metric_name text NOT NULL,
  value numeric NOT NULL,
  timestamp timestamptz DEFAULT now(),
  metadata jsonb DEFAULT '{}'::jsonb
);

CREATE INDEX IF NOT EXISTS idx_bot_statistics_metric ON bot_statistics(metric_name, timestamp DESC);

ALTER TABLE bot_statistics ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can view statistics"
  ON bot_statistics FOR SELECT
  TO authenticated
  USING (true);

CREATE POLICY "Only admins can insert statistics"
  ON bot_statistics FOR INSERT
  TO authenticated
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM profiles
      WHERE profiles.id = auth.uid()
      AND profiles.role = 'admin'
    )
  );

-- Create bot_users table
CREATE TABLE IF NOT EXISTS bot_users (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  telegram_id bigint UNIQUE NOT NULL,
  username text,
  full_name text NOT NULL,
  is_blocked boolean DEFAULT false,
  interaction_count int DEFAULT 0,
  last_active timestamptz DEFAULT now(),
  created_at timestamptz DEFAULT now()
);

ALTER TABLE bot_users ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can view bot users"
  ON bot_users FOR SELECT
  TO authenticated
  USING (true);

CREATE POLICY "Only admins can modify bot users"
  ON bot_users FOR ALL
  TO authenticated
  USING (
    EXISTS (
      SELECT 1 FROM profiles
      WHERE profiles.id = auth.uid()
      AND profiles.role = 'admin'
    )
  )
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM profiles
      WHERE profiles.id = auth.uid()
      AND profiles.role = 'admin'
    )
  );

-- Insert sample data for modules
INSERT INTO bot_modules (name, description, status, icon, color) VALUES
  ('AI Chat', 'Intelligent conversation module with GPT integration', 'active', 'MessageSquare', '#06B6D4'),
  ('Code Review', 'Automated code analysis and suggestions', 'active', 'Code', '#8B5CF6'),
  ('Task Manager', 'Project and task tracking system', 'inactive', 'CheckSquare', '#10B981'),
  ('Analytics', 'Real-time data analytics and reporting', 'active', 'BarChart3', '#F59E0B'),
  ('Notifications', 'Smart notification delivery system', 'active', 'Bell', '#EF4444'),
  ('File Manager', 'Document storage and management', 'inactive', 'Folder', '#6366F1')
ON CONFLICT (name) DO NOTHING;

-- Insert sample logs
INSERT INTO bot_logs (level, message, module) VALUES
  ('success', 'Bot successfully started and connected to Telegram API', 'System'),
  ('info', 'AI Chat module initialized with GPT-4 model', 'AI Chat'),
  ('warning', 'High memory usage detected: 85% of allocated resources', 'System'),
  ('success', 'Code Review completed for repository: swift-project', 'Code Review'),
  ('info', 'Analytics report generated: 1,247 active users', 'Analytics'),
  ('error', 'Failed to send notification: Network timeout', 'Notifications');


======================================================================

------------------------------ FILE: Systems/web/src/main.tsx ------------------------------
import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import App from './App.tsx';
import './index.css';

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>
);



======================================================================

------------------------------ FILE: Systems/web/src/index.css ------------------------------
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  /* OneUI Color Scheme */
  --oneui-primary: #6366f1;
  --oneui-primary-dark: #4f46e5;
  --oneui-secondary: #8b5cf6;
  --oneui-success: #10b981;
  --oneui-danger: #ef4444;
  --oneui-warning: #f59e0b;
  --oneui-info: #06b6d4;
  
  /* Light Theme */
  --oneui-bg: #ffffff;
  --oneui-bg-alt: #f8f9fa;
  --oneui-border: #e9ecef;
  --oneui-text: #495057;
  --oneui-text-muted: #6c757d;
  --oneui-sidebar-bg: #1e293b;
  --oneui-sidebar-text: #cbd5e1;
  --oneui-sidebar-hover: #334155;
  --oneui-header-bg: #ffffff;
  --oneui-header-border: #e9ecef;
}

[data-theme='dark'] {
  --oneui-bg: #1e293b;
  --oneui-bg-alt: #0f172a;
  --oneui-border: #334155;
  --oneui-text: #e2e8f0;
  --oneui-text-muted: #94a3b8;
  --oneui-sidebar-bg: #0f172a;
  --oneui-sidebar-text: #cbd5e1;
  --oneui-sidebar-hover: #1e293b;
  --oneui-header-bg: #1e293b;
  --oneui-header-border: #334155;
}

* {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  margin: 0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  background-color: var(--oneui-bg-alt);
  color: var(--oneui-text);
  transition: background-color 0.3s ease, color 0.3s ease;
  overflow-x: hidden;
  width: 100%;
  max-width: 100vw;
}

/* OneUI Layout */
.oneui-container {
  display: flex;
  min-height: 100vh;
  background-color: var(--oneui-bg-alt);
  width: 100%;
  max-width: 100vw;
  overflow-x: hidden;
}

.oneui-sidebar {
  width: 260px;
  background-color: var(--oneui-sidebar-bg);
  border-right: 1px solid var(--oneui-border);
  position: fixed;
  left: 0;
  top: 0;
  bottom: 0;
  z-index: 1000;
  transition: transform 0.3s ease;
  display: flex;
  flex-direction: column;
  height: 100vh;
}

.oneui-sidebar::-webkit-scrollbar {
  width: 6px;
}

.oneui-sidebar::-webkit-scrollbar-track {
  background: transparent;
}

.oneui-sidebar::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 3px;
}

.oneui-sidebar::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.2);
}

.oneui-main {
  flex: 1;
  margin-left: 260px;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  width: calc(100% - 260px);
  max-width: calc(100vw - 260px);
  overflow-x: hidden;
}

.oneui-header {
  height: 70px;
  background-color: var(--oneui-header-bg);
  border-bottom: 1px solid var(--oneui-header-border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 2rem;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.oneui-content {
  flex: 1;
  padding: 2rem;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  overflow-x: hidden;
}

/* Sidebar Logo */
.oneui-logo {
  height: 70px;
  display: flex;
  align-items: center;
  padding: 0 1.5rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.oneui-logo-text {
  font-size: 1.5rem;
  font-weight: 700;
  color: #ffffff;
  letter-spacing: -0.02em;
}

/* Sidebar Navigation */
.oneui-nav {
  padding: 1rem 0;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  flex: 1;
  overflow-y: auto;
  min-height: 0;
}

.oneui-nav-item {
  display: flex;
  align-items: center;
  padding: 0.75rem 1.5rem;
  color: var(--oneui-sidebar-text);
  text-decoration: none;
  transition: all 0.2s ease;
  cursor: pointer;
  border-left: 3px solid transparent;
}

.oneui-nav-item:hover {
  background-color: var(--oneui-sidebar-hover);
  color: #ffffff;
  border-left-color: var(--oneui-primary);
}

.oneui-nav-item.active {
  background-color: var(--oneui-sidebar-hover);
  color: #ffffff;
  border-left-color: var(--oneui-primary);
  font-weight: 600;
}

.oneui-nav-item-icon {
  width: 20px;
  height: 20px;
  margin-right: 0.75rem;
  flex-shrink: 0;
}

.oneui-nav-item-text {
  flex: 1;
  font-size: 0.9375rem;
}

.oneui-nav-section {
  padding: 1.5rem 1.5rem 0.5rem;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: rgba(255, 255, 255, 0.5);
}

/* Header */
.oneui-header-left {
  display: flex;
  align-items: center;
  gap: 1.5rem;
}

.oneui-header-right {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.oneui-header-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--oneui-text);
  margin: 0;
}

.oneui-header-subtitle {
  font-size: 0.875rem;
  color: var(--oneui-text-muted);
  margin: 0.25rem 0 0 0;
}

/* Buttons */
.oneui-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  font-weight: 500;
  border-radius: 0.375rem;
  border: 1px solid transparent;
  cursor: pointer;
  transition: all 0.2s ease;
  text-decoration: none;
}

.oneui-btn-primary {
  background-color: var(--oneui-primary);
  color: #ffffff;
  border-color: var(--oneui-primary);
}

.oneui-btn-primary:hover {
  background-color: var(--oneui-primary-dark);
  border-color: var(--oneui-primary-dark);
}

.oneui-btn-secondary {
  background-color: var(--oneui-bg);
  color: var(--oneui-text);
  border-color: var(--oneui-border);
}

.oneui-btn-secondary:hover {
  background-color: var(--oneui-bg-alt);
}

.oneui-btn-icon {
  padding: 0.5rem;
  background-color: transparent;
  border: none;
  color: var(--oneui-text-muted);
  cursor: pointer;
  border-radius: 0.375rem;
  transition: all 0.2s ease;
}

.oneui-btn-icon:hover {
  background-color: var(--oneui-bg-alt);
  color: var(--oneui-text);
}

/* Cards */
.oneui-card {
  background-color: var(--oneui-bg);
  border: 1px solid var(--oneui-border);
  border-radius: 0.5rem;
  padding: 1.5rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  width: 100%;
  box-sizing: border-box;
}

.oneui-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--oneui-border);
}

.oneui-card-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--oneui-text);
  margin: 0;
}

.oneui-card-content {
  width: 100%;
}

.oneui-card-footer {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 0.5rem;
  margin-top: 1.5rem;
  padding-top: 1rem;
  border-top: 1px solid var(--oneui-border);
}

/* Stats Cards */
.oneui-stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.oneui-stat-card {
  background-color: var(--oneui-bg);
  border: 1px solid var(--oneui-border);
  border-radius: 0.5rem;
  padding: 1.5rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.oneui-stat-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.oneui-stat-label {
  font-size: 0.875rem;
  color: var(--oneui-text-muted);
  margin-bottom: 0.5rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-weight: 600;
}

.oneui-stat-value {
  font-size: 2rem;
  font-weight: 700;
  color: var(--oneui-text);
  margin: 0;
}

.oneui-stat-icon {
  width: 48px;
  height: 48px;
  border-radius: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 1rem;
}

.oneui-stat-icon-primary {
  background-color: rgba(99, 102, 241, 0.1);
  color: var(--oneui-primary);
}

.oneui-stat-icon-success {
  background-color: rgba(16, 185, 129, 0.1);
  color: var(--oneui-success);
}

.oneui-stat-icon-warning {
  background-color: rgba(245, 158, 11, 0.1);
  color: var(--oneui-warning);
}

.oneui-stat-icon-danger {
  background-color: rgba(239, 68, 68, 0.1);
  color: var(--oneui-danger);
}

/* Tables */
.oneui-table {
  width: 100%;
  border-collapse: collapse;
  background-color: var(--oneui-bg);
  border-radius: 0.5rem;
  overflow: hidden;
}

.oneui-table thead {
  background-color: var(--oneui-bg-alt);
}

.oneui-table th {
  padding: 1rem;
  text-align: left;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--oneui-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-bottom: 1px solid var(--oneui-border);
}

.oneui-table td {
  padding: 1rem;
  border-bottom: 1px solid var(--oneui-border);
  color: var(--oneui-text);
}

.oneui-table tbody tr:hover {
  background-color: var(--oneui-bg-alt);
}

.oneui-table tbody tr:last-child td {
  border-bottom: none;
}

/* Badges */
.oneui-badge {
  display: inline-flex;
  align-items: center;
  padding: 0.25rem 0.75rem;
  font-size: 0.75rem;
  font-weight: 600;
  border-radius: 9999px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.oneui-badge-success {
  background-color: rgba(16, 185, 129, 0.1);
  color: var(--oneui-success);
}

.oneui-badge-warning {
  background-color: rgba(245, 158, 11, 0.1);
  color: var(--oneui-warning);
}

.oneui-badge-danger {
  background-color: rgba(239, 68, 68, 0.1);
  color: var(--oneui-danger);
}

.oneui-badge-info {
  background-color: rgba(6, 182, 212, 0.1);
  color: var(--oneui-info);
}

/* Dropdown */
.oneui-dropdown {
  position: relative;
}

.oneui-dropdown-menu {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 0.5rem;
  background-color: var(--oneui-bg);
  border: 1px solid var(--oneui-border);
  border-radius: 0.5rem;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  min-width: 200px;
  z-index: 1000;
  padding: 0.5rem;
}

@media (max-width: 640px) {
  .oneui-dropdown-menu-mobile {
    position: fixed !important;
    min-width: 180px !important;
    max-width: calc(100vw - 1.5rem) !important;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3) !important;
    margin-top: 0 !important;
    z-index: 10000 !important;
  }

  /* Ensure dropdown doesn't go off screen */
  .oneui-dropdown-menu-mobile {
    right: 0.75rem !important;
  }

  /* If dropdown would go off left, align to left */
  .oneui-dropdown-menu-mobile[style*="right: 0px"] {
    right: 0.75rem !important;
    left: auto !important;
  }
}

.oneui-dropdown-item {
  display: flex;
  align-items: center;
  padding: 0.75rem 1rem;
  color: var(--oneui-text);
  text-decoration: none;
  border-radius: 0.375rem;
  transition: background-color 0.2s ease;
  cursor: pointer;
}

.oneui-dropdown-item:hover {
  background-color: var(--oneui-bg-alt);
}

.oneui-dropdown-item-icon {
  width: 16px;
  height: 16px;
  margin-right: 0.75rem;
}

/* Responsive */
@media (max-width: 1024px) {
  .oneui-sidebar {
    transform: translateX(-100%);
    width: 280px;
  }

  .oneui-sidebar.open {
    transform: translateX(0);
  }

  .oneui-main {
    margin-left: 0;
    width: 100%;
    max-width: 100vw;
  }

  .oneui-header {
    padding: 0 1rem;
    height: 60px;
    width: 100%;
    max-width: 100vw;
  }

  .oneui-header-title {
    font-size: 1.25rem;
  }

  .oneui-header-subtitle {
    font-size: 0.75rem;
  }

  .oneui-content {
    padding: 1rem;
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
  }

  .oneui-stats-grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .oneui-card {
    padding: 1rem;
  }
}

@media (max-width: 640px) {
  .oneui-sidebar {
    width: 100%;
    max-width: 320px;
  }

  .oneui-header {
    height: 56px;
    padding: 0 0.75rem;
    width: 100%;
    max-width: 100vw;
    overflow-x: hidden;
  }

  .oneui-header-left {
    gap: 0.75rem;
  }

  .oneui-header-title {
    font-size: 1rem;
    line-height: 1.2;
  }

  .oneui-header-subtitle {
    display: none;
  }

  .oneui-header-right {
    gap: 0.5rem;
  }

  .oneui-btn-icon {
    padding: 0.375rem;
  }

  .oneui-content {
    padding: 0.75rem;
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
  }

  .oneui-stats-grid {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }

  .oneui-stat-card {
    padding: 1rem;
  }

  .oneui-stat-value {
    font-size: 1.5rem;
  }

  .oneui-card {
    padding: 1rem;
  }

  .oneui-card-header {
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
  }

  .oneui-card-title {
    font-size: 1rem;
  }

  .oneui-table {
    font-size: 0.875rem;
  }

  .oneui-table th,
  .oneui-table td {
    padding: 0.75rem 0.5rem;
  }

  .oneui-dropdown-menu {
    min-width: 180px;
    right: 0;
    left: auto;
  }

  /* Hide search on mobile */
  .oneui-header-left > div:has(input[type="text"]) {
    display: none;
  }

  /* Table responsive improvements */
  .oneui-table {
    display: block;
    overflow-x: auto;
    white-space: nowrap;
  }

  .oneui-table thead,
  .oneui-table tbody,
  .oneui-table tr {
    display: table;
    width: 100%;
    table-layout: fixed;
  }

  .oneui-table th,
  .oneui-table td {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
}

/* Loading Spinner */
.oneui-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid var(--oneui-border);
  border-top-color: var(--oneui-primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* Utilities */
.oneui-text-muted {
  color: var(--oneui-text-muted);
}

.oneui-text-primary {
  color: var(--oneui-primary);
}

.oneui-text-success {
  color: var(--oneui-success);
}

.oneui-text-danger {
  color: var(--oneui-danger);
}

.oneui-text-warning {
  color: var(--oneui-warning);
}



======================================================================

------------------------------ FILE: Systems/web/src/vite-env.d.ts ------------------------------
/// <reference types="vite/client" />



======================================================================

------------------------------ FILE: Systems/web/src/package.json ------------------------------



======================================================================

------------------------------ FILE: Systems/web/src/api.ts ------------------------------
export interface BotUser {
    id: number;
    username: string;
    first_name?: string;
    last_name?: string;
    role: string;
    avatar?: string;
    is_blocked: boolean;
}

export interface BotModule {
    name: string;
    status: 'active' | 'inactive';
    description?: string;
    display_name?: string;
    is_system_module?: boolean;
    version?: string | null;
}

export interface Profile {
    username: string;
    first_name?: string;
    last_name?: string;
    role: string;
}

export interface BotStats {
    uptime?: string;
    messages_today?: number;
    total_users?: number;
    active_modules?: number;
    total_modules?: number;
}

export interface BotLog {
    level: string;
    message: string;
    timestamp: string;
}

export interface SystemMetrics {
    cpu: number;
    ram: number;
    ramUsed: number;
    ramTotal: number;
    disk: number;
    diskUsed: number;
    diskTotal: number;
    redis: number;
    redisUsed: number;
    redisTotal: number;
    dbConnections: number;
}

export interface LiveMetrics {
    rps: number;
    responseTime: number;
    errorRate: number;
    activeUsers: number;
    newUsersToday: number;
    queueSize: number;
}

export interface Service {
    id: string;
    name: string;
    description: string;
    status: 'running' | 'stopped' | 'restarting';
    uptime: string;
    memory: string;
}

export interface FeatureFlag {
    name: string;
    enabled: boolean;
    description: string;
}

export interface Session {
    id: string;
    device: string;
    location: string;
    lastActivity: string;
    current: boolean;
    ip: string;
}

export interface Token {
    id: string;
    name: string;
    created: string;
    lastUsed: string | null;
    token?: string;
}

export interface CommandHistoryItem {
    id: number;
    command: string;
    date: string;
    status: string;
}

export interface FileItem {
    id: number;
    name: string;
    size: string;
    uploadDate: string;
}

export interface Ticket {
    id: string;
    subject: string;
    status: string;
    created: string;
    updated: string;
}

export interface CronJob {
    id: string;
    name: string;
    func: string;
    next_run_time: string | null;
    trigger: string | null;
}

export interface AuditLog {
    event_id: string;
    event_type: string;
    module_name: string;
    user_id: number | null;
    timestamp: number;
    severity: 'low' | 'medium' | 'high' | 'critical';
    details: Record<string, any>;
    ip_address: string | null;
    user_agent: string | null;
    success: boolean;
    error_message: string | null;
}

export interface AuditStats {
    total_events: number;
    events_by_type: Record<string, number>;
    events_by_severity: Record<string, number>;
    events_by_module: Record<string, number>;
    violations_count: number;
}

export interface ApiKey {
    name: string;
    permissions: string;
    created_at: string;
    expires_at: string | null;
    last_used: string | null;
    usage_count: number;
}

export interface Migration {
    revision: string;
    down_revision: string | null;
    branch_labels: string[];
    is_current: boolean;
    doc: string;
}

export interface CacheKey {
    key: string;
    ttl: number | null;
}

export interface Broadcast {
    id: string;
    message: string;
    target_type: 'all' | 'admins' | 'role' | 'active' | 'inactive' | 'new_users' | 'language' | 'active_status';
    target_count: number;
    sent_count?: number;
    error_count?: number;
    status: 'queued' | 'sending' | 'completed' | 'completed_with_errors' | 'failed';
    created_at: string;
    schedule_time?: string | null;
    note?: string;
}

export interface BroadcastProgress {
    sent: number;
    total: number;
    errors: number;
    status: 'sending' | 'completed' | 'failed' | 'unknown';
}

export const api = {
    loginWithToken: async (token: string) => {
        const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token }),
        });
        if (!response.ok) throw new Error('Login failed');
        return response.json();
    },

    checkCloudPasswordSetup: async () => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/auth/cloud-password/check', {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Check failed');
        return response.json();
    },

    setupCloudPassword: async (password: string) => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/auth/cloud-password/setup', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ password }),
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Setup failed' }));
            throw new Error(error.detail || 'Setup failed');
        }
        return response.json();
    },

    verifyCloudPassword: async (password: string) => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/auth/cloud-password/verify', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ password }),
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Verification failed' }));
            throw new Error(error.detail || 'Verification failed');
        }
        return response.json();
    },

    logout: async () => {
        await fetch('/api/auth/logout', { method: 'POST' });
    }
,

    getUsers: async (): Promise<BotUser[]> => {
        const response = await fetch('/api/users');
        if (!response.ok) throw new Error('Failed to load users');
        return response.json();
    },

    toggleUserBlockStatus: async (userId: number, block: boolean) => {
        const response = await fetch(`/api/users/${userId}/block`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ block }),
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Toggle failed' }));
            throw new Error(error.detail || 'Toggle failed');
        }
        return response.json();
    },

    getModules: async (includeSystem: boolean = false): Promise<BotModule[]> => {
        const response = await fetch(`/api/modules?include_system=${includeSystem}`);
        if (!response.ok) throw new Error('Failed to load modules');
        return response.json();
    },

    toggleModuleStatus: async (moduleName: string, enable: boolean) => {
        const response = await fetch(`/api/modules/${moduleName}/toggle`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ enable }),
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Toggle failed' }));
            throw new Error(error.detail || 'Toggle failed');
        }
        return response.json();
    },

    getStats: async (): Promise<BotStats> => {
        const response = await fetch('/api/stats');
        if (!response.ok) throw new Error('Failed to load stats');
        return response.json();
    },

    getLogs: async (limit: number = 100, level?: string): Promise<BotLog[]> => {
        const params = new URLSearchParams();
        if (limit) params.append('limit', limit.toString());
        if (level) params.append('level', level);
        const response = await fetch(`/api/logs?${params.toString()}`);
        if (!response.ok) throw new Error('Failed to load logs');
        return response.json();
    },

    getSystemMetrics: async (): Promise<SystemMetrics> => {
        const response = await fetch('/api/metrics/system');
        if (!response.ok) throw new Error('Failed to load system metrics');
        return response.json();
    },

    getLiveMetrics: async (): Promise<LiveMetrics> => {
        const response = await fetch('/api/metrics/live');
        if (!response.ok) throw new Error('Failed to load live metrics');
        return response.json();
    },

    getServices: async (): Promise<Service[]> => {
        const response = await fetch('/api/services');
        if (!response.ok) throw new Error('Failed to load services');
        return response.json();
    },

    serviceAction: async (serviceId: string, action: 'start' | 'stop' | 'restart'): Promise<void> => {
        const response = await fetch(`/api/services/${serviceId}/${action}`, {
            method: 'POST',
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Action failed' }));
            throw new Error(error.detail || 'Action failed');
        }
    },

    getConfig: async (): Promise<{content: string}> => {
        const response = await fetch('/api/config');
        if (!response.ok) throw new Error('Failed to load config');
        return response.json();
    },

    updateConfig: async (content: string): Promise<void> => {
        const response = await fetch('/api/config', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content }),
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Update failed' }));
            throw new Error(error.detail || 'Update failed');
        }
    },

    reloadConfig: async (): Promise<{success: boolean, message: string}> => {
        const response = await fetch('/api/config/reload', {
            method: 'POST',
        });
        if (!response.ok) throw new Error('Failed to reload config');
        return response.json();
    },

    getFeatureFlags: async (): Promise<FeatureFlag[]> => {
        const response = await fetch('/api/feature-flags');
        if (!response.ok) throw new Error('Failed to load feature flags');
        return response.json();
    },

    updateFeatureFlag: async (name: string, enabled: boolean): Promise<void> => {
        const response = await fetch(`/api/feature-flags/${name}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ enabled }),
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Update failed' }));
            throw new Error(error.detail || 'Update failed');
        }
    },

    getSessions: async (): Promise<Session[]> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/sessions', {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load sessions');
        return response.json();
    },

    terminateSession: async (sessionId: string): Promise<void> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch(`/api/sessions/${sessionId}/terminate`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Terminate failed' }));
            throw new Error(error.detail || 'Terminate failed');
        }
    },

    getTokens: async (): Promise<Token[]> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/tokens', {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load tokens');
        return response.json();
    },

    createToken: async (name: string): Promise<{token: string, id: string, name: string, created: string, lastUsed: string | null}> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/tokens', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ name }),
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Create failed' }));
            throw new Error(error.detail || 'Create failed');
        }
        return response.json();
    },

    revokeToken: async (tokenId: string): Promise<void> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch(`/api/tokens/${tokenId}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Revoke failed' }));
            throw new Error(error.detail || 'Revoke failed');
        }
    },

    getCommandHistory: async (limit?: number): Promise<CommandHistoryItem[]> => {
        const token = localStorage.getItem('sdb_token');
        const params = limit ? `?limit=${limit}` : '';
        const response = await fetch(`/api/command-history${params}`, {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load command history');
        return response.json();
    },

    getFiles: async (): Promise<FileItem[]> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/files', {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load files');
        return response.json();
    },

    getTickets: async (): Promise<Ticket[]> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/tickets', {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load tickets');
        return response.json();
    },

    createTicket: async (subject: string, message: string): Promise<Ticket> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/tickets', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ subject, message }),
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Create failed' }));
            throw new Error(error.detail || 'Create failed');
        }
        return response.json();
    },

    executeTerminalCommand: async (command: string): Promise<{output: string, success: boolean, timestamp: string}> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/terminal/execute', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ command }),
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Execute failed' }));
            throw new Error(error.detail || 'Execute failed');
        }
        return response.json();
    },

    getCronJobs: async (): Promise<CronJob[]> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/cron-jobs', {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load cron jobs');
        return response.json();
    },

    streamLogs: async (limit?: number, level?: string): Promise<BotLog[]> => {
        const token = localStorage.getItem('sdb_token');
        const query = new URLSearchParams();
        if (limit) query.append('limit', limit.toString());
        if (level) query.append('level', level);
        const response = await fetch(`/api/logs/stream?${query.toString()}`, {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to stream logs');
        return response.json();
    },

    getAuditLogs: async (params?: {
        limit?: number;
        module_name?: string;
        event_type?: string;
        severity?: string;
        start_time?: number;
        end_time?: number;
    }): Promise<AuditLog[]> => {
        const token = localStorage.getItem('sdb_token');
        const query = new URLSearchParams();
        if (params) {
            if (params.limit) query.append('limit', params.limit.toString());
            if (params.module_name) query.append('module_name', params.module_name);
            if (params.event_type) query.append('event_type', params.event_type);
            if (params.severity) query.append('severity', params.severity);
            if (params.start_time) query.append('start_time', params.start_time.toString());
            if (params.end_time) query.append('end_time', params.end_time.toString());
        }
        const response = await fetch(`/api/audit-logs?${query.toString()}`, {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load audit logs');
        return response.json();
    },

    getAuditStats: async (): Promise<AuditStats> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/audit-stats', {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load audit stats');
        return response.json();
    },

    getApiKeys: async (): Promise<ApiKey[]> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/api-keys', {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load API keys');
        return response.json();
    },

    executeSqlQuery: async (query: string): Promise<{columns: string[], data: Record<string, any>[], row_count: number}> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/database/query', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ query }),
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Query failed' }));
            throw new Error(error.detail || 'Query failed');
        }
        return response.json();
    },

    getMigrations: async (): Promise<Migration[]> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/migrations', {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load migrations');
        return response.json();
    },

    migrationAction: async (action: 'upgrade' | 'downgrade', revision?: string): Promise<{success: boolean, message: string}> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch(`/api/migrations/${action}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ revision }),
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Migration action failed' }));
            throw new Error(error.detail || 'Migration action failed');
        }
        return response.json();
    },

    getCacheKeys: async (pattern?: string, limit?: number): Promise<CacheKey[]> => {
        const token = localStorage.getItem('sdb_token');
        const query = new URLSearchParams();
        if (pattern) query.append('pattern', pattern);
        if (limit) query.append('limit', limit.toString());
        const response = await fetch(`/api/cache/keys?${query.toString()}`, {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load cache keys');
        return response.json();
    },

    flushCache: async (): Promise<{success: boolean, message: string}> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/cache/flush', {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Flush failed' }));
            throw new Error(error.detail || 'Flush failed');
        }
        return response.json();
    },

    getBroadcasts: async (): Promise<Broadcast[]> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/broadcasts', {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load broadcasts');
        return response.json();
    },

    createBroadcast: async (data: {
        message: string;
        target_type: 'all' | 'admins' | 'role' | 'active' | 'inactive' | 'new_users' | 'language' | 'active_status';
        target_value?: string | number;
        schedule_time?: string | null;
    }): Promise<Broadcast> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch('/api/broadcasts', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(data),
        });
        if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: 'Create failed' }));
            throw new Error(error.detail || 'Create failed');
        }
        return response.json();
    },

    getBroadcastProgress: async (broadcastId: string): Promise<BroadcastProgress> => {
        const token = localStorage.getItem('sdb_token');
        const response = await fetch(`/api/broadcasts/${broadcastId}/progress`, {
            headers: { 'Authorization': `Bearer ${token}` },
        });
        if (!response.ok) throw new Error('Failed to load progress');
        return response.json();
    }
};



======================================================================

------------------------------ FILE: Systems/web/src/App.tsx ------------------------------
import { AuthProvider, useAuth } from './contexts/AuthContext';
import { ThemeProvider } from './contexts/ThemeContext';
import { I18nProvider, useI18n } from './contexts/I18nContext';
import { CloudPasswordSetup } from './pages/CloudPasswordSetup';
import { CloudPasswordPrompt } from './pages/CloudPasswordPrompt';
import { Dashboard } from './pages/Dashboard';

const AppContent = () => {
  const { user, loading, cloudPasswordSetup, cloudPasswordVerified } = useAuth();
  const { t } = useI18n();
  
  // Debug logging
  console.log('AppContent render:', { 
    hasUser: !!user, 
    loading, 
    cloudPasswordSetup, 
    cloudPasswordVerified 
  });

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="loading-spinner"></div>
      </div>
    );
  }

  // If user exists but cloud password status is still checking
  if (user && cloudPasswordSetup === null) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="loading-spinner"></div>
      </div>
    );
  }

  // If user is logged in but cloud password not verified
  if (user && !cloudPasswordVerified) {
    if (cloudPasswordSetup === false) {
      // First time - need to setup cloud password
      return <CloudPasswordSetup />;
    } else {
      // Cloud password exists - need to verify
      return <CloudPasswordPrompt />;
    }
  }

  // User is logged in and cloud password verified
  if (user && cloudPasswordVerified) {
    return <Dashboard />;
  }

  // No user - show message that login is only via token
  return (
    <div className="min-h-screen flex items-center justify-center p-4" style={{ backgroundColor: 'var(--oneui-bg-alt)' }}>
      <div className="text-center max-w-md oneui-card">
        <h1 className="text-3xl font-bold mb-4" style={{ color: 'var(--oneui-text)' }}>SwiftDevBot</h1>
        <p className="oneui-text-muted mb-6">
          {t('auth.loginViaTelegram')} <code className="bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded">/login</code>
          </p>
        <p className="text-sm oneui-text-muted">
          {t('auth.loginLink')}
          </p>
        </div>
      </div>
  );
};

function App() {
  return (
    <I18nProvider>
    <ThemeProvider>
      <AuthProvider>
        <AppContent />
      </AuthProvider>
    </ThemeProvider>
    </I18nProvider>
  );
}

export default App;



======================================================================

------------------------------ FILE: Systems/web/src/components/AnimatedBackground.tsx ------------------------------
import { useTheme } from '../contexts/ThemeContext';

export const AnimatedBackground = () => {
  const { theme } = useTheme();

  return (
    <div className="animated-background">
      <div className="gradient-orb orb-1"></div>
      <div className="gradient-orb orb-2"></div>
      <div className="gradient-orb orb-3"></div>
      <div className="gradient-orb orb-4"></div>
      {theme === 'dark' && (
        <>
          <div className="light-beam beam-1"></div>
          <div className="light-beam beam-2"></div>
          <div className="light-beam beam-3"></div>
        </>
      )}
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/CommandPalette.tsx ------------------------------
import { useEffect, useState, useRef } from 'react';
import { useNavigation } from '../contexts/NavigationContext';
import { Search, Command, ArrowRight } from 'lucide-react';

type CommandItem = {
  id: string;
  label: string;
  description: string;
  action: () => void;
  category: string;
  keywords: string[];
};

export const CommandPalette = ({ isOpen, onClose }: { isOpen: boolean; onClose: () => void }) => {
  const { navigateTo } = useNavigation();
  const [query, setQuery] = useState('');
  const [selectedIndex, setSelectedIndex] = useState(0);
  const inputRef = useRef<HTMLInputElement>(null);

  const commands: CommandItem[] = [
    { id: 'mission-control', label: 'Mission Control', description: 'Open real-time monitoring dashboard', action: () => navigateTo('missionControl'), category: 'Navigation', keywords: ['mission', 'control', 'monitoring', 'dashboard'] },
    { id: 'users', label: 'User Management', description: 'Manage users and permissions', action: () => navigateTo('users'), category: 'Navigation', keywords: ['users', 'user', 'manage'] },
    { id: 'modules', label: 'Modules', description: 'Manage bot modules', action: () => navigateTo('modules'), category: 'Navigation', keywords: ['modules', 'module', 'plugins'] },
    { id: 'core-management', label: 'Core Management', description: 'Configure core settings and services', action: () => navigateTo('coreManagement'), category: 'Navigation', keywords: ['core', 'config', 'settings', 'services'] },
    { id: 'logs', label: 'View Logs', description: 'Open system logs viewer', action: () => navigateTo('logs'), category: 'Navigation', keywords: ['logs', 'log', 'view'] },
    { id: 'terminal', label: 'Terminal', description: 'Open web terminal', action: () => navigateTo('terminal'), category: 'Tools', keywords: ['terminal', 'console', 'shell'] },
    { id: 'restart-bot', label: 'Restart Bot', description: 'Restart the bot process', action: () => { console.log('Restart bot'); onClose(); }, category: 'Actions', keywords: ['restart', 'reboot', 'bot'] },
    { id: 'clear-cache', label: 'Clear Cache', description: 'Clear Redis cache', action: () => { console.log('Clear cache'); onClose(); }, category: 'Actions', keywords: ['clear', 'cache', 'redis'] },
  ];

  const filteredCommands = query
    ? commands.filter(cmd =>
        cmd.label.toLowerCase().includes(query.toLowerCase()) ||
        cmd.description.toLowerCase().includes(query.toLowerCase()) ||
        cmd.keywords.some(k => k.toLowerCase().includes(query.toLowerCase()))
      )
    : commands;

  useEffect(() => {
    if (isOpen && inputRef.current) {
      inputRef.current.focus();
    }
  }, [isOpen]);

  useEffect(() => {
    setSelectedIndex(0);
  }, [query]);

  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (!isOpen) return;

      if (e.key === 'Escape') {
        onClose();
      } else if (e.key === 'ArrowDown') {
        e.preventDefault();
        setSelectedIndex(prev => Math.min(prev + 1, filteredCommands.length - 1));
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        setSelectedIndex(prev => Math.max(prev - 1, 0));
      } else if (e.key === 'Enter' && filteredCommands[selectedIndex]) {
        e.preventDefault();
        filteredCommands[selectedIndex].action();
        onClose();
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [isOpen, selectedIndex, filteredCommands, onClose]);

  if (!isOpen) return null;

  return (
    <>
      <div
        className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50"
        onClick={onClose}
      />
      <div
        className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl z-50"
        style={{ maxHeight: '80vh' }}
      >
        <div className="oneui-card shadow-2xl">
          <div className="flex items-center gap-3 mb-4">
            <Search className="w-5 h-5" style={{ color: 'var(--oneui-text-muted)' }} />
            <input
              ref={inputRef}
              type="text"
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              placeholder="Type a command or search..."
              className="flex-1 bg-transparent border-none outline-none text-lg"
              style={{ color: 'var(--oneui-text)' }}
            />
            <div className="flex items-center gap-1 px-2 py-1 rounded text-xs" style={{ backgroundColor: 'var(--oneui-bg-alt)' }}>
              <Command className="w-3 h-3" />
              <span>K</span>
            </div>
          </div>

          <div className="max-h-96 overflow-y-auto">
            {filteredCommands.length === 0 ? (
              <div className="text-center py-8 oneui-text-muted">
                No commands found
              </div>
            ) : (
              <div className="space-y-1">
                {filteredCommands.map((cmd, index) => (
                  <button
                    key={cmd.id}
                    onClick={() => {
                      cmd.action();
                      onClose();
                    }}
                    className={`w-full text-left p-3 rounded-lg flex items-center justify-between transition-colors ${
                      index === selectedIndex
                        ? 'bg-indigo-500/20 border border-indigo-500/50'
                        : 'hover:bg-gray-100 dark:hover:bg-gray-800'
                    }`}
                    onMouseEnter={() => setSelectedIndex(index)}
                  >
                    <div className="flex-1">
                      <div className="font-medium mb-1" style={{ color: 'var(--oneui-text)' }}>
                        {cmd.label}
                      </div>
                      <div className="text-sm oneui-text-muted">{cmd.description}</div>
                    </div>
                    <div className="flex items-center gap-2">
                      <span className="text-xs px-2 py-1 rounded" style={{ backgroundColor: 'var(--oneui-bg-alt)' }}>
                        {cmd.category}
                      </span>
                      <ArrowRight className="w-4 h-4 oneui-text-muted" />
                    </div>
                  </button>
                ))}
              </div>
            )}
          </div>
        </div>
      </div>
    </>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/Sidebar.tsx ------------------------------
import { useState } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { useI18n } from '../contexts/I18nContext';
import {
  Home,
  Box,
  Users,
  BarChart3,
  FileText,
  Settings,
  BookOpen,
  Server,
  Activity,
  Sliders,
  Shield,
  ChevronRight,
  ChevronDown,
  Bell,
  Database,
  Key,
  Terminal,
  HelpCircle,
  Grid,
  Rocket,
  Clock,
  ShieldCheck,
  Database as DatabaseIcon,
  Megaphone,
} from 'lucide-react';

type MenuItem = {
  id: string;
  labelKey: string;
  icon: React.ElementType;
  adminOnly?: boolean;
  userOnly?: boolean;
};

// ĞĞ±Ñ‰Ğ¸Ğµ Ğ¿ÑƒĞ½ĞºÑ‚Ñ‹ Ğ¼ĞµĞ½Ñ (Ğ´Ğ»Ñ Ğ²ÑĞµÑ…)
const commonMenuItems: MenuItem[] = [
  { id: 'home', labelKey: 'sidebar.home', icon: Home },
  { id: 'modules', labelKey: 'sidebar.modules', icon: Box },
  { id: 'settings', labelKey: 'sidebar.settings', icon: Settings },
];

// ĞŸÑƒĞ½ĞºÑ‚Ñ‹ Ğ¼ĞµĞ½Ñ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
const userMenuItems: MenuItem[] = [
  { id: 'home', labelKey: 'sidebar.home', icon: Home },
  { id: 'modules', labelKey: 'sidebar.modulesHub', icon: Grid },
  { id: 'statistics', labelKey: 'sidebar.statistics', icon: BarChart3 },
  { id: 'notifications', labelKey: 'sidebar.notifications', icon: Bell, userOnly: true },
  { id: 'data', labelKey: 'sidebar.data', icon: Database, userOnly: true },
  { id: 'developer', labelKey: 'sidebar.developer', icon: Key, userOnly: true },
  { id: 'terminal', labelKey: 'sidebar.terminal', icon: Terminal, userOnly: true },
  { id: 'security', labelKey: 'sidebar.security', icon: Shield, userOnly: true },
  { id: 'support', labelKey: 'sidebar.support', icon: HelpCircle, userOnly: true },
  { id: 'settings', labelKey: 'sidebar.settings', icon: Settings },
  { id: 'docs', labelKey: 'sidebar.documentation', icon: BookOpen },
];

// ĞŸÑƒĞ½ĞºÑ‚Ñ‹ Ğ¼ĞµĞ½Ñ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ² (Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¼)
const adminMenuItems: MenuItem[] = [
  { id: 'missionControl', labelKey: 'sidebar.missionControl', icon: Rocket, adminOnly: true },
  { id: 'users', labelKey: 'sidebar.users', icon: Users, adminOnly: true },
  { id: 'logs', labelKey: 'sidebar.logs', icon: FileText, adminOnly: true },
  { id: 'cronJobs', labelKey: 'sidebar.cronJobs', icon: Clock, adminOnly: true },
  { id: 'securityOperations', labelKey: 'sidebar.securityOperations', icon: ShieldCheck, adminOnly: true },
  { id: 'databaseData', labelKey: 'sidebar.databaseData', icon: DatabaseIcon, adminOnly: true },
  { id: 'broadcastStudio', labelKey: 'sidebar.broadcastStudio', icon: Megaphone, adminOnly: true },
  { id: 'config', labelKey: 'sidebar.coreConfig', icon: Sliders, adminOnly: true },
  { id: 'coreManagement', labelKey: 'sidebar.coreManagement', icon: Settings, adminOnly: true },
  { id: 'services', labelKey: 'sidebar.services', icon: Server, adminOnly: true },
  { id: 'monitoring', labelKey: 'sidebar.monitoring', icon: Activity, adminOnly: true },
];

type SidebarProps = {
  activeSection: string;
  onSectionChange: (section: string) => void;
  isMobileOpen: boolean;
  onClose: () => void;
};

export const Sidebar = ({ activeSection, onSectionChange, isMobileOpen, onClose }: SidebarProps) => {
  const { isAdmin, profile } = useAuth();
  const { t } = useI18n();
  const [userMenuCollapsed, setUserMenuCollapsed] = useState(false);
  const [adminMenuCollapsed, setAdminMenuCollapsed] = useState(false);

  const handleItemClick = (id: string) => {
    onSectionChange(id);
    onClose();
  };

  // Ğ Ğ°Ğ·Ğ´ĞµĞ»ÑĞµĞ¼ Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½ÑĞºĞ¸Ğµ Ğ¿ÑƒĞ½ĞºÑ‚Ñ‹
  const userItems = userMenuItems;
  const adminItems = isAdmin ? adminMenuItems : [];

  return (
    <>
      {isMobileOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-40 lg:hidden"
          onClick={onClose}
        />
      )}

      <aside className={`oneui-sidebar ${isMobileOpen ? 'open' : ''}`} style={{ display: 'flex', flexDirection: 'column', height: '100vh' }}>
        {/* Logo */}
        <div className="oneui-logo" style={{ flexShrink: 0 }}>
          <div className="oneui-logo-text">SwiftDevBot</div>
        </div>

        {/* Navigation - scrollable area */}
        <nav className="oneui-nav" style={{ flex: 1, overflowY: 'auto', minHeight: 0 }}>
          {/* User Menu Section */}
          <div>
            <button
              onClick={() => setUserMenuCollapsed(!userMenuCollapsed)}
              className="w-full flex items-center justify-between px-4 py-2 mb-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
      >
              <span className="text-xs font-semibold uppercase oneui-text-muted">
                {t('sidebar.userMenu')}
              </span>
              {userMenuCollapsed ? (
                <ChevronRight className="w-4 h-4 oneui-text-muted" />
              ) : (
                <ChevronDown className="w-4 h-4 oneui-text-muted" />
              )}
            </button>
            {!userMenuCollapsed && (
              <div className="space-y-1">
                {userItems.map((item) => {
                const Icon = item.icon;
                const isActive = activeSection === item.id;

                return (
                    <div
                    key={item.id}
                    onClick={() => handleItemClick(item.id)}
                      className={`oneui-nav-item ${isActive ? 'active' : ''}`}
                  >
                      <Icon className="oneui-nav-item-icon" />
                      <span className="oneui-nav-item-text">{t(item.labelKey)}</span>
                    </div>
                );
              })}
              </div>
            )}
          </div>

              {/* Admin section - only for admins */}
          {isAdmin && adminItems.length > 0 && (
            <div className="mt-4">
                  <button
                onClick={() => setAdminMenuCollapsed(!adminMenuCollapsed)}
                className="w-full flex items-center justify-between px-4 py-2 mb-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
              >
                <span className="text-xs font-semibold uppercase oneui-text-muted">
                  {t('sidebar.adminPanel')}
                    </span>
                {adminMenuCollapsed ? (
                  <ChevronRight className="w-4 h-4 oneui-text-muted" />
                    ) : (
                  <ChevronDown className="w-4 h-4 oneui-text-muted" />
                    )}
                  </button>
              {!adminMenuCollapsed && (
                <div className="space-y-1">
                  {adminItems.map((item) => {
                        const Icon = item.icon;
                        const isActive = activeSection === item.id;

                        return (
                      <div
                            key={item.id}
                            onClick={() => handleItemClick(item.id)}
                        className={`oneui-nav-item ${isActive ? 'active' : ''}`}
                          >
                        <Icon className="oneui-nav-item-icon" />
                        <span className="oneui-nav-item-text">{t(item.labelKey)}</span>
                      </div>
                        );
                      })}
                    </div>
                  )}
                </div>
              )}
            </nav>

        {/* Footer - fixed at bottom */}
        <div className="border-t p-4 flex-shrink-0" style={{ borderColor: 'rgba(255, 255, 255, 0.1)' }}>
          <div className="text-xs text-center" style={{ color: 'rgba(255, 255, 255, 0.5)' }}>
            <div className="font-semibold mb-1">SwiftDevBot</div>
            <div>v0.1.0</div>
          </div>
        </div>
      </aside>
    </>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/Header.tsx ------------------------------
import { useState, useRef, useEffect } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { useTheme } from '../contexts/ThemeContext';
import { useI18n } from '../contexts/I18nContext';
import { Bell, Search, Sun, Moon, User, LogOut, Menu, X, Globe, Settings } from 'lucide-react';

type HeaderProps = {
  onMenuToggle: () => void;
  isMobileMenuOpen: boolean;
};

export const Header = ({ onMenuToggle, isMobileMenuOpen }: HeaderProps) => {
  const { profile, signOut } = useAuth();
  const { theme, toggleTheme } = useTheme();
  const { locale, setLocale, availableLocales, t } = useI18n();
  const [showUserDropdown, setShowUserDropdown] = useState(false);
  const [showLangDropdown, setShowLangDropdown] = useState(false);
  const [langDropdownPosition, setLangDropdownPosition] = useState({ top: 0, right: 0 });
  const userButtonRef = useRef<HTMLDivElement>(null);
  const userDropdownRef = useRef<HTMLDivElement>(null);
  const langButtonRef = useRef<HTMLDivElement>(null);
  const langDropdownRef = useRef<HTMLDivElement>(null);

  // Calculate dropdown position for language selector
  useEffect(() => {
    if (showLangDropdown && langButtonRef.current) {
      const updatePosition = () => {
        if (langButtonRef.current) {
          const rect = langButtonRef.current.getBoundingClientRect();
          setLangDropdownPosition({
            top: rect.bottom + 8,
            right: window.innerWidth - rect.right,
          });
        }
      };
      
      updatePosition();
      window.addEventListener('resize', updatePosition);
      window.addEventListener('scroll', updatePosition, true);
      
      return () => {
        window.removeEventListener('resize', updatePosition);
        window.removeEventListener('scroll', updatePosition, true);
      };
    }
  }, [showLangDropdown]);

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (
        userDropdownRef.current &&
        !userDropdownRef.current.contains(event.target as Node) &&
        userButtonRef.current &&
        !userButtonRef.current.contains(event.target as Node)
      ) {
        setShowUserDropdown(false);
      }
      if (
        langDropdownRef.current &&
        !langDropdownRef.current.contains(event.target as Node) &&
        langButtonRef.current &&
        !langButtonRef.current.contains(event.target as Node)
      ) {
        setShowLangDropdown(false);
      }
    };

    if (showUserDropdown || showLangDropdown) {
      document.addEventListener('mousedown', handleClickOutside);
      return () => {
        document.removeEventListener('mousedown', handleClickOutside);
      };
    }
  }, [showUserDropdown, showLangDropdown]);

  const handleSignOut = async () => {
    await signOut();
    setShowUserDropdown(false);
  };

  const localeNames: Record<string, string> = {
    en: 'English',
    ru: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹',
    ua: 'Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°',
  };

  return (
    <header className="oneui-header" style={{ width: '100%', maxWidth: '100%' }}>
      <div className="oneui-header-left flex-1 min-w-0">
            <button
              onClick={onMenuToggle}
          className="oneui-btn-icon lg:hidden"
          aria-label="Toggle menu"
        >
          {isMobileMenuOpen ? <X className="w-5 h-5" /> : <Menu className="w-5 h-5" />}
        </button>

        <div className="min-w-0 flex-1">
          <h1 className="oneui-header-title truncate">{t('common.welcome')}</h1>
          <p className="oneui-header-subtitle hidden sm:block">{t('common.controlCenter')}</p>
        </div>
      </div>

      <div className="oneui-header-right flex-shrink-0">
        {/* Search */}
        <div className="hidden md:flex items-center relative">
          <Search className="absolute left-3 w-4 h-4 pointer-events-none" style={{ color: 'var(--oneui-text-muted)' }} />
          <input
            type="text"
            placeholder={t('common.search')}
            className="pl-10 pr-4 py-2 bg-transparent border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent w-48 lg:w-64"
            style={{
              backgroundColor: 'var(--oneui-bg-alt)',
              color: 'var(--oneui-text)',
              borderColor: 'var(--oneui-border)',
            }}
          />
        </div>

        {/* Language Selector */}
        <div className="oneui-dropdown" ref={langButtonRef}>
          <button
            onClick={() => setShowLangDropdown(!showLangDropdown)}
            className="oneui-btn-icon"
            title="Change language"
          >
            <Globe className="w-5 h-5" />
            </button>

          {showLangDropdown && (
            <>
              <div
                className="fixed inset-0 z-[90]"
                onClick={() => setShowLangDropdown(false)}
              />
              <div 
                ref={langDropdownRef} 
                className="oneui-dropdown-menu oneui-dropdown-menu-mobile" 
                style={{ 
                  position: 'fixed',
                  top: `${langDropdownPosition.top}px`,
                  right: `${Math.max(langDropdownPosition.right, 12)}px`,
                  left: 'auto',
                  zIndex: 10000,
                }}
              >
                {availableLocales.map((loc) => (
                  <div
                    key={loc}
                    onClick={() => {
                      setLocale(loc);
                      setShowLangDropdown(false);
                    }}
                    className={`oneui-dropdown-item ${locale === loc ? 'bg-indigo-50 dark:bg-indigo-900/20' : ''}`}
                  >
                    <span>{localeNames[loc]}</span>
                    {locale === loc && (
                      <span className="ml-auto text-indigo-600 dark:text-indigo-400">âœ“</span>
                    )}
              </div>
                ))}
              </div>
            </>
          )}
          </div>

        {/* Theme Toggle */}
            <button
              onClick={toggleTheme}
          className="oneui-btn-icon"
          title={t('header.switchTheme')}
            >
              {theme === 'dark' ? (
            <Sun className="w-5 h-5" />
              ) : (
            <Moon className="w-5 h-5" />
              )}
            </button>

        {/* Notifications */}
        <button className="oneui-btn-icon relative" title="Notifications">
          <Bell className="w-5 h-5" />
          <span className="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
        </button>

        {/* User Menu */}
        <div className="oneui-dropdown" ref={userButtonRef}>
              <button
            onClick={() => setShowUserDropdown(!showUserDropdown)}
            className="flex items-center gap-2 p-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
              >
            <div className="w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-sm font-semibold">
              {getInitials(profile)}
            </div>
            <div className="hidden sm:block text-left">
              <div className="text-xs sm:text-sm font-medium truncate max-w-[120px] lg:max-w-none" style={{ color: 'var(--oneui-text)' }}>
                {getFullName(profile)}
              </div>
              <div className="text-xs truncate max-w-[120px] lg:max-w-none" style={{ color: 'var(--oneui-text-muted)' }}>
                {profile?.role || 'user'}
                </div>
                </div>
              </button>

          {showUserDropdown && (
                <>
                  <div
                    className="fixed inset-0 z-[90]"
                onClick={() => setShowUserDropdown(false)}
                  />
              <div ref={userDropdownRef} className="oneui-dropdown-menu" style={{ right: 0, minWidth: '220px' }}>
                <div className="px-4 py-3 border-b" style={{ borderColor: 'var(--oneui-border)' }}>
                  <div className="text-sm font-medium" style={{ color: 'var(--oneui-text)' }}>
                    {profile?.username || 'User'}
                  </div>
                  <div className="text-xs mt-1" style={{ color: 'var(--oneui-text-muted)' }}>
                    {profile?.role || 'user'}
                  </div>
                </div>
                <div className="oneui-dropdown-item">
                  <User className="oneui-dropdown-item-icon" />
                  <span>{t('sidebar.settings')}</span>
                </div>
                <div className="oneui-dropdown-item" onClick={handleSignOut}>
                  <LogOut className="oneui-dropdown-item-icon" />
                  <span>{t('header.signOut')}</span>
                </div>
                  </div>
                </>
              )}
            </div>
          </div>
    </header>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/ui/GlassButton.tsx ------------------------------
import { ReactNode, ButtonHTMLAttributes } from 'react';

type GlassButtonProps = ButtonHTMLAttributes<HTMLButtonElement> & {
  children: ReactNode;
  variant?: 'primary' | 'secondary' | 'danger' | 'success';
  size?: 'sm' | 'md' | 'lg';
  fullWidth?: boolean;
};

export const GlassButton = ({
  children,
  variant = 'primary',
  size = 'md',
  fullWidth = false,
  className = '',
  ...props
}: GlassButtonProps) => {
  const sizeClasses = {
    sm: 'px-4 py-2 text-sm',
    md: 'px-5 py-2.5 text-base',
    lg: 'px-6 py-3 text-lg',
  };

  const widthClass = fullWidth ? 'w-full' : '';

  return (
    <button
      className={`
        glass-button
        glass-button-${variant}
        ${sizeClasses[size]}
        ${widthClass}
        ${className}
      `}
      {...props}
    >
      {children}
    </button>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/ui/GlassCard.tsx ------------------------------
import { ReactNode } from 'react';

type GlassCardProps = {
  children: ReactNode;
  className?: string;
  hover?: boolean;
  glow?: boolean;
  gradient?: 'primary' | 'accent' | 'success' | 'danger' | 'none';
};

export const GlassCard = ({ 
  children, 
  className = '', 
  hover = false, 
  glow = false,
  gradient = 'none'
}: GlassCardProps) => {
  const gradientClasses = {
    primary: 'before:bg-gradient-to-br before:from-cyan-500/10 before:to-blue-500/10',
    accent: 'before:bg-gradient-to-br before:from-purple-500/10 before:to-pink-500/10',
    success: 'before:bg-gradient-to-br before:from-green-500/10 before:to-emerald-500/10',
    danger: 'before:bg-gradient-to-br before:from-red-500/10 before:to-orange-500/10',
    none: '',
  };

  return (
    <div
      className={`
        glass-card
        ${hover ? 'glass-hover' : ''}
        ${glow ? 'glass-glow' : ''}
        ${gradientClasses[gradient]}
        ${className}
      `}
    >
      {children}
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/ui/GlassInput.tsx ------------------------------
import { InputHTMLAttributes, forwardRef } from 'react';

type GlassInputProps = InputHTMLAttributes<HTMLInputElement> & {
  label?: string;
  error?: string;
};

export const GlassInput = forwardRef<HTMLInputElement, GlassInputProps>(
  ({ label, error, className = '', ...props }, ref) => {
    return (
      <div className="w-full">
        {label && (
          <label className="block text-sm font-medium mb-2 text-glass-text">
            {label}
          </label>
        )}
        <input
          ref={ref}
          className={`
            glass-input
            ${error ? 'glass-input-error' : ''}
            ${className}
          `}
          {...props}
        />
        {error && (
          <p className="mt-1 text-sm text-red-400">{error}</p>
        )}
      </div>
    );
  }
);

GlassInput.displayName = 'GlassInput';



======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Settings.tsx ------------------------------
import { useState } from 'react';
import { useAuth } from '../../contexts/AuthContext';
import { useI18n } from '../../contexts/I18nContext';
import { User, Shield, Save, CheckCircle2 } from 'lucide-react';

export const Settings = () => {
  const { profile } = useAuth();
  const { t } = useI18n();
  const [formData, setFormData] = useState({
    username: profile?.username || '',
  });
  const [saved, setSaved] = useState(false);
  const [notifications, setNotifications] = useState(true);
  const [autoRefresh, setAutoRefresh] = useState(true);

  const handleSave = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaved(true);
    setTimeout(() => setSaved(false), 3000);
  };

  return (
      <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('sidebar.settings')}
        </h1>
        <p className="oneui-text-muted">Manage your account and preferences</p>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Profile Card */}
        <div className="oneui-card">
          <div className="text-center">
            <div className="w-24 h-24 mx-auto mb-4 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center">
            <User className="w-12 h-12 text-white" />
          </div>
            <h3 className="text-xl font-bold mb-1" style={{ color: 'var(--oneui-text)' }}>
              {profile?.username || 'User'}
            </h3>
            <p className="oneui-text-muted text-sm mb-4 capitalize">{profile?.role || 'user'}</p>
            <div className="inline-flex items-center gap-2 px-3 py-1.5 rounded-full oneui-badge-danger">
            <Shield className="w-4 h-4" />
              <span className="text-xs font-semibold">{profile?.role?.toUpperCase() || 'USER'}</span>
            </div>
          </div>
        </div>

        {/* Profile Information */}
        <div className="lg:col-span-2">
          <div className="oneui-card">
            <div className="oneui-card-header">
              <h3 className="oneui-card-title">Profile Information</h3>
            </div>
            <form onSubmit={handleSave} className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  Username
                </label>
                <input
                type="text"
                value={formData.username}
                onChange={(e) => setFormData({ ...formData, username: e.target.value })}
                  className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                placeholder="Enter your username"
              />
              </div>

              <div className="flex items-center gap-3 pt-2">
                <button type="submit" className="oneui-btn oneui-btn-primary flex items-center gap-2">
                  <Save className="w-4 h-4" />
                  Save Changes
                </button>
                {saved && (
                  <div className="flex items-center gap-2 text-green-600 dark:text-green-400">
                    <CheckCircle2 className="w-5 h-5" />
                    <span className="text-sm font-medium">Settings saved!</span>
                  </div>
                )}
              </div>
            </form>
          </div>
        </div>
      </div>

      {/* Preferences */}
      <div className="oneui-card mt-6">
        <div className="oneui-card-header">
          <h3 className="oneui-card-title">Preferences</h3>
        </div>
        <div className="space-y-4">
          {[
            {
              label: 'Email Notifications',
              description: 'Receive email updates about bot activity',
              checked: notifications,
              onChange: setNotifications,
            },
            {
              label: 'Auto-refresh Dashboard',
              description: 'Automatically update dashboard data',
              checked: autoRefresh,
              onChange: setAutoRefresh,
            },
          ].map((pref) => (
            <div
              key={pref.label}
              className="flex items-center justify-between p-4 rounded-lg"
              style={{ backgroundColor: 'var(--oneui-bg-alt)' }}
            >
              <div className="flex-1">
                <p className="font-medium mb-1" style={{ color: 'var(--oneui-text)' }}>
                  {pref.label}
                </p>
                <p className="text-sm oneui-text-muted">{pref.description}</p>
              </div>
              <label className="relative inline-flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  className="sr-only peer"
                  checked={pref.checked}
                  onChange={(e) => pref.onChange(e.target.checked)}
                />
                <div className="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all dark:after:border-gray-600 peer-checked:bg-indigo-600"></div>
              </label>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Modules.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, BotModule } from '../../api';
import { useAuth } from '../../contexts/AuthContext';
import { useI18n } from '../../contexts/I18nContext';
import { Box, CheckCircle2, XCircle, Loader2, MoreVertical } from 'lucide-react';

export const Modules = () => {
  const { isAdmin } = useAuth();
  const { t } = useI18n();
  const [modules, setModules] = useState<BotModule[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [busyModule, setBusyModule] = useState<string | null>(null);
  const [message, setMessage] = useState<string | null>(null);

  useEffect(() => {
    loadModules();
  }, []);

  const loadModules = async () => {
    try {
      // For admin panel, include system modules
      const data = await api.getModules(true);
      setModules(data || []);
    } catch (error) {
      console.error('Error loading modules:', error);
      setError(t('modules.errorToggle'));
      setModules([]);
    } finally {
      setLoading(false);
    }
  };

  const toggleModuleStatus = async (moduleName: string, currentStatus: string) => {
    if (!isAdmin) return;

    setBusyModule(moduleName);
    setError(null);
    setMessage(null);
    try {
      await api.toggleModuleStatus(moduleName, currentStatus !== 'active');
      setModules(prev => prev.map(m =>
        m.name === moduleName ? { ...m, status: currentStatus === 'active' ? 'inactive' : 'active' } : m
      ));
      setMessage(currentStatus === 'active' 
        ? t('modules.moduleDeactivated', { name: moduleName })
        : t('modules.moduleActivated', { name: moduleName })
      );
      setTimeout(() => setMessage(null), 5000);
    } catch (error) {
      console.error('Error toggling module status:', error);
      setError(t('modules.errorToggle'));
      setTimeout(() => setError(null), 5000);
    } finally {
      setBusyModule(null);
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="oneui-spinner"></div>
      </div>
    );
  }

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('modules.title')}
        </h1>
        <p className="oneui-text-muted">{t('modules.subtitle')}</p>
      </div>

      {/* Messages */}
      {error && (
        <div className="oneui-card mb-6 border-l-4" style={{ borderLeftColor: 'var(--oneui-danger)' }}>
          <div className="flex items-center gap-3 text-red-600 dark:text-red-400">
            <XCircle className="w-5 h-5" />
            <p className="font-medium">{error}</p>
          </div>
        </div>
      )}
      {message && (
        <div className="oneui-card mb-6 border-l-4" style={{ borderLeftColor: 'var(--oneui-success)' }}>
          <div className="flex items-center gap-3 text-green-600 dark:text-green-400">
            <CheckCircle2 className="w-5 h-5" />
            <p className="font-medium">{message}</p>
          </div>
        </div>
      )}

      {/* Modules Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {modules.map((module) => {
          const isActive = module.status === 'active';

          return (
            <div key={module.name} className="oneui-card hover:shadow-lg transition-shadow">
              <div className="flex items-start justify-between mb-4">
                <div className="flex items-center gap-3">
                  <div className={`w-12 h-12 rounded-lg flex items-center justify-center ${
                    isActive ? 'bg-indigo-100 dark:bg-indigo-900/20' : 'bg-gray-100 dark:bg-gray-800'
                  }`}>
                    <Box className={`w-6 h-6 ${isActive ? 'text-indigo-600 dark:text-indigo-400' : 'text-gray-400'}`} />
                  </div>
                  <div>
                    <h3 className="font-semibold text-lg" style={{ color: 'var(--oneui-text)' }}>
                      {module.name}
                    </h3>
                    <span className={`oneui-badge ${isActive ? 'oneui-badge-success' : 'oneui-badge-danger'}`}>
                      {isActive ? t('common.active') : t('common.inactive')}
                    </span>
                </div>
                </div>
                <button className="oneui-btn-icon">
                  <MoreVertical className="w-4 h-4" />
                </button>
              </div>

              <p className="text-sm oneui-text-muted mb-4 line-clamp-2">
                {module.description || 'No description available'}
              </p>

              {isAdmin && (
                <button
                  onClick={() => toggleModuleStatus(module.name, module.status)}
                  disabled={busyModule === module.name}
                  className={`oneui-btn w-full ${
                    isActive ? 'oneui-btn-secondary' : 'oneui-btn-primary'
                  }`}
                >
                  {busyModule === module.name ? (
                    <span className="flex items-center justify-center gap-2">
                      <Loader2 className="w-4 h-4 animate-spin" />
                      {t('common.loading')}
                    </span>
                  ) : (
                    <span className="flex items-center justify-center gap-2">
                      {isActive ? (
                        <>
                          <XCircle className="w-4 h-4" />
                          {t('modules.deactivate')}
                        </>
                      ) : (
                        <>
                          <CheckCircle2 className="w-4 h-4" />
                          {t('modules.activate')}
                        </>
              )}
                    </span>
                  )}
                </button>
              )}
            </div>
          );
        })}
      </div>

      {modules.length === 0 && (
        <div className="oneui-card text-center py-12">
          <Box className="w-16 h-16 mx-auto mb-4 oneui-text-muted opacity-50" />
          <h3 className="text-xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
            {t('modules.noModules')}
          </h3>
          <p className="oneui-text-muted">{t('modules.noModulesDesc')}</p>
        </div>
      )}
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Docs.tsx ------------------------------
import { useI18n } from '../../contexts/I18nContext';
import { BookOpen, Code, Rocket, Shield, Zap, ExternalLink } from 'lucide-react';

export const Docs = () => {
  const { t } = useI18n();
  const sections = [
    {
      icon: Rocket,
      title: 'Getting Started',
      description: 'Quick start guide to set up and configure your bot',
      color: 'oneui-stat-icon-primary',
      link: '#',
    },
    {
      icon: Code,
      title: 'API Reference',
      description: 'Complete documentation of available API endpoints',
      color: 'oneui-stat-icon-success',
      link: '#',
    },
    {
      icon: Zap,
      title: 'Module Development',
      description: 'Learn how to create custom modules for your bot',
      color: 'oneui-stat-icon-warning',
      link: '#',
    },
    {
      icon: Shield,
      title: 'Security Best Practices',
      description: 'Guidelines for keeping your bot secure',
      color: 'oneui-stat-icon-danger',
      link: '#',
    },
  ];

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          Documentation
        </h1>
        <p className="oneui-text-muted">Learn how to use and customize SwiftDevBot</p>
      </div>

      {/* Documentation Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        {sections.map((section) => {
          const Icon = section.icon;
          return (
            <div
              key={section.title}
              className="oneui-card hover:shadow-lg transition-all cursor-pointer group"
            >
              <div className="flex items-start gap-4">
                <div className={`${section.color} oneui-stat-icon flex-shrink-0`}>
                  <Icon className="w-6 h-6" />
                </div>
                <div className="flex-1">
                  <div className="flex items-center justify-between mb-2">
                    <h3 className="text-lg font-bold" style={{ color: 'var(--oneui-text)' }}>
                      {section.title}
                    </h3>
                    <ExternalLink className="w-4 h-4 oneui-text-muted group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors" />
                  </div>
                  <p className="oneui-text-muted text-sm">{section.description}</p>
                </div>
              </div>
            </div>
          );
        })}
      </div>

      {/* About Section */}
      <div className="oneui-card">
        <div className="flex items-start gap-4">
          <div className="oneui-stat-icon oneui-stat-icon-primary flex-shrink-0">
            <BookOpen className="w-6 h-6" />
          </div>
          <div className="flex-1">
            <h3 className="text-xl font-bold mb-4" style={{ color: 'var(--oneui-text)' }}>
              About SwiftDevBot
            </h3>
            <div className="space-y-4 oneui-text-muted">
              <p>
                SwiftDevBot is a powerful, modular Telegram bot designed for developers.
                It provides a comprehensive set of tools and features to streamline your
                development workflow.
              </p>
              <p>
                The bot is built with modern technologies and follows best practices for
                security, scalability, and maintainability. Each module can be independently
                activated or deactivated based on your needs.
              </p>
              <p>
                This dashboard provides full control over your bot's functionality,
                allowing you to monitor activity, manage users, and configure settings
                in real-time.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Config.tsx ------------------------------
import { useState } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { Sliders, Database, Key, Globe, Save, CheckCircle2 } from 'lucide-react';

export const Config = () => {
  const { t } = useI18n();
  const [config, setConfig] = useState({
    botToken: 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢',
    apiUrl: 'https://api.telegram.org',
    webhookUrl: 'https://your-domain.com/webhook',
    maxRetries: '3',
    timeout: '30',
  });

  const [saved, setSaved] = useState(false);

  const handleSave = (e: React.FormEvent) => {
    e.preventDefault();
    setSaved(true);
    setTimeout(() => setSaved(false), 3000);
  };

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          Core Configuration
        </h1>
        <p className="oneui-text-muted">Manage bot's core settings and parameters</p>
      </div>

      {/* Status Cards */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
        {[
          { icon: Database, label: 'Database', value: 'Connected', color: 'oneui-text-success' },
          { icon: Key, label: 'API Status', value: 'Active', color: 'oneui-text-primary' },
          { icon: Globe, label: 'Webhook', value: 'Running', color: 'oneui-text-primary' },
        ].map((status) => {
          const Icon = status.icon;
          return (
            <div key={status.label} className="oneui-card">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm oneui-text-muted mb-1">{status.label}</p>
                  <p className={`text-xl font-bold ${status.color}`}>{status.value}</p>
                </div>
                <div className={`oneui-stat-icon ${status.color.includes('success') ? 'oneui-stat-icon-success' : 'oneui-stat-icon-primary'}`}>
                  <Icon className="w-6 h-6" />
                </div>
              </div>
            </div>
          );
        })}
      </div>

      {/* Configuration Form */}
      <form onSubmit={handleSave} className="space-y-6">
        {/* Authentication */}
        <div className="oneui-card">
          <div className="oneui-card-header">
            <div className="flex items-center gap-3">
              <div className="oneui-stat-icon oneui-stat-icon-primary">
                <Key className="w-5 h-5" />
              </div>
              <h3 className="oneui-card-title">Authentication</h3>
            </div>
          </div>
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                Bot Token
              </label>
              <input
                type="password"
                value={config.botToken}
                onChange={(e) => setConfig({ ...config, botToken: e.target.value })}
                className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                style={{
                  backgroundColor: 'var(--oneui-bg-alt)',
                  borderColor: 'var(--oneui-border)',
                  color: 'var(--oneui-text)',
                }}
              />
            </div>
          </div>
        </div>

        {/* API Configuration */}
        <div className="oneui-card">
          <div className="oneui-card-header">
            <div className="flex items-center gap-3">
              <div className="oneui-stat-icon oneui-stat-icon-primary">
                <Globe className="w-5 h-5" />
              </div>
              <h3 className="oneui-card-title">API Configuration</h3>
            </div>
          </div>
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                API URL
              </label>
              <input
                type="text"
                value={config.apiUrl}
                onChange={(e) => setConfig({ ...config, apiUrl: e.target.value })}
                className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                style={{
                  backgroundColor: 'var(--oneui-bg-alt)',
                  borderColor: 'var(--oneui-border)',
                  color: 'var(--oneui-text)',
                }}
              />
            </div>
            <div>
              <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                Webhook URL
              </label>
              <input
                type="text"
                value={config.webhookUrl}
                onChange={(e) => setConfig({ ...config, webhookUrl: e.target.value })}
                className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                style={{
                  backgroundColor: 'var(--oneui-bg-alt)',
                  borderColor: 'var(--oneui-border)',
                  color: 'var(--oneui-text)',
                }}
              />
            </div>
          </div>
        </div>

        {/* Performance */}
        <div className="oneui-card">
          <div className="oneui-card-header">
            <div className="flex items-center gap-3">
              <div className="oneui-stat-icon oneui-stat-icon-warning">
                <Sliders className="w-5 h-5" />
              </div>
              <h3 className="oneui-card-title">Performance</h3>
            </div>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                Max Retries
              </label>
              <input
                type="number"
                value={config.maxRetries}
                onChange={(e) => setConfig({ ...config, maxRetries: e.target.value })}
                className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                style={{
                  backgroundColor: 'var(--oneui-bg-alt)',
                  borderColor: 'var(--oneui-border)',
                  color: 'var(--oneui-text)',
                }}
              />
            </div>
            <div>
              <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                Timeout (seconds)
              </label>
              <input
                type="number"
                value={config.timeout}
                onChange={(e) => setConfig({ ...config, timeout: e.target.value })}
                className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                style={{
                  backgroundColor: 'var(--oneui-bg-alt)',
                  borderColor: 'var(--oneui-border)',
                  color: 'var(--oneui-text)',
                }}
              />
            </div>
          </div>
        </div>

        {/* Save Button */}
        <div className="flex items-center gap-3">
          <button type="submit" className="oneui-btn oneui-btn-primary flex items-center gap-2">
            <Save className="w-4 h-4" />
            Save Configuration
          </button>
          {saved && (
            <div className="flex items-center gap-2 text-green-600 dark:text-green-400">
              <CheckCircle2 className="w-5 h-5" />
              <span className="text-sm font-medium">Configuration saved!</span>
            </div>
          )}
        </div>
      </form>
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Monitoring.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, LiveMetricsData } from '../../api';
import { Activity, Cpu, HardDrive, Wifi } from 'lucide-react';

export const Monitoring = () => {
  const [metrics, setMetrics] = useState([
    { label: 'CPU Usage', value: 0, icon: Cpu, color: 'oneui-stat-icon-primary' },
    { label: 'Memory', value: 0, icon: Activity, color: 'oneui-stat-icon-success' },
    { label: 'Disk', value: 0, icon: HardDrive, color: 'oneui-stat-icon-warning' },
    { label: 'Redis', value: 0, icon: Wifi, color: 'oneui-stat-icon-danger' },
  ]);
  const [liveMetrics, setLiveMetrics] = useState<LiveMetricsData | null>(null);
  const [requestHistory, setRequestHistory] = useState<number[]>([]);
  const [responseTimes, setResponseTimes] = useState<{endpoint: string, time: number}[]>([]);

  useEffect(() => {
    const loadMetrics = async () => {
      try {
        const sysMetrics = await api.getSystemMetrics();
        setMetrics([
          { label: 'CPU Usage', value: Math.round(sysMetrics.cpu || 0), icon: Cpu, color: 'oneui-stat-icon-primary' },
          { label: 'Memory', value: Math.round(sysMetrics.ram || 0), icon: Activity, color: 'oneui-stat-icon-success' },
          { label: 'Disk', value: Math.round(sysMetrics.disk || 0), icon: HardDrive, color: 'oneui-stat-icon-warning' },
          { label: 'Redis', value: Math.round(sysMetrics.redis || 0), icon: Wifi, color: 'oneui-stat-icon-danger' },
        ]);

        // Load live metrics for RPS and response times
        const live = await api.getLiveMetrics();
        setLiveMetrics(live);

        // Update request history (simulate RPS over time)
        if (live.rps > 0) {
          setRequestHistory(prev => {
            const updated = [...prev, live.rps];
            return updated.slice(-50); // Keep last 50 points
          });
        } else {
          // If no RPS, show empty or minimal activity
          setRequestHistory(prev => {
            const updated = [...prev, 0];
            return updated.slice(-50);
          });
        }

        // Update response times (use live response time as average)
        if (live.responseTime > 0) {
          setResponseTimes([
            { endpoint: '/api/messages', time: Math.round(live.responseTime * 0.8) },
            { endpoint: '/api/users', time: Math.round(live.responseTime * 1.2) },
            { endpoint: '/api/modules', time: Math.round(live.responseTime * 0.7) },
            { endpoint: '/api/stats', time: Math.round(live.responseTime * 1.5) },
          ]);
        }
      } catch (error) {
        console.error('Error loading metrics:', error);
      }
    };

    loadMetrics();
    const interval = setInterval(loadMetrics, 5000);
    return () => clearInterval(interval);
  }, []);

  // Generate request rate chart data (use real RPS or fallback to empty)
  const requests = requestHistory.length > 0 
    ? requestHistory.map(rps => Math.min(rps * 2, 100)) // Scale RPS to 0-100 for visualization
    : Array.from({ length: 50 }, () => 0);

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          System Monitoring
        </h1>
        <p className="oneui-text-muted">Real-time performance metrics and health status</p>
      </div>

      {/* Metrics Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        {metrics.map((metric) => {
          const Icon = metric.icon;
          return (
            <div key={metric.label} className="oneui-card">
              <div className="flex items-start justify-between mb-4">
                <div className={`oneui-stat-icon ${metric.color}`}>
                  <Icon className="w-6 h-6" />
                </div>
                <span className="text-2xl font-bold" style={{ color: 'var(--oneui-text)' }}>
                  {metric.value}%
                </span>
              </div>
              <p className="text-sm oneui-text-muted mb-3">{metric.label}</p>
              <div className="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                <div
                  className="h-full rounded-full transition-all duration-500"
                  style={{
                    width: `${metric.value}%`,
                    backgroundColor: metric.color.includes('primary') ? 'var(--oneui-primary)' :
                                    metric.color.includes('success') ? 'var(--oneui-success)' :
                                    metric.color.includes('warning') ? 'var(--oneui-warning)' :
                                    'var(--oneui-danger)',
                  }}
                />
              </div>
            </div>
          );
        })}
      </div>

      {/* Charts */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Request Rate */}
        <div className="oneui-card">
          <div className="oneui-card-header">
            <h3 className="oneui-card-title">Request Rate</h3>
          </div>
          <div className="h-48 flex items-end gap-1">
            {requests.length > 0 && requests.some(r => r > 0) ? (
              requests.map((height, i) => (
                <div
                  key={i}
                  className="flex-1 bg-gradient-to-t from-indigo-500 to-purple-600 rounded-t transition-all hover:opacity-80"
                  style={{ height: `${Math.max(height, 1)}%`, minHeight: '2px' }}
                  title={`RPS: ${requestHistory[i]?.toFixed(1) || 0}`}
                />
              ))
            ) : (
              <div className="w-full h-full flex items-center justify-center oneui-text-muted text-sm">
                {liveMetrics ? `RPS: ${liveMetrics.rps.toFixed(1)}` : 'No request data available'}
              </div>
            )}
          </div>
          {liveMetrics && (
            <div className="flex justify-between mt-4 text-xs oneui-text-muted">
              <span>RPS: {liveMetrics.rps.toFixed(1)}</span>
              <span>Last 50 samples</span>
            </div>
          )}
          {!liveMetrics && (
            <div className="flex justify-between mt-4 text-xs oneui-text-muted">
              <span>0s</span>
              <span>25s</span>
              <span>50s</span>
            </div>
          )}
        </div>

        {/* Response Times */}
        <div className="oneui-card">
          <div className="oneui-card-header">
            <h3 className="oneui-card-title">Response Times</h3>
          </div>
          <div className="space-y-4">
            {(responseTimes.length > 0 ? responseTimes : [
              { endpoint: '/api/messages', time: 0 },
              { endpoint: '/api/users', time: 0 },
              { endpoint: '/api/modules', time: 0 },
              { endpoint: '/api/stats', time: 0 },
            ]).map((endpoint) => {
              const getColor = (time: number) => {
                if (time === 0) return 'bg-gray-400';
                if (time < 50) return 'bg-green-500';
                if (time < 100) return 'bg-yellow-500';
                return 'bg-orange-500';
              };
              return (
              <div key={endpoint.endpoint}>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-mono" style={{ color: 'var(--oneui-text)' }}>
                    {endpoint.endpoint}
                  </span>
                  <span className="text-sm font-semibold" style={{ color: 'var(--oneui-text)' }}>
                    {endpoint.time > 0 ? `${endpoint.time}ms` : 'N/A'}
                  </span>
                </div>
                <div className="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                  <div
                    className={`h-full ${getColor(endpoint.time)} rounded-full transition-all duration-500`}
                    style={{ width: `${Math.min(endpoint.time, 100)}%` }}
                  />
                </div>
              </div>
            );
            })}
          </div>
        </div>
      </div>
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Notifications.tsx ------------------------------
import { useState } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { Bell, Mail, Smartphone, Clock } from 'lucide-react';

export const Notifications = () => {
  const { t } = useI18n();
  const [channels, setChannels] = useState({
    telegram: true,
    email: false,
    push: true,
  });

  const [notificationTypes, setNotificationTypes] = useState({
    news: true,
    security: true,
    tasks: true,
    marketing: false,
  });

  const [doNotDisturb, setDoNotDisturb] = useState(false);
  const [schedule, setSchedule] = useState({ from: '22:00', to: '08:00' });

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('notifications.title')}
        </h1>
        <p className="oneui-text-muted">{t('notifications.subtitle')}</p>
      </div>

      {/* Delivery Channels */}
      <div className="oneui-card mb-6">
        <div className="oneui-card-header">
          <h3 className="oneui-card-title">{t('notifications.channels')}</h3>
        </div>
        <div className="space-y-4">
          {[
            { key: 'telegram', label: t('notifications.telegram'), icon: Bell },
            { key: 'email', label: t('notifications.email'), icon: Mail },
            { key: 'push', label: t('notifications.push'), icon: Smartphone },
          ].map((channel) => {
            const Icon = channel.icon;
            return (
              <div
                key={channel.key}
                className="flex items-center justify-between p-4 rounded-lg"
                style={{ backgroundColor: 'var(--oneui-bg-alt)' }}
              >
                <div className="flex items-center gap-3">
                  <Icon className="w-5 h-5" style={{ color: 'var(--oneui-text-muted)' }} />
                  <span className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                    {channel.label}
                  </span>
                </div>
                <label className="relative inline-flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    className="sr-only peer"
                    checked={channels[channel.key as keyof typeof channels]}
                    onChange={(e) =>
                      setChannels({ ...channels, [channel.key]: e.target.checked })
                    }
                  />
                  <div className="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all dark:after:border-gray-600 peer-checked:bg-indigo-600"></div>
                </label>
              </div>
            );
          })}
        </div>
      </div>

      {/* Notification Types */}
      <div className="oneui-card mb-6">
        <div className="oneui-card-header">
          <h3 className="oneui-card-title">{t('notifications.types')}</h3>
        </div>
        <div className="space-y-4">
          {[
            { key: 'news', label: t('notifications.news') },
            { key: 'security', label: t('notifications.security') },
            { key: 'tasks', label: t('notifications.tasks') },
            { key: 'marketing', label: t('notifications.marketing') },
          ].map((type) => (
            <div
              key={type.key}
              className="flex items-center justify-between p-4 rounded-lg"
              style={{ backgroundColor: 'var(--oneui-bg-alt)' }}
            >
              <span className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                {type.label}
              </span>
              <label className="relative inline-flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  className="sr-only peer"
                  checked={notificationTypes[type.key as keyof typeof notificationTypes]}
                  onChange={(e) =>
                    setNotificationTypes({
                      ...notificationTypes,
                      [type.key]: e.target.checked,
                    })
                  }
                />
                <div className="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all dark:after:border-gray-600 peer-checked:bg-indigo-600"></div>
              </label>
            </div>
          ))}
        </div>
      </div>

      {/* Do Not Disturb */}
      <div className="oneui-card">
        <div className="oneui-card-header">
          <div className="flex items-center gap-3">
            <Clock className="w-5 h-5" style={{ color: 'var(--oneui-text-muted)' }} />
            <h3 className="oneui-card-title">{t('notifications.doNotDisturb')}</h3>
          </div>
        </div>
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <span className="font-medium" style={{ color: 'var(--oneui-text)' }}>
              {t('notifications.doNotDisturb')}
            </span>
            <label className="relative inline-flex items-center cursor-pointer">
              <input
                type="checkbox"
                className="sr-only peer"
                checked={doNotDisturb}
                onChange={(e) => setDoNotDisturb(e.target.checked)}
              />
              <div className="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all dark:after:border-gray-600 peer-checked:bg-indigo-600"></div>
            </label>
          </div>
          {doNotDisturb && (
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('notifications.schedule')} (Ğ¾Ñ‚)
                </label>
                <input
                  type="time"
                  value={schedule.from}
                  onChange={(e) => setSchedule({ ...schedule, from: e.target.value })}
                  className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('notifications.schedule')} (Ğ´Ğ¾)
                </label>
                <input
                  type="time"
                  value={schedule.to}
                  onChange={(e) => setSchedule({ ...schedule, to: e.target.value })}
                  className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                />
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/UserDashboard.tsx ------------------------------
import { useEffect, useState } from 'react';
import { useAuth } from '../../contexts/AuthContext';
import { useI18n } from '../../contexts/I18nContext';
import { useNavigation } from '../../contexts/NavigationContext';
import { api, BotStats } from '../../api';
import { User, Shield, Zap, TrendingUp, Activity, AlertCircle, MessageSquare, Folder, Key } from 'lucide-react';

export const UserDashboard = () => {
  const { profile } = useAuth();
  const { t } = useI18n();
  const { navigateTo } = useNavigation();
  const [stats, setStats] = useState<BotStats | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadStats();
  }, []);

  const loadStats = async () => {
    try {
      const botStats: BotStats = await api.getStats();
      setStats(botStats);
      
      // Also load modules count (only user plugins)
      try {
        const modules = await api.getModules(false);
        const activeModules = modules.filter(m => m.status === 'active' && !m.is_system_module).length;
        // Update stats with actual active user modules count
        if (stats) {
          setStats({ ...botStats, active_modules: activeModules });
        }
      } catch (err) {
        console.error('Error loading modules for stats:', err);
      }
    } catch (error) {
      console.error('Error loading stats:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="oneui-spinner"></div>
      </div>
    );
  }

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('userDashboard.welcome', { name: profile?.username || 'User' })}
        </h1>
        <p className="oneui-text-muted">{t('userDashboard.subtitle')}</p>
      </div>

      {/* Account Status Widget */}
      <div className="oneui-card mb-6">
        <div className="flex items-center gap-4">
          <div className="w-16 h-16 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xl font-semibold flex-shrink-0">
            {profile?.username?.[0]?.toUpperCase() || 'U'}
          </div>
          <div className="flex-1">
            <h3 className="text-lg font-bold mb-1" style={{ color: 'var(--oneui-text)' }}>
              {profile?.username || 'User'}
            </h3>
            <div className="flex items-center gap-3 flex-wrap">
              <span className={`oneui-badge ${profile?.role === 'admin' ? 'oneui-badge-danger' : 'oneui-badge-info'}`}>
                {profile?.role?.toUpperCase() || 'USER'}
              </span>
              <span className="oneui-badge oneui-badge-success">
                {t('userDashboard.accountActive')}
              </span>
            </div>
          </div>
        </div>
      </div>

      {/* Quick Actions */}
      <div className="mb-6">
        <h2 className="text-lg font-semibold mb-4" style={{ color: 'var(--oneui-text)' }}>
          {t('userDashboard.quickActions')}
        </h2>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          {[
            { icon: MessageSquare, label: t('userDashboard.newChat'), color: 'oneui-stat-icon-primary', action: 'chat' },
            { icon: Folder, label: t('userDashboard.myFiles'), color: 'oneui-stat-icon-success', action: 'files' },
            { icon: Key, label: t('userDashboard.apiKeys'), color: 'oneui-stat-icon-warning', action: 'developer' },
            { icon: Shield, label: t('userDashboard.security'), color: 'oneui-stat-icon-danger', action: 'security' },
          ].map((action) => {
            const Icon = action.icon;
            return (
              <button
                key={action.action}
                className="oneui-card hover:shadow-lg transition-all text-left"
                onClick={() => navigateTo(action.action)}
              >
                <div className={`oneui-stat-icon ${action.color} mb-3`}>
                  <Icon className="w-6 h-6" />
                </div>
                <p className="text-sm font-medium" style={{ color: 'var(--oneui-text)' }}>
                  {action.label}
                </p>
              </button>
            );
          })}
        </div>
      </div>

      {/* Stats Grid */}
      <div className="oneui-stats-grid mb-6">
        {[
          {
            labelKey: 'userDashboard.activeModules',
            value: stats?.active_modules || 0,
            icon: Zap,
            iconClass: 'oneui-stat-icon-primary',
            change: '+2',
            changePositive: true,
          },
          {
            labelKey: 'userDashboard.totalCommands',
            value: stats?.messages_today || 0,
            icon: Activity,
            iconClass: 'oneui-stat-icon-success',
            change: '+15%',
            changePositive: true,
          },
          {
            labelKey: 'userDashboard.storageUsed',
            value: '45%',
            icon: Folder,
            iconClass: 'oneui-stat-icon-warning',
            change: '2.3 GB',
            changePositive: false,
          },
        ].map((stat) => {
          const Icon = stat.icon;
          return (
            <div key={stat.labelKey} className="oneui-stat-card">
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <div className="oneui-stat-label">{t(stat.labelKey)}</div>
                  <div className="oneui-stat-value">{stat.value}</div>
                </div>
                <div className={`oneui-stat-icon ${stat.iconClass}`}>
                  <Icon className="w-6 h-6" />
                </div>
              </div>
            </div>
          );
        })}
      </div>

      {/* Recent Activity & Announcements */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Recent Activity */}
        <div className="oneui-card">
          <div className="oneui-card-header">
            <h3 className="oneui-card-title">{t('userDashboard.recentActivity')}</h3>
          </div>
          <div className="space-y-3">
            {[
              { action: t('userDashboard.activity.command'), details: '/start', time: '2 min ago', icon: MessageSquare },
              { action: t('userDashboard.activity.fileUpload'), details: 'document.pdf', time: '15 min ago', icon: Folder },
              { action: t('userDashboard.activity.settings'), details: t('userDashboard.activity.settingsChanged'), time: '1 hour ago', icon: Shield },
            ].map((activity, index) => {
              const Icon = activity.icon;
              return (
                <div
                  key={index}
                  className="flex items-center gap-3 p-3 rounded-lg"
                  style={{ backgroundColor: 'var(--oneui-bg-alt)' }}
                >
                  <div className="oneui-stat-icon oneui-stat-icon-primary">
                    <Icon className="w-4 h-4" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-sm font-medium truncate" style={{ color: 'var(--oneui-text)' }}>
                      {activity.action}
                    </p>
                    <p className="text-xs oneui-text-muted truncate">{activity.details}</p>
                  </div>
                  <span className="text-xs oneui-text-muted whitespace-nowrap">{activity.time}</span>
                </div>
              );
            })}
          </div>
        </div>

        {/* System Announcements */}
        <div className="oneui-card">
          <div className="oneui-card-header">
            <h3 className="oneui-card-title">{t('userDashboard.announcements')}</h3>
          </div>
          <div className="space-y-3">
            <div className="p-4 rounded-lg border-l-4" style={{
              backgroundColor: 'rgba(99, 102, 241, 0.1)',
              borderLeftColor: 'var(--oneui-primary)',
            }}>
              <div className="flex items-start gap-3">
                <AlertCircle className="w-5 h-5 text-indigo-500 flex-shrink-0 mt-0.5" />
                <div>
                  <p className="text-sm font-medium mb-1" style={{ color: 'var(--oneui-text)' }}>
                    {t('userDashboard.announcement.newFeatures')}
                  </p>
                  <p className="text-xs oneui-text-muted">
                    {t('userDashboard.announcement.newFeaturesDesc')}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Statistics.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, BotStats } from '../../api';
import { useI18n } from '../../contexts/I18nContext';
import { MessageSquare, Users, Zap, Box, TrendingUp, Activity, BarChart3 } from 'lucide-react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LineChart, Line, AreaChart, Area } from 'recharts';

type StatData = {
  name: string;
  value: number;
  change: number;
  icon: typeof MessageSquare;
  color: string;
};

export const Statistics = () => {
  const { t } = useI18n();
  const [stats, setStats] = useState<StatData[]>([]);
  const [loading, setLoading] = useState(true);
  const [activityData, setActivityData] = useState<Array<{ hour: string; value: number }>>([]);

  useEffect(() => {
    loadStatistics();
    generateActivityData();
    const interval = setInterval(() => {
      loadStatistics();
      generateActivityData();
    }, 30000);
    return () => clearInterval(interval);
  }, []);

  const loadStatistics = async () => {
    try {
      const botStats: BotStats = await api.getStats();
      
      const statsData: StatData[] = [
        {
          name: t('statistics.messagesToday') || 'Messages Today',
          value: botStats.messages_today || 0,
          change: 5.2,
          icon: MessageSquare,
          color: 'oneui-stat-icon-primary',
        },
        {
          name: t('statistics.totalUsers') || 'Total Users',
          value: botStats.total_users || 0,
          change: 3.8,
          icon: Users,
          color: 'oneui-stat-icon-success',
        },
        {
          name: t('statistics.activeModules') || 'Active Modules',
          value: botStats.active_modules || 0,
          change: 2.5,
          icon: Zap,
          color: 'oneui-stat-icon-warning',
        },
        {
          name: t('statistics.totalModules') || 'Total Modules',
          value: botStats.total_modules || 0,
          change: 0,
          icon: Box,
          color: 'oneui-stat-icon-info',
        },
      ];
      
      setStats(statsData);
    } catch (error) {
      console.error('Error loading statistics:', error);
    } finally {
      setLoading(false);
    }
  };

  const generateActivityData = () => {
    // Generate 24-hour activity data
    const data = Array.from({ length: 24 }, (_, i) => ({
      hour: `${i.toString().padStart(2, '0')}:00`,
      value: Math.floor(Math.random() * 100),
    }));
    setActivityData(data);
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="oneui-spinner"></div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('statistics.title') || 'Statistics'}
        </h1>
        <p className="oneui-text-muted">
          {t('statistics.subtitle') || 'Real-time analytics and metrics'}
        </p>
      </div>

      {/* Stats Cards */}
      <div className="oneui-stats-grid mb-6">
        {stats.map((stat) => {
          const Icon = stat.icon;
          const isPositive = stat.change >= 0;
          return (
            <div key={stat.name} className="oneui-stat-card">
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <div className="oneui-stat-label">{stat.name}</div>
                  <div className="oneui-stat-value">{stat.value.toLocaleString()}</div>
                  {stat.change !== 0 && (
                    <div className="flex items-center gap-1 mt-2 text-sm" style={{ color: isPositive ? 'var(--oneui-success)' : 'var(--oneui-danger)' }}>
                      <TrendingUp className="w-4 h-4" />
                      <span>{isPositive ? '+' : ''}{stat.change.toFixed(1)}%</span>
                      <span className="text-xs oneui-text-muted ml-1">
                        {t('statistics.vsPrevious') || 'vs previous'}
                      </span>
                    </div>
                  )}
                </div>
                <div className={stat.color}>
                  <Icon className="w-6 h-6" />
                </div>
              </div>
            </div>
          );
        })}
      </div>

      {/* Activity Chart */}
      <div className="oneui-card">
        <div className="oneui-card-header">
          <div className="flex items-center gap-3">
            <BarChart3 className="w-5 h-5" style={{ color: 'var(--oneui-primary)' }} />
            <h3 className="oneui-card-title">
              {t('statistics.activityChart') || 'Activity Chart'}
            </h3>
          </div>
        </div>
        <div className="p-4">
          <ResponsiveContainer width="100%" height={300}>
            <AreaChart data={activityData}>
              <defs>
                <linearGradient id="colorActivity" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="5%" stopColor="var(--oneui-primary)" stopOpacity={0.8}/>
                  <stop offset="95%" stopColor="var(--oneui-primary)" stopOpacity={0.1}/>
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke="var(--oneui-border)" />
              <XAxis 
                dataKey="hour" 
                stroke="var(--oneui-text-muted)"
                style={{ fontSize: '12px' }}
                tick={{ fill: 'var(--oneui-text-muted)' }}
              />
              <YAxis 
                stroke="var(--oneui-text-muted)"
                style={{ fontSize: '12px' }}
                tick={{ fill: 'var(--oneui-text-muted)' }}
              />
              <Tooltip
                contentStyle={{
                  backgroundColor: 'var(--oneui-bg)',
                  border: '1px solid var(--oneui-border)',
                  color: 'var(--oneui-text)',
                  borderRadius: '8px',
                }}
                labelStyle={{ color: 'var(--oneui-text)' }}
              />
              <Area
                type="monotone"
                dataKey="value"
                stroke="var(--oneui-primary)"
                strokeWidth={2}
                fill="url(#colorActivity)"
              />
            </AreaChart>
          </ResponsiveContainer>
        </div>
      </div>

      {/* Additional Charts Grid */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Bar Chart */}
        <div className="oneui-card">
          <div className="oneui-card-header">
            <div className="flex items-center gap-3">
              <Activity className="w-5 h-5" style={{ color: 'var(--oneui-primary)' }} />
              <h3 className="oneui-card-title">
                {t('statistics.hourlyActivity') || 'Hourly Activity'}
              </h3>
            </div>
          </div>
          <div className="p-4">
            <ResponsiveContainer width="100%" height={250}>
              <BarChart data={activityData}>
                <CartesianGrid strokeDasharray="3 3" stroke="var(--oneui-border)" />
                <XAxis 
                  dataKey="hour" 
                  stroke="var(--oneui-text-muted)"
                  style={{ fontSize: '11px' }}
                  tick={{ fill: 'var(--oneui-text-muted)' }}
                />
                <YAxis 
                  stroke="var(--oneui-text-muted)"
                  style={{ fontSize: '11px' }}
                  tick={{ fill: 'var(--oneui-text-muted)' }}
                />
                <Tooltip
                  contentStyle={{
                    backgroundColor: 'var(--oneui-bg)',
                    border: '1px solid var(--oneui-border)',
                    color: 'var(--oneui-text)',
                    borderRadius: '8px',
                  }}
                  labelStyle={{ color: 'var(--oneui-text)' }}
                />
                <Bar 
                  dataKey="value" 
                  fill="var(--oneui-primary)"
                  radius={[4, 4, 0, 0]}
                />
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>

        {/* Line Chart */}
        <div className="oneui-card">
          <div className="oneui-card-header">
            <div className="flex items-center gap-3">
              <TrendingUp className="w-5 h-5" style={{ color: 'var(--oneui-success)' }} />
              <h3 className="oneui-card-title">
                {t('statistics.trends') || 'Trends'}
              </h3>
            </div>
          </div>
          <div className="p-4">
            <ResponsiveContainer width="100%" height={250}>
              <LineChart data={activityData}>
                <CartesianGrid strokeDasharray="3 3" stroke="var(--oneui-border)" />
                <XAxis 
                  dataKey="hour" 
                  stroke="var(--oneui-text-muted)"
                  style={{ fontSize: '11px' }}
                  tick={{ fill: 'var(--oneui-text-muted)' }}
                />
                <YAxis 
                  stroke="var(--oneui-text-muted)"
                  style={{ fontSize: '11px' }}
                  tick={{ fill: 'var(--oneui-text-muted)' }}
                />
                <Tooltip
                  contentStyle={{
                    backgroundColor: 'var(--oneui-bg)',
                    border: '1px solid var(--oneui-border)',
                    color: 'var(--oneui-text)',
                    borderRadius: '8px',
                  }}
                  labelStyle={{ color: 'var(--oneui-text)' }}
                />
                <Line
                  type="monotone"
                  dataKey="value"
                  stroke="var(--oneui-success)"
                  strokeWidth={2}
                  dot={{ fill: 'var(--oneui-success)', r: 4 }}
                  activeDot={{ r: 6 }}
                />
              </LineChart>
            </ResponsiveContainer>
          </div>
        </div>
      </div>
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Data.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { api, CommandHistoryItem, FileItem } from '../../api';
import { Database, FileText, Download, Trash2, AlertTriangle, History } from 'lucide-react';

export const Data = () => {
  const { t } = useI18n();
  const [activeTab, setActiveTab] = useState<'history' | 'files' | 'export'>('history');
  const [commandHistory, setCommandHistory] = useState<CommandHistoryItem[]>([]);
  const [files, setFiles] = useState<FileItem[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (activeTab === 'history') {
      loadCommandHistory();
    } else if (activeTab === 'files') {
      loadFiles();
    } else {
      setLoading(false);
    }
  }, [activeTab]);

  const loadCommandHistory = async () => {
    try {
      setLoading(true);
      const data = await api.getCommandHistory(50);
      setCommandHistory(data);
    } catch (error) {
      console.error('Error loading command history:', error);
    } finally {
      setLoading(false);
    }
  };

  const loadFiles = async () => {
    try {
      setLoading(true);
      const data = await api.getFiles();
      setFiles(data);
    } catch (error) {
      console.error('Error loading files:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('data.title')}
        </h1>
        <p className="oneui-text-muted">{t('data.subtitle')}</p>
      </div>

      {/* Tabs */}
      <div className="flex gap-2 mb-6 border-b" style={{ borderColor: 'var(--oneui-border)' }}>
        {[
          { id: 'history', label: t('data.commandHistory'), icon: History },
          { id: 'files', label: t('data.uploadedFiles'), icon: FileText },
          { id: 'export', label: t('data.exportData'), icon: Download },
        ].map((tab) => {
          const Icon = tab.icon;
          return (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id as any)}
              className={`px-4 py-2 flex items-center gap-2 border-b-2 transition-colors ${
                activeTab === tab.id
                  ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400'
                  : 'border-transparent oneui-text-muted hover:text-indigo-600 dark:hover:text-indigo-400'
              }`}
            >
              <Icon className="w-4 h-4" />
              <span className="font-medium">{tab.label}</span>
            </button>
          );
        })}
      </div>

      {/* Command History */}
      {activeTab === 'history' && (
        <div className="oneui-card">
          {loading ? (
            <div className="flex items-center justify-center py-8">
              <div className="oneui-spinner"></div>
            </div>
          ) : commandHistory.length === 0 ? (
            <div className="text-center py-8 text-sm oneui-text-muted">
              {t('data.noCommandHistory')}
            </div>
          ) : (
            <div className="overflow-x-auto">
              <table className="oneui-table min-w-full">
                <thead>
                  <tr>
                    <th>{t('data.command')}</th>
                    <th>{t('data.date')}</th>
                    <th>{t('data.status')}</th>
                  </tr>
                </thead>
                <tbody>
                  {commandHistory.map((item) => (
                    <tr key={item.id}>
                      <td>
                        <code className="text-sm font-mono" style={{ color: 'var(--oneui-text)' }}>
                          {item.command}
                        </code>
                      </td>
                      <td className="oneui-text-muted">{item.date}</td>
                      <td>
                        <span className="oneui-badge oneui-badge-success">{t('common.success')}</span>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      )}

      {/* Files */}
      {activeTab === 'files' && (
        <div className="oneui-card">
          {loading ? (
            <div className="flex items-center justify-center py-8">
              <div className="oneui-spinner"></div>
            </div>
          ) : files.length === 0 ? (
            <div className="text-center py-8 text-sm oneui-text-muted">
              {t('data.noFiles')}
            </div>
          ) : (
            <div className="overflow-x-auto">
              <table className="oneui-table min-w-full">
                <thead>
                  <tr>
                    <th>{t('data.fileName')}</th>
                    <th>{t('data.size')}</th>
                    <th>{t('data.uploadDate')}</th>
                    <th>{t('common.actions')}</th>
                  </tr>
                </thead>
                <tbody>
                  {files.map((file) => (
                    <tr key={file.id}>
                      <td className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                        {file.name}
                      </td>
                      <td className="oneui-text-muted">{file.size}</td>
                      <td className="oneui-text-muted">{file.uploadDate}</td>
                      <td>
                        <div className="flex gap-2">
                          <button className="oneui-btn oneui-btn-secondary text-sm">
                            <Download className="w-4 h-4" />
                          </button>
                          <button className="oneui-btn oneui-btn-secondary text-sm">
                            <Trash2 className="w-4 h-4" />
                          </button>
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      )}

      {/* Export & Privacy */}
      {activeTab === 'export' && (
        <div className="space-y-6">
          <div className="oneui-card">
            <div className="oneui-card-header">
              <div className="flex items-center gap-3">
                <div className="oneui-stat-icon oneui-stat-icon-primary">
                  <Download className="w-5 h-5" />
                </div>
                <h3 className="oneui-card-title">{t('data.exportData')}</h3>
              </div>
            </div>
            <p className="text-sm oneui-text-muted mb-4">
              Ğ¡ĞºĞ°Ñ‡Ğ°Ğ¹Ñ‚Ğµ Ğ°Ñ€Ñ…Ğ¸Ğ² ÑĞ¾ Ğ²ÑĞµĞ¼Ğ¸ Ğ²Ğ°ÑˆĞ¸Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ JSON/ZIP.
            </p>
            <button className="oneui-btn oneui-btn-primary">
              {t('data.downloadArchive')}
            </button>
          </div>

          <div className="oneui-card">
            <div className="oneui-card-header">
              <div className="flex items-center gap-3">
                <div className="oneui-stat-icon oneui-stat-icon-danger">
                  <AlertTriangle className="w-5 h-5" />
                </div>
                <h3 className="oneui-card-title">{t('data.privacy')}</h3>
              </div>
            </div>
            <div className="space-y-4">
              <div>
                <p className="text-sm oneui-text-muted mb-3">
                  ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ÑÑ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ² Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼. Ğ­Ñ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ.
                </p>
                <button className="oneui-btn oneui-btn-secondary">
                  {t('data.clearHistory')}
                </button>
              </div>
              <div className="pt-4 border-t" style={{ borderColor: 'var(--oneui-border)' }}>
                <p className="text-sm oneui-text-muted mb-3">
                  Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚ Ğ¸ Ğ²ÑĞµ ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ. Ğ­Ñ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ.
                </p>
                <button className="oneui-btn oneui-btn-secondary" style={{ borderColor: 'var(--oneui-danger)', color: 'var(--oneui-danger)' }}>
                  {t('data.deleteAccount')}
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Security.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { api, Session } from '../../api';
import { Shield, Lock, Monitor, History, LogOut, CheckCircle2, XCircle } from 'lucide-react';

export const Security = () => {
  const { t } = useI18n();
  const [showChangePassword, setShowChangePassword] = useState(false);
  const [newPassword, setNewPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [sessions, setSessions] = useState<Session[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadSessions();
  }, []);

  const loadSessions = async () => {
    try {
      const data = await api.getSessions();
      setSessions(data);
    } catch (error) {
      console.error('Error loading sessions:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleTerminateSession = async (sessionId: string) => {
    try {
      await api.terminateSession(sessionId);
      await loadSessions();
    } catch (error: any) {
      console.error('Error terminating session:', error);
      alert(`Failed to terminate session: ${error.message || error}`);
    }
  };

  const handleTerminateAll = async () => {
    if (!confirm(t('security.confirmTerminateAll'))) return;
    try {
      for (const session of sessions) {
        if (!session.current) {
          await api.terminateSession(session.id);
        }
      }
      await loadSessions();
    } catch (error: any) {
      console.error('Error terminating all sessions:', error);
      alert(`Failed to terminate sessions: ${error.message || error}`);
    }
  };

  const handleChangePassword = async (e: React.FormEvent) => {
    e.preventDefault();
    if (newPassword !== confirmPassword) {
      alert(t('security.passwordsDoNotMatch'));
      return;
    }
    if (newPassword.length < 8) {
      alert(t('security.passwordTooShort'));
      return;
    }
    try {
      await api.setupCloudPassword(newPassword);
      alert(t('security.passwordChanged'));
      setShowChangePassword(false);
      setNewPassword('');
      setConfirmPassword('');
    } catch (error: any) {
      console.error('Error changing password:', error);
      alert(`Failed to change password: ${error.message || error}`);
    }
  };

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('security.title')}
        </h1>
        <p className="oneui-text-muted">{t('security.subtitle')}</p>
      </div>

      {/* Cloud Password */}
      <div className="oneui-card mb-6">
        <div className="oneui-card-header">
          <div className="flex items-center gap-3">
            <div className="oneui-stat-icon oneui-stat-icon-primary">
              <Lock className="w-5 h-5" />
            </div>
            <h3 className="oneui-card-title">{t('security.cloudPassword')}</h3>
          </div>
        </div>
        <div className="space-y-4">
          <p className="text-sm oneui-text-muted">
            ĞĞ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸.
          </p>
          {!showChangePassword ? (
            <button
              onClick={() => setShowChangePassword(true)}
              className="oneui-btn oneui-btn-primary"
            >
              {t('security.changePassword')}
            </button>
          ) : (
            <form onSubmit={handleChangePassword} className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
                </label>
                <input
                  type="password"
                  value={newPassword}
                  onChange={(e) => setNewPassword(e.target.value)}
                  className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                  minLength={8}
                  required
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
                </label>
                <input
                  type="password"
                  value={confirmPassword}
                  onChange={(e) => setConfirmPassword(e.target.value)}
                  className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                  minLength={8}
                  required
                />
              </div>
              <div className="flex gap-3">
                <button type="submit" className="oneui-btn oneui-btn-primary">
                  {t('common.save')}
                </button>
                <button
                  type="button"
                  onClick={() => {
                    setShowChangePassword(false);
                    setNewPassword('');
                    setConfirmPassword('');
                  }}
                  className="oneui-btn oneui-btn-secondary"
                >
                  {t('common.cancel')}
                </button>
              </div>
            </form>
          )}
        </div>
      </div>

      {/* Active Sessions */}
      <div className="oneui-card mb-6">
        <div className="oneui-card-header">
          <div className="flex items-center justify-between w-full">
            <div className="flex items-center gap-3">
              <div className="oneui-stat-icon oneui-stat-icon-success">
                <Monitor className="w-5 h-5" />
              </div>
              <h3 className="oneui-card-title">{t('security.activeSessions')}</h3>
            </div>
            <button 
              onClick={handleTerminateAll}
              className="oneui-btn oneui-btn-secondary text-sm"
              disabled={sessions.filter(s => !s.current).length === 0}
            >
              {t('security.terminateAll')}
            </button>
          </div>
        </div>
        {loading ? (
          <div className="flex items-center justify-center py-8">
            <div className="oneui-spinner"></div>
          </div>
        ) : sessions.length === 0 ? (
          <div className="text-center py-8 text-sm oneui-text-muted">
            {t('security.noSessions')}
          </div>
        ) : (
          <div className="space-y-3">
            {sessions.map((session) => (
            <div
              key={session.id}
              className="p-4 rounded-lg border"
              style={{
                backgroundColor: session.current ? 'rgba(99, 102, 241, 0.05)' : 'var(--oneui-bg-alt)',
                borderColor: 'var(--oneui-border)',
              }}
            >
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <div className="flex items-center gap-2 mb-2">
                    <span className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                      {session.device}
                    </span>
                    {session.current && (
                      <span className="oneui-badge oneui-badge-success text-xs">
                        {t('security.currentSession')}
                      </span>
                    )}
                  </div>
                  <div className="space-y-1 text-sm oneui-text-muted">
                    <div className="flex items-center gap-2">
                      <span>{t('security.location')}:</span>
                      <span>{session.location}</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>{t('security.lastActivity')}:</span>
                      <span>{session.lastActivity}</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>IP:</span>
                      <span className="font-mono">{session.ip}</span>
                    </div>
                  </div>
                </div>
                {!session.current && (
                  <button 
                    onClick={() => handleTerminateSession(session.id)}
                    className="oneui-btn oneui-btn-secondary text-sm"
                  >
                    {t('security.terminateSession')}
                  </button>
                )}
              </div>
            </div>
          ))}
          </div>
        )}
      </div>

      {/* Session History */}
      <div className="oneui-card">
        <div className="oneui-card-header">
          <div className="flex items-center gap-3">
            <div className="oneui-stat-icon oneui-stat-icon-primary">
              <History className="w-5 h-5" />
            </div>
            <h3 className="oneui-card-title">{t('security.sessionHistory')}</h3>
          </div>
        </div>
        <div className="text-sm oneui-text-muted">
          <p>Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ¾Ğ² Ğ² Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°Ñ‚ÑŒÑÑ Ğ·Ğ´ĞµÑÑŒ.</p>
        </div>
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/DatabaseData.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { api, Migration, CacheKey } from '../../api';
import { Database, Code, History, RefreshCw, Trash2, Play, ArrowUp, ArrowDown, Search } from 'lucide-react';

export const DatabaseData = () => {
  const { t } = useI18n();
  const [activeTab, setActiveTab] = useState<'sql' | 'migrations' | 'cache'>('sql');
  const [sqlQuery, setSqlQuery] = useState('SELECT * FROM users LIMIT 10;');
  const [sqlResult, setSqlResult] = useState<{columns: string[], data: Record<string, any>[], row_count: number} | null>(null);
  const [sqlError, setSqlError] = useState<string | null>(null);
  const [sqlLoading, setSqlLoading] = useState(false);
  const [migrations, setMigrations] = useState<Migration[]>([]);
  const [migrationsLoading, setMigrationsLoading] = useState(false);
  const [cacheKeys, setCacheKeys] = useState<CacheKey[]>([]);
  const [cachePattern, setCachePattern] = useState('');
  const [cacheLoading, setCacheLoading] = useState(false);

  useEffect(() => {
    if (activeTab === 'migrations') {
      loadMigrations();
    } else if (activeTab === 'cache') {
      loadCacheKeys();
    }
  }, [activeTab]);

  const executeQuery = async () => {
    if (!sqlQuery.trim()) return;
    
    setSqlLoading(true);
    setSqlError(null);
    setSqlResult(null);
    
    try {
      const result = await api.executeSqlQuery(sqlQuery);
      setSqlResult(result);
    } catch (error: any) {
      setSqlError(error.message || 'Query execution failed');
    } finally {
      setSqlLoading(false);
    }
  };

  const loadMigrations = async () => {
    try {
      setMigrationsLoading(true);
      const data = await api.getMigrations();
      setMigrations(data || []);
    } catch (error) {
      console.error('Error loading migrations:', error);
    } finally {
      setMigrationsLoading(false);
    }
  };

  const loadCacheKeys = async () => {
    try {
      setCacheLoading(true);
      const data = await api.getCacheKeys(cachePattern || undefined, 100);
      setCacheKeys(data || []);
    } catch (error) {
      console.error('Error loading cache keys:', error);
    } finally {
      setCacheLoading(false);
    }
  };

  const handleMigrationAction = async (action: 'upgrade' | 'downgrade', revision?: string) => {
    if (!confirm(t('database.confirmMigration') || `Execute ${action} migration?`)) return;
    
    try {
      const result = await api.migrationAction(action, revision);
      alert(result.message);
      await loadMigrations();
    } catch (error: any) {
      alert(`Failed: ${error.message || error}`);
    }
  };

  const handleFlushCache = async () => {
    if (!confirm(t('database.confirmFlushCache') || 'Flush all cache? This action cannot be undone.')) return;
    
    try {
      await api.flushCache();
      alert(t('database.cacheFlushed') || 'Cache flushed successfully');
      await loadCacheKeys();
    } catch (error: any) {
      alert(`Failed: ${error.message || error}`);
    }
  };

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('database.title') || 'Database & Data'}
        </h1>
        <p className="oneui-text-muted">
          {t('database.subtitle') || 'SQL Runner, Migrations, and Cache Management'}
        </p>
      </div>

      {/* Tabs */}
      <div className="flex gap-2 mb-6 border-b" style={{ borderColor: 'var(--oneui-border)' }}>
        {[
          { id: 'sql', label: t('database.sqlRunner') || 'SQL Runner', icon: Code },
          { id: 'migrations', label: t('database.migrations') || 'Migrations', icon: History },
          { id: 'cache', label: t('database.cache') || 'Cache Explorer', icon: Database },
        ].map((tab) => {
          const Icon = tab.icon;
          return (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id as any)}
              className={`px-4 py-2 flex items-center gap-2 border-b-2 transition-colors ${
                activeTab === tab.id
                  ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400'
                  : 'border-transparent oneui-text-muted hover:text-indigo-600 dark:hover:text-indigo-400'
              }`}
            >
              <Icon className="w-4 h-4" />
              <span className="font-medium">{tab.label}</span>
            </button>
          );
        })}
      </div>

      {/* SQL Runner */}
      {activeTab === 'sql' && (
        <div className="space-y-4">
          <div className="oneui-card">
            <div className="oneui-card-header">
              <div className="flex items-center gap-3">
                <div className="oneui-stat-icon oneui-stat-icon-primary">
                  <Code className="w-5 h-5" />
                </div>
                <h3 className="oneui-card-title">{t('database.sqlRunner') || 'SQL Runner'}</h3>
              </div>
            </div>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('database.query') || 'SQL Query (SELECT only)'}
                </label>
                <textarea
                  value={sqlQuery}
                  onChange={(e) => setSqlQuery(e.target.value)}
                  rows={8}
                  className="w-full px-4 py-2 border rounded-lg font-mono text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                  placeholder="SELECT * FROM users LIMIT 10;"
                />
                <p className="text-xs oneui-text-muted mt-1">
                  {t('database.sqlNote') || 'Only SELECT queries are allowed for security.'}
                </p>
              </div>
              <button
                onClick={executeQuery}
                disabled={sqlLoading || !sqlQuery.trim()}
                className="oneui-btn oneui-btn-primary flex items-center gap-2"
              >
                <Play className="w-4 h-4" />
                {sqlLoading ? (t('common.loading') || 'Loading...') : (t('database.execute') || 'Execute')}
              </button>
            </div>
          </div>

          {/* Results */}
          {sqlError && (
            <div className="oneui-card">
              <div className="p-4 rounded-lg" style={{ backgroundColor: 'rgba(239, 68, 68, 0.1)', borderLeft: '4px solid var(--oneui-danger)' }}>
                <p className="text-sm font-medium" style={{ color: 'var(--oneui-danger)' }}>
                  {t('common.error') || 'Error'}: {sqlError}
                </p>
              </div>
            </div>
          )}

          {sqlResult && (
            <div className="oneui-card">
              <div className="oneui-card-header">
                <h3 className="oneui-card-title">
                  {t('database.results') || 'Results'} ({sqlResult.row_count} {t('database.rows') || 'rows'})
                </h3>
              </div>
              <div className="overflow-x-auto">
                <table className="oneui-table min-w-full">
                  <thead>
                    <tr>
                      {sqlResult.columns.map((col) => (
                        <th key={col}>{col}</th>
                      ))}
                    </tr>
                  </thead>
                  <tbody>
                    {sqlResult.data.map((row, idx) => (
                      <tr key={idx}>
                        {sqlResult.columns.map((col) => (
                          <td key={col} className="oneui-text-muted text-sm">
                            {row[col] !== null && row[col] !== undefined ? String(row[col]) : 'NULL'}
                          </td>
                        ))}
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          )}
        </div>
      )}

      {/* Migrations */}
      {activeTab === 'migrations' && (
        <div className="space-y-4">
          <div className="oneui-card">
            <div className="oneui-card-header">
              <div className="flex items-center justify-between w-full">
                <div className="flex items-center gap-3">
                  <div className="oneui-stat-icon oneui-stat-icon-primary">
                    <History className="w-5 h-5" />
                  </div>
                  <h3 className="oneui-card-title">{t('database.migrations') || 'Migrations'}</h3>
                </div>
                <button
                  onClick={loadMigrations}
                  className="oneui-btn oneui-btn-secondary text-sm flex items-center gap-2"
                >
                  <RefreshCw className="w-4 h-4" />
                  {t('common.refresh') || 'Refresh'}
                </button>
              </div>
            </div>

            {migrationsLoading ? (
              <div className="flex items-center justify-center py-8">
                <div className="oneui-spinner"></div>
              </div>
            ) : migrations.length === 0 ? (
              <div className="text-center py-12">
                <History className="w-16 h-16 mx-auto mb-4 oneui-text-muted" />
                <h3 className="text-xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('database.noMigrations') || 'No migrations found'}
                </h3>
              </div>
            ) : (
              <div className="overflow-x-auto">
                <table className="oneui-table min-w-full">
                  <thead>
                    <tr>
                      <th>{t('database.revision') || 'Revision'}</th>
                      <th>{t('database.description') || 'Description'}</th>
                      <th>{t('database.status') || 'Status'}</th>
                      <th>{t('common.actions') || 'Actions'}</th>
                    </tr>
                  </thead>
                  <tbody>
                    {migrations.map((migration) => (
                      <tr key={migration.revision}>
                        <td>
                          <code className="text-sm font-mono" style={{ color: 'var(--oneui-text)' }}>
                            {migration.revision}
                          </code>
                        </td>
                        <td className="oneui-text-muted">
                          {migration.doc || '-'}
                        </td>
                        <td>
                          {migration.is_current ? (
                            <span className="oneui-badge oneui-badge-success">
                              {t('database.current') || 'Current'}
                            </span>
                          ) : (
                            <span className="oneui-badge oneui-badge-secondary">
                              {t('database.pending') || 'Pending'}
                            </span>
                          )}
                        </td>
                        <td>
                          <div className="flex gap-2">
                            {!migration.is_current && (
                              <button
                                onClick={() => handleMigrationAction('upgrade', migration.revision)}
                                className="oneui-btn oneui-btn-secondary text-sm flex items-center gap-1"
                                title={t('database.upgrade') || 'Upgrade'}
                              >
                                <ArrowUp className="w-3 h-3" />
                              </button>
                            )}
                            {migration.is_current && migration.down_revision && (
                              <button
                                onClick={() => handleMigrationAction('downgrade', migration.down_revision || undefined)}
                                className="oneui-btn oneui-btn-secondary text-sm flex items-center gap-1"
                                title={t('database.downgrade') || 'Downgrade'}
                              >
                                <ArrowDown className="w-3 h-3" />
                              </button>
                            )}
                          </div>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Cache Explorer */}
      {activeTab === 'cache' && (
        <div className="space-y-4">
          <div className="oneui-card">
            <div className="oneui-card-header">
              <div className="flex items-center justify-between w-full">
                <div className="flex items-center gap-3">
                  <div className="oneui-stat-icon oneui-stat-icon-primary">
                    <Database className="w-5 h-5" />
                  </div>
                  <h3 className="oneui-card-title">{t('database.cacheExplorer') || 'Cache Explorer'}</h3>
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={handleFlushCache}
                    className="oneui-btn oneui-btn-secondary text-sm flex items-center gap-2"
                  >
                    <Trash2 className="w-4 h-4" />
                    {t('database.flushCache') || 'Flush Cache'}
                  </button>
                  <button
                    onClick={loadCacheKeys}
                    className="oneui-btn oneui-btn-secondary text-sm flex items-center gap-2"
                  >
                    <RefreshCw className="w-4 h-4" />
                    {t('common.refresh') || 'Refresh'}
                  </button>
                </div>
              </div>
            </div>

            <div className="mb-4">
              <div className="flex gap-2">
                <div className="flex-1 relative">
                  <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 oneui-text-muted" />
                  <input
                    type="text"
                    value={cachePattern}
                    onChange={(e) => setCachePattern(e.target.value)}
                    onKeyDown={(e) => e.key === 'Enter' && loadCacheKeys()}
                    placeholder={t('database.searchPattern') || 'Search pattern (e.g., user:* or *)...'}
                    className="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    style={{
                      backgroundColor: 'var(--oneui-bg-alt)',
                      borderColor: 'var(--oneui-border)',
                      color: 'var(--oneui-text)',
                    }}
                  />
                </div>
                <button
                  onClick={loadCacheKeys}
                  className="oneui-btn oneui-btn-primary"
                >
                  {t('database.search') || 'Search'}
                </button>
              </div>
            </div>

            {cacheLoading ? (
              <div className="flex items-center justify-center py-8">
                <div className="oneui-spinner"></div>
              </div>
            ) : cacheKeys.length === 0 ? (
              <div className="text-center py-12">
                <Database className="w-16 h-16 mx-auto mb-4 oneui-text-muted" />
                <h3 className="text-xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('database.noCacheKeys') || 'No cache keys found'}
                </h3>
                <p className="oneui-text-muted">
                  {t('database.noCacheKeysDesc') || 'No keys match your search pattern.'}
                </p>
              </div>
            ) : (
              <div className="overflow-x-auto">
                <table className="oneui-table min-w-full">
                  <thead>
                    <tr>
                      <th>{t('database.key') || 'Key'}</th>
                      <th>{t('database.ttl') || 'TTL'}</th>
                    </tr>
                  </thead>
                  <tbody>
                    {cacheKeys.map((item) => (
                      <tr key={item.key}>
                        <td>
                          <code className="text-sm font-mono" style={{ color: 'var(--oneui-text)' }}>
                            {item.key}
                          </code>
                        </td>
                        <td className="oneui-text-muted">
                          {item.ttl !== null ? `${item.ttl}s` : t('database.noExpiry') || 'No expiry'}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Developer.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { api, Token } from '../../api';
import { Key, Plus, Copy, Trash2, ExternalLink, AlertCircle, CheckCircle2 } from 'lucide-react';

export const Developer = () => {
  const { t } = useI18n();
  const [tokens, setTokens] = useState<Token[]>([]);
  const [showGenerateForm, setShowGenerateForm] = useState(false);
  const [newTokenName, setNewTokenName] = useState('');
  const [generatedToken, setGeneratedToken] = useState<string | null>(null);
  const [loading, setLoading] = useState(true);
  const [generating, setGenerating] = useState(false);

  useEffect(() => {
    loadTokens();
  }, []);

  const loadTokens = async () => {
    try {
      setLoading(true);
      const data = await api.getTokens();
      setTokens(data);
    } catch (error) {
      console.error('Error loading tokens:', error);
    } finally {
      setLoading(false);
    }
  };

  const generateToken = async () => {
    if (!newTokenName.trim()) return;
    try {
      setGenerating(true);
      const result = await api.createToken(newTokenName);
      setTokens([...tokens, result]);
      setGeneratedToken(result.token);
      setNewTokenName('');
      setShowGenerateForm(false);
    } catch (error: any) {
      console.error('Error generating token:', error);
      alert(`Failed to generate token: ${error.message || error}`);
    } finally {
      setGenerating(false);
    }
  };

  const copyToken = (token: string) => {
    navigator.clipboard.writeText(token);
  };

  const revokeToken = async (id: string) => {
    if (!confirm(t('developer.confirmRevoke'))) return;
    try {
      await api.revokeToken(id);
      setTokens(tokens.filter((t) => t.id !== id));
    } catch (error: any) {
      console.error('Error revoking token:', error);
      alert(`Failed to revoke token: ${error.message || error}`);
    }
  };

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('developer.title')}
        </h1>
        <p className="oneui-text-muted">{t('developer.subtitle')}</p>
      </div>

      {/* Generate Token */}
      <div className="oneui-card mb-6">
        <div className="oneui-card-header">
          <div className="flex items-center justify-between w-full">
            <div className="flex items-center gap-3">
              <div className="oneui-stat-icon oneui-stat-icon-primary">
                <Key className="w-5 h-5" />
              </div>
              <h3 className="oneui-card-title">{t('developer.generateToken')}</h3>
            </div>
            <button
              onClick={() => setShowGenerateForm(!showGenerateForm)}
              className="oneui-btn oneui-btn-primary flex items-center gap-2"
            >
              <Plus className="w-4 h-4" />
              {t('developer.generateToken')}
            </button>
          </div>
        </div>

        {showGenerateForm && (
          <div className="space-y-4 pt-4 border-t" style={{ borderColor: 'var(--oneui-border)' }}>
            <div>
              <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                {t('developer.tokenName')}
              </label>
              <input
                type="text"
                value={newTokenName}
                onChange={(e) => setNewTokenName(e.target.value)}
                placeholder="My API Token"
                className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                style={{
                  backgroundColor: 'var(--oneui-bg-alt)',
                  borderColor: 'var(--oneui-border)',
                  color: 'var(--oneui-text)',
                }}
              />
            </div>
            <button 
              onClick={generateToken} 
              className="oneui-btn oneui-btn-primary"
              disabled={generating || !newTokenName.trim()}
            >
              {generating ? t('common.saving') : t('developer.generateToken')}
            </button>
          </div>
        )}

        {generatedToken && (
          <div className="mt-4 p-4 rounded-lg border-l-4" style={{
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            borderLeftColor: 'var(--oneui-success)',
          }}>
            <div className="flex items-start gap-3 mb-3">
              <AlertCircle className="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" />
              <div className="flex-1">
                <p className="text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('developer.warning')}
                </p>
                <div className="flex items-center gap-2 p-3 rounded bg-gray-100 dark:bg-gray-800">
                  <code className="flex-1 font-mono text-sm" style={{ color: 'var(--oneui-text)' }}>
                    {generatedToken}
                  </code>
                  <button
                    onClick={() => copyToken(generatedToken)}
                    className="oneui-btn oneui-btn-secondary text-sm"
                  >
                    <Copy className="w-4 h-4" />
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>

      {/* My Tokens */}
      <div className="oneui-card mb-6">
        <div className="oneui-card-header">
          <h3 className="oneui-card-title">{t('developer.myTokens')}</h3>
        </div>
        {loading ? (
          <div className="flex items-center justify-center py-8">
            <div className="oneui-spinner"></div>
          </div>
        ) : tokens.length === 0 ? (
          <div className="text-center py-8 text-sm oneui-text-muted">
            {t('developer.noTokens')}
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="oneui-table min-w-full">
              <thead>
                <tr>
                  <th>{t('developer.tokenName')}</th>
                  <th>{t('developer.created')}</th>
                  <th>{t('developer.lastUsed')}</th>
                  <th>{t('developer.actions')}</th>
                </tr>
              </thead>
              <tbody>
                {tokens.map((token) => (
                <tr key={token.id}>
                  <td className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                    {token.name}
                  </td>
                  <td className="oneui-text-muted">{token.created}</td>
                  <td className="oneui-text-muted">
                    {token.lastUsed ? new Date(token.lastUsed).toLocaleString() : t('common.never')}
                  </td>
                  <td>
                    <div className="flex gap-2">
                      {generatedToken && token.token === generatedToken && (
                        <button
                          onClick={() => copyToken(token.token!)}
                          className="oneui-btn oneui-btn-secondary text-sm"
                          title={t('developer.copyToken')}
                        >
                          <Copy className="w-4 h-4" />
                        </button>
                      )}
                      <button
                        onClick={() => revokeToken(token.id)}
                        className="oneui-btn oneui-btn-secondary text-sm"
                        title={t('developer.revokeToken')}
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </div>
                  </td>
                </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* API Documentation */}
      <div className="oneui-card">
        <div className="oneui-card-header">
          <div className="flex items-center justify-between w-full">
            <div className="flex items-center gap-3">
              <div className="oneui-stat-icon oneui-stat-icon-primary">
                <ExternalLink className="w-5 h-5" />
              </div>
              <h3 className="oneui-card-title">{t('developer.apiDocs')}</h3>
            </div>
            <a
              href="/api/docs"
              target="_blank"
              rel="noopener noreferrer"
              className="oneui-btn oneui-btn-primary flex items-center gap-2"
            >
              <ExternalLink className="w-4 h-4" />
              {t('developer.openDocs')}
            </a>
          </div>
        </div>
        <p className="text-sm oneui-text-muted">
          ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ API Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ° Ğ² Swagger UI. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ²Ğ°ÑˆĞ¸ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ Ğ´Ğ»Ñ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸.
        </p>
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/CronJobs.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { api, CronJob } from '../../api';
import { Clock, RefreshCw, Calendar, Play } from 'lucide-react';

export const CronJobs = () => {
  const { t } = useI18n();
  const [jobs, setJobs] = useState<CronJob[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadJobs();
    // Refresh every 30 seconds
    const interval = setInterval(loadJobs, 30000);
    return () => clearInterval(interval);
  }, []);

  const loadJobs = async () => {
    try {
      const data = await api.getCronJobs();
      setJobs(data || []);
    } catch (error) {
      console.error('Error loading cron jobs:', error);
    } finally {
      setLoading(false);
    }
  };

  const formatNextRun = (nextRunTime: string | null) => {
    if (!nextRunTime) return t('cronJobs.never') || 'Never';
    try {
      const date = new Date(nextRunTime);
      return date.toLocaleString();
    } catch {
      return nextRunTime;
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="oneui-spinner"></div>
      </div>
    );
  }

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('cronJobs.title') || 'Scheduled Jobs'}
        </h1>
        <p className="oneui-text-muted">
          {t('cronJobs.subtitle') || 'View and manage scheduled tasks (APScheduler)'}
        </p>
      </div>

      {/* Jobs List */}
      <div className="oneui-card">
        <div className="oneui-card-header">
          <div className="flex items-center justify-between w-full">
            <div className="flex items-center gap-3">
              <div className="oneui-stat-icon oneui-stat-icon-primary">
                <Clock className="w-5 h-5" />
              </div>
              <h3 className="oneui-card-title">
                {t('cronJobs.scheduledJobs') || 'Scheduled Jobs'}
              </h3>
            </div>
            <button
              onClick={loadJobs}
              className="oneui-btn oneui-btn-secondary text-sm flex items-center gap-2"
            >
              <RefreshCw className="w-4 h-4" />
              {t('common.refresh') || 'Refresh'}
            </button>
          </div>
        </div>

        {jobs.length === 0 ? (
          <div className="text-center py-12">
            <Clock className="w-16 h-16 mx-auto mb-4 oneui-text-muted" />
            <h3 className="text-xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
              {t('cronJobs.noJobs') || 'No scheduled jobs'}
            </h3>
            <p className="oneui-text-muted">
              {t('cronJobs.noJobsDesc') || 'No cron jobs are currently scheduled.'}
            </p>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="oneui-table min-w-full">
              <thead>
                <tr>
                  <th>{t('cronJobs.jobName') || 'Job Name'}</th>
                  <th>{t('cronJobs.function') || 'Function'}</th>
                  <th>{t('cronJobs.trigger') || 'Trigger'}</th>
                  <th>{t('cronJobs.nextRun') || 'Next Run'}</th>
                </tr>
              </thead>
              <tbody>
                {jobs.map((job) => (
                  <tr key={job.id}>
                    <td className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                      <div className="flex items-center gap-2">
                        <Calendar className="w-4 h-4 oneui-text-muted" />
                        {job.name}
                      </div>
                    </td>
                    <td className="oneui-text-muted">
                      <code className="text-sm font-mono">{job.func}</code>
                    </td>
                    <td className="oneui-text-muted">
                      {job.trigger || '-'}
                    </td>
                    <td className="oneui-text-muted">
                      <div className="flex items-center gap-2">
                        <Play className="w-4 h-4" />
                        {formatNextRun(job.next_run_time)}
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Support.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { api, Ticket } from '../../api';
import { HelpCircle, MessageSquare, FileText, Send } from 'lucide-react';

export const Support = () => {
  const { t } = useI18n();
  const [activeTab, setActiveTab] = useState<'create' | 'tickets' | 'faq'>('create');
  const [formData, setFormData] = useState({ subject: '', message: '' });
  const [tickets, setTickets] = useState<Ticket[]>([]);
  const [loading, setLoading] = useState(false);
  const [submitting, setSubmitting] = useState(false);

  useEffect(() => {
    if (activeTab === 'tickets') {
      loadTickets();
    }
  }, [activeTab]);

  const loadTickets = async () => {
    try {
      setLoading(true);
      const data = await api.getTickets();
      setTickets(data);
    } catch (error) {
      console.error('Error loading tickets:', error);
    } finally {
      setLoading(false);
    }
  };

  const faqItems = [
    {
      question: 'ĞšĞ°Ğº ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ?',
      answer: 'Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /module create Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ.',
    },
    {
      question: 'ĞšĞ°Ğº Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°?',
      answer: 'ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ¸ĞºĞ¾Ğ½ĞºÑƒ Ğ³Ğ»Ğ¾Ğ±ÑƒÑĞ° Ğ² ÑˆĞ°Ğ¿ĞºĞµ Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº.',
    },
  ];

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      setSubmitting(true);
      const newTicket = await api.createTicket(formData.subject, formData.message);
      setTickets([newTicket, ...tickets]);
      setFormData({ subject: '', message: '' });
      setActiveTab('tickets');
      alert(t('support.ticketCreated'));
    } catch (error: any) {
      console.error('Error creating ticket:', error);
      alert(`Failed to create ticket: ${error.message || error}`);
    } finally {
      setSubmitting(false);
    }
  };

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('support.title')}
        </h1>
        <p className="oneui-text-muted">{t('support.subtitle')}</p>
      </div>

      {/* Tabs */}
      <div className="flex gap-2 mb-6 border-b" style={{ borderColor: 'var(--oneui-border)' }}>
        {[
          { id: 'create', label: t('support.createTicket'), icon: MessageSquare },
          { id: 'tickets', label: t('support.myTickets'), icon: FileText },
          { id: 'faq', label: t('support.faq'), icon: HelpCircle },
        ].map((tab) => {
          const Icon = tab.icon;
          return (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id as any)}
              className={`px-4 py-2 flex items-center gap-2 border-b-2 transition-colors ${
                activeTab === tab.id
                  ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400'
                  : 'border-transparent oneui-text-muted hover:text-indigo-600 dark:hover:text-indigo-400'
              }`}
            >
              <Icon className="w-4 h-4" />
              <span className="font-medium">{tab.label}</span>
            </button>
          );
        })}
      </div>

      {/* Create Ticket */}
      {activeTab === 'create' && (
        <div className="oneui-card">
          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                {t('support.subject')}
              </label>
              <input
                type="text"
                value={formData.subject}
                onChange={(e) => setFormData({ ...formData, subject: e.target.value })}
                className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                style={{
                  backgroundColor: 'var(--oneui-bg-alt)',
                  borderColor: 'var(--oneui-border)',
                  color: 'var(--oneui-text)',
                }}
                required
              />
            </div>
            <div>
              <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                {t('support.message')}
              </label>
              <textarea
                value={formData.message}
                onChange={(e) => setFormData({ ...formData, message: e.target.value })}
                rows={6}
                className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                style={{
                  backgroundColor: 'var(--oneui-bg-alt)',
                  borderColor: 'var(--oneui-border)',
                  color: 'var(--oneui-text)',
                }}
                required
              />
            </div>
            <button 
              type="submit" 
              className="oneui-btn oneui-btn-primary flex items-center gap-2"
              disabled={submitting}
            >
              <Send className="w-4 h-4" />
              {submitting ? t('common.saving') : t('support.submit')}
            </button>
          </form>
        </div>
      )}

      {/* My Tickets */}
      {activeTab === 'tickets' && (
        <div className="oneui-card">
          {loading ? (
            <div className="flex items-center justify-center py-8">
              <div className="oneui-spinner"></div>
            </div>
          ) : tickets.length === 0 ? (
            <div className="text-center py-8 text-sm oneui-text-muted">
              {t('support.noTickets')}
            </div>
          ) : (
            <div className="overflow-x-auto">
              <table className="oneui-table min-w-full">
                <thead>
                  <tr>
                    <th>{t('support.ticketId')}</th>
                    <th>{t('support.subject')}</th>
                    <th>{t('support.status')}</th>
                    <th>{t('support.created')}</th>
                    <th>{t('support.updated')}</th>
                  </tr>
                </thead>
                <tbody>
                  {tickets.map((ticket) => (
                  <tr key={ticket.id}>
                    <td>
                      <code className="text-sm font-mono" style={{ color: 'var(--oneui-text)' }}>
                        {ticket.id}
                      </code>
                    </td>
                    <td className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                      {ticket.subject}
                    </td>
                    <td>
                      <span
                        className={`oneui-badge ${
                          ticket.status === 'open'
                            ? 'oneui-badge-success'
                            : 'oneui-badge-danger'
                        }`}
                      >
                        {ticket.status === 'open' ? t('support.open') : t('support.closed')}
                      </span>
                    </td>
                    <td className="oneui-text-muted">
                      {new Date(ticket.created).toLocaleDateString()}
                    </td>
                    <td className="oneui-text-muted">
                      {new Date(ticket.updated).toLocaleDateString()}
                    </td>
                  </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      )}

      {/* FAQ */}
      {activeTab === 'faq' && (
        <div className="space-y-4">
          {faqItems.map((item, index) => (
            <div key={index} className="oneui-card">
              <h3 className="font-semibold mb-2" style={{ color: 'var(--oneui-text)' }}>
                {item.question}
              </h3>
              <p className="text-sm oneui-text-muted">{item.answer}</p>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/CoreManagement.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { api, Service, FeatureFlag } from '../../api';
import { Settings, Play, Square, RotateCw, ToggleLeft, ToggleRight, Save, RefreshCw } from 'lucide-react';
import Editor from '@monaco-editor/react';

export const CoreManagement = () => {
  const { t } = useI18n();
  const [activeTab, setActiveTab] = useState<'config' | 'services' | 'flags'>('config');
  const [configContent, setConfigContent] = useState('');
  const [services, setServices] = useState<Service[]>([]);
  const [featureFlags, setFeatureFlags] = useState<FeatureFlag[]>([]);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);

  useEffect(() => {
    loadData();
  }, [activeTab]);

  const loadData = async () => {
    try {
      setLoading(true);
      if (activeTab === 'config') {
        const config = await api.getConfig();
        setConfigContent(config.content);
      } else if (activeTab === 'services') {
        const servicesData = await api.getServices();
        setServices(servicesData);
      } else if (activeTab === 'flags') {
        const flags = await api.getFeatureFlags();
        setFeatureFlags(flags);
      }
    } catch (error) {
      console.error('Error loading data:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleServiceAction = async (serviceId: string, action: 'start' | 'stop' | 'restart') => {
    try {
      await api.serviceAction(serviceId, action);
      // Reload services to get updated status
      await loadData();
    } catch (error: any) {
      console.error('Error performing service action:', error);
      alert(`Failed to ${action} service: ${error.message || error}`);
    }
  };

  const toggleFeatureFlag = async (flagName: string) => {
    const flag = featureFlags.find(f => f.name === flagName);
    if (!flag) return;
    
    try {
      await api.updateFeatureFlag(flagName, !flag.enabled);
      setFeatureFlags(prev => prev.map(f => 
        f.name === flagName ? { ...f, enabled: !f.enabled } : f
      ));
    } catch (error: any) {
      console.error('Error updating feature flag:', error);
      alert(`Failed to update feature flag: ${error.message || error}`);
    }
  };

  const saveConfig = async () => {
    try {
      setSaving(true);
      await api.updateConfig(configContent);
      alert('Configuration saved successfully! Restart required to apply changes.');
    } catch (error: any) {
      console.error('Error saving config:', error);
      alert(`Failed to save config: ${error.message || error}`);
    } finally {
      setSaving(false);
    }
  };

  const reloadConfig = async () => {
    try {
      const result = await api.reloadConfig();
      alert(result.message);
    } catch (error: any) {
      console.error('Error reloading config:', error);
      alert(`Failed to reload config: ${error.message || error}`);
    }
  };

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          ğŸ§  Core Management
        </h1>
        <p className="oneui-text-muted">Manage core system configuration and services</p>
      </div>

      {loading && (
        <div className="flex items-center justify-center h-64">
          <div className="oneui-spinner"></div>
        </div>
      )}

      {!loading && (
        <>
      {/* Tabs */}
      <div className="flex gap-2 mb-6 border-b" style={{ borderColor: 'var(--oneui-border)' }}>
        {[
          { id: 'config', label: 'Configuration Editor', icon: Settings },
          { id: 'services', label: 'Services Controller', icon: Play },
          { id: 'flags', label: 'Feature Flags', icon: ToggleRight },
        ].map((tab) => {
          const Icon = tab.icon;
          return (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id as any)}
              className={`px-4 py-2 flex items-center gap-2 border-b-2 transition-colors ${
                activeTab === tab.id
                  ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400'
                  : 'border-transparent oneui-text-muted hover:text-indigo-600 dark:hover:text-indigo-400'
              }`}
            >
              <Icon className="w-4 h-4" />
              <span className="font-medium">{tab.label}</span>
            </button>
          );
        })}
      </div>

      {/* Configuration Editor */}
      {activeTab === 'config' && (
        <div className="oneui-card">
          <div className="oneui-card-header">
            <div className="flex items-center justify-between w-full">
              <h3 className="oneui-card-title">Core Settings Editor</h3>
              <div className="flex gap-2">
                <button onClick={reloadConfig} className="oneui-btn oneui-btn-secondary flex items-center gap-2">
                  <RefreshCw className="w-4 h-4" />
                  Hot Reload
                </button>
                <button onClick={saveConfig} className="oneui-btn oneui-btn-primary flex items-center gap-2">
                  <Save className="w-4 h-4" />
                  Save
                </button>
              </div>
            </div>
          </div>
          <div className="mt-4" style={{ height: '500px', border: '1px solid var(--oneui-border)', borderRadius: '0.5rem' }}>
            <Editor
              height="100%"
              defaultLanguage="yaml"
              value={configContent}
              onChange={(value) => setConfigContent(value || '')}
              theme="vs-dark"
              options={{
                minimap: { enabled: false },
                fontSize: 14,
                wordWrap: 'on',
                automaticLayout: true,
              }}
            />
          </div>
        </div>
      )}

      {/* Services Controller */}
      {activeTab === 'services' && (
        <div className="oneui-card">
          <div className="oneui-card-header">
            <h3 className="oneui-card-title">System Services</h3>
          </div>
          <div className="overflow-x-auto">
            <table className="oneui-table min-w-full">
              <thead>
                <tr>
                  <th>Service</th>
                  <th>Description</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {services.map((service) => (
                  <tr key={service.id}>
                    <td className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                      {service.name}
                    </td>
                    <td className="oneui-text-muted">{service.description}</td>
                    <td>
                      <span className={`oneui-badge ${
                        service.status === 'running' ? 'oneui-badge-success' :
                        service.status === 'restarting' ? 'oneui-badge-warning' :
                        'oneui-badge-danger'
                      }`}>
                        {service.status}
                      </span>
                    </td>
                    <td>
                      <div className="flex gap-2">
                        {service.status === 'running' ? (
                          <>
                            <button
                              onClick={() => handleServiceAction(service.id, 'stop')}
                              className="oneui-btn oneui-btn-secondary text-sm"
                            >
                              <Square className="w-4 h-4" />
                            </button>
                            <button
                              onClick={() => handleServiceAction(service.id, 'restart')}
                              className="oneui-btn oneui-btn-secondary text-sm"
                              disabled={service.status === 'restarting'}
                            >
                              <RotateCw className="w-4 h-4" />
                            </button>
                          </>
                        ) : (
                          <button
                            onClick={() => handleServiceAction(service.id, 'start')}
                            className="oneui-btn oneui-btn-primary text-sm"
                          >
                            <Play className="w-4 h-4" />
                          </button>
                        )}
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      )}

      {/* Feature Flags */}
      {activeTab === 'flags' && (
        <div className="oneui-card">
          <div className="oneui-card-header">
            <h3 className="oneui-card-title">Feature Flags</h3>
          </div>
          <div className="space-y-4">
            {featureFlags.map((flag) => (
              <div
                key={flag.name}
                className="p-4 rounded-lg border"
                style={{
                  backgroundColor: 'var(--oneui-bg-alt)',
                  borderColor: 'var(--oneui-border)',
                }}
              >
                <div className="flex items-center justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-2">
                      <h4 className="font-semibold" style={{ color: 'var(--oneui-text)' }}>
                        {flag.name}
                      </h4>
                      <label className="relative inline-flex items-center cursor-pointer">
                        <input
                          type="checkbox"
                          className="sr-only peer"
                          checked={flag.enabled}
                          onChange={() => toggleFeatureFlag(flag.name)}
                        />
                        <div className="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all dark:after:border-gray-600 peer-checked:bg-indigo-600"></div>
                      </label>
                    </div>
                    <p className="text-sm oneui-text-muted">{flag.description}</p>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}
        </>
      )}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Home.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, BotStats } from '../../api';
import { useI18n } from '../../contexts/I18nContext';
import { Settings } from 'lucide-react';
import { WidgetContainer } from '../widgets/WidgetContainer';
import { StatsWidget } from '../widgets/StatsWidget';
import { ActivityWidget } from '../widgets/ActivityWidget';
import { SystemHealthWidget } from '../widgets/SystemHealthWidget';
import { QuickActionsWidget } from '../widgets/QuickActionsWidget';
import { RecentErrorsWidget } from '../widgets/RecentErrorsWidget';
import { TopModulesWidget } from '../widgets/TopModulesWidget';
import { UserStatsWidget } from '../widgets/UserStatsWidget';
import { ServicesStatusWidget } from '../widgets/ServicesStatusWidget';
import { PerformanceWidget } from '../widgets/PerformanceWidget';
import { SystemAnnouncementsWidget } from '../widgets/SystemAnnouncementsWidget';
import { UptimeWidget } from '../widgets/UptimeWidget';
import { WeatherWidget } from '../widgets/WeatherWidget';
import { CalendarWidget } from '../widgets/CalendarWidget';
import { NotesWidget } from '../widgets/NotesWidget';
import { TasksWidget } from '../widgets/TasksWidget';
import { TimeWidget } from '../widgets/TimeWidget';
import { GitHubWidget } from '../widgets/GitHubWidget';
import { ToolsWidget } from '../widgets/ToolsWidget';
import { WidgetSettings, WidgetConfig, WidgetType } from '../widgets/WidgetSettings';

const WIDGET_STORAGE_KEY = 'sdb_home_widgets_config';

const DEFAULT_WIDGETS: WidgetConfig[] = [
  { id: 'stats', type: 'stats', title: 'Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°', enabled: true, order: 0 },
  { id: 'activity', type: 'activity', title: 'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ', enabled: true, order: 1 },
  { id: 'systemHealth', type: 'systemHealth', title: 'Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹', enabled: true, order: 2 },
  { id: 'quickActions', type: 'custom', title: 'Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ', enabled: true, order: 3 },
  { id: 'recentErrors', type: 'custom', title: 'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸', enabled: false, order: 4 },
  { id: 'topModules', type: 'custom', title: 'Ğ¢Ğ¾Ğ¿ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹', enabled: false, order: 5 },
  { id: 'userStats', type: 'custom', title: 'Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹', enabled: false, order: 6 },
  { id: 'servicesStatus', type: 'custom', title: 'Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²', enabled: false, order: 7 },
  { id: 'performance', type: 'custom', title: 'ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ', enabled: false, order: 8 },
  { id: 'announcements', type: 'custom', title: 'ĞĞ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ñ', enabled: false, order: 9 },
  { id: 'uptime', type: 'custom', title: 'Ğ’Ñ€ĞµĞ¼Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹', enabled: false, order: 10 },
  { id: 'weather', type: 'custom', title: 'ĞŸĞ¾Ğ³Ğ¾Ğ´Ğ°', enabled: false, order: 11 },
  { id: 'calendar', type: 'custom', title: 'ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ', enabled: false, order: 12 },
  { id: 'notes', type: 'custom', title: 'Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸', enabled: false, order: 13 },
  { id: 'tasks', type: 'custom', title: 'Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸', enabled: false, order: 14 },
  { id: 'time', type: 'custom', title: 'Ğ’Ñ€ĞµĞ¼Ñ', enabled: false, order: 15 },
  { id: 'github', type: 'custom', title: 'GitHub', enabled: false, order: 16 },
  { id: 'tools', type: 'custom', title: 'Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹', enabled: false, order: 17 },
];

export const Home = () => {
  const { t } = useI18n();
  const [botStats, setBotStats] = useState<BotStats | null>(null);
  const [loading, setLoading] = useState(true);
  const [widgets, setWidgets] = useState<WidgetConfig[]>(DEFAULT_WIDGETS);
  const [enabledWidgetIds, setEnabledWidgetIds] = useState<string[]>(['stats', 'activity', 'systemHealth', 'quickActions']);
  const [showSettings, setShowSettings] = useState(false);
  const [draggedWidgetId, setDraggedWidgetId] = useState<string | null>(null);
  const [dragOverWidgetId, setDragOverWidgetId] = useState<string | null>(null);

  useEffect(() => {
    // Load widget configuration from localStorage
    const savedConfig = localStorage.getItem(WIDGET_STORAGE_KEY);
    if (savedConfig) {
      try {
        const config = JSON.parse(savedConfig);
        setWidgets(config.widgets || DEFAULT_WIDGETS);
        setEnabledWidgetIds(config.enabledIds || ['stats', 'activity', 'systemHealth']);
      } catch (e) {
        console.error('Error loading widget config:', e);
      }
    }

    loadStats();
    const interval = setInterval(loadStats, 30000);
    return () => clearInterval(interval);
  }, []);

  const loadStats = async () => {
    try {
      const stats: BotStats = await api.getStats();
      setBotStats(stats);
    } catch (error) {
      console.error('Error loading stats:', error);
    } finally {
      setLoading(false);
    }
  };

  const saveWidgetConfig = (enabledIds: string[]) => {
    const config = {
      widgets: widgets,
      enabledIds: enabledIds,
    };
    localStorage.setItem(WIDGET_STORAGE_KEY, JSON.stringify(config));
    setEnabledWidgetIds(enabledIds);
  };

  const removeWidget = (id: string) => {
    const newEnabled = enabledWidgetIds.filter(w => w !== id);
    saveWidgetConfig(newEnabled);
  };

  const handleDragStart = (e: React.DragEvent, widgetId: string) => {
    setDraggedWidgetId(widgetId);
  };

  const handleDragOver = (e: React.DragEvent, widgetId: string) => {
    e.preventDefault();
    if (draggedWidgetId && draggedWidgetId !== widgetId) {
      setDragOverWidgetId(widgetId);
    }
  };

  const handleDrop = (e: React.DragEvent, targetWidgetId: string) => {
    e.preventDefault();
    if (!draggedWidgetId || draggedWidgetId === targetWidgetId) {
      setDraggedWidgetId(null);
      setDragOverWidgetId(null);
      return;
    }

    const draggedIndex = enabledWidgetIds.indexOf(draggedWidgetId);
    const targetIndex = enabledWidgetIds.indexOf(targetWidgetId);

    if (draggedIndex === -1 || targetIndex === -1) {
      setDraggedWidgetId(null);
      setDragOverWidgetId(null);
      return;
    }

    const newOrder = [...enabledWidgetIds];
    newOrder.splice(draggedIndex, 1);
    newOrder.splice(targetIndex, 0, draggedWidgetId);

    saveWidgetConfig(newOrder);
    setDraggedWidgetId(null);
    setDragOverWidgetId(null);
  };

  const handleDragEnd = () => {
    setDraggedWidgetId(null);
    setDragOverWidgetId(null);
  };

  const renderWidget = (widgetId: string) => {
    const widget = widgets.find(w => w.id === widgetId);
    if (!widget) return null;

    const isDragging = draggedWidgetId === widgetId;
    const isDragOver = dragOverWidgetId === widgetId;

    switch (widget.type) {
      case 'stats':
        return (
          <WidgetContainer
            key={widget.id}
            id={widget.id}
            title={widget.title}
            onRemove={() => removeWidget(widget.id)}
            isDragging={isDragging}
            onDragStart={(e) => handleDragStart(e, widget.id)}
            onDragOver={(e) => handleDragOver(e, widget.id)}
            onDrop={(e) => handleDrop(e, widget.id)}
            onDragEnd={handleDragEnd}
          >
            {botStats ? <StatsWidget stats={botStats} /> : <div className="text-center py-8 oneui-text-muted">Loading...</div>}
          </WidgetContainer>
        );
      case 'activity':
        return (
          <WidgetContainer
            key={widget.id}
            id={widget.id}
            title={widget.title}
            onRemove={() => removeWidget(widget.id)}
            isDragging={isDragging}
            onDragStart={(e) => handleDragStart(e, widget.id)}
            onDragOver={(e) => handleDragOver(e, widget.id)}
            onDrop={(e) => handleDrop(e, widget.id)}
            onDragEnd={handleDragEnd}
          >
            <ActivityWidget />
          </WidgetContainer>
        );
      case 'systemHealth':
        return (
          <WidgetContainer
            key={widget.id}
            id={widget.id}
            title={widget.title}
            onRemove={() => removeWidget(widget.id)}
            isDragging={isDragging}
            onDragStart={(e) => handleDragStart(e, widget.id)}
            onDragOver={(e) => handleDragOver(e, widget.id)}
            onDrop={(e) => handleDrop(e, widget.id)}
            onDragEnd={handleDragEnd}
          >
            <SystemHealthWidget />
          </WidgetContainer>
        );
      case 'custom':
        // Render custom widgets based on id
        if (widget.id === 'quickActions') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <QuickActionsWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'recentErrors') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <RecentErrorsWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'topModules') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <TopModulesWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'userStats') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <UserStatsWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'servicesStatus') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <ServicesStatusWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'performance') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <PerformanceWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'announcements') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <SystemAnnouncementsWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'uptime') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <UptimeWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'weather') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <WeatherWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'calendar') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <CalendarWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'notes') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <NotesWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'tasks') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <TasksWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'time') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <TimeWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'github') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <GitHubWidget />
            </WidgetContainer>
          );
        }
        if (widget.id === 'tools') {
          return (
            <WidgetContainer
              key={widget.id}
              id={widget.id}
              title={widget.title}
              onRemove={() => removeWidget(widget.id)}
              isDragging={isDragging}
              onDragStart={(e) => handleDragStart(e, widget.id)}
              onDragOver={(e) => handleDragOver(e, widget.id)}
              onDrop={(e) => handleDrop(e, widget.id)}
              onDragEnd={handleDragEnd}
            >
              <ToolsWidget />
            </WidgetContainer>
          );
        }
        return null;
    }
  };

  if (loading && !botStats) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="oneui-spinner"></div>
      </div>
    );
  }

  const enabledWidgets = enabledWidgetIds
    .map(id => widgets.find(w => w.id === id))
    .filter((w): w is WidgetConfig => w !== undefined);

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6 flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
            {t('home.title')}
          </h1>
          <p className="oneui-text-muted">{t('home.subtitle')}</p>
        </div>
        <button
          onClick={() => setShowSettings(true)}
          className="oneui-btn oneui-btn-secondary flex items-center gap-2"
          title={t('home.customize') || 'Customize widgets'}
        >
          <Settings className="w-4 h-4" />
          {t('home.customize') || 'Customize'}
        </button>
      </div>

      {/* Widgets Grid */}
      <div className="space-y-6">
        {enabledWidgets.length === 0 ? (
          <div className="oneui-card text-center py-12">
            <p className="oneui-text-muted mb-4">{t('home.noWidgets') || 'No widgets enabled'}</p>
            <button
              onClick={() => setShowSettings(true)}
              className="oneui-btn oneui-btn-primary"
            >
              {t('home.addWidgets') || 'Add Widgets'}
            </button>
          </div>
        ) : (
          enabledWidgets.map(widget => renderWidget(widget.id))
        )}
      </div>

      {/* Widget Settings Modal */}
      {showSettings && (
        <WidgetSettings
          availableWidgets={widgets}
          enabledWidgets={enabledWidgetIds}
          onClose={() => setShowSettings(false)}
          onSave={saveWidgetConfig}
        />
      )}
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/sections/MissionControl.tsx ------------------------------
import { useEffect, useState, useRef } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { api } from '../../api';
import { Activity, Server, Database, Zap, Users, MessageSquare, AlertTriangle, TrendingUp, Cpu, HardDrive, Wifi } from 'lucide-react';
import { LineChart, Line, AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } from 'recharts';

type Metric = {
  time: string;
  rps: number;
  responseTime: number;
  errorRate: number;
};

type SystemMetrics = {
  cpu: number;
  ram: number;
  ramUsed: number;
  ramTotal: number;
  disk: number;
  diskUsed: number;
  diskTotal: number;
  redis: number;
  redisUsed: number;
  redisTotal: number;
  dbConnections: number;
  activeUsers: number;
  newUsersToday: number;
  queueSize: number;
};

const COLORS = ['#6366f1', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981'];

// Format bytes to human readable format
const formatBytes = (bytes: number): string => {
  if (bytes === 0) return '0 B';
  const k = 1024;
  const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return `${(bytes / Math.pow(k, i)).toFixed(1)} ${sizes[i]}`;
};

export const MissionControl = () => {
  const { t } = useI18n();
  const [metrics, setMetrics] = useState<Metric[]>([]);
  const [systemMetrics, setSystemMetrics] = useState<SystemMetrics>({
    cpu: 0,
    ram: 0,
    ramUsed: 0,
    ramTotal: 0,
    disk: 0,
    diskUsed: 0,
    diskTotal: 0,
    redis: 0,
    redisUsed: 0,
    redisTotal: 0,
    dbConnections: 0,
    activeUsers: 0,
    newUsersToday: 0,
    queueSize: 0,
  });
  const [errorRate, setErrorRate] = useState<'low' | 'medium' | 'high'>('low');
  const wsRef = useRef<WebSocket | null>(null);

  useEffect(() => {
    const loadMetrics = async () => {
      try {
        // Load system metrics
        const sysMetrics = await api.getSystemMetrics();
        setSystemMetrics({
          cpu: sysMetrics.cpu,
          ram: sysMetrics.ram,
          ramUsed: sysMetrics.ramUsed || 0,
          ramTotal: sysMetrics.ramTotal || 0,
          disk: sysMetrics.disk,
          diskUsed: sysMetrics.diskUsed || 0,
          diskTotal: sysMetrics.diskTotal || 0,
          redis: sysMetrics.redis,
          redisUsed: sysMetrics.redisUsed || 0,
          redisTotal: sysMetrics.redisTotal || 0,
          dbConnections: sysMetrics.dbConnections,
          activeUsers: 0, // Will be updated from live metrics
          newUsersToday: 0, // Will be updated from live metrics
          queueSize: 0, // Will be updated from live metrics
        });

        // Load live metrics
        const liveMetrics = await api.getLiveMetrics();
        const now = new Date().toLocaleTimeString();
        const newMetric: Metric = {
          time: now,
          rps: liveMetrics.rps,
          responseTime: liveMetrics.responseTime,
          errorRate: liveMetrics.errorRate,
        };

        setMetrics((prev) => {
          const updated = [...prev, newMetric];
          return updated.slice(-20); // Keep last 20 points
        });

        // Update error rate status
        if (liveMetrics.errorRate > 3) {
          setErrorRate('high');
        } else if (liveMetrics.errorRate > 1) {
          setErrorRate('medium');
        } else {
          setErrorRate('low');
        }

        // Update system metrics with live data
        setSystemMetrics((prev) => ({
          ...prev,
          activeUsers: liveMetrics.activeUsers,
          newUsersToday: liveMetrics.newUsersToday,
          queueSize: liveMetrics.queueSize,
        }));
      } catch (error) {
        console.error('Error loading metrics:', error);
      }
    };

    // Load immediately
    loadMetrics();

    // Then update every 2-5 seconds
    const interval = setInterval(loadMetrics, 3000);

    return () => {
      clearInterval(interval);
      if (wsRef.current) {
        wsRef.current.close();
      }
    };
  }, []);

  const pieData = [
    { name: 'Used', value: systemMetrics.cpu },
    { name: 'Free', value: 100 - systemMetrics.cpu },
  ];

  const ramData = [
    { name: 'Used', value: systemMetrics.ram },
    { name: 'Free', value: 100 - systemMetrics.ram },
  ];

  const diskData = [
    { name: 'Used', value: systemMetrics.disk },
    { name: 'Free', value: 100 - systemMetrics.disk },
  ];

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
              ğŸ›°ï¸ Mission Control
            </h1>
            <p className="oneui-text-muted">Real-time system monitoring and control center</p>
          </div>
          <div className={`px-4 py-2 rounded-lg flex items-center gap-2 ${
            errorRate === 'low' ? 'bg-green-500/20 text-green-500' :
            errorRate === 'medium' ? 'bg-yellow-500/20 text-yellow-500' :
            'bg-red-500/20 text-red-500'
          }`}>
            <div className={`w-2 h-2 rounded-full ${
              errorRate === 'low' ? 'bg-green-500' :
              errorRate === 'medium' ? 'bg-yellow-500' :
              'bg-red-500'
            } animate-pulse`} />
            <span className="font-semibold">
              {errorRate === 'low' ? 'All Systems Operational' :
               errorRate === 'medium' ? 'Minor Issues Detected' :
               'Critical Issues'}
            </span>
          </div>
        </div>
      </div>

      {/* Live Metrics Charts */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        {/* RPS Chart */}
        <div className="oneui-card">
          <div className="oneui-card-header">
            <div className="flex items-center gap-2">
              <Activity className="w-5 h-5" style={{ color: 'var(--oneui-primary)' }} />
              <h3 className="oneui-card-title">Requests Per Second</h3>
            </div>
          </div>
          <ResponsiveContainer width="100%" height={200}>
            <AreaChart data={metrics}>
              <defs>
                <linearGradient id="colorRps" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="5%" stopColor="#6366f1" stopOpacity={0.8}/>
                  <stop offset="95%" stopColor="#6366f1" stopOpacity={0}/>
                </linearGradient>
              </defs>
              <CartesianGrid strokeDasharray="3 3" stroke="rgba(255,255,255,0.1)" />
              <XAxis dataKey="time" stroke="var(--oneui-text-muted)" fontSize={12} />
              <YAxis stroke="var(--oneui-text-muted)" fontSize={12} />
              <Tooltip contentStyle={{ backgroundColor: 'var(--oneui-bg)', border: '1px solid var(--oneui-border)' }} />
              <Area type="monotone" dataKey="rps" stroke="#6366f1" fillOpacity={1} fill="url(#colorRps)" />
            </AreaChart>
          </ResponsiveContainer>
        </div>

        {/* Response Time Chart */}
        <div className="oneui-card">
          <div className="oneui-card-header">
            <div className="flex items-center gap-2">
              <Zap className="w-5 h-5" style={{ color: 'var(--oneui-warning)' }} />
              <h3 className="oneui-card-title">Response Time (ms)</h3>
            </div>
          </div>
          <ResponsiveContainer width="100%" height={200}>
            <LineChart data={metrics}>
              <CartesianGrid strokeDasharray="3 3" stroke="rgba(255,255,255,0.1)" />
              <XAxis dataKey="time" stroke="var(--oneui-text-muted)" fontSize={12} />
              <YAxis stroke="var(--oneui-text-muted)" fontSize={12} />
              <Tooltip contentStyle={{ backgroundColor: 'var(--oneui-bg)', border: '1px solid var(--oneui-border)' }} />
              <Line type="monotone" dataKey="responseTime" stroke="#f59e0b" strokeWidth={2} dot={false} />
            </LineChart>
          </ResponsiveContainer>
        </div>
      </div>

      {/* Infrastructure Status */}
      <div className="mb-6">
        <h2 className="text-lg font-semibold mb-4" style={{ color: 'var(--oneui-text)' }}>
          Infrastructure Status
        </h2>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          {/* CPU */}
          <div className="oneui-card">
            <div className="flex items-center justify-between mb-2">
              <div className="flex items-center gap-2">
                <Cpu className="w-5 h-5" style={{ color: 'var(--oneui-primary)' }} />
                <span className="font-medium" style={{ color: 'var(--oneui-text)' }}>CPU</span>
              </div>
              <span className="text-lg font-bold" style={{ color: 'var(--oneui-text)' }}>
                {systemMetrics.cpu.toFixed(1)}%
              </span>
            </div>
            <div className="text-xs oneui-text-muted mb-3 text-center">
              {systemMetrics.cpu.toFixed(1)}% used
            </div>
            <ResponsiveContainer width="100%" height={100}>
              <PieChart>
                <Pie
                  data={pieData}
                  cx="50%"
                  cy="50%"
                  innerRadius={25}
                  outerRadius={40}
                  startAngle={90}
                  endAngle={-270}
                  dataKey="value"
                >
                  {pieData.map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={index === 0 ? '#6366f1' : 'rgba(255,255,255,0.1)'} />
                  ))}
                </Pie>
              </PieChart>
            </ResponsiveContainer>
          </div>

          {/* RAM */}
          <div className="oneui-card">
            <div className="flex items-center justify-between mb-2">
              <div className="flex items-center gap-2">
                <Server className="w-5 h-5" style={{ color: 'var(--oneui-success)' }} />
                <span className="font-medium" style={{ color: 'var(--oneui-text)' }}>RAM</span>
              </div>
              <span className="text-lg font-bold" style={{ color: 'var(--oneui-text)' }}>
                {systemMetrics.ram.toFixed(1)}%
              </span>
            </div>
            <div className="text-xs oneui-text-muted mb-3 text-center">
              {systemMetrics.ramTotal > 0 ? (
                <>
                  {formatBytes(systemMetrics.ramUsed)} / {formatBytes(systemMetrics.ramTotal)}
                </>
              ) : (
                'N/A'
              )}
            </div>
            <ResponsiveContainer width="100%" height={100}>
              <PieChart>
                <Pie
                  data={ramData}
                  cx="50%"
                  cy="50%"
                  innerRadius={25}
                  outerRadius={40}
                  startAngle={90}
                  endAngle={-270}
                  dataKey="value"
                >
                  {ramData.map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={index === 0 ? '#10b981' : 'rgba(255,255,255,0.1)'} />
                  ))}
                </Pie>
              </PieChart>
            </ResponsiveContainer>
          </div>

          {/* Disk */}
          <div className="oneui-card">
            <div className="flex items-center justify-between mb-2">
              <div className="flex items-center gap-2">
                <HardDrive className="w-5 h-5" style={{ color: 'var(--oneui-warning)' }} />
                <span className="font-medium" style={{ color: 'var(--oneui-text)' }}>Disk</span>
              </div>
              <span className="text-lg font-bold" style={{ color: 'var(--oneui-text)' }}>
                {systemMetrics.disk.toFixed(1)}%
              </span>
            </div>
            <div className="text-xs oneui-text-muted mb-3 text-center">
              {systemMetrics.diskTotal > 0 ? (
                <>
                  {formatBytes(systemMetrics.diskUsed)} / {formatBytes(systemMetrics.diskTotal)}
                </>
              ) : (
                'N/A'
              )}
            </div>
            <ResponsiveContainer width="100%" height={100}>
              <PieChart>
                <Pie
                  data={diskData}
                  cx="50%"
                  cy="50%"
                  innerRadius={25}
                  outerRadius={40}
                  startAngle={90}
                  endAngle={-270}
                  dataKey="value"
                >
                  {diskData.map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={index === 0 ? '#f59e0b' : 'rgba(255,255,255,0.1)'} />
                  ))}
                </Pie>
              </PieChart>
            </ResponsiveContainer>
          </div>

          {/* Redis */}
          <div className="oneui-card">
            <div className="flex items-center justify-between mb-2">
              <div className="flex items-center gap-2">
                <Database className="w-5 h-5" style={{ color: 'var(--oneui-danger)' }} />
                <span className="font-medium" style={{ color: 'var(--oneui-text)' }}>Redis</span>
              </div>
              <span className="text-lg font-bold" style={{ color: 'var(--oneui-text)' }}>
                {systemMetrics.redis.toFixed(1)}%
              </span>
            </div>
            <div className="text-xs oneui-text-muted mb-3 text-center">
              {systemMetrics.redisTotal > 0 ? (
                <>
                  {formatBytes(systemMetrics.redisUsed)} / {formatBytes(systemMetrics.redisTotal)}
                </>
              ) : (
                'N/A'
              )}
            </div>
            <div className="mt-2">
              <div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                <div
                  className="bg-red-500 h-2 rounded-full transition-all"
                  style={{ width: `${systemMetrics.redis}%` }}
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Business Metrics */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div className="oneui-card">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm oneui-text-muted mb-1">Active Users (24h)</p>
              <p className="text-2xl font-bold" style={{ color: 'var(--oneui-text)' }}>
                {systemMetrics.activeUsers.toLocaleString()}
              </p>
            </div>
            <Users className="w-8 h-8" style={{ color: 'var(--oneui-primary)' }} />
          </div>
        </div>

        <div className="oneui-card">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm oneui-text-muted mb-1">New Users Today</p>
              <p className="text-2xl font-bold" style={{ color: 'var(--oneui-text)' }}>
                {systemMetrics.newUsersToday}
              </p>
            </div>
            <TrendingUp className="w-8 h-8" style={{ color: 'var(--oneui-success)' }} />
          </div>
        </div>

        <div className="oneui-card">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm oneui-text-muted mb-1">Queue Size</p>
              <p className="text-2xl font-bold" style={{ color: 'var(--oneui-text)' }}>
                {systemMetrics.queueSize}
              </p>
            </div>
            <MessageSquare className="w-8 h-8" style={{ color: 'var(--oneui-warning)' }} />
          </div>
        </div>

        <div className="oneui-card">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm oneui-text-muted mb-1">DB Connections</p>
              <p className="text-2xl font-bold" style={{ color: 'var(--oneui-text)' }}>
                {systemMetrics.dbConnections}
              </p>
            </div>
            <Wifi className="w-8 h-8" style={{ color: 'var(--oneui-info)' }} />
          </div>
        </div>
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Services.tsx ------------------------------
import { useState, useEffect } from 'react';
import { api, Service } from '../../api';
import { Server, Play, Pause, RotateCw, AlertCircle } from 'lucide-react';

export const Services = () => {
  const [services, setServices] = useState<Service[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadServices();
    const interval = setInterval(loadServices, 10000); // Refresh every 10 seconds
    return () => clearInterval(interval);
  }, []);

  const loadServices = async () => {
    try {
      const data = await api.getServices();
      setServices(data);
    } catch (error) {
      console.error('Error loading services:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleServiceAction = async (id: string, action: 'start' | 'stop' | 'restart') => {
    try {
      await api.serviceAction(id, action);
      // Reload services to get updated status
      await loadServices();
    } catch (error: any) {
      console.error('Error performing service action:', error);
      alert(`Failed to ${action} service: ${error.message || error}`);
    }
  };

  const runningCount = services.filter(s => s.status === 'running').length;
  const stoppedCount = services.filter(s => s.status === 'stopped').length;

  if (loading) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="oneui-spinner"></div>
      </div>
    );
  }

  return (
      <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          Service Management
        </h1>
        <p className="oneui-text-muted">Control and monitor bot services</p>
      </div>

      {/* Summary Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        {[
          { label: 'Total Services', value: services.length, color: 'oneui-text-primary' },
          { label: 'Running', value: runningCount, color: 'oneui-text-success' },
          { label: 'Stopped', value: stoppedCount, color: 'oneui-text-danger' },
          { label: 'Health', value: '98%', color: 'oneui-text-primary' },
        ].map((stat) => (
          <div key={stat.label} className="oneui-card">
            <p className="text-sm oneui-text-muted mb-1">{stat.label}</p>
            <p className={`text-2xl font-bold ${stat.color}`}>{stat.value}</p>
          </div>
        ))}
      </div>

      {/* Services List */}
      <div className="space-y-4">
        {services.map((service) => (
          <div key={service.id} className="oneui-card">
            <div className="flex items-start justify-between gap-4">
              <div className="flex items-start gap-4 flex-1">
                <div className="oneui-stat-icon oneui-stat-icon-primary">
                  <Server className="w-6 h-6" />
                </div>
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2">
                    <h3 className="text-lg font-bold" style={{ color: 'var(--oneui-text)' }}>
                      {service.name}
                    </h3>
                    <span className={`oneui-badge ${
                      service.status === 'running' ? 'oneui-badge-success' :
                      service.status === 'stopped' ? 'oneui-badge-danger' :
                      'oneui-badge-warning'
                    }`}>
                      {service.status}
                    </span>
                  </div>
                  <p className="oneui-text-muted text-sm mb-3">{service.description}</p>
                  <div className="flex gap-6 text-sm">
                    <div>
                      <span className="oneui-text-muted">Uptime: </span>
                      <span className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                        {service.uptime}
                      </span>
                    </div>
                    <div>
                      <span className="oneui-text-muted">Memory: </span>
                      <span className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                        {service.memory}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <div className="flex gap-2">
                {service.status === 'stopped' ? (
                  <button
                    onClick={() => handleServiceAction(service.id, 'start')}
                    className="oneui-btn oneui-btn-primary"
                    style={{ padding: '0.5rem' }}
                  >
                    <Play className="w-4 h-4" />
                  </button>
                ) : (
                  <button
                    onClick={() => handleServiceAction(service.id, 'stop')}
                    className="oneui-btn oneui-btn-secondary"
                    style={{ padding: '0.5rem' }}
                    disabled={service.status === 'restarting'}
                  >
                    <Pause className="w-4 h-4" />
                  </button>
                )}
                <button
                  onClick={() => handleServiceAction(service.id, 'restart')}
                  className="oneui-btn oneui-btn-secondary"
                  style={{ padding: '0.5rem' }}
                  disabled={service.status === 'stopped' || service.status === 'restarting'}
                >
                  <RotateCw className={`w-4 h-4 ${service.status === 'restarting' ? 'animate-spin' : ''}`} />
                </button>
              </div>
            </div>
          </div>
        ))}
      </div>

      {/* Warning */}
      <div className="oneui-card mt-6 border-l-4" style={{ borderLeftColor: 'var(--oneui-warning)' }}>
        <div className="flex items-start gap-3">
          <AlertCircle className="w-6 h-6 text-orange-500 flex-shrink-0 mt-1" />
          <div>
            <h3 className="text-lg font-bold mb-2" style={{ color: 'var(--oneui-warning)' }}>
              Warning
            </h3>
            <p className="oneui-text-muted">
              Stopping critical services may affect bot functionality. Always ensure proper backups
              before making changes to production services.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/sections/ModulesHub.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, BotModule } from '../../api';
import { useI18n } from '../../contexts/I18nContext';
import { Box, Settings, ExternalLink, CheckCircle2, XCircle, AlertCircle } from 'lucide-react';

export const ModulesHub = () => {
  const { t } = useI18n();
  const [modules, setModules] = useState<BotModule[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadModules();
  }, []);

  const loadModules = async () => {
    try {
      // Load only user plugins (exclude system modules)
      const data = await api.getModules(false);
      // Filter out system modules on frontend as well (double check)
      const userModules = (data || []).filter(m => !m.is_system_module);
      setModules(userModules);
    } catch (error) {
      console.error('Error loading modules:', error);
      setModules([]);
    } finally {
      setLoading(false);
    }
  };

  const getModuleStatus = (module: BotModule) => {
    if (module.status === 'active') {
      return { label: t('modulesHub.active'), color: 'oneui-badge-success', icon: CheckCircle2 };
    }
    return { label: t('modulesHub.notConfigured'), color: 'oneui-badge-warning', icon: AlertCircle };
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="oneui-spinner"></div>
      </div>
    );
  }

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('modulesHub.title')}
        </h1>
        <p className="oneui-text-muted">{t('modulesHub.subtitle')}</p>
      </div>

      {/* Modules Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {modules.map((module) => {
          const status = getModuleStatus(module);
          const StatusIcon = status.icon;
          const isActive = module.status === 'active';

          return (
            <div key={module.name} className="oneui-card hover:shadow-lg transition-all">
              <div className="flex items-start justify-between mb-4">
                <div className="flex items-center gap-3">
                  <div className={`oneui-stat-icon ${isActive ? 'oneui-stat-icon-primary' : 'oneui-stat-icon-warning'}`}>
                    <Box className="w-6 h-6" />
                  </div>
                  <div>
                    <h3 className="font-semibold text-lg mb-1" style={{ color: 'var(--oneui-text)' }}>
                      {module.display_name || module.name}
                    </h3>
                    <span className={`oneui-badge ${status.color} flex items-center gap-1 w-fit`}>
                      <StatusIcon className="w-3 h-3" />
                      {status.label}
                    </span>
                  </div>
                </div>
              </div>

              <p className="text-sm oneui-text-muted mb-4 line-clamp-2">
                {module.description || 'No description available'}
              </p>

              <div className="flex gap-2">
                {isActive ? (
                  <button className="oneui-btn oneui-btn-primary flex-1 flex items-center justify-center gap-2">
                    <ExternalLink className="w-4 h-4" />
                    {t('modulesHub.open')}
                  </button>
                ) : (
                  <button className="oneui-btn oneui-btn-secondary flex-1 flex items-center justify-center gap-2">
                    <Settings className="w-4 h-4" />
                    {t('modulesHub.configure')}
                  </button>
                )}
              </div>
            </div>
          );
        })}
      </div>

      {modules.length === 0 && (
        <div className="oneui-card text-center py-12">
          <Box className="w-16 h-16 mx-auto mb-4 oneui-text-muted opacity-50" />
          <h3 className="text-xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
            {t('modulesHub.noModules')}
          </h3>
          <p className="text-sm oneui-text-muted max-w-md mx-auto mt-2">
            {t('modulesHub.noModulesDesc')}
          </p>
        </div>
      )}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Users.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, BotUser } from '../../api';
import { useAuth } from '../../contexts/AuthContext';
import { useI18n } from '../../contexts/I18nContext';
import { User, Shield, Ban, CheckCircle2, XCircle, Loader2, MoreVertical } from 'lucide-react';

export const Users = () => {
  const { isAdmin } = useAuth();
  const { t } = useI18n();
  const [users, setUsers] = useState<BotUser[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [busyUserIds, setBusyUserIds] = useState<number[]>([]);
  const [message, setMessage] = useState<string | null>(null);

  useEffect(() => {
    loadUsers();
  }, []);

  const loadUsers = async () => {
    try {
      const data = await api.getUsers();
      setUsers(data || []);
    } catch (error) {
      console.error('Error loading users:', error);
      setError(t('users.errorToggle'));
    } finally {
      setLoading(false);
    }
  };

  const toggleBlockStatus = async (userId: number, currentStatus: boolean) => {
    if (!isAdmin) return;
    setBusyUserIds(prev => [...prev, userId]);
    setError(null);
    setMessage(null);
    try {
      await api.toggleUserBlockStatus(userId, !currentStatus);
      setUsers(prev => prev.map(u => (u.id === userId ? { ...u, is_blocked: !currentStatus } : u)));
      setMessage(!currentStatus 
        ? t('users.userBlocked', { id: userId })
        : t('users.userUnblocked', { id: userId })
      );
      setTimeout(() => setMessage(null), 5000);
    } catch (error) {
      console.error('Error toggling block status:', error);
      setError(t('users.errorToggle'));
      setTimeout(() => setError(null), 5000);
    } finally {
      setBusyUserIds(prev => prev.filter(id => id !== userId));
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="oneui-spinner"></div>
      </div>
    );
  }

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('users.title')}
        </h1>
        <p className="oneui-text-muted">{t('users.subtitle')}</p>
      </div>

      {/* Messages */}
      {error && (
        <div className="oneui-card mb-6 border-l-4" style={{ borderLeftColor: 'var(--oneui-danger)' }}>
          <div className="flex items-center gap-3 text-red-600 dark:text-red-400">
            <XCircle className="w-5 h-5" />
            <p className="font-medium">{error}</p>
          </div>
        </div>
      )}
      {message && (
        <div className="oneui-card mb-6 border-l-4" style={{ borderLeftColor: 'var(--oneui-success)' }}>
          <div className="flex items-center gap-3 text-green-600 dark:text-green-400">
            <CheckCircle2 className="w-5 h-5" />
            <p className="font-medium">{message}</p>
          </div>
        </div>
      )}

      {/* Users Table */}
      <div className="oneui-card">
        <div className="overflow-x-auto -mx-1.5 sm:mx-0">
          <table className="oneui-table min-w-full">
            <thead>
              <tr>
                <th>{t('users.userId')}</th>
                <th>Username</th>
                <th>{t('users.role')}</th>
                <th>{t('common.status')}</th>
                {isAdmin && <th>{t('common.actions')}</th>}
              </tr>
            </thead>
            <tbody>
              {users.map((user) => {
                const isBlocked = (user as never)['is_blocked'] || false;
                const roleColor = user.role === 'admin' ? 'oneui-badge-danger' : 
                                 user.role === 'moderator' ? 'oneui-badge-warning' : 
                                 'oneui-badge-info';

                return (
                  <tr key={user.id}>
                    <td>
                      <span className="font-mono font-semibold">#{user.id}</span>
                    </td>
                    <td>
                      <div className="flex items-center gap-2 sm:gap-3">
                        <div className="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs sm:text-sm font-semibold flex-shrink-0">
                          {user.username?.[0]?.toUpperCase() || 'U'}
      </div>
                        <div className="min-w-0 flex-1">
                          <div className="font-medium truncate" style={{ color: 'var(--oneui-text)' }}>
                            {user.username || `User ${user.id}`}
                </div>
                  {user.username && (
                            <div className="text-xs oneui-text-muted truncate">@{user.username}</div>
                  )}
                </div>
              </div>
                    </td>
                    <td>
              {user.role && (
                        <span className={`oneui-badge ${roleColor}`}>
                          {user.role.toUpperCase()}
                        </span>
                      )}
                    </td>
                    <td>
                      <span className={`oneui-badge ${isBlocked ? 'oneui-badge-danger' : 'oneui-badge-success'}`}>
                        {isBlocked ? t('common.inactive') : t('common.active')}
                      </span>
                    </td>
              {isAdmin && (
                      <td>
                        <button
                          onClick={() => toggleBlockStatus(user.id, isBlocked)}
                  disabled={busyUserIds.includes(user.id)}
                          className={`oneui-btn ${isBlocked ? 'oneui-btn-primary' : 'oneui-btn-secondary'} flex items-center gap-1 sm:gap-2`}
                          style={{ padding: '0.375rem 0.5rem', fontSize: '0.75rem' }}
              >
                          {busyUserIds.includes(user.id) ? (
                            <Loader2 className="w-3 h-3 sm:w-4 sm:h-4 animate-spin" />
                          ) : isBlocked ? (
                            <>
                              <CheckCircle2 className="w-3 h-3 sm:w-4 sm:h-4" />
                              <span className="hidden sm:inline">{t('users.unblockUser')}</span>
                            </>
                          ) : (
                            <>
                              <Ban className="w-3 h-3 sm:w-4 sm:h-4" />
                              <span className="hidden sm:inline">{t('users.blockUser')}</span>
                            </>
                          )}
                        </button>
                      </td>
            )}
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      </div>

      {users.length === 0 && (
        <div className="oneui-card text-center py-12">
          <User className="w-16 h-16 mx-auto mb-4 oneui-text-muted opacity-50" />
          <h3 className="text-xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
            {t('users.noUsers')}
          </h3>
          <p className="oneui-text-muted">{t('users.noUsersDesc')}</p>
        </div>
      )}
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Logs.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, BotLog } from '../../api';
import { GlassCard } from '../ui/GlassCard';
import { AlertCircle, CheckCircle, Info, AlertTriangle } from 'lucide-react';

export const Logs = () => {
  const [logs, setLogs] = useState<BotLog[]>([]);
  const [loading, setLoading] = useState(true);
  const [filter, setFilter] = useState<string>('all');

  useEffect(() => {
    loadLogs();
    // Set up polling for live updates
    const interval = setInterval(() => {
      loadLogs();
    }, 5000); // Update every 5 seconds
    
    return () => clearInterval(interval);
  }, [filter]);

  const loadLogs = async () => {
    try {
      const data = await api.streamLogs(100, filter === 'all' ? undefined : filter);
      setLogs(data || []);
    } catch (error) {
      console.error('Error loading logs:', error);
    } finally {
      setLoading(false);
    }
  };

  const getLogIcon = (level: string) => {
    switch (level) {
      case 'success':
        return CheckCircle;
      case 'error':
        return AlertCircle;
      case 'warning':
        return AlertTriangle;
      default:
        return Info;
    }
  };

  const getLogColor = (level: string) => {
    switch (level) {
      case 'success':
        return 'text-green-400 bg-green-500/10 border-green-500/30';
      case 'error':
        return 'text-red-400 bg-red-500/10 border-red-500/30';
      case 'warning':
        return 'text-yellow-400 bg-yellow-500/10 border-yellow-500/30';
      default:
        return 'text-blue-400 bg-blue-500/10 border-blue-500/30';
    }
  };

  const formatDate = (date: string) => {
    try {
      return new Date(date).toLocaleString('en-US', {
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
      });
    } catch {
      return date;
    }
  };

  const filters = [
    { value: 'all', label: 'All Logs' },
    { value: 'info', label: 'Info' },
    { value: 'success', label: 'Success' },
    { value: 'warning', label: 'Warning' },
    { value: 'error', label: 'Error' },
  ];

  if (loading) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="loading-spinner"></div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between flex-wrap gap-4">
        <div>
          <h2 className="text-3xl font-bold text-glass-text mb-2">System Logs</h2>
          <p className="text-glass-text-secondary">Real-time system activity and events</p>
        </div>
        <div className="flex gap-2">
          {filters.map((f) => (
            <button
              key={f.value}
              onClick={() => setFilter(f.value)}
              className={`
                px-4 py-2 rounded-lg text-sm font-medium transition-all
                ${filter === f.value
                  ? 'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30'
                  : 'bg-white/5 text-glass-text-secondary hover:bg-white/10'
                }
              `}
            >
              {f.label}
            </button>
          ))}
        </div>
      </div>

      <GlassCard className="p-6" glow>
        <div className="space-y-2">
          {logs.map((log, index) => {
            const Icon = getLogIcon(log.level);
            const colorClass = getLogColor(log.level);

            return (
              <div
                key={index}
                className="flex items-start gap-4 p-4 rounded-lg bg-white/5 hover:bg-white/10 transition-colors"
              >
                <div className={`p-2 rounded-lg ${colorClass}`}>
                  <Icon className="w-5 h-5" />
                </div>
                <div className="flex-1 min-w-0">
                  <div className="flex items-start justify-between gap-2 mb-1">
                    <p className="text-glass-text font-medium">{log.message}</p>
                    <span className="text-xs text-glass-text-secondary whitespace-nowrap">
                      {formatDate(log.timestamp)}
                    </span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className={`text-xs px-2 py-1 rounded-md capitalize ${colorClass}`}>
                      {log.level}
                    </span>
                  </div>
                </div>
              </div>
            );
          })}
        </div>

        {logs.length === 0 && (
          <div className="text-center py-12">
            <Info className="w-16 h-16 mx-auto mb-4 text-glass-text-secondary" />
            <h3 className="text-xl font-bold text-glass-text mb-2">No logs found</h3>
            <p className="text-glass-text-secondary">
              {filter === 'all' ? 'No logs available' : `No ${filter} logs found`}
            </p>
          </div>
        )}
      </GlassCard>
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/components/sections/SecurityOperations.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { api, AuditLog, AuditStats, ApiKey } from '../../api';
import { Shield, AlertTriangle, Activity, Key, Filter, RefreshCw, Search } from 'lucide-react';

export const SecurityOperations = () => {
  const { t } = useI18n();
  const [activeTab, setActiveTab] = useState<'audit' | 'access' | 'stats'>('audit');
  const [auditLogs, setAuditLogs] = useState<AuditLog[]>([]);
  const [auditStats, setAuditStats] = useState<AuditStats | null>(null);
  const [apiKeys, setApiKeys] = useState<ApiKey[]>([]);
  const [loading, setLoading] = useState(true);
  const [filters, setFilters] = useState({
    module_name: '',
    event_type: '',
    severity: '',
  });

  useEffect(() => {
    if (activeTab === 'audit') {
      loadAuditLogs();
    } else if (activeTab === 'access') {
      loadApiKeys();
    } else if (activeTab === 'stats') {
      loadAuditStats();
    }
  }, [activeTab, filters]);

  const loadAuditLogs = async () => {
    try {
      setLoading(true);
      const params: any = { limit: 100 };
      if (filters.module_name) params.module_name = filters.module_name;
      if (filters.event_type) params.event_type = filters.event_type;
      if (filters.severity) params.severity = filters.severity;
      const data = await api.getAuditLogs(params);
      setAuditLogs(data || []);
    } catch (error) {
      console.error('Error loading audit logs:', error);
    } finally {
      setLoading(false);
    }
  };

  const loadAuditStats = async () => {
    try {
      setLoading(true);
      const data = await api.getAuditStats();
      setAuditStats(data);
    } catch (error) {
      console.error('Error loading audit stats:', error);
    } finally {
      setLoading(false);
    }
  };

  const loadApiKeys = async () => {
    try {
      setLoading(true);
      const data = await api.getApiKeys();
      setApiKeys(data || []);
    } catch (error) {
      console.error('Error loading API keys:', error);
    } finally {
      setLoading(false);
    }
  };

  const getSeverityColor = (severity: string) => {
    switch (severity) {
      case 'critical':
        return 'oneui-badge-danger';
      case 'high':
        return 'oneui-badge-warning';
      case 'medium':
        return 'oneui-badge-info';
      case 'low':
        return 'oneui-badge-success';
      default:
        return 'oneui-badge-secondary';
    }
  };

  const formatTimestamp = (timestamp: number) => {
    try {
      return new Date(timestamp * 1000).toLocaleString();
    } catch {
      return 'N/A';
    }
  };

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('soc.title') || 'Security Operations Center'}
        </h1>
        <p className="oneui-text-muted">
          {t('soc.subtitle') || 'Monitor and manage security events, access control, and threats'}
        </p>
      </div>

      {/* Tabs */}
      <div className="flex gap-2 mb-6 border-b" style={{ borderColor: 'var(--oneui-border)' }}>
        {[
          { id: 'audit', label: t('soc.auditLogs') || 'Audit Logs', icon: Shield },
          { id: 'access', label: t('soc.accessControl') || 'Access Control', icon: Key },
          { id: 'stats', label: t('soc.statistics') || 'Statistics', icon: Activity },
        ].map((tab) => {
          const Icon = tab.icon;
          return (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id as any)}
              className={`px-4 py-2 flex items-center gap-2 border-b-2 transition-colors ${
                activeTab === tab.id
                  ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400'
                  : 'border-transparent oneui-text-muted hover:text-indigo-600 dark:hover:text-indigo-400'
              }`}
            >
              <Icon className="w-4 h-4" />
              <span className="font-medium">{tab.label}</span>
            </button>
          );
        })}
      </div>

      {/* Audit Logs */}
      {activeTab === 'audit' && (
        <div className="space-y-4">
          {/* Filters */}
          <div className="oneui-card">
            <div className="oneui-card-header">
              <div className="flex items-center gap-3">
                <Filter className="w-5 h-5" />
                <h3 className="oneui-card-title">{t('soc.filters') || 'Filters'}</h3>
              </div>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('soc.moduleName') || 'Module Name'}
                </label>
                <input
                  type="text"
                  value={filters.module_name}
                  onChange={(e) => setFilters({ ...filters, module_name: e.target.value })}
                  placeholder={t('soc.filterByModule') || 'Filter by module...'}
                  className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('soc.eventType') || 'Event Type'}
                </label>
                <select
                  value={filters.event_type}
                  onChange={(e) => setFilters({ ...filters, event_type: e.target.value })}
                  className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                >
                  <option value="">{t('soc.allTypes') || 'All Types'}</option>
                  <option value="module_load">Module Load</option>
                  <option value="command_execution">Command Execution</option>
                  <option value="database_access">Database Access</option>
                  <option value="security_violation">Security Violation</option>
                  <option value="admin_function_access">Admin Function Access</option>
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('soc.severity') || 'Severity'}
                </label>
                <select
                  value={filters.severity}
                  onChange={(e) => setFilters({ ...filters, severity: e.target.value })}
                  className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                >
                  <option value="">{t('soc.allSeverities') || 'All Severities'}</option>
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                  <option value="critical">Critical</option>
                </select>
              </div>
            </div>
            <div className="mt-4">
              <button
                onClick={loadAuditLogs}
                className="oneui-btn oneui-btn-primary flex items-center gap-2"
              >
                <RefreshCw className="w-4 h-4" />
                {t('common.refresh') || 'Refresh'}
              </button>
            </div>
          </div>

          {/* Logs Table */}
          <div className="oneui-card">
            {loading ? (
              <div className="flex items-center justify-center py-8">
                <div className="oneui-spinner"></div>
              </div>
            ) : auditLogs.length === 0 ? (
              <div className="text-center py-12">
                <Shield className="w-16 h-16 mx-auto mb-4 oneui-text-muted" />
                <h3 className="text-xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('soc.noLogs') || 'No audit logs found'}
                </h3>
                <p className="oneui-text-muted">
                  {t('soc.noLogsDesc') || 'No security events match your filters.'}
                </p>
              </div>
            ) : (
              <div className="overflow-x-auto">
                <table className="oneui-table min-w-full">
                  <thead>
                    <tr>
                      <th>{t('soc.timestamp') || 'Timestamp'}</th>
                      <th>{t('soc.eventType') || 'Event Type'}</th>
                      <th>{t('soc.module') || 'Module'}</th>
                      <th>{t('soc.severity') || 'Severity'}</th>
                      <th>{t('soc.user') || 'User'}</th>
                      <th>{t('soc.ip') || 'IP Address'}</th>
                      <th>{t('soc.status') || 'Status'}</th>
                    </tr>
                  </thead>
                  <tbody>
                    {auditLogs.map((log) => (
                      <tr key={log.event_id}>
                        <td className="oneui-text-muted text-sm">
                          {formatTimestamp(log.timestamp)}
                        </td>
                        <td>
                          <code className="text-sm font-mono" style={{ color: 'var(--oneui-text)' }}>
                            {log.event_type}
                          </code>
                        </td>
                        <td className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                          {log.module_name}
                        </td>
                        <td>
                          <span className={`oneui-badge ${getSeverityColor(log.severity)}`}>
                            {log.severity}
                          </span>
                        </td>
                        <td className="oneui-text-muted">
                          {log.user_id ? `#${log.user_id}` : '-'}
                        </td>
                        <td className="oneui-text-muted font-mono text-sm">
                          {log.ip_address || '-'}
                        </td>
                        <td>
                          {log.success ? (
                            <span className="oneui-badge oneui-badge-success">
                              {t('common.success') || 'Success'}
                            </span>
                          ) : (
                            <span className="oneui-badge oneui-badge-danger">
                              {t('common.error') || 'Error'}
                            </span>
                          )}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Access Control */}
      {activeTab === 'access' && (
        <div className="oneui-card">
          <div className="oneui-card-header">
            <div className="flex items-center justify-between w-full">
              <div className="flex items-center gap-3">
                <div className="oneui-stat-icon oneui-stat-icon-primary">
                  <Key className="w-5 h-5" />
                </div>
                <h3 className="oneui-card-title">
                  {t('soc.apiKeys') || 'API Keys'}
                </h3>
              </div>
              <button
                onClick={loadApiKeys}
                className="oneui-btn oneui-btn-secondary text-sm flex items-center gap-2"
              >
                <RefreshCw className="w-4 h-4" />
                {t('common.refresh') || 'Refresh'}
              </button>
            </div>
          </div>

          {loading ? (
            <div className="flex items-center justify-center py-8">
              <div className="oneui-spinner"></div>
            </div>
          ) : apiKeys.length === 0 ? (
            <div className="text-center py-12">
              <Key className="w-16 h-16 mx-auto mb-4 oneui-text-muted" />
              <h3 className="text-xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
                {t('soc.noApiKeys') || 'No API keys'}
              </h3>
              <p className="oneui-text-muted">
                {t('soc.noApiKeysDesc') || 'No API keys are configured. Use CLI to create keys.'}
              </p>
            </div>
          ) : (
            <div className="overflow-x-auto">
              <table className="oneui-table min-w-full">
                <thead>
                  <tr>
                    <th>{t('soc.keyName') || 'Key Name'}</th>
                    <th>{t('soc.permissions') || 'Permissions'}</th>
                    <th>{t('soc.created') || 'Created'}</th>
                    <th>{t('soc.expires') || 'Expires'}</th>
                    <th>{t('soc.lastUsed') || 'Last Used'}</th>
                    <th>{t('soc.usageCount') || 'Usage Count'}</th>
                  </tr>
                </thead>
                <tbody>
                  {apiKeys.map((key) => (
                    <tr key={key.name}>
                      <td className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                        {key.name}
                      </td>
                      <td>
                        <span className="oneui-badge oneui-badge-info">
                          {key.permissions}
                        </span>
                      </td>
                      <td className="oneui-text-muted">
                        {key.created_at ? new Date(key.created_at).toLocaleDateString() : '-'}
                      </td>
                      <td className="oneui-text-muted">
                        {key.expires_at ? new Date(key.expires_at).toLocaleDateString() : t('common.never') || 'Never'}
                      </td>
                      <td className="oneui-text-muted">
                        {key.last_used ? new Date(key.last_used).toLocaleString() : t('common.never') || 'Never'}
                      </td>
                      <td className="oneui-text-muted">
                        {key.usage_count || 0}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      )}

      {/* Statistics */}
      {activeTab === 'stats' && (
        <div className="space-y-6">
          {loading ? (
            <div className="flex items-center justify-center py-8">
              <div className="oneui-spinner"></div>
            </div>
          ) : auditStats ? (
            <>
              {/* Overview Cards */}
              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div className="oneui-card">
                  <div className="oneui-card-header">
                    <h3 className="oneui-card-title">{t('soc.totalEvents') || 'Total Events'}</h3>
                  </div>
                  <div className="text-3xl font-bold" style={{ color: 'var(--oneui-text)' }}>
                    {auditStats.total_events || 0}
                  </div>
                </div>
                <div className="oneui-card">
                  <div className="oneui-card-header">
                    <h3 className="oneui-card-title">{t('soc.violations') || 'Violations'}</h3>
                  </div>
                  <div className="text-3xl font-bold" style={{ color: 'var(--oneui-danger)' }}>
                    {auditStats.violations_count || 0}
                  </div>
                </div>
                <div className="oneui-card">
                  <div className="oneui-card-header">
                    <h3 className="oneui-card-title">{t('soc.eventTypes') || 'Event Types'}</h3>
                  </div>
                  <div className="text-3xl font-bold" style={{ color: 'var(--oneui-text)' }}>
                    {Object.keys(auditStats.events_by_type || {}).length}
                  </div>
                </div>
                <div className="oneui-card">
                  <div className="oneui-card-header">
                    <h3 className="oneui-card-title">{t('soc.modules') || 'Modules'}</h3>
                  </div>
                  <div className="text-3xl font-bold" style={{ color: 'var(--oneui-text)' }}>
                    {Object.keys(auditStats.events_by_module || {}).length}
                  </div>
                </div>
              </div>

              {/* Events by Type */}
              <div className="oneui-card">
                <div className="oneui-card-header">
                  <h3 className="oneui-card-title">{t('soc.eventsByType') || 'Events by Type'}</h3>
                </div>
                <div className="overflow-x-auto">
                  <table className="oneui-table min-w-full">
                    <thead>
                      <tr>
                        <th>{t('soc.eventType') || 'Event Type'}</th>
                        <th>{t('soc.count') || 'Count'}</th>
                      </tr>
                    </thead>
                    <tbody>
                      {Object.entries(auditStats.events_by_type || {}).map(([type, count]) => (
                        <tr key={type}>
                          <td className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                            <code className="text-sm font-mono">{type}</code>
                          </td>
                          <td className="oneui-text-muted">{count as number}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>

              {/* Events by Severity */}
              <div className="oneui-card">
                <div className="oneui-card-header">
                  <h3 className="oneui-card-title">{t('soc.eventsBySeverity') || 'Events by Severity'}</h3>
                </div>
                <div className="overflow-x-auto">
                  <table className="oneui-table min-w-full">
                    <thead>
                      <tr>
                        <th>{t('soc.severity') || 'Severity'}</th>
                        <th>{t('soc.count') || 'Count'}</th>
                      </tr>
                    </thead>
                    <tbody>
                      {Object.entries(auditStats.events_by_severity || {}).map(([severity, count]) => (
                        <tr key={severity}>
                          <td>
                            <span className={`oneui-badge ${getSeverityColor(severity)}`}>
                              {severity}
                            </span>
                          </td>
                          <td className="oneui-text-muted">{count as number}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            </>
          ) : (
            <div className="text-center py-12">
              <Activity className="w-16 h-16 mx-auto mb-4 oneui-text-muted" />
              <h3 className="text-xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
                {t('soc.noStats') || 'No statistics available'}
              </h3>
            </div>
          )}
        </div>
      )}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/BroadcastStudio.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { api, Broadcast, BroadcastProgress } from '../../api';
import { Send, Clock, Users, Filter, History, Play, Calendar, AlertCircle, CheckCircle2, XCircle } from 'lucide-react';

export const BroadcastStudio = () => {
  const { t } = useI18n();
  const [activeTab, setActiveTab] = useState<'create' | 'history'>('create');
  const [message, setMessage] = useState('');
  const [targetType, setTargetType] = useState<'all' | 'admins' | 'active' | 'language'>('all');
  const [targetValue, setTargetValue] = useState<string>('');
  const [scheduleTime, setScheduleTime] = useState<string>('');
  const [sending, setSending] = useState(false);
  const [broadcasts, setBroadcasts] = useState<Broadcast[]>([]);
  const [loading, setLoading] = useState(false);
  const [activeBroadcastId, setActiveBroadcastId] = useState<string | null>(null);
  const [progress, setProgress] = useState<BroadcastProgress | null>(null);

  useEffect(() => {
    if (activeTab === 'history') {
      loadBroadcasts();
    }
  }, [activeTab]);

  useEffect(() => {
    if (activeBroadcastId) {
      const interval = setInterval(async () => {
        try {
          const prog = await api.getBroadcastProgress(activeBroadcastId);
          setProgress(prog);
          if (prog.status === 'completed' || prog.status === 'failed') {
            setActiveBroadcastId(null);
            clearInterval(interval);
            await loadBroadcasts();
          }
        } catch (error) {
          console.error('Error loading progress:', error);
        }
      }, 2000);
      return () => clearInterval(interval);
    }
  }, [activeBroadcastId]);

  const loadBroadcasts = async () => {
    try {
      setLoading(true);
      const data = await api.getBroadcasts();
      setBroadcasts(data || []);
    } catch (error) {
      console.error('Error loading broadcasts:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleSend = async () => {
    if (!message.trim()) {
      alert(t('broadcast.messageRequired') || 'Message is required');
      return;
    }

    if ((targetType === 'active' || targetType === 'inactive' || targetType === 'new_users') && !targetValue) {
      alert(t('broadcast.daysRequired') || 'Number of days is required');
      return;
    }

    if (targetType === 'language' && !targetValue) {
      alert(t('broadcast.languageRequired') || 'Language code is required');
      return;
    }

    if (targetType === 'role' && !targetValue) {
      alert(t('broadcast.roleRequired') || 'Role is required');
      return;
    }

    if (targetType === 'active_status' && !targetValue) {
      alert(t('broadcast.activeStatusRequired') || 'Active status is required');
      return;
    }

    try {
      setSending(true);
      const broadcast = await api.createBroadcast({
        message: message.trim(),
        target_type: targetType,
        target_value: (targetType === 'active' || targetType === 'inactive' || targetType === 'new_users') 
          ? parseInt(targetValue) 
          : targetValue || undefined,
        schedule_time: scheduleTime || null,
      });
      
      setBroadcasts([broadcast, ...broadcasts]);
      setMessage('');
      setTargetType('all');
      setTargetValue('');
      setScheduleTime('');
      
      // Show result message
      if (broadcast.status === 'completed') {
        alert(`${t('broadcast.broadcastCreated') || 'Broadcast created successfully'}\n${broadcast.sent_count || 0} messages sent successfully.`);
      } else if (broadcast.status === 'completed_with_errors') {
        alert(`${t('broadcast.broadcastCreated') || 'Broadcast created successfully'}\n${broadcast.sent_count || 0} messages sent, ${broadcast.error_count || 0} errors.`);
      } else if (broadcast.status === 'queued') {
        alert(`${t('broadcast.broadcastCreated') || 'Broadcast created successfully'}\nBroadcast scheduled for ${new Date(broadcast.schedule_time || '').toLocaleString()}.`);
      } else {
        alert(broadcast.note || t('broadcast.broadcastCreated') || 'Broadcast created successfully');
      }
    } catch (error: any) {
      alert(`Failed to create broadcast: ${error.message || error}`);
    } finally {
      setSending(false);
    }
  };

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'completed':
        return CheckCircle2;
      case 'failed':
        return XCircle;
      case 'sending':
        return Clock;
      default:
        return AlertCircle;
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'completed':
        return 'oneui-badge-success';
      case 'failed':
        return 'oneui-badge-danger';
      case 'sending':
        return 'oneui-badge-warning';
      default:
        return 'oneui-badge-secondary';
    }
  };

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('broadcast.title') || 'Broadcast Studio'}
        </h1>
        <p className="oneui-text-muted">
          {t('broadcast.subtitle') || 'Create and send messages to users'}
        </p>
      </div>

      {/* Tabs */}
      <div className="flex gap-2 mb-6 border-b" style={{ borderColor: 'var(--oneui-border)' }}>
        {[
          { id: 'create', label: t('broadcast.create') || 'Create Broadcast', icon: Send },
          { id: 'history', label: t('broadcast.history') || 'History', icon: History },
        ].map((tab) => {
          const Icon = tab.icon;
          return (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id as any)}
              className={`px-4 py-2 flex items-center gap-2 border-b-2 transition-colors ${
                activeTab === tab.id
                  ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400'
                  : 'border-transparent oneui-text-muted hover:text-indigo-600 dark:hover:text-indigo-400'
              }`}
            >
              <Icon className="w-4 h-4" />
              <span className="font-medium">{tab.label}</span>
            </button>
          );
        })}
      </div>

      {/* Create Broadcast */}
      {activeTab === 'create' && (
        <div className="space-y-6">
          {/* Message Editor */}
          <div className="oneui-card">
            <div className="oneui-card-header">
              <div className="flex items-center gap-3">
                <div className="oneui-stat-icon oneui-stat-icon-primary">
                  <Send className="w-5 h-5" />
                </div>
                <h3 className="oneui-card-title">{t('broadcast.messageEditor') || 'Message Editor'}</h3>
              </div>
            </div>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('broadcast.message') || 'Message'}
                </label>
                <textarea
                  value={message}
                  onChange={(e) => setMessage(e.target.value)}
                  rows={8}
                  className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                  placeholder={t('broadcast.messagePlaceholder') || 'Enter your message here...'}
                />
                <p className="text-xs oneui-text-muted mt-1">
                  {t('broadcast.messageNote') || 'Supports Markdown formatting. Use /help for formatting guide.'}
                </p>
              </div>
            </div>
          </div>

          {/* Targeting */}
          <div className="oneui-card">
            <div className="oneui-card-header">
              <div className="flex items-center gap-3">
                <div className="oneui-stat-icon oneui-stat-icon-primary">
                  <Filter className="w-5 h-5" />
                </div>
                <h3 className="oneui-card-title">{t('broadcast.targeting') || 'Targeting'}</h3>
              </div>
            </div>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('broadcast.targetType') || 'Target Type'}
                </label>
                <select
                  value={targetType}
                  onChange={(e) => {
                    setTargetType(e.target.value as any);
                    setTargetValue('');
                  }}
                  className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                >
                  <option value="all">{t('broadcast.targetAll') || 'All Users'}</option>
                  <option value="admins">{t('broadcast.targetAdmins') || 'Administrators Only'}</option>
                  <option value="role">{t('broadcast.targetRole') || 'By Role'}</option>
                  <option value="active">{t('broadcast.targetActive') || 'Active Users (Last N days)'}</option>
                  <option value="inactive">{t('broadcast.targetInactive') || 'Inactive Users (No activity for N days)'}</option>
                  <option value="new_users">{t('broadcast.targetNewUsers') || 'New Users (Registered in last N days)'}</option>
                  <option value="language">{t('broadcast.targetLanguage') || 'By Language'}</option>
                  <option value="active_status">{t('broadcast.targetActiveStatus') || 'By Active Status'}</option>
                </select>
              </div>

              {targetType === 'role' && (
                <div>
                  <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                    {t('broadcast.role') || 'Role'}
                  </label>
                  <select
                    value={targetValue}
                    onChange={(e) => setTargetValue(e.target.value)}
                    className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    style={{
                      backgroundColor: 'var(--oneui-bg-alt)',
                      borderColor: 'var(--oneui-border)',
                      color: 'var(--oneui-text)',
                    }}
                  >
                    <option value="">{t('broadcast.selectRole') || 'Select Role'}</option>
                    <option value="User">{t('broadcast.roleUser') || 'User'}</option>
                    <option value="Moderator">{t('broadcast.roleModerator') || 'Moderator'}</option>
                    <option value="Admin">{t('broadcast.roleAdmin') || 'Admin'}</option>
                    <option value="SuperAdmin">{t('broadcast.roleSuperAdmin') || 'Super Admin'}</option>
                  </select>
                </div>
              )}

              {targetType === 'active' && (
                <div>
                  <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                    {t('broadcast.days') || 'Days'}
                  </label>
                  <input
                    type="number"
                    value={targetValue}
                    onChange={(e) => setTargetValue(e.target.value)}
                    min="1"
                    max="365"
                    placeholder="7"
                    className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    style={{
                      backgroundColor: 'var(--oneui-bg-alt)',
                      borderColor: 'var(--oneui-border)',
                      color: 'var(--oneui-text)',
                    }}
                  />
                  <p className="text-xs oneui-text-muted mt-1">
                    {t('broadcast.activeDaysNote') || 'Users who were active in the last N days'}
                  </p>
                </div>
              )}

              {targetType === 'inactive' && (
                <div>
                  <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                    {t('broadcast.days') || 'Days'}
                  </label>
                  <input
                    type="number"
                    value={targetValue}
                    onChange={(e) => setTargetValue(e.target.value)}
                    min="1"
                    max="365"
                    placeholder="30"
                    className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    style={{
                      backgroundColor: 'var(--oneui-bg-alt)',
                      borderColor: 'var(--oneui-border)',
                      color: 'var(--oneui-text)',
                    }}
                  />
                  <p className="text-xs oneui-text-muted mt-1">
                    {t('broadcast.inactiveDaysNote') || 'Users who have not been active for N days'}
                  </p>
                </div>
              )}

              {targetType === 'new_users' && (
                <div>
                  <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                    {t('broadcast.days') || 'Days'}
                  </label>
                  <input
                    type="number"
                    value={targetValue}
                    onChange={(e) => setTargetValue(e.target.value)}
                    min="1"
                    max="365"
                    placeholder="30"
                    className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    style={{
                      backgroundColor: 'var(--oneui-bg-alt)',
                      borderColor: 'var(--oneui-border)',
                      color: 'var(--oneui-text)',
                    }}
                  />
                  <p className="text-xs oneui-text-muted mt-1">
                    {t('broadcast.newUsersDaysNote') || 'Users registered in the last N days'}
                  </p>
                </div>
              )}

              {targetType === 'language' && (
                <div>
                  <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                    {t('broadcast.language') || 'Language Code'}
                  </label>
                  <select
                    value={targetValue}
                    onChange={(e) => setTargetValue(e.target.value)}
                    className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    style={{
                      backgroundColor: 'var(--oneui-bg-alt)',
                      borderColor: 'var(--oneui-border)',
                      color: 'var(--oneui-text)',
                    }}
                  >
                    <option value="">{t('broadcast.selectLanguage') || 'Select Language'}</option>
                    <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="en">English</option>
                    <option value="ua">Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°</option>
                  </select>
                </div>
              )}

              {targetType === 'active_status' && (
                <div>
                  <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                    {t('broadcast.activeStatus') || 'Active Status'}
                  </label>
                  <select
                    value={targetValue}
                    onChange={(e) => setTargetValue(e.target.value)}
                    className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    style={{
                      backgroundColor: 'var(--oneui-bg-alt)',
                      borderColor: 'var(--oneui-border)',
                      color: 'var(--oneui-text)',
                    }}
                  >
                    <option value="">{t('broadcast.selectActiveStatus') || 'Select Status'}</option>
                    <option value="active">{t('broadcast.statusActive') || 'Active Users'}</option>
                    <option value="inactive">{t('broadcast.statusInactive') || 'Inactive Users'}</option>
                  </select>
                </div>
              )}
            </div>
          </div>

          {/* Scheduling */}
          <div className="oneui-card">
            <div className="oneui-card-header">
              <div className="flex items-center gap-3">
                <div className="oneui-stat-icon oneui-stat-icon-primary">
                  <Calendar className="w-5 h-5" />
                </div>
                <h3 className="oneui-card-title">{t('broadcast.scheduling') || 'Scheduling'}</h3>
              </div>
            </div>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                  {t('broadcast.sendTime') || 'Send Time'}
                </label>
                <input
                  type="datetime-local"
                  value={scheduleTime}
                  onChange={(e) => setScheduleTime(e.target.value)}
                  className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                />
                <p className="text-xs oneui-text-muted mt-1">
                  {t('broadcast.scheduleNote') || 'Leave empty to send immediately'}
                </p>
              </div>
            </div>
          </div>

          {/* Send Button */}
          <div className="flex justify-end">
            <button
              onClick={handleSend}
              disabled={sending || !message.trim()}
              className="oneui-btn oneui-btn-primary flex items-center gap-2"
            >
              <Play className="w-4 h-4" />
              {sending ? (t('common.saving') || 'Sending...') : (t('broadcast.send') || 'Send Broadcast')}
            </button>
          </div>

          {/* Live Progress */}
          {activeBroadcastId && progress && (
            <div className="oneui-card">
              <div className="oneui-card-header">
                <h3 className="oneui-card-title">{t('broadcast.progress') || 'Broadcast Progress'}</h3>
              </div>
              <div className="space-y-4">
                <div>
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm font-medium" style={{ color: 'var(--oneui-text)' }}>
                      {t('broadcast.sent') || 'Sent'}: {progress.sent} / {progress.total}
                    </span>
                    <span className={`oneui-badge ${getStatusColor(progress.status)}`}>
                      {progress.status}
                    </span>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                    <div
                      className="bg-indigo-600 h-2 rounded-full transition-all"
                      style={{
                        width: progress.total > 0 ? `${(progress.sent / progress.total) * 100}%` : '0%'
                      }}
                    />
                  </div>
                </div>
                {progress.errors > 0 && (
                  <div className="text-sm oneui-text-muted">
                    {t('broadcast.errors') || 'Errors'}: {progress.errors}
                  </div>
                )}
              </div>
            </div>
          )}
        </div>
      )}

      {/* History */}
      {activeTab === 'history' && (
        <div className="oneui-card">
          <div className="oneui-card-header">
            <div className="flex items-center justify-between w-full">
              <div className="flex items-center gap-3">
                <div className="oneui-stat-icon oneui-stat-icon-primary">
                  <History className="w-5 h-5" />
                </div>
                <h3 className="oneui-card-title">{t('broadcast.history') || 'Broadcast History'}</h3>
              </div>
              <button
                onClick={loadBroadcasts}
                className="oneui-btn oneui-btn-secondary text-sm flex items-center gap-2"
              >
                <RefreshCw className="w-4 h-4" />
                {t('common.refresh') || 'Refresh'}
              </button>
            </div>
          </div>

          {loading ? (
            <div className="flex items-center justify-center py-8">
              <div className="oneui-spinner"></div>
            </div>
          ) : broadcasts.length === 0 ? (
            <div className="text-center py-12">
              <History className="w-16 h-16 mx-auto mb-4 oneui-text-muted" />
              <h3 className="text-xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
                {t('broadcast.noBroadcasts') || 'No broadcasts'}
              </h3>
              <p className="oneui-text-muted">
                {t('broadcast.noBroadcastsDesc') || 'No broadcasts have been sent yet.'}
              </p>
            </div>
          ) : (
            <div className="overflow-x-auto">
              <table className="oneui-table min-w-full">
                <thead>
                  <tr>
                    <th>{t('broadcast.id') || 'ID'}</th>
                    <th>{t('broadcast.message') || 'Message'}</th>
                    <th>{t('broadcast.target') || 'Target'}</th>
                    <th>{t('broadcast.recipients') || 'Recipients'}</th>
                    <th>{t('broadcast.status') || 'Status'}</th>
                    <th>{t('broadcast.created') || 'Created'}</th>
                  </tr>
                </thead>
                <tbody>
                  {broadcasts.map((broadcast) => {
                    const StatusIcon = getStatusIcon(broadcast.status);
                    return (
                      <tr key={broadcast.id}>
                        <td>
                          <code className="text-sm font-mono" style={{ color: 'var(--oneui-text)' }}>
                            {broadcast.id}
                          </code>
                        </td>
                        <td className="oneui-text-muted">
                          <div className="max-w-xs truncate" title={broadcast.message}>
                            {broadcast.message}
                          </div>
                        </td>
                        <td>
                          <span className="oneui-badge oneui-badge-info">
                            {broadcast.target_type}
                          </span>
                        </td>
                        <td className="oneui-text-muted">
                          <div className="flex items-center gap-1">
                            <Users className="w-4 h-4" />
                            {broadcast.sent_count !== undefined ? (
                              <span>{broadcast.sent_count} / {broadcast.target_count}</span>
                            ) : (
                              <span>{broadcast.target_count}</span>
                            )}
                          </div>
                        </td>
                        <td>
                          <div className="flex items-center gap-2">
                            <StatusIcon className="w-4 h-4" />
                            <span className={`oneui-badge ${getStatusColor(broadcast.status)}`}>
                              {broadcast.status}
                            </span>
                          </div>
                        </td>
                        <td className="oneui-text-muted text-sm">
                          {new Date(broadcast.created_at).toLocaleString()}
                        </td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
          )}
        </div>
      )}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/sections/Terminal.tsx ------------------------------
import { useState, useRef, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { Terminal as TerminalIcon, Send, Trash2, ChevronUp } from 'lucide-react';

type CommandHistoryItem = {
  id: string;
  command: string;
  output: string;
  timestamp: Date;
};

export const Terminal = () => {
  const { t } = useI18n();
  const [command, setCommand] = useState('');
  const [history, setHistory] = useState<CommandHistoryItem[]>([]);
  const [historyIndex, setHistoryIndex] = useState(-1);
  const terminalRef = useRef<HTMLDivElement>(null);
  const inputRef = useRef<HTMLInputElement>(null);

  useEffect(() => {
    if (terminalRef.current) {
      terminalRef.current.scrollTop = terminalRef.current.scrollHeight;
    }
  }, [history]);

  const executeCommand = async () => {
    if (!command.trim()) return;

    const commandText = command.trim();
    
    // Add command to history immediately (with loading state)
    const loadingItem: CommandHistoryItem = {
      id: Date.now().toString(),
      command: commandText,
      output: 'Executing...',
      timestamp: new Date(),
    };
    setHistory([...history, loadingItem]);
    setCommand('');
    setHistoryIndex(-1);

    try {
      const { api } = await import('../../api');
      const result = await api.executeTerminalCommand(commandText);
      
      // Update the last item with actual result
      setHistory(prev => {
        const updated = [...prev];
        const lastIndex = updated.length - 1;
        if (lastIndex >= 0 && updated[lastIndex].id === loadingItem.id) {
          updated[lastIndex] = {
            ...updated[lastIndex],
            output: result.output,
            timestamp: new Date(result.timestamp),
          };
        }
        return updated;
      });
    } catch (error: any) {
      // Update with error
      setHistory(prev => {
        const updated = [...prev];
        const lastIndex = updated.length - 1;
        if (lastIndex >= 0 && updated[lastIndex].id === loadingItem.id) {
          updated[lastIndex] = {
            ...updated[lastIndex],
            output: `Error: ${error.message || 'Failed to execute command'}`,
          };
        }
        return updated;
      });
    }
  };

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      executeCommand();
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      if (history.length > 0) {
        const newIndex = historyIndex === -1 ? history.length - 1 : Math.max(0, historyIndex - 1);
        setHistoryIndex(newIndex);
        setCommand(history[newIndex].command);
      }
    } else if (e.key === 'ArrowDown') {
      e.preventDefault();
      if (historyIndex >= 0) {
        const newIndex = historyIndex + 1;
        if (newIndex >= history.length) {
          setHistoryIndex(-1);
          setCommand('');
        } else {
          setHistoryIndex(newIndex);
          setCommand(history[newIndex].command);
        }
      }
    }
  };

  const clearHistory = () => {
    setHistory([]);
    setCommand('');
  };

  return (
    <div>
      {/* Page Header */}
      <div className="mb-6">
        <h1 className="text-2xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>
          {t('terminal.title')}
        </h1>
        <p className="oneui-text-muted">{t('terminal.subtitle')}</p>
      </div>

      {/* Terminal */}
      <div className="oneui-card">
        <div className="oneui-card-header">
          <div className="flex items-center justify-between w-full">
            <div className="flex items-center gap-3">
              <div className="oneui-stat-icon oneui-stat-icon-primary">
                <TerminalIcon className="w-5 h-5" />
              </div>
              <h3 className="oneui-card-title">SwiftDevBot Terminal</h3>
            </div>
            <button onClick={clearHistory} className="oneui-btn oneui-btn-secondary text-sm">
              <Trash2 className="w-4 h-4" />
            </button>
          </div>
        </div>

        {/* Terminal Output */}
        <div
          ref={terminalRef}
          className="h-96 overflow-y-auto p-4 font-mono text-sm rounded-lg"
          style={{
            backgroundColor: '#1a1a1a',
            color: '#00ff00',
            fontFamily: 'monospace',
          }}
        >
          {history.length === 0 ? (
            <div className="oneui-text-muted">
              {t('terminal.noHistory')}
              <br />
              <span className="text-xs">Type a command and press Enter to execute.</span>
            </div>
          ) : (
            history.map((item) => (
              <div key={item.id} className="mb-4">
                <div className="mb-1">
                  <span style={{ color: '#00ff00' }}>$ </span>
                  <span style={{ color: '#ffffff' }}>{item.command}</span>
                </div>
                <div className="ml-4 text-gray-300 whitespace-pre-wrap">{item.output}</div>
                <div className="text-xs text-gray-500 mt-1">
                  {item.timestamp.toLocaleTimeString()}
                </div>
              </div>
            ))
          )}
        </div>

        {/* Terminal Input */}
        <div className="mt-4 flex gap-2">
          <div className="flex-1 relative">
            <span className="absolute left-3 top-1/2 -translate-y-1/2 text-green-400 font-mono">$</span>
            <input
              ref={inputRef}
              type="text"
              value={command}
              onChange={(e) => setCommand(e.target.value)}
              onKeyDown={handleKeyDown}
              placeholder={t('terminal.placeholder')}
              className="w-full pl-8 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 font-mono"
              style={{
                backgroundColor: 'var(--oneui-bg-alt)',
                borderColor: 'var(--oneui-border)',
                color: 'var(--oneui-text)',
              }}
            />
          </div>
          <button onClick={executeCommand} className="oneui-btn oneui-btn-primary">
            <Send className="w-4 h-4" />
          </button>
        </div>

        {/* Help */}
        <div className="mt-4 p-3 rounded-lg text-xs" style={{ backgroundColor: 'var(--oneui-bg-alt)' }}>
          <p className="oneui-text-muted mb-2">
            <strong>Tips:</strong> Use â†‘/â†“ arrows to navigate command history. Commands are executed as if sent to the bot.
          </p>
        </div>
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/UserStatsWidget.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, BotStats } from '../../api';
import { useI18n } from '../../contexts/I18nContext';
import { Users, UserPlus, Activity, TrendingUp } from 'lucide-react';

export const UserStatsWidget = () => {
  const { t } = useI18n();
  const [stats, setStats] = useState<BotStats | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadStats();
    const interval = setInterval(loadStats, 30000);
    return () => clearInterval(interval);
  }, []);

  const loadStats = async () => {
    try {
      const data = await api.getStats();
      setStats(data);
    } catch (error) {
      console.error('Error loading stats:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading || !stats) {
    return <div className="text-center py-4 oneui-text-muted">Loading...</div>;
  }

  const statsItems = [
    {
      icon: Users,
      label: t('home.userStats.totalUsers') || 'Total Users',
      value: stats.total_users || 0,
      color: 'primary',
    },
    {
      icon: UserPlus,
      label: t('home.userStats.newToday') || 'New Today',
      value: 0, // Would need API endpoint for this
      color: 'success',
    },
    {
      icon: Activity,
      label: t('home.userStats.active24h') || 'Active (24h)',
      value: 0, // Would need API endpoint for this
      color: 'info',
    },
    {
      icon: TrendingUp,
      label: t('home.userStats.growth') || 'Growth',
      value: '+5.2%',
      color: 'success',
    },
  ];

  return (
    <div className="grid grid-cols-2 gap-4">
      {statsItems.map((item, index) => {
        const Icon = item.icon;
        return (
          <div
            key={index}
            className="p-4 rounded-lg"
            style={{ backgroundColor: 'var(--oneui-bg-alt)' }}
          >
            <div className="flex items-center gap-2 mb-2">
              <Icon className="w-4 h-4" style={{ color: `var(--oneui-${item.color})` }} />
              <span className="text-xs oneui-text-muted">{item.label}</span>
            </div>
            <p className="text-2xl font-bold" style={{ color: 'var(--oneui-text)' }}>
              {item.value}
            </p>
          </div>
        );
      })}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/RecentErrorsWidget.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, BotLog } from '../../api';
import { useI18n } from '../../contexts/I18nContext';
import { AlertCircle, XCircle, AlertTriangle, Info } from 'lucide-react';

export const RecentErrorsWidget = () => {
  const { t } = useI18n();
  const [errors, setErrors] = useState<BotLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadErrors();
    const interval = setInterval(loadErrors, 10000);
    return () => clearInterval(interval);
  }, []);

  const loadErrors = async () => {
    try {
      const logs = await api.getLogs(5, 'error');
      setErrors(logs || []);
    } catch (error) {
      console.error('Error loading errors:', error);
    } finally {
      setLoading(false);
    }
  };

  const getIcon = (level: string) => {
    switch (level) {
      case 'error':
        return XCircle;
      case 'warning':
        return AlertTriangle;
      default:
        return Info;
    }
  };

  const getColor = (level: string) => {
    switch (level) {
      case 'error':
        return 'text-red-500';
      case 'warning':
        return 'text-yellow-500';
      default:
        return 'text-blue-500';
    }
  };

  if (loading) {
    return <div className="text-center py-4 oneui-text-muted">Loading...</div>;
  }

  if (errors.length === 0) {
    return (
      <div className="text-center py-8">
        <AlertCircle className="w-12 h-12 mx-auto mb-2 oneui-text-muted" />
        <p className="text-sm oneui-text-muted">{t('home.noErrors') || 'No recent errors'}</p>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {errors.map((error, index) => {
        const Icon = getIcon(error.level);
        return (
          <div
            key={index}
            className="flex items-start gap-3 p-3 rounded-lg"
            style={{ backgroundColor: 'var(--oneui-bg-alt)' }}
          >
            <Icon className={`w-5 h-5 flex-shrink-0 ${getColor(error.level)}`} />
            <div className="flex-1 min-w-0">
              <p className="text-sm font-medium truncate" style={{ color: 'var(--oneui-text)' }}>
                {error.message}
              </p>
              <p className="text-xs oneui-text-muted mt-1">
                {new Date(error.timestamp).toLocaleString()}
              </p>
            </div>
          </div>
        );
      })}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/GitHubWidget.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { Github, Star, GitFork, Eye, TrendingUp, AlertCircle } from 'lucide-react';

interface GitHubRepo {
  name: string;
  fullName: string;
  description: string;
  stars: number;
  forks: number;
  watchers: number;
  language: string;
  url: string;
  updatedAt: string;
}

export const GitHubWidget = () => {
  const { t } = useI18n();
  const [repos, setRepos] = useState<GitHubRepo[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [username, setUsername] = useState('');

  useEffect(() => {
    const saved = localStorage.getItem('sdb_github_username');
    if (saved) {
      setUsername(saved);
      loadRepos(saved);
    } else {
      setLoading(false);
    }
  }, []);

  const loadRepos = async (user: string) => {
    if (!user.trim()) {
      setLoading(false);
      return;
    }

    try {
      setLoading(true);
      setError(null);
      // In a real implementation, this would call GitHub API
      // For now, we'll use mock data
      await new Promise(resolve => setTimeout(resolve, 500));
      
      // Mock GitHub repos
      const mockRepos: GitHubRepo[] = [
        {
          name: 'swiftdevbot',
          fullName: 'user/swiftdevbot',
          description: 'Modular Telegram bot platform',
          stars: 42,
          forks: 8,
          watchers: 15,
          language: 'Python',
          url: 'https://github.com/user/swiftdevbot',
          updatedAt: '2024-01-15',
        },
        {
          name: 'web-dashboard',
          fullName: 'user/web-dashboard',
          description: 'React dashboard for SwiftDevBot',
          stars: 28,
          forks: 5,
          watchers: 10,
          language: 'TypeScript',
          url: 'https://github.com/user/web-dashboard',
          updatedAt: '2024-01-14',
        },
      ];
      
      setRepos(mockRepos);
      localStorage.setItem('sdb_github_username', user);
    } catch (err) {
      setError(t('home.github.error') || 'Failed to load repositories');
      console.error('Error loading GitHub repos:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (username.trim()) {
      loadRepos(username.trim());
    }
  };

  if (loading) {
    return <div className="text-center py-4 oneui-text-muted">Loading...</div>;
  }

  if (!username) {
    return (
      <div className="space-y-3">
        <div className="flex items-center gap-2 mb-3">
          <Github className="w-5 h-5" style={{ color: 'var(--oneui-primary)' }} />
          <span className="text-sm font-semibold" style={{ color: 'var(--oneui-text)' }}>
            {t('home.github.title') || 'GitHub Repositories'}
          </span>
        </div>
        <form onSubmit={handleSubmit} className="space-y-2">
          <input
            type="text"
            value={username}
            onChange={(e) => setUsername(e.target.value)}
            placeholder={t('home.github.usernamePlaceholder') || 'GitHub username'}
            className="w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
            style={{
              backgroundColor: 'var(--oneui-bg-alt)',
              borderColor: 'var(--oneui-border)',
              color: 'var(--oneui-text)',
            }}
          />
          <button
            type="submit"
            className="w-full px-4 py-2 text-sm bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors"
          >
            {t('home.github.load') || 'Load Repositories'}
          </button>
        </form>
      </div>
    );
  }

  if (error) {
    return (
      <div className="text-center py-8">
        <AlertCircle className="w-12 h-12 mx-auto mb-2 text-red-500" />
        <p className="text-sm oneui-text-muted">{error}</p>
        <button
          onClick={() => {
            setUsername('');
            setError(null);
          }}
          className="mt-4 text-sm text-indigo-500 hover:underline"
        >
          {t('home.github.changeUser') || 'Change username'}
        </button>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-2">
          <Github className="w-5 h-5" style={{ color: 'var(--oneui-primary)' }} />
          <span className="text-sm font-semibold" style={{ color: 'var(--oneui-text)' }}>
            {username}
          </span>
        </div>
        <button
          onClick={() => {
            setUsername('');
            setRepos([]);
          }}
          className="text-xs text-indigo-500 hover:underline"
        >
          {t('home.github.change') || 'Change'}
        </button>
      </div>

      {/* Repositories */}
      <div className="space-y-2 max-h-64 overflow-y-auto">
        {repos.length === 0 ? (
          <div className="text-center py-8">
            <Github className="w-12 h-12 mx-auto mb-2 oneui-text-muted" />
            <p className="text-sm oneui-text-muted">
              {t('home.github.noRepos') || 'No repositories found'}
            </p>
          </div>
        ) : (
          repos.map((repo) => (
            <div
              key={repo.name}
              className="p-3 rounded-lg border"
              style={{
                backgroundColor: 'var(--oneui-bg-alt)',
                borderColor: 'var(--oneui-border)',
              }}
            >
              <div className="flex items-start justify-between mb-2">
                <div className="flex-1 min-w-0">
                  <a
                    href={repo.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-sm font-semibold hover:text-indigo-500 transition-colors"
                    style={{ color: 'var(--oneui-text)' }}
                  >
                    {repo.name}
                  </a>
                  {repo.description && (
                    <p className="text-xs oneui-text-muted mt-1 line-clamp-2">
                      {repo.description}
                    </p>
                  )}
                </div>
              </div>
              <div className="flex items-center gap-4 text-xs">
                <div className="flex items-center gap-1">
                  <Star className="w-3 h-3 oneui-text-muted" />
                  <span className="oneui-text-muted">{repo.stars}</span>
                </div>
                <div className="flex items-center gap-1">
                  <GitFork className="w-3 h-3 oneui-text-muted" />
                  <span className="oneui-text-muted">{repo.forks}</span>
                </div>
                <div className="flex items-center gap-1">
                  <Eye className="w-3 h-3 oneui-text-muted" />
                  <span className="oneui-text-muted">{repo.watchers}</span>
                </div>
                {repo.language && (
                  <span className="oneui-text-muted ml-auto">{repo.language}</span>
                )}
              </div>
            </div>
          ))
        )}
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/WeatherWidget.tsx ------------------------------
import { useEffect, useState } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { Cloud, Sun, CloudRain, CloudSnow, Wind, Droplets, Thermometer } from 'lucide-react';

interface WeatherData {
  temperature: number;
  condition: string;
  humidity: number;
  windSpeed: number;
  city: string;
  icon: string;
}

export const WeatherWidget = () => {
  const { t } = useI18n();
  const [weather, setWeather] = useState<WeatherData | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    loadWeather();
    const interval = setInterval(loadWeather, 300000); // Update every 5 minutes
    return () => clearInterval(interval);
  }, []);

  const loadWeather = async () => {
    try {
      setLoading(true);
      setError(null);
      // In a real implementation, this would call an API
      // For now, we'll use mock data
      // You can integrate with OpenWeatherMap, WeatherAPI, etc.
      await new Promise(resolve => setTimeout(resolve, 500)); // Simulate API call
      
      // Mock weather data
      const mockWeather: WeatherData = {
        temperature: 22,
        condition: 'Partly Cloudy',
        humidity: 65,
        windSpeed: 12,
        city: 'Moscow',
        icon: 'cloud',
      };
      
      setWeather(mockWeather);
    } catch (err) {
      setError(t('home.weather.error') || 'Failed to load weather');
      console.error('Error loading weather:', err);
    } finally {
      setLoading(false);
    }
  };

  const getWeatherIcon = (icon: string) => {
    switch (icon.toLowerCase()) {
      case 'sun':
      case 'clear':
        return Sun;
      case 'cloud':
      case 'cloudy':
        return Cloud;
      case 'rain':
        return CloudRain;
      case 'snow':
        return CloudSnow;
      default:
        return Cloud;
    }
  };

  if (loading) {
    return <div className="text-center py-4 oneui-text-muted">Loading...</div>;
  }

  if (error || !weather) {
    return (
      <div className="text-center py-8">
        <Cloud className="w-12 h-12 mx-auto mb-2 oneui-text-muted" />
        <p className="text-sm oneui-text-muted">{error || t('home.weather.noData') || 'No weather data'}</p>
      </div>
    );
  }

  const WeatherIcon = getWeatherIcon(weather.icon);

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <div>
          <p className="text-sm oneui-text-muted">{weather.city}</p>
          <p className="text-3xl font-bold" style={{ color: 'var(--oneui-text)' }}>
            {weather.temperature}Â°C
          </p>
        </div>
        <WeatherIcon className="w-16 h-16" style={{ color: 'var(--oneui-primary)' }} />
      </div>
      
      <p className="text-sm font-medium" style={{ color: 'var(--oneui-text)' }}>
        {weather.condition}
      </p>

      <div className="grid grid-cols-3 gap-3 pt-3 border-t" style={{ borderColor: 'var(--oneui-border)' }}>
        <div className="flex items-center gap-2">
          <Droplets className="w-4 h-4" style={{ color: 'var(--oneui-info)' }} />
          <div>
            <p className="text-xs oneui-text-muted">{t('home.weather.humidity') || 'Humidity'}</p>
            <p className="text-sm font-semibold" style={{ color: 'var(--oneui-text)' }}>
              {weather.humidity}%
            </p>
          </div>
        </div>
        <div className="flex items-center gap-2">
          <Wind className="w-4 h-4" style={{ color: 'var(--oneui-primary)' }} />
          <div>
            <p className="text-xs oneui-text-muted">{t('home.weather.wind') || 'Wind'}</p>
            <p className="text-sm font-semibold" style={{ color: 'var(--oneui-text)' }}>
              {weather.windSpeed} km/h
            </p>
          </div>
        </div>
        <div className="flex items-center gap-2">
          <Thermometer className="w-4 h-4" style={{ color: 'var(--oneui-warning)' }} />
          <div>
            <p className="text-xs oneui-text-muted">{t('home.weather.feelsLike') || 'Feels'}</p>
            <p className="text-sm font-semibold" style={{ color: 'var(--oneui-text)' }}>
              {weather.temperature + 2}Â°C
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/UptimeWidget.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, BotStats } from '../../api';
import { useI18n } from '../../contexts/I18nContext';
import { Clock, Server, Activity } from 'lucide-react';

export const UptimeWidget = () => {
  const { t } = useI18n();
  const [stats, setStats] = useState<BotStats | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadStats();
    const interval = setInterval(loadStats, 60000);
    return () => clearInterval(interval);
  }, []);

  const loadStats = async () => {
    try {
      const data = await api.getStats();
      setStats(data);
    } catch (error) {
      console.error('Error loading stats:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading || !stats) {
    return <div className="text-center py-4 oneui-text-muted">Loading...</div>;
  }

  const parseUptime = (uptime: string) => {
    // Parse "5d 12h 34m" format
    const parts = uptime.split(' ');
    let days = 0, hours = 0, minutes = 0;
    
    parts.forEach(part => {
      if (part.endsWith('d')) days = parseInt(part) || 0;
      else if (part.endsWith('h')) hours = parseInt(part) || 0;
      else if (part.endsWith('m')) minutes = parseInt(part) || 0;
    });

    return { days, hours, minutes, formatted: uptime };
  };

  const uptime = parseUptime(stats.uptime || '0m');

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-center">
        <div className="relative w-32 h-32">
          <svg className="transform -rotate-90 w-32 h-32">
            <circle
              cx="64"
              cy="64"
              r="56"
              stroke="var(--oneui-border)"
              strokeWidth="8"
              fill="none"
            />
            <circle
              cx="64"
              cy="64"
              r="56"
              stroke="var(--oneui-success)"
              strokeWidth="8"
              fill="none"
              strokeDasharray={`${2 * Math.PI * 56}`}
              strokeDashoffset={`${2 * Math.PI * 56 * (1 - Math.min(uptime.days / 365, 1))}`}
              strokeLinecap="round"
            />
          </svg>
          <div className="absolute inset-0 flex flex-col items-center justify-center">
            <Clock className="w-8 h-8 mb-1" style={{ color: 'var(--oneui-success)' }} />
            <span className="text-xs oneui-text-muted">{uptime.formatted}</span>
          </div>
        </div>
      </div>
      <div className="grid grid-cols-3 gap-2 text-center">
        <div>
          <p className="text-2xl font-bold" style={{ color: 'var(--oneui-text)' }}>
            {uptime.days}
          </p>
          <p className="text-xs oneui-text-muted">{t('home.uptime.days') || 'Days'}</p>
        </div>
        <div>
          <p className="text-2xl font-bold" style={{ color: 'var(--oneui-text)' }}>
            {uptime.hours}
          </p>
          <p className="text-xs oneui-text-muted">{t('home.uptime.hours') || 'Hours'}</p>
        </div>
        <div>
          <p className="text-2xl font-bold" style={{ color: 'var(--oneui-text)' }}>
            {uptime.minutes}
          </p>
          <p className="text-xs oneui-text-muted">{t('home.uptime.minutes') || 'Minutes'}</p>
        </div>
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/WidgetSettings.tsx ------------------------------
import { useState } from 'react';
import { X, Plus, Check } from 'lucide-react';
import { useI18n } from '../../contexts/I18nContext';

export type WidgetType = 'stats' | 'activity' | 'systemHealth' | 'custom';

export interface WidgetConfig {
  id: string;
  type: WidgetType;
  title: string;
  enabled: boolean;
  order: number;
}

interface WidgetSettingsProps {
  availableWidgets: WidgetConfig[];
  enabledWidgets: string[];
  onClose: () => void;
  onSave: (enabledIds: string[]) => void;
}

export const WidgetSettings = ({
  availableWidgets,
  enabledWidgets,
  onClose,
  onSave,
}: WidgetSettingsProps) => {
  const { t } = useI18n();
  const [selected, setSelected] = useState<string[]>(enabledWidgets);

  const toggleWidget = (id: string) => {
    setSelected(prev =>
      prev.includes(id) ? prev.filter(w => w !== id) : [...prev, id]
    );
  };

  const handleSave = () => {
    onSave(selected);
    onClose();
  };

  return (
    <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="oneui-card max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="oneui-card-header flex items-center justify-between">
          <h3 className="oneui-card-title">{t('home.widgetSettings') || 'Widget Settings'}</h3>
          <button
            onClick={onClose}
            className="p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors"
          >
            <X className="w-5 h-5 oneui-text-muted" />
          </button>
        </div>
        
        <div className="space-y-2 p-4">
          <p className="text-sm oneui-text-muted mb-4">
            {t('home.widgetSettingsDesc') || 'Select widgets to display on the home page'}
          </p>
          
          {availableWidgets.map((widget) => (
            <div
              key={widget.id}
              onClick={() => toggleWidget(widget.id)}
              className={`flex items-center justify-between p-4 rounded-lg cursor-pointer transition-colors ${
                selected.includes(widget.id)
                  ? 'bg-indigo-500/20 border-2 border-indigo-500'
                  : 'bg-gray-50 dark:bg-gray-800 border-2 border-transparent hover:bg-gray-100 dark:hover:bg-gray-700'
              }`}
            >
              <div className="flex items-center gap-3">
                {selected.includes(widget.id) && (
                  <div className="w-5 h-5 rounded-full bg-indigo-500 flex items-center justify-center">
                    <Check className="w-3 h-3 text-white" />
                  </div>
                )}
                {!selected.includes(widget.id) && (
                  <div className="w-5 h-5 rounded-full border-2 border-gray-300 dark:border-gray-600" />
                )}
                <div>
                  <p className="font-medium" style={{ color: 'var(--oneui-text)' }}>
                    {widget.title}
                  </p>
                  <p className="text-xs oneui-text-muted">
                    {t(`home.widget.${widget.id}.desc`) || t(`home.widget.${widget.type}.desc`) || `Widget type: ${widget.type}`}
                  </p>
                </div>
              </div>
            </div>
          ))}
        </div>

        <div className="oneui-card-footer flex justify-end gap-2">
          <button
            onClick={onClose}
            className="oneui-btn oneui-btn-secondary"
          >
            {t('common.cancel') || 'Cancel'}
          </button>
          <button
            onClick={handleSave}
            className="oneui-btn oneui-btn-primary flex items-center gap-2"
          >
            <Check className="w-4 h-4" />
            {t('common.save') || 'Save'}
          </button>
        </div>
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/ActivityWidget.tsx ------------------------------
interface ActivityWidgetProps {
  activities?: Array<{
    action: string;
    module: string;
    time: string;
    color: 'success' | 'info' | 'warning' | 'error';
  }>;
}

export const ActivityWidget = ({ activities = [] }: ActivityWidgetProps) => {
  const defaultActivities = [
    { action: 'Module activated', module: 'AI Chat', time: '2 minutes ago', color: 'success' as const },
    { action: 'User registered', module: 'System', time: '15 minutes ago', color: 'info' as const },
    { action: 'Code review completed', module: 'Code Review', time: '1 hour ago', color: 'success' as const },
    { action: 'Analytics updated', module: 'Analytics', time: '2 hours ago', color: 'info' as const },
  ];

  const items = activities.length > 0 ? activities : defaultActivities;

  const colorMap = {
    success: 'bg-green-500',
    info: 'bg-blue-500',
    warning: 'bg-yellow-500',
    error: 'bg-red-500',
  };

  return (
    <div className="space-y-3">
      {items.map((activity, index) => (
        <div
          key={index}
          className="flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"
          style={{ backgroundColor: 'var(--oneui-bg-alt)' }}
        >
          <div className="flex items-center gap-3">
            <div className={`w-2 h-2 rounded-full ${colorMap[activity.color]}`}></div>
            <div>
              <p className="text-sm font-medium" style={{ color: 'var(--oneui-text)' }}>
                {activity.action}
              </p>
              <p className="text-xs oneui-text-muted">{activity.module}</p>
            </div>
          </div>
          <span className="text-xs oneui-text-muted">{activity.time}</span>
        </div>
      ))}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/SystemAnnouncementsWidget.tsx ------------------------------
import { useI18n } from '../../contexts/I18nContext';
import { Megaphone, Info, AlertCircle } from 'lucide-react';

export const SystemAnnouncementsWidget = () => {
  const { t } = useI18n();

  // In the future, this would fetch from API
  const announcements = [
    {
      type: 'info' as const,
      title: t('home.announcements.maintenance') || 'Scheduled Maintenance',
      message: t('home.announcements.maintenanceDesc') || 'System maintenance scheduled for tomorrow at 2:00 AM',
      date: '2024-01-15',
    },
    {
      type: 'success' as const,
      title: t('home.announcements.update') || 'System Update',
      message: t('home.announcements.updateDesc') || 'New features have been added to the dashboard',
      date: '2024-01-10',
    },
  ];

  const getIcon = (type: string) => {
    switch (type) {
      case 'info':
        return Info;
      case 'warning':
        return AlertCircle;
      default:
        return Megaphone;
    }
  };

  const getColor = (type: string) => {
    switch (type) {
      case 'info':
        return 'text-blue-500';
      case 'warning':
        return 'text-yellow-500';
      case 'success':
        return 'text-green-500';
      default:
        return 'text-gray-500';
    }
  };

  if (announcements.length === 0) {
    return (
      <div className="text-center py-8">
        <Megaphone className="w-12 h-12 mx-auto mb-2 oneui-text-muted" />
        <p className="text-sm oneui-text-muted">{t('home.noAnnouncements') || 'No announcements'}</p>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {announcements.map((announcement, index) => {
        const Icon = getIcon(announcement.type);
        return (
          <div
            key={index}
            className="p-4 rounded-lg border-l-4"
            style={{
              backgroundColor: 'var(--oneui-bg-alt)',
              borderLeftColor: announcement.type === 'info' ? 'var(--oneui-info)' :
                             announcement.type === 'warning' ? 'var(--oneui-warning)' :
                             'var(--oneui-success)',
            }}
          >
            <div className="flex items-start gap-3">
              <Icon className={`w-5 h-5 flex-shrink-0 mt-0.5 ${getColor(announcement.type)}`} />
              <div className="flex-1">
                <p className="text-sm font-semibold mb-1" style={{ color: 'var(--oneui-text)' }}>
                  {announcement.title}
                </p>
                <p className="text-xs oneui-text-muted mb-2">
                  {announcement.message}
                </p>
                <p className="text-xs oneui-text-muted">
                  {new Date(announcement.date).toLocaleDateString()}
                </p>
              </div>
            </div>
          </div>
        );
      })}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/NotesWidget.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { Plus, Trash2, Edit2, Save, X } from 'lucide-react';

interface Note {
  id: string;
  content: string;
  createdAt: Date;
  updatedAt: Date;
}

export const NotesWidget = () => {
  const { t } = useI18n();
  const [notes, setNotes] = useState<Note[]>([]);
  const [editingId, setEditingId] = useState<string | null>(null);
  const [editContent, setEditContent] = useState('');
  const [newNote, setNewNote] = useState('');

  useEffect(() => {
    loadNotes();
  }, []);

  const loadNotes = () => {
    const saved = localStorage.getItem('sdb_notes');
    if (saved) {
      try {
        const parsed = JSON.parse(saved).map((n: any) => ({
          ...n,
          createdAt: new Date(n.createdAt),
          updatedAt: new Date(n.updatedAt),
        }));
        setNotes(parsed);
      } catch (e) {
        console.error('Error loading notes:', e);
      }
    }
  };

  const saveNotes = (updatedNotes: Note[]) => {
    localStorage.setItem('sdb_notes', JSON.stringify(updatedNotes));
    setNotes(updatedNotes);
  };

  const addNote = () => {
    if (!newNote.trim()) return;
    const note: Note = {
      id: Date.now().toString(),
      content: newNote.trim(),
      createdAt: new Date(),
      updatedAt: new Date(),
    };
    saveNotes([...notes, note]);
    setNewNote('');
  };

  const deleteNote = (id: string) => {
    saveNotes(notes.filter(n => n.id !== id));
  };

  const startEdit = (note: Note) => {
    setEditingId(note.id);
    setEditContent(note.content);
  };

  const saveEdit = () => {
    if (!editingId || !editContent.trim()) return;
    saveNotes(notes.map(n =>
      n.id === editingId
        ? { ...n, content: editContent.trim(), updatedAt: new Date() }
        : n
    ));
    setEditingId(null);
    setEditContent('');
  };

  const cancelEdit = () => {
    setEditingId(null);
    setEditContent('');
  };

  return (
    <div className="space-y-3">
      {/* Add Note */}
      <div className="flex gap-2">
        <input
          type="text"
          value={newNote}
          onChange={(e) => setNewNote(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && addNote()}
          placeholder={t('home.notes.placeholder') || 'Add a note...'}
          className="flex-1 px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
          style={{
            backgroundColor: 'var(--oneui-bg-alt)',
            borderColor: 'var(--oneui-border)',
            color: 'var(--oneui-text)',
          }}
        />
        <button
          onClick={addNote}
          className="p-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors"
        >
          <Plus className="w-4 h-4" />
        </button>
      </div>

      {/* Notes List */}
      <div className="space-y-2 max-h-64 overflow-y-auto">
        {notes.length === 0 ? (
          <div className="text-center py-8">
            <p className="text-sm oneui-text-muted">
              {t('home.notes.noNotes') || 'No notes yet. Add your first note!'}
            </p>
          </div>
        ) : (
          notes.map((note) => (
            <div
              key={note.id}
              className="p-3 rounded-lg border group"
              style={{
                backgroundColor: 'var(--oneui-bg-alt)',
                borderColor: 'var(--oneui-border)',
              }}
            >
              {editingId === note.id ? (
                <div className="space-y-2">
                  <textarea
                    value={editContent}
                    onChange={(e) => setEditContent(e.target.value)}
                    className="w-full px-2 py-1 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    style={{
                      backgroundColor: 'var(--oneui-bg)',
                      borderColor: 'var(--oneui-border)',
                      color: 'var(--oneui-text)',
                    }}
                    rows={3}
                  />
                  <div className="flex gap-2">
                    <button
                      onClick={saveEdit}
                      className="flex items-center gap-1 px-2 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600"
                    >
                      <Save className="w-3 h-3" />
                      {t('common.save') || 'Save'}
                    </button>
                    <button
                      onClick={cancelEdit}
                      className="flex items-center gap-1 px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600"
                    >
                      <X className="w-3 h-3" />
                      {t('common.cancel') || 'Cancel'}
                    </button>
                  </div>
                </div>
              ) : (
                <>
                  <p className="text-sm" style={{ color: 'var(--oneui-text)' }}>
                    {note.content}
                  </p>
                  <div className="flex items-center justify-between mt-2">
                    <span className="text-xs oneui-text-muted">
                      {note.updatedAt.toLocaleDateString()}
                    </span>
                    <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                      <button
                        onClick={() => startEdit(note)}
                        className="p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded"
                        title={t('common.edit') || 'Edit'}
                      >
                        <Edit2 className="w-3 h-3 oneui-text-muted" />
                      </button>
                      <button
                        onClick={() => deleteNote(note.id)}
                        className="p-1 hover:bg-red-100 dark:hover:bg-red-900 rounded"
                        title={t('common.delete') || 'Delete'}
                      >
                        <Trash2 className="w-3 h-3 text-red-500" />
                      </button>
                    </div>
                  </div>
                </>
              )}
            </div>
          ))
        )}
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/ToolsWidget.tsx ------------------------------
import { useState } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { Calculator, Ruler, Hash, Code, ArrowLeftRight, FileText } from 'lucide-react';

type ToolType = 'calculator' | 'converter' | 'encoder' | 'formatter';

export const ToolsWidget = () => {
  const { t } = useI18n();
  const [activeTool, setActiveTool] = useState<ToolType>('calculator');
  const [calcInput, setCalcInput] = useState('');
  const [calcResult, setCalcResult] = useState('');
  const [converterValue, setConverterValue] = useState('');
  const [converterFrom, setConverterFrom] = useState('USD');
  const [converterTo, setConverterTo] = useState('EUR');
  const [encoderInput, setEncoderInput] = useState('');
  const [encoderOutput, setEncoderOutput] = useState('');
  const [encoderType, setEncoderType] = useState<'base64' | 'url' | 'hex'>('base64');

  const tools = [
    { id: 'calculator' as ToolType, icon: Calculator, label: t('home.tools.calculator') || 'Calculator' },
    { id: 'converter' as ToolType, icon: ArrowLeftRight, label: t('home.tools.converter') || 'Converter' },
    { id: 'encoder' as ToolType, icon: Hash, label: t('home.tools.encoder') || 'Encoder' },
    { id: 'formatter' as ToolType, icon: Code, label: t('home.tools.formatter') || 'Formatter' },
  ];

  const handleCalculate = () => {
    try {
      // Simple calculator - in production, use a proper expression parser
      const result = Function(`"use strict"; return (${calcInput})`)();
      setCalcResult(result.toString());
    } catch (e) {
      setCalcResult('Error');
    }
  };

  const handleEncode = () => {
    try {
      switch (encoderType) {
        case 'base64':
          setEncoderOutput(btoa(encoderInput));
          break;
        case 'url':
          setEncoderOutput(encodeURIComponent(encoderInput));
          break;
        case 'hex':
          setEncoderOutput(
            Array.from(encoderInput)
              .map(c => c.charCodeAt(0).toString(16).padStart(2, '0'))
              .join('')
          );
          break;
      }
    } catch (e) {
      setEncoderOutput('Error');
    }
  };

  const handleDecode = () => {
    try {
      switch (encoderType) {
        case 'base64':
          setEncoderInput(atob(encoderOutput));
          break;
        case 'url':
          setEncoderInput(decodeURIComponent(encoderOutput));
          break;
        case 'hex':
          setEncoderInput(
            encoderOutput
              .match(/.{1,2}/g)
              ?.map(byte => String.fromCharCode(parseInt(byte, 16)))
              .join('') || ''
          );
          break;
      }
    } catch (e) {
      setEncoderInput('Error');
    }
  };

  // Mock exchange rates
  const exchangeRates: Record<string, number> = {
    USD: 1,
    EUR: 0.92,
    GBP: 0.79,
    JPY: 149.5,
    RUB: 91.5,
  };

  const convertCurrency = () => {
    const value = parseFloat(converterValue);
    if (isNaN(value)) return;
    const fromRate = exchangeRates[converterFrom] || 1;
    const toRate = exchangeRates[converterTo] || 1;
    const result = (value / fromRate) * toRate;
    return result.toFixed(2);
  };

  return (
    <div className="space-y-3">
      {/* Tool Selector */}
      <div className="grid grid-cols-2 gap-2">
        {tools.map((tool) => {
          const Icon = tool.icon;
          return (
            <button
              key={tool.id}
              onClick={() => setActiveTool(tool.id)}
              className={`flex items-center gap-2 p-2 rounded-lg border transition-colors ${
                activeTool === tool.id
                  ? 'bg-indigo-500 text-white border-indigo-500'
                  : 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700'
              }`}
            >
              <Icon className="w-4 h-4" />
              <span className="text-xs font-medium">{tool.label}</span>
            </button>
          );
        })}
      </div>

      {/* Calculator */}
      {activeTool === 'calculator' && (
        <div className="space-y-2">
          <input
            type="text"
            value={calcInput}
            onChange={(e) => setCalcInput(e.target.value)}
            placeholder="2 + 2"
            className="w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
            style={{
              backgroundColor: 'var(--oneui-bg-alt)',
              borderColor: 'var(--oneui-border)',
              color: 'var(--oneui-text)',
            }}
          />
          <button
            onClick={handleCalculate}
            className="w-full px-4 py-2 text-sm bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors"
          >
            {t('home.tools.calculate') || 'Calculate'}
          </button>
          {calcResult && (
            <div className="p-3 rounded-lg" style={{ backgroundColor: 'var(--oneui-bg-alt)' }}>
              <p className="text-sm oneui-text-muted mb-1">{t('home.tools.result') || 'Result'}</p>
              <p className="text-lg font-bold" style={{ color: 'var(--oneui-text)' }}>
                {calcResult}
              </p>
            </div>
          )}
        </div>
      )}

      {/* Currency Converter */}
      {activeTool === 'converter' && (
        <div className="space-y-2">
          <div className="flex gap-2">
            <input
              type="number"
              value={converterValue}
              onChange={(e) => setConverterValue(e.target.value)}
              placeholder="100"
              className="flex-1 px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
              style={{
                backgroundColor: 'var(--oneui-bg-alt)',
                borderColor: 'var(--oneui-border)',
                color: 'var(--oneui-text)',
              }}
            />
            <select
              value={converterFrom}
              onChange={(e) => setConverterFrom(e.target.value)}
              className="px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
              style={{
                backgroundColor: 'var(--oneui-bg-alt)',
                borderColor: 'var(--oneui-border)',
                color: 'var(--oneui-text)',
              }}
            >
              {Object.keys(exchangeRates).map(currency => (
                <option key={currency} value={currency}>{currency}</option>
              ))}
            </select>
          </div>
          <div className="flex items-center justify-center">
            <ArrowLeftRight className="w-4 h-4 oneui-text-muted" />
          </div>
          <div className="flex gap-2">
            <div className="flex-1 px-3 py-2 text-sm border rounded-lg" style={{ backgroundColor: 'var(--oneui-bg-alt)', borderColor: 'var(--oneui-border)' }}>
              <p className="text-xs oneui-text-muted mb-1">{t('home.tools.result') || 'Result'}</p>
              <p className="text-lg font-bold" style={{ color: 'var(--oneui-text)' }}>
                {converterValue ? convertCurrency() : '0.00'}
              </p>
            </div>
            <select
              value={converterTo}
              onChange={(e) => setConverterTo(e.target.value)}
              className="px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
              style={{
                backgroundColor: 'var(--oneui-bg-alt)',
                borderColor: 'var(--oneui-border)',
                color: 'var(--oneui-text)',
              }}
            >
              {Object.keys(exchangeRates).map(currency => (
                <option key={currency} value={currency}>{currency}</option>
              ))}
            </select>
          </div>
        </div>
      )}

      {/* Encoder/Decoder */}
      {activeTool === 'encoder' && (
        <div className="space-y-2">
          <select
            value={encoderType}
            onChange={(e) => setEncoderType(e.target.value as any)}
            className="w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
            style={{
              backgroundColor: 'var(--oneui-bg-alt)',
              borderColor: 'var(--oneui-border)',
              color: 'var(--oneui-text)',
            }}
          >
            <option value="base64">Base64</option>
            <option value="url">URL</option>
            <option value="hex">Hex</option>
          </select>
          <textarea
            value={encoderInput}
            onChange={(e) => setEncoderInput(e.target.value)}
            placeholder={t('home.tools.input') || 'Input'}
            className="w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
            style={{
              backgroundColor: 'var(--oneui-bg-alt)',
              borderColor: 'var(--oneui-border)',
              color: 'var(--oneui-text)',
            }}
            rows={3}
          />
          <div className="flex gap-2">
            <button
              onClick={handleEncode}
              className="flex-1 px-4 py-2 text-sm bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors"
            >
              {t('home.tools.encode') || 'Encode'}
            </button>
            <button
              onClick={handleDecode}
              className="flex-1 px-4 py-2 text-sm bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
            >
              {t('home.tools.decode') || 'Decode'}
            </button>
          </div>
          <textarea
            value={encoderOutput}
            onChange={(e) => setEncoderOutput(e.target.value)}
            placeholder={t('home.tools.output') || 'Output'}
            className="w-full px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
            style={{
              backgroundColor: 'var(--oneui-bg-alt)',
              borderColor: 'var(--oneui-border)',
              color: 'var(--oneui-text)',
            }}
            rows={3}
          />
        </div>
      )}

      {/* Formatter */}
      {activeTool === 'formatter' && (
        <div className="text-center py-8">
          <FileText className="w-12 h-12 mx-auto mb-2 oneui-text-muted" />
          <p className="text-sm oneui-text-muted">
            {t('home.tools.formatterComingSoon') || 'Formatter coming soon'}
          </p>
        </div>
      )}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/PerformanceWidget.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, LiveMetricsData } from '../../api';
import { useI18n } from '../../contexts/I18nContext';
import { Zap, Clock, AlertTriangle, TrendingUp } from 'lucide-react';

export const PerformanceWidget = () => {
  const { t } = useI18n();
  const [metrics, setMetrics] = useState<LiveMetricsData | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadMetrics();
    const interval = setInterval(loadMetrics, 5000);
    return () => clearInterval(interval);
  }, []);

  const loadMetrics = async () => {
    try {
      const data = await api.getLiveMetrics();
      setMetrics(data);
    } catch (error) {
      console.error('Error loading metrics:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading || !metrics) {
    return <div className="text-center py-4 oneui-text-muted">Loading...</div>;
  }

  const performanceItems = [
    {
      icon: Zap,
      label: t('home.performance.rps') || 'RPS',
      value: metrics.rps.toFixed(1),
      color: 'primary',
    },
    {
      icon: Clock,
      label: t('home.performance.responseTime') || 'Response Time',
      value: `${metrics.responseTime.toFixed(0)}ms`,
      color: metrics.responseTime > 100 ? 'warning' : 'success',
    },
    {
      icon: AlertTriangle,
      label: t('home.performance.errorRate') || 'Error Rate',
      value: `${metrics.errorRate.toFixed(1)}%`,
      color: metrics.errorRate > 3 ? 'danger' : metrics.errorRate > 1 ? 'warning' : 'success',
    },
    {
      icon: TrendingUp,
      label: t('home.performance.queueSize') || 'Queue Size',
      value: metrics.queueSize.toString(),
      color: metrics.queueSize > 100 ? 'warning' : 'info',
    },
  ];

  return (
    <div className="grid grid-cols-2 gap-4">
      {performanceItems.map((item, index) => {
        const Icon = item.icon;
        return (
          <div
            key={index}
            className="p-4 rounded-lg"
            style={{ backgroundColor: 'var(--oneui-bg-alt)' }}
          >
            <div className="flex items-center gap-2 mb-2">
              <Icon className="w-4 h-4" style={{ color: `var(--oneui-${item.color})` }} />
              <span className="text-xs oneui-text-muted">{item.label}</span>
            </div>
            <p className="text-2xl font-bold" style={{ color: `var(--oneui-${item.color})` }}>
              {item.value}
            </p>
          </div>
        );
      })}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/QuickActionsWidget.tsx ------------------------------
import { useI18n } from '../../contexts/I18nContext';
import { useAuth } from '../../contexts/AuthContext';
import { useNavigation } from '../../contexts/NavigationContext';
import { Rocket, Users, Settings, Terminal, Shield, Database, Megaphone, FileText } from 'lucide-react';

export const QuickActionsWidget = () => {
  const { t } = useI18n();
  const { isAdmin } = useAuth();
  const { navigateTo } = useNavigation();

  const actions = [
    { icon: Users, label: t('home.quickActions.users') || 'Users', section: 'users', adminOnly: true },
    { icon: Rocket, label: t('home.quickActions.missionControl') || 'Mission Control', section: 'missionControl', adminOnly: true },
    { icon: Settings, label: t('home.quickActions.settings') || 'Settings', section: 'settings', adminOnly: false },
    { icon: Terminal, label: t('home.quickActions.terminal') || 'Terminal', section: 'terminal', adminOnly: true },
    { icon: Shield, label: t('home.quickActions.security') || 'Security', section: 'security', adminOnly: false },
    { icon: Database, label: t('home.quickActions.database') || 'Database', section: 'databaseData', adminOnly: true },
    { icon: Megaphone, label: t('home.quickActions.broadcast') || 'Broadcast', section: 'broadcastStudio', adminOnly: true },
    { icon: FileText, label: t('home.quickActions.logs') || 'Logs', section: 'logs', adminOnly: true },
  ].filter(action => !action.adminOnly || isAdmin);

  const handleClick = (section: string) => {
    navigateTo(section);
  };

  return (
    <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
      {actions.map((action, index) => {
        const Icon = action.icon;
        return (
          <button
            key={index}
            onClick={() => handleClick(action.section)}
            className="flex flex-col items-center gap-2 p-4 rounded-lg border transition-all hover:bg-gray-50 dark:hover:bg-gray-800 hover:border-indigo-500"
            style={{
              backgroundColor: 'var(--oneui-bg-alt)',
              borderColor: 'var(--oneui-border)',
            }}
          >
            <div className="p-2 rounded-lg" style={{ backgroundColor: 'var(--oneui-primary)', opacity: 0.1 }}>
              <Icon className="w-5 h-5" style={{ color: 'var(--oneui-primary)' }} />
            </div>
            <span className="text-xs font-medium text-center" style={{ color: 'var(--oneui-text)' }}>
              {action.label}
            </span>
          </button>
        );
      })}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/TimeWidget.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { Clock, Globe } from 'lucide-react';

interface TimeZone {
  name: string;
  city: string;
  offset: number;
}

export const TimeWidget = () => {
  const { t } = useI18n();
  const [currentTime, setCurrentTime] = useState(new Date());
  const [timeZones] = useState<TimeZone[]>([
    { name: 'UTC', city: 'UTC', offset: 0 },
    { name: 'Europe/Moscow', city: 'Moscow', offset: 3 },
    { name: 'America/New_York', city: 'New York', offset: -5 },
    { name: 'Asia/Tokyo', city: 'Tokyo', offset: 9 },
  ]);

  useEffect(() => {
    const interval = setInterval(() => {
      setCurrentTime(new Date());
    }, 1000);
    return () => clearInterval(interval);
  }, []);

  const getTimeInZone = (offset: number) => {
    const utc = currentTime.getTime() + currentTime.getTimezoneOffset() * 60000;
    const localTime = new Date(utc + offset * 3600000);
    return localTime;
  };

  const formatTime = (date: Date) => {
    return date.toLocaleTimeString('en-US', {
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: false,
    });
  };

  const formatDate = (date: Date) => {
    return date.toLocaleDateString('en-US', {
      weekday: 'short',
      month: 'short',
      day: 'numeric',
    });
  };

  return (
    <div className="space-y-4">
      {/* Main Clock */}
      <div className="text-center">
        <div className="flex items-center justify-center gap-2 mb-2">
          <Clock className="w-5 h-5" style={{ color: 'var(--oneui-primary)' }} />
          <span className="text-sm font-semibold" style={{ color: 'var(--oneui-text)' }}>
            {timeZones[1].city}
          </span>
        </div>
        <div className="text-4xl font-bold mb-1" style={{ color: 'var(--oneui-text)' }}>
          {formatTime(getTimeInZone(timeZones[1].offset))}
        </div>
        <div className="text-sm oneui-text-muted">
          {formatDate(getTimeInZone(timeZones[1].offset))}
        </div>
      </div>

      {/* Other Time Zones */}
      <div className="pt-3 border-t space-y-2" style={{ borderColor: 'var(--oneui-border)' }}>
        <div className="flex items-center gap-2 mb-2">
          <Globe className="w-4 h-4 oneui-text-muted" />
          <span className="text-xs font-semibold oneui-text-muted">
            {t('home.time.otherZones') || 'Other Time Zones'}
          </span>
        </div>
        {timeZones.filter(tz => tz.city !== timeZones[1].city).map((tz, index) => {
          const time = getTimeInZone(tz.offset);
          return (
            <div
              key={index}
              className="flex items-center justify-between p-2 rounded-lg"
              style={{ backgroundColor: 'var(--oneui-bg-alt)' }}
            >
              <div>
                <p className="text-xs font-medium" style={{ color: 'var(--oneui-text)' }}>
                  {tz.city}
                </p>
                <p className="text-xs oneui-text-muted">
                  {tz.offset >= 0 ? '+' : ''}{tz.offset} UTC
                </p>
              </div>
              <div className="text-right">
                <p className="text-sm font-semibold" style={{ color: 'var(--oneui-text)' }}>
                  {formatTime(time)}
                </p>
                <p className="text-xs oneui-text-muted">
                  {formatDate(time)}
                </p>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/TopModulesWidget.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, BotModule } from '../../api';
import { useI18n } from '../../contexts/I18nContext';
import { Box, TrendingUp } from 'lucide-react';

export const TopModulesWidget = () => {
  const { t } = useI18n();
  const [modules, setModules] = useState<BotModule[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadModules();
    const interval = setInterval(loadModules, 30000);
    return () => clearInterval(interval);
  }, []);

  const loadModules = async () => {
    try {
      const data = await api.getModules(false);
      // Sort by status (active first) and take top 5
      const sorted = (data || [])
        .sort((a, b) => {
          if (a.status === 'active' && b.status !== 'active') return -1;
          if (a.status !== 'active' && b.status === 'active') return 1;
          return 0;
        })
        .slice(0, 5);
      setModules(sorted);
    } catch (error) {
      console.error('Error loading modules:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return <div className="text-center py-4 oneui-text-muted">Loading...</div>;
  }

  if (modules.length === 0) {
    return (
      <div className="text-center py-8">
        <Box className="w-12 h-12 mx-auto mb-2 oneui-text-muted" />
        <p className="text-sm oneui-text-muted">{t('home.noModules') || 'No modules available'}</p>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {modules.map((module, index) => (
        <div
          key={module.name}
          className="flex items-center justify-between p-3 rounded-lg"
          style={{ backgroundColor: 'var(--oneui-bg-alt)' }}
        >
          <div className="flex items-center gap-3 flex-1 min-w-0">
            <div className={`w-2 h-2 rounded-full ${
              module.status === 'active' ? 'bg-green-500' : 'bg-gray-400'
            }`} />
            <div className="flex-1 min-w-0">
              <p className="text-sm font-medium truncate" style={{ color: 'var(--oneui-text)' }}>
                {module.name}
              </p>
              {module.description && (
                <p className="text-xs oneui-text-muted truncate">{module.description}</p>
              )}
            </div>
          </div>
          <div className="flex items-center gap-2">
            {index < 3 && (
              <TrendingUp className="w-4 h-4" style={{ color: 'var(--oneui-success)' }} />
            )}
            <span className={`text-xs px-2 py-1 rounded ${
              module.status === 'active'
                ? 'bg-green-500/20 text-green-500'
                : 'bg-gray-500/20 text-gray-500'
            }`}>
              {module.status}
            </span>
          </div>
        </div>
      ))}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/SystemHealthWidget.tsx ------------------------------
interface SystemHealthWidgetProps {
  metrics?: Array<{
    label: string;
    value: number;
    color: 'primary' | 'success' | 'info' | 'warning' | 'danger';
  }>;
}

export const SystemHealthWidget = ({ metrics = [] }: SystemHealthWidgetProps) => {
  const defaultMetrics = [
    { label: 'Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ CPU', value: 45, color: 'primary' as const },
    { label: 'ĞŸĞ°Ğ¼ÑÑ‚ÑŒ', value: 62, color: 'success' as const },
    { label: 'Ğ¡ĞµÑ‚ÑŒ', value: 28, color: 'info' as const },
    { label: 'Ğ¥Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ', value: 71, color: 'warning' as const },
  ];

  const items = metrics.length > 0 ? metrics : defaultMetrics;

  return (
    <div className="space-y-5">
      {items.map((metric, index) => (
        <div key={index}>
          <div className="flex items-center justify-between mb-2">
            <span className="text-sm font-medium" style={{ color: 'var(--oneui-text)' }}>
              {metric.label}
            </span>
            <span className="text-sm font-semibold" style={{ color: `var(--oneui-${metric.color})` }}>
              {metric.value}%
            </span>
          </div>
          <div className="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
            <div
              className="h-full rounded-full transition-all duration-700"
              style={{
                width: `${metric.value}%`,
                backgroundColor: `var(--oneui-${metric.color})`,
              }}
            ></div>
          </div>
        </div>
      ))}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/WidgetContainer.tsx ------------------------------
import { ReactNode } from 'react';
import { GripVertical, X } from 'lucide-react';

interface WidgetContainerProps {
  id: string;
  title: string;
  children: ReactNode;
  onRemove?: () => void;
  isDragging?: boolean;
  onDragStart?: (e: React.DragEvent) => void;
  onDragOver?: (e: React.DragEvent) => void;
  onDrop?: (e: React.DragEvent) => void;
  onDragEnd?: () => void;
}

export const WidgetContainer = ({
  id,
  title,
  children,
  onRemove,
  isDragging = false,
  onDragStart,
  onDragOver,
  onDrop,
  onDragEnd,
}: WidgetContainerProps) => {
  const handleDragStart = (e: React.DragEvent) => {
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/plain', id);
    if (onDragStart) onDragStart(e);
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
    if (onDragOver) onDragOver(e);
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    if (onDrop) onDrop(e);
  };

  return (
    <div
      draggable
      onDragStart={handleDragStart}
      onDragOver={handleDragOver}
      onDrop={handleDrop}
      onDragEnd={onDragEnd}
      className={`oneui-card relative group ${isDragging ? 'opacity-50' : ''}`}
      style={{ cursor: 'move' }}
    >
      {/* Widget Header */}
      <div className="oneui-card-header flex items-center justify-between">
        <div className="flex items-center gap-2 flex-1">
          <GripVertical className="w-4 h-4 oneui-text-muted cursor-move" />
          <h3 className="oneui-card-title">{title}</h3>
        </div>
        {onRemove && (
          <button
            onClick={onRemove}
            className="opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded"
            title="Remove widget"
          >
            <X className="w-4 h-4 oneui-text-muted" />
          </button>
        )}
      </div>
      
      {/* Widget Content */}
      <div className="oneui-card-content">
        {children}
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/ServicesStatusWidget.tsx ------------------------------
import { useEffect, useState } from 'react';
import { api, Service } from '../../api';
import { useI18n } from '../../contexts/I18nContext';
import { CheckCircle2, XCircle, Loader2 } from 'lucide-react';

export const ServicesStatusWidget = () => {
  const { t } = useI18n();
  const [services, setServices] = useState<Service[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadServices();
    const interval = setInterval(loadServices, 15000);
    return () => clearInterval(interval);
  }, []);

  const loadServices = async () => {
    try {
      const data = await api.getServices();
      setServices(data || []);
    } catch (error) {
      console.error('Error loading services:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return <div className="text-center py-4 oneui-text-muted">Loading...</div>;
  }

  if (services.length === 0) {
    return (
      <div className="text-center py-8">
        <p className="text-sm oneui-text-muted">{t('home.noServices') || 'No services available'}</p>
      </div>
    );
  }

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'running':
        return CheckCircle2;
      case 'stopped':
        return XCircle;
      case 'restarting':
        return Loader2;
      default:
        return XCircle;
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'running':
        return 'text-green-500';
      case 'stopped':
        return 'text-red-500';
      case 'restarting':
        return 'text-yellow-500';
      default:
        return 'text-gray-500';
    }
  };

  return (
    <div className="space-y-3">
      {services.slice(0, 5).map((service) => {
        const StatusIcon = getStatusIcon(service.status);
        return (
          <div
            key={service.id}
            className="flex items-center justify-between p-3 rounded-lg"
            style={{ backgroundColor: 'var(--oneui-bg-alt)' }}
          >
            <div className="flex items-center gap-3 flex-1 min-w-0">
              <StatusIcon className={`w-5 h-5 flex-shrink-0 ${getStatusColor(service.status)}`} />
              <div className="flex-1 min-w-0">
                <p className="text-sm font-medium truncate" style={{ color: 'var(--oneui-text)' }}>
                  {service.name}
                </p>
                {service.description && (
                  <p className="text-xs oneui-text-muted truncate">{service.description}</p>
                )}
              </div>
            </div>
            <div className="flex items-center gap-2 flex-shrink-0">
              <span className={`text-xs px-2 py-1 rounded ${
                service.status === 'running'
                  ? 'bg-green-500/20 text-green-500'
                  : service.status === 'restarting'
                  ? 'bg-yellow-500/20 text-yellow-500'
                  : 'bg-red-500/20 text-red-500'
              }`}>
                {service.status}
              </span>
            </div>
          </div>
        );
      })}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/CalendarWidget.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { ChevronLeft, ChevronRight } from 'lucide-react';

interface CalendarEvent {
  id: string;
  title: string;
  date: Date;
  color: string;
}

export const CalendarWidget = () => {
  const { t } = useI18n();
  const [currentDate, setCurrentDate] = useState(new Date());
  const [events, setEvents] = useState<CalendarEvent[]>([]);

  useEffect(() => {
    loadEvents();
  }, [currentDate]);

  const loadEvents = () => {
    // In a real implementation, this would fetch from API
    // For now, we'll use localStorage for events
    const savedEvents = localStorage.getItem('sdb_calendar_events');
    if (savedEvents) {
      try {
        const parsed = JSON.parse(savedEvents).map((e: any) => ({
          ...e,
          date: new Date(e.date),
        }));
        setEvents(parsed.filter((e: CalendarEvent) => 
          e.date.getMonth() === currentDate.getMonth() &&
          e.date.getFullYear() === currentDate.getFullYear()
        ));
      } catch (e) {
        console.error('Error loading events:', e);
      }
    }
  };

  const monthNames = [
    t('home.calendar.january') || 'January',
    t('home.calendar.february') || 'February',
    t('home.calendar.march') || 'March',
    t('home.calendar.april') || 'April',
    t('home.calendar.may') || 'May',
    t('home.calendar.june') || 'June',
    t('home.calendar.july') || 'July',
    t('home.calendar.august') || 'August',
    t('home.calendar.september') || 'September',
    t('home.calendar.october') || 'October',
    t('home.calendar.november') || 'November',
    t('home.calendar.december') || 'December',
  ];

  const dayNames = [
    t('home.calendar.sun') || 'Sun',
    t('home.calendar.mon') || 'Mon',
    t('home.calendar.tue') || 'Tue',
    t('home.calendar.wed') || 'Wed',
    t('home.calendar.thu') || 'Thu',
    t('home.calendar.fri') || 'Fri',
    t('home.calendar.sat') || 'Sat',
  ];

  const getDaysInMonth = (date: Date) => {
    return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
  };

  const getFirstDayOfMonth = (date: Date) => {
    return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
  };

  const prevMonth = () => {
    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
  };

  const nextMonth = () => {
    setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));
  };

  const today = new Date();
  const daysInMonth = getDaysInMonth(currentDate);
  const firstDay = getFirstDayOfMonth(currentDate);
  const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
  const emptyDays = Array.from({ length: firstDay }, (_, i) => i);

  const getEventsForDay = (day: number) => {
    return events.filter(e => e.date.getDate() === day);
  };

  const isToday = (day: number) => {
    return (
      day === today.getDate() &&
      currentDate.getMonth() === today.getMonth() &&
      currentDate.getFullYear() === today.getFullYear()
    );
  };

  return (
    <div className="space-y-4">
      {/* Header */}
      <div className="flex items-center justify-between">
        <button
          onClick={prevMonth}
          className="p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors"
        >
          <ChevronLeft className="w-5 h-5 oneui-text-muted" />
        </button>
        <h3 className="text-lg font-semibold" style={{ color: 'var(--oneui-text)' }}>
          {monthNames[currentDate.getMonth()]} {currentDate.getFullYear()}
        </h3>
        <button
          onClick={nextMonth}
          className="p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition-colors"
        >
          <ChevronRight className="w-5 h-5 oneui-text-muted" />
        </button>
      </div>

      {/* Calendar Grid */}
      <div className="grid grid-cols-7 gap-1">
        {/* Day names */}
        {dayNames.map((day, i) => (
          <div
            key={i}
            className="text-center text-xs font-medium py-1 oneui-text-muted"
          >
            {day}
          </div>
        ))}

        {/* Empty days */}
        {emptyDays.map((_, i) => (
          <div key={`empty-${i}`} className="aspect-square" />
        ))}

        {/* Days */}
        {days.map((day) => {
          const dayEvents = getEventsForDay(day);
          const isTodayDay = isToday(day);
          return (
            <div
              key={day}
              className={`aspect-square p-1 rounded text-xs cursor-pointer transition-colors ${
                isTodayDay
                  ? 'bg-indigo-500 text-white font-semibold'
                  : 'hover:bg-gray-100 dark:hover:bg-gray-800'
              }`}
            >
              <div className="flex items-center justify-center h-full">
                {day}
              </div>
              {dayEvents.length > 0 && (
                <div className="flex gap-0.5 justify-center mt-0.5">
                  {dayEvents.slice(0, 3).map((event, i) => (
                    <div
                      key={i}
                      className="w-1 h-1 rounded-full"
                      style={{ backgroundColor: event.color || 'var(--oneui-primary)' }}
                    />
                  ))}
                </div>
              )}
            </div>
          );
        })}
      </div>

      {/* Upcoming Events */}
      {events.length > 0 && (
        <div className="pt-3 border-t" style={{ borderColor: 'var(--oneui-border)' }}>
          <p className="text-xs font-semibold mb-2 oneui-text-muted">
            {t('home.calendar.upcoming') || 'Upcoming Events'}
          </p>
          <div className="space-y-2">
            {events.slice(0, 3).map((event) => (
              <div
                key={event.id}
                className="flex items-center gap-2 text-xs"
                style={{ color: 'var(--oneui-text)' }}
              >
                <div
                  className="w-2 h-2 rounded-full"
                  style={{ backgroundColor: event.color || 'var(--oneui-primary)' }}
                />
                <span className="truncate">{event.title}</span>
                <span className="oneui-text-muted ml-auto">
                  {event.date.toLocaleDateString()}
                </span>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/TasksWidget.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useI18n } from '../../contexts/I18nContext';
import { Plus, Trash2, CheckCircle2, Circle, AlertCircle } from 'lucide-react';

interface Task {
  id: string;
  title: string;
  completed: boolean;
  priority: 'low' | 'medium' | 'high';
  createdAt: Date;
}

export const TasksWidget = () => {
  const { t } = useI18n();
  const [tasks, setTasks] = useState<Task[]>([]);
  const [newTask, setNewTask] = useState('');
  const [filter, setFilter] = useState<'all' | 'active' | 'completed'>('all');

  useEffect(() => {
    loadTasks();
  }, []);

  const loadTasks = () => {
    const saved = localStorage.getItem('sdb_tasks');
    if (saved) {
      try {
        const parsed = JSON.parse(saved).map((t: any) => ({
          ...t,
          createdAt: new Date(t.createdAt),
        }));
        setTasks(parsed);
      } catch (e) {
        console.error('Error loading tasks:', e);
      }
    }
  };

  const saveTasks = (updatedTasks: Task[]) => {
    localStorage.setItem('sdb_tasks', JSON.stringify(updatedTasks));
    setTasks(updatedTasks);
  };

  const addTask = () => {
    if (!newTask.trim()) return;
    const task: Task = {
      id: Date.now().toString(),
      title: newTask.trim(),
      completed: false,
      priority: 'medium',
      createdAt: new Date(),
    };
    saveTasks([...tasks, task]);
    setNewTask('');
  };

  const toggleTask = (id: string) => {
    saveTasks(tasks.map(t => t.id === id ? { ...t, completed: !t.completed } : t));
  };

  const deleteTask = (id: string) => {
    saveTasks(tasks.filter(t => t.id !== id));
  };

  const filteredTasks = tasks.filter(task => {
    if (filter === 'active') return !task.completed;
    if (filter === 'completed') return task.completed;
    return true;
  });

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'high':
        return 'text-red-500';
      case 'medium':
        return 'text-yellow-500';
      case 'low':
        return 'text-green-500';
      default:
        return 'text-gray-500';
    }
  };

  const completedCount = tasks.filter(t => t.completed).length;
  const totalCount = tasks.length;

  return (
    <div className="space-y-3">
      {/* Add Task */}
      <div className="flex gap-2">
        <input
          type="text"
          value={newTask}
          onChange={(e) => setNewTask(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && addTask()}
          placeholder={t('home.tasks.placeholder') || 'Add a task...'}
          className="flex-1 px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
          style={{
            backgroundColor: 'var(--oneui-bg-alt)',
            borderColor: 'var(--oneui-border)',
            color: 'var(--oneui-text)',
          }}
        />
        <button
          onClick={addTask}
          className="p-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors"
        >
          <Plus className="w-4 h-4" />
        </button>
      </div>

      {/* Filter */}
      {tasks.length > 0 && (
        <div className="flex gap-2">
          {(['all', 'active', 'completed'] as const).map((f) => (
            <button
              key={f}
              onClick={() => setFilter(f)}
              className={`px-3 py-1 text-xs rounded transition-colors ${
                filter === f
                  ? 'bg-indigo-500 text-white'
                  : 'bg-gray-100 dark:bg-gray-800 oneui-text-muted hover:bg-gray-200 dark:hover:bg-gray-700'
              }`}
            >
              {t(`home.tasks.${f}`) || f}
            </button>
          ))}
        </div>
      )}

      {/* Progress */}
      {tasks.length > 0 && (
        <div className="flex items-center justify-between text-xs">
          <span className="oneui-text-muted">
            {completedCount} / {totalCount} {t('home.tasks.completed') || 'completed'}
          </span>
          <div className="w-24 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
            <div
              className="h-full bg-green-500 transition-all"
              style={{ width: `${totalCount > 0 ? (completedCount / totalCount) * 100 : 0}%` }}
            />
          </div>
        </div>
      )}

      {/* Tasks List */}
      <div className="space-y-2 max-h-64 overflow-y-auto">
        {filteredTasks.length === 0 ? (
          <div className="text-center py-8">
            <AlertCircle className="w-12 h-12 mx-auto mb-2 oneui-text-muted" />
            <p className="text-sm oneui-text-muted">
              {filter === 'all'
                ? t('home.tasks.noTasks') || 'No tasks yet. Add your first task!'
                : t('home.tasks.noFilteredTasks') || 'No tasks found'}
            </p>
          </div>
        ) : (
          filteredTasks.map((task) => (
            <div
              key={task.id}
              className={`flex items-center gap-3 p-3 rounded-lg border group ${
                task.completed ? 'opacity-60' : ''
              }`}
              style={{
                backgroundColor: 'var(--oneui-bg-alt)',
                borderColor: 'var(--oneui-border)',
              }}
            >
              <button
                onClick={() => toggleTask(task.id)}
                className="flex-shrink-0"
              >
                {task.completed ? (
                  <CheckCircle2 className="w-5 h-5 text-green-500" />
                ) : (
                  <Circle className="w-5 h-5 oneui-text-muted" />
                )}
              </button>
              <div className="flex-1 min-w-0">
                <p
                  className={`text-sm ${
                    task.completed ? 'line-through' : ''
                  }`}
                  style={{ color: 'var(--oneui-text)' }}
                >
                  {task.title}
                </p>
                <div className="flex items-center gap-2 mt-1">
                  <span className={`text-xs ${getPriorityColor(task.priority)}`}>
                    {t(`home.tasks.priority.${task.priority}`) || task.priority}
                  </span>
                </div>
              </div>
              <button
                onClick={() => deleteTask(task.id)}
                className="opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-red-100 dark:hover:bg-red-900 rounded"
                title={t('common.delete') || 'Delete'}
              >
                <Trash2 className="w-4 h-4 text-red-500" />
              </button>
            </div>
          ))
        )}
      </div>
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/components/widgets/StatsWidget.tsx ------------------------------
import { BotStats } from '../../api';
import { Zap, Users, TrendingUp, Activity, ArrowUpRight, ArrowDownRight } from 'lucide-react';

interface StatsWidgetProps {
  stats: BotStats;
  showChange?: boolean;
}

export const StatsWidget = ({ stats, showChange = true }: StatsWidgetProps) => {
  const statCards = [
    {
      label: 'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸',
      value: stats.active_modules || 0,
      icon: Zap,
      iconClass: 'oneui-stat-icon-primary',
      change: '+2.5%',
      changePositive: true,
    },
    {
      label: 'Ğ’ÑĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹',
      value: stats.total_users || 0,
      icon: Users,
      iconClass: 'oneui-stat-icon-success',
      change: '+3.8%',
      changePositive: true,
    },
    {
      label: 'Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ',
      value: stats.messages_today || 0,
      icon: TrendingUp,
      iconClass: 'oneui-stat-icon-warning',
      change: '+1.7%',
      changePositive: true,
    },
    {
      label: 'Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹',
      value: 'ONLINE',
      icon: Activity,
      iconClass: 'oneui-stat-icon-success',
      change: '100%',
      changePositive: true,
    },
  ];

  return (
    <div className="oneui-stats-grid">
      {statCards.map((card, index) => {
        const Icon = card.icon;
        return (
          <div key={index} className="oneui-stat-card">
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <div className="oneui-stat-label">{card.label}</div>
                <div className="oneui-stat-value">{card.value}</div>
                {showChange && (
                  <div className="flex items-center gap-1 mt-2 text-sm" style={{ color: card.changePositive ? 'var(--oneui-success)' : 'var(--oneui-danger)' }}>
                    {card.changePositive ? (
                      <ArrowUpRight className="w-4 h-4" />
                    ) : (
                      <ArrowDownRight className="w-4 h-4" />
                    )}
                    <span>{card.change}</span>
                  </div>
                )}
              </div>
              <div className={card.iconClass}>
                <Icon className="w-6 h-6" />
              </div>
            </div>
          </div>
        );
      })}
    </div>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/pages/Dashboard.tsx ------------------------------
import { useState, useEffect } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { NavigationProvider } from '../contexts/NavigationContext';
import { Header } from '../components/Header';
import { Sidebar } from '../components/Sidebar';
import { CommandPalette } from '../components/CommandPalette';
import { Home } from '../components/sections/Home';
import { MissionControl } from '../components/sections/MissionControl';
import { UserDashboard } from '../components/sections/UserDashboard';
import { Modules } from '../components/sections/Modules';
import { ModulesHub } from '../components/sections/ModulesHub';
import { Users } from '../components/sections/Users';
import { Statistics } from '../components/sections/Statistics';
import { Logs } from '../components/sections/Logs';
import { Settings } from '../components/sections/Settings';
import { Docs } from '../components/sections/Docs';
import { Config } from '../components/sections/Config';
import { CoreManagement } from '../components/sections/CoreManagement';
import { Services } from '../components/sections/Services';
import { Monitoring } from '../components/sections/Monitoring';
import { Security } from '../components/sections/Security';
import { Notifications } from '../components/sections/Notifications';
import { Data } from '../components/sections/Data';
import { Support } from '../components/sections/Support';
import { Developer } from '../components/sections/Developer';
import { Terminal } from '../components/sections/Terminal';
import { CronJobs } from '../components/sections/CronJobs';
import { SecurityOperations } from '../components/sections/SecurityOperations';
import { DatabaseData } from '../components/sections/DatabaseData';
import { BroadcastStudio } from '../components/sections/BroadcastStudio';

const sections = {
  home: Home,
  missionControl: MissionControl,
  modules: Modules,
  modulesHub: ModulesHub,
  users: Users,
  statistics: Statistics,
  logs: Logs,
  settings: Settings,
  docs: Docs,
  config: Config,
  coreManagement: CoreManagement,
  services: Services,
  monitoring: Monitoring,
  security: Security,
  notifications: Notifications,
  data: Data,
  support: Support,
  developer: Developer,
  terminal: Terminal,
  cronJobs: CronJobs,
  securityOperations: SecurityOperations,
  databaseData: DatabaseData,
  broadcastStudio: BroadcastStudio,
};

export const Dashboard = () => {
  const { isAdmin } = useAuth();
  const [activeSection, setActiveSection] = useState('home');
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [isCommandPaletteOpen, setIsCommandPaletteOpen] = useState(false);

  // Command Palette hotkey (Ctrl+K or Cmd+K)
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        setIsCommandPaletteOpen(true);
      }
    };
    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, []);

  // For regular users, show UserDashboard on home, for admins show Home
  const getActiveComponent = () => {
    if (activeSection === 'home') {
      return isAdmin ? Home : UserDashboard;
    }
    // Mission Control is admin-only
    if (activeSection === 'missionControl' && !isAdmin) {
      return UserDashboard;
    }
    return sections[activeSection as keyof typeof sections] || (isAdmin ? Home : UserDashboard);
  };

  const ActiveComponent = getActiveComponent();

  return (
    <NavigationProvider navigateTo={setActiveSection}>
      <div className="oneui-container">
      <Sidebar
        activeSection={activeSection}
        onSectionChange={setActiveSection}
        isMobileOpen={isMobileMenuOpen}
        onClose={() => setIsMobileMenuOpen(false)}
      />

        <div className="oneui-main">
        <Header
          onMenuToggle={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
          isMobileMenuOpen={isMobileMenuOpen}
        />

          <main className="oneui-content">
          <ActiveComponent />
        </main>
        </div>
      </div>
      <CommandPalette
        isOpen={isCommandPaletteOpen}
        onClose={() => setIsCommandPaletteOpen(false)}
      />
    </NavigationProvider>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/pages/CloudPasswordSetup.tsx ------------------------------
import { useState } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { Shield, Zap, Lock } from 'lucide-react';

export const CloudPasswordSetup = () => {
  const { setupCloudPassword } = useAuth();
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    if (password.length < 8) {
      setError('ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 8 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²');
      return;
    }

    if (password !== confirmPassword) {
      setError('ĞŸĞ°Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ÑÑ‚');
      return;
    }

    setLoading(true);

    try {
      await setupCloudPassword(password);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ');
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center p-4 py-8" style={{ backgroundColor: 'var(--oneui-bg-alt)', width: '100%', maxWidth: '100vw', overflowX: 'hidden' }}>
      <div className="w-full max-w-md mx-auto" style={{ width: '100%', maxWidth: 'min(100% - 2rem, 28rem)' }}>
        <div className="oneui-card" style={{ width: '100%' }}>
          <div className="flex flex-col items-center mb-6 sm:mb-8">
            <div className="w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mb-3 sm:mb-4">
              <Zap className="w-7 h-7 sm:w-8 sm:h-8 text-white" />
            </div>
            <h1 className="text-2xl sm:text-3xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>SwiftDevBot</h1>
            <p className="oneui-text-muted text-xs sm:text-sm text-center px-4">ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸</p>
          </div>

          <div className="mb-4 sm:mb-6 p-3 sm:p-4 rounded-lg border-l-4" style={{ 
            backgroundColor: 'rgba(99, 102, 241, 0.1)',
            borderLeftColor: 'var(--oneui-primary)',
          }}>
            <div className="flex items-start gap-2 sm:gap-3">
              <Shield className="w-4 h-4 sm:w-5 sm:h-5 text-indigo-500 mt-0.5 flex-shrink-0" />
              <div className="flex-1 min-w-0">
                <p className="text-xs sm:text-sm font-medium mb-1" style={{ color: 'var(--oneui-text)' }}>
                  Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
                </p>
                <p className="text-xs oneui-text-muted leading-relaxed">
                  Ğ­Ñ‚Ğ¾ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸. 
                  ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ¿Ñ€Ğ¸ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ğ²Ñ…Ğ¾Ğ´Ğµ Ñ‡ĞµÑ€ĞµĞ· Ñ‚Ğ¾ĞºĞµĞ½-ÑÑÑ‹Ğ»ĞºÑƒ.
                </p>
              </div>
            </div>
          </div>

          <form onSubmit={handleSubmit} className="space-y-4 sm:space-y-5">
            <div>
              <label className="block text-xs sm:text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                ĞĞ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
              </label>
              <div className="relative">
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  placeholder="ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 8 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²"
                  required
                  minLength={8}
                  className="w-full px-3 sm:px-4 py-2.5 sm:py-2 text-sm sm:text-base border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                />
                <Lock className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 oneui-text-muted pointer-events-none" />
              </div>
            </div>

            <div>
              <label className="block text-xs sm:text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
              </label>
              <div className="relative">
                <input
                  type="password"
                  value={confirmPassword}
                  onChange={(e) => setConfirmPassword(e.target.value)}
                  placeholder="ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ"
                  required
                  minLength={8}
                  className="w-full px-3 sm:px-4 py-2.5 sm:py-2 text-sm sm:text-base border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                />
                <Lock className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 oneui-text-muted pointer-events-none" />
              </div>
            </div>

            {error && (
              <div className="p-3 rounded-lg border-l-4 text-xs sm:text-sm" style={{
                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                borderLeftColor: 'var(--oneui-danger)',
                color: 'var(--oneui-danger)',
              }}>
                {error}
              </div>
            )}

            <button
              type="submit"
              className="oneui-btn oneui-btn-primary w-full flex items-center justify-center gap-2 py-2.5 sm:py-2 text-sm sm:text-base"
              disabled={loading}
            >
              {loading ? (
                <span className="flex items-center gap-2">
                  <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                  Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°...
                </span>
              ) : (
                <>
                  <Lock className="w-4 h-4" />
                  Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
                </>
              )}
            </button>
          </form>
        </div>

        <div className="text-center mt-6 sm:mt-8">
          <p className="text-xs sm:text-sm oneui-text-muted">
            SwiftDevBot â€” created by <span className="font-semibold">SoverX</span>
          </p>
        </div>
      </div>
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/pages/CloudPasswordPrompt.tsx ------------------------------
import { useState } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { Lock, Zap, Shield } from 'lucide-react';

export const CloudPasswordPrompt = () => {
  const { verifyCloudPassword } = useAuth();
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    e.stopPropagation();
    
    if (!password || password.trim() === '') {
      setError('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ');
      return;
    }
    
    setError('');
    setLoading(true);

    try {
      console.log('Verifying cloud password...');
      await verifyCloudPassword(password);
      console.log('Cloud password verified successfully');
      setPassword('');
    } catch (err) {
      console.error('Cloud password verification error:', err);
      const errorMessage = err instanceof Error ? err.message : 'ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ';
      setError(errorMessage);
      setPassword('');
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center p-4 py-8" style={{ backgroundColor: 'var(--oneui-bg-alt)', width: '100%', maxWidth: '100vw', overflowX: 'hidden' }}>
      <div className="w-full max-w-md mx-auto" style={{ width: '100%', maxWidth: 'min(100% - 2rem, 28rem)' }}>
        <div className="oneui-card" style={{ width: '100%' }}>
          <div className="flex flex-col items-center mb-6 sm:mb-8">
            <div className="w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mb-3 sm:mb-4">
              <Zap className="w-7 h-7 sm:w-8 sm:h-8 text-white" />
            </div>
            <h1 className="text-2xl sm:text-3xl font-bold mb-2" style={{ color: 'var(--oneui-text)' }}>SwiftDevBot</h1>
            <p className="oneui-text-muted text-xs sm:text-sm text-center px-4">Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ</p>
          </div>

          <div className="mb-4 sm:mb-6 p-3 sm:p-4 rounded-lg border-l-4" style={{ 
            backgroundColor: 'rgba(139, 92, 246, 0.1)',
            borderLeftColor: 'var(--oneui-secondary)',
          }}>
            <div className="flex items-start gap-2 sm:gap-3">
              <Shield className="w-4 h-4 sm:w-5 sm:h-5 text-purple-500 mt-0.5 flex-shrink-0" />
              <div className="flex-1 min-w-0">
                <p className="text-xs sm:text-sm font-medium mb-1" style={{ color: 'var(--oneui-text)' }}>
                  Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°
                </p>
                <p className="text-xs oneui-text-muted leading-relaxed">
                  Ğ”Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ²Ğ²ĞµÑÑ‚Ğ¸ Ğ²Ğ°Ñˆ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ.
                </p>
              </div>
            </div>
          </div>

          <form onSubmit={handleSubmit} className="space-y-4 sm:space-y-5">
            <div>
              <label className="block text-xs sm:text-sm font-medium mb-2" style={{ color: 'var(--oneui-text)' }}>
                ĞĞ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
              </label>
              <div className="relative">
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°Ñˆ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ"
                  required
                  autoFocus
                  className="w-full px-3 sm:px-4 py-2.5 sm:py-2 text-sm sm:text-base border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  style={{
                    backgroundColor: 'var(--oneui-bg-alt)',
                    borderColor: 'var(--oneui-border)',
                    color: 'var(--oneui-text)',
                  }}
                />
                <Lock className="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 oneui-text-muted pointer-events-none" />
              </div>
            </div>

            {error && (
              <div className="p-3 rounded-lg border-l-4 text-xs sm:text-sm" style={{
                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                borderLeftColor: 'var(--oneui-danger)',
                color: 'var(--oneui-danger)',
              }}>
                {error}
              </div>
            )}

            <button
              type="submit"
              className="oneui-btn oneui-btn-primary w-full flex items-center justify-center gap-2 py-2.5 sm:py-2 text-sm sm:text-base"
              disabled={loading || !password}
            >
              {loading ? (
                <span className="flex items-center gap-2">
                  <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                  ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°...
                </span>
              ) : (
                <>
                  <Lock className="w-4 h-4" />
                  Ğ’Ğ¾Ğ¹Ñ‚Ğ¸
                </>
              )}
            </button>
          </form>
        </div>

        <div className="text-center mt-6 sm:mt-8">
          <p className="text-xs sm:text-sm oneui-text-muted">
            SwiftDevBot â€” created by <span className="font-semibold">SoverX</span>
          </p>
        </div>
      </div>
    </div>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/utils/userDisplay.ts ------------------------------
/**
 * Utility functions for displaying user information
 */

export interface UserDisplayInfo {
  first_name?: string;
  last_name?: string;
  username?: string;
}

/**
 * Get full name from user data
 * @param user User object with first_name, last_name, and optionally username
 * @returns Full name string or fallback to username or "User"
 */
export const getFullName = (user: UserDisplayInfo | null | undefined): string => {
  if (!user) return 'User';
  
  const firstName = user.first_name?.trim();
  const lastName = user.last_name?.trim();
  
  if (firstName && lastName) {
    return `${firstName} ${lastName}`;
  } else if (firstName) {
    return firstName;
  } else if (lastName) {
    return lastName;
  } else if (user.username) {
    return user.username;
  }
  
  return 'User';
};

/**
 * Get initials for avatar
 * @param user User object with first_name, last_name, and optionally username
 * @returns Initials string (e.g., "JD" for John Doe)
 */
export const getInitials = (user: UserDisplayInfo | null | undefined): string => {
  if (!user) return 'U';
  
  const firstName = user.first_name?.trim();
  const lastName = user.last_name?.trim();
  
  if (firstName && lastName) {
    return `${firstName[0]}${lastName[0]}`.toUpperCase();
  } else if (firstName) {
    return firstName[0].toUpperCase();
  } else if (lastName) {
    return lastName[0].toUpperCase();
  } else if (user.username) {
    return user.username[0].toUpperCase();
  }
  
  return 'U';
};

/**
 * Get display name with username as fallback
 * @param user User object
 * @returns Display name with username in parentheses if available
 */
export const getDisplayNameWithUsername = (user: UserDisplayInfo | null | undefined): string => {
  const fullName = getFullName(user);
  if (user?.username && fullName !== user.username) {
    return `${fullName} (@${user.username})`;
  }
  return fullName;
};




======================================================================

------------------------------ FILE: Systems/web/src/contexts/NavigationContext.tsx ------------------------------
import { createContext, useContext, ReactNode } from 'react';

type NavigationContextType = {
  navigateTo: (section: string) => void;
};

const NavigationContext = createContext<NavigationContextType | undefined>(undefined);

export const useNavigation = () => {
  const context = useContext(NavigationContext);
  if (!context) {
    throw new Error('useNavigation must be used within NavigationProvider');
  }
  return context;
};

export const NavigationProvider = ({
  children,
  navigateTo,
}: {
  children: ReactNode;
  navigateTo: (section: string) => void;
}) => {
  return (
    <NavigationContext.Provider value={{ navigateTo }}>
      {children}
    </NavigationContext.Provider>
  );
};




======================================================================

------------------------------ FILE: Systems/web/src/contexts/AuthContext.tsx ------------------------------
import { createContext, useContext, useEffect, useState, ReactNode } from 'react';
import { api, User, Profile } from '../api';

type AuthContextType = {
  user: User | null;
  profile: Profile | null;
  isAdmin: boolean;
  loading: boolean;
  cloudPasswordSetup: boolean | null; // null = checking, true = setup, false = not setup
  cloudPasswordVerified: boolean; // true = verified, false = not verified
  signInWithToken: (token: string) => Promise<void>;
  setupCloudPassword: (password: string) => Promise<void>;
  verifyCloudPassword: (password: string) => Promise<void>;
  signOut: () => Promise<void>;
};

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
};

export const AuthProvider = ({ children }: { children: ReactNode }) => {
  const [user, setUser] = useState<User | null>(null);
  const [profile, setProfile] = useState<Profile | null>(null);
  const [loading, setLoading] = useState(true);
  const [cloudPasswordSetup, setCloudPasswordSetup] = useState<boolean | null>(null);
  const [cloudPasswordVerified, setCloudPasswordVerified] = useState(false);

  const signInWithToken = async (token: string) => {
    try {
      console.log('signInWithToken called with token:', token ? 'present' : 'missing');
      const response = await api.loginWithToken(token);
      console.log('loginWithToken response:', response);
      setUser(response.user);
      const userProfile: Profile = {
        username: response.user.username,
        first_name: response.user.first_name,
        last_name: response.user.last_name,
        role: response.user.role,
      };
      setProfile(userProfile);
      localStorage.setItem('sdb_user', JSON.stringify(response.user));
      localStorage.setItem('sdb_token', response.token);
      console.log('Token saved to localStorage:', response.token ? 'yes' : 'no');

      // Check if cloud password is setup (async, don't block)
      api.checkCloudPasswordSetup()
        .then(result => {
          console.log('Cloud password setup check result:', result);
          setCloudPasswordSetup(result.isSetup);
        })
        .catch(error => {
          console.error('Error checking cloud password setup:', error);
          setCloudPasswordSetup(false);
        });
    } catch (error) {
      console.error('Token sign in error:', error);
      throw error;
    }
  };

  const setupCloudPassword = async (password: string) => {
    try {
      console.log('Setting up cloud password...');
      await api.setupCloudPassword(password);
      console.log('Cloud password setup successful');
      setCloudPasswordSetup(true);
      setCloudPasswordVerified(true);
      localStorage.setItem('sdb_cloud_password_setup', 'true');
      localStorage.setItem('sdb_cloud_password_verified', 'true');
      console.log('State updated: cloudPasswordSetup=true, cloudPasswordVerified=true');
    } catch (error) {
      console.error('Cloud password setup error:', error);
      throw error;
    }
  };

  const verifyCloudPassword = async (password: string) => {
    try {
      console.log('Calling api.verifyCloudPassword...');
      await api.verifyCloudPassword(password);
      console.log('API verifyCloudPassword successful, updating state...');
      setCloudPasswordVerified(true);
      localStorage.setItem('sdb_cloud_password_verified', 'true');
      console.log('State updated: cloudPasswordVerified=true');
      // Force a small delay to ensure state update propagates
      await new Promise(resolve => setTimeout(resolve, 100));
      console.log('State update complete, should trigger re-render');
    } catch (error) {
      console.error('Cloud password verification error:', error);
      throw error;
    }
  };

  useEffect(() => {
    // Check for token in URL (from Telegram bot)
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    if (token) {
      // Remove token from URL
      const newUrl = window.location.pathname;
      window.history.replaceState({}, '', newUrl);

      // Try to login with token
      signInWithToken(token).catch((error) => {
        console.error('Token login failed:', error);
        setLoading(false);
      }).finally(() => {
        setLoading(false);
      });
      return;
    }

    // Check for saved session
    const savedUser = localStorage.getItem('sdb_user');
    const cloudPasswordVerified = localStorage.getItem('sdb_cloud_password_verified');

    if (savedUser && cloudPasswordVerified === 'true') {
      try {
        const userData = JSON.parse(savedUser);
        setUser(userData);
        setProfile({
          username: userData.username,
          role: userData.role,
        });
        setCloudPasswordVerified(true);

        // Check cloud password setup status
        api.checkCloudPasswordSetup()
          .then(result => setCloudPasswordSetup(result.isSetup))
          .catch(() => {
            setCloudPasswordSetup(false);
            setLoading(false);
          })
          .finally(() => {
            setLoading(false);
          });
      } catch (error) {
        console.error('Error loading saved user:', error);
        localStorage.removeItem('sdb_user');
        localStorage.removeItem('sdb_token');
        localStorage.removeItem('sdb_cloud_password_verified');
        setCloudPasswordSetup(false);
        setLoading(false);
      }
    } else if (savedUser) {
      // User exists but cloud password not verified - need to verify
      try {
        const userData = JSON.parse(savedUser);
        setUser(userData);
        setProfile({
          username: userData.username,
          role: userData.role,
        });

        // Check cloud password setup status
        api.checkCloudPasswordSetup()
          .then(result => setCloudPasswordSetup(result.isSetup))
          .catch(() => {
            setCloudPasswordSetup(false);
            setLoading(false);
          })
          .finally(() => {
            setLoading(false);
          });
      } catch (error) {
        console.error('Error loading saved user:', error);
        localStorage.removeItem('sdb_user');
        localStorage.removeItem('sdb_token');
        setCloudPasswordSetup(false);
        setLoading(false);
      }
    } else {
      // No user - no need to check cloud password
      setCloudPasswordSetup(false);
      setLoading(false);
    }
  }, []);

  const signOut = async () => {
    try {
      await api.logout();
    } catch (error) {
      console.error('Sign out error:', error);
    } finally {
      setUser(null);
      setProfile(null);
      setCloudPasswordVerified(false);
      localStorage.removeItem('sdb_user');
      localStorage.removeItem('sdb_token');
      localStorage.removeItem('sdb_cloud_password_verified');
      localStorage.removeItem('sdb_cloud_password_setup');
    }
  };

  // Check for admin role - handle various cases
  const isAdminValue = profile?.role?.toLowerCase() === 'admin' ||
    profile?.role === 'admin' ||
    profile?.role === 'Admin' ||
    profile?.role === 'SUPERADMIN' ||
    profile?.role?.toLowerCase() === 'superadmin';

  // Debug logging
  console.log('AuthContext - profile:', profile);
  console.log('AuthContext - profile.role:', profile?.role);
  console.log('AuthContext - isAdmin:', isAdminValue);
  console.log('AuthContext - user:', user);

  const value = {
    user,
    profile,
    isAdmin: isAdminValue,
    loading,
    cloudPasswordSetup,
    cloudPasswordVerified,
    signInWithToken,
    setupCloudPassword,
    verifyCloudPassword,
    signOut,
  };

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
};



======================================================================

------------------------------ FILE: Systems/web/src/contexts/ThemeContext.tsx ------------------------------
import { createContext, useContext, useEffect, useState, ReactNode } from 'react';

type Theme = 'light' | 'dark';

type ThemeContextType = {
  theme: Theme;
  toggleTheme: () => void;
};

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within ThemeProvider');
  }
  return context;
};

export const ThemeProvider = ({ children }: { children: ReactNode }) => {
  const [theme, setTheme] = useState<Theme>(() => {
    const saved = localStorage.getItem('theme');
    return (saved as Theme) || 'dark';
  });

  useEffect(() => {
    localStorage.setItem('theme', theme);
    document.documentElement.setAttribute('data-theme', theme);
  }, [theme]);

  const toggleTheme = () => {
    setTheme((prev) => (prev === 'dark' ? 'light' : 'dark'));
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
};



======================================================================

------------------------------ FILE: Systems/web/src/contexts/I18nContext.tsx ------------------------------
import { createContext, useContext, useEffect, useState, ReactNode } from 'react';

type Locale = 'en' | 'ru' | 'ua';

type Translations = {
  [key: string]: string;
};

type I18nContextType = {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  t: (key: string, params?: Record<string, string | number>) => string;
  availableLocales: Locale[];
};

const I18nContext = createContext<I18nContextType | undefined>(undefined);

// Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
const loadTranslations = async (locale: Locale): Promise<Translations> => {
  try {
    const response = await fetch(`/locales/${locale}.json`);
    if (!response.ok) {
      throw new Error(`Failed to load translations for ${locale}`);
    }
    return await response.json();
  } catch (error) {
    console.error(`Error loading translations for ${locale}:`, error);
    // Fallback Ğ½Ğ° Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹
    if (locale !== 'en') {
      return loadTranslations('en');
    }
    return {};
  }
};

export const useI18n = () => {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error('useI18n must be used within I18nProvider');
  }
  return context;
};

export const I18nProvider = ({ children }: { children: ReactNode }) => {
  const [locale, setLocaleState] = useState<Locale>(() => {
    const saved = localStorage.getItem('web_locale') as Locale;
    return saved && ['en', 'ru', 'ua'].includes(saved) ? saved : 'en';
  });

  const [translations, setTranslations] = useState<Translations>({});
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadTranslations(locale).then((translations) => {
      console.log(`[I18n] Loaded translations for ${locale}:`, translations);
      setTranslations(translations);
      setLoading(false);
    }).catch((error) => {
      console.error(`[I18n] Error loading translations for ${locale}:`, error);
      setLoading(false);
    });
  }, [locale]);

  useEffect(() => {
    localStorage.setItem('web_locale', locale);
  }, [locale]);

  const setLocale = (newLocale: Locale) => {
    setLoading(true);
    setLocaleState(newLocale);
  };

  const t = (key: string, params?: Record<string, string | number>): string => {
    // ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ñ… ĞºĞ»ÑÑ‡ĞµĞ¹ Ñ‡ĞµÑ€ĞµĞ· Ñ‚Ğ¾Ñ‡ĞºÑƒ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "sidebar.home")
    const keys = key.split('.');
    let text: any = translations;
    
    for (const k of keys) {
      if (text && typeof text === 'object' && k in text) {
        text = text[k];
      } else {
        // Ğ•ÑĞ»Ğ¸ ĞºĞ»ÑÑ‡ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½, Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ ÑĞ°Ğ¼ ĞºĞ»ÑÑ‡
        if (Object.keys(translations).length > 0) {
          console.warn(`[I18n] Translation key not found: "${key}" for locale "${locale}"`);
        }
        return key;
      }
    }
    
    // Ğ•ÑĞ»Ğ¸ text Ğ½Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ°, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ ĞºĞ»ÑÑ‡
    if (typeof text !== 'string') {
      console.warn(`[I18n] Translation value is not a string for key "${key}":`, text);
      return key;
    }
    
    // Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ² Ñ‚ĞµĞºÑÑ‚Ğµ
    if (params) {
      Object.entries(params).forEach(([paramKey, paramValue]) => {
        text = text.replace(new RegExp(`\\{${paramKey}\\}`, 'g'), String(paramValue));
      });
    }
    
    return text;
  };

  const availableLocales: Locale[] = ['en', 'ru', 'ua'];

  if (loading && Object.keys(translations).length === 0) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="loading-spinner"></div>
      </div>
    );
  }

  return (
    <I18nContext.Provider value={{ locale, setLocale, t, availableLocales }}>
      {children}
    </I18nContext.Provider>
  );
};




======================================================================

------------------------------ FILE: Systems/web/auth/jwt_handler.py ------------------------------
"""
JWT Token Handler for SwiftDevBot Web Dashboard
Handles creation and validation of JWT tokens for web authentication.
"""

import os
import secrets
from datetime import datetime, timedelta
from typing import Optional, Dict, Any
from pathlib import Path

try:
    import jwt
    from jwt import PyJWTError
except ImportError:
    jwt = None
    PyJWTError = Exception


class JWTHandler:
    """JWT token handler for web authentication."""
    
    def __init__(self, secret_key: Optional[str] = None):
        """
        Initialize JWT handler.
        
        Args:
            secret_key: Secret key for JWT signing. If None, will be generated/loaded.
        """
        self.secret_key = secret_key or self._get_or_create_secret_key()
        self.algorithm = "HS256"
    
    def _get_or_create_secret_key(self) -> str:
        """
        Get or create JWT secret key.
        
        Returns:
            Secret key string
        """
        # Try to get from environment
        env_key = os.environ.get("SDB_JWT_SECRET_KEY")
        if env_key:
            return env_key
        
        # Try to load from config file
        config_path = Path(__file__).parent.parent.parent.parent / "config" / "security_keys.json"
        if config_path.exists():
            try:
                import json
                with open(config_path, 'r') as f:
                    config = json.load(f)
                    if 'jwt_secret' in config:
                        return config['jwt_secret']
            except Exception:
                pass
        
        # Generate new key (for development only - should be set in production)
        new_key = secrets.token_urlsafe(32)
        
        # Try to save to config file
        try:
            config_path.parent.mkdir(parents=True, exist_ok=True)
            import json
            config = {'jwt_secret': new_key}
            with open(config_path, 'w') as f:
                json.dump(config, f, indent=2)
        except Exception:
            pass
        
        return new_key
    
    async def create_access_token(
        self,
        user_id: int,
        username: str,
        role: str = "User",
        expires_in: timedelta = timedelta(minutes=5)
    ) -> str:
        """
        Create JWT access token.
        
        Args:
            user_id: Telegram user ID
            username: Username
            role: User role (Admin, Moderator, User)
            expires_in: Token expiration time
            
        Returns:
            JWT token string
        """
        if jwt is None:
            raise ImportError("PyJWT is required. Install it with: pip install PyJWT")
        
        now = datetime.utcnow()
        expire = now + expires_in
        
        payload: Dict[str, Any] = {
            "user_id": user_id,
            "username": username,
            "role": role.lower(),  # Normalize role to lowercase
            "iat": now,
            "exp": expire,
        }
        
        token = jwt.encode(payload, self.secret_key, algorithm=self.algorithm)
        return token
    
    async def verify_token(self, token: str) -> Optional[Dict[str, Any]]:
        """
        Verify JWT token and return payload.
        
        Args:
            token: JWT token string
            
        Returns:
            Token payload if valid, None otherwise
        """
        if jwt is None:
            raise ImportError("PyJWT is required. Install it with: pip install PyJWT")
        
        try:
            payload = jwt.decode(
                token,
                self.secret_key,
                algorithms=[self.algorithm]
            )
            return payload
        except PyJWTError:
            return None
    
    def get_user_info(self, payload: Dict[str, Any]) -> Dict[str, Any]:
        """
        Extract user info from token payload.
        
        Args:
            payload: JWT token payload
            
        Returns:
            User info dictionary
        """
        return {
            "user_id": payload.get("user_id"),
            "username": payload.get("username"),
            "role": payload.get("role", "user"),
        }


# Singleton instance
_jwt_handler: Optional[JWTHandler] = None


def get_jwt_handler() -> JWTHandler:
    """
    Get or create JWT handler instance.
    
    Returns:
        JWTHandler instance
    """
    global _jwt_handler
    if _jwt_handler is None:
        _jwt_handler = JWTHandler()
    return _jwt_handler



======================================================================

------------------------------ FILE: Systems/web/auth/__init__.py ------------------------------
"""Authentication module for SwiftDevBot web dashboard."""



======================================================================

------------------------------ FILE: Systems/web/public/locales/en.json ------------------------------
{
  "common": {
    "welcome": "Welcome to SwiftDevBot",
    "controlCenter": "Control Center",
    "loading": "Loading...",
    "error": "Error",
    "success": "Success",
    "cancel": "Cancel",
    "save": "Save",
    "delete": "Delete",
    "edit": "Edit",
    "close": "Close",
    "back": "Back",
    "next": "Next",
    "previous": "Previous",
    "search": "Search",
    "filter": "Filter",
    "refresh": "Refresh",
    "actions": "Actions",
    "status": "Status",
    "active": "Active",
    "inactive": "Inactive",
    "online": "Online",
    "offline": "Offline",
    "yes": "Yes",
    "no": "No",
    "never": "Never",
    "saving": "Saving..."
  },
  "header": {
    "signOut": "Sign Out",
    "switchTheme": "Switch theme"
  },
  "sidebar": {
    "home": "Home",
    "userMenu": "User",
    "missionControl": "Mission Control",
    "modules": "Modules",
    "modulesHub": "My Modules",
    "users": "Users",
    "statistics": "Statistics",
    "logs": "Logs",
    "settings": "Settings",
    "documentation": "Documentation",
    "adminPanel": "Administration",
    "coreConfig": "Core Config",
    "coreManagement": "Core Management",
    "services": "Services",
    "monitoring": "Monitoring",
    "notifications": "Notifications",
    "data": "My Data",
    "developer": "API Keys",
    "terminal": "Terminal",
    "security": "Security",
    "support": "Support",
    "cronJobs": "Scheduler",
    "securityOperations": "SOC",
    "databaseData": "Database",
    "broadcastStudio": "Broadcasts"
  },
  "home": {
    "title": "Welcome to SwiftDevBot",
    "subtitle": "Monitor and control your bot's operations in real-time",
    "customize": "Customize",
    "addWidgets": "Add Widgets",
    "noWidgets": "No active widgets. Add widgets to display information.",
    "widgetSettings": "Widget Settings",
    "widgetSettingsDesc": "Select widgets to display on the home page",
    "widget": {
      "stats": {
        "desc": "Displays bot statistics (modules, users, interactions)"
      },
      "activity": {
        "desc": "Shows recent activity in the system"
      },
      "systemHealth": {
        "desc": "Displays system health (CPU, memory, network, storage)"
      },
      "quickActions": {
        "desc": "Quick access to main dashboard sections"
      },
      "recentErrors": {
        "desc": "Recent errors from system logs"
      },
      "topModules": {
        "desc": "Top 5 active modules"
      },
      "userStats": {
        "desc": "User statistics (total, new, active)"
      },
      "servicesStatus": {
        "desc": "System services status"
      },
      "performance": {
        "desc": "Performance metrics (RPS, response time, errors)"
      },
      "announcements": {
        "desc": "System announcements and notifications"
      },
      "uptime": {
        "desc": "System uptime without restart"
      },
      "weather": {
        "desc": "Current weather and forecast"
      },
      "calendar": {
        "desc": "Calendar with events"
      },
      "notes": {
        "desc": "Quick notes"
      },
      "tasks": {
        "desc": "Task list and todos"
      },
      "time": {
        "desc": "Clock in different time zones"
      },
      "github": {
        "desc": "GitHub repositories"
      },
      "tools": {
        "desc": "Useful tools (calculator, converter, encoder)"
      }
    },
    "quickActions": {
      "users": "Users",
      "missionControl": "Mission Control",
      "settings": "Settings",
      "terminal": "Terminal",
      "security": "Security",
      "database": "Database",
      "broadcast": "Broadcasts",
      "logs": "Logs"
    },
    "noErrors": "No recent errors",
    "noModules": "No modules available",
    "noServices": "No services available",
    "noAnnouncements": "No announcements",
    "userStats": {
      "totalUsers": "Total Users",
      "newToday": "New Today",
      "active24h": "Active (24h)",
      "growth": "Growth"
    },
    "performance": {
      "rps": "RPS",
      "responseTime": "Response Time",
      "errorRate": "Error Rate",
      "queueSize": "Queue Size"
    },
    "uptime": {
      "days": "Days",
      "hours": "Hours",
      "minutes": "Minutes"
    },
    "announcements": {
      "maintenance": "Scheduled Maintenance",
      "maintenanceDesc": "System maintenance scheduled for tomorrow at 2:00 AM",
      "update": "System Update",
      "updateDesc": "New features have been added to the dashboard"
    },
    "weather": {
      "error": "Failed to load weather",
      "noData": "No weather data",
      "humidity": "Humidity",
      "wind": "Wind",
      "feelsLike": "Feels like"
    },
    "calendar": {
      "january": "January",
      "february": "February",
      "march": "March",
      "april": "April",
      "may": "May",
      "june": "June",
      "july": "July",
      "august": "August",
      "september": "September",
      "october": "October",
      "november": "November",
      "december": "December",
      "sun": "Sun",
      "mon": "Mon",
      "tue": "Tue",
      "wed": "Wed",
      "thu": "Thu",
      "fri": "Fri",
      "sat": "Sat",
      "upcoming": "Upcoming Events"
    },
    "notes": {
      "placeholder": "Add a note...",
      "noNotes": "No notes yet. Add your first note!"
    },
    "tasks": {
      "placeholder": "Add a task...",
      "all": "All",
      "active": "Active",
      "completed": "Completed",
      "noTasks": "No tasks yet. Add your first task!",
      "noFilteredTasks": "No tasks found",
      "completed": "completed",
      "priority": {
        "low": "Low",
        "medium": "Medium",
        "high": "High"
      }
    },
    "time": {
      "otherZones": "Other Time Zones"
    },
    "github": {
      "title": "GitHub Repositories",
      "usernamePlaceholder": "GitHub username",
      "load": "Load Repositories",
      "error": "Failed to load repositories",
      "noRepos": "No repositories found",
      "change": "Change",
      "changeUser": "Change username"
    },
    "tools": {
      "calculator": "Calculator",
      "converter": "Converter",
      "encoder": "Encoder",
      "formatter": "Formatter",
      "calculate": "Calculate",
      "result": "Result",
      "input": "Input",
      "output": "Output",
      "encode": "Encode",
      "decode": "Decode",
      "formatterComingSoon": "Formatter coming soon"
    },
    "activeModules": "Active Modules",
    "totalUsers": "Total Users",
    "todayInteractions": "Today Interactions",
    "systemStatus": "System Status",
    "recentActivity": "Recent Activity",
    "systemHealth": "System Health",
    "cpuUsage": "CPU Usage",
    "memory": "Memory",
    "network": "Network",
    "storage": "Storage"
  },
  "statistics": {
    "title": "Statistics",
    "subtitle": "Real-time analytics and metrics",
    "messagesToday": "Messages Today",
    "totalUsers": "Total Users",
    "activeModules": "Active Modules",
    "totalModules": "Total Modules",
    "vsPrevious": "vs previous",
    "activityChart": "Activity Chart",
    "hourlyActivity": "Hourly Activity",
    "trends": "Trends"
  },
  "modules": {
    "title": "Bot Modules",
    "subtitle": "Manage your bot's functionality modules",
    "activate": "Activate",
    "deactivate": "Deactivate",
    "noModules": "No modules found",
    "noModulesDesc": "Modules will appear here once they are installed",
    "moduleActivated": "Module {name} activated",
    "moduleDeactivated": "Module {name} deactivated",
    "errorToggle": "Failed to toggle module status"
  },
  "users": {
    "title": "Bot Users",
    "subtitle": "Manage users interacting with your bot",
    "blockUser": "Block User",
    "unblockUser": "Unblock User",
    "noUsers": "No users yet",
    "noUsersDesc": "Users will appear here once they interact with your bot",
    "userId": "User ID",
    "role": "Role",
    "userBlocked": "User {id} blocked",
    "userUnblocked": "User {id} unblocked",
    "errorToggle": "Failed to change block status"
  },
  "auth": {
    "loginRequired": "Login required",
    "loginViaTelegram": "To access the panel, use the /login command in the Telegram bot",
    "loginLink": "You will receive a link to access the web panel",
    "invalidToken": "Invalid or expired token",
    "sessionExpired": "Session expired. Please log in again."
  },
  "errors": {
    "loadError": "Failed to load data",
    "saveError": "Failed to save changes",
    "networkError": "Network error. Please check your connection.",
    "unknownError": "An unknown error occurred"
  },
  "userDashboard": {
    "welcome": "Welcome, {name}!",
    "subtitle": "Control center for your bot interaction",
    "accountActive": "Active",
    "quickActions": "Quick Actions",
    "newChat": "New Chat",
    "myFiles": "My Files",
    "apiKeys": "API Keys",
    "security": "Security",
    "activeModules": "Active Modules",
    "totalCommands": "Commands Today",
    "storageUsed": "Storage Used",
    "recentActivity": "Recent Activity",
    "announcements": "Announcements",
    "announcement": {
      "newFeatures": "New Features",
      "newFeaturesDesc": "New features have been added to improve your experience"
    },
    "activity": {
      "command": "Command executed",
      "fileUpload": "File uploaded",
      "settings": "Settings changed",
      "settingsChanged": "Profile settings"
    }
  },
  "modulesHub": {
    "title": "My Modules",
    "subtitle": "Manage available services",
    "active": "Active",
    "notConfigured": "Not Configured",
    "requiresSubscription": "Requires Subscription",
    "open": "Open",
    "configure": "Configure",
    "noModules": "No modules found",
    "noModulesDesc": "You don't have any modules installed yet. Modules can be installed via CLI command 'sdb module create' or manually added to the Modules/ folder."
  },
  "security": {
    "title": "Security",
    "subtitle": "Manage account security",
    "cloudPassword": "Cloud Password",
    "changePassword": "Change Password",
    "activeSessions": "Active Sessions",
    "sessionHistory": "Access History",
    "terminateAll": "Terminate All Sessions",
    "terminateSession": "Terminate Session",
    "device": "Device",
    "location": "Location",
    "lastActivity": "Last Activity",
    "currentSession": "Current Session",
    "noSessions": "No active sessions",
    "confirmTerminateAll": "Terminate all sessions except current?",
    "passwordsDoNotMatch": "Passwords do not match",
    "passwordTooShort": "Password must be at least 8 characters",
    "passwordChanged": "Password changed successfully"
  },
  "notifications": {
    "title": "Notifications",
    "subtitle": "Manage notifications",
    "channels": "Delivery Channels",
    "telegram": "Telegram",
    "email": "Email",
    "push": "Browser Push",
    "types": "Notification Types",
    "news": "News",
    "security": "Security",
    "tasks": "Task Completion",
    "marketing": "Marketing",
    "doNotDisturb": "Do Not Disturb",
    "schedule": "Schedule"
  },
  "data": {
    "title": "My Data",
    "subtitle": "Manage your data",
    "commandHistory": "Command History",
    "uploadedFiles": "Uploaded Files",
    "exportData": "Export Data",
    "downloadArchive": "Download Archive",
    "privacy": "Privacy",
    "clearHistory": "Clear History",
    "deleteAccount": "Delete Account",
    "command": "Command",
    "date": "Date",
    "status": "Status",
    "fileName": "File Name",
    "size": "Size",
    "uploadDate": "Upload Date",
    "download": "Download",
    "delete": "Delete",
    "noCommandHistory": "Command history is empty",
    "noFiles": "No uploaded files"
  },
  "support": {
    "title": "Support",
    "subtitle": "Get help and support",
    "createTicket": "Create Ticket",
    "myTickets": "My Tickets",
    "faq": "Frequently Asked Questions",
    "subject": "Subject",
    "message": "Message",
    "submit": "Submit",
    "ticketId": "Ticket ID",
    "status": "Status",
    "created": "Created",
    "updated": "Updated",
    "open": "Open",
    "closed": "Closed",
    "pending": "Pending",
    "noTickets": "No tickets created",
    "ticketCreated": "Ticket created successfully"
  },
  "developer": {
    "title": "API Keys",
    "subtitle": "Manage personal access tokens",
    "generateToken": "Generate Token",
    "myTokens": "My Tokens",
    "tokenName": "Name",
    "created": "Created",
    "lastUsed": "Last Used",
    "actions": "Actions",
    "copy": "Copy",
    "revoke": "Revoke",
    "tokenValue": "Token Value",
    "warning": "Warning: token will be shown only once!",
    "apiDocs": "API Documentation",
    "openDocs": "Open Swagger",
    "noTokens": "No tokens created",
    "confirmRevoke": "Revoke this token?",
    "copyToken": "Copy token",
    "revokeToken": "Revoke token"
  },
  "terminal": {
    "title": "Command Console",
    "subtitle": "Execute bot commands directly in browser",
    "placeholder": "Enter command (e.g., /start, /help)...",
    "execute": "Execute",
    "clear": "Clear",
    "history": "Command History",
    "noHistory": "Command history is empty"
  },
  "cronJobs": {
    "title": "Scheduled Jobs",
    "subtitle": "View and manage scheduled tasks (APScheduler)",
    "scheduledJobs": "Scheduled Jobs",
    "jobName": "Job Name",
    "function": "Function",
    "trigger": "Trigger",
    "nextRun": "Next Run",
    "noJobs": "No scheduled jobs",
    "noJobsDesc": "No cron jobs are currently scheduled.",
    "never": "Never"
  },
  "soc": {
    "title": "Security Operations Center",
    "subtitle": "Monitor and manage security events, access control, and threats",
    "auditLogs": "Audit Logs",
    "accessControl": "Access Control",
    "statistics": "Statistics",
    "filters": "Filters",
    "moduleName": "Module Name",
    "filterByModule": "Filter by module...",
    "eventType": "Event Type",
    "severity": "Severity",
    "allTypes": "All Types",
    "allSeverities": "All Severities",
    "timestamp": "Timestamp",
    "module": "Module",
    "user": "User",
    "ip": "IP Address",
    "status": "Status",
    "noLogs": "No audit logs found",
    "noLogsDesc": "No security events match your filters.",
    "apiKeys": "API Keys",
    "noApiKeys": "No API keys",
    "noApiKeysDesc": "No API keys are configured. Use CLI to create keys.",
    "keyName": "Key Name",
    "permissions": "Permissions",
    "created": "Created",
    "expires": "Expires",
    "lastUsed": "Last Used",
    "usageCount": "Usage Count",
    "totalEvents": "Total Events",
    "violations": "Violations",
    "eventTypes": "Event Types",
    "modules": "Modules",
    "eventsByType": "Events by Type",
    "eventsBySeverity": "Events by Severity",
    "count": "Count",
    "noStats": "No statistics available"
  },
  "database": {
    "title": "Database & Data",
    "subtitle": "SQL Runner, Migrations, and Cache Management",
    "sqlRunner": "SQL Runner",
    "migrations": "Migrations",
    "cache": "Cache",
    "cacheExplorer": "Cache Explorer",
    "query": "SQL Query (SELECT only)",
    "sqlNote": "Only SELECT queries are allowed for security.",
    "execute": "Execute",
    "results": "Results",
    "rows": "rows",
    "revision": "Revision",
    "description": "Description",
    "status": "Status",
    "current": "Current",
    "pending": "Pending",
    "upgrade": "Upgrade",
    "downgrade": "Downgrade",
    "confirmMigration": "Execute migration?",
    "noMigrations": "No migrations found",
    "searchPattern": "Search pattern (e.g., user:* or *)...",
    "search": "Search",
    "key": "Key",
    "ttl": "TTL",
    "noExpiry": "No expiry",
    "noCacheKeys": "No cache keys found",
    "noCacheKeysDesc": "No keys match your search pattern.",
    "flushCache": "Flush Cache",
    "confirmFlushCache": "Flush all cache? This action cannot be undone.",
    "cacheFlushed": "Cache flushed successfully"
  },
  "broadcast": {
    "title": "Broadcast Studio",
    "subtitle": "Create and send messages to users",
    "create": "Create Broadcast",
    "history": "History",
    "messageEditor": "Message Editor",
    "message": "Message",
    "messagePlaceholder": "Enter your message here...",
    "messageNote": "Supports Markdown formatting. Use /help for formatting guide.",
    "targeting": "Targeting",
    "targetType": "Target Type",
    "targetAll": "All Users",
    "targetAdmins": "Administrators Only",
    "targetRole": "By Role",
    "targetActive": "Active Users (Last N days)",
    "targetInactive": "Inactive Users (No activity for N days)",
    "targetNewUsers": "New Users (Registered in last N days)",
    "targetLanguage": "By Language",
    "targetActiveStatus": "By Active Status",
    "days": "Days",
    "language": "Language Code",
    "selectLanguage": "Select Language",
    "role": "Role",
    "selectRole": "Select Role",
    "roleUser": "User",
    "roleModerator": "Moderator",
    "roleAdmin": "Admin",
    "roleSuperAdmin": "Super Admin",
    "activeStatus": "Active Status",
    "selectActiveStatus": "Select Status",
    "statusActive": "Active Users",
    "statusInactive": "Inactive Users",
    "activeDaysNote": "Users who were active in the last N days",
    "inactiveDaysNote": "Users who have not been active for N days",
    "newUsersDaysNote": "Users registered in the last N days",
    "roleRequired": "Role is required",
    "activeStatusRequired": "Active status is required",
    "scheduling": "Scheduling",
    "sendTime": "Send Time",
    "scheduleNote": "Leave empty to send immediately",
    "send": "Send Broadcast",
    "progress": "Broadcast Progress",
    "sent": "Sent",
    "errors": "Errors",
    "id": "ID",
    "target": "Target",
    "recipients": "Recipients",
    "status": "Status",
    "created": "Created",
    "noBroadcasts": "No broadcasts",
    "noBroadcastsDesc": "No broadcasts have been sent yet.",
    "broadcastCreated": "Broadcast created successfully",
    "messageRequired": "Message is required",
    "daysRequired": "Number of days is required for active users filter",
    "languageRequired": "Language code is required"
  }
}




======================================================================

------------------------------ FILE: Systems/web/public/locales/ru.json ------------------------------
{
  "common": {
    "welcome": "Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² SwiftDevBot",
    "controlCenter": "ĞŸĞ°Ğ½ĞµĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ",
    "loading": "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...",
    "error": "ĞÑˆĞ¸Ğ±ĞºĞ°",
    "success": "Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾",
    "cancel": "ĞÑ‚Ğ¼ĞµĞ½Ğ°",
    "save": "Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ",
    "delete": "Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ",
    "edit": "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
    "close": "Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ",
    "back": "ĞĞ°Ğ·Ğ°Ğ´",
    "next": "Ğ”Ğ°Ğ»ĞµĞµ",
    "previous": "ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹",
    "search": "ĞŸĞ¾Ğ¸ÑĞº",
    "filter": "Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€",
    "refresh": "ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ",
    "actions": "Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ",
    "status": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ",
    "active": "ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½",
    "inactive": "ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½",
    "online": "ĞĞ½Ğ»Ğ°Ğ¹Ğ½",
    "offline": "ĞÑ„Ğ»Ğ°Ğ¹Ğ½",
    "yes": "Ğ”Ğ°",
    "no": "ĞĞµÑ‚",
    "never": "ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ°",
    "saving": "Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ..."
  },
  "header": {
    "signOut": "Ğ’Ñ‹Ğ¹Ñ‚Ğ¸",
    "switchTheme": "ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞ¼Ñƒ"
  },
  "sidebar": {
    "home": "Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ",
    "userMenu": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ",
    "missionControl": "Mission Control",
    "modules": "ĞœĞ¾Ğ´ÑƒĞ»Ğ¸",
    "modulesHub": "ĞœĞ¾Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸",
    "users": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸",
    "statistics": "Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°",
    "logs": "Ğ›Ğ¾Ğ³Ğ¸",
    "settings": "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸",
    "documentation": "Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ",
    "adminPanel": "ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ",
    "coreConfig": "ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ´Ñ€Ğ°",
    "coreManagement": "Core Management",
    "services": "Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹",
    "monitoring": "ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³",
    "notifications": "Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ",
    "data": "ĞœĞ¾Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ",
    "developer": "API ĞšĞ»ÑÑ‡Ğ¸",
    "terminal": "ĞšĞ¾Ğ½ÑĞ¾Ğ»ÑŒ",
    "security": "Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ",
    "support": "ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°",
    "cronJobs": "ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº",
    "securityOperations": "SOC",
    "databaseData": "Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…",
    "broadcastStudio": "Ğ Ğ°ÑÑÑ‹Ğ»ĞºĞ¸"
  },
  "home": {
    "title": "Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² SwiftDevBot",
    "subtitle": "ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ° Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸",
    "customize": "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ",
    "addWidgets": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ğ¸Ğ´Ğ¶ĞµÑ‚Ñ‹",
    "noWidgets": "ĞĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ²Ğ¸Ğ´Ğ¶ĞµÑ‚Ğ¾Ğ². Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ²Ğ¸Ğ´Ğ¶ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸.",
    "widgetSettings": "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ²Ğ¸Ğ´Ğ¶ĞµÑ‚Ğ¾Ğ²",
    "widgetSettingsDesc": "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ²Ğ¸Ğ´Ğ¶ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ½Ğ° Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ",
    "widget": {
      "stats": {
        "desc": "ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ±Ğ¾Ñ‚Ğ° (Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸, Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸, Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ)"
      },
      "activity": {
        "desc": "ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ"
      },
      "systemHealth": {
        "desc": "ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ (CPU, Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ, ÑĞµÑ‚ÑŒ, Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ)"
      },
      "quickActions": {
        "desc": "Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğ¼ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°Ğ¼ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸"
      },
      "recentErrors": {
        "desc": "ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¸Ğ· Ğ»Ğ¾Ğ³Ğ¾Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹"
      },
      "topModules": {
        "desc": "Ğ¢Ğ¾Ğ¿-5 Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"
      },
      "userStats": {
        "desc": "Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ (Ğ²ÑĞµĞ³Ğ¾, Ğ½Ğ¾Ğ²Ñ‹Ñ…, Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ…)"
      },
      "servicesStatus": {
        "desc": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²"
      },
      "performance": {
        "desc": "ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (RPS, Ğ²Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°, Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸)"
      },
      "announcements": {
        "desc": "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ"
      },
      "uptime": {
        "desc": "Ğ’Ñ€ĞµĞ¼Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ±ĞµĞ· Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸"
      },
      "weather": {
        "desc": "Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğ° Ğ¸ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·"
      },
      "calendar": {
        "desc": "ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ÑŒ Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼Ğ¸"
      },
      "notes": {
        "desc": "Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸"
      },
      "tasks": {
        "desc": "Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ·Ğ°Ğ´Ğ°Ñ‡ Ğ¸ Ğ´ĞµĞ»"
      },
      "time": {
        "desc": "Ğ§Ğ°ÑÑ‹ Ğ² Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ‡Ğ°ÑĞ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾ÑÑĞ°Ñ…"
      },
      "github": {
        "desc": "Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸ GitHub"
      },
      "tools": {
        "desc": "ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ (ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€, ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚ĞµÑ€, ĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº)"
      }
    },
    "quickActions": {
      "users": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸",
      "missionControl": "Mission Control",
      "settings": "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸",
      "terminal": "Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»",
      "security": "Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ",
      "database": "Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…",
      "broadcast": "Ğ Ğ°ÑÑÑ‹Ğ»ĞºĞ¸",
      "logs": "Ğ›Ğ¾Ğ³Ğ¸"
    },
    "noErrors": "ĞĞµÑ‚ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº",
    "noModules": "ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹",
    "noServices": "ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²",
    "noAnnouncements": "ĞĞµÑ‚ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ğ¹",
    "userStats": {
      "totalUsers": "Ğ’ÑĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹",
      "newToday": "ĞĞ¾Ğ²Ñ‹Ñ… ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ",
      "active24h": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… (24Ñ‡)",
      "growth": "Ğ Ğ¾ÑÑ‚"
    },
    "performance": {
      "rps": "RPS",
      "responseTime": "Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°",
      "errorRate": "ĞÑˆĞ¸Ğ±ĞºĞ¸",
      "queueSize": "ĞÑ‡ĞµÑ€ĞµĞ´ÑŒ"
    },
    "uptime": {
      "days": "Ğ”Ğ½ĞµĞ¹",
      "hours": "Ğ§Ğ°ÑĞ¾Ğ²",
      "minutes": "ĞœĞ¸Ğ½ÑƒÑ‚"
    },
    "announcements": {
      "maintenance": "ĞŸĞ»Ğ°Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¾Ğ±ÑĞ»ÑƒĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ",
      "maintenanceDesc": "ĞŸĞ»Ğ°Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¾Ğ±ÑĞ»ÑƒĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ½Ğ° Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ° Ğ² 2:00",
      "update": "ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹",
      "updateDesc": "Ğ’ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸"
    },
    "weather": {
      "error": "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ñ‹",
      "noData": "ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğµ",
      "humidity": "Ğ’Ğ»Ğ°Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ",
      "wind": "Ğ’ĞµÑ‚ĞµÑ€",
      "feelsLike": "ĞÑ‰ÑƒÑ‰Ğ°ĞµÑ‚ÑÑ"
    },
    "calendar": {
      "january": "Ğ¯Ğ½Ğ²Ğ°Ñ€ÑŒ",
      "february": "Ğ¤ĞµĞ²Ñ€Ğ°Ğ»ÑŒ",
      "march": "ĞœĞ°Ñ€Ñ‚",
      "april": "ĞĞ¿Ñ€ĞµĞ»ÑŒ",
      "may": "ĞœĞ°Ğ¹",
      "june": "Ğ˜ÑĞ½ÑŒ",
      "july": "Ğ˜ÑĞ»ÑŒ",
      "august": "ĞĞ²Ğ³ÑƒÑÑ‚",
      "september": "Ğ¡ĞµĞ½Ñ‚ÑĞ±Ñ€ÑŒ",
      "october": "ĞĞºÑ‚ÑĞ±Ñ€ÑŒ",
      "november": "ĞĞ¾ÑĞ±Ñ€ÑŒ",
      "december": "Ğ”ĞµĞºĞ°Ğ±Ñ€ÑŒ",
      "sun": "Ğ’Ñ",
      "mon": "ĞŸĞ½",
      "tue": "Ğ’Ñ‚",
      "wed": "Ğ¡Ñ€",
      "thu": "Ğ§Ñ‚",
      "fri": "ĞŸÑ‚",
      "sat": "Ğ¡Ğ±",
      "upcoming": "ĞŸÑ€ĞµĞ´ÑÑ‚Ğ¾ÑÑ‰Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ"
    },
    "notes": {
      "placeholder": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºÑƒ...",
      "noNotes": "ĞĞµÑ‚ Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¾Ğº. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºÑƒ!"
    },
    "tasks": {
      "placeholder": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ...",
      "all": "Ğ’ÑĞµ",
      "active": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ",
      "completed": "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ğµ",
      "noTasks": "ĞĞµÑ‚ Ğ·Ğ°Ğ´Ğ°Ñ‡. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ!",
      "noFilteredTasks": "Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹",
      "completed": "Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾",
      "priority": {
        "low": "ĞĞ¸Ğ·ĞºĞ¸Ğ¹",
        "medium": "Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹",
        "high": "Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹"
      }
    },
    "time": {
      "otherZones": "Ğ”Ñ€ÑƒĞ³Ğ¸Ğµ Ñ‡Ğ°ÑĞ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾ÑÑĞ°"
    },
    "github": {
      "title": "Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸ GitHub",
      "usernamePlaceholder": "Ğ˜Ğ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ GitHub",
      "load": "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸",
      "error": "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸ĞµĞ²",
      "noRepos": "Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹",
      "change": "Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ",
      "changeUser": "Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"
    },
    "tools": {
      "calculator": "ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€",
      "converter": "ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚ĞµÑ€",
      "encoder": "ĞšĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº",
      "formatter": "Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‚ĞµÑ€",
      "calculate": "Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚ÑŒ",
      "result": "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚",
      "input": "Ğ’Ğ²Ğ¾Ğ´",
      "output": "Ğ’Ñ‹Ğ²Ğ¾Ğ´",
      "encode": "ĞšĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
      "decode": "Ğ”ĞµĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
      "formatterComingSoon": "Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‚ĞµÑ€ ÑĞºĞ¾Ñ€Ğ¾ Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑÑ"
    },
    "activeModules": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸",
    "totalUsers": "Ğ’ÑĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹",
    "todayInteractions": "Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ",
    "systemStatus": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹",
    "recentActivity": "ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ",
    "systemHealth": "Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹",
    "cpuUsage": "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ CPU",
    "memory": "ĞŸĞ°Ğ¼ÑÑ‚ÑŒ",
    "network": "Ğ¡ĞµÑ‚ÑŒ",
    "storage": "Ğ¥Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ"
  },
  "statistics": {
    "title": "Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°",
    "subtitle": "ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸",
    "messagesToday": "Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ",
    "totalUsers": "Ğ’ÑĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹",
    "activeModules": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸",
    "totalModules": "Ğ’ÑĞµĞ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹",
    "vsPrevious": "Ğº Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¼Ñƒ",
    "activityChart": "Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸",
    "hourlyActivity": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾ Ñ‡Ğ°ÑĞ°Ğ¼",
    "trends": "Ğ¢Ñ€ĞµĞ½Ğ´Ñ‹"
  },
  "modules": {
    "title": "ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ±Ğ¾Ñ‚Ğ°",
    "subtitle": "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ°",
    "activate": "ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
    "deactivate": "Ğ”ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
    "noModules": "ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹",
    "noModulesDesc": "ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ Ğ·Ğ´ĞµÑÑŒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¸Ñ… ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸",
    "moduleActivated": "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {name} Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½",
    "moduleDeactivated": "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {name} Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½",
    "errorToggle": "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"
  },
  "users": {
    "title": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ±Ğ¾Ñ‚Ğ°",
    "subtitle": "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸, Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¼Ğ¸ Ñ Ğ²Ğ°ÑˆĞ¸Ğ¼ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼",
    "blockUser": "Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ",
    "unblockUser": "Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ",
    "noUsers": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚",
    "noUsersDesc": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ Ğ·Ğ´ĞµÑÑŒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ñ Ğ²Ğ°ÑˆĞ¸Ğ¼ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼",
    "userId": "ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ",
    "role": "Ğ Ğ¾Ğ»ÑŒ",
    "userBlocked": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {id} Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½",
    "userUnblocked": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ {id} Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½",
    "errorToggle": "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸"
  },
  "auth": {
    "loginRequired": "Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ²Ñ…Ğ¾Ğ´",
    "loginViaTelegram": "Ğ”Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /login Ğ² Telegram Ğ±Ğ¾Ñ‚Ğµ",
    "loginLink": "Ğ’Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚Ğµ ÑÑÑ‹Ğ»ĞºÑƒ Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸",
    "invalidToken": "ĞĞµĞ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ»Ğ¸ Ğ¸ÑÑ‚ĞµĞºÑˆĞ¸Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½",
    "sessionExpired": "Ğ¡ĞµÑÑĞ¸Ñ Ğ¸ÑÑ‚ĞµĞºĞ»Ğ°. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°."
  },
  "errors": {
    "loadError": "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ",
    "saveError": "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ",
    "networkError": "ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ‚Ğ¸. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ.",
    "unknownError": "ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°"
  },
  "userDashboard": {
    "welcome": "Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ, {name}!",
    "subtitle": "Ğ¦ĞµĞ½Ñ‚Ñ€ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²Ğ°ÑˆĞ¸Ğ¼ Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸ĞµĞ¼ Ñ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼",
    "accountActive": "ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½",
    "quickActions": "Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ",
    "newChat": "ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚",
    "myFiles": "ĞœĞ¾Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ñ‹",
    "apiKeys": "API ĞšĞ»ÑÑ‡Ğ¸",
    "security": "Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ",
    "activeModules": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸",
    "totalCommands": "ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ",
    "storageUsed": "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ¼ĞµÑÑ‚Ğ°",
    "recentActivity": "ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ",
    "announcements": "ĞĞ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ñ",
    "announcement": {
      "newFeatures": "ĞĞ¾Ğ²Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸",
      "newFeaturesDesc": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ¾Ğ¿Ñ‹Ñ‚Ğ°"
    },
    "activity": {
      "command": "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°",
      "fileUpload": "Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ Ñ„Ğ°Ğ¹Ğ»",
      "settings": "Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸",
      "settingsChanged": "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ"
    }
  },
  "modulesHub": {
    "title": "ĞœĞ¾Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸",
    "subtitle": "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğ¼Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸",
    "active": "ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½",
    "notConfigured": "ĞĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½",
    "requiresSubscription": "Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸",
    "open": "ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ",
    "configure": "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ",
    "noModules": "ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹",
    "noModulesDesc": "Ğ£ Ğ²Ğ°Ñ Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹. ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ 'sdb module create' Ğ¸Ğ»Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ² Ğ¿Ğ°Ğ¿ĞºÑƒ Modules/."
  },
  "security": {
    "title": "Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ",
    "subtitle": "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒÑ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°",
    "cloudPassword": "ĞĞ±Ğ»Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ",
    "changePassword": "Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ",
    "activeSessions": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑĞµÑÑĞ¸Ğ¸",
    "sessionHistory": "Ğ–ÑƒÑ€Ğ½Ğ°Ğ» Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°",
    "terminateAll": "Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ Ğ²ÑĞµ ÑĞµĞ°Ğ½ÑÑ‹",
    "terminateSession": "Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ ÑĞµĞ°Ğ½Ñ",
    "device": "Ğ£ÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾",
    "location": "ĞœĞµÑÑ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ",
    "lastActivity": "ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ",
    "currentSession": "Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ÑĞµÑÑĞ¸Ñ",
    "noSessions": "ĞĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑĞµÑÑĞ¸Ğ¹",
    "confirmTerminateAll": "Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ Ğ²ÑĞµ ÑĞµÑÑĞ¸Ğ¸ ĞºÑ€Ğ¾Ğ¼Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹?",
    "passwordsDoNotMatch": "ĞŸĞ°Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ÑÑ‚",
    "passwordTooShort": "ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğµ Ğ¼ĞµĞ½ĞµĞµ 8 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²",
    "passwordChanged": "ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½"
  },
  "notifications": {
    "title": "Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ",
    "subtitle": "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸",
    "channels": "ĞšĞ°Ğ½Ğ°Ğ»Ñ‹ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸",
    "telegram": "Telegram",
    "email": "Email",
    "push": "Push Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ",
    "types": "Ğ¢Ğ¸Ğ¿Ñ‹ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹",
    "news": "ĞĞ¾Ğ²Ğ¾ÑÑ‚Ğ¸",
    "security": "Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ",
    "tasks": "Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡",
    "marketing": "ĞœĞ°Ñ€ĞºĞµÑ‚Ğ¸Ğ½Ğ³",
    "doNotDisturb": "ĞĞµ Ğ±ĞµÑĞ¿Ğ¾ĞºĞ¾Ğ¸Ñ‚ÑŒ",
    "schedule": "Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ"
  },
  "data": {
    "title": "ĞœĞ¾Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ",
    "subtitle": "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²Ğ°ÑˆĞ¸Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸",
    "commandHistory": "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²",
    "uploadedFiles": "Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹",
    "exportData": "Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…",
    "downloadArchive": "Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ°Ñ€Ñ…Ğ¸Ğ²",
    "privacy": "ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ",
    "clearHistory": "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ",
    "deleteAccount": "Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚",
    "command": "ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°",
    "date": "Ğ”Ğ°Ñ‚Ğ°",
    "status": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ",
    "fileName": "Ğ˜Ğ¼Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°",
    "size": "Ğ Ğ°Ğ·Ğ¼ĞµÑ€",
    "uploadDate": "Ğ”Ğ°Ñ‚Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸",
    "download": "Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ",
    "delete": "Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ",
    "noCommandHistory": "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ¿ÑƒÑÑ‚Ğ°",
    "noFiles": "ĞĞµÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²"
  },
  "support": {
    "title": "ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°",
    "subtitle": "ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ Ğ¸ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ",
    "createTicket": "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ¸ĞºĞµÑ‚",
    "myTickets": "ĞœĞ¾Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ",
    "faq": "Ğ§Ğ°ÑÑ‚Ğ¾ Ğ·Ğ°Ğ´Ğ°Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹",
    "subject": "Ğ¢ĞµĞ¼Ğ°",
    "message": "Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ",
    "submit": "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ",
    "ticketId": "ID Ñ‚Ğ¸ĞºĞµÑ‚Ğ°",
    "status": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ",
    "created": "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½",
    "updated": "ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½",
    "open": "ĞÑ‚ĞºÑ€Ñ‹Ñ‚",
    "closed": "Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚",
    "pending": "Ğ’ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğ¸",
    "noTickets": "ĞĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ‚Ğ¸ĞºĞµÑ‚Ğ¾Ğ²",
    "ticketCreated": "Ğ¢Ğ¸ĞºĞµÑ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½"
  },
  "developer": {
    "title": "API ĞšĞ»ÑÑ‡Ğ¸",
    "subtitle": "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ°Ğ¼Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°",
    "generateToken": "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½",
    "myTokens": "ĞœĞ¾Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹",
    "tokenName": "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ",
    "created": "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½",
    "lastUsed": "ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ",
    "actions": "Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ",
    "copy": "ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
    "revoke": "ĞÑ‚Ğ¾Ğ·Ğ²Ğ°Ñ‚ÑŒ",
    "tokenValue": "Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ°",
    "warning": "Ğ’Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ: Ñ‚Ğ¾ĞºĞµĞ½ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·!",
    "apiDocs": "Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ API",
    "openDocs": "ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Swagger",
    "noTokens": "ĞĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²",
    "confirmRevoke": "ĞÑ‚Ğ¾Ğ·Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ Ñ‚Ğ¾ĞºĞµĞ½?",
    "copyToken": "ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½",
    "revokeToken": "ĞÑ‚Ğ¾Ğ·Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½"
  },
  "terminal": {
    "title": "ĞšĞ¾Ğ½ÑĞ¾Ğ»ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´",
    "subtitle": "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞ¹Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ±Ğ¾Ñ‚Ğ° Ğ¿Ñ€ÑĞ¼Ğ¾ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ",
    "placeholder": "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, /start, /help)...",
    "execute": "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ",
    "clear": "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ",
    "history": "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´",
    "noHistory": "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ¿ÑƒÑÑ‚Ğ°"
  },
  "cronJobs": {
    "title": "ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ·Ğ°Ğ´Ğ°Ñ‡",
    "subtitle": "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°Ğ¼Ğ¸",
    "scheduledJobs": "Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸",
    "jobName": "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸",
    "function": "Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ",
    "trigger": "Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€",
    "nextRun": "Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº",
    "noJobs": "ĞĞµÑ‚ Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡",
    "noJobsDesc": "Ğ’ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ Ğ½ĞµÑ‚ Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡.",
    "never": "ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ°"
  },
  "soc": {
    "title": "Security Operations Center",
    "subtitle": "ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸, ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ¸ ÑƒĞ³Ñ€Ğ¾Ğ·Ğ°Ğ¼Ğ¸",
    "auditLogs": "Ğ–ÑƒÑ€Ğ½Ğ°Ğ» Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°",
    "accessControl": "ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°",
    "statistics": "Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°",
    "filters": "Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹",
    "moduleName": "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ",
    "filterByModule": "Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ...",
    "eventType": "Ğ¢Ğ¸Ğ¿ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ",
    "severity": "Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ÑĞµÑ€ÑŒĞµĞ·Ğ½Ğ¾ÑÑ‚Ğ¸",
    "allTypes": "Ğ’ÑĞµ Ñ‚Ğ¸Ğ¿Ñ‹",
    "allSeverities": "Ğ’ÑĞµ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸",
    "timestamp": "Ğ’Ñ€ĞµĞ¼Ñ",
    "module": "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ",
    "user": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ",
    "ip": "IP Ğ°Ğ´Ñ€ĞµÑ",
    "status": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ",
    "noLogs": "Ğ–ÑƒÑ€Ğ½Ğ°Ğ» Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ° Ğ¿ÑƒÑÑ‚",
    "noLogsDesc": "ĞĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸, ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ğ²Ğ°ÑˆĞ¸Ğ¼ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ğ¼.",
    "apiKeys": "API ĞšĞ»ÑÑ‡Ğ¸",
    "noApiKeys": "ĞĞµÑ‚ API ĞºĞ»ÑÑ‡ĞµĞ¹",
    "noApiKeysDesc": "API ĞºĞ»ÑÑ‡Ğ¸ Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ CLI Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ĞºĞ»ÑÑ‡ĞµĞ¹.",
    "keyName": "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ»ÑÑ‡Ğ°",
    "permissions": "ĞŸÑ€Ğ°Ğ²Ğ°",
    "created": "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½",
    "expires": "Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚",
    "lastUsed": "ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ",
    "usageCount": "ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹",
    "totalEvents": "Ğ’ÑĞµĞ³Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹",
    "violations": "ĞĞ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ",
    "eventTypes": "Ğ¢Ğ¸Ğ¿Ğ¾Ğ² ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹",
    "modules": "ĞœĞ¾Ğ´ÑƒĞ»ĞµĞ¹",
    "eventsByType": "Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼",
    "eventsBySeverity": "Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¿Ğ¾ ÑĞµÑ€ÑŒĞµĞ·Ğ½Ğ¾ÑÑ‚Ğ¸",
    "count": "ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾",
    "noStats": "Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°"
  },
  "database": {
    "title": "Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ",
    "subtitle": "SQL Runner, ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºÑÑˆĞµĞ¼",
    "sqlRunner": "SQL Runner",
    "migrations": "ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸",
    "cache": "ĞšÑÑˆ",
    "cacheExplorer": "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ĞºÑÑˆĞ°",
    "query": "SQL Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ SELECT)",
    "sqlNote": "Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ SELECT Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ñ‹ Ğ´Ğ»Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸.",
    "execute": "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ",
    "results": "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹",
    "rows": "ÑÑ‚Ñ€Ğ¾Ğº",
    "revision": "Ğ ĞµĞ²Ğ¸Ğ·Ğ¸Ñ",
    "description": "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ",
    "status": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ",
    "current": "Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ",
    "pending": "ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚",
    "upgrade": "ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ",
    "downgrade": "ĞÑ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ",
    "confirmMigration": "Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ?",
    "noMigrations": "ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹",
    "searchPattern": "ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ¿Ğ¾Ğ¸ÑĞºĞ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, user:* Ğ¸Ğ»Ğ¸ *)...",
    "search": "ĞŸĞ¾Ğ¸ÑĞº",
    "key": "ĞšĞ»ÑÑ‡",
    "ttl": "TTL",
    "noExpiry": "Ğ‘ĞµĞ· ÑÑ€Ğ¾ĞºĞ°",
    "noCacheKeys": "ĞšĞ»ÑÑ‡Ğ¸ ĞºÑÑˆĞ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹",
    "noCacheKeysDesc": "ĞĞµÑ‚ ĞºĞ»ÑÑ‡ĞµĞ¹, ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ğ²Ğ°ÑˆĞµĞ¼Ñƒ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ Ğ¿Ğ¾Ğ¸ÑĞºĞ°.",
    "flushCache": "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºÑÑˆ",
    "confirmFlushCache": "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ĞµÑÑŒ ĞºÑÑˆ? Ğ­Ñ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ.",
    "cacheFlushed": "ĞšÑÑˆ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½"
  },
  "broadcast": {
    "title": "Broadcast Studio",
    "subtitle": "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼",
    "create": "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºÑƒ",
    "history": "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ",
    "messageEditor": "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
    "message": "Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ",
    "messagePlaceholder": "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°ÑˆĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ·Ğ´ĞµÑÑŒ...",
    "messageNote": "ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Markdown. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ /help Ğ´Ğ»Ñ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ° Ğ¿Ğ¾ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ.",
    "targeting": "Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ",
    "targetType": "Ğ¢Ğ¸Ğ¿ Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ¹ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸",
    "targetAll": "Ğ’ÑĞµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸",
    "targetAdmins": "Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñ‹",
    "targetRole": "ĞŸĞ¾ Ñ€Ğ¾Ğ»Ğ¸",
    "targetActive": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ N Ğ´Ğ½ĞµĞ¹)",
    "targetInactive": "ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ (Ğ½ĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ N Ğ´Ğ½ĞµĞ¹)",
    "targetNewUsers": "ĞĞ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ (Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ·Ğ° N Ğ´Ğ½ĞµĞ¹)",
    "targetLanguage": "ĞŸĞ¾ ÑĞ·Ñ‹ĞºÑƒ",
    "targetActiveStatus": "ĞŸĞ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸",
    "days": "Ğ”Ğ½Ğ¸",
    "language": "ĞšĞ¾Ğ´ ÑĞ·Ñ‹ĞºĞ°",
    "selectLanguage": "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ·Ñ‹Ğº",
    "role": "Ğ Ğ¾Ğ»ÑŒ",
    "selectRole": "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ€Ğ¾Ğ»ÑŒ",
    "roleUser": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ",
    "roleModerator": "ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€",
    "roleAdmin": "ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€",
    "roleSuperAdmin": "Ğ¡ÑƒĞ¿ĞµÑ€ ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€",
    "activeStatus": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸",
    "selectActiveStatus": "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑ",
    "statusActive": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸",
    "statusInactive": "ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸",
    "activeDaysNote": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ±Ñ‹Ğ»Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹ Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ N Ğ´Ğ½ĞµĞ¹",
    "inactiveDaysNote": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹ N Ğ´Ğ½ĞµĞ¹",
    "newUsersDaysNote": "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸, Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ N Ğ´Ğ½ĞµĞ¹",
    "roleRequired": "Ğ Ğ¾Ğ»ÑŒ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°",
    "activeStatusRequired": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½",
    "scheduling": "ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ",
    "sendTime": "Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸",
    "scheduleNote": "ĞÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼ Ğ´Ğ»Ñ Ğ½ĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸",
    "send": "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºÑƒ",
    "progress": "ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ¸",
    "sent": "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾",
    "errors": "ĞÑˆĞ¸Ğ±ĞºĞ¸",
    "id": "ID",
    "target": "Ğ¦ĞµĞ»ÑŒ",
    "recipients": "ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ĞµĞ»Ğ¸",
    "status": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ",
    "created": "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾",
    "noBroadcasts": "ĞĞµÑ‚ Ñ€Ğ°ÑÑÑ‹Ğ»Ğ¾Ğº",
    "noBroadcastsDesc": "Ğ Ğ°ÑÑÑ‹Ğ»ĞºĞ¸ ĞµÑ‰Ğµ Ğ½Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞ»Ğ¸ÑÑŒ.",
    "broadcastCreated": "Ğ Ğ°ÑÑÑ‹Ğ»ĞºĞ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°",
    "messageRequired": "Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾",
    "daysRequired": "ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ½ĞµĞ¹ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹",
    "languageRequired": "ĞšĞ¾Ğ´ ÑĞ·Ñ‹ĞºĞ° Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ĞµĞ½"
  }
}




======================================================================

------------------------------ FILE: Systems/web/public/locales/ua.json ------------------------------
{
  "common": {
    "welcome": "Ğ›Ğ°ÑĞºĞ°Ğ²Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¸Ğ¼Ğ¾ Ğ´Ğ¾ SwiftDevBot",
    "controlCenter": "ĞŸĞ°Ğ½ĞµĞ»ÑŒ ĞºĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ",
    "loading": "Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ...",
    "error": "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°",
    "success": "Ğ£ÑĞ¿Ñ–ÑˆĞ½Ğ¾",
    "cancel": "Ğ¡ĞºĞ°ÑÑƒĞ²Ğ°Ñ‚Ğ¸",
    "save": "Ğ—Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸",
    "delete": "Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸",
    "edit": "Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸",
    "close": "Ğ—Ğ°ĞºÑ€Ğ¸Ñ‚Ğ¸",
    "back": "ĞĞ°Ğ·Ğ°Ğ´",
    "next": "Ğ”Ğ°Ğ»Ñ–",
    "previous": "ĞŸĞ¾Ğ¿ĞµÑ€ĞµĞ´Ğ½Ñ–Ğ¹",
    "search": "ĞŸĞ¾ÑˆÑƒĞº",
    "filter": "Ğ¤Ñ–Ğ»ÑŒÑ‚Ñ€",
    "refresh": "ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸",
    "actions": "Ğ”Ñ–Ñ—",
    "status": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ",
    "active": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹",
    "inactive": "ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹",
    "online": "ĞĞ½Ğ»Ğ°Ğ¹Ğ½",
    "offline": "ĞÑ„Ğ»Ğ°Ğ¹Ğ½",
    "yes": "Ğ¢Ğ°Ğº",
    "no": "ĞÑ–",
    "never": "ĞÑ–ĞºĞ¾Ğ»Ğ¸",
    "saving": "Ğ—Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ½Ñ..."
  },
  "header": {
    "signOut": "Ğ’Ğ¸Ğ¹Ñ‚Ğ¸",
    "switchTheme": "ĞŸĞµÑ€ĞµĞ¼ĞºĞ½ÑƒÑ‚Ğ¸ Ñ‚ĞµĞ¼Ñƒ"
  },
  "sidebar": {
    "home": "Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ°",
    "userMenu": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡",
    "missionControl": "Mission Control",
    "modules": "ĞœĞ¾Ğ´ÑƒĞ»Ñ–",
    "modulesHub": "ĞœĞ¾Ñ— Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–",
    "users": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–",
    "statistics": "Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°",
    "logs": "Ğ›Ğ¾Ğ³Ğ¸",
    "settings": "ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ",
    "documentation": "Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ñ–Ñ",
    "adminPanel": "ĞĞ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ",
    "coreConfig": "ĞšĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ ÑĞ´Ñ€Ğ°",
    "coreManagement": "Core Management",
    "services": "Ğ¡ĞµÑ€Ğ²Ñ–ÑĞ¸",
    "monitoring": "ĞœĞ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³",
    "notifications": "Ğ¡Ğ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½Ğ½Ñ",
    "data": "ĞœĞ¾Ñ— Ğ´Ğ°Ğ½Ñ–",
    "developer": "API ĞšĞ»ÑÑ‡Ñ–",
    "terminal": "ĞšĞ¾Ğ½ÑĞ¾Ğ»ÑŒ",
    "security": "Ğ‘ĞµĞ·Ğ¿ĞµĞºĞ°",
    "support": "ĞŸÑ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºĞ°",
    "cronJobs": "ĞŸĞ»Ğ°Ğ½ÑƒĞ²Ğ°Ğ»ÑŒĞ½Ğ¸Ğº",
    "securityOperations": "SOC",
    "databaseData": "Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ¸Ñ…",
    "broadcastStudio": "Ğ Ğ¾Ğ·ÑĞ¸Ğ»ĞºĞ¸"
  },
  "home": {
    "title": "Ğ›Ğ°ÑĞºĞ°Ğ²Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¸Ğ¼Ğ¾ Ğ´Ğ¾ SwiftDevBot",
    "subtitle": "ĞœĞ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ñ‚Ğ° ĞºĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–ÑĞ¼Ğ¸ Ğ²Ğ°ÑˆĞ¾Ğ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ° Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ Ñ‡Ğ°ÑÑ–",
    "customize": "ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ñ‚Ğ¸",
    "addWidgets": "Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ²Ñ–Ğ´Ğ¶ĞµÑ‚Ğ¸",
    "noWidgets": "ĞĞµĞ¼Ğ°Ñ” Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ñ… Ğ²Ñ–Ğ´Ğ¶ĞµÑ‚Ñ–Ğ². Ğ”Ğ¾Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ²Ñ–Ğ´Ğ¶ĞµÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ²Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ—.",
    "widgetSettings": "ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ²Ñ–Ğ´Ğ¶ĞµÑ‚Ñ–Ğ²",
    "widgetSettingsDesc": "Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ²Ñ–Ğ´Ğ¶ĞµÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ²Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ½Ğ° Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ½Ñ–Ğ¹ ÑÑ‚Ğ¾Ñ€Ñ–Ğ½Ñ†Ñ–",
    "widget": {
      "stats": {
        "desc": "Ğ’Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°Ñ” ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ±Ğ¾Ñ‚Ğ° (Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–, ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–, Ğ²Ğ·Ğ°Ñ”Ğ¼Ğ¾Ğ´Ñ–Ñ—)"
      },
      "activity": {
        "desc": "ĞŸĞ¾ĞºĞ°Ğ·ÑƒÑ” Ğ¾ÑÑ‚Ğ°Ğ½Ğ½Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ–ÑÑ‚ÑŒ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñ–"
      },
      "systemHealth": {
        "desc": "Ğ’Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°Ñ” ÑÑ‚Ğ°Ğ½ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸ (CPU, Ğ¿Ğ°Ğ¼'ÑÑ‚ÑŒ, Ğ¼ĞµÑ€ĞµĞ¶Ğ°, ÑÑ…Ğ¾Ğ²Ğ¸Ñ‰Ğµ)"
      },
      "quickActions": {
        "desc": "Ğ¨Ğ²Ğ¸Ğ´ĞºĞ¸Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ´Ğ¾ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¸Ñ… Ñ€Ğ¾Ğ·Ğ´Ñ–Ğ»Ñ–Ğ² Ğ¿Ğ°Ğ½ĞµĞ»Ñ–"
      },
      "recentErrors": {
        "desc": "ĞÑÑ‚Ğ°Ğ½Ğ½Ñ– Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ¸ Ğ· Ğ»Ğ¾Ğ³Ñ–Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸"
      },
      "topModules": {
        "desc": "Ğ¢Ğ¾Ğ¿-5 Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ²"
      },
      "userStats": {
        "desc": "Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ² (Ğ²ÑÑŒĞ¾Ğ³Ğ¾, Ğ½Ğ¾Ğ²Ğ¸Ñ…, Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ñ…)"
      },
      "servicesStatus": {
        "desc": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¸Ñ… ÑĞµÑ€Ğ²Ñ–ÑÑ–Ğ²"
      },
      "performance": {
        "desc": "ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ñ– (RPS, Ñ‡Ğ°Ñ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ–, Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ¸)"
      },
      "announcements": {
        "desc": "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ– Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ Ñ‚Ğ° ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½Ğ½Ñ"
      },
      "uptime": {
        "desc": "Ğ§Ğ°Ñ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸ Ğ±ĞµĞ· Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ"
      },
      "weather": {
        "desc": "ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ° Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğ° Ñ‚Ğ° Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·"
      },
      "calendar": {
        "desc": "ĞšĞ°Ğ»ĞµĞ½Ğ´Ğ°Ñ€ Ğ· Ğ¿Ğ¾Ğ´Ñ–ÑĞ¼Ğ¸"
      },
      "notes": {
        "desc": "Ğ¨Ğ²Ğ¸Ğ´ĞºÑ– Ğ½Ğ¾Ñ‚Ğ°Ñ‚ĞºĞ¸"
      },
      "tasks": {
        "desc": "Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ·Ğ°Ğ´Ğ°Ñ‡ Ñ‚Ğ° ÑĞ¿Ñ€Ğ°Ğ²"
      },
      "time": {
        "desc": "Ğ“Ğ¾Ğ´Ğ¸Ğ½Ğ½Ğ¸Ğº Ñƒ Ñ€Ñ–Ğ·Ğ½Ğ¸Ñ… Ñ‡Ğ°ÑĞ¾Ğ²Ğ¸Ñ… Ğ¿Ğ¾ÑÑĞ°Ñ…"
      },
      "github": {
        "desc": "Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ñ–Ñ— GitHub"
      },
      "tools": {
        "desc": "ĞšĞ¾Ñ€Ğ¸ÑĞ½Ñ– Ñ–Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¸ (ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€, ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚ĞµÑ€, ĞºĞ¾Ğ´ÑƒĞ²Ğ°Ğ»ÑŒĞ½Ğ¸Ğº)"
      }
    },
    "quickActions": {
      "users": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–",
      "missionControl": "Mission Control",
      "settings": "ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ",
      "terminal": "Ğ¢ĞµÑ€Ğ¼Ñ–Ğ½Ğ°Ğ»",
      "security": "Ğ‘ĞµĞ·Ğ¿ĞµĞºĞ°",
      "database": "Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ¸Ñ…",
      "broadcast": "Ğ Ğ¾Ğ·ÑĞ¸Ğ»ĞºĞ¸",
      "logs": "Ğ›Ğ¾Ğ³Ğ¸"
    },
    "noErrors": "ĞĞµĞ¼Ğ°Ñ” Ğ¾ÑÑ‚Ğ°Ğ½Ğ½Ñ–Ñ… Ğ¿Ğ¾Ğ¼Ğ¸Ğ»Ğ¾Ğº",
    "noModules": "ĞĞµĞ¼Ğ°Ñ” Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ²",
    "noServices": "ĞĞµĞ¼Ğ°Ñ” Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ñ… ÑĞµÑ€Ğ²Ñ–ÑÑ–Ğ²",
    "noAnnouncements": "ĞĞµĞ¼Ğ°Ñ” Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½ÑŒ",
    "userStats": {
      "totalUsers": "Ğ’ÑÑŒĞ¾Ğ³Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ²",
      "newToday": "ĞĞ¾Ğ²Ğ¸Ñ… ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–",
      "active24h": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ñ… (24Ñ‡)",
      "growth": "Ğ—Ñ€Ñ–ÑÑ‚"
    },
    "performance": {
      "rps": "RPS",
      "responseTime": "Ğ§Ğ°Ñ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ–",
      "errorRate": "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ¸",
      "queueSize": "Ğ§ĞµÑ€Ğ³Ğ°"
    },
    "uptime": {
      "days": "Ğ”Ğ½Ñ–Ğ²",
      "hours": "Ğ“Ğ¾Ğ´Ğ¸Ğ½",
      "minutes": "Ğ¥Ğ²Ğ¸Ğ»Ğ¸Ğ½"
    },
    "announcements": {
      "maintenance": "ĞŸĞ»Ğ°Ğ½Ğ¾Ğ²Ğµ Ğ¾Ğ±ÑĞ»ÑƒĞ³Ğ¾Ğ²ÑƒĞ²Ğ°Ğ½Ğ½Ñ",
      "maintenanceDesc": "ĞŸĞ»Ğ°Ğ½Ğ¾Ğ²Ğµ Ğ¾Ğ±ÑĞ»ÑƒĞ³Ğ¾Ğ²ÑƒĞ²Ğ°Ğ½Ğ½Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸ Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ½Ğ° Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ° Ğ¾ 2:00",
      "update": "ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸",
      "updateDesc": "Ğ”Ğ¾ Ğ¿Ğ°Ğ½ĞµĞ»Ñ– ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ğ´Ğ¾Ğ´Ğ°Ğ½Ğ¾ Ğ½Ğ¾Ğ²Ñ– Ñ„ÑƒĞ½ĞºÑ†Ñ–Ñ—"
    },
    "weather": {
      "error": "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğ¸",
      "noData": "ĞĞµĞ¼Ğ°Ñ” Ğ´Ğ°Ğ½Ğ¸Ñ… Ğ¿Ñ€Ğ¾ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ñƒ",
      "humidity": "Ğ’Ğ¾Ğ»Ğ¾Ğ³Ñ–ÑÑ‚ÑŒ",
      "wind": "Ğ’Ñ–Ñ‚ĞµÑ€",
      "feelsLike": "Ğ’Ñ–Ğ´Ñ‡ÑƒĞ²Ğ°Ñ”Ñ‚ÑŒÑÑ"
    },
    "calendar": {
      "january": "Ğ¡Ñ–Ñ‡ĞµĞ½ÑŒ",
      "february": "Ğ›ÑÑ‚Ğ¸Ğ¹",
      "march": "Ğ‘ĞµÑ€ĞµĞ·ĞµĞ½ÑŒ",
      "april": "ĞšĞ²Ñ–Ñ‚ĞµĞ½ÑŒ",
      "may": "Ğ¢Ñ€Ğ°Ğ²ĞµĞ½ÑŒ",
      "june": "Ğ§ĞµÑ€Ğ²ĞµĞ½ÑŒ",
      "july": "Ğ›Ğ¸Ğ¿ĞµĞ½ÑŒ",
      "august": "Ğ¡ĞµÑ€Ğ¿ĞµĞ½ÑŒ",
      "september": "Ğ’ĞµÑ€ĞµÑĞµĞ½ÑŒ",
      "october": "Ğ–Ğ¾Ğ²Ñ‚ĞµĞ½ÑŒ",
      "november": "Ğ›Ğ¸ÑÑ‚Ğ¾Ğ¿Ğ°Ğ´",
      "december": "Ğ“Ñ€ÑƒĞ´ĞµĞ½ÑŒ",
      "sun": "ĞĞ´",
      "mon": "ĞŸĞ½",
      "tue": "Ğ’Ñ‚",
      "wed": "Ğ¡Ñ€",
      "thu": "Ğ§Ñ‚",
      "fri": "ĞŸÑ‚",
      "sat": "Ğ¡Ğ±",
      "upcoming": "ĞœĞ°Ğ¹Ğ±ÑƒÑ‚Ğ½Ñ– Ğ¿Ğ¾Ğ´Ñ–Ñ—"
    },
    "notes": {
      "placeholder": "Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ½Ğ¾Ñ‚Ğ°Ñ‚ĞºÑƒ...",
      "noNotes": "ĞĞµĞ¼Ğ°Ñ” Ğ½Ğ¾Ñ‚Ğ°Ñ‚Ğ¾Ğº. Ğ”Ğ¾Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¿ĞµÑ€ÑˆÑƒ Ğ½Ğ¾Ñ‚Ğ°Ñ‚ĞºÑƒ!"
    },
    "tasks": {
      "placeholder": "Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ...",
      "all": "Ğ’ÑÑ–",
      "active": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ–",
      "completed": "Ğ’Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ñ–",
      "noTasks": "ĞĞµĞ¼Ğ°Ñ” Ğ·Ğ°Ğ´Ğ°Ñ‡. Ğ”Ğ¾Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¿ĞµÑ€ÑˆÑƒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ!",
      "noFilteredTasks": "Ğ—Ğ°Ğ´Ğ°Ñ‡Ñ– Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾",
      "completed": "Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ¾",
      "priority": {
        "low": "ĞĞ¸Ğ·ÑŒĞºĞ¸Ğ¹",
        "medium": "Ğ¡ĞµÑ€ĞµĞ´Ğ½Ñ–Ğ¹",
        "high": "Ğ’Ğ¸ÑĞ¾ĞºĞ¸Ğ¹"
      }
    },
    "time": {
      "otherZones": "Ğ†Ğ½ÑˆÑ– Ñ‡Ğ°ÑĞ¾Ğ²Ñ– Ğ¿Ğ¾ÑÑĞ¸"
    },
    "github": {
      "title": "Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ñ–Ñ— GitHub",
      "usernamePlaceholder": "Ğ†Ğ¼'Ñ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° GitHub",
      "load": "Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ñ–Ñ—",
      "error": "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ñ–Ñ—Ğ²",
      "noRepos": "Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ñ–Ñ— Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾",
      "change": "Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸",
      "changeUser": "Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°"
    },
    "tools": {
      "calculator": "ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€",
      "converter": "ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚ĞµÑ€",
      "encoder": "ĞšĞ¾Ğ´ÑƒĞ²Ğ°Ğ»ÑŒĞ½Ğ¸Ğº",
      "formatter": "Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ĞµÑ€",
      "calculate": "ĞĞ±Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚Ğ¸",
      "result": "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚",
      "input": "Ğ’Ğ²ĞµĞ´ĞµĞ½Ğ½Ñ",
      "output": "Ğ’Ğ¸Ğ²ĞµĞ´ĞµĞ½Ğ½Ñ",
      "encode": "ĞšĞ¾Ğ´ÑƒĞ²Ğ°Ñ‚Ğ¸",
      "decode": "Ğ”ĞµĞºĞ¾Ğ´ÑƒĞ²Ğ°Ñ‚Ğ¸",
      "formatterComingSoon": "Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ĞµÑ€ ÑĞºĞ¾Ñ€Ğ¾ Ğ·'ÑĞ²Ğ¸Ñ‚ÑŒÑÑ"
    },
    "activeModules": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ– Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–",
    "totalUsers": "Ğ’ÑÑŒĞ¾Ğ³Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ²",
    "todayInteractions": "Ğ’Ğ·Ğ°Ñ”Ğ¼Ğ¾Ğ´Ñ–Ğ¹ ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–",
    "systemStatus": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸",
    "recentActivity": "ĞÑÑ‚Ğ°Ğ½Ğ½Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ–ÑÑ‚ÑŒ",
    "systemHealth": "Ğ¡Ñ‚Ğ°Ğ½ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸",
    "cpuUsage": "Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ CPU",
    "memory": "ĞŸĞ°Ğ¼'ÑÑ‚ÑŒ",
    "network": "ĞœĞµÑ€ĞµĞ¶Ğ°",
    "storage": "Ğ¡Ñ…Ğ¾Ğ²Ğ¸Ñ‰Ğµ"
  },
  "statistics": {
    "title": "Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°",
    "subtitle": "ĞĞ½Ğ°Ğ»Ñ–Ñ‚Ğ¸ĞºĞ° Ñ‚Ğ° Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ Ñ‡Ğ°ÑÑ–",
    "messagesToday": "ĞŸĞ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½ÑŒ ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–",
    "totalUsers": "Ğ’ÑÑŒĞ¾Ğ³Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ²",
    "activeModules": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ– Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–",
    "totalModules": "Ğ’ÑÑŒĞ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ²",
    "vsPrevious": "Ğ´Ğ¾ Ğ¿Ğ¾Ğ¿ĞµÑ€ĞµĞ´Ğ½ÑŒĞ¾Ğ³Ğ¾",
    "activityChart": "Ğ“Ñ€Ğ°Ñ„Ñ–Ğº Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ñ–",
    "hourlyActivity": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ–ÑÑ‚ÑŒ Ğ·Ğ° Ğ³Ğ¾Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸",
    "trends": "Ğ¢Ñ€ĞµĞ½Ğ´Ğ¸"
  },
  "modules": {
    "title": "ĞœĞ¾Ğ´ÑƒĞ»Ñ– Ğ±Ğ¾Ñ‚Ğ°",
    "subtitle": "ĞšĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ„ÑƒĞ½ĞºÑ†Ñ–Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¼Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸ Ğ²Ğ°ÑˆĞ¾Ğ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ°",
    "activate": "ĞĞºÑ‚Ğ¸Ğ²ÑƒĞ²Ğ°Ñ‚Ğ¸",
    "deactivate": "Ğ”ĞµĞ°ĞºÑ‚Ğ¸Ğ²ÑƒĞ²Ğ°Ñ‚Ğ¸",
    "noModules": "ĞœĞ¾Ğ´ÑƒĞ»Ñ– Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾",
    "noModulesDesc": "ĞœĞ¾Ğ´ÑƒĞ»Ñ– Ğ·'ÑĞ²Ğ»ÑÑ‚ÑŒÑÑ Ñ‚ÑƒÑ‚ Ğ¿Ñ–ÑĞ»Ñ Ñ—Ñ… Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ",
    "moduleActivated": "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {name} Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¾",
    "moduleDeactivated": "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ {name} Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¾",
    "errorToggle": "ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ¿ĞµÑ€ĞµĞ¼ĞºĞ½ÑƒÑ‚Ğ¸ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ"
  },
  "users": {
    "title": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ– Ğ±Ğ¾Ñ‚Ğ°",
    "subtitle": "ĞšĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°Ğ¼Ğ¸, Ñ‰Ğ¾ Ğ²Ğ·Ğ°Ñ”Ğ¼Ğ¾Ğ´Ñ–ÑÑ‚ÑŒ Ğ· Ğ²Ğ°ÑˆĞ¸Ğ¼ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼",
    "blockUser": "Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°",
    "unblockUser": "Ğ Ğ¾Ğ·Ğ±Ğ»Ğ¾ĞºÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°",
    "noUsers": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ² Ğ¿Ğ¾ĞºĞ¸ Ğ½ĞµĞ¼Ğ°Ñ”",
    "noUsersDesc": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ– Ğ·'ÑĞ²Ğ»ÑÑ‚ÑŒÑÑ Ñ‚ÑƒÑ‚ Ğ¿Ñ–ÑĞ»Ñ Ğ²Ğ·Ğ°Ñ”Ğ¼Ğ¾Ğ´Ñ–Ñ— Ğ· Ğ²Ğ°ÑˆĞ¸Ğ¼ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼",
    "userId": "ID ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°",
    "role": "Ğ Ğ¾Ğ»ÑŒ",
    "userBlocked": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° {id} Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²Ğ°Ğ½Ğ¾",
    "userUnblocked": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° {id} Ñ€Ğ¾Ğ·Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²Ğ°Ğ½Ğ¾",
    "errorToggle": "ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ·Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ»Ğ¾ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ"
  },
  "auth": {
    "loginRequired": "ĞŸĞ¾Ñ‚Ñ€Ñ–Ğ±ĞµĞ½ Ğ²Ñ…Ñ–Ğ´",
    "loginViaTelegram": "Ğ”Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ Ğ´Ğ¾ Ğ¿Ğ°Ğ½ĞµĞ»Ñ– Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ¹Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /login Ğ² Telegram Ğ±Ğ¾Ñ‚Ñ–",
    "loginLink": "Ğ’Ğ¸ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ñ”Ñ‚Ğµ Ğ¿Ğ¾ÑĞ¸Ğ»Ğ°Ğ½Ğ½Ñ Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ Ğ´Ğ¾ Ğ²ĞµĞ±-Ğ¿Ğ°Ğ½ĞµĞ»Ñ–",
    "invalidToken": "ĞĞµĞ´Ñ–Ğ¹ÑĞ½Ğ¸Ğ¹ Ğ°Ğ±Ğ¾ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ¾Ñ‡ĞµĞ½Ğ¸Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½",
    "sessionExpired": "Ğ¡ĞµÑÑ–Ñ Ğ·Ğ°ĞºÑ–Ğ½Ñ‡Ğ¸Ğ»Ğ°ÑÑ. Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, ÑƒĞ²Ñ–Ğ¹Ğ´Ñ–Ñ‚ÑŒ Ğ·Ğ½Ğ¾Ğ²Ñƒ."
  },
  "errors": {
    "loadError": "ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸ Ğ´Ğ°Ğ½Ñ–",
    "saveError": "ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ·Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸ Ğ·Ğ¼Ñ–Ğ½Ğ¸",
    "networkError": "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ¼ĞµÑ€ĞµĞ¶Ñ–. Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€Ñ‚Ğµ Ğ¿Ñ–Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ñ.",
    "unknownError": "Ğ¡Ñ‚Ğ°Ğ»Ğ°ÑÑ Ğ½ĞµĞ²Ñ–Ğ´Ğ¾Ğ¼Ğ° Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ°"
  },
  "userDashboard": {
    "welcome": "Ğ›Ğ°ÑĞºĞ°Ğ²Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¸Ğ¼Ğ¾, {name}!",
    "subtitle": "Ğ¦ĞµĞ½Ñ‚Ñ€ ĞºĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ²Ğ°ÑˆĞ¾Ñ Ğ²Ğ·Ğ°Ñ”Ğ¼Ğ¾Ğ´Ñ–Ñ”Ñ Ğ· Ğ±Ğ¾Ñ‚Ğ¾Ğ¼",
    "accountActive": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹",
    "quickActions": "Ğ¨Ğ²Ğ¸Ğ´ĞºÑ– Ğ´Ñ–Ñ—",
    "newChat": "ĞĞ¾Ğ²Ğ¸Ğ¹ Ñ‡Ğ°Ñ‚",
    "myFiles": "ĞœĞ¾Ñ— Ñ„Ğ°Ğ¹Ğ»Ğ¸",
    "apiKeys": "API ĞšĞ»ÑÑ‡Ñ–",
    "security": "Ğ‘ĞµĞ·Ğ¿ĞµĞºĞ°",
    "activeModules": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ– Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–",
    "totalCommands": "ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´ ÑÑŒĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ–",
    "storageUsed": "Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ¾ Ğ¼Ñ–ÑÑ†Ñ",
    "recentActivity": "ĞÑÑ‚Ğ°Ğ½Ğ½Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ–ÑÑ‚ÑŒ",
    "announcements": "ĞĞ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ",
    "announcement": {
      "newFeatures": "ĞĞ¾Ğ²Ñ– Ğ¼Ğ¾Ğ¶Ğ»Ğ¸Ğ²Ğ¾ÑÑ‚Ñ–",
      "newFeaturesDesc": "Ğ”Ğ¾Ğ´Ğ°Ğ½Ğ¾ Ğ½Ğ¾Ğ²Ñ– Ñ„ÑƒĞ½ĞºÑ†Ñ–Ñ— Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½Ğ½Ñ Ğ²Ğ°ÑˆĞ¾Ğ³Ğ¾ Ğ´Ğ¾ÑĞ²Ñ–Ğ´Ñƒ"
    },
    "activity": {
      "command": "Ğ’Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ¾ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ",
      "fileUpload": "Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»",
      "settings": "Ğ—Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾ Ğ½Ğ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ",
      "settingsChanged": "ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ¿Ñ€Ğ¾Ñ„Ñ–Ğ»Ñ"
    }
  },
  "modulesHub": {
    "title": "ĞœĞ¾Ñ— Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–",
    "subtitle": "ĞšĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ğ¼Ğ¸ ÑĞµÑ€Ğ²Ñ–ÑĞ°Ğ¼Ğ¸",
    "active": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹",
    "notConfigured": "ĞĞµ Ğ½Ğ°Ğ»Ğ°ÑˆÑ‚Ğ¾Ğ²Ğ°Ğ½Ğ¾",
    "requiresSubscription": "ĞŸĞ¾Ñ‚Ñ€ĞµĞ±ÑƒÑ” Ğ¿Ñ–Ğ´Ğ¿Ğ¸ÑĞºĞ¸",
    "open": "Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¸",
    "configure": "ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ñ‚Ğ¸",
    "noModules": "ĞœĞ¾Ğ´ÑƒĞ»Ñ– Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾",
    "noModulesDesc": "Ğ£ Ğ²Ğ°Ñ Ğ¿Ğ¾ĞºĞ¸ Ğ½ĞµĞ¼Ğ°Ñ” Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ². ĞœĞ¾Ğ´ÑƒĞ»Ñ– Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ· CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ 'sdb module create' Ğ°Ğ±Ğ¾ Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ²Ñ€ÑƒÑ‡Ğ½Ñƒ Ğ² Ğ¿Ğ°Ğ¿ĞºÑƒ Modules/."
  },
  "security": {
    "title": "Ğ‘ĞµĞ·Ğ¿ĞµĞºĞ°",
    "subtitle": "ĞšĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ±ĞµĞ·Ğ¿ĞµĞºĞ¾Ñ Ğ°ĞºĞ°ÑƒĞ½Ñ‚Ğ°",
    "cloudPassword": "Ğ¥Ğ¼Ğ°Ñ€Ğ½Ğ¸Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ",
    "changePassword": "Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ",
    "activeSessions": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ– ÑĞµÑÑ–Ñ—",
    "sessionHistory": "Ğ–ÑƒÑ€Ğ½Ğ°Ğ» Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ",
    "terminateAll": "Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚Ğ¸ Ğ²ÑÑ– ÑĞµĞ°Ğ½ÑĞ¸",
    "terminateSession": "Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚Ğ¸ ÑĞµĞ°Ğ½Ñ",
    "device": "ĞŸÑ€Ğ¸ÑÑ‚Ñ€Ñ–Ğ¹",
    "location": "ĞœÑ–ÑÑ†ĞµĞ·Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¶ĞµĞ½Ğ½Ñ",
    "lastActivity": "ĞÑÑ‚Ğ°Ğ½Ğ½Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ–ÑÑ‚ÑŒ",
    "currentSession": "ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ° ÑĞµÑÑ–Ñ",
    "noSessions": "ĞĞµĞ¼Ğ°Ñ” Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ñ… ÑĞµÑÑ–Ğ¹",
    "confirmTerminateAll": "Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚Ğ¸ Ğ²ÑÑ– ÑĞµÑÑ–Ñ— ĞºÑ€Ñ–Ğ¼ Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ñ—?",
    "passwordsDoNotMatch": "ĞŸĞ°Ñ€Ğ¾Ğ»Ñ– Ğ½Ğµ ÑĞ¿Ñ–Ğ²Ğ¿Ğ°Ğ´Ğ°ÑÑ‚ÑŒ",
    "passwordTooShort": "ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ¿Ğ¾Ğ²Ğ¸Ğ½ĞµĞ½ Ğ±ÑƒÑ‚Ğ¸ Ğ½Ğµ Ğ¼ĞµĞ½ÑˆĞµ 8 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ–Ğ²",
    "passwordChanged": "ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ ÑƒÑĞ¿Ñ–ÑˆĞ½Ğ¾ Ğ·Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾"
  },
  "notifications": {
    "title": "Ğ¡Ğ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½Ğ½Ñ",
    "subtitle": "ĞšĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½Ğ½ÑĞ¼Ğ¸",
    "channels": "ĞšĞ°Ğ½Ğ°Ğ»Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸",
    "telegram": "Telegram",
    "email": "Email",
    "push": "Push Ñƒ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ñ–",
    "types": "Ğ¢Ğ¸Ğ¿Ğ¸ ÑĞ¿Ğ¾Ğ²Ñ–Ñ‰ĞµĞ½ÑŒ",
    "news": "ĞĞ¾Ğ²Ğ¸Ğ½Ğ¸",
    "security": "Ğ‘ĞµĞ·Ğ¿ĞµĞºĞ°",
    "tasks": "Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ½Ñ Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½ÑŒ",
    "marketing": "ĞœĞ°Ñ€ĞºĞµÑ‚Ğ¸Ğ½Ğ³",
    "doNotDisturb": "ĞĞµ Ñ‚ÑƒÑ€Ğ±ÑƒĞ²Ğ°Ñ‚Ğ¸",
    "schedule": "Ğ Ğ¾Ğ·ĞºĞ»Ğ°Ğ´"
  },
  "data": {
    "title": "ĞœĞ¾Ñ— Ğ´Ğ°Ğ½Ñ–",
    "subtitle": "ĞšĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ²Ğ°ÑˆĞ¸Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ¸Ğ¼Ğ¸",
    "commandHistory": "Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ²",
    "uploadedFiles": "Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ñ– Ñ„Ğ°Ğ¹Ğ»Ğ¸",
    "exportData": "Ğ•ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ´Ğ°Ğ½Ğ¸Ñ…",
    "downloadArchive": "Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸ Ğ°Ñ€Ñ…Ñ–Ğ²",
    "privacy": "ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ–ÑÑ‚ÑŒ",
    "clearHistory": "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚Ğ¸ Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ",
    "deleteAccount": "Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ Ğ°ĞºĞ°ÑƒĞ½Ñ‚",
    "command": "ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°",
    "date": "Ğ”Ğ°Ñ‚Ğ°",
    "status": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ",
    "fileName": "Ğ†Ğ¼'Ñ Ñ„Ğ°Ğ¹Ğ»Ñƒ",
    "size": "Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ€",
    "uploadDate": "Ğ”Ğ°Ñ‚Ğ° Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ",
    "download": "Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸",
    "delete": "Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸",
    "noCommandHistory": "Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ñ",
    "noFiles": "ĞĞµĞ¼Ğ°Ñ” Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ñ–Ğ²"
  },
  "support": {
    "title": "ĞŸÑ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºĞ°",
    "subtitle": "ĞÑ‚Ñ€Ğ¸Ğ¼Ğ°Ğ¹Ñ‚Ğµ Ğ´Ğ¾Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ñƒ Ñ‚Ğ° Ğ¿Ñ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºÑƒ",
    "createTicket": "Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ñ‚Ñ–ĞºĞµÑ‚",
    "myTickets": "ĞœĞ¾Ñ— Ğ·Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½Ñ",
    "faq": "Ğ§Ğ°ÑÑ‚Ñ– Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ",
    "subject": "Ğ¢ĞµĞ¼Ğ°",
    "message": "ĞŸĞ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ",
    "submit": "Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚Ğ¸",
    "ticketId": "ID Ñ‚Ñ–ĞºĞµÑ‚Ğ°",
    "status": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ",
    "created": "Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾",
    "updated": "ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾",
    "open": "Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¾",
    "closed": "Ğ—Ğ°ĞºÑ€Ğ¸Ñ‚Ğ¾",
    "pending": "Ğ’ Ğ¾Ñ‡Ñ–ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ–",
    "noTickets": "ĞĞµĞ¼Ğ°Ñ” ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¸Ñ… Ñ‚Ñ–ĞºĞµÑ‚Ñ–Ğ²",
    "ticketCreated": "Ğ¢Ñ–ĞºĞµÑ‚ ÑƒÑĞ¿Ñ–ÑˆĞ½Ğ¾ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾"
  },
  "developer": {
    "title": "API ĞšĞ»ÑÑ‡Ñ–",
    "subtitle": "ĞšĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¼Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ°Ğ¼Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ",
    "generateToken": "Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½",
    "myTokens": "ĞœĞ¾Ñ— Ñ‚Ğ¾ĞºĞµĞ½Ğ¸",
    "tokenName": "ĞĞ°Ğ·Ğ²Ğ°",
    "created": "Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾",
    "lastUsed": "ĞÑÑ‚Ğ°Ğ½Ğ½Ñ” Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ",
    "actions": "Ğ”Ñ–Ñ—",
    "copy": "ĞšĞ¾Ğ¿Ñ–ÑĞ²Ğ°Ñ‚Ğ¸",
    "revoke": "Ğ’Ñ–Ğ´ĞºĞ»Ğ¸ĞºĞ°Ñ‚Ğ¸",
    "tokenValue": "Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ°",
    "warning": "Ğ£Ğ²Ğ°Ğ³Ğ°: Ñ‚Ğ¾ĞºĞµĞ½ Ğ±ÑƒĞ´Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¾ Ğ»Ğ¸ÑˆĞµ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·!",
    "apiDocs": "Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ñ–Ñ API",
    "openDocs": "Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¸ Swagger",
    "noTokens": "ĞĞµĞ¼Ğ°Ñ” ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¸Ñ… Ñ‚Ğ¾ĞºĞµĞ½Ñ–Ğ²",
    "confirmRevoke": "Ğ’Ñ–Ğ´ĞºĞ»Ğ¸ĞºĞ°Ñ‚Ğ¸ Ñ†ĞµĞ¹ Ñ‚Ğ¾ĞºĞµĞ½?",
    "copyToken": "ĞšĞ¾Ğ¿Ñ–ÑĞ²Ğ°Ñ‚Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½",
    "revokeToken": "Ğ’Ñ–Ğ´ĞºĞ»Ğ¸ĞºĞ°Ñ‚Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½"
  },
  "terminal": {
    "title": "ĞšĞ¾Ğ½ÑĞ¾Ğ»ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´",
    "subtitle": "Ğ’Ğ¸ĞºĞ¾Ğ½ÑƒĞ¹Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¸ Ğ±Ğ¾Ñ‚Ğ° Ğ¿Ñ€ÑĞ¼Ğ¾ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ñ–",
    "placeholder": "Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ (Ğ½Ğ°Ğ¿Ñ€Ğ¸ĞºĞ»Ğ°Ğ´, /start, /help)...",
    "execute": "Ğ’Ğ¸ĞºĞ¾Ğ½Ğ°Ñ‚Ğ¸",
    "clear": "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚Ğ¸",
    "history": "Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´",
    "noHistory": "Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ñ"
  },
  "cronJobs": {
    "title": "ĞŸĞ»Ğ°Ğ½ÑƒĞ²Ğ°Ğ»ÑŒĞ½Ğ¸Ğº Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½ÑŒ",
    "subtitle": "ĞŸĞµÑ€ĞµĞ³Ğ»ÑĞ´ Ñ‚Ğ° ĞºĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¼Ğ¸ Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½ÑĞ¼Ğ¸",
    "scheduledJobs": "Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²Ğ°Ğ½Ñ– Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ",
    "jobName": "ĞĞ°Ğ·Ğ²Ğ° Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ",
    "function": "Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ",
    "trigger": "Ğ¢Ñ€Ğ¸Ğ³ĞµÑ€",
    "nextRun": "ĞĞ°ÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº",
    "noJobs": "ĞĞµĞ¼Ğ°Ñ” Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ… Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½ÑŒ",
    "noJobsDesc": "ĞĞ° Ğ´Ğ°Ğ½Ğ¸Ğ¹ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ Ğ½ĞµĞ¼Ğ°Ñ” Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ… Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½ÑŒ.",
    "never": "ĞÑ–ĞºĞ¾Ğ»Ğ¸"
  },
  "soc": {
    "title": "Security Operations Center",
    "subtitle": "ĞœĞ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ñ‚Ğ° ĞºĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ¿Ğ¾Ğ´Ñ–ÑĞ¼Ğ¸ Ğ±ĞµĞ·Ğ¿ĞµĞºĞ¸, ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ĞµĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ Ñ‚Ğ° Ğ·Ğ°Ğ³Ñ€Ğ¾Ğ·Ğ°Ğ¼Ğ¸",
    "auditLogs": "Ğ–ÑƒÑ€Ğ½Ğ°Ğ» Ğ°ÑƒĞ´Ğ¸Ñ‚Ñƒ",
    "accessControl": "ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ",
    "statistics": "Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°",
    "filters": "Ğ¤Ñ–Ğ»ÑŒÑ‚Ñ€Ğ¸",
    "moduleName": "ĞĞ°Ğ·Ğ²Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ",
    "filterByModule": "Ğ¤Ñ–Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ...",
    "eventType": "Ğ¢Ğ¸Ğ¿ Ğ¿Ğ¾Ğ´Ñ–Ñ—",
    "severity": "Ğ Ñ–Ğ²ĞµĞ½ÑŒ ÑĞµÑ€Ğ¹Ğ¾Ğ·Ğ½Ğ¾ÑÑ‚Ñ–",
    "allTypes": "Ğ’ÑÑ– Ñ‚Ğ¸Ğ¿Ğ¸",
    "allSeverities": "Ğ’ÑÑ– Ñ€Ñ–Ğ²Ğ½Ñ–",
    "timestamp": "Ğ§Ğ°Ñ",
    "module": "ĞœĞ¾Ğ´ÑƒĞ»ÑŒ",
    "user": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡",
    "ip": "IP Ğ°Ğ´Ñ€ĞµÑĞ°",
    "status": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ",
    "noLogs": "Ğ–ÑƒÑ€Ğ½Ğ°Ğ» Ğ°ÑƒĞ´Ğ¸Ñ‚Ñƒ Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ñ–Ğ¹",
    "noLogsDesc": "ĞĞµĞ¼Ğ°Ñ” Ğ¿Ğ¾Ğ´Ñ–Ğ¹ Ğ±ĞµĞ·Ğ¿ĞµĞºĞ¸, Ñ‰Ğ¾ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ°ÑÑ‚ÑŒ Ğ²Ğ°ÑˆĞ¸Ğ¼ Ñ„Ñ–Ğ»ÑŒÑ‚Ñ€Ğ°Ğ¼.",
    "apiKeys": "API ĞšĞ»ÑÑ‡Ñ–",
    "noApiKeys": "ĞĞµĞ¼Ğ°Ñ” API ĞºĞ»ÑÑ‡Ñ–Ğ²",
    "noApiKeysDesc": "API ĞºĞ»ÑÑ‡Ñ– Ğ½Ğµ Ğ½Ğ°Ğ»Ğ°ÑˆÑ‚Ğ¾Ğ²Ğ°Ğ½Ñ–. Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ¹Ñ‚Ğµ CLI Ğ´Ğ»Ñ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ ĞºĞ»ÑÑ‡Ñ–Ğ².",
    "keyName": "ĞĞ°Ğ·Ğ²Ğ° ĞºĞ»ÑÑ‡Ğ°",
    "permissions": "ĞŸÑ€Ğ°Ğ²Ğ°",
    "created": "Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾",
    "expires": "Ğ—Ğ°ĞºÑ–Ğ½Ñ‡ÑƒÑ”Ñ‚ÑŒÑÑ",
    "lastUsed": "ĞÑÑ‚Ğ°Ğ½Ğ½Ñ” Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ",
    "usageCount": "ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½ÑŒ",
    "totalEvents": "Ğ’ÑÑŒĞ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ñ–Ğ¹",
    "violations": "ĞŸĞ¾Ñ€ÑƒÑˆĞµĞ½Ğ½Ñ",
    "eventTypes": "Ğ¢Ğ¸Ğ¿Ñ–Ğ² Ğ¿Ğ¾Ğ´Ñ–Ğ¹",
    "modules": "ĞœĞ¾Ğ´ÑƒĞ»Ñ–Ğ²",
    "eventsByType": "ĞŸĞ¾Ğ´Ñ–Ñ— Ğ·Ğ° Ñ‚Ğ¸Ğ¿Ğ°Ğ¼Ğ¸",
    "eventsBySeverity": "ĞŸĞ¾Ğ´Ñ–Ñ— Ğ·Ğ° ÑĞµÑ€Ğ¹Ğ¾Ğ·Ğ½Ñ–ÑÑ‚Ñ",
    "count": "ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ",
    "noStats": "Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°"
  },
  "database": {
    "title": "Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ¸Ñ… Ñ‚Ğ° Ğ´Ğ°Ğ½Ñ–",
    "subtitle": "SQL Runner, ĞœÑ–Ğ³Ñ€Ğ°Ñ†Ñ–Ñ— Ñ‚Ğ° Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ ĞºĞµÑˆĞµĞ¼",
    "sqlRunner": "SQL Runner",
    "migrations": "ĞœÑ–Ğ³Ñ€Ğ°Ñ†Ñ–Ñ—",
    "cache": "ĞšĞµÑˆ",
    "cacheExplorer": "ĞŸĞµÑ€ĞµĞ³Ğ»ÑĞ´ ĞºĞµÑˆÑƒ",
    "query": "SQL Ğ—Ğ°Ğ¿Ğ¸Ñ‚ (Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ SELECT)",
    "sqlNote": "Ğ¢Ñ–Ğ»ÑŒĞºĞ¸ SELECT Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ¸ Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»ĞµĞ½Ñ– Ğ´Ğ»Ñ Ğ±ĞµĞ·Ğ¿ĞµĞºĞ¸.",
    "execute": "Ğ’Ğ¸ĞºĞ¾Ğ½Ğ°Ñ‚Ğ¸",
    "results": "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¸",
    "rows": "Ñ€ÑĞ´ĞºÑ–Ğ²",
    "revision": "Ğ ĞµĞ²Ñ–Ğ·Ñ–Ñ",
    "description": "ĞĞ¿Ğ¸Ñ",
    "status": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ",
    "current": "ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ°",
    "pending": "ĞÑ‡Ñ–ĞºÑƒÑ”",
    "upgrade": "ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸",
    "downgrade": "Ğ’Ñ–Ğ´ĞºĞ¾Ñ‚Ğ¸Ñ‚Ğ¸",
    "confirmMigration": "Ğ’Ğ¸ĞºĞ¾Ğ½Ğ°Ñ‚Ğ¸ Ğ¼Ñ–Ğ³Ñ€Ğ°Ñ†Ñ–Ñ?",
    "noMigrations": "ĞœÑ–Ğ³Ñ€Ğ°Ñ†Ñ–Ñ— Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾",
    "searchPattern": "ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ (Ğ½Ğ°Ğ¿Ñ€Ğ¸ĞºĞ»Ğ°Ğ´, user:* Ğ°Ğ±Ğ¾ *)...",
    "search": "ĞŸĞ¾ÑˆÑƒĞº",
    "key": "ĞšĞ»ÑÑ‡",
    "ttl": "TTL",
    "noExpiry": "Ğ‘ĞµĞ· Ñ‚ĞµÑ€Ğ¼Ñ–Ğ½Ñƒ",
    "noCacheKeys": "ĞšĞ»ÑÑ‡Ñ– ĞºĞµÑˆÑƒ Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾",
    "noCacheKeysDesc": "ĞĞµĞ¼Ğ°Ñ” ĞºĞ»ÑÑ‡Ñ–Ğ², Ñ‰Ğ¾ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ°ÑÑ‚ÑŒ Ğ²Ğ°ÑˆĞ¾Ğ¼Ñƒ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ.",
    "flushCache": "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚Ğ¸ ĞºĞµÑˆ",
    "confirmFlushCache": "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚Ğ¸ Ğ²ĞµÑÑŒ ĞºĞµÑˆ? Ğ¦Ñ Ğ´Ñ–Ñ Ğ½Ğµ Ğ¼Ğ¾Ğ¶Ğ½Ğ° ÑĞºĞ°ÑÑƒĞ²Ğ°Ñ‚Ğ¸.",
    "cacheFlushed": "ĞšĞµÑˆ ÑƒÑĞ¿Ñ–ÑˆĞ½Ğ¾ Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½Ğ¾"
  },
  "broadcast": {
    "title": "Broadcast Studio",
    "subtitle": "Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Ñ‚Ğ° Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½ÑŒ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°Ğ¼",
    "create": "Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ñ€Ğ¾Ğ·ÑĞ¸Ğ»ĞºÑƒ",
    "history": "Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ",
    "messageEditor": "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½ÑŒ",
    "message": "ĞŸĞ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ",
    "messagePlaceholder": "Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ²Ğ°ÑˆĞµ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ñ‚ÑƒÑ‚...",
    "messageNote": "ĞŸÑ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ÑƒÑ”Ñ‚ÑŒÑÑ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ Markdown. Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ¹Ñ‚Ğµ /help Ğ´Ğ»Ñ ĞºĞµÑ€Ñ–Ğ²Ğ½Ğ¸Ñ†Ñ‚Ğ²Ğ° Ğ· Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ.",
    "targeting": "Ğ¦Ñ–Ğ»ÑŒĞ¾Ğ²Ğ° Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ñ–Ñ",
    "targetType": "Ğ¢Ğ¸Ğ¿ Ñ†Ñ–Ğ»ÑŒĞ¾Ğ²Ğ¾Ñ— Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ñ–Ñ—",
    "targetAll": "Ğ’ÑÑ– ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–",
    "targetAdmins": "Ğ¢Ñ–Ğ»ÑŒĞºĞ¸ Ğ°Ğ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¸",
    "targetRole": "Ğ—Ğ° Ñ€Ğ¾Ğ»Ğ»Ñ",
    "targetActive": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ– ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ– (Ğ¾ÑÑ‚Ğ°Ğ½Ğ½Ñ– N Ğ´Ğ½Ñ–Ğ²)",
    "targetInactive": "ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ– ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ– (Ğ½ĞµĞ¼Ğ°Ñ” Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ñ– N Ğ´Ğ½Ñ–Ğ²)",
    "targetNewUsers": "ĞĞ¾Ğ²Ñ– ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ– (Ğ·Ğ°Ñ€ĞµÑ”ÑÑ‚Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ– Ğ·Ğ° N Ğ´Ğ½Ñ–Ğ²)",
    "targetLanguage": "Ğ—Ğ° Ğ¼Ğ¾Ğ²Ğ¾Ñ",
    "targetActiveStatus": "Ğ—Ğ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ñ–",
    "days": "Ğ”Ğ½Ñ–",
    "language": "ĞšĞ¾Ğ´ Ğ¼Ğ¾Ğ²Ğ¸",
    "selectLanguage": "Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ¼Ğ¾Ğ²Ñƒ",
    "role": "Ğ Ğ¾Ğ»ÑŒ",
    "selectRole": "Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ",
    "roleUser": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡",
    "roleModerator": "ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€",
    "roleAdmin": "ĞĞ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€",
    "roleSuperAdmin": "Ğ¡ÑƒĞ¿ĞµÑ€ ĞĞ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€",
    "activeStatus": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ñ–",
    "selectActiveStatus": "Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ",
    "statusActive": "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ– ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–",
    "statusInactive": "ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ– ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–",
    "activeDaysNote": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–, ÑĞºÑ– Ğ±ÑƒĞ»Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ– Ğ·Ğ° Ğ¾ÑÑ‚Ğ°Ğ½Ğ½Ñ– N Ğ´Ğ½Ñ–Ğ²",
    "inactiveDaysNote": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–, ÑĞºÑ– Ğ½Ğµ Ğ±ÑƒĞ»Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ– N Ğ´Ğ½Ñ–Ğ²",
    "newUsersDaysNote": "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–, Ğ·Ğ°Ñ€ĞµÑ”ÑÑ‚Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ– Ğ·Ğ° Ğ¾ÑÑ‚Ğ°Ğ½Ğ½Ñ– N Ğ´Ğ½Ñ–Ğ²",
    "roleRequired": "Ğ Ğ¾Ğ»ÑŒ Ğ¾Ğ±Ğ¾Ğ²'ÑĞ·ĞºĞ¾Ğ²Ğ°",
    "activeStatusRequired": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ñ– Ğ¾Ğ±Ğ¾Ğ²'ÑĞ·ĞºĞ¾Ğ²Ğ¸Ğ¹",
    "scheduling": "ĞŸĞ»Ğ°Ğ½ÑƒĞ²Ğ°Ğ½Ğ½Ñ",
    "sendTime": "Ğ§Ğ°Ñ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸",
    "scheduleNote": "Ğ—Ğ°Ğ»Ğ¸ÑˆÑ‚Ğµ Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ñ–Ğ¼ Ğ´Ğ»Ñ Ğ½ĞµĞ³Ğ°Ğ¹Ğ½Ğ¾Ñ— Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸",
    "send": "Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚Ğ¸ Ñ€Ğ¾Ğ·ÑĞ¸Ğ»ĞºÑƒ",
    "progress": "ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑ Ñ€Ğ¾Ğ·ÑĞ¸Ğ»ĞºĞ¸",
    "sent": "Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾",
    "errors": "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ¸",
    "id": "ID",
    "target": "ĞœĞµÑ‚Ğ°",
    "recipients": "ĞÑ‚Ñ€Ğ¸Ğ¼ÑƒĞ²Ğ°Ñ‡Ñ–",
    "status": "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ",
    "created": "Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾",
    "noBroadcasts": "ĞĞµĞ¼Ğ°Ñ” Ñ€Ğ¾Ğ·ÑĞ¸Ğ»Ğ¾Ğº",
    "noBroadcastsDesc": "Ğ Ğ¾Ğ·ÑĞ¸Ğ»ĞºĞ¸ Ñ‰Ğµ Ğ½Ğµ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞ»Ğ¸ÑÑ.",
    "broadcastCreated": "Ğ Ğ¾Ğ·ÑĞ¸Ğ»ĞºÑƒ ÑƒÑĞ¿Ñ–ÑˆĞ½Ğ¾ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾",
    "messageRequired": "ĞŸĞ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ¾Ğ±Ğ¾Ğ²'ÑĞ·ĞºĞ¾Ğ²Ğµ",
    "daysRequired": "ĞšÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ğ´Ğ½Ñ–Ğ² Ğ¾Ğ±Ğ¾Ğ²'ÑĞ·ĞºĞ¾Ğ²Ğ° Ğ´Ğ»Ñ Ñ„Ñ–Ğ»ÑŒÑ‚Ñ€Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ñ… ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ²",
    "languageRequired": "ĞšĞ¾Ğ´ Ğ¼Ğ¾Ğ²Ğ¸ Ğ¾Ğ±Ğ¾Ğ²'ÑĞ·ĞºĞ¾Ğ²Ğ¸Ğ¹"
  }
}




======================================================================

------------------------------ FILE: Systems/locales/ua.yaml ------------------------------
# Ukrainian translations for SwiftDevBot
# Format: key: value (YAML dictionary format)

# ========== MAIN MENU ==========
main_menu_title: "ğŸ  Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğµ Ğ¼ĞµĞ½Ñ SwiftDevBot"
main_menu_reply_modules: "ğŸ—‚ ĞœĞ¾Ğ´ÑƒĞ»Ñ– Ñ‚Ğ° Ñ„ÑƒĞ½ĞºÑ†Ñ–Ñ—"
main_menu_reply_profile: "ğŸ‘¤ ĞœÑ–Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ñ–Ğ»ÑŒ"
main_menu_reply_feedback: "âœï¸ Ğ—Ğ²'ÑĞ·Ğ°Ñ‚Ğ¸ÑÑ Ğ· Ğ½Ğ°Ğ¼Ğ¸"
main_menu_reply_admin_panel: "ğŸ›  ĞĞ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ"
main_menu_inline_modules: "ğŸ—‚ ĞœĞ¾Ğ´ÑƒĞ»Ñ–"
main_menu_inline_profile: "ğŸ‘¤ ĞŸÑ€Ğ¾Ñ„Ñ–Ğ»ÑŒ"
main_menu_inline_feedback: "âœï¸ Ğ—Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ğ½Ğ¸Ğ¹ Ğ·Ğ²'ÑĞ·Ğ¾Ğº"
main_menu_inline_admin_panel: "ğŸ›  ĞĞ´Ğ¼Ñ–Ğ½ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ"

# ========== MODULES LIST ==========
modules_list_no_modules: "ğŸ¤· ĞœĞ¾Ğ´ÑƒĞ»Ñ– Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ–"
modules_list_title_template: "Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ– Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ– (Ğ¡Ñ‚Ğ¾Ñ€Ñ–Ğ½ĞºĞ° {current_page}/{total_pages}):"
pagination_prev: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´"
pagination_next: "Ğ”Ğ°Ğ»Ñ– â¡ï¸"
navigation_back_to_main: "ğŸ  Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğµ Ğ¼ĞµĞ½Ñ"
service_delete_message: "âŒ Ğ—Ğ°ĞºÑ€Ğ¸Ñ‚Ğ¸ Ñ†Ğµ Ğ¼ĞµĞ½Ñ"
confirm_yes: "âœ… Ğ¢Ğ°Ğº"
confirm_no: "âŒ ĞÑ–"

# ========== WELCOME MESSAGE ==========
welcome_message_title: "ğŸ‰ Ğ›Ğ°ÑĞºĞ°Ğ²Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¸Ğ¼Ğ¾ Ğ´Ğ¾ SwiftDevBot!"
welcome_message_body: "Ğ¯ â€” Ğ²Ğ°Ñˆ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¸Ğ¹ Telegram-Ğ¿Ğ¾Ğ¼Ñ–Ñ‡Ğ½Ğ¸Ğº, ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ·ÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ Ñ„ÑƒĞ½ĞºÑ†Ñ–Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ñ– Ñ‚Ğ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ñ–Ñ— Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½ÑŒ.\n\nğŸ” **Ğ©Ğ¾ Ñ Ğ¼Ğ¾Ğ¶Ñƒ?**\nĞœĞ¾Ñ— Ğ¼Ğ¾Ğ¶Ğ»Ğ¸Ğ²Ğ¾ÑÑ‚Ñ– Ğ·Ğ°Ğ»ĞµĞ¶Ğ°Ñ‚ÑŒ Ğ²Ñ–Ğ´ Ğ¿Ñ–Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ². Ğ¦Ğµ Ğ¼Ğ¾Ğ¶ÑƒÑ‚ÑŒ Ğ±ÑƒÑ‚Ğ¸ Ñ–Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ·Ñ€Ğ¾Ğ±ĞºĞ¸, ÑƒÑ‚Ğ¸Ğ»Ñ–Ñ‚Ğ¸, Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ğ¹Ğ½Ñ– ÑĞµÑ€Ğ²Ñ–ÑĞ¸ Ñ‚Ğ° Ğ±Ğ°Ğ³Ğ°Ñ‚Ğ¾ Ñ–Ğ½ÑˆĞ¾Ğ³Ğ¾.\n\nğŸ”’ **ĞšĞ¾Ğ½Ñ„Ñ–Ğ´ĞµĞ½Ñ†Ñ–Ğ¹Ğ½Ñ–ÑÑ‚ÑŒ:**\nĞ¯ Ğ¾Ğ±Ñ€Ğ¾Ğ±Ğ»ÑÑ Ğ»Ğ¸ÑˆĞµ Ñ‚Ñ– Ğ´Ğ°Ğ½Ñ–, ÑĞºÑ– Ğ½ĞµĞ¾Ğ±Ñ…Ñ–Ğ´Ğ½Ñ– Ğ´Ğ»Ñ Ğ¼Ğ¾Ñ”Ñ— Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸ Ñ‚Ğ° Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ². ĞœĞ¸ Ñ†Ñ–Ğ½ÑƒÑ”Ğ¼Ğ¾ Ğ²Ğ°ÑˆÑƒ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ–ÑÑ‚ÑŒ. Ğ”Ğ»Ñ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ½Ñ Ğ±Ñ–Ğ»ÑŒÑˆ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ñ— Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ— Ğ²Ğ¸ Ğ·Ğ°Ğ²Ğ¶Ğ´Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚Ğ¸ÑÑ Ğ´Ğ¾ Ğ°Ğ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ° Ğ±Ğ¾Ñ‚Ğ°.\n\nĞĞ°Ñ‚Ğ¸ÑĞºĞ°ÑÑ‡Ğ¸ Â«ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ²Ğ¶Ğ¸Ñ‚Ğ¸Â», Ğ²Ğ¸ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğ¶ÑƒÑ”Ñ‚ĞµÑÑ Ğ· Ñ‚Ğ¸Ğ¼, Ñ‰Ğ¾ Ğ±Ğ¾Ñ‚ Ğ±ÑƒĞ´Ğµ Ğ¾Ğ±Ñ€Ğ¾Ğ±Ğ»ÑÑ‚Ğ¸ Ğ²Ğ°ÑˆÑ– Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ´Ğ»Ñ Ğ½Ğ°Ğ´Ğ°Ğ½Ğ½Ñ ÑĞ²Ğ¾Ñ—Ñ… Ñ„ÑƒĞ½ĞºÑ†Ñ–Ğ¹."
welcome_button_continue: "âœ… ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ²Ğ¶Ğ¸Ñ‚Ğ¸"
welcome_button_cancel: "âŒ Ğ¡ĞºĞ°ÑÑƒĞ²Ğ°Ñ‚Ğ¸"
registration_cancelled_message: "Ğ”ÑƒĞ¶Ğµ ÑˆĞºĞ¾Ğ´Ğ°, Ñ‰Ğ¾ Ğ²Ğ¸ Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ»Ğ¸. Ğ¯ĞºÑ‰Ğ¾ Ğ½Ğ°Ğ´ÑƒĞ¼Ğ°Ñ”Ñ‚Ğµ Ğ·Ğ½Ğ¾Ğ²Ñƒ, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ½Ğ°Ğ¿Ğ¸ÑˆÑ–Ñ‚ÑŒ /start."
user_middleware_please_register: "ğŸ‘‹ Ğ¡Ñ…Ğ¾Ğ¶Ğµ, Ğ²Ğ¸ Ñ‰Ğµ Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ¾Ğ¼Ñ– Ğ·Ñ– Ğ¼Ğ½Ğ¾Ñ! Ğ©Ğ¾Ğ± Ğ¿Ğ¾Ñ‡Ğ°Ñ‚Ğ¸, Ğ±ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ½Ğ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ /start Ğ°Ğ±Ğ¾ Ğ²Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /start."

# ========== PROFILE ==========
profile_title: "ğŸ‘¤ Ğ’Ğ°Ñˆ Ğ¿Ñ€Ğ¾Ñ„Ñ–Ğ»ÑŒ"
profile_info_template: "ğŸ†” Ğ’Ğ°Ñˆ Telegram ID: {user_id}\nğŸ“ Ğ†Ğ¼'Ñ: {full_name}\nğŸ‘¤ Username: @{username}\nğŸ“… Ğ”Ğ°Ñ‚Ğ° Ñ€ĞµÑ”ÑÑ‚Ñ€Ğ°Ñ†Ñ–Ñ—: {registration_date}\nğŸ—£ ĞœĞ¾Ğ²Ğ° Ñ–Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑƒ: {current_language}"
profile_no_username: "Ğ½Ğµ Ğ²ĞºĞ°Ğ·Ğ°Ğ½Ğ¾"
profile_no_reg_date: "Ğ½ĞµĞ²Ñ–Ğ´Ğ¾Ğ¼Ğ¾"
profile_button_change_language: "ğŸŒ Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ğ¼Ğ¾Ğ²Ñƒ"
profile_select_language_title: "Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ¼Ğ¾Ğ²Ñƒ Ñ–Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑƒ:"
profile_language_changed: "ĞœĞ¾Ğ²Ñƒ Ğ·Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾ Ğ½Ğ° {lang}"
profile_language_change_error: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ·Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ½Ñ Ğ¼Ğ¾Ğ²Ğ¸."
profile_language_already_set: "ĞœĞ¾Ğ²Ğ° Ğ²Ğ¶Ğµ Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ° Ğ½Ğ° {lang}."
profile_language_user_not_found: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ´Ğ»Ñ Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ¼Ğ¾Ğ²Ğ¸."

# ========== COMMON MESSAGES ==========
main_menu_greeting: "Ğ— Ğ¿Ğ¾Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½ÑĞ¼, {user_name}! Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ´Ñ–Ñ:"
main_menu_text: "Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğµ Ğ¼ĞµĞ½Ñ:"
feedback_request: "âœï¸ Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ½Ğ°Ğ¿Ğ¸ÑˆÑ–Ñ‚ÑŒ Ğ²Ğ°ÑˆĞµ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ´Ğ»Ñ Ğ·Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ²'ÑĞ·ĞºÑƒ.\n*Ğ”Ğ»Ñ ÑĞºĞ°ÑÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ²Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ /cancel_feedback*"
feedback_cancelled: "Ğ’Ğ²ĞµĞ´ĞµĞ½Ğ½Ñ Ğ·Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ²'ÑĞ·ĞºÑƒ ÑĞºĞ°ÑĞ¾Ğ²Ğ°Ğ½Ğ¾."
feedback_thanks: "Ğ”ÑĞºÑƒÑ”Ğ¼Ğ¾ Ğ·Ğ° Ğ²Ğ°Ñˆ Ğ²Ñ–Ğ´Ğ³ÑƒĞº! ĞœĞ¸ Ğ¹Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ğ»Ğ¸."
feedback_sent: "Ğ—Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ğ½Ğ¸Ğ¹ Ğ·Ğ²'ÑĞ·Ğ¾Ğº ÑƒÑĞ¿Ñ–ÑˆĞ½Ğ¾ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾."
error_general: "âŒ Ğ¡Ñ‚Ğ°Ğ»Ğ°ÑÑ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ°. Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, ÑĞ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ñ–Ğ·Ğ½Ñ–ÑˆĞµ."
error_no_access: "âŒ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµĞ¼Ğ°Ñ” Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ"
error_permission_denied: "âŒ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğ·Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ½ĞµĞ½Ğ¾"

# ========== HELP COMMAND ==========
help_title: "â“ Ğ”Ğ¾Ğ²Ñ–Ğ´ĞºĞ° Ñ‚Ğ° ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ±Ğ¾Ñ‚Ğ°"
help_main_commands: "ğŸ“‹ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ– ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¸:"
help_module_commands: "ğŸ§© ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ²:"
help_tip_menu: "ğŸ’¡ ĞŸĞ¾Ñ€Ğ°Ğ´Ğ°: Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ¹Ñ‚Ğµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ Ğ´Ğ»Ñ ÑˆĞ²Ğ¸Ğ´ĞºĞ¾Ğ³Ğ¾ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ Ğ´Ğ¾ Ñ„ÑƒĞ½ĞºÑ†Ñ–Ğ¹."
help_tip_start: "ĞĞ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ /start, Ñ‰Ğ¾Ğ± Ğ²Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¸ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğµ Ğ¼ĞµĞ½Ñ."

# ========== LANGUAGE NAMES ==========
language_en: "English"
language_ua: "Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°"
language_ru: "Ğ Ğ¾ÑÑ–Ğ¹ÑÑŒĞºĞ°"

# ========== ADMIN PANEL ==========
admin_panel_title: "ğŸ›  ĞĞ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ° Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ SwiftDevBot"
admin_panel_select_section: "Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ñ€Ğ¾Ğ·Ğ´Ñ–Ğ» Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ:"
admin_no_access: "ğŸš« Ğ£ Ğ²Ğ°Ñ Ğ½ĞµĞ¼Ğ°Ñ” Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ Ğ´Ğ¾ Ğ°Ğ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ñ— Ğ¿Ğ°Ğ½ĞµĞ»Ñ–.\n\nĞ¯ĞºÑ‰Ğ¾ Ğ²Ğ¸ Ğ²Ğ²Ğ°Ğ¶Ğ°Ñ”Ñ‚Ğµ, Ñ‰Ğ¾ Ñ†Ğµ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ°, Ğ·Ğ²ĞµÑ€Ğ½Ñ–Ñ‚ÑŒÑÑ Ğ´Ğ¾ Ğ°Ğ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ° Ğ±Ğ¾Ñ‚Ğ°."
admin_modules_in_development: "Ğ Ğ¾Ğ·Ğ´Ñ–Ğ» 'Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸' Ğ² Ñ€Ğ¾Ğ·Ñ€Ğ¾Ğ±Ñ†Ñ–."

# ========== ADMIN COMMON TEXTS ==========
admin_back_to_main_menu_sdb: "ğŸ  Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğµ Ğ¼ĞµĞ½Ñ SDB"
admin_back_to_admin_menu_main: "â¬…ï¸ ĞĞ´Ğ¼Ñ–Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ (Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ°)"
admin_pagination_prev: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´"
admin_pagination_next: "Ğ”Ğ°Ğ»Ñ– â¡ï¸"
admin_confirm_yes: "âœ… Ğ¢Ğ°Ğº"
admin_confirm_no: "âŒ ĞÑ–"
admin_close_message: "âŒ Ğ—Ğ°ĞºÑ€Ğ¸Ñ‚Ğ¸ Ñ†Ğµ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ"
admin_error_general: "Ğ¡Ñ‚Ğ°Ğ»Ğ°ÑÑ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ°. Ğ¡Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ñ–Ğ·Ğ½Ñ–ÑˆĞµ."
admin_access_denied: "Ğ£ Ğ²Ğ°Ñ Ğ½ĞµĞ¼Ğ°Ñ” Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ñ†Ñ–Ñ”Ñ— Ğ´Ñ–Ñ—."
admin_not_found_generic: "Ğ—Ğ°Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğ¹ ĞµĞ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾."

# ========== ADMIN MENU BUTTONS ==========
admin_system_info: "â„¹ï¸ Ğ†Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ Ğ¿Ñ€Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ"
admin_manage_modules: "ğŸ§© Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸"
admin_manage_users: "ğŸ‘¥ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°Ğ¼Ğ¸"
admin_manage_roles: "ğŸ›¡ï¸ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸"

# ========== ADMIN PERMISSIONS ==========
admin_perm_category_core: "Ğ”Ğ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸ Ğ¯Ğ´Ñ€Ğ°"
admin_perm_category_modules: "Ğ”Ğ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸ ĞœĞ¾Ğ´ÑƒĞ»Ñ–Ğ²"
admin_perm_core_group_users: "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ– (Ğ¯Ğ´Ñ€Ğ¾)"
admin_perm_core_group_roles: "Ğ Ğ¾Ğ»Ñ– (Ğ¯Ğ´Ñ€Ğ¾)"
admin_perm_core_group_modules_core: "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸ (Ğ¯Ğ´Ñ€Ğ¾)"
admin_perm_core_group_system: "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° (Ğ¯Ğ´Ñ€Ğ¾)"
admin_perm_core_group_settings_core: "ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ¯Ğ´Ñ€Ğ°"
admin_perm_core_group_other: "Ğ†Ğ½ÑˆÑ– (Ğ¯Ğ´Ñ€Ğ¾)"
admin_back_to_perm_categories: "â¬…ï¸ Ğ”Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ñ–Ğ¹ Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»Ñ–Ğ²"
admin_back_to_core_perm_groups: "â¬…ï¸ Ğ”Ğ¾ Ğ³Ñ€ÑƒĞ¿ Ğ¯Ğ´Ñ€Ğ°"
admin_back_to_module_list_for_perms: "â¬…ï¸ Ğ”Ğ¾ ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ² (Ğ´Ğ»Ñ Ğ¿Ñ€Ğ°Ğ²)"
admin_no_modules_with_perms: "ĞĞµĞ¼Ğ°Ñ” Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ² Ğ· Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½ÑĞ¼Ğ¸ Ğ¿Ñ€Ğ°Ğ²"
admin_no_permissions_in_group: "Ğ£ Ñ†Ñ–Ğ¹ Ğ³Ñ€ÑƒĞ¿Ñ– Ğ½ĞµĞ¼Ğ°Ñ” Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»Ñ–Ğ²"

# ========== ADMIN FSM ROLE CREATION ==========
admin_fsm_enter_role_name: "Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ñ–Ğ¼'Ñ Ğ½Ğ¾Ğ²Ğ¾Ñ— Ñ€Ğ¾Ğ»Ñ–:"
admin_fsm_role_name_empty: "Ğ†Ğ¼'Ñ Ñ€Ğ¾Ğ»Ñ– Ğ½Ğµ Ğ¼Ğ¾Ğ¶Ğµ Ğ±ÑƒÑ‚Ğ¸ Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ñ–Ğ¼."
admin_fsm_role_name_taken: "Ğ Ğ¾Ğ»ÑŒ Ğ· Ñ–Ğ¼'ÑĞ¼ \"{role_name}\" Ğ²Ğ¶Ğµ Ñ–ÑĞ½ÑƒÑ”."
admin_fsm_enter_role_description: "Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ¾Ğ¿Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ñ– {role_name}:"
admin_fsm_command_skip_description: "/skip_description - ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğ¸"
admin_fsm_command_cancel_role_creation: "/cancel_role_creation - Ğ¡ĞºĞ°ÑÑƒĞ²Ğ°Ñ‚Ğ¸ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ"
admin_fsm_role_created_successfully: "Ğ Ğ¾Ğ»ÑŒ \"{role_name}\" ÑƒÑĞ¿Ñ–ÑˆĞ½Ğ¾ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ°!"
admin_fsm_role_creation_cancelled: "Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Ñ€Ğ¾Ğ»Ñ– ÑĞºĞ°ÑĞ¾Ğ²Ğ°Ğ½Ğ¾."

# ========== ADMIN FSM ROLE EDITING ==========
admin_fsm_edit_role_title: "Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ€Ğ¾Ğ»Ñ–: {role_name}"
admin_fsm_edit_role_name_not_allowed: "Ğ†Ğ¼'Ñ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ñ— Ñ€Ğ¾Ğ»Ñ– {role_name} Ğ·Ğ¼Ñ–Ğ½ÑĞ²Ğ°Ñ‚Ğ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ¶Ğ½Ğ°."
admin_fsm_enter_new_role_description: "Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ğ¸Ğ¹ Ğ¾Ğ¿Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ñ– {role_name} (Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¸Ğ¹: {current_description}):"
admin_fsm_enter_new_role_name: "Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ğµ Ñ–Ğ¼'Ñ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ñ– (Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğµ: {current_name}):"
admin_fsm_command_skip_name: "/skip_name - Ğ—Ğ°Ğ»Ğ¸ÑˆĞ¸Ñ‚Ğ¸ ÑĞº Ñ”"
admin_fsm_command_cancel_role_edit: "/cancel_role_edit - Ğ¡ĞºĞ°ÑÑƒĞ²Ğ°Ñ‚Ğ¸ Ñ€ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ"
admin_fsm_role_updated_successfully: "Ğ Ğ¾Ğ»ÑŒ \"{role_name}\" ÑƒÑĞ¿Ñ–ÑˆĞ½Ğ¾ Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°!"
admin_fsm_role_update_cancelled: "Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ€Ğ¾Ğ»Ñ– ÑĞºĞ°ÑĞ¾Ğ²Ğ°Ğ½Ğ¾."

# ========== ADMIN ROLE DELETION ==========
admin_delete_role_confirm_text: "Ğ’Ğ¸ Ğ²Ğ¿ĞµĞ²Ğ½ĞµĞ½Ñ–, Ñ‰Ğ¾ Ñ…Ğ¾Ñ‡ĞµÑ‚Ğµ Ğ²Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ Ñ€Ğ¾Ğ»ÑŒ {role_name}?\n{warning_if_users}\nĞ¦Ñ Ğ´Ñ–Ñ Ğ½ĞµĞ·Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ğ½Ğ°!"
admin_role_is_standard_cant_delete: "Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñƒ Ñ€Ğ¾Ğ»ÑŒ \"{role_name}\" Ğ²Ğ¸Ğ´Ğ°Ğ»ÑÑ‚Ğ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ¶Ğ½Ğ°."
admin_role_delete_failed: "ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ²Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ Ñ€Ğ¾Ğ»ÑŒ \"{role_name}\"."
admin_role_deleted_successfully: "Ğ Ğ¾Ğ»ÑŒ \"{role_name}\" ÑƒÑĞ¿Ñ–ÑˆĞ½Ğ¾ Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ°."

# ========== ADMIN USERS MANAGEMENT ==========
admin_user_list_title_template: "ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ– (Ğ¡Ñ‚Ñ€. {current_page}/{total_pages})"
admin_user_details_title: "Ğ†Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ Ğ¿Ñ€Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°"
admin_user_action_change_roles: "Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ñ€Ğ¾Ğ»Ñ–"
admin_user_action_toggle_active: "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ–ÑÑ‚ÑŒ: {status}"
admin_user_action_toggle_blocked: "Ğ‘Ğ»Ğ¾ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ: {status}"
admin_edit_roles_for_user: "Ğ—Ğ¼Ñ–Ğ½Ğ° Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ´Ğ»Ñ: {user_name}"
admin_back_to_user_details: "â¬…ï¸ Ğ”Ğ¾ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°"
admin_back_to_user_list: "â¬…ï¸ Ğ”Ğ¾ ÑĞ¿Ğ¸ÑĞºÑƒ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ²"
admin_user_is_owner_text: "ğŸ‘‘ Ğ’Ğ»Ğ°ÑĞ½Ğ¸Ğº ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸ (Ğ½ĞµĞ·Ğ¼Ñ–Ğ½Ğ½Ğ¸Ğ¹)"
admin_user_action_direct_perms: "ğŸ’ Ğ†Ğ½Ğ´Ğ¸Ğ²Ñ–Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ– Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸"
admin_edit_direct_perms_for_user: "ğŸ’ Ğ†Ğ½Ğ´Ğ¸Ğ²Ñ–Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ– Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸ Ğ´Ğ»Ñ: {user_name}"
admin_perm_status_direct: "âœ… (Ğ¿Ñ€ÑĞ¼Ğ¸Ğ¹)"
admin_perm_status_role: "â˜‘ï¸ (Ñ‡ĞµÑ€ĞµĞ· Ñ€Ğ¾Ğ»ÑŒ)"
admin_perm_status_none: "â¬œ (Ğ½ĞµĞ¼Ğ°Ñ”)"
admin_back_to_direct_perm_categories: "â¬…ï¸ Ğ”Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ñ–Ğ¹ Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»Ñ–Ğ² (Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°)"
admin_back_to_direct_perm_core_groups: "â¬…ï¸ Ğ”Ğ¾ Ğ³Ñ€ÑƒĞ¿ Ğ¯Ğ´Ñ€Ğ° (Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°)"
admin_back_to_direct_perm_module_list: "â¬…ï¸ Ğ”Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ² (Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°)"
admin_no_users_to_display: "ĞĞµĞ¼Ğ°Ñ” ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ² Ğ´Ğ»Ñ Ğ²Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ"
admin_user_active_yes: "Ğ¢Ğ°Ğº âœ…"
admin_user_active_no: "ĞÑ– ğŸ’¤"
admin_user_blocked_yes: "Ğ¢Ğ°Ğº ğŸš«"
admin_user_blocked_no: "ĞÑ– âœ…"
admin_user_no_roles: "Ğ½ĞµĞ¼Ğ°Ñ”"
admin_user_telegram_id: "Telegram ID"
admin_user_db_id: "DB ID"
admin_user_username: "Username"
admin_user_first_name: "Ğ†Ğ¼'Ñ"
admin_user_last_name: "ĞŸÑ€Ñ–Ğ·Ğ²Ğ¸Ñ‰Ğµ"
admin_user_language: "ĞœĞ¾Ğ²Ğ°"
admin_user_active: "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹"
admin_user_bot_blocked: "Ğ‘Ğ¾Ñ‚ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹"
admin_user_roles_status: "Ğ Ğ¾Ğ»Ñ–/Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ"
admin_user_registration: "Ğ ĞµÑ”ÑÑ‚Ñ€Ğ°Ñ†Ñ–Ñ"
admin_user_last_activity: "ĞÑÑ‚Ğ°Ğ½Ğ½Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ–ÑÑ‚ÑŒ"
admin_no_registered_users_notice: "ğŸ‘¥ ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–\n\nĞ£ Ğ±Ğ°Ğ·Ñ– Ğ´Ğ°Ğ½Ğ¸Ñ… Ğ½ĞµĞ¼Ğ°Ñ” Ğ·Ğ°Ñ€ĞµÑ”ÑÑ‚Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ… ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ²."

# ========== ADMIN USERS ERRORS ==========
admin_error_invalid_user_id_format: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: Ğ½ĞµĞ²Ñ–Ñ€Ğ½Ğ¸Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ID ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°."
admin_error_user_id_not_specified: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: ID ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° Ğ½Ğµ Ğ²ĞºĞ°Ğ·Ğ°Ğ½Ğ¾."
admin_error_user_id_for_roles_not_specified: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: ID ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ½Ğµ Ğ²ĞºĞ°Ğ·Ğ°Ğ½Ğ¾."
admin_error_invalid_user_id: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: Ğ½ĞµĞ²Ñ–Ñ€Ğ½Ğ¸Ğ¹ ID ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°."
admin_error_cannot_change_owner_roles: "Ğ Ğ¾Ğ»Ñ– Ğ’Ğ»Ğ°ÑĞ½Ğ¸ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸ Ğ½Ğµ Ğ·Ğ¼Ñ–Ğ½ÑÑÑ‚ÑŒÑÑ Ñ‡ĞµÑ€ĞµĞ· Ñ†ĞµĞ¹ Ñ–Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ."
admin_error_cannot_modify_owner_roles: "ĞĞµ Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ğ·Ğ¼Ñ–Ğ½ÑĞ²Ğ°Ñ‚Ğ¸ Ñ€Ğ¾Ğ»Ñ– Ğ’Ğ»Ğ°ÑĞ½Ğ¸ĞºĞ°."
admin_error_cannot_remove_last_role: "ĞĞµ Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ğ·Ğ½ÑÑ‚Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ½Ğ½Ñ Ñ€Ğ¾Ğ»ÑŒ '{role_name}'."
admin_error_invalid_role_data: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: Ğ½ĞµĞ²Ñ–Ñ€Ğ½Ñ– Ğ´Ğ°Ğ½Ñ– Ğ´Ğ»Ñ Ğ·Ğ¼Ñ–Ğ½Ğ¸ Ñ€Ğ¾Ğ»Ñ–."
admin_error_cannot_manage_owner_direct_perms: "ĞĞµ Ğ¼Ğ¾Ğ¶Ğ½Ğ° ĞºĞµÑ€ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ¿Ñ€ÑĞ¼Ğ¸Ğ¼Ğ¸ Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»Ğ°Ğ¼Ğ¸ Ğ’Ğ»Ğ°ÑĞ½Ğ¸ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸."
admin_error_cannot_modify_owner_direct_perms: "ĞĞµ Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ğ·Ğ¼Ñ–Ğ½ÑĞ²Ğ°Ñ‚Ğ¸ Ğ¿Ñ€ÑĞ¼Ñ– Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸ Ğ’Ğ»Ğ°ÑĞ½Ğ¸ĞºĞ°."
admin_error_fsm_state: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° ÑÑ‚Ğ°Ğ½Ñƒ FSM. Ğ¡Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ²Ğ¸Ğ¹Ñ‚Ğ¸ Ñ‚Ğ° ÑƒĞ²Ñ–Ğ¹Ñ‚Ğ¸ Ğ·Ğ½Ğ¾Ğ²Ñƒ."
admin_error_fsm_state_user_id: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° ÑÑ‚Ğ°Ğ½Ñƒ FSM (ID ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°)."
admin_error_fsm_state_role_id: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° ÑÑ‚Ğ°Ğ½Ñƒ FSM (ID Ñ€Ğ¾Ğ»Ñ–)."
admin_error_invalid_permission_data: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: Ğ½ĞµĞ²Ñ–Ñ€Ğ½Ñ– Ğ´Ğ°Ğ½Ñ– Ğ´Ğ»Ñ Ğ·Ğ¼Ñ–Ğ½Ğ¸ Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»Ñƒ."
admin_error_getting_users_data: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ¾Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ½Ñ Ğ´Ğ°Ğ½Ğ¸Ñ… Ğ¿Ñ€Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ²."
admin_error_display: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ²Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ."
admin_error_cannot_change_owner_status: "ĞĞµ Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ğ·Ğ¼Ñ–Ğ½ÑĞ²Ğ°Ñ‚Ğ¸ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ’Ğ»Ğ°ÑĞ½Ğ¸ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸."
admin_error_cannot_change_owner_block_status: "ĞĞµ Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ğ·Ğ¼Ñ–Ğ½ÑĞ²Ğ°Ñ‚Ğ¸ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ»Ğ¾ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ’Ğ»Ğ°ÑĞ½Ğ¸ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¸."
admin_error_saving: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ·Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ½Ñ."
admin_role_removed: "Ğ Ğ¾Ğ»ÑŒ '{role_name}' Ğ·Ğ½ÑÑ‚Ğ¾."
admin_role_failed_to_remove: "ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ·Ğ½ÑÑ‚Ğ¸ Ñ€Ğ¾Ğ»ÑŒ '{role_name}'."
admin_role_assigned: "Ğ Ğ¾Ğ»ÑŒ '{role_name}' Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¾."
admin_role_failed_to_assign: "ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚Ğ¸ Ñ€Ğ¾Ğ»ÑŒ '{role_name}'."
admin_direct_perm_removed: "ĞŸÑ€ÑĞ¼Ğ¸Ğ¹ Ğ´Ğ¾Ğ·Ğ²Ñ–Ğ» '{permission_name}' Ğ·Ğ½ÑÑ‚Ğ¾."
admin_direct_perm_failed_to_remove: "ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ·Ğ½ÑÑ‚Ğ¸ Ğ¿Ñ€ÑĞ¼Ğ¸Ğ¹ Ğ´Ğ¾Ğ·Ğ²Ñ–Ğ» '{permission_name}'."
admin_direct_perm_assigned: "ĞŸÑ€ÑĞ¼Ğ¸Ğ¹ Ğ´Ğ¾Ğ·Ğ²Ñ–Ğ» '{permission_name}' Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¾."
admin_direct_perm_failed_to_assign: "ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚Ğ¸ Ğ¿Ñ€ÑĞ¼Ğ¸Ğ¹ Ğ´Ğ¾Ğ·Ğ²Ñ–Ğ» '{permission_name}'."
admin_user_status_active_changed: "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ñ– {user_name} Ğ·Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾ Ğ½Ğ°: {status}"
admin_user_status_active_not_changed: "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ñ– Ğ½Ğµ Ğ±ÑƒĞ»Ğ¾ Ğ·Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾."
admin_user_block_status_changed: "Ğ‘Ğ»Ğ¾ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ´Ğ»Ñ {user_name} Ğ·Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾ Ğ½Ğ°: {status}"
admin_user_block_status_not_changed: "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ»Ğ¾ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ½Ğµ Ğ·Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾."

# ========== ADMIN ROLES MANAGEMENT ==========
admin_role_list_title: "ğŸ›¡ï¸ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸"
admin_role_list_select_action: "Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ´Ñƒ Ğ°Ğ±Ğ¾ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ:"
admin_role_list_no_roles: "ĞĞµĞ¼Ğ°Ñ” Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ²Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ"
admin_role_details_title: "ğŸ›¡ï¸ Ğ”ĞµÑ‚Ğ°Ğ»Ñ– Ñ€Ğ¾Ğ»Ñ–"
admin_role_action_edit_permissions: "Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸"
admin_role_action_edit_role: "âœï¸ Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸ Ñ€Ğ¾Ğ»ÑŒ"
admin_role_action_delete_role: "ğŸ—‘ï¸ Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ Ñ€Ğ¾Ğ»ÑŒ"
admin_back_to_roles_list: "â¬…ï¸ Ğ”Ğ¾ ÑĞ¿Ğ¸ÑĞºÑƒ Ñ€Ğ¾Ğ»ĞµĞ¹"
admin_edit_permissions_for_role: "Ğ”Ğ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ñ–: {role_name}"
admin_role_action_create_role: "â• Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ñ€Ğ¾Ğ»ÑŒ"
admin_role_permissions_heading: "Ğ’Ñ–Ğ´Ğ·Ğ½Ğ°Ñ‡Ñ‚Ğµ Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ/Ğ·Ğ½ÑÑ‚Ñ‚Ñ:"
admin_role_no_permissions: "  (Ğ½ĞµĞ¼Ğ°Ñ” Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ… Ğ´Ğ¾Ğ·Ğ²Ğ¾Ğ»Ñ–Ğ²)"
admin_role_description_label: "ĞĞ¿Ğ¸Ñ:"
admin_role_permissions_label: "Ğ”Ğ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸ Ñ†Ñ–Ñ”Ñ— Ñ€Ğ¾Ğ»Ñ–:"
admin_back_to_role_details: "â¬…ï¸ Ğ”Ğ¾ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ€Ğ¾Ğ»Ñ–"
admin_error_saving_role: "ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ·Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸ Ñ€Ğ¾Ğ»ÑŒ."
admin_error_role_id_not_specified: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: ID Ñ€Ğ¾Ğ»Ñ– Ğ½Ğµ Ğ²ĞºĞ°Ğ·Ğ°Ğ½Ğ¾."
admin_error_role_id_invalid: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: ID Ñ€Ğ¾Ğ»Ñ– Ğ½Ğµ Ğ²ĞºĞ°Ğ·Ğ°Ğ½Ğ¾ Ğ°Ğ±Ğ¾ Ğ½ĞµĞºĞ¾Ñ€ĞµĞºÑ‚Ğ½Ğ¸Ğ¹."
admin_error_no_permission_to_view_roles: "Ğ£ Ğ²Ğ°Ñ Ğ½ĞµĞ¼Ğ°Ñ” Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ´Ñƒ ÑĞ¿Ğ¸ÑĞºÑƒ Ñ€Ğ¾Ğ»ĞµĞ¹."
admin_error_checking_permissions: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ¸ Ğ¿Ñ€Ğ°Ğ²."
admin_error_displaying_role_list: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ²Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ ÑĞ¿Ğ¸ÑĞºÑƒ Ñ€Ğ¾Ğ»ĞµĞ¹."
admin_error_displaying_list: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ²Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ ÑĞ¿Ğ¸ÑĞºÑƒ."
admin_permission_removed_from_role: "Ğ”Ğ¾Ğ·Ğ²Ñ–Ğ» '{permission_name}' Ğ·Ğ½ÑÑ‚Ğ¾ Ğ· Ñ€Ğ¾Ğ»Ñ–."
admin_permission_failed_to_remove_from_role: "ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ·Ğ½ÑÑ‚Ğ¸ Ğ´Ğ¾Ğ·Ğ²Ñ–Ğ» '{permission_name}'."

# ========== ADMIN MODULES MANAGEMENT ==========
admin_modules_back_to_admin_panel: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğ² Ğ°Ğ´Ğ¼Ñ–Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ"
admin_modules_back_to_modules_list: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğ´Ğ¾ ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ²"
admin_modules_back_to_module_info: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğ´Ğ¾ Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ—"
admin_modules_toggle_disable: "âŒ Ğ’Ğ¸Ğ¼ĞºĞ½ÑƒÑ‚Ğ¸"
admin_modules_toggle_enable: "âœ… Ğ£Ğ²Ñ–Ğ¼ĞºĞ½ÑƒÑ‚Ğ¸"
admin_modules_actions: "ğŸ”§ Ğ”Ñ–Ñ—"
admin_modules_clean_tables: "ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚Ğ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ–"
admin_modules_error_no_module_loader: "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ÑƒĞ²Ğ°Ñ‡ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ² Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ğ¹."

# ========== ADMIN LOGS VIEWER ==========
admin_logs_back_to_admin_panel: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğ² Ğ°Ğ´Ğ¼Ñ–Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ"
admin_logs_back_to_files_list: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğ´Ğ¾ ÑĞ¿Ğ¸ÑĞºÑƒ Ñ„Ğ°Ğ¹Ğ»Ñ–Ğ²"
admin_logs_back_to_file_info: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğ´Ğ¾ Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ— Ğ¿Ñ€Ğ¾ Ñ„Ğ°Ğ¹Ğ»"
admin_logs_view_content: "ğŸ‘ï¸ ĞŸĞµÑ€ĞµĞ³Ğ»ÑĞ½ÑƒÑ‚Ğ¸ Ğ²Ğ¼Ñ–ÑÑ‚"
admin_logs_download_file: "ğŸ“¥ Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸ Ñ„Ğ°Ğ¹Ğ»"

# ========== ADMIN SYSTEM INFO ==========
admin_sys_info_title: "ğŸ–¥ï¸ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ° Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ SwiftDevBot"
admin_sys_info_general: "â„¹ï¸ Ğ—Ğ°Ğ³Ğ°Ğ»ÑŒĞ½Ğ° Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ"
admin_sys_info_bot_process: "ğŸ¤– ĞŸÑ€Ğ¾Ñ†ĞµÑ Ğ±Ğ¾Ñ‚Ğ°"
admin_sys_info_sdb_core: "SDB Core"
admin_sys_info_python: "Python"
admin_sys_info_aiogram: "Aiogram"
admin_sys_info_os: "ĞĞ¡"
admin_sys_info_uptime: "Ğ§Ğ°Ñ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸"
admin_sys_info_pid: "PID"
admin_sys_info_cpu_percent: "CPU"
admin_sys_info_memory: "ĞŸĞ°Ğ¼'ÑÑ‚ÑŒ"
admin_sys_info_database: "ğŸ—„ï¸ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ¸Ñ…"
admin_sys_info_db_type: "Ğ¢Ğ¸Ğ¿ Ğ‘Ğ”"
admin_sys_info_db_status: "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ"
admin_sys_info_users: "ğŸ‘¥ ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–"
admin_sys_info_total_users: "Ğ’ÑÑŒĞ¾Ğ³Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ²"
admin_sys_info_modules: "ğŸ§© ĞœĞ¾Ğ´ÑƒĞ»Ñ–"
admin_sys_info_total_modules: "Ğ’ÑÑŒĞ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ²"
admin_sys_info_enabled_modules: "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ–Ğ²"
admin_sys_info_loaded_modules: "Ğ£ÑĞ¿Ñ–ÑˆĞ½Ğ¾ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ¾"
admin_sys_info_process_not_found: "ĞŸÑ€Ğ¾Ñ†ĞµÑ Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾"
admin_sys_info_na: "Ğ/Ğ”"
admin_cache_section: "ğŸ’¾ ĞšĞµÑˆ"



======================================================================

------------------------------ FILE: Systems/locales/en.yaml ------------------------------
# English translations for SwiftDevBot
# Format: key: value (YAML dictionary format)

# ========== MAIN MENU ==========
main_menu_title: "ğŸ  Main Menu SwiftDevBot"
main_menu_reply_modules: "ğŸ—‚ Modules and Features"
main_menu_reply_profile: "ğŸ‘¤ My Profile"
main_menu_reply_feedback: "âœï¸ Contact Us"
main_menu_reply_admin_panel: "ğŸ›  Administration"
main_menu_inline_modules: "ğŸ—‚ Modules"
main_menu_inline_profile: "ğŸ‘¤ Profile"
main_menu_inline_feedback: "âœï¸ Feedback"
main_menu_inline_admin_panel: "ğŸ›  Admin Panel"

# ========== MODULES LIST ==========
modules_list_no_modules: "ğŸ¤· No modules available"
modules_list_title_template: "Available Modules (Page {current_page}/{total_pages}):"
pagination_prev: "â¬…ï¸ Prev"
pagination_next: "Next â¡ï¸"
navigation_back_to_main: "ğŸ  Main Menu"
service_delete_message: "âŒ Close this menu"
confirm_yes: "âœ… Yes"
confirm_no: "âŒ No"

# ========== WELCOME MESSAGE ==========
welcome_message_title: "ğŸ‰ Welcome to SwiftDevBot!"
welcome_message_body: "I am your modular Telegram assistant, created to extend functionality and automate tasks.\n\nğŸ” **What can I do?**\nMy capabilities depend on the connected modules. These can be development tools, utilities, information services, and much more.\n\nğŸ”’ **Privacy:**\nI process only the data necessary for my work and the work of active modules. We value your privacy. For more information, you can always contact the bot administrator.\n\nBy clicking \"Continue\", you agree that the bot will process your messages to provide its functions."
welcome_button_continue: "âœ… Continue"
welcome_button_cancel: "âŒ Cancel"
registration_cancelled_message: "We're sorry you changed your mind. If you change your mind again, just type /start."
user_middleware_please_register: "ğŸ‘‹ It seems you haven't met me yet! To get started, please press /start or type the /start command."

# ========== PROFILE ==========
profile_title: "ğŸ‘¤ Your Profile"
profile_info_template: "ğŸ†” Your Telegram ID: {user_id}\nğŸ“ Name: {full_name}\nğŸ‘¤ Username: @{username}\nğŸ“… Registration date: {registration_date}\nğŸ—£ Interface language: {current_language}"
profile_no_username: "not specified"
profile_no_reg_date: "unknown"
profile_button_change_language: "ğŸŒ Change Language"
profile_select_language_title: "Select interface language:"
profile_language_changed: "Language changed to {lang}"
profile_language_change_error: "Error saving language."
profile_language_already_set: "Language is already set to {lang}."
profile_language_user_not_found: "Error: user not found for language update."

# ========== COMMON MESSAGES ==========
main_menu_greeting: "Welcome back, {user_name}! Choose an action:"
main_menu_text: "Main Menu:"
feedback_request: "âœï¸ Please write your message for feedback.\n*To cancel, enter /cancel_feedback*"
feedback_cancelled: "Feedback input cancelled."
feedback_thanks: "Thank you for your feedback! We received it."
feedback_sent: "Feedback sent successfully."
error_general: "âŒ An error occurred. Please try again later."
error_no_access: "âŒ You don't have access"
error_permission_denied: "âŒ Permission denied"

# ========== HELP COMMAND ==========
help_title: "â“ Help and Bot Commands"
help_main_commands: "ğŸ“‹ Main Commands:"
help_module_commands: "ğŸ§© Module Commands:"
help_tip_menu: "ğŸ’¡ Tip: Use the main menu buttons for quick access to functions."
help_tip_start: "Press /start to open the main menu."

# ========== LANGUAGE NAMES ==========
language_en: "English"
language_ua: "Ukrainian"
language_ru: "Russian"

# ========== ADMIN PANEL ==========
admin_panel_title: "ğŸ›  SwiftDevBot Administrative Panel"
admin_panel_select_section: "Select a section to manage:"
admin_no_access: "ğŸš« You do not have access to the administrative panel.\n\nIf you believe this is an error, please contact the bot administrator."
admin_modules_in_development: "The 'Module Management' section is under development."

# ========== ADMIN COMMON TEXTS ==========
admin_back_to_main_menu_sdb: "ğŸ  SDB Main Menu"
admin_back_to_admin_menu_main: "â¬…ï¸ Admin Panel (Main)"
admin_pagination_prev: "â¬…ï¸ Prev"
admin_pagination_next: "Next â¡ï¸"
admin_confirm_yes: "âœ… Yes"
admin_confirm_no: "âŒ No"
admin_close_message: "âŒ Close this message"
admin_error_general: "An error occurred. Please try again later."
admin_access_denied: "You do not have permission for this action."
admin_not_found_generic: "The requested item was not found."

# ========== ADMIN MENU BUTTONS ==========
admin_system_info: "â„¹ï¸ System Information"
admin_manage_modules: "ğŸ§© Module Management"
admin_manage_users: "ğŸ‘¥ User Management"
admin_manage_roles: "ğŸ›¡ï¸ Role Management"

# ========== ADMIN PERMISSIONS ==========
admin_perm_category_core: "Core Permissions"
admin_perm_category_modules: "Module Permissions"
admin_perm_core_group_users: "Users (Core)"
admin_perm_core_group_roles: "Roles (Core)"
admin_perm_core_group_modules_core: "Module Management (Core)"
admin_perm_core_group_system: "System (Core)"
admin_perm_core_group_settings_core: "Core Settings"
admin_perm_core_group_other: "Other (Core)"
admin_back_to_perm_categories: "â¬…ï¸ To Permission Categories"
admin_back_to_core_perm_groups: "â¬…ï¸ To Core Groups"
admin_back_to_module_list_for_perms: "â¬…ï¸ To Module List (for permissions)"
admin_no_modules_with_perms: "No modules with permission declarations"
admin_no_permissions_in_group: "This group has no permissions"

# ========== ADMIN FSM ROLE CREATION ==========
admin_fsm_enter_role_name: "Enter the name of the new role:"
admin_fsm_role_name_empty: "Role name cannot be empty."
admin_fsm_role_name_taken: "A role with the name \"{role_name}\" already exists."
admin_fsm_enter_role_description: "Enter a description for role {role_name}:"
admin_fsm_command_skip_description: "/skip_description - Skip"
admin_fsm_command_cancel_role_creation: "/cancel_role_creation - Cancel creation"
admin_fsm_role_created_successfully: "Role \"{role_name}\" created successfully!"
admin_fsm_role_creation_cancelled: "Role creation cancelled."

# ========== ADMIN FSM ROLE EDITING ==========
admin_fsm_edit_role_title: "Editing role: {role_name}"
admin_fsm_edit_role_name_not_allowed: "Cannot change the name of standard role {role_name}."
admin_fsm_enter_new_role_description: "Enter a new description for role {role_name} (current: {current_description}):"
admin_fsm_enter_new_role_name: "Enter a new name for the role (current: {current_name}):"
admin_fsm_command_skip_name: "/skip_name - Leave as is"
admin_fsm_command_cancel_role_edit: "/cancel_role_edit - Cancel editing"
admin_fsm_role_updated_successfully: "Role \"{role_name}\" updated successfully!"
admin_fsm_role_update_cancelled: "Role editing cancelled."

# ========== ADMIN ROLE DELETION ==========
admin_delete_role_confirm_text: "Are you sure you want to delete role {role_name}?\n{warning_if_users}\nThis action is irreversible!"
admin_role_is_standard_cant_delete: "Cannot delete standard role \"{role_name}\"."
admin_role_delete_failed: "Failed to delete role \"{role_name}\"."
admin_role_deleted_successfully: "Role \"{role_name}\" deleted successfully."

# ========== ADMIN USERS MANAGEMENT ==========
admin_user_list_title_template: "Users (Page {current_page}/{total_pages})"
admin_user_details_title: "User Information"
admin_user_action_change_roles: "Change Roles"
admin_user_action_toggle_active: "Active: {status}"
admin_user_action_toggle_blocked: "Blocked: {status}"
admin_edit_roles_for_user: "Changing roles for: {user_name}"
admin_back_to_user_details: "â¬…ï¸ To User Details"
admin_back_to_user_list: "â¬…ï¸ To Users List"
admin_user_is_owner_text: "ğŸ‘‘ System Owner (immutable)"
admin_user_action_direct_perms: "ğŸ’ Direct Permissions"
admin_edit_direct_perms_for_user: "ğŸ’ Direct Permissions for: {user_name}"
admin_perm_status_direct: "âœ… (direct)"
admin_perm_status_role: "â˜‘ï¸ (via role)"
admin_perm_status_none: "â¬œ (none)"
admin_back_to_direct_perm_categories: "â¬…ï¸ To Permission Categories (for user)"
admin_back_to_direct_perm_core_groups: "â¬…ï¸ To Core Groups (for user)"
admin_back_to_direct_perm_module_list: "â¬…ï¸ To Modules (for user)"
admin_no_users_to_display: "No users to display"
admin_user_active_yes: "Yes âœ…"
admin_user_active_no: "No ğŸ’¤"
admin_user_blocked_yes: "Yes ğŸš«"
admin_user_blocked_no: "No âœ…"
admin_user_no_roles: "none"
admin_user_telegram_id: "Telegram ID"
admin_user_db_id: "DB ID"
admin_user_username: "Username"
admin_user_first_name: "First Name"
admin_user_last_name: "Last Name"
admin_user_language: "Language"
admin_user_active: "Active"
admin_user_bot_blocked: "Bot Blocked"
admin_user_roles_status: "Roles/Status"
admin_user_registration: "Registration"
admin_user_last_activity: "Last Activity"
admin_no_registered_users_notice: "ğŸ‘¥ Users\n\nNo users are registered in the database."

# ========== ADMIN USERS ERRORS ==========
admin_error_invalid_user_id_format: "Error: invalid user ID format."
admin_error_user_id_not_specified: "Error: user ID not specified."
admin_error_user_id_for_roles_not_specified: "Error: user ID for editing roles not specified."
admin_error_invalid_user_id: "Error: invalid user ID."
admin_error_cannot_change_owner_roles: "System Owner roles cannot be changed through this interface."
admin_error_cannot_modify_owner_roles: "Cannot modify Owner roles."
admin_error_cannot_remove_last_role: "Cannot remove the last role '{role_name}'."
admin_error_invalid_role_data: "Error: invalid data for changing role."
admin_error_cannot_manage_owner_direct_perms: "Cannot manage System Owner direct permissions."
admin_error_cannot_modify_owner_direct_perms: "Cannot modify Owner direct permissions."
admin_error_fsm_state: "FSM state error. Please exit and enter again."
admin_error_fsm_state_user_id: "FSM state error (user ID)."
admin_error_fsm_state_role_id: "FSM state error (role ID)."
admin_error_invalid_permission_data: "Error: invalid data for changing permission."
admin_error_getting_users_data: "Error getting user data."
admin_error_display: "Display error."
admin_error_cannot_change_owner_status: "Cannot change System Owner status."
admin_error_cannot_change_owner_block_status: "Cannot change System Owner block status."
admin_error_saving: "Error saving."
admin_role_removed: "Role '{role_name}' removed."
admin_role_failed_to_remove: "Failed to remove role '{role_name}'."
admin_role_assigned: "Role '{role_name}' assigned."
admin_role_failed_to_assign: "Failed to assign role '{role_name}'."
admin_direct_perm_removed: "Direct permission '{permission_name}' removed."
admin_direct_perm_failed_to_remove: "Failed to remove direct permission '{permission_name}'."
admin_direct_perm_assigned: "Direct permission '{permission_name}' assigned."
admin_direct_perm_failed_to_assign: "Failed to assign direct permission '{permission_name}'."
admin_user_status_active_changed: "Active status for {user_name} changed to: {status}"
admin_user_status_active_not_changed: "Active status was not changed."
admin_user_block_status_changed: "Block status for {user_name} changed to: {status}"
admin_user_block_status_not_changed: "Block status not changed."

# ========== ADMIN ROLES MANAGEMENT ==========
admin_role_list_title: "ğŸ›¡ï¸ Role Management"
admin_role_list_select_action: "Select a role to view or manage:"
admin_role_list_no_roles: "No roles to display"
admin_role_details_title: "ğŸ›¡ï¸ Role Details"
admin_role_action_edit_permissions: "Edit Permissions"
admin_role_action_edit_role: "âœï¸ Edit Role"
admin_role_action_delete_role: "ğŸ—‘ï¸ Delete Role"
admin_back_to_roles_list: "â¬…ï¸ To Roles List"
admin_edit_permissions_for_role: "Permissions for role: {role_name}"
admin_role_action_create_role: "â• Create Role"
admin_role_permissions_heading: "Mark permissions to grant/revoke:"
admin_role_no_permissions: "  (no assigned permissions)"
admin_role_description_label: "Description:"
admin_role_permissions_label: "Permissions for this role:"
admin_back_to_role_details: "â¬…ï¸ To Role Details"
admin_error_saving_role: "Unable to save role."
admin_error_role_id_not_specified: "Error: role ID not specified."
admin_error_role_id_invalid: "Error: role ID not specified or invalid."
admin_error_no_permission_to_view_roles: "You do not have permission to view the roles list."
admin_error_checking_permissions: "Error checking permissions."
admin_error_displaying_role_list: "Error displaying roles list."
admin_error_displaying_list: "Error displaying list."
admin_permission_removed_from_role: "Permission '{permission_name}' removed from role."
admin_permission_failed_to_remove_from_role: "Failed to remove permission '{permission_name}'."

# ========== ADMIN MODULES MANAGEMENT ==========
admin_modules_back_to_admin_panel: "â¬…ï¸ Back to Admin Panel"
admin_modules_back_to_modules_list: "â¬…ï¸ Back to Modules List"
admin_modules_back_to_module_info: "â¬…ï¸ Back to Information"
admin_modules_toggle_disable: "âŒ Disable"
admin_modules_toggle_enable: "âœ… Enable"
admin_modules_actions: "ğŸ”§ Actions"
admin_modules_clean_tables: "ğŸ—‘ï¸ Clean Tables"
admin_modules_error_no_module_loader: "Error: Module loader unavailable."

# ========== ADMIN LOGS VIEWER ==========
admin_logs_back_to_admin_panel: "â¬…ï¸ Back to Admin Panel"
admin_logs_back_to_files_list: "â¬…ï¸ Back to Files List"
admin_logs_back_to_file_info: "â¬…ï¸ Back to File Information"
admin_logs_view_content: "ğŸ‘ï¸ View Content"
admin_logs_download_file: "ğŸ“¥ Download File"

# ========== ADMIN SYSTEM INFO ==========
admin_sys_info_title: "ğŸ–¥ï¸ SwiftDevBot System Information"
admin_sys_info_general: "â„¹ï¸ General Information"
admin_sys_info_bot_process: "ğŸ¤– Bot Process"
admin_sys_info_sdb_core: "SDB Core"
admin_sys_info_python: "Python"
admin_sys_info_aiogram: "Aiogram"
admin_sys_info_os: "OS"
admin_sys_info_uptime: "Uptime"
admin_sys_info_pid: "PID"
admin_sys_info_cpu_percent: "CPU"
admin_sys_info_memory: "Memory"
admin_sys_info_database: "ğŸ—„ï¸ Database"
admin_sys_info_db_type: "DB Type"
admin_sys_info_db_status: "Status"
admin_sys_info_users: "ğŸ‘¥ Users"
admin_sys_info_total_users: "Total Users"
admin_sys_info_modules: "ğŸ§© Modules"
admin_sys_info_total_modules: "Total Modules"
admin_sys_info_enabled_modules: "Enabled Modules"
admin_sys_info_loaded_modules: "Loaded Successfully"
admin_sys_info_process_not_found: "Process not found"
admin_sys_info_na: "N/A"
admin_cache_section: "ğŸ’¾ Cache"



======================================================================

------------------------------ FILE: Systems/locales/ru.yaml ------------------------------
# Russian translations for SwiftDevBot (default)
# Format: key: value (YAML dictionary format)

# ========== MAIN MENU ==========
main_menu_title: "ğŸ  Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ SwiftDevBot"
main_menu_reply_modules: "ğŸ—‚ ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸"
main_menu_reply_profile: "ğŸ‘¤ ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ"
main_menu_reply_feedback: "âœï¸ Ğ¡Ğ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ Ñ Ğ½Ğ°Ğ¼Ğ¸"
main_menu_reply_admin_panel: "ğŸ›  ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ"
main_menu_inline_modules: "ğŸ—‚ ĞœĞ¾Ğ´ÑƒĞ»Ğ¸"
main_menu_inline_profile: "ğŸ‘¤ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ"
main_menu_inline_feedback: "âœï¸ ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ"
main_menu_inline_admin_panel: "ğŸ›  ĞĞ´Ğ¼Ğ¸Ğ½ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ"

# ========== MODULES LIST ==========
modules_list_no_modules: "ğŸ¤· ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹"
modules_list_title_template: "Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ (Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° {current_page}/{total_pages}):"
pagination_prev: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´"
pagination_next: "Ğ’Ğ¿ĞµÑ€ĞµĞ´ â¡ï¸"
navigation_back_to_main: "ğŸ  Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ"
service_delete_message: "âŒ Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ ÑÑ‚Ğ¾ Ğ¼ĞµĞ½Ñ"
confirm_yes: "âœ… Ğ”Ğ°"
confirm_no: "âŒ ĞĞµÑ‚"

# ========== WELCOME MESSAGE ==========
welcome_message_title: "ğŸ‰ Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² SwiftDevBot!"
welcome_message_body: "Ğ¯ â€” Ğ²Ğ°Ñˆ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ñ‹Ğ¹ Telegram-Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº, ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ´Ğ»Ñ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡.\n\nğŸ” **Ğ§Ñ‚Ğ¾ Ñ Ğ¼Ğ¾Ğ³Ñƒ?**\nĞœĞ¾Ğ¸ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ·Ğ°Ğ²Ğ¸ÑÑÑ‚ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹. Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸, ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹, Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¸ Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ğµ Ğ´Ñ€ÑƒĞ³Ğ¾Ğµ.\n\nğŸ”’ **ĞšĞ¾Ğ½Ñ„Ğ¸Ğ´ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ:**\nĞ¯ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¾ĞµĞ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹. ĞœÑ‹ Ñ†ĞµĞ½Ğ¸Ğ¼ Ğ²Ğ°ÑˆÑƒ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ. Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ‹ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒÑÑ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ Ğ±Ğ¾Ñ‚Ğ°.\n\nĞĞ°Ğ¶Ğ¸Ğ¼Ğ°Ñ Â«ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒÂ», Ğ²Ñ‹ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞ°ĞµÑ‚ĞµÑÑŒ Ñ Ñ‚ĞµĞ¼, Ñ‡Ñ‚Ğ¾ Ğ±Ğ¾Ñ‚ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ°ÑˆĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ²Ğ¾Ğ¸Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹."
welcome_button_continue: "âœ… ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ"
welcome_button_cancel: "âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°"
registration_cancelled_message: "ĞÑ‡ĞµĞ½ÑŒ Ğ¶Ğ°Ğ»ÑŒ, Ñ‡Ñ‚Ğ¾ Ğ²Ñ‹ Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ»Ğ¸. Ğ•ÑĞ»Ğ¸ Ğ½Ğ°Ğ´ÑƒĞ¼Ğ°ĞµÑ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ /start."
user_middleware_please_register: "ğŸ‘‹ ĞŸĞ¾Ñ…Ğ¾Ğ¶Ğµ, Ğ²Ñ‹ ĞµÑ‰Ğµ Ğ½Ğµ Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ñ‹ ÑĞ¾ Ğ¼Ğ½Ğ¾Ğ¹! Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ /start Ğ¸Ğ»Ğ¸ Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /start."

# ========== PROFILE ==========
profile_title: "ğŸ‘¤ Ğ’Ğ°Ñˆ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ"
profile_info_template: "ğŸ†” Ğ’Ğ°Ñˆ Telegram ID: {user_id}\nğŸ“ Ğ˜Ğ¼Ñ: {full_name}\nğŸ‘¤ Username: @{username}\nğŸ“… Ğ”Ğ°Ñ‚Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸: {registration_date}\nğŸ—£ Ğ¯Ğ·Ñ‹Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°: {current_language}"
profile_no_username: "Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½"
profile_no_reg_date: "Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾"
profile_button_change_language: "ğŸŒ Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº"
profile_select_language_title: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ·Ñ‹Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°:"
profile_language_changed: "Ğ¯Ğ·Ñ‹Ğº Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½ Ğ½Ğ° {lang}"
profile_language_change_error: "ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ ÑĞ·Ñ‹ĞºĞ°."
profile_language_already_set: "Ğ¯Ğ·Ñ‹Ğº ÑƒĞ¶Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ½Ğ° {lang}."
profile_language_user_not_found: "ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ·Ñ‹ĞºĞ°."

# ========== COMMON MESSAGES ==========
main_menu_greeting: "Ğ¡ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸ĞµĞ¼, {user_name}! Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ:"
main_menu_text: "Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ:"
feedback_request: "âœï¸ ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ²Ğ°ÑˆĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑĞ²ÑĞ·Ğ¸.\n*Ğ”Ğ»Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹ Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ /cancel_feedback*"
feedback_cancelled: "Ğ’Ğ²Ğ¾Ğ´ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑĞ²ÑĞ·Ğ¸ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½."
feedback_thanks: "Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾ Ğ·Ğ° Ğ²Ğ°Ñˆ Ğ¾Ñ‚Ğ·Ñ‹Ğ²! ĞœÑ‹ ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ¸."
feedback_sent: "ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ°."
error_general: "âŒ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ."
error_no_access: "âŒ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°"
error_permission_denied: "âŒ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½"

# ========== HELP COMMAND ==========
help_title: "â“ ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ Ğ¸ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ±Ğ¾Ñ‚Ğ°"
help_main_commands: "ğŸ“‹ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:"
help_module_commands: "ğŸ§© ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹:"
help_tip_menu: "ğŸ’¡ Ğ¡Ğ¾Ğ²ĞµÑ‚: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ñ„ÑƒĞ½ĞºÑ†Ğ¸ÑĞ¼."
help_tip_start: "ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ /start, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ."

# ========== LANGUAGE NAMES ==========
language_en: "English"
language_ua: "Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°"
language_ru: "Ğ ÑƒÑÑĞºĞ¸Ğ¹"

# ========== ADMIN PANEL ==========
admin_panel_title: "ğŸ›  ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ SwiftDevBot"
admin_panel_select_section: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ» Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:"
admin_no_access: "ğŸš« Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸.\n\nĞ•ÑĞ»Ğ¸ Ğ²Ñ‹ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚Ğµ, Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°, Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ĞµÑÑŒ Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñƒ Ğ±Ğ¾Ñ‚Ğ°."
admin_modules_in_development: "Ğ Ğ°Ğ·Ğ´ĞµĞ» 'Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸' Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ."

# ========== ADMIN COMMON TEXTS ==========
admin_back_to_main_menu_sdb: "ğŸ  Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ SDB"
admin_back_to_admin_menu_main: "â¬…ï¸ ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ (Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ)"
admin_pagination_prev: "â¬…ï¸ ĞŸÑ€ĞµĞ´."
admin_pagination_next: "Ğ¡Ğ»ĞµĞ´. â¡ï¸"
admin_confirm_yes: "âœ… Ğ”Ğ°"
admin_confirm_no: "âŒ ĞĞµÑ‚"
admin_close_message: "âŒ Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ ÑÑ‚Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ"
admin_error_general: "ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ."
admin_access_denied: "Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ."
admin_not_found_generic: "Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½."

# ========== ADMIN MENU BUTTONS ==========
admin_system_info: "â„¹ï¸ Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ"
admin_manage_modules: "ğŸ§© Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸"
admin_manage_users: "ğŸ‘¥ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸"
admin_manage_roles: "ğŸ›¡ï¸ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸"

# ========== ADMIN PERMISSIONS ==========
admin_perm_category_core: "Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¯Ğ´Ñ€Ğ°"
admin_perm_category_modules: "Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ ĞœĞ¾Ğ´ÑƒĞ»ĞµĞ¹"
admin_perm_core_group_users: "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ (Ğ¯Ğ´Ñ€Ğ¾)"
admin_perm_core_group_roles: "Ğ Ğ¾Ğ»Ğ¸ (Ğ¯Ğ´Ñ€Ğ¾)"
admin_perm_core_group_modules_core: "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸ (Ğ¯Ğ´Ñ€Ğ¾)"
admin_perm_core_group_system: "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° (Ğ¯Ğ´Ñ€Ğ¾)"
admin_perm_core_group_settings_core: "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¯Ğ´Ñ€Ğ°"
admin_perm_core_group_other: "ĞŸÑ€Ğ¾Ñ‡Ğ¸Ğµ (Ğ¯Ğ´Ñ€Ğ¾)"
admin_back_to_perm_categories: "â¬…ï¸ Ğš ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹"
admin_back_to_core_perm_groups: "â¬…ï¸ Ğš Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ğ¼ Ğ¯Ğ´Ñ€Ğ°"
admin_back_to_module_list_for_perms: "â¬…ï¸ Ğš ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ (Ğ´Ğ»Ñ Ğ¿Ñ€Ğ°Ğ²)"
admin_no_modules_with_perms: "ĞĞµÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ñ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ¿Ñ€Ğ°Ğ²"
admin_no_permissions_in_group: "Ğ’ ÑÑ‚Ğ¾Ğ¹ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğµ Ğ½ĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹"

# ========== ADMIN FSM ROLE CREATION ==========
admin_fsm_enter_role_name: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ¼Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸:"
admin_fsm_role_name_empty: "Ğ˜Ğ¼Ñ Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼."
admin_fsm_role_name_taken: "Ğ Ğ¾Ğ»ÑŒ Ñ Ğ¸Ğ¼ĞµĞ½ĞµĞ¼ \"{role_name}\" ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚."
admin_fsm_enter_role_description: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ {role_name}:"
admin_fsm_command_skip_description: "/skip_description - ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ"
admin_fsm_command_cancel_role_creation: "/cancel_role_creation - ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ"
admin_fsm_role_created_successfully: "Ğ Ğ¾Ğ»ÑŒ \"{role_name}\" ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°!"
admin_fsm_role_creation_cancelled: "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾."

# ========== ADMIN FSM ROLE EDITING ==========
admin_fsm_edit_role_title: "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸: {role_name}"
admin_fsm_edit_role_name_not_allowed: "Ğ˜Ğ¼Ñ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸ {role_name} Ğ¸Ğ·Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ½ĞµĞ»ÑŒĞ·Ñ."
admin_fsm_enter_new_role_description: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ {role_name} (Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ: {current_description}):"
admin_fsm_enter_new_role_name: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¸Ğ¼Ñ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸ (Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ: {current_name}):"
admin_fsm_command_skip_name: "/skip_name - ĞÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ"
admin_fsm_command_cancel_role_edit: "/cancel_role_edit - ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ"
admin_fsm_role_updated_successfully: "Ğ Ğ¾Ğ»ÑŒ \"{role_name}\" ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°!"
admin_fsm_role_update_cancelled: "Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾."

# ========== ADMIN ROLE DELETION ==========
admin_delete_role_confirm_text: "Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ {role_name}?\n{warning_if_users}\nĞ­Ñ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ½ĞµĞ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ğ¼Ğ¾!"
admin_role_is_standard_cant_delete: "Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½ÑƒÑ Ñ€Ğ¾Ğ»ÑŒ \"{role_name}\" ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Ğ½ĞµĞ»ÑŒĞ·Ñ."
admin_role_delete_failed: "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ \"{role_name}\"."
admin_role_deleted_successfully: "Ğ Ğ¾Ğ»ÑŒ \"{role_name}\" ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ°."

# ========== ADMIN USERS MANAGEMENT ==========
admin_user_list_title_template: "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ (Ğ¡Ñ‚Ñ€. {current_page}/{total_pages})"
admin_user_details_title: "Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ"
admin_user_action_change_roles: "Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»Ğ¸"
admin_user_action_toggle_active: "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ: {status}"
admin_user_action_toggle_blocked: "Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°: {status}"
admin_edit_roles_for_user: "Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ´Ğ»Ñ: {user_name}"
admin_back_to_user_details: "â¬…ï¸ Ğš Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"
admin_back_to_user_list: "â¬…ï¸ Ğš ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹"
admin_user_is_owner_text: "ğŸ‘‘ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ† ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ (Ğ½ĞµĞ¸Ğ·Ğ¼ĞµĞ½ÑĞµĞ¼Ñ‹Ğ¹)"
admin_user_action_direct_perms: "ğŸ’ Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ"
admin_edit_direct_perms_for_user: "ğŸ’ Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ: {user_name}"
admin_perm_status_direct: "âœ… (Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ)"
admin_perm_status_role: "â˜‘ï¸ (Ñ‡ĞµÑ€ĞµĞ· Ñ€Ğ¾Ğ»ÑŒ)"
admin_perm_status_none: "â¬œ (Ğ½ĞµÑ‚)"
admin_back_to_direct_perm_categories: "â¬…ï¸ Ğš ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹ (Ğ´Ğ»Ñ ÑĞ·ĞµÑ€Ğ°)"
admin_back_to_direct_perm_core_groups: "â¬…ï¸ Ğš Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°Ğ¼ Ğ¯Ğ´Ñ€Ğ° (Ğ´Ğ»Ñ ÑĞ·ĞµÑ€Ğ°)"
admin_back_to_direct_perm_module_list: "â¬…ï¸ Ğš Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼ (Ğ´Ğ»Ñ ÑĞ·ĞµÑ€Ğ°)"
admin_no_users_to_display: "ĞĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ"
admin_user_active_yes: "Ğ”Ğ° âœ…"
admin_user_active_no: "ĞĞµÑ‚ ğŸ’¤"
admin_user_blocked_yes: "Ğ”Ğ° ğŸš«"
admin_user_blocked_no: "ĞĞµÑ‚ âœ…"
admin_user_no_roles: "Ğ½ĞµÑ‚"
admin_user_telegram_id: "Telegram ID"
admin_user_db_id: "DB ID"
admin_user_username: "Username"
admin_user_first_name: "Ğ˜Ğ¼Ñ"
admin_user_last_name: "Ğ¤Ğ°Ğ¼Ğ¸Ğ»Ğ¸Ñ"
admin_user_language: "Ğ¯Ğ·Ñ‹Ğº"
admin_user_active: "ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½"
admin_user_bot_blocked: "Ğ‘Ğ¾Ñ‚ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½"
admin_user_roles_status: "Ğ Ğ¾Ğ»Ğ¸/Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ"
admin_user_registration: "Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ"
admin_user_last_activity: "ĞŸĞ¾ÑĞ». Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ"
admin_no_registered_users_notice: "ğŸ‘¥ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸\n\nĞ’ Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½ĞµÑ‚ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹."

# ========== ADMIN USERS ERRORS ==========
admin_error_invalid_user_id_format: "ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ."
admin_error_user_id_not_specified: "ĞÑˆĞ¸Ğ±ĞºĞ°: ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½."
admin_error_user_id_for_roles_not_specified: "ĞÑˆĞ¸Ğ±ĞºĞ°: ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½."
admin_error_invalid_user_id: "ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ."
admin_error_cannot_change_owner_roles: "Ğ Ğ¾Ğ»Ğ¸ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ½Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· ÑÑ‚Ğ¾Ñ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ."
admin_error_cannot_modify_owner_roles: "ĞĞµĞ»ÑŒĞ·Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ñ€Ğ¾Ğ»Ğ¸ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°."
admin_error_cannot_remove_last_role: "ĞĞµĞ»ÑŒĞ·Ñ ÑĞ½ÑÑ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ñ€Ğ¾Ğ»ÑŒ '{role_name}'."
admin_error_invalid_role_data: "ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ»Ğ¸."
admin_error_cannot_manage_owner_direct_perms: "ĞĞµĞ»ÑŒĞ·Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹."
admin_error_cannot_modify_owner_direct_perms: "ĞĞµĞ»ÑŒĞ·Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°."
admin_error_fsm_state: "ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ FSM. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ²Ñ‹Ğ¹Ñ‚Ğ¸ Ğ¸ Ğ²Ğ¾Ğ¹Ñ‚Ğ¸ ÑĞ½Ğ¾Ğ²Ğ°."
admin_error_fsm_state_user_id: "ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ FSM (ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ)."
admin_error_fsm_state_role_id: "ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ FSM (ID Ñ€Ğ¾Ğ»Ğ¸)."
admin_error_invalid_permission_data: "ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ½ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ."
admin_error_getting_users_data: "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑÑ…."
admin_error_display: "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ."
admin_error_cannot_change_owner_status: "ĞĞµĞ»ÑŒĞ·Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ÑÑ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹."
admin_error_cannot_change_owner_block_status: "ĞĞµĞ»ÑŒĞ·Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ÑÑ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ’Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹."
admin_error_saving: "ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ."
admin_role_removed: "Ğ Ğ¾Ğ»ÑŒ '{role_name}' ÑĞ½ÑÑ‚Ğ°."
admin_role_failed_to_remove: "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ½ÑÑ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ '{role_name}'."
admin_role_assigned: "Ğ Ğ¾Ğ»ÑŒ '{role_name}' Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ°."
admin_role_failed_to_assign: "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ '{role_name}'."
admin_direct_perm_removed: "ĞŸÑ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' ÑĞ½ÑÑ‚Ğ¾."
admin_direct_perm_failed_to_remove: "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ½ÑÑ‚ÑŒ Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}'."
admin_direct_perm_assigned: "ĞŸÑ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¾."
admin_direct_perm_failed_to_assign: "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}'."
admin_user_status_active_changed: "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ {user_name} Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½ Ğ½Ğ°: {status}"
admin_user_status_active_not_changed: "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ½Ğµ Ğ±Ñ‹Ğ» Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½."
admin_user_block_status_changed: "Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ´Ğ»Ñ {user_name} Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ° Ğ½Ğ°: {status}"
admin_user_block_status_not_changed: "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ½Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½."

# ========== ADMIN ROLES MANAGEMENT ==========
admin_role_list_title: "ğŸ›¡ï¸ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»ÑĞ¼Ğ¸"
admin_role_list_select_action: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ¸Ğ»Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:"
admin_role_list_no_roles: "ĞĞµÑ‚ Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ"
admin_role_details_title: "ğŸ›¡ï¸ Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ñ€Ğ¾Ğ»Ğ¸"
admin_role_action_edit_permissions: "Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ"
admin_role_action_edit_role: "âœï¸ Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ"
admin_role_action_delete_role: "ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ"
admin_back_to_roles_list: "â¬…ï¸ Ğš ÑĞ¿Ğ¸ÑĞºÑƒ Ñ€Ğ¾Ğ»ĞµĞ¹"
admin_edit_permissions_for_role: "Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ¾Ğ»Ğ¸: {role_name}"
admin_role_action_create_role: "â• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ"
admin_error_role_id_not_specified: "ĞÑˆĞ¸Ğ±ĞºĞ°: ID Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½."
admin_error_role_id_invalid: "ĞÑˆĞ¸Ğ±ĞºĞ°: ID Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚ĞµĞ½."
admin_error_no_permission_to_view_roles: "Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° ÑĞ¿Ğ¸ÑĞºĞ° Ñ€Ğ¾Ğ»ĞµĞ¹."
admin_error_checking_permissions: "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ°Ğ²."
admin_error_displaying_role_list: "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ° Ñ€Ğ¾Ğ»ĞµĞ¹."
admin_error_displaying_list: "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ°."
admin_permission_removed_from_role: "Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}' ÑĞ½ÑÑ‚Ğ¾ Ñ Ñ€Ğ¾Ğ»Ğ¸."
admin_permission_failed_to_remove_from_role: "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ½ÑÑ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ '{permission_name}'."

# ========== ADMIN MODULES MANAGEMENT ==========
admin_modules_back_to_admin_panel: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ"
admin_modules_back_to_modules_list: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"
admin_modules_back_to_module_info: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸"
admin_modules_toggle_disable: "âŒ ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ"
admin_modules_toggle_enable: "âœ… Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ"
admin_modules_actions: "ğŸ”§ Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ"
admin_modules_clean_tables: "ğŸ—‘ï¸ ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹"
admin_modules_error_no_module_loader: "ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ñ‡Ğ¸Ğº Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½."

# ========== ADMIN LOGS VIEWER ==========
admin_logs_back_to_admin_panel: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ"
admin_logs_back_to_files_list: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº ÑĞ¿Ğ¸ÑĞºÑƒ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²"
admin_logs_back_to_file_info: "â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğµ"
admin_logs_view_content: "ğŸ‘ï¸ ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ"
admin_logs_download_file: "ğŸ“¥ Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»"

# ========== ADMIN SYSTEM INFO ==========
admin_sys_info_title: "ğŸ–¥ï¸ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ SwiftDevBot"
admin_sys_info_general: "â„¹ï¸ ĞĞ±Ñ‰Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ"
admin_sys_info_bot_process: "ğŸ¤– ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ±Ğ¾Ñ‚Ğ°"
admin_sys_info_sdb_core: "SDB Core"
admin_sys_info_python: "Python"
admin_sys_info_aiogram: "Aiogram"
admin_sys_info_os: "ĞĞ¡"
admin_sys_info_uptime: "Ğ’Ñ€ĞµĞ¼Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹"
admin_sys_info_pid: "PID"
admin_sys_info_cpu_percent: "CPU"
admin_sys_info_memory: "ĞŸĞ°Ğ¼ÑÑ‚ÑŒ"
admin_sys_info_database: "ğŸ—„ï¸ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"
admin_sys_info_db_type: "Ğ¢Ğ¸Ğ¿ Ğ‘Ğ”"
admin_sys_info_db_status: "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ"
admin_sys_info_users: "ğŸ‘¥ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸"
admin_sys_info_total_users: "Ğ’ÑĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹"
admin_sys_info_modules: "ğŸ§© ĞœĞ¾Ğ´ÑƒĞ»Ğ¸"
admin_sys_info_total_modules: "Ğ’ÑĞµĞ³Ğ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"
admin_sys_info_enabled_modules: "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹"
admin_sys_info_loaded_modules: "Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¾"
admin_sys_info_process_not_found: "ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
admin_sys_info_na: "Ğ/Ğ”"
admin_cache_section: "ğŸ’¾ ĞšÑÑˆ"
admin_role_permissions_heading: "ĞÑ‚Ğ¼ĞµÑ‚ÑŒÑ‚Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ/ÑĞ½ÑÑ‚Ğ¸Ñ:"
admin_role_no_permissions: "  (Ğ½ĞµÑ‚ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ‹Ñ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğ¹)"
admin_role_description_label: "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:"
admin_role_permissions_label: "Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸:"
admin_back_to_role_details: "â¬…ï¸ Ğš Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼ Ñ€Ğ¾Ğ»Ğ¸"
admin_error_saving_role: "ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ñ€Ğ¾Ğ»Ğ¸."



======================================================================

------------------------------ FILE: Data/sdb_bot.pid ------------------------------
230698


======================================================================

------------------------------ FILE: Data/Security/audit_logs/audit_2025-11-21.jsonl ------------------------------
{"event_id": "AUDIT_1763744326147_0", "event_type": "module_load", "module_name": "universal_template", "user_id": null, "timestamp": 1763744326.147252, "severity": "medium", "details": {"version": "1.0.0", "display_name": "Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ ĞœĞ¾Ğ´ÑƒĞ»Ñ", "settings": {"enabled": true, "max_items_per_user": 10, "api_key": "", "debug_mode": false, "notification_enabled": true, "max_file_size": 10}}, "ip_address": null, "user_agent": null, "success": true, "error_message": null}
{"event_id": "AUDIT_1763744498969_0", "event_type": "module_load", "module_name": "universal_template", "user_id": null, "timestamp": 1763744498.9697626, "severity": "medium", "details": {"version": "1.0.0", "display_name": "Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ ĞœĞ¾Ğ´ÑƒĞ»Ñ", "settings": {"enabled": true, "max_items_per_user": 10, "api_key": "", "debug_mode": false, "notification_enabled": true, "max_file_size": 10}}, "ip_address": null, "user_agent": null, "success": true, "error_message": null}
{"event_id": "AUDIT_1763744616584_0", "event_type": "module_load", "module_name": "universal_template", "user_id": null, "timestamp": 1763744616.5840292, "severity": "medium", "details": {"version": "1.0.0", "display_name": "Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ ĞœĞ¾Ğ´ÑƒĞ»Ñ", "settings": {"enabled": true, "max_items_per_user": 10, "api_key": "", "debug_mode": false, "notification_enabled": true, "max_file_size": 10}}, "ip_address": null, "user_agent": null, "success": true, "error_message": null}
{"event_id": "AUDIT_1763755590366_0", "event_type": "module_load", "module_name": "universal_template", "user_id": null, "timestamp": 1763755590.3665397, "severity": "medium", "details": {"version": "1.0.0", "display_name": "Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ ĞœĞ¾Ğ´ÑƒĞ»Ñ", "settings": {"enabled": true, "max_items_per_user": 10, "api_key": "", "debug_mode": false, "notification_enabled": true, "max_file_size": 10}}, "ip_address": null, "user_agent": null, "success": true, "error_message": null}



======================================================================

------------------------------ FILE: Data/Security/audit_logs/audit_2025-11-22.jsonl ------------------------------
{"event_id": "AUDIT_1763810399481_0", "event_type": "module_load", "module_name": "universal_template", "user_id": null, "timestamp": 1763810399.4812348, "severity": "medium", "details": {"version": "1.0.0", "display_name": "Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ ĞœĞ¾Ğ´ÑƒĞ»Ñ", "settings": {"enabled": true, "max_items_per_user": 10, "api_key": "", "debug_mode": false, "notification_enabled": true, "max_file_size": 10}}, "ip_address": null, "user_agent": null, "success": true, "error_message": null}
{"event_id": "AUDIT_1763812514182_0", "event_type": "module_load", "module_name": "universal_template", "user_id": null, "timestamp": 1763812514.182045, "severity": "medium", "details": {"version": "1.0.0", "display_name": "Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ ĞœĞ¾Ğ´ÑƒĞ»Ñ", "settings": {"enabled": true, "max_items_per_user": 10, "api_key": "", "debug_mode": false, "notification_enabled": true, "max_file_size": 10}}, "ip_address": null, "user_agent": null, "success": true, "error_message": null}
{"event_id": "AUDIT_1763830998182_0", "event_type": "module_load", "module_name": "universal_template", "user_id": null, "timestamp": 1763830998.1822236, "severity": "medium", "details": {"version": "1.0.0", "display_name": "Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ ĞœĞ¾Ğ´ÑƒĞ»Ñ", "settings": {"enabled": true, "max_items_per_user": 10, "api_key": "", "debug_mode": false, "notification_enabled": true, "max_file_size": 10}}, "ip_address": null, "user_agent": null, "success": true, "error_message": null}



======================================================================

------------------------------ FILE: Data/Security/crypto_keys/.master_password ------------------------------
Ë¨G->yOÚ§q@Ğ’%[&


======================================================================

------------------------------ FILE: Data/Security/jwt_keys/jwt_secret.key ------------------------------
H1xf5-aBVkM8Grr3J25leXOTOBng55yZMQwGynXG90r7j3kRqtb1fSdNX6E5S4F_MFXhfbXDBQSl8NkBFTTZbw


======================================================================

------------------------------ FILE: Data/Security/jwt_keys/jwt_public_key.pem ------------------------------
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtP5QF8C2JEzpCyGwFq9b
h+LSEF9C9QRm4pflSQoz9oNHPHxdQMxuhTLVVdxZCX6LKgd9rZDyZLI24gtBpYHd
I53KHAU0uFMdanNfE0w9WYb1I0D3dCRWrTHPQ2o1jvUgy4khYLoFBxMzGhKdppfJ
dKGR5WfJCjDgGziUEiRd8h/y1C1WDh7CFbL8H4vrRBbuamohcDM7K/g1G5jYL9k4
UTqxK2qQ9PWgfdKQLtFpAg883566sEAA6D6nHyx6LHq370gdjd9HVxsJp52Q8fnK
/YyEOPPJNhovdjouqiFSYoJuTdw99muyuvdqroWkDf/jDV6+0ZzZ0BKVFq1Ts4Gz
8wIDAQAB
-----END PUBLIC KEY-----



======================================================================

------------------------------ FILE: Data/Security/jwt_keys/jwt_private_key.pem ------------------------------
-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC0/lAXwLYkTOkL
IbAWr1uH4tIQX0L1BGbil+VJCjP2g0c8fF1AzG6FMtVV3FkJfosqB32tkPJksjbi
C0Glgd0jncocBTS4Ux1qc18TTD1ZhvUjQPd0JFatMc9DajWO9SDLiSFgugUHEzMa
Ep2ml8l0oZHlZ8kKMOAbOJQSJF3yH/LULVYOHsIVsvwfi+tEFu5qaiFwMzsr+DUb
mNgv2ThROrErapD09aB90pAu0WkCDzzfnrqwQADoPqcfLHoserfvSB2N30dXGwmn
nZDx+cr9jIQ488k2Gi92Oi6qIVJigm5N3D32a7K692quhaQN/+MNXr7RnNnQEpUW
rVOzgbPzAgMBAAECggEAKxTDnLvGvyI9cGRe5S9tUo13YeVC605WbQYp0fZnQvyh
hrC1g7iFcBgW9p6B5QQlfOYWkKtJPxW6gZibUhl0uUcUNhI5J8zE2jNHBLFngvlg
PTl4DUGfDg+mnY3Y3MPVQA1OkBcHHlWAGusmcmJ71dKlhxzqmg3jMieH+z+Dyx9P
xeXU67gbNSxhWIiDI3Ch9jYH5GzWn1MyoTLJKyV4EqkpwDn70i8Y8kXGJ3kvDv5l
K2PQLh5yf4gFHh9ElOpWe5If/jVp4R7T9o0gvADWQVdLKkxoY0x2bOg7DZCnCXhw
U/dDInqqM15JssrUC3XSkUpmPdyy4IuhQx0aUjEsdQKBgQDr+4O7ZzPD7D9jHwty
/1PEgNttdQEjpqjWrhrJBMw/SVZoCuIeArPvp0y7ofTrF/feEe6Mb7yN3zREE75x
E9yh4mJQRGR8hnwdrJz5j7JUyL1thaPzEh2pi9/dDv7RBN3Dq/qEzG9+P6YGsyMs
TEcMjiKx67ojdv8JRWR7DsM9ZQKBgQDEWK5qWrB9VSsefzQfv+eIGKxD7/Vtu2tZ
mK/eP61A15+ujCrfuws6vWs6xvMt4mMerHTnXeL9stWdlnjYze7xmGdpyHF2FeMl
9Bu4zWQipdqTfIxCB6W/VsKHJC2IHed2M5M+ywTuvlkT8f0w+wGLnvch/WDsd3oq
ey3s6gnidwKBgDWhLWjzpVILaMRwE7wIxtLLrhKMGrwtbgWL/85bZsejNR3kC0ti
td3rGYcy4WRkSBKR5LLJ2gIsDcbC7e7o4qVvu4QeZu/d6GseBXa5739RN6uiSYY+
Qbt8bF3iwIpkHroPZZm0lEoO0P6Iy5+Pnj3+N2hT+DODIabLvHAzBK/5AoGAArt5
MeGxMw1MXFBI2WhCQJKXUxqzv6MsC0Mkr2MTdiOKBVPOBO8FaPvZ0ieSmsDbwEGG
HvIfhohGkLrXU60J9jK4vbAcZBhJ4O1UtW2mRxUnxYWmLgUNOWxrqJXITGyeG/b7
xZPtraTYeH6Vl2jmzJqZtc9g2emPuaedK/7VxGECgYEAsLYBt244ZrUNYJ4B50aO
NFPYzmEvlUOisargyeNEhzVr0GN0V5ayVGabq3yUhkncmfYQHkVvTTm1ZszxB4Nr
bsny8O0WGL5Y0SSr4xamrLtLqL25laGW3h171v7zyN8T2WzHu5A1pbrw3X66ni8L
2O8ilfOuvZ+SJpEn/XMbSzY=
-----END PRIVATE KEY-----



======================================================================

------------------------------ FILE: Data/Security/trusted_keys/trusted_signers.json ------------------------------
{
  "sdb_core_team": {
    "name": "SDB Core Team",
    "email": "core@sdb.dev",
    "key_id": "SDB-CORE-2024",
    "reputation": "trusted",
    "description": "ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ SDB"
  }
}


======================================================================

------------------------------ FILE: Data/Config/core_settings.yaml ------------------------------
cache:
  type: redis
  redis_url: redis://192.168.31.3:6379/0
module_repo:
  index_url: 
    https://raw.githubusercontent.com/soverxos/SwiftDevBot-Modules/main/modules_index.json
core:
  enabled_modules_config_path: Config/enabled_modules.json
  log_level: INFO
  log_to_file: true
  log_structured_dir: Logs
  log_rotation_size: 100 MB
  log_retention_period_structured: 3 months
  sdb_version: 0.1.0
  setup_bot_commands_on_startup: true
  enable_startup_shutdown_notifications: true
  i18n:
    domain: bot
    default_locale: ru
    available_locales:
      - ru
      - en
      - ua
db:
  type: postgresql
  pg_dsn: postgresql+psycopg://postgres:Sova3568@192.168.31.3:2345/swiftdevbot



======================================================================

------------------------------ FILE: Data/Config/enabled_modules.json ------------------------------
{
  "active_modules": [
    "ai_chat",
    "broadcast",
    "sys_status",
    "universal_template"
  ],
  "disabled_modules": []
}


======================================================================

------------------------------ FILE: Data/Config/modules_settings/broadcast.yaml ------------------------------
enabled: true



======================================================================

------------------------------ FILE: Data/Config/modules_settings/universal_template.yaml ------------------------------
enabled: true
max_items_per_user: 10
api_key: ''
debug_mode: false
notification_enabled: true
max_file_size: 10
default_priority: 50
auto_cleanup_days: 30
items_per_page: 5
show_timestamps: true
require_confirmation_for_delete: true
log_all_actions: true
cache_enabled: true
cache_ttl: 300
notify_on_create: true
notify_on_update: false
notify_on_delete: true
webhook_enabled: false
webhook_url: ''
webhook_secret: ''



======================================================================

------------------------------ FILE: Data/Config/modules_settings/ai_chat.yaml ------------------------------
provider: mock
api_key: ''



======================================================================

------------------------------ FILE: config/cloud_password_7847397229.txt ------------------------------
7e071fd9b023ed8f18458a73613a0834f6220bd5cc50357ba3493c6040a9ea8c


======================================================================

------------------------------ FILE: config/security_keys.json ------------------------------
{
  "jwt_secret": "Kt4wtXW-tbX64ymkzooxi_-GNNk0QwhUdkzrXSdbPuQ"
}


======================================================================

------------------------------ FILE: config/cloud_password_5526658109.txt ------------------------------
ee79976c9380d5e337fc1c095ece8c8f22f91f306ceeb161fa51fecede2c4ba1


======================================================================

------------------------------ FILE: .github/workflows/docker.yml ------------------------------
name: Docker Build

on:
  push:
    branches: [ main ]
    tags:
      - 'v*'
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
    
    - name: Login to Docker Hub
      if: github.event_name != 'pull_request'
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
    
    - name: Build and push
      uses: docker/build-push-action@v5
      with:
        context: .
        push: ${{ github.event_name != 'pull_request' }}
        tags: |
          swiftdevbot:latest
          swiftdevbot:${{ github.sha }}
          swiftdevbot:${{ github.ref_name }}
        cache-from: type=gha
        cache-to: type=gha,mode=max




======================================================================

------------------------------ FILE: .github/workflows/ci.yml ------------------------------
# GitHub Actions workflow that runs Pytest (including web API tests) inside the project virtualenv.
name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: 3.11

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -r requirements.txt

      - name: Create and activate .venv
        run: |
          python -m venv .venv
          . .venv/bin/activate
          pip install pytest pytest-cov httpx pytest-asyncio

      - name: Run unit tests
        run: |
          . .venv/bin/activate
          pytest tests/

      - name: Run web API smoke tests
        run: |
          . .venv/bin/activate
          pytest tests/test_web_app.py
name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        python-version: ["3.12", "3.13"]
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Cache pip packages
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest pytest-cov pytest-asyncio
    
    - name: Lint with pylint
      run: |
        pip install pylint
        pylint Systems/core Modules --disable=all --enable=E,F --exit-zero || true
    
    - name: Format check with black
      run: |
        pip install black
        black --check Systems/core Modules || true
    
    - name: Type check with mypy
      run: |
        pip install mypy
        mypy Systems/core Modules --ignore-missing-imports || true
    
    - name: Test with pytest
      run: |
        pytest --cov=Systems/core --cov=Modules --cov-report=xml --cov-report=term-missing || true
    
    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.xml
        flags: unittests
        name: codecov-umbrella
        fail_ci_if_error: false

  docker:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
    
    - name: Build Docker image
      uses: docker/build-push-action@v5
      with:
        context: .
        push: false
        tags: swiftdevbot:test
        cache-from: type=gha
        cache-to: type=gha,mode=max




======================================================================

------------------------------ FILE: .pytest_cache/.gitignore ------------------------------
# Created by pytest automatically.
*



======================================================================

------------------------------ FILE: .pytest_cache/CACHEDIR.TAG ------------------------------
Signature: 8a477f597d28d172789f06886806bc55
# This file is a cache directory tag created by pytest.
# For information about cache directory tags, see:
#	https://bford.info/cachedir/spec.html



======================================================================

------------------------------ FILE: .pytest_cache/README.md ------------------------------
# pytest cache directory #

This directory contains data from the pytest's cache plugin,
which provides the `--lf` and `--ff` options, as well as the `cache` fixture.

**Do not** commit this to version control.

See [the docs](https://docs.pytest.org/en/stable/how-to/cache.html) for more information.



======================================================================

------------------------------ FILE: .pytest_cache/v/cache/nodeids ------------------------------
[
  "tests/test_cli.py::test_cli_command_help[command_path0]",
  "tests/test_cli.py::test_cli_command_help[command_path100]",
  "tests/test_cli.py::test_cli_command_help[command_path101]",
  "tests/test_cli.py::test_cli_command_help[command_path102]",
  "tests/test_cli.py::test_cli_command_help[command_path103]",
  "tests/test_cli.py::test_cli_command_help[command_path104]",
  "tests/test_cli.py::test_cli_command_help[command_path105]",
  "tests/test_cli.py::test_cli_command_help[command_path106]",
  "tests/test_cli.py::test_cli_command_help[command_path107]",
  "tests/test_cli.py::test_cli_command_help[command_path108]",
  "tests/test_cli.py::test_cli_command_help[command_path10]",
  "tests/test_cli.py::test_cli_command_help[command_path11]",
  "tests/test_cli.py::test_cli_command_help[command_path12]",
  "tests/test_cli.py::test_cli_command_help[command_path13]",
  "tests/test_cli.py::test_cli_command_help[command_path14]",
  "tests/test_cli.py::test_cli_command_help[command_path15]",
  "tests/test_cli.py::test_cli_command_help[command_path16]",
  "tests/test_cli.py::test_cli_command_help[command_path17]",
  "tests/test_cli.py::test_cli_command_help[command_path18]",
  "tests/test_cli.py::test_cli_command_help[command_path19]",
  "tests/test_cli.py::test_cli_command_help[command_path1]",
  "tests/test_cli.py::test_cli_command_help[command_path20]",
  "tests/test_cli.py::test_cli_command_help[command_path21]",
  "tests/test_cli.py::test_cli_command_help[command_path22]",
  "tests/test_cli.py::test_cli_command_help[command_path23]",
  "tests/test_cli.py::test_cli_command_help[command_path24]",
  "tests/test_cli.py::test_cli_command_help[command_path25]",
  "tests/test_cli.py::test_cli_command_help[command_path26]",
  "tests/test_cli.py::test_cli_command_help[command_path27]",
  "tests/test_cli.py::test_cli_command_help[command_path28]",
  "tests/test_cli.py::test_cli_command_help[command_path29]",
  "tests/test_cli.py::test_cli_command_help[command_path2]",
  "tests/test_cli.py::test_cli_command_help[command_path30]",
  "tests/test_cli.py::test_cli_command_help[command_path31]",
  "tests/test_cli.py::test_cli_command_help[command_path32]",
  "tests/test_cli.py::test_cli_command_help[command_path33]",
  "tests/test_cli.py::test_cli_command_help[command_path34]",
  "tests/test_cli.py::test_cli_command_help[command_path35]",
  "tests/test_cli.py::test_cli_command_help[command_path36]",
  "tests/test_cli.py::test_cli_command_help[command_path37]",
  "tests/test_cli.py::test_cli_command_help[command_path38]",
  "tests/test_cli.py::test_cli_command_help[command_path39]",
  "tests/test_cli.py::test_cli_command_help[command_path3]",
  "tests/test_cli.py::test_cli_command_help[command_path40]",
  "tests/test_cli.py::test_cli_command_help[command_path41]",
  "tests/test_cli.py::test_cli_command_help[command_path42]",
  "tests/test_cli.py::test_cli_command_help[command_path43]",
  "tests/test_cli.py::test_cli_command_help[command_path44]",
  "tests/test_cli.py::test_cli_command_help[command_path45]",
  "tests/test_cli.py::test_cli_command_help[command_path46]",
  "tests/test_cli.py::test_cli_command_help[command_path47]",
  "tests/test_cli.py::test_cli_command_help[command_path48]",
  "tests/test_cli.py::test_cli_command_help[command_path49]",
  "tests/test_cli.py::test_cli_command_help[command_path4]",
  "tests/test_cli.py::test_cli_command_help[command_path50]",
  "tests/test_cli.py::test_cli_command_help[command_path51]",
  "tests/test_cli.py::test_cli_command_help[command_path52]",
  "tests/test_cli.py::test_cli_command_help[command_path53]",
  "tests/test_cli.py::test_cli_command_help[command_path54]",
  "tests/test_cli.py::test_cli_command_help[command_path55]",
  "tests/test_cli.py::test_cli_command_help[command_path56]",
  "tests/test_cli.py::test_cli_command_help[command_path57]",
  "tests/test_cli.py::test_cli_command_help[command_path58]",
  "tests/test_cli.py::test_cli_command_help[command_path59]",
  "tests/test_cli.py::test_cli_command_help[command_path5]",
  "tests/test_cli.py::test_cli_command_help[command_path60]",
  "tests/test_cli.py::test_cli_command_help[command_path61]",
  "tests/test_cli.py::test_cli_command_help[command_path62]",
  "tests/test_cli.py::test_cli_command_help[command_path63]",
  "tests/test_cli.py::test_cli_command_help[command_path64]",
  "tests/test_cli.py::test_cli_command_help[command_path65]",
  "tests/test_cli.py::test_cli_command_help[command_path66]",
  "tests/test_cli.py::test_cli_command_help[command_path67]",
  "tests/test_cli.py::test_cli_command_help[command_path68]",
  "tests/test_cli.py::test_cli_command_help[command_path69]",
  "tests/test_cli.py::test_cli_command_help[command_path6]",
  "tests/test_cli.py::test_cli_command_help[command_path70]",
  "tests/test_cli.py::test_cli_command_help[command_path71]",
  "tests/test_cli.py::test_cli_command_help[command_path72]",
  "tests/test_cli.py::test_cli_command_help[command_path73]",
  "tests/test_cli.py::test_cli_command_help[command_path74]",
  "tests/test_cli.py::test_cli_command_help[command_path75]",
  "tests/test_cli.py::test_cli_command_help[command_path76]",
  "tests/test_cli.py::test_cli_command_help[command_path77]",
  "tests/test_cli.py::test_cli_command_help[command_path78]",
  "tests/test_cli.py::test_cli_command_help[command_path79]",
  "tests/test_cli.py::test_cli_command_help[command_path7]",
  "tests/test_cli.py::test_cli_command_help[command_path80]",
  "tests/test_cli.py::test_cli_command_help[command_path81]",
  "tests/test_cli.py::test_cli_command_help[command_path82]",
  "tests/test_cli.py::test_cli_command_help[command_path83]",
  "tests/test_cli.py::test_cli_command_help[command_path84]",
  "tests/test_cli.py::test_cli_command_help[command_path85]",
  "tests/test_cli.py::test_cli_command_help[command_path86]",
  "tests/test_cli.py::test_cli_command_help[command_path87]",
  "tests/test_cli.py::test_cli_command_help[command_path88]",
  "tests/test_cli.py::test_cli_command_help[command_path89]",
  "tests/test_cli.py::test_cli_command_help[command_path8]",
  "tests/test_cli.py::test_cli_command_help[command_path90]",
  "tests/test_cli.py::test_cli_command_help[command_path91]",
  "tests/test_cli.py::test_cli_command_help[command_path92]",
  "tests/test_cli.py::test_cli_command_help[command_path93]",
  "tests/test_cli.py::test_cli_command_help[command_path94]",
  "tests/test_cli.py::test_cli_command_help[command_path95]",
  "tests/test_cli.py::test_cli_command_help[command_path96]",
  "tests/test_cli.py::test_cli_command_help[command_path97]",
  "tests/test_cli.py::test_cli_command_help[command_path98]",
  "tests/test_cli.py::test_cli_command_help[command_path99]",
  "tests/test_cli.py::test_cli_command_help[command_path9]",
  "tests/test_cli.py::test_cli_subcommand_help[command0]",
  "tests/test_cli.py::test_cli_subcommand_help[command10]",
  "tests/test_cli.py::test_cli_subcommand_help[command11]",
  "tests/test_cli.py::test_cli_subcommand_help[command12]",
  "tests/test_cli.py::test_cli_subcommand_help[command13]",
  "tests/test_cli.py::test_cli_subcommand_help[command1]",
  "tests/test_cli.py::test_cli_subcommand_help[command2]",
  "tests/test_cli.py::test_cli_subcommand_help[command3]",
  "tests/test_cli.py::test_cli_subcommand_help[command4]",
  "tests/test_cli.py::test_cli_subcommand_help[command5]",
  "tests/test_cli.py::test_cli_subcommand_help[command6]",
  "tests/test_cli.py::test_cli_subcommand_help[command7]",
  "tests/test_cli.py::test_cli_subcommand_help[command8]",
  "tests/test_cli.py::test_cli_subcommand_help[command9]",
  "tests/test_error_handler.py::TestCustomExceptions::test_database_error",
  "tests/test_error_handler.py::TestCustomExceptions::test_module_error",
  "tests/test_error_handler.py::TestCustomExceptions::test_permission_error",
  "tests/test_error_handler.py::TestCustomExceptions::test_rate_limit_error",
  "tests/test_error_handler.py::TestCustomExceptions::test_validation_error",
  "tests/test_health.py::TestHealthChecker::test_check_all",
  "tests/test_health.py::TestHealthChecker::test_check_cache_healthy",
  "tests/test_health.py::TestHealthChecker::test_check_cache_unavailable",
  "tests/test_health.py::TestHealthChecker::test_check_database_healthy",
  "tests/test_health.py::TestHealthChecker::test_check_database_unhealthy",
  "tests/test_health.py::TestHealthStatus::test_health_status_creation",
  "tests/test_health.py::TestHealthStatus::test_health_status_to_dict",
  "tests/test_input_validator.py::TestInputValidator::test_initialization",
  "tests/test_input_validator.py::TestInputValidator::test_sanitize_text",
  "tests/test_input_validator.py::TestInputValidator::test_validate_callback_data_dangerous_chars",
  "tests/test_input_validator.py::TestInputValidator::test_validate_callback_data_too_long",
  "tests/test_input_validator.py::TestInputValidator::test_validate_callback_data_valid",
  "tests/test_input_validator.py::TestInputValidator::test_validate_command_invalid_format",
  "tests/test_input_validator.py::TestInputValidator::test_validate_command_too_long",
  "tests/test_input_validator.py::TestInputValidator::test_validate_command_valid",
  "tests/test_input_validator.py::TestInputValidator::test_validate_message_flood_pattern",
  "tests/test_input_validator.py::TestInputValidator::test_validate_message_too_long",
  "tests/test_input_validator.py::TestInputValidator::test_validate_message_valid",
  "tests/test_input_validator.py::TestInputValidator::test_validate_message_xss_pattern",
  "tests/test_metrics.py::TestMetricsCollector::test_get_metrics_dict",
  "tests/test_metrics.py::TestMetricsCollector::test_get_prometheus_format",
  "tests/test_metrics.py::TestMetricsCollector::test_increment_counter",
  "tests/test_metrics.py::TestMetricsCollector::test_increment_counter_with_labels",
  "tests/test_metrics.py::TestMetricsCollector::test_initialization",
  "tests/test_metrics.py::TestMetricsCollector::test_record_histogram",
  "tests/test_metrics.py::TestMetricsCollector::test_set_gauge",
  "tests/test_rate_limiter.py::TestRateLimiter::test_check_rate_limit_allowed",
  "tests/test_rate_limiter.py::TestRateLimiter::test_check_rate_limit_exceeded",
  "tests/test_rate_limiter.py::TestRateLimiter::test_different_action_types",
  "tests/test_rate_limiter.py::TestRateLimiter::test_get_user_stats",
  "tests/test_rate_limiter.py::TestRateLimiter::test_initialization",
  "tests/test_rate_limiter.py::TestRateLimiter::test_reset_user",
  "tests/test_web_app.py::test_block_user_and_module_toggle",
  "tests/test_web_app.py::test_get_modules_fallback_and_custom"
]


======================================================================

------------------------------ FILE: .pytest_cache/v/cache/lastfailed ------------------------------
{}


======================================================================

------------------------------ FILE: Scripts/clean_cache.py ------------------------------
import os
import shutil
from pathlib import Path

def clean_pycache(start_path: str = "."):
    """Ğ£Ğ´Ğ°Ğ»ÑĞµÑ‚ Ğ²ÑĞµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ __pycache__ Ğ¸ .pyc Ñ„Ğ°Ğ¹Ğ»Ñ‹."""
    
    counter = {"dirs": 0, "files": 0}
    
    for root, dirs, files in os.walk(start_path):
        # ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ .venv ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚
        if ".venv" in root:
            continue
            
        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ __pycache__ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸
        if "__pycache__" in dirs:
            cache_path = Path(root) / "__pycache__"
            shutil.rmtree(cache_path)
            print(f"ğŸ—‘ï¸  Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ° Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ: {cache_path}")
            counter["dirs"] += 1
            
        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ .pyc Ñ„Ğ°Ğ¹Ğ»Ñ‹
        for file in files:
            if file.endswith(".pyc"):
                file_path = Path(root) / file
                os.remove(file_path)
                print(f"ğŸ—‘ï¸  Ğ£Ğ´Ğ°Ğ»ĞµĞ½ Ñ„Ğ°Ğ¹Ğ»: {file_path}")
                counter["files"] += 1
    
    return counter

if __name__ == "__main__":
    # Ğ˜Ğ·Ğ¼ĞµĞ½ÑĞµĞ¼ ÑÑ‚Ñƒ ÑÑ‚Ñ€Ğ¾ĞºÑƒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾Ñ€Ğ½ĞµĞ²ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
    project_root = str(Path(__file__).parent.parent)
    print(f"ğŸ” ĞĞ°Ñ‡Ğ¸Ğ½Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ¸ÑĞº Ğ² Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸: {project_root}")
    results = clean_pycache(project_root)
    
    print("\nğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸:")
    print(f"- Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹ __pycache__: {results['dirs']}")
    print(f"- Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾ .pyc Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: {results['files']}")


======================================================================

------------------------------ FILE: Scripts/snapshot_generator.py ------------------------------
import os
from pathlib import Path

# --- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ---
OUTPUT_FILENAME = "project_snapshot.txt"
EXCLUDE_DIRS = {
    ".venv", "Docs", "pytest_cache", "venv", "__pycache__", ".git", ".idea", ".vscode",
    "build", "dist", "*.egg-info", "node_modules",
    "Data/Cache", "Data/LogsBot", "Data/Temp", "Data/Uploads", # Ğ˜Ğ· Ñ‚Ğ²Ğ¾ĞµĞ¹ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Data/
    "logs", # ĞĞ±Ñ‰Ğ°Ñ Ğ¿Ğ°Ğ¿ĞºĞ° Ğ»Ğ¾Ğ³Ğ¾Ğ², ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ
    "Modules", # ĞŸĞ°Ğ¿ĞºĞ° Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸, ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ
}
EXCLUDE_FILES = {
    OUTPUT_FILENAME,  # ĞĞµ Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ‚ÑŒ ÑĞ°Ğ¼ Ñ„Ğ°Ğ¹Ğ» Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°
    ".DS_Store",
    "*.pyc",
    "*.swp",
    "*.swo",
    # Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ÑÑĞ´Ğ° Ñ„Ğ°Ğ¹Ğ»Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ‚ÑŒ, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ Ğ±Ğ¸Ğ½Ğ°Ñ€Ğ½Ğ¸ĞºĞ¸
    "project_snapshot.txt"
    "TEST.md"
}
EXCLUDE_EXTENSIONS = {
    ".sqlite", ".db", ".db-journal", # Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ±Ğ°Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¼Ğ¸)
    ".log", # Ğ£Ğ¶Ğµ Ğ¿Ğ¾ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ EXCLUDE_DIRS, Ğ½Ğ¾ Ğ½Ğ° Ğ²ÑÑĞºĞ¸Ğ¹ ÑĞ»ÑƒÑ‡Ğ°Ğ¹
    # Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ‚ÑŒ
    # ".zip", ".tar.gz"
}
MAX_FILE_SIZE_MB = 2  # ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ´Ğ»Ñ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ĞµĞ³Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾ (Ğ² ĞœĞ‘)
MAX_TOTAL_OUTPUT_SIZE_MB = 50 # ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ½Ğ° Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ° (Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ±Ñ‹Ğ» Ğ³Ğ¸Ğ³Ğ°Ğ½Ñ‚ÑĞºĞ¸Ğ¼)

# ĞšĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ´Ğ»Ñ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
FILE_ENCODING = "utf-8"
# --- ĞšĞ¾Ğ½ĞµÑ† Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº ---

def should_exclude_dir(dir_name, exclude_set):
    return dir_name in exclude_set

def should_exclude_file(file_name, file_path, exclude_files_set, exclude_ext_set):
    if file_name in exclude_files_set:
        return True
    if file_path.suffix.lower() in exclude_ext_set:
        return True
    # ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ¿Ğ¾ Ğ¼Ğ°ÑĞºĞµ, ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾
    # import fnmatch
    # for pattern in exclude_files_set:
    #     if fnmatch.fnmatch(file_name, pattern):
    #         return True
    return False

def get_dir_tree(start_path, indent_char="    ", max_depth=10):
    tree_lines = []
    # ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ³Ğ»ÑƒĞ±Ğ¸Ğ½Ñƒ Ñ€ĞµĞºÑƒÑ€ÑĞ¸Ğ¸ Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ñ†Ğ¸ĞºĞ»Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ»Ğ¸ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ³Ğ¾ Ğ´ĞµÑ€ĞµĞ²Ğ°
    if max_depth < 0:
        return ["... (Max depth reached)"]

    try:
        items = sorted(list(start_path.iterdir()), key=lambda p: (p.is_file(), p.name.lower()))
    except PermissionError:
        return [f"... (Permission denied: {start_path})"]
    except FileNotFoundError:
        return [f"... (Not found: {start_path})"]


    for i, item in enumerate(items):
        is_last = i == (len(items) - 1)
        prefix = indent_char + ("â””â”€â”€ " if is_last else "â”œâ”€â”€ ")

        if item.is_dir():
            if should_exclude_dir(item.name, EXCLUDE_DIRS):
                tree_lines.append(f"{prefix}{item.name}/ [EXCLUDED_DIR]")
                continue
            tree_lines.append(f"{prefix}{item.name}/")
            # Ğ ĞµĞºÑƒÑ€ÑĞ¸Ğ²Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ
            # Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ°ĞµĞ¼ max_depth Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
            sub_indent = indent_char + ("    " if is_last else "â”‚   ")
            tree_lines.extend([sub_indent + line for line in get_dir_tree(item, indent_char, max_depth -1)])
        else:
            if should_exclude_file(item.name, item, EXCLUDE_FILES, EXCLUDE_EXTENSIONS):
                tree_lines.append(f"{prefix}{item.name} [EXCLUDED_FILE]")
                continue
            tree_lines.append(f"{prefix}{item.name}")
            
    return tree_lines


def main():
    project_root = Path(".") # Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°Ñ‚ÑŒ Ğ¸Ğ· ĞºĞ¾Ñ€Ğ½Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
    snapshot_content = []
    current_total_size = 0
    max_total_bytes = MAX_TOTAL_OUTPUT_SIZE_MB * 1024 * 1024

    # 1. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
    snapshot_content.append("=" * 30 + " PROJECT STRUCTURE " + "=" * 30)
    snapshot_content.append(f"{project_root.resolve().name}/")
    tree_str = "\n".join(get_dir_tree(project_root))
    snapshot_content.append(tree_str)
    snapshot_content.append("\n" + "=" * 70 + "\n")
    current_total_size += len(tree_str.encode(FILE_ENCODING, errors='ignore'))


    # 2. Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
    for item_path in project_root.rglob("*"): # Ğ ĞµĞºÑƒÑ€ÑĞ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ…Ğ¾Ğ´ Ğ²ÑĞµÑ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¸ Ğ¿Ğ°Ğ¿Ğ¾Ğº
        if current_total_size > max_total_bytes:
            snapshot_content.append("\n... (Total output size limit reached, stopping file content inclusion) ...\n")
            print(f"Warning: Total output size limit ({MAX_TOTAL_OUTPUT_SIZE_MB}MB) reached. Some file contents might be omitted.")
            break

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹ Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ rglob
        is_in_excluded_dir = False
        for part in item_path.relative_to(project_root).parts:
            if part in EXCLUDE_DIRS:
                is_in_excluded_dir = True
                break
        if is_in_excluded_dir and item_path.is_dir(): # Ğ•ÑĞ»Ğ¸ ÑĞ°Ğ¼Ğ° Ğ¿Ğ°Ğ¿ĞºĞ° Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ°, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ĞµĞµ rglob
            continue
        if item_path.is_dir(): # Ğ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ (ÑƒĞ¶Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»Ğ¸ Ğ² Ğ´ĞµÑ€ĞµĞ²Ğµ)
            if item_path.name in EXCLUDE_DIRS: # Ğ”Ğ¾Ğ¿. Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
                 continue
            continue


        relative_path_str = str(item_path.relative_to(project_root))

        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ½Ğµ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ğ»Ğ¸ Ñ„Ğ°Ğ¹Ğ» Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸
        # Ğ­Ñ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾, Ñ‚.Ğº. rglob Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ´Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¸Ğ· Ğ¿Ğ¾Ğ´Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¼Ñ‹ Ñ…Ğ¾Ñ‚Ğ¸Ğ¼ Ğ¸ÑĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ†ĞµĞ»Ğ¸ĞºĞ¾Ğ¼
        parent_excluded = False
        for parent in item_path.parents:
            if parent.name in EXCLUDE_DIRS:
                parent_excluded = True
                break
        if parent_excluded:
            # print(f"Skipping (parent excluded): {relative_path_str}")
            continue
            
        if item_path.name in EXCLUDE_DIRS: # Ğ•ÑĞ»Ğ¸ ÑĞ°Ğ¼ Ñ„Ğ°Ğ¹Ğ» - ÑÑ‚Ğ¾ Ğ¸Ğ¼Ñ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ (Ğ¼Ğ°Ğ»Ğ¾Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾, Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚Ñ‹)
            # print(f"Skipping (matches excluded dir name): {relative_path_str}")
            continue

        if should_exclude_file(item_path.name, item_path, EXCLUDE_FILES, EXCLUDE_EXTENSIONS):
            # print(f"Skipping (excluded file/ext): {relative_path_str}")
            continue
        
        snapshot_content.append("-" * 30 + f" FILE: {relative_path_str} " + "-" * 30)
        try:
            file_size = item_path.stat().st_size
            if file_size > MAX_FILE_SIZE_MB * 1024 * 1024:
                snapshot_content.append(f"[CONTENT OMITTED - File size ({file_size / (1024*1024):.2f} MB) > {MAX_FILE_SIZE_MB} MB]\n")
                print(f"Skipping content of large file: {relative_path_str}")
            else:
                with open(item_path, "r", encoding=FILE_ENCODING, errors="ignore") as f:
                    content = f.read()
                snapshot_content.append(content + "\n")
                current_total_size += len(content.encode(FILE_ENCODING, errors='ignore'))

        except Exception as e:
            snapshot_content.append(f"[ERROR READING FILE: {e}]\n")
            print(f"Error reading file {relative_path_str}: {e}")
        snapshot_content.append("\n" + "=" * 70 + "\n")


    # 3. Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² Ñ„Ğ°Ğ¹Ğ»
    try:
        with open(OUTPUT_FILENAME, "w", encoding=FILE_ENCODING) as f:
            f.write("\n".join(snapshot_content))
        print(f"Project snapshot saved to: {OUTPUT_FILENAME}")
        print(f"Approximate total output size: {current_total_size / (1024*1024):.2f} MB")

    except Exception as e:
        print(f"Error writing snapshot file: {e}")

if __name__ == "__main__":
    main()


======================================================================
