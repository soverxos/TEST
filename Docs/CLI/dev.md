# 🛠️ Инструменты разработки (dev)

## Обзор

Модуль `dev` предоставляет инструменты для разработки SwiftDevBot, включая линтинг, тестирование, сборку документации, отладку и анализ кода.

## Основные команды

### `python3 sdb.py dev lint --fix`

Проверяет код на соответствие стандартам и исправляет простые ошибки.

**Опции:**
- `--files FILES` - файлы для проверки
- `--fix` - автоматическое исправление ошибок
- `--tool TOOL` - инструмент: flake8, black, isort, mypy
- `--format FORMAT` - формат вывода: text, json, html

**Примеры:**

```bash
# Проверить код
python3 sdb.py dev lint

# Исправить ошибки автоматически
python3 sdb.py dev lint --fix

# Использовать конкретный инструмент
python3 sdb.py dev lint --tool black

# Проверить конкретные файлы
python3 sdb.py dev lint --files cli/config.py core/app_settings.py
```

**Результат:**
```
╭─────────────────────────────────╮
│ ПРОВЕРКА КОДА                   │
╰─────────────────────────────────╯

Найдено Python файлов: 45
Инструмент: flake8
Режим: Только проверка
Выполняется: /usr/bin/python3 -m flake8 cli/config.py core/app_settings.py

✅ Проверка завершена без ошибок
```

### `python3 sdb.py dev test --coverage`

Запускает тесты с измерением покрытия кода.

**Опции:**
- `--coverage` - измерить покрытие
- `--unit` - только unit тесты
- `--integration` - только интеграционные тесты
- `--verbose` - подробный вывод
- `--parallel` - параллельное выполнение

**Примеры:**

```bash
# Запустить все тесты
python3 sdb.py dev test

# Тесты с покрытием
python3 sdb.py dev test --coverage

# Только unit тесты
python3 sdb.py dev test --unit

# Параллельное выполнение
python3 sdb.py dev test --parallel
```

**Результат:**
```
╭─────────────────────────────────╮
│ ЗАПУСК ТЕСТОВ                   │
╰─────────────────────────────────╯

📋 Настройки тестирования:
   📊 Фреймворк: pytest
   📊 Покрытие: Включено
   📊 Параллельность: 4 процесса
   📋 Статус: Выполняется...

📊 Результаты тестирования:

✅ Unit тесты:
   ✅ cli/ - 45 тестов (100% успешно)
   ✅ core/ - 32 теста (100% успешно)
   ✅ modules/ - 28 тестов (100% успешно)
   ✅ utils/ - 15 тестов (100% успешно)

📊 Покрытие кода:
   📈 Общее покрытие: 85%
   📈 cli/: 90%
   📈 core/: 88%
   📈 modules/: 82%
   📈 utils/: 85%

📊 Статистика:
   ✅ Всего тестов: 145
   ✅ Успешных: 145
   ❌ Неудачных: 0
   📊 Время выполнения: 45 секунд
```

### `python3 sdb.py dev docs --build`

Строит документацию проекта.

**Опции:**
- `--build` - построить документацию
- `--serve` - запустить локальный сервер
- `--format html/pdf` - формат документации
- `--clean` - очистить старую документацию

**Примеры:**

```bash
# Построить документацию
python3 sdb.py dev docs --build

# Запустить локальный сервер
python3 sdb.py dev docs --serve

# Построить в PDF
python3 sdb.py dev docs --build --format pdf

# Очистить и перестроить
python3 sdb.py dev docs --build --clean
```

**Результат:**
```
╭─────────────────────────────────╮
│ СБОРКА ДОКУМЕНТАЦИИ             │
╰─────────────────────────────────╯

📋 Настройки сборки:
   📊 Тип: HTML документация
   📊 Источники: docstrings, markdown
   📊 Тема: Read the Docs
   📋 Статус: Строится...

📊 Обработка файлов:
   ✅ Python модули: 25 файлов
   ✅ Markdown файлы: 15 файлов
   ✅ Конфигурация: 5 файлов
   ✅ Статические файлы: 10 файлов

✅ Документация успешно построена
📁 Файлы созданы:
   📄 index.html (главная страница)
   📄 api.html (API документация)
   📄 cli.html (CLI документация)
   📄 modules.html (модули)
   📄 tutorials.html (руководства)

📊 Статистика документации:
   📋 Страниц: 45
   📋 API endpoints: 25
   📋 CLI команды: 50
   📋 Примеры кода: 120
```

### `python3 sdb.py dev debug --enable`

Включает режим отладки.

**Опции:**
- `--enable` - включить отладку
- `--disable` - отключить отладку
- `--level DEBUG/INFO/WARNING/ERROR` - уровень отладки
- `--log-file FILE` - файл для логов

**Примеры:**

```bash
# Включить отладку
python3 sdb.py dev debug --enable

# Отключить отладку
python3 sdb.py dev debug --disable

# Установить уровень отладки
python3 sdb.py dev debug --enable --level DEBUG

# Логи в файл
python3 sdb.py dev debug --enable --log-file debug.log
```

**Результат:**
```
╭─────────────────────────────────╮
│ РЕЖИМ ОТЛАДКИ                   │
╰─────────────────────────────────╯

📋 Включение отладки:
   📊 Уровень: DEBUG
   📊 Логирование: В файл
   📊 Файл логов: debug.log
   📋 Статус: Настраивается...

✅ Режим отладки включен
📊 Настройки:
   📊 Уровень логирования: DEBUG
   📊 Вывод в консоль: Включен
   📊 Файл логов: debug.log
   📊 Максимальный размер: 10MB

📋 Включенные функции:
   ✅ Подробные логи
   ✅ Stack traces
   ✅ Переменные окружения
   ✅ SQL запросы
   ✅ HTTP запросы
   ✅ Производительность
```

### `python3 sdb.py dev analyze --tool`

Анализ качества кода.

**Опции:**
- `--tool TOOL` - инструмент анализа: pylint, bandit, safety
- `--format FORMAT` - формат вывода: text, json, html

**Примеры:**

```bash
# Анализ кода
python3 sdb.py dev analyze --tool pylint

# Анализ безопасности
python3 sdb.py dev analyze --tool bandit

# Проверка зависимостей
python3 sdb.py dev analyze --tool safety
```

**Результат:**
```
╭─────────────────────────────────╮
│ АНАЛИЗ КОДА                     │
╰─────────────────────────────────╯

📋 Анализ кода:
   📊 Инструмент анализа: pylint
   📊 Файлов проанализировано: 150
   📊 Строк кода: 25,000
   📊 Сложность: Средняя
   📋 Статус: Анализируется...

📊 Результаты анализа:

📈 Метрики качества:
   📊 Цикломатическая сложность: 3.2 (хорошо)
   📊 Поддерживаемость: 85% (хорошо)
   📊 Надежность: 92% (отлично)
   📊 Безопасность: 88% (хорошо)

📊 Проблемы найдены:
   ⚠️ Высокая сложность: 5 функций
   ⚠️ Длинные функции: 8 функций
   ⚠️ Дублирование кода: 3 блока
   ⚠️ Неиспользуемые импорты: 12

📊 Рекомендации:
   🔧 Разбейте сложные функции на простые
   🔧 Удалите неиспользуемые импорты
   🔧 Используйте DRY принцип
   📊 Общее качество: Хорошее
```

### `python3 sdb.py dev profile --type`

Профилирует производительность кода.

**Опции:**
- `--type TYPE` - тип профилирования: cpu, memory, time
- `--duration SECONDS` - длительность профилирования в секундах
- `--output FILE` - файл для сохранения результатов
- `--script SCRIPT` - скрипт для профилирования

**Примеры:**

```bash
# CPU профилирование
python3 sdb.py dev profile --type cpu --duration 30

# Профилирование памяти
python3 sdb.py dev profile --type memory --duration 60

# Профилирование времени
python3 sdb.py dev profile --type time --duration 10

# Сохранить результаты в файл
python3 sdb.py dev profile --type cpu --output profile_report.html

# Профилировать конкретный скрипт
python3 sdb.py dev profile --type cpu --script run_bot.py --duration 30
```

**Результат CPU профилирования:**
```
╭───────────────────────────────────╮
│ ПРОФИЛИРОВАНИЕ ПРОИЗВОДИТЕЛЬНОСТИ │
╰───────────────────────────────────╯
Тип профилирования: cpu
Длительность: 10 секунд
Целевой скрипт: sdb.py
Выполняется CPU профилирование...

✅ Профилирование завершено!

📊 Результаты CPU профилирования:
                                Топ-10 функций по времени выполнения                                 
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓
┃ Функция                                      ┃ Файл          ┃ Вызовы ┃ Общее время ┃ Время/вызов ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩
│ __init__                                     │ subprocess.py │ 1      │ 0.0012s     │ 0.001199s   │
│ _execute_child                               │ subprocess.py │ 1      │ 0.0009s     │ 0.000939s   │
│ _dev_profile_async                           │ dev.py        │ 1      │ 0.0005s     │ 0.000483s   │
│ _run_profiling                               │ dev.py        │ 1      │ 0.0005s     │ 0.000479s   │
│ _profile_cpu                                 │ dev.py        │ 1      │ 0.0005s     │ 0.000477s   │
└──────────────────────────────────────────────┴───────────────┴────────┴─────────────┴─────────────┘

📈 Статистика:
   📊 Всего функций: 72
   📊 Общее время: 0.0064s

💡 Рекомендации:
   🔧 Оптимизируйте функцию: __init__
   📊 Она занимает 0.00s (18.7%)
```

**Результат профилирования времени:**
```
╭───────────────────────────────────╮
│ ПРОФИЛИРОВАНИЕ ПРОИЗВОДИТЕЛЬНОСТИ │
╰───────────────────────────────────╯
Тип профилирования: time
Длительность: 5 секунд
Целевой скрипт: sdb.py
Выполняется профилирование времени...

✅ Профилирование завершено!

📊 Результаты профилирования времени:
📈 Время выполнения:
   📊 Начало: 20:10:52
   📊 Конец: 20:10:57
   📊 Длительность: 5.01 секунд
   📊 Скрипт: sdb.py

💡 Рекомендации:
   ✅ Время выполнения в норме
```

**Результат профилирования памяти:**
```
╭───────────────────────────────────╮
│ ПРОФИЛИРОВАНИЕ ПРОИЗВОДИТЕЛЬНОСТИ │
╰───────────────────────────────────╯
Тип профилирования: memory
Длительность: 5 секунд
Целевой скрипт: sdb.py
Выполняется профилирование памяти...

✅ Профилирование завершено!

📊 Результаты профилирования памяти:
            Использование памяти             
┏━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┓
┃ Строка ┃ Память (MiB) ┃ Прирост ┃ Функция ┃
┡━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━┩
└────────┴──────────────┴─────────┴─────────┘

📈 Статистика памяти:
   📊 Пиковое использование: 0.00 MiB
   📊 Проанализировано строк: 0

💡 Рекомендации:
   ✅ Память используется эффективно
```

## Расширенные команды (в разработке)

### `python3 sdb.py dev benchmark --run` 🔄

Запуск бенчмарков.

**Опции:**
- `--run` - запустить бенчмарки
- `--compare` - сравнить с предыдущими
- `--suite SUITE` - конкретный набор тестов
- `--iterations N` - количество итераций

**Примеры:**

```bash
# Запустить все бенчмарки
python3 sdb.py dev benchmark --run

# Сравнить с предыдущими
python3 sdb.py dev benchmark --compare

# Конкретный набор
python3 sdb.py dev benchmark --run --suite database
```

**Результат:**
```
⚡ Запуск бенчмарков

📋 Настройки бенчмарков:
   📊 Набор тестов: Все
   📊 Итераций: 1000
   📊 Время выполнения: 5 минут
   📋 Статус: Выполняется...

📊 Результаты бенчмарков:

🚀 Производительность:
   📊 Бэкап (1GB): 45 секунд
   📊 Оптимизация БД: 12 секунд
   📊 Кэширование: 0.5 секунды
   📊 API запрос: 2ms

📈 Сравнение с предыдущими:
   📊 Бэкап: +15% быстрее
   📊 Оптимизация БД: +8% быстрее
   📊 Кэширование: Без изменений
   📊 API запрос: +5% быстрее

📊 Рекомендации:
   ✅ Производительность улучшилась
   🔧 Оптимизируйте кэширование
   📊 Мониторьте производительность
   🔄 Регулярно запускайте бенчмарки

📋 Детальный отчет:
   📄 benchmark_results_20240115_143522.json
   📊 Размер файла: 500KB
   📊 Время выполнения: 5 минут
   📊 Точность: 99.9%
```

### `python3 sdb.py dev migrate --type`

Миграция кода между версиями.

**Опции:**
- `--type TYPE` - тип миграции: code, config, data
- `--dry-run/--no-dry-run` - показать что будет изменено без выполнения
- `--from VERSION` - версия источника
- `--to VERSION` - версия назначения
- `--backup/--no-backup` - создать резервную копию перед миграцией

**Примеры:**

```bash
# Анализ миграции кода (dry-run)
python3 sdb.py dev migrate --type code --dry-run

# Миграция конфигурации
python3 sdb.py dev migrate --type config

# Миграция данных с указанием версий
python3 sdb.py dev migrate --type data --from 0.1.0 --to 0.2.0

# Миграция без резервной копии
python3 sdb.py dev migrate --type code --no-backup
```

**Результат dry-run анализа:**
```
╭─ SDB Core Dev Tools ─╮
│ 🔄 МИГРАЦИЯ КОДА     │
╰──────────────────────╯
Тип миграции: code
Версия источника: 0.1.0
Версия назначения: 0.2.0
Режим dry-run: Да
Резервная копия: Да

🔍 АНАЛИЗ ИЗМЕНЕНИЙ (DRY-RUN)
Анализ изменений...
📊 Файлов для миграции: 15
📊 Изменений в API: 3
📊 Новых функций: 8
📊 Удаленных функций: 2
📊 Изменений импортов: 12
📊 Устаревших вызовов: 5

✅ Анализ завершен - изменения безопасны для миграции
```

**Результат выполнения миграции:**
```
╭─ SDB Core Dev Tools ─╮
│ 🔄 МИГРАЦИЯ КОДА     │
╰──────────────────────╯
Тип миграции: code
Версия источника: 0.1.0
Версия назначения: 0.2.0
Режим dry-run: Нет
Резервная копия: Нет

🚀 ВЫПОЛНЕНИЕ МИГРАЦИИ
🔄 Выполнение миграции...
📝 Обновление импортов...
✅ Обновление импортов: 15 файлов
📝 Изменение вызовов API...
✅ Изменение вызовов API: 8 файлов
📝 Добавление новых функций...
✅ Добавление новых функций: 5 файлов
📝 Удаление устаревших функций...
✅ Удаление устаревших функций: 3 файлов

📊 Статистика:
   📊 Файлов обработано: 31
   📊 Изменений: 93
   📊 Ошибок: 0

✅ Миграция успешно завершена!
```

## Текущие ограничения

- ✅ Линтинг с flake8, black, isort, mypy
- ✅ Тестирование с pytest и coverage
- ✅ Сборка документации с Sphinx
- ✅ Режим отладки с настраиваемыми уровнями
- ✅ Анализ кода с pylint, bandit, safety
- ✅ Профилирование производительности (CPU, память, время)
- ✅ Бенчмарки (измерение производительности)
- ✅ Миграция кода (между версиями)

## Безопасность

### ✅ Безопасные команды:
- `python3 sdb.py dev lint` - только проверяет код
- `python3 sdb.py dev test` - только запускает тесты
- `python3 sdb.py dev docs --build` - только строит документацию
- `python3 sdb.py dev analyze` - только анализирует код
- `python3 sdb.py dev profile` - только профилирует производительность
- `python3 sdb.py dev benchmark` - только запускает бенчмарки
- `python3 sdb.py dev migrate` - только анализирует и мигрирует код

### ⚠️ Опасные команды:
- `python3 sdb.py dev lint --fix` - может изменить код
- `python3 sdb.py dev debug --enable` - может повлиять на производительность

## Рекомендации

1. **Регулярное тестирование**: Запускайте тесты перед каждым коммитом
2. **Линтинг**: Используйте линтинг для поддержания качества кода
3. **Документация**: Обновляйте документацию при изменениях
4. **Отладка**: Используйте отладку только в разработке
5. **Анализ**: Регулярно анализируйте качество кода
6. **Профилирование**: Используйте профилирование для оптимизации производительности
7. **Бенчмарки**: Регулярно измеряйте производительность компонентов
8. **Миграции**: Используйте dry-run перед выполнением миграций

## Устранение проблем

### Проблема: "Тесты не проходят"
```bash
# Запустить тесты с подробным выводом
python3 sdb.py dev test --verbose

# Запустить конкретный тест
python3 sdb.py dev test --unit

# Проверить покрытие
python3 sdb.py dev test --coverage
```

### Проблема: "Ошибки линтинга"
```bash
# Исправить автоматически
python3 sdb.py dev lint --fix

# Использовать другой инструмент
python3 sdb.py dev lint --tool black

# Проверить конкретный файл
python3 sdb.py dev lint --files cli/config.py
```

### Проблема: "Инструмент не найден"
```bash
# Установить flake8
pip install flake8

# Установить black
pip install black

# Установить pytest
pip install pytest

# Установить memory_profiler для профилирования памяти
pip install memory_profiler
```

### Проблема: "Профилирование не работает"
```bash
# Проверить доступность memory_profiler
python3 sdb.py dev profile --type memory --duration 5

# Использовать CPU профилирование (не требует дополнительных пакетов)
python3 sdb.py dev profile --type cpu --duration 10

# Профилировать конкретный скрипт
python3 sdb.py dev profile --type cpu --script run_bot.py --duration 30
```

## Инструменты разработки

### Линтинг
- **flake8**: Проверка стиля кода
- **black**: Форматирование кода
- **isort**: Сортировка импортов
- **mypy**: Проверка типов

### Тестирование
- **pytest**: Фреймворк тестирования
- **coverage**: Измерение покрытия
- **pytest-cov**: Интеграция с coverage
- **pytest-xdist**: Параллельное выполнение

### Анализ
- **pylint**: Анализ качества кода
- **bandit**: Анализ безопасности
- **safety**: Проверка зависимостей

### Профилирование
- **cProfile**: Профилирование CPU (встроенный)
- **memory_profiler**: Профилирование памяти
- **time**: Измерение времени выполнения

### Документация
- **Sphinx**: Генератор документации
- **Read the Docs**: Хостинг документации
- **MkDocs**: Альтернативный генератор
- **pdoc**: Автоматическая документация 