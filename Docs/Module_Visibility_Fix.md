# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ú–æ–¥—É–ª–∏ –Ω–µ –≤–∏–¥–Ω—ã –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

**–û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –≤–∏–¥–µ–ª–∏ –º–æ–¥—É–ª–∏ –≤ –º–µ–Ω—é –±–æ—Ç–∞**, –¥–∞–∂–µ –µ—Å–ª–∏ –º–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º.

## üîç –ü—Ä–∏—á–∏–Ω–∞

–ö–æ–≥–¥–∞ —É –º–æ–¥—É–ª—è –µ—Å—Ç—å `declared_permissions` (–æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è), —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±–æ–≤–∞–ª–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–º–µ—Ç—å **–ø–µ—Ä–≤–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞**, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –º–æ–¥—É–ª—å. –ù–æ –æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –∏–º–µ–ª–∏ —ç—Ç–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –º–æ–¥—É–ª—å –±—ã–ª —Å–∫—Ä—ã—Ç.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –µ—Å—Ç—å –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ —Å–¥–µ–ª–∞—Ç—å –º–æ–¥—É–ª—å –≤–∏–¥–∏–º—ã–º –¥–ª—è –≤—Å–µ—Ö:

### –°–ø–æ—Å–æ–± 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `assign_default_access_to_user_role: true` (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

–í `manifest.yaml` –º–æ–¥—É–ª—è –¥–æ–±–∞–≤—å:

```yaml
metadata:
  public_access: true  # –ö–æ—Ä–æ—Ç–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
  # –∏–ª–∏
  assign_default_access_to_user_role: true  # –î–ª–∏–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (—Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
```

**–ß—Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ú–æ–¥—É–ª—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏–¥–∏–º—ã–º **–≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º** –≤ –º–µ–Ω—é
- ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ `{module_name}.access_user_features` **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è —Ä–æ–ª–∏ `User`
- ‚úÖ –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å

**–ü—Ä–∏–º–µ—Ä:**
```yaml
name: my_module
display_name: –ú–æ–π –º–æ–¥—É–ª—å
version: 1.0.0

permissions:
  - name: my_module.access_user_features
    description: –î–æ—Å—Ç—É–ø –∫ –±–∞–∑–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º –º–æ–¥—É–ª—è
  - name: my_module.admin
    description: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

metadata:
  public_access: true  # <-- –ö–û–†–û–¢–ö–ò–ô –í–ê–†–ò–ê–ù–¢ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
  # –∏–ª–∏
  # assign_default_access_to_user_role: true  # –î–ª–∏–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (—Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
```

### –°–ø–æ—Å–æ–± 2: –ù–µ —É–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤–æ–æ–±—â–µ

–ï—Å–ª–∏ —É –º–æ–¥—É–ª—è –Ω–µ—Ç `permissions` –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ, –æ–Ω –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## üõ†Ô∏è –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

### –ë—ã–ª–æ (—Å–ª–æ–∂–Ω–æ –∏ –ø–æ–≤—Ç–æ—Ä—è–ª–æ—Å—å –≤–µ–∑–¥–µ):
```python
if module_info.manifest.declared_permissions:
    if module_info.manifest.metadata and module_info.manifest.metadata.assign_default_access_to_user_role:
        base_permission = f"{module_info.name}.access_user_features"
        has_permission = await rbac.user_has_permission(session, user_id, base_permission)
    else:
        first_permission = module_info.manifest.declared_permissions[0]
        has_permission = await rbac.user_has_permission(session, user_id, first_permission.name)
```

### –°—Ç–∞–ª–æ (–ø—Ä–æ—Å—Ç–æ –∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ):
```python
permission_to_check = get_module_permission_to_check(module_info.name, module_info.manifest)
if permission_to_check:
    has_permission = await rbac.user_has_permission(session, user_id, permission_to_check)
```

## üìù –ö–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å—é –º–æ–¥—É–ª—è

### –ß–µ—Ä–µ–∑ CLI (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É:**
```bash
python3 sdb.py module visibility my_module --show
```

**–°–¥–µ–ª–∞—Ç—å –º–æ–¥—É–ª—å –≤–∏–¥–∏–º—ã–º –≤—Å–µ–º:**
```bash
python3 sdb.py module visibility my_module --public
```

**–°–¥–µ–ª–∞—Ç—å –º–æ–¥—É–ª—å –¥–æ—Å—Ç—É–ø–Ω—ã–º —Ç–æ–ª—å–∫–æ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏:**
```bash
python3 sdb.py module visibility my_module --private
```

### –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ manifest.yaml

1. –û—Ç–∫—Ä–æ–π `manifest.yaml` –º–æ–¥—É–ª—è
2. –î–æ–±–∞–≤—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏:
   ```yaml
   metadata:
     public_access: true  # true = –≤–∏–¥–∏–º –≤—Å–µ–º, false = —Ç–æ–ª—å–∫–æ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏
     # –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ assign_default_access_to_user_role (—Å—Ç–∞—Ä—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
   ```
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞
4. –ü—Ä–æ–≤–µ—Ä—å –æ—Ç –∏–º–µ–Ω–∏ –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ –∞–¥–º–∏–Ω–∞) - –º–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –º–µ–Ω—é

## üéØ –ò—Ç–æ–≥

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –º–æ–¥—É–ª—è:**
- –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å `assign_default_access_to_user_role: true` –≤ `metadata` —Å–µ–∫—Ü–∏—é –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞
- –ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç –≤–∏–¥–∏–º—ã–º –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –Ω–∞–∑–Ω–∞—á–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–î–ª—è —Å–∏—Å—Ç–µ–º—ã:**
- –ö–æ–¥ —Å—Ç–∞–ª –ø—Ä–æ—â–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ
- –í—Å—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å

